"use strict";var HX=Object.create;var nC=Object.defineProperty;var cW=Object.getOwnPropertyDescriptor;var GX=Object.getOwnPropertyNames;var zX=Object.getPrototypeOf,QX=Object.prototype.hasOwnProperty;var YX=(n,e)=>()=>(n&&(e=n(n=0)),e);var F=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),uW=(n,e)=>{for(var t in e)nC(n,t,{get:e[t],enumerable:!0})},dW=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of GX(e))!QX.call(n,i)&&i!==t&&nC(n,i,{get:()=>e[i],enumerable:!(r=cW(e,i))||r.enumerable});return n};var k=(n,e,t)=>(t=n!=null?HX(zX(n)):{},dW(e||!n||!n.__esModule?nC(t,"default",{value:n,enumerable:!0}):t,n)),pW=n=>dW(nC({},"__esModule",{value:!0}),n),v=(n,e,t,r)=>{for(var i=r>1?void 0:r?cW(e,t):e,o=n.length-1,s;o>=0;o--)(s=n[o])&&(i=(r?s(e,t,i):s(i))||i);return r&&i&&nC(e,t,i),i},m=(n,e)=>(t,r)=>e(t,r,n);var fW=F(()=>{var mW;(function(n){(function(e){var t=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),r=i(n);typeof t.Reflect>"u"?t.Reflect=n:r=i(t.Reflect,r),e(r);function i(o,s){return function(a,l){typeof o[a]!="function"&&Object.defineProperty(o,a,{configurable:!0,writable:!0,value:l}),s&&s(a,l)}}})(function(e){var t=Object.prototype.hasOwnProperty,r=typeof Symbol=="function",i=r&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",o=r&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",s=typeof Object.create=="function",a={__proto__:[]}instanceof Array,l=!s&&!a,c={create:s?function(){return rn(Object.create(null))}:a?function(){return rn({__proto__:null})}:function(){return rn({})},has:l?function($,X){return t.call($,X)}:function($,X){return X in $},get:l?function($,X){return t.call($,X)?$[X]:void 0}:function($,X){return $[X]}},u=Object.getPrototypeOf(Function),d=typeof process=="object"&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL==="true",f=!d&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:kr(),g=!d&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:$r(),b=!d&&typeof WeakMap=="function"?WeakMap:Tr(),I=new b;function w($,X,pe,Ie){if(dr(pe)){if(!Ac($))throw new TypeError;if(!W(X))throw new TypeError;return be($,X)}else{if(!Ac($))throw new TypeError;if(!Br(X))throw new TypeError;if(!Br(Ie)&&!dr(Ie)&&!Pi(Ie))throw new TypeError;return Pi(Ie)&&(Ie=void 0),pe=ai(pe),Fe($,X,pe,Ie)}}e("decorate",w);function _($,X){function pe(Ie,Je){if(!Br(Ie))throw new TypeError;if(!dr(Je)&&!fe(Je))throw new TypeError;Te($,X,Ie,Je)}return pe}e("metadata",_);function A($,X,pe,Ie){if(!Br(pe))throw new TypeError;return dr(Ie)||(Ie=ai(Ie)),Te($,X,pe,Ie)}e("defineMetadata",A);function R($,X,pe){if(!Br(X))throw new TypeError;return dr(pe)||(pe=ai(pe)),ht($,X,pe)}e("hasMetadata",R);function V($,X,pe){if(!Br(X))throw new TypeError;return dr(pe)||(pe=ai(pe)),xt($,X,pe)}e("hasOwnMetadata",V);function ie($,X,pe){if(!Br(X))throw new TypeError;return dr(pe)||(pe=ai(pe)),ee($,X,pe)}e("getMetadata",ie);function Q($,X,pe){if(!Br(X))throw new TypeError;return dr(pe)||(pe=ai(pe)),ke($,X,pe)}e("getOwnMetadata",Q);function te($,X){if(!Br($))throw new TypeError;return dr(X)||(X=ai(X)),ve($,X)}e("getMetadataKeys",te);function ae($,X){if(!Br($))throw new TypeError;return dr(X)||(X=ai(X)),vt($,X)}e("getOwnMetadataKeys",ae);function Y($,X,pe){if(!Br(X))throw new TypeError;dr(pe)||(pe=ai(pe));var Ie=ft(X,pe,!1);if(dr(Ie)||!Ie.delete($))return!1;if(Ie.size>0)return!0;var Je=I.get(X);return Je.delete(pe),Je.size>0||I.delete(X),!0}e("deleteMetadata",Y);function be($,X){for(var pe=$.length-1;pe>=0;--pe){var Ie=$[pe],Je=Ie(X);if(!dr(Je)&&!Pi(Je)){if(!W(Je))throw new TypeError;X=Je}}return X}function Fe($,X,pe,Ie){for(var Je=$.length-1;Je>=0;--Je){var nn=$[Je],bt=nn(X,pe,Ie);if(!dr(bt)&&!Pi(bt)){if(!Br(bt))throw new TypeError;Ie=bt}}return Ie}function ft($,X,pe){var Ie=I.get($);if(dr(Ie)){if(!pe)return;Ie=new f,I.set($,Ie)}var Je=Ie.get(X);if(dr(Je)){if(!pe)return;Je=new f,Ie.set(X,Je)}return Je}function ht($,X,pe){var Ie=xt($,X,pe);if(Ie)return!0;var Je=_t(X);return Pi(Je)?!1:ht($,Je,pe)}function xt($,X,pe){var Ie=ft(X,pe,!1);return dr(Ie)?!1:Kt(Ie.has($))}function ee($,X,pe){var Ie=xt($,X,pe);if(Ie)return ke($,X,pe);var Je=_t(X);if(!Pi(Je))return ee($,Je,pe)}function ke($,X,pe){var Ie=ft(X,pe,!1);if(!dr(Ie))return Ie.get($)}function Te($,X,pe,Ie){var Je=ft(pe,Ie,!0);Je.set($,X)}function ve($,X){var pe=vt($,X),Ie=_t($);if(Ie===null)return pe;var Je=ve(Ie,X);if(Je.length<=0)return pe;if(pe.length<=0)return Je;for(var nn=new g,bt=[],kt=0,Qe=pe;kt<Qe.length;kt++){var At=Qe[kt],Z=nn.has(At);Z||(nn.add(At),bt.push(At))}for(var ue=0,j=Je;ue<j.length;ue++){var At=j[ue],Z=nn.has(At);Z||(nn.add(At),bt.push(At))}return bt}function vt($,X){var pe=[],Ie=ft($,X,!1);if(dr(Ie))return pe;for(var Je=Ie.keys(),nn=ze(Je),bt=0;;){var kt=jt(nn);if(!kt)return pe.length=bt,pe;var Qe=tn(kt);try{pe[bt]=Qe}catch(At){try{Ot(nn)}finally{throw At}}bt++}}function qi($){if($===null)return 1;switch(typeof $){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return $===null?1:6;default:return 6}}function dr($){return $===void 0}function Pi($){return $===null}function ed($){return typeof $=="symbol"}function Br($){return typeof $=="object"?$!==null:typeof $=="function"}function aa($,X){switch(qi($)){case 0:return $;case 1:return $;case 2:return $;case 3:return $;case 4:return $;case 5:return $}var pe=X===3?"string":X===5?"number":"default",Ie=Re($,i);if(Ie!==void 0){var Je=Ie.call($,pe);if(Br(Je))throw new TypeError;return Je}return tl($,pe==="default"?"number":pe)}function tl($,X){if(X==="string"){var pe=$.toString;if(L(pe)){var Ie=pe.call($);if(!Br(Ie))return Ie}var Je=$.valueOf;if(L(Je)){var Ie=Je.call($);if(!Br(Ie))return Ie}}else{var Je=$.valueOf;if(L(Je)){var Ie=Je.call($);if(!Br(Ie))return Ie}var nn=$.toString;if(L(nn)){var Ie=nn.call($);if(!Br(Ie))return Ie}}throw new TypeError}function Kt($){return!!$}function Hi($){return""+$}function ai($){var X=aa($,3);return ed(X)?X:Hi(X)}function Ac($){return Array.isArray?Array.isArray($):$ instanceof Object?$ instanceof Array:Object.prototype.toString.call($)==="[object Array]"}function L($){return typeof $=="function"}function W($){return typeof $=="function"}function fe($){switch(qi($)){case 3:return!0;case 4:return!0;default:return!1}}function Re($,X){var pe=$[X];if(pe!=null){if(!L(pe))throw new TypeError;return pe}}function ze($){var X=Re($,o);if(!L(X))throw new TypeError;var pe=X.call($);if(!Br(pe))throw new TypeError;return pe}function tn($){return $.value}function jt($){var X=$.next();return X.done?!1:X}function Ot($){var X=$.return;X&&X.call($)}function _t($){var X=Object.getPrototypeOf($);if(typeof $!="function"||$===u||X!==u)return X;var pe=$.prototype,Ie=pe&&Object.getPrototypeOf(pe);if(Ie==null||Ie===Object.prototype)return X;var Je=Ie.constructor;return typeof Je!="function"||Je===$?X:Je}function kr(){var $={},X=[],pe=function(){function bt(kt,Qe,At){this._index=0,this._keys=kt,this._values=Qe,this._selector=At}return bt.prototype["@@iterator"]=function(){return this},bt.prototype[o]=function(){return this},bt.prototype.next=function(){var kt=this._index;if(kt>=0&&kt<this._keys.length){var Qe=this._selector(this._keys[kt],this._values[kt]);return kt+1>=this._keys.length?(this._index=-1,this._keys=X,this._values=X):this._index++,{value:Qe,done:!1}}return{value:void 0,done:!0}},bt.prototype.throw=function(kt){throw this._index>=0&&(this._index=-1,this._keys=X,this._values=X),kt},bt.prototype.return=function(kt){return this._index>=0&&(this._index=-1,this._keys=X,this._values=X),{value:kt,done:!0}},bt}();return function(){function bt(){this._keys=[],this._values=[],this._cacheKey=$,this._cacheIndex=-2}return Object.defineProperty(bt.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),bt.prototype.has=function(kt){return this._find(kt,!1)>=0},bt.prototype.get=function(kt){var Qe=this._find(kt,!1);return Qe>=0?this._values[Qe]:void 0},bt.prototype.set=function(kt,Qe){var At=this._find(kt,!0);return this._values[At]=Qe,this},bt.prototype.delete=function(kt){var Qe=this._find(kt,!1);if(Qe>=0){for(var At=this._keys.length,Z=Qe+1;Z<At;Z++)this._keys[Z-1]=this._keys[Z],this._values[Z-1]=this._values[Z];return this._keys.length--,this._values.length--,kt===this._cacheKey&&(this._cacheKey=$,this._cacheIndex=-2),!0}return!1},bt.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=$,this._cacheIndex=-2},bt.prototype.keys=function(){return new pe(this._keys,this._values,Ie)},bt.prototype.values=function(){return new pe(this._keys,this._values,Je)},bt.prototype.entries=function(){return new pe(this._keys,this._values,nn)},bt.prototype["@@iterator"]=function(){return this.entries()},bt.prototype[o]=function(){return this.entries()},bt.prototype._find=function(kt,Qe){return this._cacheKey!==kt&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=kt)),this._cacheIndex<0&&Qe&&(this._cacheIndex=this._keys.length,this._keys.push(kt),this._values.push(void 0)),this._cacheIndex},bt}();function Ie(bt,kt){return bt}function Je(bt,kt){return kt}function nn(bt,kt){return[bt,kt]}}function $r(){return function(){function $(){this._map=new f}return Object.defineProperty($.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),$.prototype.has=function(X){return this._map.has(X)},$.prototype.add=function(X){return this._map.set(X,X),this},$.prototype.delete=function(X){return this._map.delete(X)},$.prototype.clear=function(){this._map.clear()},$.prototype.keys=function(){return this._map.keys()},$.prototype.values=function(){return this._map.values()},$.prototype.entries=function(){return this._map.entries()},$.prototype["@@iterator"]=function(){return this.keys()},$.prototype[o]=function(){return this.keys()},$}()}function Tr(){var $=16,X=c.create(),pe=Ie();return function(){function Qe(){this._key=Ie()}return Qe.prototype.has=function(At){var Z=Je(At,!1);return Z!==void 0?c.has(Z,this._key):!1},Qe.prototype.get=function(At){var Z=Je(At,!1);return Z!==void 0?c.get(Z,this._key):void 0},Qe.prototype.set=function(At,Z){var ue=Je(At,!0);return ue[this._key]=Z,this},Qe.prototype.delete=function(At){var Z=Je(At,!1);return Z!==void 0?delete Z[this._key]:!1},Qe.prototype.clear=function(){this._key=Ie()},Qe}();function Ie(){var Qe;do Qe="@@WeakMap@@"+kt();while(c.has(X,Qe));return X[Qe]=!0,Qe}function Je(Qe,At){if(!t.call(Qe,pe)){if(!At)return;Object.defineProperty(Qe,pe,{value:c.create()})}return Qe[pe]}function nn(Qe,At){for(var Z=0;Z<At;++Z)Qe[Z]=Math.random()*255|0;return Qe}function bt(Qe){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(Qe)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(Qe)):nn(new Uint8Array(Qe),Qe):nn(new Array(Qe),Qe)}function kt(){var Qe=bt($);Qe[6]=Qe[6]&79|64,Qe[8]=Qe[8]&191|128;for(var At="",Z=0;Z<$;++Z){var ue=Qe[Z];(Z===4||Z===6||Z===8)&&(At+="-"),ue<16&&(At+="0"),At+=ue.toString(16).toLowerCase()}return At}}function rn($){return $.__=void 0,delete $.__,$}})})(mW||(mW={}))});var hW={};uW(hW,{isPreRelesVersionOfJupyterExtension:()=>XX});var XX,gW=YX(()=>{"use strict";XX=!1});var ZW=F(ll=>{"use strict";Object.defineProperty(ll,"__esModule",{value:!0});ll.EventEmitter=ll.once=ll.toPromise=void 0;function DZ(n,e){return e?e.aborted?Promise.resolve(void 0):new Promise(t=>{let r=(0,ll.once)(n,o=>{e.removeEventListener("abort",i),t(o)}),i=()=>{r.dispose(),e.removeEventListener("abort",i),t(void 0)};e.addEventListener("abort",i)}):new Promise(t=>(0,ll.once)(n,t))}ll.toPromise=DZ;var _Z=(n,e)=>{let t=n(r=>{e(r),t.dispose()});return t};ll.once=_Z;var jA=class{constructor(){this.event=(e,t,r)=>{let i=this.add(t?e.bind(t):e);return r?.push(i),i}}get size(){return this.listeners?typeof this.listeners=="function"?1:this.listeners.length:0}fire(e){if(this.listeners)if(typeof this.listeners=="function")this.listeners(e);else for(let t of this.listeners)t(e)}dispose(){this.listeners=void 0}add(e){return this.listeners?typeof this.listeners=="function"?this.listeners=[this.listeners,e]:this.listeners.push(e):this.listeners=e,{dispose:()=>this.rm(e)}}rm(e){if(!this.listeners)return;if(typeof this.listeners=="function"){this.listeners===e&&(this.listeners=void 0);return}let t=this.listeners.indexOf(e);t!==-1&&(this.listeners.length===2?this.listeners=t===0?this.listeners[1]:this.listeners[0]:this.listeners=this.listeners.slice(0,t).concat(this.listeners.slice(t+1)))}};ll.EventEmitter=jA});var Cn=F(Yt=>{"use strict";Object.defineProperty(Yt,"__esModule",{value:!0});Yt.NON_CUSTOM_TAG_KEYS=Yt.PRE_DESTROY=Yt.POST_CONSTRUCT=Yt.DESIGN_PARAM_TYPES=Yt.PARAM_TYPES=Yt.TAGGED_PROP=Yt.TAGGED=Yt.MULTI_INJECT_TAG=Yt.INJECT_TAG=Yt.OPTIONAL_TAG=Yt.UNMANAGED_TAG=Yt.NAME_TAG=Yt.NAMED_TAG=void 0;Yt.NAMED_TAG="named";Yt.NAME_TAG="name";Yt.UNMANAGED_TAG="unmanaged";Yt.OPTIONAL_TAG="optional";Yt.INJECT_TAG="inject";Yt.MULTI_INJECT_TAG="multi_inject";Yt.TAGGED="inversify:tagged";Yt.TAGGED_PROP="inversify:tagged_props";Yt.PARAM_TYPES="inversify:paramtypes";Yt.DESIGN_PARAM_TYPES="design:paramtypes";Yt.POST_CONSTRUCT="post_construct";Yt.PRE_DESTROY="pre_destroy";function TZ(){return[Yt.INJECT_TAG,Yt.MULTI_INJECT_TAG,Yt.NAME_TAG,Yt.UNMANAGED_TAG,Yt.NAMED_TAG,Yt.OPTIONAL_TAG]}Yt.NON_CUSTOM_TAG_KEYS=TZ()});var ma=F(hd=>{"use strict";Object.defineProperty(hd,"__esModule",{value:!0});hd.TargetTypeEnum=hd.BindingTypeEnum=hd.BindingScopeEnum=void 0;var RZ={Request:"Request",Singleton:"Singleton",Transient:"Transient"};hd.BindingScopeEnum=RZ;var AZ={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};hd.BindingTypeEnum=AZ;var NZ={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};hd.TargetTypeEnum=NZ});var gd=F(VP=>{"use strict";Object.defineProperty(VP,"__esModule",{value:!0});VP.id=void 0;var MZ=0;function KZ(){return MZ++}VP.id=KZ});var aV=F(jP=>{"use strict";Object.defineProperty(jP,"__esModule",{value:!0});jP.Binding=void 0;var sV=ma(),OZ=gd(),FZ=function(){function n(e,t){this.id=(0,OZ.id)(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=sV.BindingTypeEnum.Invalid,this.constraint=function(r){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.onDeactivation=null,this.dynamicValue=null}return n.prototype.clone=function(){var e=new n(this.serviceIdentifier,this.scope);return e.activated=e.scope===sV.BindingScopeEnum.Singleton?this.activated:!1,e.implementationType=this.implementationType,e.dynamicValue=this.dynamicValue,e.scope=this.scope,e.type=this.type,e.factory=this.factory,e.provider=this.provider,e.constraint=this.constraint,e.onActivation=this.onActivation,e.onDeactivation=this.onDeactivation,e.cache=this.cache,e},n}();jP.Binding=FZ});var xi=F(Ke=>{"use strict";Object.defineProperty(Ke,"__esModule",{value:!0});Ke.STACK_OVERFLOW=Ke.CIRCULAR_DEPENDENCY_IN_FACTORY=Ke.ON_DEACTIVATION_ERROR=Ke.PRE_DESTROY_ERROR=Ke.POST_CONSTRUCT_ERROR=Ke.ASYNC_UNBIND_REQUIRED=Ke.MULTIPLE_POST_CONSTRUCT_METHODS=Ke.MULTIPLE_PRE_DESTROY_METHODS=Ke.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=Ke.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=Ke.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=Ke.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=Ke.ARGUMENTS_LENGTH_MISMATCH=Ke.INVALID_DECORATOR_OPERATION=Ke.INVALID_TO_SELF_VALUE=Ke.LAZY_IN_SYNC=Ke.INVALID_FUNCTION_BINDING=Ke.INVALID_MIDDLEWARE_RETURN=Ke.NO_MORE_SNAPSHOTS_AVAILABLE=Ke.INVALID_BINDING_TYPE=Ke.NOT_IMPLEMENTED=Ke.CIRCULAR_DEPENDENCY=Ke.UNDEFINED_INJECT_ANNOTATION=Ke.MISSING_INJECT_ANNOTATION=Ke.MISSING_INJECTABLE_ANNOTATION=Ke.NOT_REGISTERED=Ke.CANNOT_UNBIND=Ke.AMBIGUOUS_MATCH=Ke.KEY_NOT_FOUND=Ke.NULL_ARGUMENT=Ke.DUPLICATED_METADATA=Ke.DUPLICATED_INJECTABLE_DECORATOR=void 0;Ke.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.";Ke.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:";Ke.NULL_ARGUMENT="NULL argument";Ke.KEY_NOT_FOUND="Key Not Found";Ke.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:";Ke.CANNOT_UNBIND="Could not unbind serviceIdentifier:";Ke.NOT_REGISTERED="No matching bindings found for serviceIdentifier:";Ke.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:";Ke.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var LZ=function(n){return"@inject called with undefined this could mean that the class "+n+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};Ke.UNDEFINED_INJECT_ANNOTATION=LZ;Ke.CIRCULAR_DEPENDENCY="Circular dependency found:";Ke.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.";Ke.INVALID_BINDING_TYPE="Invalid binding type:";Ke.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.";Ke.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!";Ke.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!";var UZ=function(n){return"You are attempting to construct '"+n+`' in a synchronous way
 but it has asynchronous dependencies.`};Ke.LAZY_IN_SYNC=UZ;Ke.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier";Ke.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var WZ=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return"The number of constructor arguments in the derived class "+(n[0]+" must be >= than the number of constructor arguments of its base class.")};Ke.ARGUMENTS_LENGTH_MISMATCH=WZ;Ke.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.";Ke.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').";Ke.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean";Ke.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean";Ke.MULTIPLE_PRE_DESTROY_METHODS="Cannot apply @preDestroy decorator multiple times in the same class";Ke.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";Ke.ASYNC_UNBIND_REQUIRED="Attempting to unbind dependency with asynchronous destruction (@preDestroy or onDeactivation)";var VZ=function(n,e){return"@postConstruct error in class "+n+": "+e};Ke.POST_CONSTRUCT_ERROR=VZ;var jZ=function(n,e){return"@preDestroy error in class "+n+": "+e};Ke.PRE_DESTROY_ERROR=jZ;var BZ=function(n,e){return"onDeactivation() error in class "+n+": "+e};Ke.ON_DEACTIVATION_ERROR=BZ;var $Z=function(n,e){return"It looks like there is a circular dependency in one of the '"+n+"' bindings. Please investigate bindings with"+("service identifier '"+e+"'.")};Ke.CIRCULAR_DEPENDENCY_IN_FACTORY=$Z;Ke.STACK_OVERFLOW="Maximum call stack size exceeded"});var HA=F(cl=>{"use strict";var JZ=cl&&cl.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),qZ=cl&&cl.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),HZ=cl&&cl.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&JZ(e,n,t);return qZ(e,n),e};Object.defineProperty(cl,"__esModule",{value:!0});cl.MetadataReader=void 0;var qA=HZ(Cn()),GZ=function(){function n(){}return n.prototype.getConstructorMetadata=function(e){var t=Reflect.getMetadata(qA.PARAM_TYPES,e),r=Reflect.getMetadata(qA.TAGGED,e);return{compilerGeneratedMetadata:t,userGeneratedMetadata:r||{}}},n.prototype.getPropertiesMetadata=function(e){var t=Reflect.getMetadata(qA.TAGGED_PROP,e)||[];return t},n}();cl.MetadataReader=GZ});var lV=F(BP=>{"use strict";Object.defineProperty(BP,"__esModule",{value:!0});BP.BindingCount=void 0;var zZ={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};BP.BindingCount=zZ});var GA=F(Cs=>{"use strict";var QZ=Cs&&Cs.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),YZ=Cs&&Cs.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),XZ=Cs&&Cs.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&QZ(e,n,t);return YZ(e,n),e};Object.defineProperty(Cs,"__esModule",{value:!0});Cs.tryAndThrowErrorIfStackOverflow=Cs.isStackOverflowExeption=void 0;var ZZ=XZ(xi());function cV(n){return n instanceof RangeError||n.message===ZZ.STACK_OVERFLOW}Cs.isStackOverflowExeption=cV;var eee=function(n,e){try{return n()}catch(t){throw cV(t)&&(t=e()),t}};Cs.tryAndThrowErrorIfStackOverflow=eee});var Vh=F(En=>{"use strict";var tee=En&&En.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),ree=En&&En.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),nee=En&&En.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&tee(e,n,t);return ree(e,n),e};Object.defineProperty(En,"__esModule",{value:!0});En.getSymbolDescription=En.circularDependencyToException=En.listMetadataForTarget=En.listRegisteredBindingsForServiceIdentifier=En.getServiceIdentifierAsString=En.getFunctionName=void 0;var iee=nee(xi());function uV(n){if(typeof n=="function"){var e=n;return e.name}else{if(typeof n=="symbol")return n.toString();var e=n;return e}}En.getServiceIdentifierAsString=uV;function oee(n,e,t){var r="",i=t(n,e);return i.length!==0&&(r=`
Registered bindings:`,i.forEach(function(o){var s="Object";o.implementationType!==null&&(s=mV(o.implementationType)),r=r+`
 `+s,o.constraint.metaData&&(r=r+" - "+o.constraint.metaData)})),r}En.listRegisteredBindingsForServiceIdentifier=oee;function dV(n,e){return n.parentRequest===null?!1:n.parentRequest.serviceIdentifier===e?!0:dV(n.parentRequest,e)}function see(n){function e(r,i){i===void 0&&(i=[]);var o=uV(r.serviceIdentifier);return i.push(o),r.parentRequest!==null?e(r.parentRequest,i):i}var t=e(n);return t.reverse().join(" --> ")}function pV(n){n.childRequests.forEach(function(e){if(dV(e,e.serviceIdentifier)){var t=see(e);throw new Error(iee.CIRCULAR_DEPENDENCY+" "+t)}else pV(e)})}En.circularDependencyToException=pV;function aee(n,e){if(e.isTagged()||e.isNamed()){var t="",r=e.getNamedTag(),i=e.getCustomTags();return r!==null&&(t+=r.toString()+`
`),i!==null&&i.forEach(function(o){t+=o.toString()+`
`})," "+n+`
 `+n+" - "+t}else return" "+n}En.listMetadataForTarget=aee;function mV(n){if(n.name)return n.name;var e=n.toString(),t=e.match(/^function\s*([^\s(]+)/);return t?t[1]:"Anonymous function: "+e}En.getFunctionName=mV;function lee(n){return n.toString().slice(7,-1)}En.getSymbolDescription=lee});var fV=F($P=>{"use strict";Object.defineProperty($P,"__esModule",{value:!0});$P.Context=void 0;var cee=gd(),uee=function(){function n(e){this.id=(0,cee.id)(),this.container=e}return n.prototype.addPlan=function(e){this.plan=e},n.prototype.setCurrentRequest=function(e){this.currentRequest=e},n}();$P.Context=uee});var fa=F(ul=>{"use strict";var dee=ul&&ul.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),pee=ul&&ul.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),mee=ul&&ul.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&dee(e,n,t);return pee(e,n),e};Object.defineProperty(ul,"__esModule",{value:!0});ul.Metadata=void 0;var fee=mee(Cn()),hee=function(){function n(e,t){this.key=e,this.value=t}return n.prototype.toString=function(){return this.key===fee.NAMED_TAG?"named: "+String(this.value).toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+String(this.value)+" }"},n}();ul.Metadata=hee});var hV=F(JP=>{"use strict";Object.defineProperty(JP,"__esModule",{value:!0});JP.Plan=void 0;var gee=function(){function n(e,t){this.parentContext=e,this.rootRequest=t}return n}();JP.Plan=gee});var zA=F(qP=>{"use strict";Object.defineProperty(qP,"__esModule",{value:!0});qP.LazyServiceIdentifer=void 0;var vee=function(){function n(e){this._cb=e}return n.prototype.unwrap=function(){return this._cb()},n}();qP.LazyServiceIdentifer=vee});var gV=F(HP=>{"use strict";Object.defineProperty(HP,"__esModule",{value:!0});HP.QueryableString=void 0;var yee=function(){function n(e){this.str=e}return n.prototype.startsWith=function(e){return this.str.indexOf(e)===0},n.prototype.endsWith=function(e){var t="",r=e.split("").reverse().join("");return t=this.str.split("").reverse().join(""),this.startsWith.call({str:t},r)},n.prototype.contains=function(e){return this.str.indexOf(e)!==-1},n.prototype.equals=function(e){return this.str===e},n.prototype.value=function(){return this.str},n}();HP.QueryableString=yee});var QA=F(dl=>{"use strict";var bee=dl&&dl.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),Iee=dl&&dl.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),See=dl&&dl.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&bee(e,n,t);return Iee(e,n),e};Object.defineProperty(dl,"__esModule",{value:!0});dl.Target=void 0;var Oc=See(Cn()),Cee=gd(),Eee=Vh(),vV=fa(),wee=gV(),Pee=function(){function n(e,t,r,i){this.id=(0,Cee.id)(),this.type=e,this.serviceIdentifier=r;var o=typeof t=="symbol"?(0,Eee.getSymbolDescription)(t):t;this.name=new wee.QueryableString(o||""),this.identifier=t,this.metadata=new Array;var s=null;typeof i=="string"?s=new vV.Metadata(Oc.NAMED_TAG,i):i instanceof vV.Metadata&&(s=i),s!==null&&this.metadata.push(s)}return n.prototype.hasTag=function(e){for(var t=0,r=this.metadata;t<r.length;t++){var i=r[t];if(i.key===e)return!0}return!1},n.prototype.isArray=function(){return this.hasTag(Oc.MULTI_INJECT_TAG)},n.prototype.matchesArray=function(e){return this.matchesTag(Oc.MULTI_INJECT_TAG)(e)},n.prototype.isNamed=function(){return this.hasTag(Oc.NAMED_TAG)},n.prototype.isTagged=function(){return this.metadata.some(function(e){return Oc.NON_CUSTOM_TAG_KEYS.every(function(t){return e.key!==t})})},n.prototype.isOptional=function(){return this.matchesTag(Oc.OPTIONAL_TAG)(!0)},n.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(e){return e.key===Oc.NAMED_TAG})[0]:null},n.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(e){return Oc.NON_CUSTOM_TAG_KEYS.every(function(t){return e.key!==t})}):null},n.prototype.matchesNamedTag=function(e){return this.matchesTag(Oc.NAMED_TAG)(e)},n.prototype.matchesTag=function(e){var t=this;return function(r){for(var i=0,o=t.metadata;i<o.length;i++){var s=o[i];if(s.key===e&&s.value===r)return!0}return!1}},n}();dl.Target=Pee});var PV=F(Di=>{"use strict";var kee=Di&&Di.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),xee=Di&&Di.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),yV=Di&&Di.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&kee(e,n,t);return xee(e,n),e},GP=Di&&Di.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(Di,"__esModule",{value:!0});Di.getFunctionName=Di.getBaseClassDependencyCount=Di.getDependencies=void 0;var Dee=zA(),YA=yV(xi()),bV=ma(),wC=yV(Cn()),XA=Vh();Object.defineProperty(Di,"getFunctionName",{enumerable:!0,get:function(){return XA.getFunctionName}});var IV=QA();function _ee(n,e){var t=(0,XA.getFunctionName)(e);return SV(n,t,e,!1)}Di.getDependencies=_ee;function SV(n,e,t,r){var i=n.getConstructorMetadata(t),o=i.compilerGeneratedMetadata;if(o===void 0){var s=YA.MISSING_INJECTABLE_ANNOTATION+" "+e+".";throw new Error(s)}var a=i.userGeneratedMetadata,l=Object.keys(a),c=t.length===0&&l.length>0,u=l.length>t.length,d=c||u?l.length:t.length,f=Ree(r,e,o,a,d),g=CV(n,t,e),b=GP(GP([],f,!0),g,!0);return b}function Tee(n,e,t,r,i){var o=i[n.toString()]||[],s=wV(o),a=s.unmanaged!==!0,l=r[n],c=s.inject||s.multiInject;if(l=c||l,l instanceof Dee.LazyServiceIdentifer&&(l=l.unwrap()),a){var u=l===Object,d=l===Function,f=l===void 0,g=u||d||f;if(!e&&g){var b=YA.MISSING_INJECT_ANNOTATION+" argument "+n+" in class "+t+".";throw new Error(b)}var I=new IV.Target(bV.TargetTypeEnum.ConstructorArgument,s.targetName,l);return I.metadata=o,I}return null}function Ree(n,e,t,r,i){for(var o=[],s=0;s<i;s++){var a=s,l=Tee(a,n,e,t,r);l!==null&&o.push(l)}return o}function Aee(n,e,t,r){var i=n||e;if(i===void 0){var o=YA.MISSING_INJECTABLE_ANNOTATION+" for property "+String(t)+" in class "+r+".";throw new Error(o)}return i}function CV(n,e,t){for(var r=n.getPropertiesMetadata(e),i=[],o=Object.getOwnPropertySymbols(r),s=Object.keys(r),a=s.concat(o),l=0,c=a;l<c.length;l++){var u=c[l],d=r[u],f=wV(d),g=f.targetName||u,b=Aee(f.inject,f.multiInject,u,t),I=new IV.Target(bV.TargetTypeEnum.ClassProperty,g,b);I.metadata=d,i.push(I)}var w=Object.getPrototypeOf(e.prototype).constructor;if(w!==Object){var _=CV(n,w,t);i=GP(GP([],i,!0),_,!0)}return i}function EV(n,e){var t=Object.getPrototypeOf(e.prototype).constructor;if(t!==Object){var r=(0,XA.getFunctionName)(t),i=SV(n,r,t,!0),o=i.map(function(l){return l.metadata.filter(function(c){return c.key===wC.UNMANAGED_TAG})}),s=[].concat.apply([],o).length,a=i.length-s;return a>0?a:EV(n,t)}else return 0}Di.getBaseClassDependencyCount=EV;function wV(n){var e={};return n.forEach(function(t){e[t.key.toString()]=t.value}),{inject:e[wC.INJECT_TAG],multiInject:e[wC.MULTI_INJECT_TAG],targetName:e[wC.NAME_TAG],unmanaged:e[wC.UNMANAGED_TAG]}}});var kV=F(zP=>{"use strict";Object.defineProperty(zP,"__esModule",{value:!0});zP.Request=void 0;var Nee=gd(),Mee=function(){function n(e,t,r,i,o){this.id=(0,Nee.id)(),this.serviceIdentifier=e,this.parentContext=t,this.parentRequest=r,this.target=o,this.childRequests=[],this.bindings=Array.isArray(i)?i:[i],this.requestScope=r===null?new Map:null}return n.prototype.addChildRequest=function(e,t,r){var i=new n(e,this.parentContext,this,t,r);return this.childRequests.push(i),i},n}();zP.Request=Mee});var nN=F(co=>{"use strict";var Kee=co&&co.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),Oee=co&&co.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),_V=co&&co.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&Kee(e,n,t);return Oee(e,n),e};Object.defineProperty(co,"__esModule",{value:!0});co.getBindingDictionary=co.createMockRequest=co.plan=void 0;var QP=lV(),eN=_V(xi()),TV=ma(),xV=_V(Cn()),Fee=GA(),jh=Vh(),RV=fV(),tN=fa(),Lee=hV(),ZA=PV(),rN=kV(),AV=QA();function NV(n){return n._bindingDictionary}co.getBindingDictionary=NV;function Uee(n,e,t,r,i,o){var s=n?xV.MULTI_INJECT_TAG:xV.INJECT_TAG,a=new tN.Metadata(s,t),l=new AV.Target(e,r,t,a);if(i!==void 0){var c=new tN.Metadata(i,o);l.metadata.push(c)}return l}function DV(n,e,t,r,i){var o=PC(t.container,i.serviceIdentifier),s=[];return o.length===QP.BindingCount.NoBindingsAvailable&&t.container.options.autoBindInjectable&&typeof i.serviceIdentifier=="function"&&n.getConstructorMetadata(i.serviceIdentifier).compilerGeneratedMetadata&&(t.container.bind(i.serviceIdentifier).toSelf(),o=PC(t.container,i.serviceIdentifier)),e?s=o:s=o.filter(function(a){var l=new rN.Request(a.serviceIdentifier,t,r,a,i);return a.constraint(l)}),Wee(i.serviceIdentifier,s,i,t.container),s}function Wee(n,e,t,r){switch(e.length){case QP.BindingCount.NoBindingsAvailable:if(t.isOptional())return e;var i=(0,jh.getServiceIdentifierAsString)(n),o=eN.NOT_REGISTERED;throw o+=(0,jh.listMetadataForTarget)(i,t),o+=(0,jh.listRegisteredBindingsForServiceIdentifier)(r,i,PC),new Error(o);case QP.BindingCount.OnlyOneBindingAvailable:return e;case QP.BindingCount.MultipleBindingsAvailable:default:if(t.isArray())return e;var i=(0,jh.getServiceIdentifierAsString)(n),o=eN.AMBIGUOUS_MATCH+" "+i;throw o+=(0,jh.listRegisteredBindingsForServiceIdentifier)(r,i,PC),new Error(o)}}function MV(n,e,t,r,i,o){var s,a;if(i===null){s=DV(n,e,r,null,o),a=new rN.Request(t,r,null,s,o);var l=new Lee.Plan(r,a);r.addPlan(l)}else s=DV(n,e,r,i,o),a=i.addChildRequest(o.serviceIdentifier,s,o);s.forEach(function(c){var u=null;if(o.isArray())u=a.addChildRequest(c.serviceIdentifier,c,o);else{if(c.cache)return;u=a}if(c.type===TV.BindingTypeEnum.Instance&&c.implementationType!==null){var d=(0,ZA.getDependencies)(n,c.implementationType);if(!r.container.options.skipBaseClassChecks){var f=(0,ZA.getBaseClassDependencyCount)(n,c.implementationType);if(d.length<f){var g=eN.ARGUMENTS_LENGTH_MISMATCH((0,ZA.getFunctionName)(c.implementationType));throw new Error(g)}}d.forEach(function(b){MV(n,!1,b.serviceIdentifier,r,u,b)})}})}function PC(n,e){var t=[],r=NV(n);return r.hasKey(e)?t=r.get(e):n.parent!==null&&(t=PC(n.parent,e)),t}function Vee(n,e,t,r,i,o,s,a){a===void 0&&(a=!1);var l=new RV.Context(e),c=Uee(t,r,i,"",o,s);try{return MV(n,a,i,l,null,c),l}catch(u){throw(0,Fee.isStackOverflowExeption)(u)&&(0,jh.circularDependencyToException)(l.plan.rootRequest),u}}co.plan=Vee;function jee(n,e,t,r){var i=new AV.Target(TV.TargetTypeEnum.Variable,"",e,new tN.Metadata(t,r)),o=new RV.Context(n),s=new rN.Request(e,o,null,[],i);return s}co.createMockRequest=jee});var kC=F(Bh=>{"use strict";Object.defineProperty(Bh,"__esModule",{value:!0});Bh.isPromiseOrContainsPromise=Bh.isPromise=void 0;function iN(n){var e=typeof n=="object"&&n!==null||typeof n=="function";return e&&typeof n.then=="function"}Bh.isPromise=iN;function Bee(n){return iN(n)?!0:Array.isArray(n)&&n.some(iN)}Bh.isPromiseOrContainsPromise=Bee});var KV=F(pl=>{"use strict";var $ee=pl&&pl.__awaiter||function(n,e,t,r){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})},Jee=pl&&pl.__generator||function(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,i=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){t.label=c[1];break}if(c[0]===6&&t.label<o[1]){t.label=o[1],o=c;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(c);break}o[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(u){c=[6,u],i=0}finally{r=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}};Object.defineProperty(pl,"__esModule",{value:!0});pl.saveToScope=pl.tryGetFromScope=void 0;var YP=N(),qee=kC(),Hee=function(n,e){return e.scope===YP.BindingScopeEnum.Singleton&&e.activated?e.cache:e.scope===YP.BindingScopeEnum.Request&&n.has(e.id)?n.get(e.id):null};pl.tryGetFromScope=Hee;var Gee=function(n,e,t){e.scope===YP.BindingScopeEnum.Singleton&&Qee(e,t),e.scope===YP.BindingScopeEnum.Request&&zee(n,e,t)};pl.saveToScope=Gee;var zee=function(n,e,t){n.has(e.id)||n.set(e.id,t)},Qee=function(n,e){n.cache=e,n.activated=!0,(0,qee.isPromise)(e)&&Yee(n,e)},Yee=function(n,e){return $ee(void 0,void 0,void 0,function(){var t,r;return Jee(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,e];case 1:return t=i.sent(),n.cache=t,[3,3];case 2:throw r=i.sent(),n.cache=null,n.activated=!1,r;case 3:return[2]}})})}});var OV=F(xC=>{"use strict";Object.defineProperty(xC,"__esModule",{value:!0});xC.FactoryType=void 0;var Xee;(function(n){n.DynamicValue="toDynamicValue",n.Factory="toFactory",n.Provider="toProvider"})(Xee=xC.FactoryType||(xC.FactoryType={}))});var sN=F(uo=>{"use strict";var Zee=uo&&uo.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),ete=uo&&uo.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),tte=uo&&uo.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&Zee(e,n,t);return ete(e,n),e};Object.defineProperty(uo,"__esModule",{value:!0});uo.getFactoryDetails=uo.ensureFullyBound=uo.multiBindToService=void 0;var rte=N(),nte=tte(xi()),ml=ma(),oN=OV(),ite=function(n){return function(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return t.forEach(function(i){return n.bind(i).toService(e)})}}};uo.multiBindToService=ite;var ote=function(n){var e=null;switch(n.type){case ml.BindingTypeEnum.ConstantValue:case ml.BindingTypeEnum.Function:e=n.cache;break;case ml.BindingTypeEnum.Constructor:case ml.BindingTypeEnum.Instance:e=n.implementationType;break;case ml.BindingTypeEnum.DynamicValue:e=n.dynamicValue;break;case ml.BindingTypeEnum.Provider:e=n.provider;break;case ml.BindingTypeEnum.Factory:e=n.factory;break}if(e===null){var t=(0,rte.getServiceIdentifierAsString)(n.serviceIdentifier);throw new Error(nte.INVALID_BINDING_TYPE+" "+t)}};uo.ensureFullyBound=ote;var ste=function(n){switch(n.type){case ml.BindingTypeEnum.Factory:return{factory:n.factory,factoryType:oN.FactoryType.Factory};case ml.BindingTypeEnum.Provider:return{factory:n.provider,factoryType:oN.FactoryType.Provider};case ml.BindingTypeEnum.DynamicValue:return{factory:n.dynamicValue,factoryType:oN.FactoryType.DynamicValue};default:throw new Error("Unexpected factory type "+n.type)}};uo.getFactoryDetails=ste});var jV=F(Xn=>{"use strict";var $h=Xn&&Xn.__assign||function(){return $h=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},$h.apply(this,arguments)},ate=Xn&&Xn.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),lte=Xn&&Xn.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),cte=Xn&&Xn.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&ate(e,n,t);return lte(e,n),e},UV=Xn&&Xn.__awaiter||function(n,e,t,r){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})},WV=Xn&&Xn.__generator||function(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,i=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){t.label=c[1];break}if(c[0]===6&&t.label<o[1]){t.label=o[1],o=c;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(c);break}o[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(u){c=[6,u],i=0}finally{r=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},ute=Xn&&Xn.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(Xn,"__esModule",{value:!0});Xn.resolveInstance=void 0;var aN=xi(),cN=ma(),lN=cte(Cn()),uN=kC();function dte(n,e){return n.reduce(function(t,r){var i=e(r),o=r.target.type;return o===cN.TargetTypeEnum.ConstructorArgument?t.constructorInjections.push(i):(t.propertyRequests.push(r),t.propertyInjections.push(i)),t.isAsync||(t.isAsync=(0,uN.isPromiseOrContainsPromise)(i)),t},{constructorInjections:[],propertyInjections:[],propertyRequests:[],isAsync:!1})}function pte(n,e,t){var r;if(e.length>0){var i=dte(e,t),o=$h($h({},i),{constr:n});i.isAsync?r=mte(o):r=VV(o)}else r=new n;return r}function VV(n){var e,t=new((e=n.constr).bind.apply(e,ute([void 0],n.constructorInjections,!1)));return n.propertyRequests.forEach(function(r,i){var o=r.target.identifier,s=n.propertyInjections[i];t[o]=s}),t}function mte(n){return UV(this,void 0,void 0,function(){var e,t;return WV(this,function(r){switch(r.label){case 0:return[4,FV(n.constructorInjections)];case 1:return e=r.sent(),[4,FV(n.propertyInjections)];case 2:return t=r.sent(),[2,VV($h($h({},n),{constructorInjections:e,propertyInjections:t}))]}})})}function FV(n){return UV(this,void 0,void 0,function(){var e,t,r,i;return WV(this,function(o){for(e=[],t=0,r=n;t<r.length;t++)i=r[t],Array.isArray(i)?e.push(Promise.all(i)):e.push(i);return[2,Promise.all(e)]})})}function LV(n,e){var t=fte(n,e);return(0,uN.isPromise)(t)?t.then(function(){return e}):e}function fte(n,e){var t,r;if(Reflect.hasMetadata(lN.POST_CONSTRUCT,n)){var i=Reflect.getMetadata(lN.POST_CONSTRUCT,n);try{return(r=(t=e)[i.value])===null||r===void 0?void 0:r.call(t)}catch(o){throw new Error((0,aN.POST_CONSTRUCT_ERROR)(n.name,o.message))}}}function hte(n,e){n.scope!==cN.BindingScopeEnum.Singleton&&gte(n,e)}function gte(n,e){var t="Class cannot be instantiated in "+(n.scope===cN.BindingScopeEnum.Request?"request":"transient")+" scope.";if(typeof n.onDeactivation=="function")throw new Error((0,aN.ON_DEACTIVATION_ERROR)(e.name,t));if(Reflect.hasMetadata(lN.PRE_DESTROY,e))throw new Error((0,aN.PRE_DESTROY_ERROR)(e.name,t))}function vte(n,e,t,r){hte(n,e);var i=pte(e,t,r);return(0,uN.isPromise)(i)?i.then(function(o){return LV(e,o)}):LV(e,i)}Xn.resolveInstance=vte});var HV=F(po=>{"use strict";var yte=po&&po.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),bte=po&&po.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),Ite=po&&po.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&yte(e,n,t);return bte(e,n),e},Ste=po&&po.__awaiter||function(n,e,t,r){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})},Cte=po&&po.__generator||function(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,i=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){t.label=c[1];break}if(c[0]===6&&t.label<o[1]){t.label=o[1],o=c;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(c);break}o[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(u){c=[6,u],i=0}finally{r=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}};Object.defineProperty(po,"__esModule",{value:!0});po.resolve=void 0;var Ete=Ite(xi()),XP=ma(),wte=nN(),BV=KV(),dN=kC(),JV=sN(),Pte=GA(),kte=jV(),pN=function(n){return function(e){e.parentContext.setCurrentRequest(e);var t=e.bindings,r=e.childRequests,i=e.target&&e.target.isArray(),o=!e.parentRequest||!e.parentRequest.target||!e.target||!e.parentRequest.target.matchesArray(e.target.serviceIdentifier);if(i&&o)return r.map(function(a){var l=pN(n);return l(a)});if(e.target.isOptional()&&t.length===0)return;var s=t[0];return Tte(n,e,s)}},xte=function(n,e){var t=(0,JV.getFactoryDetails)(n);return(0,Pte.tryAndThrowErrorIfStackOverflow)(function(){return t.factory.bind(n)(e)},function(){return new Error(Ete.CIRCULAR_DEPENDENCY_IN_FACTORY(t.factoryType,e.currentRequest.serviceIdentifier.toString()))})},Dte=function(n,e,t){var r,i=e.childRequests;switch((0,JV.ensureFullyBound)(t),t.type){case XP.BindingTypeEnum.ConstantValue:case XP.BindingTypeEnum.Function:r=t.cache;break;case XP.BindingTypeEnum.Constructor:r=t.implementationType;break;case XP.BindingTypeEnum.Instance:r=(0,kte.resolveInstance)(t,t.implementationType,i,pN(n));break;default:r=xte(t,e.parentContext)}return r},_te=function(n,e,t){var r=(0,BV.tryGetFromScope)(n,e);return r!==null||(r=t(),(0,BV.saveToScope)(n,e,r)),r},Tte=function(n,e,t){return _te(n,t,function(){var r=Dte(n,e,t);return(0,dN.isPromise)(r)?r=r.then(function(i){return $V(e,t,i)}):r=$V(e,t,r),r})};function $V(n,e,t){var r=Rte(n.parentContext,e,t),i=Mte(n.parentContext.container),o,s=i.next();do{o=s.value;var a=n.parentContext,l=n.serviceIdentifier,c=Nte(o,l);(0,dN.isPromise)(r)?r=qV(c,a,r):r=Ate(c,a,r),s=i.next()}while(s.done!==!0&&!(0,wte.getBindingDictionary)(o).hasKey(n.serviceIdentifier));return r}var Rte=function(n,e,t){var r;return typeof e.onActivation=="function"?r=e.onActivation(n,t):r=t,r},Ate=function(n,e,t){for(var r=n.next();!r.done;){if(t=r.value(e,t),(0,dN.isPromise)(t))return qV(n,e,t);r=n.next()}return t},qV=function(n,e,t){return Ste(void 0,void 0,void 0,function(){var r,i;return Cte(this,function(o){switch(o.label){case 0:return[4,t];case 1:r=o.sent(),i=n.next(),o.label=2;case 2:return i.done?[3,4]:[4,i.value(e,r)];case 3:return r=o.sent(),i=n.next(),[3,2];case 4:return[2,r]}})})},Nte=function(n,e){var t=n._activations;return t.hasKey(e)?t.get(e).values():[].values()},Mte=function(n){for(var e=[n],t=n.parent;t!==null;)e.push(t),t=t.parent;var r=function(){var o=e.pop();return o!==void 0?{done:!1,value:o}:{done:!0,value:void 0}},i={next:r};return i};function Kte(n){var e=pN(n.plan.rootRequest.requestScope);return e(n.plan.rootRequest)}po.resolve=Kte});var mN=F(_i=>{"use strict";var Ote=_i&&_i.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),Fte=_i&&_i.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),Lte=_i&&_i.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&Ote(e,n,t);return Fte(e,n),e};Object.defineProperty(_i,"__esModule",{value:!0});_i.typeConstraint=_i.namedConstraint=_i.taggedConstraint=_i.traverseAncerstors=void 0;var Ute=Lte(Cn()),Wte=fa(),GV=function(n,e){var t=n.parentRequest;return t!==null?e(t)?!0:GV(t,e):!1};_i.traverseAncerstors=GV;var zV=function(n){return function(e){var t=function(r){return r!==null&&r.target!==null&&r.target.matchesTag(n)(e)};return t.metaData=new Wte.Metadata(n,e),t}};_i.taggedConstraint=zV;var Vte=zV(Ute.NAMED_TAG);_i.namedConstraint=Vte;var jte=function(n){return function(e){var t=null;if(e!==null)if(t=e.bindings[0],typeof n=="string"){var r=t.serviceIdentifier;return r===n}else{var i=e.bindings[0].implementationType;return n===i}return!1}};_i.typeConstraint=jte});var ek=F(ZP=>{"use strict";Object.defineProperty(ZP,"__esModule",{value:!0});ZP.BindingWhenSyntax=void 0;var Yi=tk(),Mn=mN(),Bte=function(){function n(e){this._binding=e}return n.prototype.when=function(e){return this._binding.constraint=e,new Yi.BindingOnSyntax(this._binding)},n.prototype.whenTargetNamed=function(e){return this._binding.constraint=(0,Mn.namedConstraint)(e),new Yi.BindingOnSyntax(this._binding)},n.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(e){if(e===null)return!1;var t=e.target!==null&&!e.target.isNamed()&&!e.target.isTagged();return t},new Yi.BindingOnSyntax(this._binding)},n.prototype.whenTargetTagged=function(e,t){return this._binding.constraint=(0,Mn.taggedConstraint)(e)(t),new Yi.BindingOnSyntax(this._binding)},n.prototype.whenInjectedInto=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Mn.typeConstraint)(e)(t.parentRequest)},new Yi.BindingOnSyntax(this._binding)},n.prototype.whenParentNamed=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Mn.namedConstraint)(e)(t.parentRequest)},new Yi.BindingOnSyntax(this._binding)},n.prototype.whenParentTagged=function(e,t){return this._binding.constraint=function(r){return r!==null&&(0,Mn.taggedConstraint)(e)(t)(r.parentRequest)},new Yi.BindingOnSyntax(this._binding)},n.prototype.whenAnyAncestorIs=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Mn.traverseAncerstors)(t,(0,Mn.typeConstraint)(e))},new Yi.BindingOnSyntax(this._binding)},n.prototype.whenNoAncestorIs=function(e){return this._binding.constraint=function(t){return t!==null&&!(0,Mn.traverseAncerstors)(t,(0,Mn.typeConstraint)(e))},new Yi.BindingOnSyntax(this._binding)},n.prototype.whenAnyAncestorNamed=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Mn.traverseAncerstors)(t,(0,Mn.namedConstraint)(e))},new Yi.BindingOnSyntax(this._binding)},n.prototype.whenNoAncestorNamed=function(e){return this._binding.constraint=function(t){return t!==null&&!(0,Mn.traverseAncerstors)(t,(0,Mn.namedConstraint)(e))},new Yi.BindingOnSyntax(this._binding)},n.prototype.whenAnyAncestorTagged=function(e,t){return this._binding.constraint=function(r){return r!==null&&(0,Mn.traverseAncerstors)(r,(0,Mn.taggedConstraint)(e)(t))},new Yi.BindingOnSyntax(this._binding)},n.prototype.whenNoAncestorTagged=function(e,t){return this._binding.constraint=function(r){return r!==null&&!(0,Mn.traverseAncerstors)(r,(0,Mn.taggedConstraint)(e)(t))},new Yi.BindingOnSyntax(this._binding)},n.prototype.whenAnyAncestorMatches=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Mn.traverseAncerstors)(t,e)},new Yi.BindingOnSyntax(this._binding)},n.prototype.whenNoAncestorMatches=function(e){return this._binding.constraint=function(t){return t!==null&&!(0,Mn.traverseAncerstors)(t,e)},new Yi.BindingOnSyntax(this._binding)},n}();ZP.BindingWhenSyntax=Bte});var tk=F(rk=>{"use strict";Object.defineProperty(rk,"__esModule",{value:!0});rk.BindingOnSyntax=void 0;var QV=ek(),$te=function(){function n(e){this._binding=e}return n.prototype.onActivation=function(e){return this._binding.onActivation=e,new QV.BindingWhenSyntax(this._binding)},n.prototype.onDeactivation=function(e){return this._binding.onDeactivation=e,new QV.BindingWhenSyntax(this._binding)},n}();rk.BindingOnSyntax=$te});var fN=F(nk=>{"use strict";Object.defineProperty(nk,"__esModule",{value:!0});nk.BindingWhenOnSyntax=void 0;var Jte=tk(),qte=ek(),Hte=function(){function n(e){this._binding=e,this._bindingWhenSyntax=new qte.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new Jte.BindingOnSyntax(this._binding)}return n.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},n.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},n.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},n.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},n.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},n.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},n.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},n.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},n.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},n.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},n.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},n.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},n.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},n.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},n.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},n.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},n.prototype.onDeactivation=function(e){return this._bindingOnSyntax.onDeactivation(e)},n}();nk.BindingWhenOnSyntax=Hte});var YV=F(ik=>{"use strict";Object.defineProperty(ik,"__esModule",{value:!0});ik.BindingInSyntax=void 0;var hN=ma(),gN=fN(),Gte=function(){function n(e){this._binding=e}return n.prototype.inRequestScope=function(){return this._binding.scope=hN.BindingScopeEnum.Request,new gN.BindingWhenOnSyntax(this._binding)},n.prototype.inSingletonScope=function(){return this._binding.scope=hN.BindingScopeEnum.Singleton,new gN.BindingWhenOnSyntax(this._binding)},n.prototype.inTransientScope=function(){return this._binding.scope=hN.BindingScopeEnum.Transient,new gN.BindingWhenOnSyntax(this._binding)},n}();ik.BindingInSyntax=Gte});var XV=F(ok=>{"use strict";Object.defineProperty(ok,"__esModule",{value:!0});ok.BindingInWhenOnSyntax=void 0;var zte=YV(),Qte=tk(),Yte=ek(),Xte=function(){function n(e){this._binding=e,this._bindingWhenSyntax=new Yte.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new Qte.BindingOnSyntax(this._binding),this._bindingInSyntax=new zte.BindingInSyntax(e)}return n.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},n.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},n.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},n.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},n.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},n.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},n.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},n.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},n.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},n.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},n.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},n.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},n.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},n.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},n.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},n.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},n.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},n.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},n.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},n.prototype.onDeactivation=function(e){return this._bindingOnSyntax.onDeactivation(e)},n}();ok.BindingInWhenOnSyntax=Xte});var t2=F(fl=>{"use strict";var Zte=fl&&fl.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),ere=fl&&fl.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),tre=fl&&fl.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&Zte(e,n,t);return ere(e,n),e};Object.defineProperty(fl,"__esModule",{value:!0});fl.BindingToSyntax=void 0;var ZV=tre(xi()),Xi=ma(),e2=XV(),Jh=fN(),rre=function(){function n(e){this._binding=e}return n.prototype.to=function(e){return this._binding.type=Xi.BindingTypeEnum.Instance,this._binding.implementationType=e,new e2.BindingInWhenOnSyntax(this._binding)},n.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+ZV.INVALID_TO_SELF_VALUE);var e=this._binding.serviceIdentifier;return this.to(e)},n.prototype.toConstantValue=function(e){return this._binding.type=Xi.BindingTypeEnum.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=Xi.BindingScopeEnum.Singleton,new Jh.BindingWhenOnSyntax(this._binding)},n.prototype.toDynamicValue=function(e){return this._binding.type=Xi.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new e2.BindingInWhenOnSyntax(this._binding)},n.prototype.toConstructor=function(e){return this._binding.type=Xi.BindingTypeEnum.Constructor,this._binding.implementationType=e,this._binding.scope=Xi.BindingScopeEnum.Singleton,new Jh.BindingWhenOnSyntax(this._binding)},n.prototype.toFactory=function(e){return this._binding.type=Xi.BindingTypeEnum.Factory,this._binding.factory=e,this._binding.scope=Xi.BindingScopeEnum.Singleton,new Jh.BindingWhenOnSyntax(this._binding)},n.prototype.toFunction=function(e){if(typeof e!="function")throw new Error(ZV.INVALID_FUNCTION_BINDING);var t=this.toConstantValue(e);return this._binding.type=Xi.BindingTypeEnum.Function,this._binding.scope=Xi.BindingScopeEnum.Singleton,t},n.prototype.toAutoFactory=function(e){return this._binding.type=Xi.BindingTypeEnum.Factory,this._binding.factory=function(t){var r=function(){return t.container.get(e)};return r},this._binding.scope=Xi.BindingScopeEnum.Singleton,new Jh.BindingWhenOnSyntax(this._binding)},n.prototype.toAutoNamedFactory=function(e){return this._binding.type=Xi.BindingTypeEnum.Factory,this._binding.factory=function(t){return function(r){return t.container.getNamed(e,r)}},new Jh.BindingWhenOnSyntax(this._binding)},n.prototype.toProvider=function(e){return this._binding.type=Xi.BindingTypeEnum.Provider,this._binding.provider=e,this._binding.scope=Xi.BindingScopeEnum.Singleton,new Jh.BindingWhenOnSyntax(this._binding)},n.prototype.toService=function(e){this.toDynamicValue(function(t){return t.container.get(e)})},n}();fl.BindingToSyntax=rre});var r2=F(sk=>{"use strict";Object.defineProperty(sk,"__esModule",{value:!0});sk.ContainerSnapshot=void 0;var nre=function(){function n(){}return n.of=function(e,t,r,i,o){var s=new n;return s.bindings=e,s.middleware=t,s.deactivations=i,s.activations=r,s.moduleActivationStore=o,s},n}();sk.ContainerSnapshot=nre});var n2=F(ak=>{"use strict";Object.defineProperty(ak,"__esModule",{value:!0});ak.isClonable=void 0;function ire(n){return typeof n=="object"&&n!==null&&"clone"in n&&typeof n.clone=="function"}ak.isClonable=ire});var vN=F(hl=>{"use strict";var ore=hl&&hl.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),sre=hl&&hl.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),are=hl&&hl.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&ore(e,n,t);return sre(e,n),e};Object.defineProperty(hl,"__esModule",{value:!0});hl.Lookup=void 0;var vm=are(xi()),lre=n2(),cre=function(){function n(){this._map=new Map}return n.prototype.getMap=function(){return this._map},n.prototype.add=function(e,t){if(e==null)throw new Error(vm.NULL_ARGUMENT);if(t==null)throw new Error(vm.NULL_ARGUMENT);var r=this._map.get(e);r!==void 0?r.push(t):this._map.set(e,[t])},n.prototype.get=function(e){if(e==null)throw new Error(vm.NULL_ARGUMENT);var t=this._map.get(e);if(t!==void 0)return t;throw new Error(vm.KEY_NOT_FOUND)},n.prototype.remove=function(e){if(e==null)throw new Error(vm.NULL_ARGUMENT);if(!this._map.delete(e))throw new Error(vm.KEY_NOT_FOUND)},n.prototype.removeIntersection=function(e){var t=this;this.traverse(function(r,i){var o=e.hasKey(r)?e.get(r):void 0;if(o!==void 0){var s=i.filter(function(a){return!o.some(function(l){return a===l})});t._setValue(r,s)}})},n.prototype.removeByCondition=function(e){var t=this,r=[];return this._map.forEach(function(i,o){for(var s=[],a=0,l=i;a<l.length;a++){var c=l[a],u=e(c);u?r.push(c):s.push(c)}t._setValue(o,s)}),r},n.prototype.hasKey=function(e){if(e==null)throw new Error(vm.NULL_ARGUMENT);return this._map.has(e)},n.prototype.clone=function(){var e=new n;return this._map.forEach(function(t,r){t.forEach(function(i){return e.add(r,(0,lre.isClonable)(i)?i.clone():i)})}),e},n.prototype.traverse=function(e){this._map.forEach(function(t,r){e(r,t)})},n.prototype._setValue=function(e,t){t.length>0?this._map.set(e,t):this._map.delete(e)},n}();hl.Lookup=cre});var o2=F(lk=>{"use strict";Object.defineProperty(lk,"__esModule",{value:!0});lk.ModuleActivationStore=void 0;var i2=vN(),ure=function(){function n(){this._map=new Map}return n.prototype.remove=function(e){if(this._map.has(e)){var t=this._map.get(e);return this._map.delete(e),t}return this._getEmptyHandlersStore()},n.prototype.addDeactivation=function(e,t,r){this._getModuleActivationHandlers(e).onDeactivations.add(t,r)},n.prototype.addActivation=function(e,t,r){this._getModuleActivationHandlers(e).onActivations.add(t,r)},n.prototype.clone=function(){var e=new n;return this._map.forEach(function(t,r){e._map.set(r,{onActivations:t.onActivations.clone(),onDeactivations:t.onDeactivations.clone()})}),e},n.prototype._getModuleActivationHandlers=function(e){var t=this._map.get(e);return t===void 0&&(t=this._getEmptyHandlersStore(),this._map.set(e,t)),t},n.prototype._getEmptyHandlersStore=function(){var e={onActivations:new i2.Lookup,onDeactivations:new i2.Lookup};return e},n}();lk.ModuleActivationStore=ure});var yN=F(Zn=>{"use strict";var uk=Zn&&Zn.__assign||function(){return uk=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},uk.apply(this,arguments)},dre=Zn&&Zn.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),pre=Zn&&Zn.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s2=Zn&&Zn.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&dre(e,n,t);return pre(e,n),e},Es=Zn&&Zn.__awaiter||function(n,e,t,r){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})},ws=Zn&&Zn.__generator||function(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,i=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){t.label=c[1];break}if(c[0]===6&&t.label<o[1]){t.label=o[1],o=c;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(c);break}o[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(u){c=[6,u],i=0}finally{r=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},mre=Zn&&Zn.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(Zn,"__esModule",{value:!0});Zn.Container=void 0;var fre=aV(),ha=s2(xi()),qh=ma(),ym=s2(Cn()),hre=HA(),ck=nN(),gre=HV(),vre=t2(),bm=kC(),yre=gd(),bre=Vh(),Ire=r2(),DC=vN(),Sre=o2(),Cre=function(){function n(e){var t=e||{};if(typeof t!="object")throw new Error(""+ha.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(t.defaultScope===void 0)t.defaultScope=qh.BindingScopeEnum.Transient;else if(t.defaultScope!==qh.BindingScopeEnum.Singleton&&t.defaultScope!==qh.BindingScopeEnum.Transient&&t.defaultScope!==qh.BindingScopeEnum.Request)throw new Error(""+ha.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(t.autoBindInjectable===void 0)t.autoBindInjectable=!1;else if(typeof t.autoBindInjectable!="boolean")throw new Error(""+ha.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(t.skipBaseClassChecks===void 0)t.skipBaseClassChecks=!1;else if(typeof t.skipBaseClassChecks!="boolean")throw new Error(""+ha.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:t.autoBindInjectable,defaultScope:t.defaultScope,skipBaseClassChecks:t.skipBaseClassChecks},this.id=(0,yre.id)(),this._bindingDictionary=new DC.Lookup,this._snapshots=[],this._middleware=null,this._activations=new DC.Lookup,this._deactivations=new DC.Lookup,this.parent=null,this._metadataReader=new hre.MetadataReader,this._moduleActivationStore=new Sre.ModuleActivationStore}return n.merge=function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var o=new n,s=mre([e,t],r,!0).map(function(c){return(0,ck.getBindingDictionary)(c)}),a=(0,ck.getBindingDictionary)(o);function l(c,u){c.traverse(function(d,f){f.forEach(function(g){u.add(g.serviceIdentifier,g.clone())})})}return s.forEach(function(c){l(c,a)}),o},n.prototype.load=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=this._getContainerModuleHelpersFactory(),i=0,o=e;i<o.length;i++){var s=o[i],a=r(s.id);s.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction,a.unbindAsyncFunction,a.onActivationFunction,a.onDeactivationFunction)}},n.prototype.loadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Es(this,void 0,void 0,function(){var r,i,o,s,a;return ws(this,function(l){switch(l.label){case 0:r=this._getContainerModuleHelpersFactory(),i=0,o=e,l.label=1;case 1:return i<o.length?(s=o[i],a=r(s.id),[4,s.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction,a.unbindAsyncFunction,a.onActivationFunction,a.onDeactivationFunction)]):[3,4];case 2:l.sent(),l.label=3;case 3:return i++,[3,1];case 4:return[2]}})})},n.prototype.unload=function(){for(var e=this,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];t.forEach(function(i){var o=e._removeModuleBindings(i.id);e._deactivateSingletons(o),e._removeModuleHandlers(i.id)})},n.prototype.unloadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Es(this,void 0,void 0,function(){var r,i,o,s;return ws(this,function(a){switch(a.label){case 0:r=0,i=e,a.label=1;case 1:return r<i.length?(o=i[r],s=this._removeModuleBindings(o.id),[4,this._deactivateSingletonsAsync(s)]):[3,4];case 2:a.sent(),this._removeModuleHandlers(o.id),a.label=3;case 3:return r++,[3,1];case 4:return[2]}})})},n.prototype.bind=function(e){var t=this.options.defaultScope||qh.BindingScopeEnum.Transient,r=new fre.Binding(e,t);return this._bindingDictionary.add(e,r),new vre.BindingToSyntax(r)},n.prototype.rebind=function(e){return this.unbind(e),this.bind(e)},n.prototype.rebindAsync=function(e){return Es(this,void 0,void 0,function(){return ws(this,function(t){switch(t.label){case 0:return[4,this.unbindAsync(e)];case 1:return t.sent(),[2,this.bind(e)]}})})},n.prototype.unbind=function(e){if(this._bindingDictionary.hasKey(e)){var t=this._bindingDictionary.get(e);this._deactivateSingletons(t)}this._removeServiceFromDictionary(e)},n.prototype.unbindAsync=function(e){return Es(this,void 0,void 0,function(){var t;return ws(this,function(r){switch(r.label){case 0:return this._bindingDictionary.hasKey(e)?(t=this._bindingDictionary.get(e),[4,this._deactivateSingletonsAsync(t)]):[3,2];case 1:r.sent(),r.label=2;case 2:return this._removeServiceFromDictionary(e),[2]}})})},n.prototype.unbindAll=function(){var e=this;this._bindingDictionary.traverse(function(t,r){e._deactivateSingletons(r)}),this._bindingDictionary=new DC.Lookup},n.prototype.unbindAllAsync=function(){return Es(this,void 0,void 0,function(){var e,t=this;return ws(this,function(r){switch(r.label){case 0:return e=[],this._bindingDictionary.traverse(function(i,o){e.push(t._deactivateSingletonsAsync(o))}),[4,Promise.all(e)];case 1:return r.sent(),this._bindingDictionary=new DC.Lookup,[2]}})})},n.prototype.onActivation=function(e,t){this._activations.add(e,t)},n.prototype.onDeactivation=function(e,t){this._deactivations.add(e,t)},n.prototype.isBound=function(e){var t=this._bindingDictionary.hasKey(e);return!t&&this.parent&&(t=this.parent.isBound(e)),t},n.prototype.isCurrentBound=function(e){return this._bindingDictionary.hasKey(e)},n.prototype.isBoundNamed=function(e,t){return this.isBoundTagged(e,ym.NAMED_TAG,t)},n.prototype.isBoundTagged=function(e,t,r){var i=!1;if(this._bindingDictionary.hasKey(e)){var o=this._bindingDictionary.get(e),s=(0,ck.createMockRequest)(this,e,t,r);i=o.some(function(a){return a.constraint(s)})}return!i&&this.parent&&(i=this.parent.isBoundTagged(e,t,r)),i},n.prototype.snapshot=function(){this._snapshots.push(Ire.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware,this._activations.clone(),this._deactivations.clone(),this._moduleActivationStore.clone()))},n.prototype.restore=function(){var e=this._snapshots.pop();if(e===void 0)throw new Error(ha.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=e.bindings,this._activations=e.activations,this._deactivations=e.deactivations,this._middleware=e.middleware,this._moduleActivationStore=e.moduleActivationStore},n.prototype.createChild=function(e){var t=new n(e||this.options);return t.parent=this,t},n.prototype.applyMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this._middleware?this._middleware:this._planAndResolve();this._middleware=e.reduce(function(i,o){return o(i)},r)},n.prototype.applyCustomMetadataReader=function(e){this._metadataReader=e},n.prototype.get=function(e){var t=this._getNotAllArgs(e,!1);return this._getButThrowIfAsync(t)},n.prototype.getAsync=function(e){return Es(this,void 0,void 0,function(){var t;return ws(this,function(r){return t=this._getNotAllArgs(e,!1),[2,this._get(t)]})})},n.prototype.getTagged=function(e,t,r){var i=this._getNotAllArgs(e,!1,t,r);return this._getButThrowIfAsync(i)},n.prototype.getTaggedAsync=function(e,t,r){return Es(this,void 0,void 0,function(){var i;return ws(this,function(o){return i=this._getNotAllArgs(e,!1,t,r),[2,this._get(i)]})})},n.prototype.getNamed=function(e,t){return this.getTagged(e,ym.NAMED_TAG,t)},n.prototype.getNamedAsync=function(e,t){return this.getTaggedAsync(e,ym.NAMED_TAG,t)},n.prototype.getAll=function(e){var t=this._getAllArgs(e);return this._getButThrowIfAsync(t)},n.prototype.getAllAsync=function(e){var t=this._getAllArgs(e);return this._getAll(t)},n.prototype.getAllTagged=function(e,t,r){var i=this._getNotAllArgs(e,!0,t,r);return this._getButThrowIfAsync(i)},n.prototype.getAllTaggedAsync=function(e,t,r){var i=this._getNotAllArgs(e,!0,t,r);return this._getAll(i)},n.prototype.getAllNamed=function(e,t){return this.getAllTagged(e,ym.NAMED_TAG,t)},n.prototype.getAllNamedAsync=function(e,t){return this.getAllTaggedAsync(e,ym.NAMED_TAG,t)},n.prototype.resolve=function(e){var t=this.isBound(e);t||this.bind(e).toSelf();var r=this.get(e);return t||this.unbind(e),r},n.prototype._preDestroy=function(e,t){if(Reflect.hasMetadata(ym.PRE_DESTROY,e)){var r=Reflect.getMetadata(ym.PRE_DESTROY,e);return t[r.value]()}},n.prototype._removeModuleHandlers=function(e){var t=this._moduleActivationStore.remove(e);this._activations.removeIntersection(t.onActivations),this._deactivations.removeIntersection(t.onDeactivations)},n.prototype._removeModuleBindings=function(e){return this._bindingDictionary.removeByCondition(function(t){return t.moduleId===e})},n.prototype._deactivate=function(e,t){var r=this,i=Object.getPrototypeOf(t).constructor;try{if(this._deactivations.hasKey(e.serviceIdentifier)){var o=this._deactivateContainer(t,this._deactivations.get(e.serviceIdentifier).values());if((0,bm.isPromise)(o))return this._handleDeactivationError(o.then(function(){return r._propagateContainerDeactivationThenBindingAndPreDestroyAsync(e,t,i)}),i)}var s=this._propagateContainerDeactivationThenBindingAndPreDestroy(e,t,i);if((0,bm.isPromise)(s))return this._handleDeactivationError(s,i)}catch(a){throw new Error(ha.ON_DEACTIVATION_ERROR(i.name,a.message))}},n.prototype._handleDeactivationError=function(e,t){return Es(this,void 0,void 0,function(){var r;return ws(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,e];case 1:return i.sent(),[3,3];case 2:throw r=i.sent(),new Error(ha.ON_DEACTIVATION_ERROR(t.name,r.message));case 3:return[2]}})})},n.prototype._deactivateContainer=function(e,t){for(var r=this,i=t.next();i.value;){var o=i.value(e);if((0,bm.isPromise)(o))return o.then(function(){return r._deactivateContainerAsync(e,t)});i=t.next()}},n.prototype._deactivateContainerAsync=function(e,t){return Es(this,void 0,void 0,function(){var r;return ws(this,function(i){switch(i.label){case 0:r=t.next(),i.label=1;case 1:return r.value?[4,r.value(e)]:[3,3];case 2:return i.sent(),r=t.next(),[3,1];case 3:return[2]}})})},n.prototype._getContainerModuleHelpersFactory=function(){var e=this,t=function(u,d){u._binding.moduleId=d},r=function(u){return function(d){var f=e.bind(d);return t(f,u),f}},i=function(){return function(u){return e.unbind(u)}},o=function(){return function(u){return e.unbindAsync(u)}},s=function(){return function(u){return e.isBound(u)}},a=function(u){return function(d){var f=e.rebind(d);return t(f,u),f}},l=function(u){return function(d,f){e._moduleActivationStore.addActivation(u,d,f),e.onActivation(d,f)}},c=function(u){return function(d,f){e._moduleActivationStore.addDeactivation(u,d,f),e.onDeactivation(d,f)}};return function(u){return{bindFunction:r(u),isboundFunction:s(),onActivationFunction:l(u),onDeactivationFunction:c(u),rebindFunction:a(u),unbindFunction:i(),unbindAsyncFunction:o()}}},n.prototype._getAll=function(e){return Promise.all(this._get(e))},n.prototype._get=function(e){var t=uk(uk({},e),{contextInterceptor:function(i){return i},targetType:qh.TargetTypeEnum.Variable});if(this._middleware){var r=this._middleware(t);if(r==null)throw new Error(ha.INVALID_MIDDLEWARE_RETURN);return r}return this._planAndResolve()(t)},n.prototype._getButThrowIfAsync=function(e){var t=this._get(e);if((0,bm.isPromiseOrContainsPromise)(t))throw new Error(ha.LAZY_IN_SYNC(e.serviceIdentifier));return t},n.prototype._getAllArgs=function(e){var t={avoidConstraints:!0,isMultiInject:!0,serviceIdentifier:e};return t},n.prototype._getNotAllArgs=function(e,t,r,i){var o={avoidConstraints:!1,isMultiInject:t,serviceIdentifier:e,key:r,value:i};return o},n.prototype._planAndResolve=function(){var e=this;return function(t){var r=(0,ck.plan)(e._metadataReader,e,t.isMultiInject,t.targetType,t.serviceIdentifier,t.key,t.value,t.avoidConstraints);r=t.contextInterceptor(r);var i=(0,gre.resolve)(r);return i}},n.prototype._deactivateIfSingleton=function(e){var t=this;if(e.activated)return(0,bm.isPromise)(e.cache)?e.cache.then(function(r){return t._deactivate(e,r)}):this._deactivate(e,e.cache)},n.prototype._deactivateSingletons=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t],o=this._deactivateIfSingleton(i);if((0,bm.isPromise)(o))throw new Error(ha.ASYNC_UNBIND_REQUIRED)}},n.prototype._deactivateSingletonsAsync=function(e){return Es(this,void 0,void 0,function(){var t=this;return ws(this,function(r){switch(r.label){case 0:return[4,Promise.all(e.map(function(i){return t._deactivateIfSingleton(i)}))];case 1:return r.sent(),[2]}})})},n.prototype._propagateContainerDeactivationThenBindingAndPreDestroy=function(e,t,r){return this.parent?this._deactivate.bind(this.parent)(e,t):this._bindingDeactivationAndPreDestroy(e,t,r)},n.prototype._propagateContainerDeactivationThenBindingAndPreDestroyAsync=function(e,t,r){return Es(this,void 0,void 0,function(){return ws(this,function(i){switch(i.label){case 0:return this.parent?[4,this._deactivate.bind(this.parent)(e,t)]:[3,2];case 1:return i.sent(),[3,4];case 2:return[4,this._bindingDeactivationAndPreDestroyAsync(e,t,r)];case 3:i.sent(),i.label=4;case 4:return[2]}})})},n.prototype._removeServiceFromDictionary=function(e){try{this._bindingDictionary.remove(e)}catch{throw new Error(ha.CANNOT_UNBIND+" "+(0,bre.getServiceIdentifierAsString)(e))}},n.prototype._bindingDeactivationAndPreDestroy=function(e,t,r){var i=this;if(typeof e.onDeactivation=="function"){var o=e.onDeactivation(t);if((0,bm.isPromise)(o))return o.then(function(){return i._preDestroy(r,t)})}return this._preDestroy(r,t)},n.prototype._bindingDeactivationAndPreDestroyAsync=function(e,t,r){return Es(this,void 0,void 0,function(){return ws(this,function(i){switch(i.label){case 0:return typeof e.onDeactivation!="function"?[3,2]:[4,e.onDeactivation(t)];case 1:i.sent(),i.label=2;case 2:return[4,this._preDestroy(r,t)];case 3:return i.sent(),[2]}})})},n}();Zn.Container=Cre});var l2=F(Hh=>{"use strict";Object.defineProperty(Hh,"__esModule",{value:!0});Hh.AsyncContainerModule=Hh.ContainerModule=void 0;var a2=gd(),Ere=function(){function n(e){this.id=(0,a2.id)(),this.registry=e}return n}();Hh.ContainerModule=Ere;var wre=function(){function n(e){this.id=(0,a2.id)(),this.registry=e}return n}();Hh.AsyncContainerModule=wre});var c2=F(dk=>{"use strict";Object.defineProperty(dk,"__esModule",{value:!0});dk.getFirstArrayDuplicate=void 0;function Pre(n){for(var e=new Set,t=0,r=n;t<r.length;t++){var i=r[t];if(e.has(i))return i;e.add(i)}}dk.getFirstArrayDuplicate=Pre});var Fc=F(Ti=>{"use strict";var kre=Ti&&Ti.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),xre=Ti&&Ti.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),d2=Ti&&Ti.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&kre(e,n,t);return xre(e,n),e};Object.defineProperty(Ti,"__esModule",{value:!0});Ti.createTaggedDecorator=Ti.tagProperty=Ti.tagParameter=Ti.decorate=void 0;var pk=d2(xi()),p2=d2(Cn()),Dre=c2();function _re(n){return n.prototype!==void 0}function Tre(n){if(n!==void 0)throw new Error(pk.INVALID_DECORATOR_OPERATION)}function m2(n,e,t,r){Tre(e),h2(p2.TAGGED,n,t.toString(),r)}Ti.tagParameter=m2;function f2(n,e,t){if(_re(n))throw new Error(pk.INVALID_DECORATOR_OPERATION);h2(p2.TAGGED_PROP,n.constructor,e,t)}Ti.tagProperty=f2;function Rre(n){var e=[];if(Array.isArray(n)){e=n;var t=(0,Dre.getFirstArrayDuplicate)(e.map(function(r){return r.key}));if(t!==void 0)throw new Error(pk.DUPLICATED_METADATA+" "+t.toString())}else e=[n];return e}function h2(n,e,t,r){var i=Rre(r),o={};Reflect.hasOwnMetadata(n,e)&&(o=Reflect.getMetadata(n,e));var s=o[t];if(s===void 0)s=[];else for(var a=function(d){if(i.some(function(f){return f.key===d.key}))throw new Error(pk.DUPLICATED_METADATA+" "+d.key.toString())},l=0,c=s;l<c.length;l++){var u=c[l];a(u)}s.push.apply(s,i),o[t]=s,Reflect.defineMetadata(n,o,e)}function Are(n){return function(e,t,r){typeof r=="number"?m2(e,t,r,n):f2(e,t,n)}}Ti.createTaggedDecorator=Are;function u2(n,e){Reflect.decorate(n,e)}function Nre(n,e){return function(t,r){e(t,r,n)}}function Mre(n,e,t){typeof t=="number"?u2([Nre(t,n)],e):typeof t=="string"?Reflect.decorate([n],e,t):u2([n],e)}Ti.decorate=Mre});var v2=F(gl=>{"use strict";var Kre=gl&&gl.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),Ore=gl&&gl.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),g2=gl&&gl.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&Kre(e,n,t);return Ore(e,n),e};Object.defineProperty(gl,"__esModule",{value:!0});gl.injectable=void 0;var Fre=g2(xi()),bN=g2(Cn());function Lre(){return function(n){if(Reflect.hasOwnMetadata(bN.PARAM_TYPES,n))throw new Error(Fre.DUPLICATED_INJECTABLE_DECORATOR);var e=Reflect.getMetadata(bN.DESIGN_PARAM_TYPES,n)||[];return Reflect.defineMetadata(bN.PARAM_TYPES,e,n),n}}gl.injectable=Lre});var y2=F(mk=>{"use strict";Object.defineProperty(mk,"__esModule",{value:!0});mk.tagged=void 0;var Ure=fa(),Wre=Fc();function Vre(n,e){return(0,Wre.createTaggedDecorator)(new Ure.Metadata(n,e))}mk.tagged=Vre});var b2=F(vl=>{"use strict";var jre=vl&&vl.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),Bre=vl&&vl.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),$re=vl&&vl.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&jre(e,n,t);return Bre(e,n),e};Object.defineProperty(vl,"__esModule",{value:!0});vl.named=void 0;var Jre=$re(Cn()),qre=fa(),Hre=Fc();function Gre(n){return(0,Hre.createTaggedDecorator)(new qre.Metadata(Jre.NAMED_TAG,n))}vl.named=Gre});var IN=F(fk=>{"use strict";Object.defineProperty(fk,"__esModule",{value:!0});fk.injectBase=void 0;var zre=xi(),Qre=fa(),Yre=Fc();function Xre(n){return function(e){return function(t,r,i){if(e===void 0){var o=typeof t=="function"?t.name:t.constructor.name;throw new Error((0,zre.UNDEFINED_INJECT_ANNOTATION)(o))}return(0,Yre.createTaggedDecorator)(new Qre.Metadata(n,e))(t,r,i)}}}fk.injectBase=Xre});var I2=F(yl=>{"use strict";var Zre=yl&&yl.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),ene=yl&&yl.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),tne=yl&&yl.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&Zre(e,n,t);return ene(e,n),e};Object.defineProperty(yl,"__esModule",{value:!0});yl.inject=void 0;var rne=tne(Cn()),nne=IN(),ine=(0,nne.injectBase)(rne.INJECT_TAG);yl.inject=ine});var S2=F(bl=>{"use strict";var one=bl&&bl.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),sne=bl&&bl.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),ane=bl&&bl.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&one(e,n,t);return sne(e,n),e};Object.defineProperty(bl,"__esModule",{value:!0});bl.optional=void 0;var lne=ane(Cn()),cne=fa(),une=Fc();function dne(){return(0,une.createTaggedDecorator)(new cne.Metadata(lne.OPTIONAL_TAG,!0))}bl.optional=dne});var C2=F(Il=>{"use strict";var pne=Il&&Il.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),mne=Il&&Il.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),fne=Il&&Il.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&pne(e,n,t);return mne(e,n),e};Object.defineProperty(Il,"__esModule",{value:!0});Il.unmanaged=void 0;var hne=fne(Cn()),gne=fa(),vne=Fc();function yne(){return function(n,e,t){var r=new gne.Metadata(hne.UNMANAGED_TAG,!0);(0,vne.tagParameter)(n,e,t,r)}}Il.unmanaged=yne});var E2=F(Sl=>{"use strict";var bne=Sl&&Sl.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),Ine=Sl&&Sl.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),Sne=Sl&&Sl.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&bne(e,n,t);return Ine(e,n),e};Object.defineProperty(Sl,"__esModule",{value:!0});Sl.multiInject=void 0;var Cne=Sne(Cn()),Ene=IN(),wne=(0,Ene.injectBase)(Cne.MULTI_INJECT_TAG);Sl.multiInject=wne});var w2=F(Cl=>{"use strict";var Pne=Cl&&Cl.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),kne=Cl&&Cl.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),xne=Cl&&Cl.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&Pne(e,n,t);return kne(e,n),e};Object.defineProperty(Cl,"__esModule",{value:!0});Cl.targetName=void 0;var Dne=xne(Cn()),_ne=fa(),Tne=Fc();function Rne(n){return function(e,t,r){var i=new _ne.Metadata(Dne.NAME_TAG,n);(0,Tne.tagParameter)(e,t,r,i)}}Cl.targetName=Rne});var SN=F(hk=>{"use strict";Object.defineProperty(hk,"__esModule",{value:!0});hk.propertyEventDecorator=void 0;var Ane=fa();function Nne(n,e){return function(){return function(t,r){var i=new Ane.Metadata(n,r);if(Reflect.hasOwnMetadata(n,t.constructor))throw new Error(e);Reflect.defineMetadata(n,i,t.constructor)}}}hk.propertyEventDecorator=Nne});var k2=F(El=>{"use strict";var Mne=El&&El.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),Kne=El&&El.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),P2=El&&El.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&Mne(e,n,t);return Kne(e,n),e};Object.defineProperty(El,"__esModule",{value:!0});El.postConstruct=void 0;var One=P2(xi()),Fne=P2(Cn()),Lne=SN(),Une=(0,Lne.propertyEventDecorator)(Fne.POST_CONSTRUCT,One.MULTIPLE_POST_CONSTRUCT_METHODS);El.postConstruct=Une});var D2=F(wl=>{"use strict";var Wne=wl&&wl.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),Vne=wl&&wl.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),x2=wl&&wl.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&Wne(e,n,t);return Vne(e,n),e};Object.defineProperty(wl,"__esModule",{value:!0});wl.preDestroy=void 0;var jne=x2(xi()),Bne=x2(Cn()),$ne=SN(),Jne=(0,$ne.propertyEventDecorator)(Bne.PRE_DESTROY,jne.MULTIPLE_PRE_DESTROY_METHODS);wl.preDestroy=Jne});var _2=F(gk=>{"use strict";Object.defineProperty(gk,"__esModule",{value:!0});gk.interfaces=void 0;var CN;CN||(CN={});gk.interfaces=CN});var N=F(Oe=>{"use strict";var qne=Oe&&Oe.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),Hne=Oe&&Oe.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),Gne=Oe&&Oe.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&qne(e,n,t);return Hne(e,n),e};Object.defineProperty(Oe,"__esModule",{value:!0});Oe.multiBindToService=Oe.getServiceIdentifierAsString=Oe.typeConstraint=Oe.namedConstraint=Oe.taggedConstraint=Oe.traverseAncerstors=Oe.decorate=Oe.interfaces=Oe.id=Oe.MetadataReader=Oe.preDestroy=Oe.postConstruct=Oe.targetName=Oe.multiInject=Oe.unmanaged=Oe.optional=Oe.LazyServiceIdentifer=Oe.inject=Oe.named=Oe.tagged=Oe.injectable=Oe.createTaggedDecorator=Oe.ContainerModule=Oe.AsyncContainerModule=Oe.TargetTypeEnum=Oe.BindingTypeEnum=Oe.BindingScopeEnum=Oe.Container=Oe.METADATA_KEY=void 0;var zne=Gne(Cn());Oe.METADATA_KEY=zne;var Qne=yN();Object.defineProperty(Oe,"Container",{enumerable:!0,get:function(){return Qne.Container}});var EN=ma();Object.defineProperty(Oe,"BindingScopeEnum",{enumerable:!0,get:function(){return EN.BindingScopeEnum}});Object.defineProperty(Oe,"BindingTypeEnum",{enumerable:!0,get:function(){return EN.BindingTypeEnum}});Object.defineProperty(Oe,"TargetTypeEnum",{enumerable:!0,get:function(){return EN.TargetTypeEnum}});var T2=l2();Object.defineProperty(Oe,"AsyncContainerModule",{enumerable:!0,get:function(){return T2.AsyncContainerModule}});Object.defineProperty(Oe,"ContainerModule",{enumerable:!0,get:function(){return T2.ContainerModule}});var Yne=Fc();Object.defineProperty(Oe,"createTaggedDecorator",{enumerable:!0,get:function(){return Yne.createTaggedDecorator}});var Xne=v2();Object.defineProperty(Oe,"injectable",{enumerable:!0,get:function(){return Xne.injectable}});var Zne=y2();Object.defineProperty(Oe,"tagged",{enumerable:!0,get:function(){return Zne.tagged}});var eie=b2();Object.defineProperty(Oe,"named",{enumerable:!0,get:function(){return eie.named}});var tie=I2();Object.defineProperty(Oe,"inject",{enumerable:!0,get:function(){return tie.inject}});var rie=zA();Object.defineProperty(Oe,"LazyServiceIdentifer",{enumerable:!0,get:function(){return rie.LazyServiceIdentifer}});var nie=S2();Object.defineProperty(Oe,"optional",{enumerable:!0,get:function(){return nie.optional}});var iie=C2();Object.defineProperty(Oe,"unmanaged",{enumerable:!0,get:function(){return iie.unmanaged}});var oie=E2();Object.defineProperty(Oe,"multiInject",{enumerable:!0,get:function(){return oie.multiInject}});var sie=w2();Object.defineProperty(Oe,"targetName",{enumerable:!0,get:function(){return sie.targetName}});var aie=k2();Object.defineProperty(Oe,"postConstruct",{enumerable:!0,get:function(){return aie.postConstruct}});var lie=D2();Object.defineProperty(Oe,"preDestroy",{enumerable:!0,get:function(){return lie.preDestroy}});var cie=HA();Object.defineProperty(Oe,"MetadataReader",{enumerable:!0,get:function(){return cie.MetadataReader}});var uie=gd();Object.defineProperty(Oe,"id",{enumerable:!0,get:function(){return uie.id}});var die=_2();Object.defineProperty(Oe,"interfaces",{enumerable:!0,get:function(){return die.interfaces}});var pie=Fc();Object.defineProperty(Oe,"decorate",{enumerable:!0,get:function(){return pie.decorate}});var vk=mN();Object.defineProperty(Oe,"traverseAncerstors",{enumerable:!0,get:function(){return vk.traverseAncerstors}});Object.defineProperty(Oe,"taggedConstraint",{enumerable:!0,get:function(){return vk.taggedConstraint}});Object.defineProperty(Oe,"namedConstraint",{enumerable:!0,get:function(){return vk.namedConstraint}});Object.defineProperty(Oe,"typeConstraint",{enumerable:!0,get:function(){return vk.typeConstraint}});var mie=Vh();Object.defineProperty(Oe,"getServiceIdentifierAsString",{enumerable:!0,get:function(){return mie.getServiceIdentifierAsString}});var fie=sN();Object.defineProperty(Oe,"multiBindToService",{enumerable:!0,get:function(){return fie.multiBindToService}})});var Ik=F(vd=>{"use strict";Object.defineProperty(vd,"__esModule",{value:!0});vd.PythonExtension=vd.PVSC_EXTENSION_ID=void 0;var gie=require("vscode");vd.PVSC_EXTENSION_ID="ms-python.python";var vie;(function(n){async function e(){let t=gie.extensions.getExtension(vd.PVSC_EXTENSION_ID);if(t===void 0)throw new Error("Python extension is not installed or is disabled");return t.isActive||await t.activate(),t.exports}n.api=e})(vie=vd.PythonExtension||(vd.PythonExtension={}))});var TN=F((ube,M2)=>{M2.exports=require("util").format});var Q2=F(OC=>{OC.get=function(n){var e=Error.stackTraceLimit;Error.stackTraceLimit=1/0;var t={},r=Error.prepareStackTrace;Error.prepareStackTrace=function(o,s){return s},Error.captureStackTrace(t,n||OC.get);var i=t.stack;return Error.prepareStackTrace=r,Error.stackTraceLimit=e,i};OC.parse=function(n){if(!n.stack)return[];var e=this,t=n.stack.split(`
`).slice(1);return t.map(function(r){if(r.match(/^\s*[-]{4,}$/))return e._createParsedCallSite({fileName:r,lineNumber:null,functionName:null,typeName:null,methodName:null,columnNumber:null,native:null});var i=r.match(/at (?:(.+)\s+\()?(?:(.+?):(\d+)(?::(\d+))?|([^)]+))\)?/);if(i){var o=null,s=null,a=null,l=null,c=null,u=i[5]==="native";if(i[1]){a=i[1];var d=a.lastIndexOf(".");if(a[d-1]=="."&&d--,d>0){o=a.substr(0,d),s=a.substr(d+1);var f=o.indexOf(".Module");f>0&&(a=a.substr(f+1),o=o.substr(0,f))}l=null}s&&(l=o,c=s),s==="<anonymous>"&&(c=null,a=null);var g={fileName:i[2]||null,lineNumber:parseInt(i[3],10)||null,functionName:a,typeName:l,methodName:c,columnNumber:parseInt(i[4],10)||null,native:u};return e._createParsedCallSite(g)}}).filter(function(r){return!!r})};function KC(n){for(var e in n)this[e]=n[e]}var Tie=["this","typeName","functionName","methodName","fileName","lineNumber","columnNumber","function","evalOrigin"],Rie=["topLevel","eval","native","constructor"];Tie.forEach(function(n){KC.prototype[n]=null,KC.prototype["get"+n[0].toUpperCase()+n.substr(1)]=function(){return this[n]}});Rie.forEach(function(n){KC.prototype[n]=!1,KC.prototype["is"+n[0].toUpperCase()+n.substr(1)]=function(){return this[n]}});OC._createParsedCallSite=function(n){return new KC(n)}});var km=F((Et,D$)=>{Et=D$.exports=$t;var wr;typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?wr=function(){var n=Array.prototype.slice.call(arguments,0);n.unshift("SEMVER"),console.log.apply(console,n)}:wr=function(){};Et.SEMVER_SPEC_VERSION="2.0.0";var UC=256,Lk=Number.MAX_SAFE_INTEGER||9007199254740991,KN=16,jie=UC-6,WC=Et.re=[],Wr=Et.safeRe=[],de=Et.src=[],Wt=0,WN="[a-zA-Z0-9-]",ON=[["\\s",1],["\\d",UC],[WN,jie]];function $k(n){for(var e=0;e<ON.length;e++){var t=ON[e][0],r=ON[e][1];n=n.split(t+"*").join(t+"{0,"+r+"}").split(t+"+").join(t+"{1,"+r+"}")}return n}var lg=Wt++;de[lg]="0|[1-9]\\d*";var cg=Wt++;de[cg]="\\d+";var VN=Wt++;de[VN]="\\d*[a-zA-Z-]"+WN+"*";var f$=Wt++;de[f$]="("+de[lg]+")\\.("+de[lg]+")\\.("+de[lg]+")";var h$=Wt++;de[h$]="("+de[cg]+")\\.("+de[cg]+")\\.("+de[cg]+")";var FN=Wt++;de[FN]="(?:"+de[lg]+"|"+de[VN]+")";var LN=Wt++;de[LN]="(?:"+de[cg]+"|"+de[VN]+")";var jN=Wt++;de[jN]="(?:-("+de[FN]+"(?:\\."+de[FN]+")*))";var BN=Wt++;de[BN]="(?:-?("+de[LN]+"(?:\\."+de[LN]+")*))";var UN=Wt++;de[UN]=WN+"+";var jC=Wt++;de[jC]="(?:\\+("+de[UN]+"(?:\\."+de[UN]+")*))";var $N=Wt++,g$="v?"+de[f$]+de[jN]+"?"+de[jC]+"?";de[$N]="^"+g$+"$";var JN="[v=\\s]*"+de[h$]+de[BN]+"?"+de[jC]+"?",qN=Wt++;de[qN]="^"+JN+"$";var fg=Wt++;de[fg]="((?:<|>)?=?)";var Uk=Wt++;de[Uk]=de[cg]+"|x|X|\\*";var Wk=Wt++;de[Wk]=de[lg]+"|x|X|\\*";var Em=Wt++;de[Em]="[v=\\s]*("+de[Wk]+")(?:\\.("+de[Wk]+")(?:\\.("+de[Wk]+")(?:"+de[jN]+")?"+de[jC]+"?)?)?";var dg=Wt++;de[dg]="[v=\\s]*("+de[Uk]+")(?:\\.("+de[Uk]+")(?:\\.("+de[Uk]+")(?:"+de[BN]+")?"+de[jC]+"?)?)?";var v$=Wt++;de[v$]="^"+de[fg]+"\\s*"+de[Em]+"$";var y$=Wt++;de[y$]="^"+de[fg]+"\\s*"+de[dg]+"$";var b$=Wt++;de[b$]="(?:^|[^\\d])(\\d{1,"+KN+"})(?:\\.(\\d{1,"+KN+"}))?(?:\\.(\\d{1,"+KN+"}))?(?:$|[^\\d])";var Jk=Wt++;de[Jk]="(?:~>?)";var pg=Wt++;de[pg]="(\\s*)"+de[Jk]+"\\s+";WC[pg]=new RegExp(de[pg],"g");Wr[pg]=new RegExp($k(de[pg]),"g");var Bie="$1~",I$=Wt++;de[I$]="^"+de[Jk]+de[Em]+"$";var S$=Wt++;de[S$]="^"+de[Jk]+de[dg]+"$";var qk=Wt++;de[qk]="(?:\\^)";var mg=Wt++;de[mg]="(\\s*)"+de[qk]+"\\s+";WC[mg]=new RegExp(de[mg],"g");Wr[mg]=new RegExp($k(de[mg]),"g");var $ie="$1^",C$=Wt++;de[C$]="^"+de[qk]+de[Em]+"$";var E$=Wt++;de[E$]="^"+de[qk]+de[dg]+"$";var HN=Wt++;de[HN]="^"+de[fg]+"\\s*("+JN+")$|^$";var GN=Wt++;de[GN]="^"+de[fg]+"\\s*("+g$+")$|^$";var wm=Wt++;de[wm]="(\\s*)"+de[fg]+"\\s*("+JN+"|"+de[Em]+")";WC[wm]=new RegExp(de[wm],"g");Wr[wm]=new RegExp($k(de[wm]),"g");var Jie="$1$2$3",w$=Wt++;de[w$]="^\\s*("+de[Em]+")\\s+-\\s+("+de[Em]+")\\s*$";var P$=Wt++;de[P$]="^\\s*("+de[dg]+")\\s+-\\s+("+de[dg]+")\\s*$";var k$=Wt++;de[k$]="(<|>)?=?\\s*\\*";for(Dl=0;Dl<Wt;Dl++)wr(Dl,de[Dl]),WC[Dl]||(WC[Dl]=new RegExp(de[Dl]),Wr[Dl]=new RegExp($k(de[Dl])));var Dl;Et.parse=Pm;function Pm(n,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),n instanceof $t)return n;if(typeof n!="string"||n.length>UC)return null;var t=e.loose?Wr[qN]:Wr[$N];if(!t.test(n))return null;try{return new $t(n,e)}catch{return null}}Et.valid=qie;function qie(n,e){var t=Pm(n,e);return t?t.version:null}Et.clean=Hie;function Hie(n,e){var t=Pm(n.trim().replace(/^[=v]+/,""),e);return t?t.version:null}Et.SemVer=$t;function $t(n,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),n instanceof $t){if(n.loose===e.loose)return n;n=n.version}else if(typeof n!="string")throw new TypeError("Invalid Version: "+n);if(n.length>UC)throw new TypeError("version is longer than "+UC+" characters");if(!(this instanceof $t))return new $t(n,e);wr("SemVer",n,e),this.options=e,this.loose=!!e.loose;var t=n.trim().match(e.loose?Wr[qN]:Wr[$N]);if(!t)throw new TypeError("Invalid Version: "+n);if(this.raw=n,this.major=+t[1],this.minor=+t[2],this.patch=+t[3],this.major>Lk||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Lk||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Lk||this.patch<0)throw new TypeError("Invalid patch version");t[4]?this.prerelease=t[4].split(".").map(function(r){if(/^[0-9]+$/.test(r)){var i=+r;if(i>=0&&i<Lk)return i}return r}):this.prerelease=[],this.build=t[5]?t[5].split("."):[],this.format()}$t.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version};$t.prototype.toString=function(){return this.version};$t.prototype.compare=function(n){return wr("SemVer.compare",this.version,this.options,n),n instanceof $t||(n=new $t(n,this.options)),this.compareMain(n)||this.comparePre(n)};$t.prototype.compareMain=function(n){return n instanceof $t||(n=new $t(n,this.options)),ug(this.major,n.major)||ug(this.minor,n.minor)||ug(this.patch,n.patch)};$t.prototype.comparePre=function(n){if(n instanceof $t||(n=new $t(n,this.options)),this.prerelease.length&&!n.prerelease.length)return-1;if(!this.prerelease.length&&n.prerelease.length)return 1;if(!this.prerelease.length&&!n.prerelease.length)return 0;var e=0;do{var t=this.prerelease[e],r=n.prerelease[e];if(wr("prerelease compare",e,t,r),t===void 0&&r===void 0)return 0;if(r===void 0)return 1;if(t===void 0)return-1;if(t===r)continue;return ug(t,r)}while(++e)};$t.prototype.inc=function(n,e){switch(n){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e),this.inc("pre",e);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",e),this.inc("pre",e);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{for(var t=this.prerelease.length;--t>=0;)typeof this.prerelease[t]=="number"&&(this.prerelease[t]++,t=-2);t===-1&&this.prerelease.push(0)}e&&(this.prerelease[0]===e?isNaN(this.prerelease[1])&&(this.prerelease=[e,0]):this.prerelease=[e,0]);break;default:throw new Error("invalid increment argument: "+n)}return this.format(),this.raw=this.version,this};Et.inc=Gie;function Gie(n,e,t,r){typeof t=="string"&&(r=t,t=void 0);try{return new $t(n,t).inc(e,r).version}catch{return null}}Et.diff=zie;function zie(n,e){if(zN(n,e))return null;var t=Pm(n),r=Pm(e),i="";if(t.prerelease.length||r.prerelease.length){i="pre";var o="prerelease"}for(var s in t)if((s==="major"||s==="minor"||s==="patch")&&t[s]!==r[s])return i+s;return o}Et.compareIdentifiers=ug;var m$=/^[0-9]+$/;function ug(n,e){var t=m$.test(n),r=m$.test(e);return t&&r&&(n=+n,e=+e),n===e?0:t&&!r?-1:r&&!t?1:n<e?-1:1}Et.rcompareIdentifiers=Qie;function Qie(n,e){return ug(e,n)}Et.major=Yie;function Yie(n,e){return new $t(n,e).major}Et.minor=Xie;function Xie(n,e){return new $t(n,e).minor}Et.patch=Zie;function Zie(n,e){return new $t(n,e).patch}Et.compare=jc;function jc(n,e,t){return new $t(n,t).compare(new $t(e,t))}Et.compareLoose=eoe;function eoe(n,e){return jc(n,e,!0)}Et.rcompare=toe;function toe(n,e,t){return jc(e,n,t)}Et.sort=roe;function roe(n,e){return n.sort(function(t,r){return Et.compare(t,r,e)})}Et.rsort=noe;function noe(n,e){return n.sort(function(t,r){return Et.rcompare(t,r,e)})}Et.gt=VC;function VC(n,e,t){return jc(n,e,t)>0}Et.lt=Vk;function Vk(n,e,t){return jc(n,e,t)<0}Et.eq=zN;function zN(n,e,t){return jc(n,e,t)===0}Et.neq=x$;function x$(n,e,t){return jc(n,e,t)!==0}Et.gte=QN;function QN(n,e,t){return jc(n,e,t)>=0}Et.lte=YN;function YN(n,e,t){return jc(n,e,t)<=0}Et.cmp=jk;function jk(n,e,t,r){switch(e){case"===":return typeof n=="object"&&(n=n.version),typeof t=="object"&&(t=t.version),n===t;case"!==":return typeof n=="object"&&(n=n.version),typeof t=="object"&&(t=t.version),n!==t;case"":case"=":case"==":return zN(n,t,r);case"!=":return x$(n,t,r);case">":return VC(n,t,r);case">=":return QN(n,t,r);case"<":return Vk(n,t,r);case"<=":return YN(n,t,r);default:throw new TypeError("Invalid operator: "+e)}}Et.Comparator=xs;function xs(n,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),n instanceof xs){if(n.loose===!!e.loose)return n;n=n.value}if(!(this instanceof xs))return new xs(n,e);n=n.trim().split(/\s+/).join(" "),wr("comparator",n,e),this.options=e,this.loose=!!e.loose,this.parse(n),this.semver===BC?this.value="":this.value=this.operator+this.semver.version,wr("comp",this)}var BC={};xs.prototype.parse=function(n){var e=this.options.loose?Wr[HN]:Wr[GN],t=n.match(e);if(!t)throw new TypeError("Invalid comparator: "+n);this.operator=t[1],this.operator==="="&&(this.operator=""),t[2]?this.semver=new $t(t[2],this.options.loose):this.semver=BC};xs.prototype.toString=function(){return this.value};xs.prototype.test=function(n){return wr("Comparator.test",n,this.options.loose),this.semver===BC?!0:(typeof n=="string"&&(n=new $t(n,this.options)),jk(n,this.operator,this.semver,this.options))};xs.prototype.intersects=function(n,e){if(!(n instanceof xs))throw new TypeError("a Comparator is required");(!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1});var t;if(this.operator==="")return t=new cn(n.value,e),Bk(this.value,t,e);if(n.operator==="")return t=new cn(this.value,e),Bk(n.semver,t,e);var r=(this.operator===">="||this.operator===">")&&(n.operator===">="||n.operator===">"),i=(this.operator==="<="||this.operator==="<")&&(n.operator==="<="||n.operator==="<"),o=this.semver.version===n.semver.version,s=(this.operator===">="||this.operator==="<=")&&(n.operator===">="||n.operator==="<="),a=jk(this.semver,"<",n.semver,e)&&(this.operator===">="||this.operator===">")&&(n.operator==="<="||n.operator==="<"),l=jk(this.semver,">",n.semver,e)&&(this.operator==="<="||this.operator==="<")&&(n.operator===">="||n.operator===">");return r||i||o&&s||a||l};Et.Range=cn;function cn(n,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),n instanceof cn)return n.loose===!!e.loose&&n.includePrerelease===!!e.includePrerelease?n:new cn(n.raw,e);if(n instanceof xs)return new cn(n.value,e);if(!(this instanceof cn))return new cn(n,e);if(this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease,this.raw=n.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(function(t){return this.parseRange(t.trim())},this).filter(function(t){return t.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+this.raw);this.format()}cn.prototype.format=function(){return this.range=this.set.map(function(n){return n.join(" ").trim()}).join("||").trim(),this.range};cn.prototype.toString=function(){return this.range};cn.prototype.parseRange=function(n){var e=this.options.loose,t=e?Wr[P$]:Wr[w$];n=n.replace(t,moe),wr("hyphen replace",n),n=n.replace(Wr[wm],Jie),wr("comparator trim",n,Wr[wm]),n=n.replace(Wr[pg],Bie),n=n.replace(Wr[mg],$ie);var r=e?Wr[HN]:Wr[GN],i=n.split(" ").map(function(o){return ooe(o,this.options)},this).join(" ").split(/\s+/);return this.options.loose&&(i=i.filter(function(o){return!!o.match(r)})),i=i.map(function(o){return new xs(o,this.options)},this),i};cn.prototype.intersects=function(n,e){if(!(n instanceof cn))throw new TypeError("a Range is required");return this.set.some(function(t){return t.every(function(r){return n.set.some(function(i){return i.every(function(o){return r.intersects(o,e)})})})})};Et.toComparators=ioe;function ioe(n,e){return new cn(n,e).set.map(function(t){return t.map(function(r){return r.value}).join(" ").trim().split(" ")})}function ooe(n,e){return wr("comp",n,e),n=loe(n,e),wr("caret",n),n=soe(n,e),wr("tildes",n),n=uoe(n,e),wr("xrange",n),n=poe(n,e),wr("stars",n),n}function eo(n){return!n||n.toLowerCase()==="x"||n==="*"}function soe(n,e){return n.trim().split(/\s+/).map(function(t){return aoe(t,e)}).join(" ")}function aoe(n,e){var t=e.loose?Wr[S$]:Wr[I$];return n.replace(t,function(r,i,o,s,a){wr("tilde",n,r,i,o,s,a);var l;return eo(i)?l="":eo(o)?l=">="+i+".0.0 <"+(+i+1)+".0.0":eo(s)?l=">="+i+"."+o+".0 <"+i+"."+(+o+1)+".0":a?(wr("replaceTilde pr",a),l=">="+i+"."+o+"."+s+"-"+a+" <"+i+"."+(+o+1)+".0"):l=">="+i+"."+o+"."+s+" <"+i+"."+(+o+1)+".0",wr("tilde return",l),l})}function loe(n,e){return n.trim().split(/\s+/).map(function(t){return coe(t,e)}).join(" ")}function coe(n,e){wr("caret",n,e);var t=e.loose?Wr[E$]:Wr[C$];return n.replace(t,function(r,i,o,s,a){wr("caret",n,r,i,o,s,a);var l;return eo(i)?l="":eo(o)?l=">="+i+".0.0 <"+(+i+1)+".0.0":eo(s)?i==="0"?l=">="+i+"."+o+".0 <"+i+"."+(+o+1)+".0":l=">="+i+"."+o+".0 <"+(+i+1)+".0.0":a?(wr("replaceCaret pr",a),i==="0"?o==="0"?l=">="+i+"."+o+"."+s+"-"+a+" <"+i+"."+o+"."+(+s+1):l=">="+i+"."+o+"."+s+"-"+a+" <"+i+"."+(+o+1)+".0":l=">="+i+"."+o+"."+s+"-"+a+" <"+(+i+1)+".0.0"):(wr("no pr"),i==="0"?o==="0"?l=">="+i+"."+o+"."+s+" <"+i+"."+o+"."+(+s+1):l=">="+i+"."+o+"."+s+" <"+i+"."+(+o+1)+".0":l=">="+i+"."+o+"."+s+" <"+(+i+1)+".0.0"),wr("caret return",l),l})}function uoe(n,e){return wr("replaceXRanges",n,e),n.split(/\s+/).map(function(t){return doe(t,e)}).join(" ")}function doe(n,e){n=n.trim();var t=e.loose?Wr[y$]:Wr[v$];return n.replace(t,function(r,i,o,s,a,l){wr("xRange",n,r,i,o,s,a,l);var c=eo(o),u=c||eo(s),d=u||eo(a),f=d;return i==="="&&f&&(i=""),c?i===">"||i==="<"?r="<0.0.0":r="*":i&&f?(u&&(s=0),a=0,i===">"?(i=">=",u?(o=+o+1,s=0,a=0):(s=+s+1,a=0)):i==="<="&&(i="<",u?o=+o+1:s=+s+1),r=i+o+"."+s+"."+a):u?r=">="+o+".0.0 <"+(+o+1)+".0.0":d&&(r=">="+o+"."+s+".0 <"+o+"."+(+s+1)+".0"),wr("xRange return",r),r})}function poe(n,e){return wr("replaceStars",n,e),n.trim().replace(Wr[k$],"")}function moe(n,e,t,r,i,o,s,a,l,c,u,d,f){return eo(t)?e="":eo(r)?e=">="+t+".0.0":eo(i)?e=">="+t+"."+r+".0":e=">="+e,eo(l)?a="":eo(c)?a="<"+(+l+1)+".0.0":eo(u)?a="<"+l+"."+(+c+1)+".0":d?a="<="+l+"."+c+"."+u+"-"+d:a="<="+a,(e+" "+a).trim()}cn.prototype.test=function(n){if(!n)return!1;typeof n=="string"&&(n=new $t(n,this.options));for(var e=0;e<this.set.length;e++)if(foe(this.set[e],n,this.options))return!0;return!1};function foe(n,e,t){for(var r=0;r<n.length;r++)if(!n[r].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(r=0;r<n.length;r++)if(wr(n[r].semver),n[r].semver!==BC&&n[r].semver.prerelease.length>0){var i=n[r].semver;if(i.major===e.major&&i.minor===e.minor&&i.patch===e.patch)return!0}return!1}return!0}Et.satisfies=Bk;function Bk(n,e,t){try{e=new cn(e,t)}catch{return!1}return e.test(n)}Et.maxSatisfying=hoe;function hoe(n,e,t){var r=null,i=null;try{var o=new cn(e,t)}catch{return null}return n.forEach(function(s){o.test(s)&&(!r||i.compare(s)===-1)&&(r=s,i=new $t(r,t))}),r}Et.minSatisfying=goe;function goe(n,e,t){var r=null,i=null;try{var o=new cn(e,t)}catch{return null}return n.forEach(function(s){o.test(s)&&(!r||i.compare(s)===1)&&(r=s,i=new $t(r,t))}),r}Et.minVersion=voe;function voe(n,e){n=new cn(n,e);var t=new $t("0.0.0");if(n.test(t)||(t=new $t("0.0.0-0"),n.test(t)))return t;t=null;for(var r=0;r<n.set.length;++r){var i=n.set[r];i.forEach(function(o){var s=new $t(o.semver.version);switch(o.operator){case">":s.prerelease.length===0?s.patch++:s.prerelease.push(0),s.raw=s.format();case"":case">=":(!t||VC(t,s))&&(t=s);break;case"<":case"<=":break;default:throw new Error("Unexpected operation: "+o.operator)}})}return t&&n.test(t)?t:null}Et.validRange=yoe;function yoe(n,e){try{return new cn(n,e).range||"*"}catch{return null}}Et.ltr=boe;function boe(n,e,t){return XN(n,e,"<",t)}Et.gtr=Ioe;function Ioe(n,e,t){return XN(n,e,">",t)}Et.outside=XN;function XN(n,e,t,r){n=new $t(n,r),e=new cn(e,r);var i,o,s,a,l;switch(t){case">":i=VC,o=YN,s=Vk,a=">",l=">=";break;case"<":i=Vk,o=QN,s=VC,a="<",l="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Bk(n,e,r))return!1;for(var c=0;c<e.set.length;++c){var u=e.set[c],d=null,f=null;if(u.forEach(function(g){g.semver===BC&&(g=new xs(">=0.0.0")),d=d||g,f=f||g,i(g.semver,d.semver,r)?d=g:s(g.semver,f.semver,r)&&(f=g)}),d.operator===a||d.operator===l||(!f.operator||f.operator===a)&&o(n,f.semver))return!1;if(f.operator===l&&s(n,f.semver))return!1}return!0}Et.prerelease=Soe;function Soe(n,e){var t=Pm(n,e);return t&&t.prerelease.length?t.prerelease:null}Et.intersects=Coe;function Coe(n,e,t){return n=new cn(n,t),e=new cn(e,t),n.intersects(e)}Et.coerce=Eoe;function Eoe(n){if(n instanceof $t)return n;if(typeof n!="string")return null;var e=n.match(Wr[b$]);return e==null?null:Pm(e[1]+"."+(e[2]||"0")+"."+(e[3]||"0"))}});var iM=F((OCe,tJ)=>{"use strict";var Z$=Array.isArray,eJ=Object.keys,Woe=Object.prototype.hasOwnProperty;tJ.exports=function n(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var r=Z$(e),i=Z$(t),o,s,a;if(r&&i){if(s=e.length,s!=t.length)return!1;for(o=s;o--!==0;)if(!n(e[o],t[o]))return!1;return!0}if(r!=i)return!1;var l=e instanceof Date,c=t instanceof Date;if(l!=c)return!1;if(l&&c)return e.getTime()==t.getTime();var u=e instanceof RegExp,d=t instanceof RegExp;if(u!=d)return!1;if(u&&d)return e.toString()==t.toString();var f=eJ(e);if(s=f.length,s!==eJ(t).length)return!1;for(o=s;o--!==0;)if(!Woe.call(t,f[o]))return!1;for(o=s;o--!==0;)if(a=f[o],!n(e[a],t[a]))return!1;return!0}return e!==e&&t!==t}});var nJ=F((VCe,rJ)=>{"use strict";rJ.exports=function(e,t){if(t=t.split(":")[0],e=+e,!e)return!1;switch(t){case"http":case"ws":return e!==80;case"https":case"wss":return e!==443;case"ftp":return e!==21;case"gopher":return e!==70;case"file":return!1}return e!==0}});var sJ=F(sM=>{"use strict";var Voe=Object.prototype.hasOwnProperty,joe;function iJ(n){try{return decodeURIComponent(n.replace(/\+/g," "))}catch{return null}}function oJ(n){try{return encodeURIComponent(n)}catch{return null}}function Boe(n){for(var e=/([^=?#&]+)=?([^&]*)/g,t={},r;r=e.exec(n);){var i=iJ(r[1]),o=iJ(r[2]);i===null||o===null||i in t||(t[i]=o)}return t}function $oe(n,e){e=e||"";var t=[],r,i;typeof e!="string"&&(e="?");for(i in n)if(Voe.call(n,i)){if(r=n[i],!r&&(r===null||r===joe||isNaN(r))&&(r=""),i=oJ(i),r=oJ(r),i===null||r===null)continue;t.push(i+"="+r)}return t.length?e+t.join("&"):""}sM.stringify=$oe;sM.parse=Boe});var fJ=F((BCe,mJ)=>{"use strict";var lJ=nJ(),ux=sJ(),Joe=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,cJ=/[\n\r\t]/g,qoe=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,uJ=/:\d+$/,Hoe=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,Goe=/^[a-zA-Z]:/;function lM(n){return(n||"").toString().replace(Joe,"")}var aM=[["#","hash"],["?","query"],function(e,t){return Rl(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],aJ={hash:1,query:1};function dJ(n){var e;typeof window<"u"?e=window:typeof global<"u"?e=global:typeof self<"u"?e=self:e={};var t=e.location||{};n=n||t;var r={},i=typeof n,o;if(n.protocol==="blob:")r=new Al(unescape(n.pathname),{});else if(i==="string"){r=new Al(n,{});for(o in aJ)delete r[o]}else if(i==="object"){for(o in n)o in aJ||(r[o]=n[o]);r.slashes===void 0&&(r.slashes=qoe.test(n.href))}return r}function Rl(n){return n==="file:"||n==="ftp:"||n==="http:"||n==="https:"||n==="ws:"||n==="wss:"}function pJ(n,e){n=lM(n),n=n.replace(cJ,""),e=e||{};var t=Hoe.exec(n),r=t[1]?t[1].toLowerCase():"",i=!!t[2],o=!!t[3],s=0,a;return i?o?(a=t[2]+t[3]+t[4],s=t[2].length+t[3].length):(a=t[2]+t[4],s=t[2].length):o?(a=t[3]+t[4],s=t[3].length):a=t[4],r==="file:"?s>=2&&(a=a.slice(2)):Rl(r)?a=t[4]:r?i&&(a=a.slice(2)):s>=2&&Rl(e.protocol)&&(a=t[4]),{protocol:r,slashes:i||Rl(r),slashesCount:s,rest:a}}function zoe(n,e){if(n==="")return e;for(var t=(e||"/").split("/").slice(0,-1).concat(n.split("/")),r=t.length,i=t[r-1],o=!1,s=0;r--;)t[r]==="."?t.splice(r,1):t[r]===".."?(t.splice(r,1),s++):s&&(r===0&&(o=!0),t.splice(r,1),s--);return o&&t.unshift(""),(i==="."||i==="..")&&t.push(""),t.join("/")}function Al(n,e,t){if(n=lM(n),n=n.replace(cJ,""),!(this instanceof Al))return new Al(n,e,t);var r,i,o,s,a,l,c=aM.slice(),u=typeof e,d=this,f=0;for(u!=="object"&&u!=="string"&&(t=e,e=null),t&&typeof t!="function"&&(t=ux.parse),e=dJ(e),i=pJ(n||"",e),r=!i.protocol&&!i.slashes,d.slashes=i.slashes||r&&e.slashes,d.protocol=i.protocol||e.protocol||"",n=i.rest,(i.protocol==="file:"&&(i.slashesCount!==2||Goe.test(n))||!i.slashes&&(i.protocol||i.slashesCount<2||!Rl(d.protocol)))&&(c[3]=[/(.*)/,"pathname"]);f<c.length;f++){if(s=c[f],typeof s=="function"){n=s(n,d);continue}o=s[0],l=s[1],o!==o?d[l]=n:typeof o=="string"?(a=o==="@"?n.lastIndexOf(o):n.indexOf(o),~a&&(typeof s[2]=="number"?(d[l]=n.slice(0,a),n=n.slice(a+s[2])):(d[l]=n.slice(a),n=n.slice(0,a)))):(a=o.exec(n))&&(d[l]=a[1],n=n.slice(0,a.index)),d[l]=d[l]||r&&s[3]&&e[l]||"",s[4]&&(d[l]=d[l].toLowerCase())}t&&(d.query=t(d.query)),r&&e.slashes&&d.pathname.charAt(0)!=="/"&&(d.pathname!==""||e.pathname!=="")&&(d.pathname=zoe(d.pathname,e.pathname)),d.pathname.charAt(0)!=="/"&&Rl(d.protocol)&&(d.pathname="/"+d.pathname),lJ(d.port,d.protocol)||(d.host=d.hostname,d.port=""),d.username=d.password="",d.auth&&(a=d.auth.indexOf(":"),~a?(d.username=d.auth.slice(0,a),d.username=encodeURIComponent(decodeURIComponent(d.username)),d.password=d.auth.slice(a+1),d.password=encodeURIComponent(decodeURIComponent(d.password))):d.username=encodeURIComponent(decodeURIComponent(d.auth)),d.auth=d.password?d.username+":"+d.password:d.username),d.origin=d.protocol!=="file:"&&Rl(d.protocol)&&d.host?d.protocol+"//"+d.host:"null",d.href=d.toString()}function Qoe(n,e,t){var r=this;switch(n){case"query":typeof e=="string"&&e.length&&(e=(t||ux.parse)(e)),r[n]=e;break;case"port":r[n]=e,lJ(e,r.protocol)?e&&(r.host=r.hostname+":"+e):(r.host=r.hostname,r[n]="");break;case"hostname":r[n]=e,r.port&&(e+=":"+r.port),r.host=e;break;case"host":r[n]=e,uJ.test(e)?(e=e.split(":"),r.port=e.pop(),r.hostname=e.join(":")):(r.hostname=e,r.port="");break;case"protocol":r.protocol=e.toLowerCase(),r.slashes=!t;break;case"pathname":case"hash":if(e){var i=n==="pathname"?"/":"#";r[n]=e.charAt(0)!==i?i+e:e}else r[n]=e;break;case"username":case"password":r[n]=encodeURIComponent(e);break;case"auth":var o=e.indexOf(":");~o?(r.username=e.slice(0,o),r.username=encodeURIComponent(decodeURIComponent(r.username)),r.password=e.slice(o+1),r.password=encodeURIComponent(decodeURIComponent(r.password))):r.username=encodeURIComponent(decodeURIComponent(e))}for(var s=0;s<aM.length;s++){var a=aM[s];a[4]&&(r[a[1]]=r[a[1]].toLowerCase())}return r.auth=r.password?r.username+":"+r.password:r.username,r.origin=r.protocol!=="file:"&&Rl(r.protocol)&&r.host?r.protocol+"//"+r.host:"null",r.href=r.toString(),r}function Yoe(n){(!n||typeof n!="function")&&(n=ux.stringify);var e,t=this,r=t.host,i=t.protocol;i&&i.charAt(i.length-1)!==":"&&(i+=":");var o=i+(t.protocol&&t.slashes||Rl(t.protocol)?"//":"");return t.username?(o+=t.username,t.password&&(o+=":"+t.password),o+="@"):t.password?(o+=":"+t.password,o+="@"):t.protocol!=="file:"&&Rl(t.protocol)&&!r&&t.pathname!=="/"&&(o+="@"),(r[r.length-1]===":"||uJ.test(t.hostname)&&!t.port)&&(r+=":"),o+=r+t.pathname,e=typeof t.query=="object"?n(t.query):t.query,e&&(o+=e.charAt(0)!=="?"?"?"+e:e),t.hash&&(o+=t.hash),o}Al.prototype={set:Qoe,toString:Yoe};Al.extractProtocol=pJ;Al.location=dJ;Al.trimLeft=lM;Al.qs=ux;mJ.exports=Al});var xM=F(jd=>{"use strict";Object.defineProperty(jd,"__esModule",{value:!0});jd.TargetPopulation=jd.Filters=jd.VSCodeFilterProvider=void 0;var Bx=require("vscode"),kM=class n{constructor(e,t,r){this.extensionName=e,this.extensionVersion=t,this.targetPopulation=r}static trimVersionSuffix(e){let t=/\-[a-zA-Z0-9]+$/;return e.split(t)[0]}getFilterValue(e){switch(e){case jl.ApplicationVersion:return n.trimVersionSuffix(Bx.version);case jl.Build:return Bx.env.appName;case jl.ClientId:return Bx.env.machineId;case jl.ExtensionName:return this.extensionName;case jl.ExtensionVersion:return n.trimVersionSuffix(this.extensionVersion);case jl.Language:return Bx.env.language;case jl.TargetPopulation:return this.targetPopulation;default:return""}}getFilters(){let e=new Map,t=Object.values(jl);for(let r of t)e.set(r,this.getFilterValue(r));return e}};jd.VSCodeFilterProvider=kM;var jl;(function(n){n.Market="X-MSEdge-Market",n.CorpNet="X-FD-Corpnet",n.ApplicationVersion="X-VSCode-AppVersion",n.Build="X-VSCode-Build",n.ClientId="X-MSEdge-ClientId",n.ExtensionName="X-VSCode-ExtensionName",n.ExtensionVersion="X-VSCode-ExtensionVersion",n.Language="X-VSCode-Language",n.TargetPopulation="X-VSCode-TargetPopulation"})(jl||(jd.Filters=jl={}));var h3;(function(n){n.Team="team",n.Internal="internal",n.Insiders="insider",n.Public="public"})(h3||(jd.TargetPopulation=h3={}))});var g3=F($x=>{"use strict";Object.defineProperty($x,"__esModule",{value:!0});$x.BaseFeatureProvider=void 0;var DM=class{constructor(e){this.telemetry=e,this.isFetching=!1}async getFeatures(){if(this.isFetching&&this.fetchPromise)return this.fetchPromise;this.fetchPromise=this.fetch();let e=await this.fetchPromise;return this.isFetching=!1,this.fetchPromise=void 0,e}};$x.BaseFeatureProvider=DM});var v3=F(Jx=>{"use strict";Object.defineProperty(Jx,"__esModule",{value:!0});Jx.FilteredFeatureProvider=void 0;var Ese=g3(),_M=class extends Ese.BaseFeatureProvider{constructor(e,t){super(e),this.telemetry=e,this.filterProviders=t,this.cachedTelemetryEvents=[]}getFilters(){let e=new Map;for(let t of this.filterProviders){let r=t.getFilters();for(let i of r.keys()){let o=r.get(i);e.set(i,o)}}return e}PostEventToTelemetry(e){if(this.cachedTelemetryEvents.includes(e))return;let t=JSON.stringify(e);this.telemetry.postEvent("report-headers",new Map([["ABExp.headers",t]])),this.cachedTelemetryEvents.push(e)}};Jx.FilteredFeatureProvider=_M});var y3=F(Bd=>{"use strict";Object.defineProperty(Bd,"__esModule",{value:!0});Bd.TasApiFeatureProvider=Bd.TASAPI_FETCHERROR_EVENTNAME=void 0;var wse=v3();Bd.TASAPI_FETCHERROR_EVENTNAME="call-tas-error";var TM="ErrorType",RM=class extends wse.FilteredFeatureProvider{constructor(e,t,r){super(t,r),this.httpClient=e,this.telemetry=t,this.filterProviders=r}async fetch(){let e=this.getFilters(),t={};for(let a of e.keys()){let l=e.get(a);t[a]=l}let r;try{r=await this.httpClient.get({headers:t})}catch(a){let l=a,c=new Map;l.responseReceived&&!l.responseOk?c.set(TM,"ServerError"):l.responseReceived===!1?c.set(TM,"NoResponse"):c.set(TM,"GenericError"),this.telemetry.postEvent(Bd.TASAPI_FETCHERROR_EVENTNAME,c)}if(!r)throw Error(Bd.TASAPI_FETCHERROR_EVENTNAME);e.keys.length>0&&this.PostEventToTelemetry(t);let i=r.data,o=i.Configs,s=[];for(let a of o)if(a.Parameters)for(let l of Object.keys(a.Parameters)){let c=l+(a.Parameters[l]?"":"cf");s.includes(c)||s.push(c)}return{features:s,assignmentContext:i.AssignmentContext,configs:o}}};Bd.TasApiFeatureProvider=RM});var b3=F(Xg=>{"use strict";Object.defineProperty(Xg,"__esModule",{value:!0});Xg.HttpClient=Xg.FetchError=void 0;var Yg=class extends Error{constructor(e,t,r){super(e),this.responseReceived=t,this.responseOk=r}};Xg.FetchError=Yg;var AM=class{constructor(e){this.endpoint=e}async get(e){let t=await fetch(this.endpoint,{method:"GET",headers:e?.headers});if(!t)throw new Yg("No response received",!1);if(!t.ok)throw new Yg("Response not ok",!0,!1);let r=await t.json();if(!r)throw new Yg("No data received",!1);return{data:r}}};Xg.HttpClient=AM});var I3=F(qx=>{"use strict";Object.defineProperty(qx,"__esModule",{value:!0});qx.MemoryKeyValueStorage=void 0;var NM=class{constructor(){this.storage=new Map}async getValue(e,t){return this.storage.has(e)?await Promise.resolve(this.storage.get(e)):await Promise.resolve(t||void 0)}setValue(e,t){this.storage.set(e,t)}};qx.MemoryKeyValueStorage=NM});var S3=F(Hx=>{"use strict";Object.defineProperty(Hx,"__esModule",{value:!0});Hx.ExperimentationServiceBase=void 0;var Pse=I3(),MM=class{get features(){return this._features}set features(e){this._features=e,this.telemetry&&this.telemetry.setSharedProperty(this.assignmentContextTelemetryPropertyName,this.features.assignmentContext)}constructor(e,t,r,i,o){this.telemetry=e,this.assignmentContextTelemetryPropertyName=t,this.telemetryEventName=r,this.storageKey=i,this.storage=o,this.featuresConsumed=!1,this.cachedTelemetryEvents=[],this._features={features:[],assignmentContext:"",configs:[]},this.storageKey||(this.storageKey="ABExp.Features"),this.storage||(o=new Pse.MemoryKeyValueStorage),this.loadCachePromise=this.loadCachedFeatureData(),this.initializePromise=this.loadCachePromise,this.initialFetch=new Promise((s,a)=>{this.resolveInitialFetchPromise=s})}async getFeaturesAsync(e=!1){if(this.fetchPromise!=null){try{await this.fetchPromise}catch{}return this.features}if(!this.featureProviders||this.featureProviders.length===0)return Promise.resolve({features:[],assignmentContext:"",configs:[]});try{this.fetchPromise=Promise.all(this.featureProviders.map(async r=>await r.getFeatures()));let t=await this.fetchPromise;this.updateFeatures(t,e)}catch{}return this.fetchPromise=void 0,this.resolveInitialFetchPromise&&(this.resolveInitialFetchPromise(),this.resolveInitialFetchPromise=void 0),this.features}updateFeatures(e,t=!1){let r={features:[],assignmentContext:"",configs:[]};for(let i of e){for(let o of i.features)r.features.includes(o)||r.features.push(o);for(let o of i.configs){let s=r.configs.find(a=>a.Id===o.Id);s?s.Parameters=Object.assign(Object.assign({},s.Parameters),o.Parameters):r.configs.push(o)}r.assignmentContext+=i.assignmentContext}(t||!this.featuresConsumed)&&(this.features=r),this.storage&&this.storage.setValue(this.storageKey,r)}async loadCachedFeatureData(){let e;this.storage&&(e=await this.storage.getValue(this.storageKey),e!==void 0&&e.configs===void 0&&(e.configs=[])),this.features.features.length===0&&(this.features=e||{features:[],assignmentContext:"",configs:[]})}isFlightEnabled(e){return this.featuresConsumed=!0,this.PostEventToTelemetry(e),this.features.features.includes(e)}async isCachedFlightEnabled(e){return await this.loadCachePromise,this.featuresConsumed=!0,this.PostEventToTelemetry(e),this.features.features.includes(e)}async isFlightEnabledAsync(e){let t=await this.getFeaturesAsync(!0);return this.featuresConsumed=!0,this.PostEventToTelemetry(e),t.features.includes(e)}getTreatmentVariable(e,t){this.featuresConsumed=!0,this.PostEventToTelemetry(`${e}.${t}`);let r=this.features.configs.find(i=>i.Id===e);return r?.Parameters[t]}async getTreatmentVariableAsync(e,t,r){if(r){let i=this.featuresConsumed,o=this.getTreatmentVariable(e,t);if(o===void 0)this.featuresConsumed=i;else return o}return await this.getFeaturesAsync(!0),this.getTreatmentVariable(e,t)}PostEventToTelemetry(e){this.cachedTelemetryEvents.includes(e)||(this.telemetry.postEvent(this.telemetryEventName,new Map([["ABExp.queriedFeature",e]])),this.cachedTelemetryEvents.push(e))}invokeInit(){this.init()}addFeatureProvider(...e){if(!(e==null||this.featureProviders==null))for(let t of e)this.featureProviders.push(t)}};Hx.ExperimentationServiceBase=MM});var C3=F(Gx=>{"use strict";Object.defineProperty(Gx,"__esModule",{value:!0});Gx.PollingService=void 0;var KM=class{constructor(e){this.fetchInterval=e}StopPolling(){clearInterval(this.intervalHandle),this.intervalHandle=void 0}OnPollTick(e){this.onTick=e}StartPolling(e=!1){this.intervalHandle&&this.StopPolling(),this.onTick!=null&&(e&&this.onTick().then(()=>{}).catch(()=>{}),this.intervalHandle=setInterval(async()=>{await this.onTick()},this.fetchInterval),this.intervalHandle.unref&&this.intervalHandle.unref())}};Gx.PollingService=KM});var E3=F(zx=>{"use strict";Object.defineProperty(zx,"__esModule",{value:!0});zx.ExperimentationServiceAutoPolling=void 0;var kse=S3(),xse=C3(),OM=class extends kse.ExperimentationServiceBase{constructor(e,t,r,i,o,s,a){if(super(e,i,o,s,a),this.telemetry=e,this.filterProviders=t,this.refreshRateMs=r,this.assignmentContextTelemetryPropertyName=i,this.telemetryEventName=o,this.storageKey=s,this.storage=a,r<1e3&&r!==0)throw new Error("The minimum refresh rate for polling is 1000 ms (1 second). If you wish to deactivate this auto-polling use value of 0.");r>0&&(this.pollingService=new xse.PollingService(r),this.pollingService.OnPollTick(async()=>{await super.getFeaturesAsync()}))}init(){this.pollingService?this.pollingService.StartPolling(!0):super.getFeaturesAsync()}async getFeaturesAsync(e=!1){if(this.pollingService){this.pollingService.StopPolling();let t=await super.getFeaturesAsync(e);return this.pollingService.StartPolling(),t}else return await super.getFeaturesAsync(e)}};zx.ExperimentationServiceAutoPolling=OM});var w3=F(Yx=>{"use strict";Object.defineProperty(Yx,"__esModule",{value:!0});Yx.ExperimentationService=void 0;var Dse=y3(),_se=b3(),Tse=E3(),Qx=class extends Tse.ExperimentationServiceAutoPolling{constructor(e){super(e.telemetry,e.filterProviders||[],e.refetchInterval!=null?e.refetchInterval:0,e.assignmentContextTelemetryPropertyName,e.telemetryEventName,e.storageKey,e.keyValueStorage),this.options=e,this.invokeInit()}init(){this.featureProviders=[],this.addFeatureProvider(new Dse.TasApiFeatureProvider(new _se.HttpClient(this.options.endpoint),this.telemetry,this.filterProviders)),super.init()}};Yx.ExperimentationService=Qx;Qx.REFRESH_RATE_IN_MINUTES=30});var P3=F(Xx=>{"use strict";Object.defineProperty(Xx,"__esModule",{value:!0});Xx.ExperimentationService=void 0;var Rse=w3();Object.defineProperty(Xx,"ExperimentationService",{enumerable:!0,get:function(){return Rse.ExperimentationService}})});var k3=F(Zx=>{"use strict";Object.defineProperty(Zx,"__esModule",{value:!0});Zx.MementoKeyValueStorage=void 0;var FM=class{constructor(e){this.mementoGlobalStorage=e}async getValue(e,t){return await this.mementoGlobalStorage.get(e)||t}setValue(e,t){this.mementoGlobalStorage.update(e,t)}};Zx.MementoKeyValueStorage=FM});var x3=F(UM=>{"use strict";Object.defineProperty(UM,"__esModule",{value:!0});var LM=class{constructor(){this.initializePromise=Promise.resolve(),this.initialFetch=Promise.resolve()}isFlightEnabled(e){return!1}isCachedFlightEnabled(e){return Promise.resolve(!1)}isFlightEnabledAsync(e){return Promise.resolve(!1)}getTreatmentVariable(e,t){}getTreatmentVariableAsync(e,t){return Promise.resolve(void 0)}};UM.default=LM});var _3=F(Zg=>{"use strict";Object.defineProperty(Zg,"__esModule",{value:!0});Zg.getExperimentationServiceAsync=Zg.getExperimentationService=void 0;var Ase=xM(),Nse=P3(),WM=require("vscode"),Mse=k3(),Kse=x3(),Ose="https://default.exp-tas.com/vscode/ab",Fse="query-expfeature",Lse="abexp.assignmentcontext",Use="VSCode.ABExp.FeatureData",Wse=1e3*60*30;function D3(n,e,t,r,i,...o){if(!i)throw new Error("Memento storage was not provided.");let s=WM.workspace.getConfiguration("telemetry");if(!(WM.env.isTelemetryEnabled===void 0?s.get("enableTelemetry",!0):WM.env.isTelemetryEnabled))return new Kse.default;let c=[new Ase.VSCodeFilterProvider(n,e,t),...o],u=new Mse.MementoKeyValueStorage(i);return new Nse.ExperimentationService({filterProviders:c,telemetry:r,storageKey:Use,keyValueStorage:u,featuresTelemetryPropertyName:"",assignmentContextTelemetryPropertyName:Lse,telemetryEventName:Fse,endpoint:Ose,refetchInterval:Wse})}Zg.getExperimentationService=D3;async function Vse(n,e,t,r,i,...o){let s=D3(n,e,t,r,i,...o);return await s.initializePromise,s}Zg.getExperimentationServiceAsync=Vse});var R3=F($d=>{"use strict";Object.defineProperty($d,"__esModule",{value:!0});$d.TargetPopulation=$d.getExperimentationServiceAsync=$d.getExperimentationService=void 0;var T3=_3();Object.defineProperty($d,"getExperimentationService",{enumerable:!0,get:function(){return T3.getExperimentationService}});Object.defineProperty($d,"getExperimentationServiceAsync",{enumerable:!0,get:function(){return T3.getExperimentationServiceAsync}});var jse=xM();Object.defineProperty($d,"TargetPopulation",{enumerable:!0,get:function(){return jse.TargetPopulation}})});var j3=F((Z_e,V3)=>{"use strict";function Jse(){let n=[].slice.call(arguments).filter(t=>t),e=n.shift();return n.forEach(t=>{Object.keys(t).forEach(r=>{e[r]=t[r]})}),e}V3.exports=Jse});var So=F(BM=>{"use strict";BM.fromCallback=function(n){return Object.defineProperty(function(){if(typeof arguments[arguments.length-1]=="function")n.apply(this,arguments);else return new Promise((e,t)=>{arguments[arguments.length]=(r,i)=>{if(r)return t(r);e(i)},arguments.length++,n.apply(this,arguments)})},"name",{value:n.name})};BM.fromPromise=function(n){return Object.defineProperty(function(){let e=arguments[arguments.length-1];if(typeof e!="function")return n.apply(this,arguments);n.apply(this,arguments).then(t=>e(null,t),e)},"name",{value:n.name})}});var $3=F((tTe,B3)=>{var Gd=require("constants"),qse=process.cwd,sD=null,Hse=process.env.GRACEFUL_FS_PLATFORM||process.platform;process.cwd=function(){return sD||(sD=qse.call(process)),sD};try{process.cwd()}catch{}typeof process.chdir=="function"&&($M=process.chdir,process.chdir=function(n){sD=null,$M.call(process,n)},Object.setPrototypeOf&&Object.setPrototypeOf(process.chdir,$M));var $M;B3.exports=Gse;function Gse(n){Gd.hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&e(n),n.lutimes||t(n),n.chown=o(n.chown),n.fchown=o(n.fchown),n.lchown=o(n.lchown),n.chmod=r(n.chmod),n.fchmod=r(n.fchmod),n.lchmod=r(n.lchmod),n.chownSync=s(n.chownSync),n.fchownSync=s(n.fchownSync),n.lchownSync=s(n.lchownSync),n.chmodSync=i(n.chmodSync),n.fchmodSync=i(n.fchmodSync),n.lchmodSync=i(n.lchmodSync),n.stat=a(n.stat),n.fstat=a(n.fstat),n.lstat=a(n.lstat),n.statSync=l(n.statSync),n.fstatSync=l(n.fstatSync),n.lstatSync=l(n.lstatSync),n.chmod&&!n.lchmod&&(n.lchmod=function(u,d,f){f&&process.nextTick(f)},n.lchmodSync=function(){}),n.chown&&!n.lchown&&(n.lchown=function(u,d,f,g){g&&process.nextTick(g)},n.lchownSync=function(){}),Hse==="win32"&&(n.rename=typeof n.rename!="function"?n.rename:function(u){function d(f,g,b){var I=Date.now(),w=0;u(f,g,function _(A){if(A&&(A.code==="EACCES"||A.code==="EPERM"||A.code==="EBUSY")&&Date.now()-I<6e4){setTimeout(function(){n.stat(g,function(R,V){R&&R.code==="ENOENT"?u(f,g,_):b(A)})},w),w<100&&(w+=10);return}b&&b(A)})}return Object.setPrototypeOf&&Object.setPrototypeOf(d,u),d}(n.rename)),n.read=typeof n.read!="function"?n.read:function(u){function d(f,g,b,I,w,_){var A;if(_&&typeof _=="function"){var R=0;A=function(V,ie,Q){if(V&&V.code==="EAGAIN"&&R<10)return R++,u.call(n,f,g,b,I,w,A);_.apply(this,arguments)}}return u.call(n,f,g,b,I,w,A)}return Object.setPrototypeOf&&Object.setPrototypeOf(d,u),d}(n.read),n.readSync=typeof n.readSync!="function"?n.readSync:function(u){return function(d,f,g,b,I){for(var w=0;;)try{return u.call(n,d,f,g,b,I)}catch(_){if(_.code==="EAGAIN"&&w<10){w++;continue}throw _}}}(n.readSync);function e(u){u.lchmod=function(d,f,g){u.open(d,Gd.O_WRONLY|Gd.O_SYMLINK,f,function(b,I){if(b){g&&g(b);return}u.fchmod(I,f,function(w){u.close(I,function(_){g&&g(w||_)})})})},u.lchmodSync=function(d,f){var g=u.openSync(d,Gd.O_WRONLY|Gd.O_SYMLINK,f),b=!0,I;try{I=u.fchmodSync(g,f),b=!1}finally{if(b)try{u.closeSync(g)}catch{}else u.closeSync(g)}return I}}function t(u){Gd.hasOwnProperty("O_SYMLINK")&&u.futimes?(u.lutimes=function(d,f,g,b){u.open(d,Gd.O_SYMLINK,function(I,w){if(I){b&&b(I);return}u.futimes(w,f,g,function(_){u.close(w,function(A){b&&b(_||A)})})})},u.lutimesSync=function(d,f,g){var b=u.openSync(d,Gd.O_SYMLINK),I,w=!0;try{I=u.futimesSync(b,f,g),w=!1}finally{if(w)try{u.closeSync(b)}catch{}else u.closeSync(b)}return I}):u.futimes&&(u.lutimes=function(d,f,g,b){b&&process.nextTick(b)},u.lutimesSync=function(){})}function r(u){return u&&function(d,f,g){return u.call(n,d,f,function(b){c(b)&&(b=null),g&&g.apply(this,arguments)})}}function i(u){return u&&function(d,f){try{return u.call(n,d,f)}catch(g){if(!c(g))throw g}}}function o(u){return u&&function(d,f,g,b){return u.call(n,d,f,g,function(I){c(I)&&(I=null),b&&b.apply(this,arguments)})}}function s(u){return u&&function(d,f,g){try{return u.call(n,d,f,g)}catch(b){if(!c(b))throw b}}}function a(u){return u&&function(d,f,g){typeof f=="function"&&(g=f,f=null);function b(I,w){w&&(w.uid<0&&(w.uid+=4294967296),w.gid<0&&(w.gid+=4294967296)),g&&g.apply(this,arguments)}return f?u.call(n,d,f,b):u.call(n,d,b)}}function l(u){return u&&function(d,f){var g=f?u.call(n,d,f):u.call(n,d);return g&&(g.uid<0&&(g.uid+=4294967296),g.gid<0&&(g.gid+=4294967296)),g}}function c(u){if(!u||u.code==="ENOSYS")return!0;var d=!process.getuid||process.getuid()!==0;return!!(d&&(u.code==="EINVAL"||u.code==="EPERM"))}}});var H3=F((rTe,q3)=>{var J3=require("stream").Stream;q3.exports=zse;function zse(n){return{ReadStream:e,WriteStream:t};function e(r,i){if(!(this instanceof e))return new e(r,i);J3.call(this);var o=this;this.path=r,this.fd=null,this.readable=!0,this.paused=!1,this.flags="r",this.mode=438,this.bufferSize=64*1024,i=i||{};for(var s=Object.keys(i),a=0,l=s.length;a<l;a++){var c=s[a];this[c]=i[c]}if(this.encoding&&this.setEncoding(this.encoding),this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.end===void 0)this.end=1/0;else if(typeof this.end!="number")throw TypeError("end must be a Number");if(this.start>this.end)throw new Error("start must be <= end");this.pos=this.start}if(this.fd!==null){process.nextTick(function(){o._read()});return}n.open(this.path,this.flags,this.mode,function(u,d){if(u){o.emit("error",u),o.readable=!1;return}o.fd=d,o.emit("open",d),o._read()})}function t(r,i){if(!(this instanceof t))return new t(r,i);J3.call(this),this.path=r,this.fd=null,this.writable=!0,this.flags="w",this.encoding="binary",this.mode=438,this.bytesWritten=0,i=i||{};for(var o=Object.keys(i),s=0,a=o.length;s<a;s++){var l=o[s];this[l]=i[l]}if(this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.start<0)throw new Error("start must be >= zero");this.pos=this.start}this.busy=!1,this._queue=[],this.fd===null&&(this._open=n.open,this._queue.push([this._open,this.path,this.flags,this.mode,void 0]),this.flush())}}});var z3=F((nTe,G3)=>{"use strict";G3.exports=Yse;var Qse=Object.getPrototypeOf||function(n){return n.__proto__};function Yse(n){if(n===null||typeof n!="object")return n;if(n instanceof Object)var e={__proto__:Qse(n)};else var e=Object.create(null);return Object.getOwnPropertyNames(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}),e}});var Dn=F((iTe,HM)=>{var dn=require("fs"),Xse=$3(),Zse=H3(),eae=z3(),aD=require("util"),mi,cD;typeof Symbol=="function"&&typeof Symbol.for=="function"?(mi=Symbol.for("graceful-fs.queue"),cD=Symbol.for("graceful-fs.previous")):(mi="___graceful-fs.queue",cD="___graceful-fs.previous");function tae(){}function X3(n,e){Object.defineProperty(n,mi,{get:function(){return e}})}var Wm=tae;aD.debuglog?Wm=aD.debuglog("gfs4"):/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&(Wm=function(){var n=aD.format.apply(aD,arguments);n="GFS4: "+n.split(/\n/).join(`
GFS4: `),console.error(n)});dn[mi]||(Q3=global[mi]||[],X3(dn,Q3),dn.close=function(n){function e(t,r){return n.call(dn,t,function(i){i||Y3(),typeof r=="function"&&r.apply(this,arguments)})}return Object.defineProperty(e,cD,{value:n}),e}(dn.close),dn.closeSync=function(n){function e(t){n.apply(dn,arguments),Y3()}return Object.defineProperty(e,cD,{value:n}),e}(dn.closeSync),/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&process.on("exit",function(){Wm(dn[mi]),require("assert").equal(dn[mi].length,0)}));var Q3;global[mi]||X3(global,dn[mi]);HM.exports=JM(eae(dn));process.env.TEST_GRACEFUL_FS_GLOBAL_PATCH&&!dn.__patched&&(HM.exports=JM(dn),dn.__patched=!0);function JM(n){Xse(n),n.gracefulify=JM,n.createReadStream=ie,n.createWriteStream=Q;var e=n.readFile;n.readFile=t;function t(Y,be,Fe){return typeof be=="function"&&(Fe=be,be=null),ft(Y,be,Fe);function ft(ht,xt,ee,ke){return e(ht,xt,function(Te){Te&&(Te.code==="EMFILE"||Te.code==="ENFILE")?sv([ft,[ht,xt,ee],Te,ke||Date.now(),Date.now()]):typeof ee=="function"&&ee.apply(this,arguments)})}}var r=n.writeFile;n.writeFile=i;function i(Y,be,Fe,ft){return typeof Fe=="function"&&(ft=Fe,Fe=null),ht(Y,be,Fe,ft);function ht(xt,ee,ke,Te,ve){return r(xt,ee,ke,function(vt){vt&&(vt.code==="EMFILE"||vt.code==="ENFILE")?sv([ht,[xt,ee,ke,Te],vt,ve||Date.now(),Date.now()]):typeof Te=="function"&&Te.apply(this,arguments)})}}var o=n.appendFile;o&&(n.appendFile=s);function s(Y,be,Fe,ft){return typeof Fe=="function"&&(ft=Fe,Fe=null),ht(Y,be,Fe,ft);function ht(xt,ee,ke,Te,ve){return o(xt,ee,ke,function(vt){vt&&(vt.code==="EMFILE"||vt.code==="ENFILE")?sv([ht,[xt,ee,ke,Te],vt,ve||Date.now(),Date.now()]):typeof Te=="function"&&Te.apply(this,arguments)})}}var a=n.copyFile;a&&(n.copyFile=l);function l(Y,be,Fe,ft){return typeof Fe=="function"&&(ft=Fe,Fe=0),ht(Y,be,Fe,ft);function ht(xt,ee,ke,Te,ve){return a(xt,ee,ke,function(vt){vt&&(vt.code==="EMFILE"||vt.code==="ENFILE")?sv([ht,[xt,ee,ke,Te],vt,ve||Date.now(),Date.now()]):typeof Te=="function"&&Te.apply(this,arguments)})}}var c=n.readdir;n.readdir=d;var u=/^v[0-5]\./;function d(Y,be,Fe){typeof be=="function"&&(Fe=be,be=null);var ft=u.test(process.version)?function(ee,ke,Te,ve){return c(ee,ht(ee,ke,Te,ve))}:function(ee,ke,Te,ve){return c(ee,ke,ht(ee,ke,Te,ve))};return ft(Y,be,Fe);function ht(xt,ee,ke,Te){return function(ve,vt){ve&&(ve.code==="EMFILE"||ve.code==="ENFILE")?sv([ft,[xt,ee,ke],ve,Te||Date.now(),Date.now()]):(vt&&vt.sort&&vt.sort(),typeof ke=="function"&&ke.call(this,ve,vt))}}}if(process.version.substr(0,4)==="v0.8"){var f=Zse(n);_=f.ReadStream,R=f.WriteStream}var g=n.ReadStream;g&&(_.prototype=Object.create(g.prototype),_.prototype.open=A);var b=n.WriteStream;b&&(R.prototype=Object.create(b.prototype),R.prototype.open=V),Object.defineProperty(n,"ReadStream",{get:function(){return _},set:function(Y){_=Y},enumerable:!0,configurable:!0}),Object.defineProperty(n,"WriteStream",{get:function(){return R},set:function(Y){R=Y},enumerable:!0,configurable:!0});var I=_;Object.defineProperty(n,"FileReadStream",{get:function(){return I},set:function(Y){I=Y},enumerable:!0,configurable:!0});var w=R;Object.defineProperty(n,"FileWriteStream",{get:function(){return w},set:function(Y){w=Y},enumerable:!0,configurable:!0});function _(Y,be){return this instanceof _?(g.apply(this,arguments),this):_.apply(Object.create(_.prototype),arguments)}function A(){var Y=this;ae(Y.path,Y.flags,Y.mode,function(be,Fe){be?(Y.autoClose&&Y.destroy(),Y.emit("error",be)):(Y.fd=Fe,Y.emit("open",Fe),Y.read())})}function R(Y,be){return this instanceof R?(b.apply(this,arguments),this):R.apply(Object.create(R.prototype),arguments)}function V(){var Y=this;ae(Y.path,Y.flags,Y.mode,function(be,Fe){be?(Y.destroy(),Y.emit("error",be)):(Y.fd=Fe,Y.emit("open",Fe))})}function ie(Y,be){return new n.ReadStream(Y,be)}function Q(Y,be){return new n.WriteStream(Y,be)}var te=n.open;n.open=ae;function ae(Y,be,Fe,ft){return typeof Fe=="function"&&(ft=Fe,Fe=null),ht(Y,be,Fe,ft);function ht(xt,ee,ke,Te,ve){return te(xt,ee,ke,function(vt,qi){vt&&(vt.code==="EMFILE"||vt.code==="ENFILE")?sv([ht,[xt,ee,ke,Te],vt,ve||Date.now(),Date.now()]):typeof Te=="function"&&Te.apply(this,arguments)})}}return n}function sv(n){Wm("ENQUEUE",n[0].name,n[1]),dn[mi].push(n),qM()}var lD;function Y3(){for(var n=Date.now(),e=0;e<dn[mi].length;++e)dn[mi][e].length>2&&(dn[mi][e][3]=n,dn[mi][e][4]=n);qM()}function qM(){if(clearTimeout(lD),lD=void 0,dn[mi].length!==0){var n=dn[mi].shift(),e=n[0],t=n[1],r=n[2],i=n[3],o=n[4];if(i===void 0)Wm("RETRY",e.name,t),e.apply(null,t);else if(Date.now()-i>=6e4){Wm("TIMEOUT",e.name,t);var s=t.pop();typeof s=="function"&&s.call(null,r)}else{var a=Date.now()-o,l=Math.max(o-i,1),c=Math.min(l*1.2,100);a>=c?(Wm("RETRY",e.name,t),e.apply(null,t.concat([i]))):dn[mi].push(n)}lD===void 0&&(lD=setTimeout(qM,0))}}});var GM=F(av=>{var rae=So().fromCallback,Pa=Dn(),nae=["access","appendFile","chmod","chown","close","copyFile","fchmod","fchown","fdatasync","fstat","fsync","ftruncate","futimes","lchown","link","lstat","mkdir","mkdtemp","open","readFile","readdir","readlink","realpath","rename","rmdir","stat","symlink","truncate","unlink","utimes","writeFile"].filter(n=>typeof Pa[n]=="function");Object.keys(Pa).forEach(n=>{av[n]=Pa[n]});nae.forEach(n=>{av[n]=rae(Pa[n])});av.exists=function(n,e){return typeof e=="function"?Pa.exists(n,e):new Promise(t=>Pa.exists(n,t))};av.read=function(n,e,t,r,i,o){return typeof o=="function"?Pa.read(n,e,t,r,i,o):new Promise((s,a)=>{Pa.read(n,e,t,r,i,(l,c,u)=>{if(l)return a(l);s({bytesRead:c,buffer:u})})})};av.write=function(n,e,t,r,i,o){return typeof arguments[arguments.length-1]=="function"?Pa.write(n,e,t,r,i,o):typeof e=="string"?new Promise((s,a)=>{Pa.write(n,e,t,r,(l,c,u)=>{if(l)return a(l);s({bytesWritten:c,buffer:u})})}):new Promise((s,a)=>{Pa.write(n,e,t,r,i,(l,c,u)=>{if(l)return a(l);s({bytesWritten:c,buffer:u})})})}});var t6=F((sTe,e6)=>{"use strict";var qo=Dn(),Z3=require("os"),uD=require("path");function iae(){let n=uD.join("millis-test-sync"+Date.now().toString()+Math.random().toString().slice(2));n=uD.join(Z3.tmpdir(),n);let e=new Date(1435410243862);qo.writeFileSync(n,"https://github.com/jprichardson/node-fs-extra/pull/141");let t=qo.openSync(n,"r+");return qo.futimesSync(t,e,e),qo.closeSync(t),qo.statSync(n).mtime>1435410243e3}function oae(n){let e=uD.join("millis-test"+Date.now().toString()+Math.random().toString().slice(2));e=uD.join(Z3.tmpdir(),e);let t=new Date(1435410243862);qo.writeFile(e,"https://github.com/jprichardson/node-fs-extra/pull/141",r=>{if(r)return n(r);qo.open(e,"r+",(i,o)=>{if(i)return n(i);qo.futimes(o,t,t,s=>{if(s)return n(s);qo.close(o,a=>{if(a)return n(a);qo.stat(e,(l,c)=>{if(l)return n(l);n(null,c.mtime>1435410243e3)})})})})})}function sae(n){if(typeof n=="number")return Math.floor(n/1e3)*1e3;if(n instanceof Date)return new Date(Math.floor(n.getTime()/1e3)*1e3);throw new Error("fs-extra: timeRemoveMillis() unknown parameter type")}function aae(n,e,t,r){qo.open(n,"r+",(i,o)=>{if(i)return r(i);qo.futimes(o,e,t,s=>{qo.close(o,a=>{r&&r(s||a)})})})}e6.exports={hasMillisRes:oae,hasMillisResSync:iae,timeRemoveMillis:sae,utimesMillis:aae}});var zM=F((aTe,r6)=>{var Ho=Dn(),cE=require("path"),lae=t6();function cae(n,e,t,r){r||(r=t,t={});var i=process.cwd(),o=cE.resolve(i,n),s=cE.resolve(i,e),a=t.filter,l=t.transform,c=t.overwrite;c===void 0&&(c=t.clobber),c===void 0&&(c=!0);var u=t.errorOnExist,d=t.dereference,f=t.preserveTimestamps===!0,g=0,b=0,I=0,w=!1;_(o);function _(ee){if(g++,a){if(a instanceof RegExp){if(console.warn("Warning: fs-extra: Passing a RegExp filter is deprecated, use a function"),!a.test(ee))return xt(!0)}else if(typeof a=="function"&&!a(ee,e))return xt(!0)}return A(ee)}function A(ee){var ke=d?Ho.stat:Ho.lstat;I++,ke(ee,function(Te,ve){if(Te)return ht(Te);var vt={name:ee,mode:ve.mode,mtime:ve.mtime,atime:ve.atime,stats:ve};if(ve.isDirectory())return Q(vt);if(ve.isFile()||ve.isCharacterDevice()||ve.isBlockDevice())return R(vt);if(ve.isSymbolicLink())return Y(ee)})}function R(ee){var ke=ee.name.replace(o,s.replace("$","$$$$"));ft(ke,function(Te){Te?V(ee,ke):c?ie(ke,function(){V(ee,ke)}):u?ht(new Error(ke+" already exists")):xt()})}function V(ee,ke){var Te=Ho.createReadStream(ee.name),ve=Ho.createWriteStream(ke,{mode:ee.mode});Te.on("error",ht),ve.on("error",ht),l?l(Te,ve,ee):ve.on("open",function(){Te.pipe(ve)}),ve.once("close",function(){Ho.chmod(ke,ee.mode,function(vt){if(vt)return ht(vt);f?lae.utimesMillis(ke,ee.atime,ee.mtime,function(qi){return qi?ht(qi):xt()}):xt()})})}function ie(ee,ke){Ho.unlink(ee,function(Te){return Te?ht(Te):ke()})}function Q(ee){var ke=ee.name.replace(o,s.replace("$","$$$$"));ft(ke,function(Te){if(Te)return te(ee,ke);ae(ee.name)})}function te(ee,ke){Ho.mkdir(ke,ee.mode,function(Te){if(Te)return ht(Te);Ho.chmod(ke,ee.mode,function(ve){if(ve)return ht(ve);ae(ee.name)})})}function ae(ee){Ho.readdir(ee,function(ke,Te){return ke?ht(ke):(Te.forEach(function(ve){_(cE.join(ee,ve))}),xt())})}function Y(ee){var ke=ee.replace(o,s);Ho.readlink(ee,function(Te,ve){if(Te)return ht(Te);be(ve,ke)})}function be(ee,ke){d&&(ee=cE.resolve(i,ee)),ft(ke,function(Te){if(Te)return Fe(ee,ke);Ho.readlink(ke,function(ve,vt){return ve?ht(ve):(d&&(vt=cE.resolve(i,vt)),vt===ee?xt():ie(ke,function(){Fe(ee,ke)}))})})}function Fe(ee,ke){Ho.symlink(ee,ke,function(Te){return Te?ht(Te):xt()})}function ft(ee,ke){Ho.lstat(ee,function(Te){return Te&&Te.code==="ENOENT"?ke(!0):ke(!1)})}function ht(ee){if(!w&&r!==void 0)return w=!0,r(ee)}function xt(ee){if(ee||I--,b++,g===b&&I===0&&r!==void 0)return r(null)}}r6.exports=cae});var YM=F((lTe,i6)=>{"use strict";var QM=require("path");function n6(n){return n=QM.normalize(QM.resolve(n)).split(QM.sep),n.length>0?n[0]:null}var uae=/[<>:"|?*]/;function dae(n){let e=n6(n);return n=n.replace(e,""),uae.test(n)}i6.exports={getRootPath:n6,invalidWin32Path:dae}});var s6=F((cTe,o6)=>{"use strict";var pae=Dn(),XM=require("path"),mae=YM().invalidWin32Path,fae=parseInt("0777",8);function ZM(n,e,t,r){if(typeof e=="function"?(t=e,e={}):(!e||typeof e!="object")&&(e={mode:e}),process.platform==="win32"&&mae(n)){let s=new Error(n+" contains invalid WIN32 path characters.");return s.code="EINVAL",t(s)}let i=e.mode,o=e.fs||pae;i===void 0&&(i=fae&~process.umask()),r||(r=null),t=t||function(){},n=XM.resolve(n),o.mkdir(n,i,s=>{if(!s)return r=r||n,t(null,r);switch(s.code){case"ENOENT":if(XM.dirname(n)===n)return t(s);ZM(XM.dirname(n),e,(a,l)=>{a?t(a,l):ZM(n,e,t,l)});break;default:o.stat(n,(a,l)=>{a||!l.isDirectory()?t(s,r):t(null,r)});break}})}o6.exports=ZM});var l6=F((uTe,a6)=>{"use strict";var hae=Dn(),eK=require("path"),gae=YM().invalidWin32Path,vae=parseInt("0777",8);function tK(n,e,t){(!e||typeof e!="object")&&(e={mode:e});let r=e.mode,i=e.fs||hae;if(process.platform==="win32"&&gae(n)){let o=new Error(n+" contains invalid WIN32 path characters.");throw o.code="EINVAL",o}r===void 0&&(r=vae&~process.umask()),t||(t=null),n=eK.resolve(n);try{i.mkdirSync(n,r),t=t||n}catch(o){switch(o.code){case"ENOENT":if(eK.dirname(n)===n)throw o;t=tK(eK.dirname(n),e,t),tK(n,e,t);break;default:let s;try{s=i.statSync(n)}catch{throw o}if(!s.isDirectory())throw o;break}}return t}a6.exports=tK});var Go=F((dTe,c6)=>{"use strict";var yae=So().fromCallback,rK=yae(s6()),nK=l6();c6.exports={mkdirs:rK,mkdirsSync:nK,mkdirp:rK,mkdirpSync:nK,ensureDir:rK,ensureDirSync:nK}});var zc=F((pTe,d6)=>{"use strict";var bae=So().fromPromise,u6=GM();function Iae(n){return u6.access(n).then(()=>!0).catch(()=>!1)}d6.exports={pathExists:bae(Iae),pathExistsSync:u6.existsSync}});var f6=F((mTe,m6)=>{"use strict";var Sae=Dn(),uE=require("path"),p6=zM(),Cae=Go(),Eae=zc().pathExists;function wae(n,e,t,r){typeof t=="function"&&!r?(r=t,t={}):(typeof t=="function"||t instanceof RegExp)&&(t={filter:t}),r=r||function(){},t=t||{},t.preserveTimestamps&&process.arch==="ia32"&&console.warn(`fs-extra: Using the preserveTimestamps option in 32-bit node is not recommended;

    see https://github.com/jprichardson/node-fs-extra/issues/269`);let i=process.cwd(),o=uE.resolve(i,n),s=uE.resolve(i,e);if(o===s)return r(new Error("Source and destination must not be the same."));Sae.lstat(n,(a,l)=>{if(a)return r(a);let c=null;if(l.isDirectory()){let u=e.split(uE.sep);u.pop(),c=u.join(uE.sep)}else c=uE.dirname(e);Eae(c,(u,d)=>{if(u)return r(u);if(d)return p6(n,e,t,r);Cae.mkdirs(c,f=>{if(f)return r(f);p6(n,e,t,r)})})})}m6.exports=wae});var g6=F((fTe,h6)=>{var Pae=So().fromCallback;h6.exports={copy:Pae(f6())}});var iK=F((hTe,v6)=>{v6.exports=function(n){if(typeof Buffer.allocUnsafe=="function")try{return Buffer.allocUnsafe(n)}catch{return new Buffer(n)}return new Buffer(n)}});var S6=F((gTe,I6)=>{"use strict";var $l=Dn(),b6=64*1024,y6=iK()(b6);function kae(n,e,t){let r=t.overwrite,i=t.errorOnExist,o=t.preserveTimestamps;if($l.existsSync(e))if(r)$l.unlinkSync(e);else{if(i)throw new Error(`${e} already exists`);return}let s=$l.openSync(n,"r"),a=$l.fstatSync(s),l=$l.openSync(e,"w",a.mode),c=1,u=0;for(;c>0;)c=$l.readSync(s,y6,0,b6,u),$l.writeSync(l,y6,0,c),u+=c;o&&$l.futimesSync(l,a.atime,a.mtime),$l.closeSync(s),$l.closeSync(l)}I6.exports=kae});var P6=F((vTe,w6)=>{"use strict";var Vm=Dn(),oK=require("path"),xae=S6(),C6=Go();function E6(n,e,t){(typeof t=="function"||t instanceof RegExp)&&(t={filter:t}),t=t||{},t.recursive=!!t.recursive,t.clobber="clobber"in t?!!t.clobber:!0,t.overwrite="overwrite"in t?!!t.overwrite:t.clobber,t.dereference="dereference"in t?!!t.dereference:!1,t.preserveTimestamps="preserveTimestamps"in t?!!t.preserveTimestamps:!1,t.filter=t.filter||function(){return!0},t.preserveTimestamps&&process.arch==="ia32"&&console.warn(`fs-extra: Using the preserveTimestamps option in 32-bit node is not recommended;

    see https://github.com/jprichardson/node-fs-extra/issues/269`);let r=t.recursive&&!t.dereference?Vm.lstatSync(n):Vm.statSync(n),i=oK.dirname(e),o=Vm.existsSync(i),s=!1;if(t.filter instanceof RegExp?(console.warn("Warning: fs-extra: Passing a RegExp filter is deprecated, use a function"),s=t.filter.test(n)):typeof t.filter=="function"&&(s=t.filter(n,e)),r.isFile()&&s)o||C6.mkdirsSync(i),xae(n,e,{overwrite:t.overwrite,errorOnExist:t.errorOnExist,preserveTimestamps:t.preserveTimestamps});else if(r.isDirectory()&&s)Vm.existsSync(e)||C6.mkdirsSync(e),Vm.readdirSync(n).forEach(l=>{let c=t;c.recursive=!0,E6(oK.join(n,l),oK.join(e,l),c)});else if(t.recursive&&r.isSymbolicLink()&&s){let a=Vm.readlinkSync(n);Vm.symlinkSync(a,e)}}w6.exports=E6});var sK=F((yTe,k6)=>{k6.exports={copySync:P6()}});var K6=F((bTe,M6)=>{"use strict";var x6=Dn(),R6=require("path"),ur=require("assert"),dE=process.platform==="win32";function A6(n){["unlink","chmod","stat","lstat","rmdir","readdir"].forEach(t=>{n[t]=n[t]||x6[t],t=t+"Sync",n[t]=n[t]||x6[t]}),n.maxBusyTries=n.maxBusyTries||3}function aK(n,e,t){let r=0;typeof e=="function"&&(t=e,e={}),ur(n,"rimraf: missing path"),ur.equal(typeof n,"string","rimraf: path should be a string"),ur.equal(typeof t,"function","rimraf: callback function required"),ur(e,"rimraf: invalid options argument provided"),ur.equal(typeof e,"object","rimraf: options should be object"),A6(e),D6(n,e,function i(o){if(o){if((o.code==="EBUSY"||o.code==="ENOTEMPTY"||o.code==="EPERM")&&r<e.maxBusyTries){r++;let s=r*100;return setTimeout(()=>D6(n,e,i),s)}o.code==="ENOENT"&&(o=null)}t(o)})}function D6(n,e,t){ur(n),ur(e),ur(typeof t=="function"),e.lstat(n,(r,i)=>{if(r&&r.code==="ENOENT")return t(null);if(r&&r.code==="EPERM"&&dE)return _6(n,e,r,t);if(i&&i.isDirectory())return dD(n,e,r,t);e.unlink(n,o=>{if(o){if(o.code==="ENOENT")return t(null);if(o.code==="EPERM")return dE?_6(n,e,o,t):dD(n,e,o,t);if(o.code==="EISDIR")return dD(n,e,o,t)}return t(o)})})}function _6(n,e,t,r){ur(n),ur(e),ur(typeof r=="function"),t&&ur(t instanceof Error),e.chmod(n,438,i=>{i?r(i.code==="ENOENT"?null:t):e.stat(n,(o,s)=>{o?r(o.code==="ENOENT"?null:t):s.isDirectory()?dD(n,e,t,r):e.unlink(n,r)})})}function T6(n,e,t){let r;ur(n),ur(e),t&&ur(t instanceof Error);try{e.chmodSync(n,438)}catch(i){if(i.code==="ENOENT")return;throw t}try{r=e.statSync(n)}catch(i){if(i.code==="ENOENT")return;throw t}r.isDirectory()?pD(n,e,t):e.unlinkSync(n)}function dD(n,e,t,r){ur(n),ur(e),t&&ur(t instanceof Error),ur(typeof r=="function"),e.rmdir(n,i=>{i&&(i.code==="ENOTEMPTY"||i.code==="EEXIST"||i.code==="EPERM")?Dae(n,e,r):i&&i.code==="ENOTDIR"?r(t):r(i)})}function Dae(n,e,t){ur(n),ur(e),ur(typeof t=="function"),e.readdir(n,(r,i)=>{if(r)return t(r);let o=i.length,s;if(o===0)return e.rmdir(n,t);i.forEach(a=>{aK(R6.join(n,a),e,l=>{if(!s){if(l)return t(s=l);--o===0&&e.rmdir(n,t)}})})})}function N6(n,e){let t;e=e||{},A6(e),ur(n,"rimraf: missing path"),ur.equal(typeof n,"string","rimraf: path should be a string"),ur(e,"rimraf: missing options"),ur.equal(typeof e,"object","rimraf: options should be object");try{t=e.lstatSync(n)}catch(r){if(r.code==="ENOENT")return;r.code==="EPERM"&&dE&&T6(n,e,r)}try{t&&t.isDirectory()?pD(n,e,null):e.unlinkSync(n)}catch(r){if(r.code==="ENOENT")return;if(r.code==="EPERM")return dE?T6(n,e,r):pD(n,e,r);if(r.code!=="EISDIR")throw r;pD(n,e,r)}}function pD(n,e,t){ur(n),ur(e),t&&ur(t instanceof Error);try{e.rmdirSync(n)}catch(r){if(r.code==="ENOTDIR")throw t;if(r.code==="ENOTEMPTY"||r.code==="EEXIST"||r.code==="EPERM")_ae(n,e);else if(r.code!=="ENOENT")throw r}}function _ae(n,e){ur(n),ur(e),e.readdirSync(n).forEach(i=>N6(R6.join(n,i),e));let t=dE?100:1,r=0;do{let i=!0;try{let o=e.rmdirSync(n,e);return i=!1,o}finally{if(++r<t&&i)continue}}while(!0)}M6.exports=aK;aK.sync=N6});var pE=F((ITe,F6)=>{"use strict";var Tae=So().fromCallback,O6=K6();F6.exports={remove:Tae(O6),removeSync:O6.sync}});var V6=F((STe,W6)=>{var lv;try{lv=Dn()}catch{lv=require("fs")}function Rae(n,e,t){t==null&&(t=e,e={}),typeof e=="string"&&(e={encoding:e}),e=e||{};var r=e.fs||lv,i=!0;"throws"in e&&(i=e.throws),r.readFile(n,e,function(o,s){if(o)return t(o);s=U6(s);var a;try{a=JSON.parse(s,e?e.reviver:null)}catch(l){return i?(l.message=n+": "+l.message,t(l)):t(null,null)}t(null,a)})}function Aae(n,e){e=e||{},typeof e=="string"&&(e={encoding:e});var t=e.fs||lv,r=!0;"throws"in e&&(r=e.throws);try{var i=t.readFileSync(n,e);return i=U6(i),JSON.parse(i,e.reviver)}catch(o){if(r)throw o.message=n+": "+o.message,o;return null}}function L6(n,e){var t,r=`
`;typeof e=="object"&&e!==null&&(e.spaces&&(t=e.spaces),e.EOL&&(r=e.EOL));var i=JSON.stringify(n,e?e.replacer:null,t);return i.replace(/\n/g,r)+r}function Nae(n,e,t,r){r==null&&(r=t,t={}),t=t||{};var i=t.fs||lv,o="";try{o=L6(e,t)}catch(s){r&&r(s,null);return}i.writeFile(n,o,t,r)}function Mae(n,e,t){t=t||{};var r=t.fs||lv,i=L6(e,t);return r.writeFileSync(n,i,t)}function U6(n){return Buffer.isBuffer(n)&&(n=n.toString("utf8")),n=n.replace(/^\uFEFF/,""),n}var Kae={readFile:Rae,readFileSync:Aae,writeFile:Nae,writeFileSync:Mae};W6.exports=Kae});var fD=F((CTe,B6)=>{"use strict";var j6=So().fromCallback,mD=V6();B6.exports={readJson:j6(mD.readFile),readJsonSync:mD.readFileSync,writeJson:j6(mD.writeFile),writeJsonSync:mD.writeFileSync}});var q6=F((ETe,J6)=>{"use strict";var Oae=require("path"),Fae=Go(),Lae=zc().pathExists,$6=fD();function Uae(n,e,t,r){typeof t=="function"&&(r=t,t={});let i=Oae.dirname(n);Lae(i,(o,s)=>{if(o)return r(o);if(s)return $6.writeJson(n,e,t,r);Fae.mkdirs(i,a=>{if(a)return r(a);$6.writeJson(n,e,t,r)})})}J6.exports=Uae});var G6=F((wTe,H6)=>{"use strict";var Wae=Dn(),Vae=require("path"),jae=Go(),Bae=fD();function $ae(n,e,t){let r=Vae.dirname(n);Wae.existsSync(r)||jae.mkdirsSync(r),Bae.writeJsonSync(n,e,t)}H6.exports=$ae});var Q6=F((PTe,z6)=>{"use strict";var Jae=So().fromCallback,io=fD();io.outputJson=Jae(q6());io.outputJsonSync=G6();io.outputJSON=io.outputJson;io.outputJSONSync=io.outputJsonSync;io.writeJSON=io.writeJson;io.writeJSONSync=io.writeJsonSync;io.readJSON=io.readJson;io.readJSONSync=io.readJsonSync;z6.exports=io});var e7=F((kTe,Z6)=>{"use strict";var qae=So().fromCallback,Jl=Dn(),Hae=zM(),jm=require("path"),hD=pE().remove,Gae=Go().mkdirs;function lK(n,e,t,r){typeof t=="function"&&(r=t,t={});let i=t.overwrite||t.clobber||!1;Qae(n,e,(s,a)=>{if(s)return r(s);if(a)return r(new Error(`Cannot move '${n}' to a subdirectory of itself, '${e}'.`));Gae(jm.dirname(e),l=>{if(l)return r(l);o()})});function o(){jm.resolve(n)===jm.resolve(e)?Jl.access(n,r):i?Jl.rename(n,e,s=>{if(!s)return r();if(s.code==="ENOTEMPTY"||s.code==="EEXIST"){hD(e,a=>{if(a)return r(a);t.overwrite=!1,lK(n,e,t,r)});return}if(s.code==="EPERM"){setTimeout(()=>{hD(e,a=>{if(a)return r(a);t.overwrite=!1,lK(n,e,t,r)})},200);return}if(s.code!=="EXDEV")return r(s);Y6(n,e,i,r)}):Jl.link(n,e,s=>s?s.code==="EXDEV"||s.code==="EISDIR"||s.code==="EPERM"||s.code==="ENOTSUP"?Y6(n,e,i,r):r(s):Jl.unlink(n,r))}}function Y6(n,e,t,r){Jl.stat(n,(i,o)=>{if(i)return r(i);o.isDirectory()?X6(n,e,t,r):zae(n,e,t,r)})}function zae(n,e,t,r){let i=t?"w":"wx",o=Jl.createReadStream(n),s=Jl.createWriteStream(e,{flags:i});o.on("error",l=>{o.destroy(),s.destroy(),s.removeListener("close",a),Jl.unlink(e,()=>{l.code==="EISDIR"||l.code==="EPERM"?X6(n,e,t,r):r(l)})}),s.on("error",l=>{o.destroy(),s.destroy(),s.removeListener("close",a),r(l)}),s.once("close",a),o.pipe(s);function a(){Jl.unlink(n,r)}}function X6(n,e,t,r){let i={overwrite:!1};t?hD(e,s=>{if(s)return r(s);o()}):o();function o(){Hae(n,e,i,s=>{if(s)return r(s);hD(n,r)})}}function Qae(n,e,t){Jl.stat(n,(r,i)=>{if(r)return t(r);if(i.isDirectory()){let o=e.split(jm.dirname(n)+jm.sep)[1];if(o){let s=o.split(jm.sep)[0];return s?t(null,n!==e&&e.indexOf(n)>-1&&s===jm.basename(n)):t(null,!1)}return t(null,!1)}return t(null,!1)})}Z6.exports={move:qae(lK)}});var i7=F((xTe,n7)=>{"use strict";var Co=Dn(),Bm=require("path"),Yae=sK().copySync,cK=pE().removeSync,Xae=Go().mkdirsSync,Zae=iK();function r7(n,e,t){t=t||{};let r=t.overwrite||t.clobber||!1;if(n=Bm.resolve(n),e=Bm.resolve(e),n===e)return Co.accessSync(n);if(rle(n,e))throw new Error(`Cannot move '${n}' into itself '${e}'.`);Xae(Bm.dirname(e)),i();function i(){if(r)try{return Co.renameSync(n,e)}catch(o){if(o.code==="ENOTEMPTY"||o.code==="EEXIST"||o.code==="EPERM")return cK(e),t.overwrite=!1,r7(n,e,t);if(o.code!=="EXDEV")throw o;return t7(n,e,r)}else try{return Co.linkSync(n,e),Co.unlinkSync(n)}catch(o){if(o.code==="EXDEV"||o.code==="EISDIR"||o.code==="EPERM"||o.code==="ENOTSUP")return t7(n,e,r);throw o}}}function t7(n,e,t){return Co.statSync(n).isDirectory()?tle(n,e,t):ele(n,e,t)}function ele(n,e,t){let i=Zae(65536),o=t?"w":"wx",s=Co.openSync(n,"r"),a=Co.fstatSync(s),l=Co.openSync(e,o,a.mode),c=1,u=0;for(;c>0;)c=Co.readSync(s,i,0,65536,u),Co.writeSync(l,i,0,c),u+=c;return Co.closeSync(s),Co.closeSync(l),Co.unlinkSync(n)}function tle(n,e,t){let r={overwrite:!1};t&&cK(e),i();function i(){return Yae(n,e,r),cK(n)}}function rle(n,e){try{return Co.statSync(n).isDirectory()&&n!==e&&e.indexOf(n)>-1&&e.split(Bm.dirname(n)+Bm.sep)[1].split(Bm.sep)[0]===Bm.basename(n)}catch{return!1}}n7.exports={moveSync:r7}});var p7=F((DTe,d7)=>{"use strict";var nle=So().fromCallback,a7=require("fs"),l7=require("path"),c7=Go(),u7=pE(),o7=nle(function(e,t){t=t||function(){},a7.readdir(e,(r,i)=>{if(r)return c7.mkdirs(e,t);i=i.map(s=>l7.join(e,s)),o();function o(){let s=i.pop();if(!s)return t();u7.remove(s,a=>{if(a)return t(a);o()})}})});function s7(n){let e;try{e=a7.readdirSync(n)}catch{return c7.mkdirsSync(n)}e.forEach(t=>{t=l7.join(n,t),u7.removeSync(t)})}d7.exports={emptyDirSync:s7,emptydirSync:s7,emptyDir:o7,emptydir:o7}});var g7=F((_Te,h7)=>{"use strict";var ile=So().fromCallback,m7=require("path"),mE=Dn(),f7=Go(),ole=zc().pathExists;function sle(n,e){function t(){mE.writeFile(n,"",r=>{if(r)return e(r);e()})}mE.stat(n,(r,i)=>{if(!r&&i.isFile())return e();let o=m7.dirname(n);ole(o,(s,a)=>{if(s)return e(s);if(a)return t();f7.mkdirs(o,l=>{if(l)return e(l);t()})})})}function ale(n){let e;try{e=mE.statSync(n)}catch{}if(e&&e.isFile())return;let t=m7.dirname(n);mE.existsSync(t)||f7.mkdirsSync(t),mE.writeFileSync(n,"")}h7.exports={createFile:ile(sle),createFileSync:ale}});var S7=F((TTe,I7)=>{"use strict";var lle=So().fromCallback,y7=require("path"),$m=Dn(),b7=Go(),v7=zc().pathExists;function cle(n,e,t){function r(i,o){$m.link(i,o,s=>{if(s)return t(s);t(null)})}v7(e,(i,o)=>{if(i)return t(i);if(o)return t(null);$m.lstat(n,(s,a)=>{if(s)return s.message=s.message.replace("lstat","ensureLink"),t(s);let l=y7.dirname(e);v7(l,(c,u)=>{if(c)return t(c);if(u)return r(n,e);b7.mkdirs(l,d=>{if(d)return t(d);r(n,e)})})})})}function ule(n,e,t){if($m.existsSync(e))return;try{$m.lstatSync(n)}catch(s){throw s.message=s.message.replace("lstat","ensureLink"),s}let i=y7.dirname(e);return $m.existsSync(i)||b7.mkdirsSync(i),$m.linkSync(n,e)}I7.exports={createLink:lle(cle),createLinkSync:ule}});var E7=F((RTe,C7)=>{"use strict";var zd=require("path"),fE=Dn(),dle=zc().pathExists;function ple(n,e,t){if(zd.isAbsolute(n))return fE.lstat(n,(r,i)=>r?(r.message=r.message.replace("lstat","ensureSymlink"),t(r)):t(null,{toCwd:n,toDst:n}));{let r=zd.dirname(e),i=zd.join(r,n);return dle(i,(o,s)=>o?t(o):s?t(null,{toCwd:i,toDst:n}):fE.lstat(n,(a,l)=>a?(a.message=a.message.replace("lstat","ensureSymlink"),t(a)):t(null,{toCwd:n,toDst:zd.relative(r,n)})))}}function mle(n,e){let t;if(zd.isAbsolute(n)){if(t=fE.existsSync(n),!t)throw new Error("absolute srcpath does not exist");return{toCwd:n,toDst:n}}else{let r=zd.dirname(e),i=zd.join(r,n);if(t=fE.existsSync(i),t)return{toCwd:i,toDst:n};if(t=fE.existsSync(n),!t)throw new Error("relative srcpath does not exist");return{toCwd:n,toDst:zd.relative(r,n)}}}C7.exports={symlinkPaths:ple,symlinkPathsSync:mle}});var k7=F((ATe,P7)=>{"use strict";var w7=Dn();function fle(n,e,t){if(t=typeof e=="function"?e:t,e=typeof e=="function"?!1:e,e)return t(null,e);w7.lstat(n,(r,i)=>{if(r)return t(null,"file");e=i&&i.isDirectory()?"dir":"file",t(null,e)})}function hle(n,e){let t;if(e)return e;try{t=w7.lstatSync(n)}catch{return"file"}return t&&t.isDirectory()?"dir":"file"}P7.exports={symlinkType:fle,symlinkTypeSync:hle}});var N7=F((NTe,A7)=>{"use strict";var gle=So().fromCallback,D7=require("path"),cv=Dn(),_7=Go(),vle=_7.mkdirs,yle=_7.mkdirsSync,T7=E7(),ble=T7.symlinkPaths,Ile=T7.symlinkPathsSync,R7=k7(),Sle=R7.symlinkType,Cle=R7.symlinkTypeSync,x7=zc().pathExists;function Ele(n,e,t,r){r=typeof t=="function"?t:r,t=typeof t=="function"?!1:t,x7(e,(i,o)=>{if(i)return r(i);if(o)return r(null);ble(n,e,(s,a)=>{if(s)return r(s);n=a.toDst,Sle(a.toCwd,t,(l,c)=>{if(l)return r(l);let u=D7.dirname(e);x7(u,(d,f)=>{if(d)return r(d);if(f)return cv.symlink(n,e,c,r);vle(u,g=>{if(g)return r(g);cv.symlink(n,e,c,r)})})})})})}function wle(n,e,t,r){if(r=typeof t=="function"?t:r,t=typeof t=="function"?!1:t,cv.existsSync(e))return;let o=Ile(n,e);n=o.toDst,t=Cle(o.toCwd,t);let s=D7.dirname(e);return cv.existsSync(s)||yle(s),cv.symlinkSync(n,e,t)}A7.exports={createSymlink:gle(Ele),createSymlinkSync:wle}});var K7=F((MTe,M7)=>{"use strict";var gD=g7(),vD=S7(),yD=N7();M7.exports={createFile:gD.createFile,createFileSync:gD.createFileSync,ensureFile:gD.createFile,ensureFileSync:gD.createFileSync,createLink:vD.createLink,createLinkSync:vD.createLinkSync,ensureLink:vD.createLink,ensureLinkSync:vD.createLinkSync,createSymlink:yD.createSymlink,createSymlinkSync:yD.createSymlinkSync,ensureSymlink:yD.createSymlink,ensureSymlinkSync:yD.createSymlinkSync}});var U7=F((KTe,L7)=>{"use strict";var Ple=So().fromCallback,Jm=Dn(),O7=require("path"),F7=Go(),kle=zc().pathExists;function xle(n,e,t,r){typeof t=="function"&&(r=t,t="utf8");let i=O7.dirname(n);kle(i,(o,s)=>{if(o)return r(o);if(s)return Jm.writeFile(n,e,t,r);F7.mkdirs(i,a=>{if(a)return r(a);Jm.writeFile(n,e,t,r)})})}function Dle(n,e,t){let r=O7.dirname(n);if(Jm.existsSync(r))return Jm.writeFileSync.apply(Jm,arguments);F7.mkdirsSync(r),Jm.writeFileSync.apply(Jm,arguments)}L7.exports={outputFile:Ple(xle),outputFileSync:Dle}});var Qo=F((OTe,W7)=>{"use strict";var Os=j3(),zo={};Os(zo,GM());Os(zo,g6());Os(zo,sK());Os(zo,Go());Os(zo,pE());Os(zo,Q6());Os(zo,e7());Os(zo,i7());Os(zo,p7());Os(zo,K7());Os(zo,U7());Os(zo,zc());W7.exports=zo});var TD=F((ARe,CK)=>{"use strict";function Lle(n){var e=void 0;typeof n=="string"?e=[n]:e=n.raw;for(var t="",r=0;r<e.length;r++)t+=e[r].replace(/\\\n[ \t]*/g,"").replace(/\\`/g,"`"),r<(arguments.length<=1?0:arguments.length-1)&&(t+=arguments.length<=r+1?void 0:arguments[r+1]);var i=t.split(`
`),o=null;return i.forEach(function(s){var a=s.match(/^(\s+)\S+/);if(a){var l=a[1].length;o?o=Math.min(o,l):o=l}}),o!==null&&(t=i.map(function(s){return s[0]===" "?s.slice(o):s}).join(`
`)),t=t.trim(),t.replace(/\\n/g,`
`)}typeof CK<"u"&&(CK.exports=Lle)});var c5=F((HOe,l5)=>{l5.exports=function(n,e){for(var t=[],r=0;r<n.length;r++){var i=e(n[r],r);Yle(i)?t.push.apply(t,i):t.push(i)}return t};var Yle=Array.isArray||function(n){return Object.prototype.toString.call(n)==="[object Array]"}});var f5=F((GOe,m5)=>{"use strict";m5.exports=d5;function d5(n,e,t){n instanceof RegExp&&(n=u5(n,t)),e instanceof RegExp&&(e=u5(e,t));var r=p5(n,e,t);return r&&{start:r[0],end:r[1],pre:t.slice(0,r[0]),body:t.slice(r[0]+n.length,r[1]),post:t.slice(r[1]+e.length)}}function u5(n,e){var t=e.match(n);return t?t[0]:null}d5.range=p5;function p5(n,e,t){var r,i,o,s,a,l=t.indexOf(n),c=t.indexOf(e,l+1),u=l;if(l>=0&&c>0){if(n===e)return[l,c];for(r=[],o=t.length;u>=0&&!a;)u==l?(r.push(u),l=t.indexOf(n,u+1)):r.length==1?a=[r.pop(),c]:(i=r.pop(),i<o&&(o=i,s=c),c=t.indexOf(e,u+1)),u=l<c&&l>=0?l:c;r.length&&(a=[o,s])}return a}});var C5=F((zOe,S5)=>{var Xle=c5(),h5=f5();S5.exports=tce;var g5="\0SLASH"+Math.random()+"\0",v5="\0OPEN"+Math.random()+"\0",UK="\0CLOSE"+Math.random()+"\0",y5="\0COMMA"+Math.random()+"\0",b5="\0PERIOD"+Math.random()+"\0";function LK(n){return parseInt(n,10)==n?parseInt(n,10):n.charCodeAt(0)}function Zle(n){return n.split("\\\\").join(g5).split("\\{").join(v5).split("\\}").join(UK).split("\\,").join(y5).split("\\.").join(b5)}function ece(n){return n.split(g5).join("\\").split(v5).join("{").split(UK).join("}").split(y5).join(",").split(b5).join(".")}function I5(n){if(!n)return[""];var e=[],t=h5("{","}",n);if(!t)return n.split(",");var r=t.pre,i=t.body,o=t.post,s=r.split(",");s[s.length-1]+="{"+i+"}";var a=I5(o);return o.length&&(s[s.length-1]+=a.shift(),s.push.apply(s,a)),e.push.apply(e,s),e}function tce(n){return n?(n.substr(0,2)==="{}"&&(n="\\{\\}"+n.substr(2)),Wv(Zle(n),!0).map(ece)):[]}function rce(n){return"{"+n+"}"}function nce(n){return/^-?0\d/.test(n)}function ice(n,e){return n<=e}function oce(n,e){return n>=e}function Wv(n,e){var t=[],r=h5("{","}",n);if(!r||/\$$/.test(r.pre))return[n];var i=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(r.body),o=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(r.body),s=i||o,a=r.body.indexOf(",")>=0;if(!s&&!a)return r.post.match(/,(?!,).*\}/)?(n=r.pre+"{"+r.body+UK+r.post,Wv(n)):[n];var l;if(s)l=r.body.split(/\.\./);else if(l=I5(r.body),l.length===1&&(l=Wv(l[0],!1).map(rce),l.length===1)){var u=r.post.length?Wv(r.post,!1):[""];return u.map(function(Fe){return r.pre+l[0]+Fe})}var c=r.pre,u=r.post.length?Wv(r.post,!1):[""],d;if(s){var f=LK(l[0]),g=LK(l[1]),b=Math.max(l[0].length,l[1].length),I=l.length==3?Math.abs(LK(l[2])):1,w=ice,_=g<f;_&&(I*=-1,w=oce);var A=l.some(nce);d=[];for(var R=f;w(R,g);R+=I){var V;if(o)V=String.fromCharCode(R),V==="\\"&&(V="");else if(V=String(R),A){var ie=b-V.length;if(ie>0){var Q=new Array(ie+1).join("0");R<0?V="-"+Q+V.slice(1):V=Q+V}}d.push(V)}}else d=Xle(l,function(be){return Wv(be,!1)});for(var te=0;te<d.length;te++)for(var ae=0;ae<u.length;ae++){var Y=c+d[te]+u[ae];(!e||s||Y)&&t.push(Y)}return t}});var xE=F((QOe,x5)=>{x5.exports=Xo;Xo.Minimatch=gi;var kE=function(){try{return require("path")}catch{}}()||{sep:"/"};Xo.sep=kE.sep;var jK=Xo.GLOBSTAR=gi.GLOBSTAR={},sce=C5(),E5={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},WK="[^/]",VK=WK+"*?",ace="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",lce="(?:(?!(?:\\/|^)\\.).)*?",w5=cce("().*{}+?[]^$\\!");function cce(n){return n.split("").reduce(function(e,t){return e[t]=!0,e},{})}var P5=/\/+/;Xo.filter=uce;function uce(n,e){return e=e||{},function(t,r,i){return Xo(t,n,e)}}function rp(n,e){e=e||{};var t={};return Object.keys(n).forEach(function(r){t[r]=n[r]}),Object.keys(e).forEach(function(r){t[r]=e[r]}),t}Xo.defaults=function(n){if(!n||typeof n!="object"||!Object.keys(n).length)return Xo;var e=Xo,t=function(i,o,s){return e(i,o,rp(n,s))};return t.Minimatch=function(i,o){return new e.Minimatch(i,rp(n,o))},t.Minimatch.defaults=function(i){return e.defaults(rp(n,i)).Minimatch},t.filter=function(i,o){return e.filter(i,rp(n,o))},t.defaults=function(i){return e.defaults(rp(n,i))},t.makeRe=function(i,o){return e.makeRe(i,rp(n,o))},t.braceExpand=function(i,o){return e.braceExpand(i,rp(n,o))},t.match=function(r,i,o){return e.match(r,i,rp(n,o))},t};gi.defaults=function(n){return Xo.defaults(n).Minimatch};function Xo(n,e,t){return e_(e),t||(t={}),!t.nocomment&&e.charAt(0)==="#"?!1:new gi(e,t).match(n)}function gi(n,e){if(!(this instanceof gi))return new gi(n,e);e_(n),e||(e={}),n=n.trim(),!e.allowWindowsEscape&&kE.sep!=="/"&&(n=n.split(kE.sep).join("/")),this.options=e,this.set=[],this.pattern=n,this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.partial=!!e.partial,this.make()}gi.prototype.debug=function(){};gi.prototype.make=dce;function dce(){var n=this.pattern,e=this.options;if(!e.nocomment&&n.charAt(0)==="#"){this.comment=!0;return}if(!n){this.empty=!0;return}this.parseNegate();var t=this.globSet=this.braceExpand();e.debug&&(this.debug=function(){console.error.apply(console,arguments)}),this.debug(this.pattern,t),t=this.globParts=t.map(function(r){return r.split(P5)}),this.debug(this.pattern,t),t=t.map(function(r,i,o){return r.map(this.parse,this)},this),this.debug(this.pattern,t),t=t.filter(function(r){return r.indexOf(!1)===-1}),this.debug(this.pattern,t),this.set=t}gi.prototype.parseNegate=pce;function pce(){var n=this.pattern,e=!1,t=this.options,r=0;if(!t.nonegate){for(var i=0,o=n.length;i<o&&n.charAt(i)==="!";i++)e=!e,r++;r&&(this.pattern=n.substr(r)),this.negate=e}}Xo.braceExpand=function(n,e){return k5(n,e)};gi.prototype.braceExpand=k5;function k5(n,e){return e||(this instanceof gi?e=this.options:e={}),n=typeof n>"u"?this.pattern:n,e_(n),e.nobrace||!/\{(?:(?!\{).)*\}/.test(n)?[n]:sce(n)}var mce=1024*64,e_=function(n){if(typeof n!="string")throw new TypeError("invalid pattern");if(n.length>mce)throw new TypeError("pattern is too long")};gi.prototype.parse=fce;var ZD={};function fce(n,e){e_(n);var t=this.options;if(n==="**")if(t.noglobstar)n="*";else return jK;if(n==="")return"";var r="",i=!!t.nocase,o=!1,s=[],a=[],l,c=!1,u=-1,d=-1,f=n.charAt(0)==="."?"":t.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",g=this;function b(){if(l){switch(l){case"*":r+=VK,i=!0;break;case"?":r+=WK,i=!0;break;default:r+="\\"+l;break}g.debug("clearStateChar %j %j",l,r),l=!1}}for(var I=0,w=n.length,_;I<w&&(_=n.charAt(I));I++){if(this.debug("%s	%s %s %j",n,I,r,_),o&&w5[_]){r+="\\"+_,o=!1;continue}switch(_){case"/":return!1;case"\\":b(),o=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s	%s %s %j <-- stateChar",n,I,r,_),c){this.debug("  in class"),_==="!"&&I===d+1&&(_="^"),r+=_;continue}g.debug("call clearStateChar %j",l),b(),l=_,t.noext&&b();continue;case"(":if(c){r+="(";continue}if(!l){r+="\\(";continue}s.push({type:l,start:I-1,reStart:r.length,open:E5[l].open,close:E5[l].close}),r+=l==="!"?"(?:(?!(?:":"(?:",this.debug("plType %j %j",l,r),l=!1;continue;case")":if(c||!s.length){r+="\\)";continue}b(),i=!0;var A=s.pop();r+=A.close,A.type==="!"&&a.push(A),A.reEnd=r.length;continue;case"|":if(c||!s.length||o){r+="\\|",o=!1;continue}b(),r+="|";continue;case"[":if(b(),c){r+="\\"+_;continue}c=!0,d=I,u=r.length,r+=_;continue;case"]":if(I===d+1||!c){r+="\\"+_,o=!1;continue}var R=n.substring(d+1,I);try{RegExp("["+R+"]")}catch{var V=this.parse(R,ZD);r=r.substr(0,u)+"\\["+V[0]+"\\]",i=i||V[1],c=!1;continue}i=!0,c=!1,r+=_;continue;default:b(),o?o=!1:w5[_]&&!(_==="^"&&c)&&(r+="\\"),r+=_}}for(c&&(R=n.substr(d+1),V=this.parse(R,ZD),r=r.substr(0,u)+"\\["+V[0],i=i||V[1]),A=s.pop();A;A=s.pop()){var ie=r.slice(A.reStart+A.open.length);this.debug("setting tail",r,A),ie=ie.replace(/((?:\\{2}){0,64})(\\?)\|/g,function(qi,dr,Pi){return Pi||(Pi="\\"),dr+dr+Pi+"|"}),this.debug(`tail=%j
   %s`,ie,ie,A,r);var Q=A.type==="*"?VK:A.type==="?"?WK:"\\"+A.type;i=!0,r=r.slice(0,A.reStart)+Q+"\\("+ie}b(),o&&(r+="\\\\");var te=!1;switch(r.charAt(0)){case"[":case".":case"(":te=!0}for(var ae=a.length-1;ae>-1;ae--){var Y=a[ae],be=r.slice(0,Y.reStart),Fe=r.slice(Y.reStart,Y.reEnd-8),ft=r.slice(Y.reEnd-8,Y.reEnd),ht=r.slice(Y.reEnd);ft+=ht;var xt=be.split("(").length-1,ee=ht;for(I=0;I<xt;I++)ee=ee.replace(/\)[+*?]?/,"");ht=ee;var ke="";ht===""&&e!==ZD&&(ke="$");var Te=be+Fe+ht+ke+ft;r=Te}if(r!==""&&i&&(r="(?=.)"+r),te&&(r=f+r),e===ZD)return[r,i];if(!i)return gce(n);var ve=t.nocase?"i":"";try{var vt=new RegExp("^"+r+"$",ve)}catch{return new RegExp("$.")}return vt._glob=n,vt._src=r,vt}Xo.makeRe=function(n,e){return new gi(n,e||{}).makeRe()};gi.prototype.makeRe=hce;function hce(){if(this.regexp||this.regexp===!1)return this.regexp;var n=this.set;if(!n.length)return this.regexp=!1,this.regexp;var e=this.options,t=e.noglobstar?VK:e.dot?ace:lce,r=e.nocase?"i":"",i=n.map(function(o){return o.map(function(s){return s===jK?t:typeof s=="string"?vce(s):s._src}).join("\\/")}).join("|");i="^(?:"+i+")$",this.negate&&(i="^(?!"+i+").*$");try{this.regexp=new RegExp(i,r)}catch{this.regexp=!1}return this.regexp}Xo.match=function(n,e,t){t=t||{};var r=new gi(e,t);return n=n.filter(function(i){return r.match(i)}),r.options.nonull&&!n.length&&n.push(e),n};gi.prototype.match=function(e,t){if(typeof t>"u"&&(t=this.partial),this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;var r=this.options;kE.sep!=="/"&&(e=e.split(kE.sep).join("/")),e=e.split(P5),this.debug(this.pattern,"split",e);var i=this.set;this.debug(this.pattern,"set",i);var o,s;for(s=e.length-1;s>=0&&(o=e[s],!o);s--);for(s=0;s<i.length;s++){var a=i[s],l=e;r.matchBase&&a.length===1&&(l=[o]);var c=this.matchOne(l,a,t);if(c)return r.flipNegate?!0:!this.negate}return r.flipNegate?!1:this.negate};gi.prototype.matchOne=function(n,e,t){var r=this.options;this.debug("matchOne",{this:this,file:n,pattern:e}),this.debug("matchOne",n.length,e.length);for(var i=0,o=0,s=n.length,a=e.length;i<s&&o<a;i++,o++){this.debug("matchOne loop");var l=e[o],c=n[i];if(this.debug(e,l,c),l===!1)return!1;if(l===jK){this.debug("GLOBSTAR",[e,l,c]);var u=i,d=o+1;if(d===a){for(this.debug("** at the end");i<s;i++)if(n[i]==="."||n[i]===".."||!r.dot&&n[i].charAt(0)===".")return!1;return!0}for(;u<s;){var f=n[u];if(this.debug(`
globstar while`,n,u,e,d,f),this.matchOne(n.slice(u),e.slice(d),t))return this.debug("globstar found match!",u,s,f),!0;if(f==="."||f===".."||!r.dot&&f.charAt(0)==="."){this.debug("dot detected!",n,u,e,d);break}this.debug("globstar swallow a segment, and continue"),u++}return!!(t&&(this.debug(`
>>> no match, partial?`,n,u,e,d),u===s))}var g;if(typeof l=="string"?(g=c===l,this.debug("string match",l,c,g)):(g=c.match(l),this.debug("pattern match",l,c,g)),!g)return!1}if(i===s&&o===a)return!0;if(i===s)return t;if(o===a)return i===s-1&&n[i]==="";throw new Error("wtf?")};function gce(n){return n.replace(/\\(.)/g,"$1")}function vce(n){return n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}});var K5=F(qK=>{var Ym=require("path"),ip=process.platform==="win32",np=require("fs"),Ice=process.env.NODE_DEBUG&&/fs/.test(process.env.NODE_DEBUG);function Sce(){var n;if(Ice){var e=new Error;n=t}else n=r;return n;function t(i){i&&(e.message=i.message,i=e,r(i))}function r(i){if(i){if(process.throwDeprecation)throw i;if(!process.noDeprecation){var o="fs: missing callback "+(i.stack||i.message);process.traceDeprecation?console.trace(o):console.error(o)}}}}function Cce(n){return typeof n=="function"?n:Sce()}var qLe=Ym.normalize;ip?nu=/(.*?)(?:[\/\\]+|$)/g:nu=/(.*?)(?:[\/]+|$)/g;var nu;ip?AE=/^(?:[a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/][^\\\/]+)?[\\\/]*/:AE=/^[\/]*/;var AE;qK.realpathSync=function(e,t){if(e=Ym.resolve(e),t&&Object.prototype.hasOwnProperty.call(t,e))return t[e];var r=e,i={},o={},s,a,l,c;u();function u(){var w=AE.exec(e);s=w[0].length,a=w[0],l=w[0],c="",ip&&!o[l]&&(np.lstatSync(l),o[l]=!0)}for(;s<e.length;){nu.lastIndex=s;var d=nu.exec(e);if(c=a,a+=d[0],l=c+d[1],s=nu.lastIndex,!(o[l]||t&&t[l]===l)){var f;if(t&&Object.prototype.hasOwnProperty.call(t,l))f=t[l];else{var g=np.lstatSync(l);if(!g.isSymbolicLink()){o[l]=!0,t&&(t[l]=l);continue}var b=null;if(!ip){var I=g.dev.toString(32)+":"+g.ino.toString(32);i.hasOwnProperty(I)&&(b=i[I])}b===null&&(np.statSync(l),b=np.readlinkSync(l)),f=Ym.resolve(c,b),t&&(t[l]=f),ip||(i[I]=b)}e=Ym.resolve(f,e.slice(s)),u()}}return t&&(t[r]=e),e};qK.realpath=function(e,t,r){if(typeof r!="function"&&(r=Cce(t),t=null),e=Ym.resolve(e),t&&Object.prototype.hasOwnProperty.call(t,e))return process.nextTick(r.bind(null,null,t[e]));var i=e,o={},s={},a,l,c,u;d();function d(){var w=AE.exec(e);a=w[0].length,l=w[0],c=w[0],u="",ip&&!s[c]?np.lstat(c,function(_){if(_)return r(_);s[c]=!0,f()}):process.nextTick(f)}function f(){if(a>=e.length)return t&&(t[i]=e),r(null,e);nu.lastIndex=a;var w=nu.exec(e);return u=l,l+=w[0],c=u+w[1],a=nu.lastIndex,s[c]||t&&t[c]===c?process.nextTick(f):t&&Object.prototype.hasOwnProperty.call(t,c)?I(t[c]):np.lstat(c,g)}function g(w,_){if(w)return r(w);if(!_.isSymbolicLink())return s[c]=!0,t&&(t[c]=c),process.nextTick(f);if(!ip){var A=_.dev.toString(32)+":"+_.ino.toString(32);if(o.hasOwnProperty(A))return b(null,o[A],c)}np.stat(c,function(R){if(R)return r(R);np.readlink(c,function(V,ie){ip||(o[A]=ie),b(V,ie)})})}function b(w,_,A){if(w)return r(w);var R=Ym.resolve(u,_);t&&(t[A]=R),I(R)}function I(w){e=Ym.resolve(w,e.slice(a)),d()}}});var QK=F((GLe,U5)=>{U5.exports=op;op.realpath=op;op.sync=zK;op.realpathSync=zK;op.monkeypatch=wce;op.unmonkeypatch=Pce;var Xv=require("fs"),HK=Xv.realpath,GK=Xv.realpathSync,Ece=process.version,O5=/^v[0-5]\./.test(Ece),F5=K5();function L5(n){return n&&n.syscall==="realpath"&&(n.code==="ELOOP"||n.code==="ENOMEM"||n.code==="ENAMETOOLONG")}function op(n,e,t){if(O5)return HK(n,e,t);typeof e=="function"&&(t=e,e=null),HK(n,e,function(r,i){L5(r)?F5.realpath(n,e,t):t(r,i)})}function zK(n,e){if(O5)return GK(n,e);try{return GK(n,e)}catch(t){if(L5(t))return F5.realpathSync(n,e);throw t}}function wce(){Xv.realpath=op,Xv.realpathSync=zK}function Pce(){Xv.realpath=HK,Xv.realpathSync=GK}});var W5=F((zLe,YK)=>{typeof Object.create=="function"?YK.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:YK.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}});var V5=F((QLe,ZK)=>{try{if(XK=require("util"),typeof XK.inherits!="function")throw"";ZK.exports=XK.inherits}catch{ZK.exports=W5()}var XK});var n_=F((YLe,r_)=>{"use strict";function j5(n){return n.charAt(0)==="/"}function B5(n){var e=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,t=e.exec(n),r=t[1]||"",i=!!(r&&r.charAt(1)!==":");return!!(t[2]||i)}r_.exports=process.platform==="win32"?B5:j5;r_.exports.posix=j5;r_.exports.win32=B5});var tO=F(sp=>{sp.setopts=Rce;sp.ownProp=$5;sp.makeAbs=NE;sp.finish=Ace;sp.mark=Nce;sp.isIgnored=q5;sp.childrenIgnored=Mce;function $5(n,e){return Object.prototype.hasOwnProperty.call(n,e)}var kce=require("fs"),Zv=require("path"),xce=xE(),J5=n_(),eO=xce.Minimatch;function Dce(n,e){return n.localeCompare(e,"en")}function _ce(n,e){n.ignore=e.ignore||[],Array.isArray(n.ignore)||(n.ignore=[n.ignore]),n.ignore.length&&(n.ignore=n.ignore.map(Tce))}function Tce(n){var e=null;if(n.slice(-3)==="/**"){var t=n.replace(/(\/\*\*)+$/,"");e=new eO(t,{dot:!0})}return{matcher:new eO(n,{dot:!0}),gmatcher:e}}function Rce(n,e,t){if(t||(t={}),t.matchBase&&e.indexOf("/")===-1){if(t.noglobstar)throw new Error("base matching requires globstar");e="**/"+e}n.silent=!!t.silent,n.pattern=e,n.strict=t.strict!==!1,n.realpath=!!t.realpath,n.realpathCache=t.realpathCache||Object.create(null),n.follow=!!t.follow,n.dot=!!t.dot,n.mark=!!t.mark,n.nodir=!!t.nodir,n.nodir&&(n.mark=!0),n.sync=!!t.sync,n.nounique=!!t.nounique,n.nonull=!!t.nonull,n.nosort=!!t.nosort,n.nocase=!!t.nocase,n.stat=!!t.stat,n.noprocess=!!t.noprocess,n.absolute=!!t.absolute,n.fs=t.fs||kce,n.maxLength=t.maxLength||1/0,n.cache=t.cache||Object.create(null),n.statCache=t.statCache||Object.create(null),n.symlinks=t.symlinks||Object.create(null),_ce(n,t),n.changedCwd=!1;var r=process.cwd();$5(t,"cwd")?(n.cwd=Zv.resolve(t.cwd),n.changedCwd=n.cwd!==r):n.cwd=r,n.root=t.root||Zv.resolve(n.cwd,"/"),n.root=Zv.resolve(n.root),process.platform==="win32"&&(n.root=n.root.replace(/\\/g,"/")),n.cwdAbs=J5(n.cwd)?n.cwd:NE(n,n.cwd),process.platform==="win32"&&(n.cwdAbs=n.cwdAbs.replace(/\\/g,"/")),n.nomount=!!t.nomount,t.nonegate=!0,t.nocomment=!0,n.minimatch=new eO(e,t),n.options=n.minimatch.options}function Ace(n){for(var e=n.nounique,t=e?[]:Object.create(null),r=0,i=n.matches.length;r<i;r++){var o=n.matches[r];if(!o||Object.keys(o).length===0){if(n.nonull){var s=n.minimatch.globSet[r];e?t.push(s):t[s]=!0}}else{var a=Object.keys(o);e?t.push.apply(t,a):a.forEach(function(l){t[l]=!0})}}if(e||(t=Object.keys(t)),n.nosort||(t=t.sort(Dce)),n.mark){for(var r=0;r<t.length;r++)t[r]=n._mark(t[r]);n.nodir&&(t=t.filter(function(l){var c=!/\/$/.test(l),u=n.cache[l]||n.cache[NE(n,l)];return c&&u&&(c=u!=="DIR"&&!Array.isArray(u)),c}))}n.ignore.length&&(t=t.filter(function(l){return!q5(n,l)})),n.found=t}function Nce(n,e){var t=NE(n,e),r=n.cache[t],i=e;if(r){var o=r==="DIR"||Array.isArray(r),s=e.slice(-1)==="/";if(o&&!s?i+="/":!o&&s&&(i=i.slice(0,-1)),i!==e){var a=NE(n,i);n.statCache[a]=n.statCache[t],n.cache[a]=n.cache[t]}}return i}function NE(n,e){var t=e;return e.charAt(0)==="/"?t=Zv.join(n.root,e):J5(e)||e===""?t=e:n.changedCwd?t=Zv.resolve(n.cwd,e):t=Zv.resolve(e),process.platform==="win32"&&(t=t.replace(/\\/g,"/")),t}function q5(n,e){return n.ignore.length?n.ignore.some(function(t){return t.matcher.match(e)||!!(t.gmatcher&&t.gmatcher.match(e))}):!1}function Mce(n,e){return n.ignore.length?n.ignore.some(function(t){return!!(t.gmatcher&&t.gmatcher.match(e))}):!1}});var Y5=F((rUe,Q5)=>{Q5.exports=z5;z5.GlobSync=Ln;var Kce=QK(),H5=xE(),ZLe=H5.Minimatch,eUe=iO().Glob,tUe=require("util"),rO=require("path"),G5=require("assert"),i_=n_(),Xm=tO(),Oce=Xm.setopts,nO=Xm.ownProp,Fce=Xm.childrenIgnored,Lce=Xm.isIgnored;function z5(n,e){if(typeof e=="function"||arguments.length===3)throw new TypeError(`callback provided to sync glob
See: https://github.com/isaacs/node-glob/issues/167`);return new Ln(n,e).found}function Ln(n,e){if(!n)throw new Error("must provide pattern");if(typeof e=="function"||arguments.length===3)throw new TypeError(`callback provided to sync glob
See: https://github.com/isaacs/node-glob/issues/167`);if(!(this instanceof Ln))return new Ln(n,e);if(Oce(this,n,e),this.noprocess)return this;var t=this.minimatch.set.length;this.matches=new Array(t);for(var r=0;r<t;r++)this._process(this.minimatch.set[r],r,!1);this._finish()}Ln.prototype._finish=function(){if(G5(this instanceof Ln),this.realpath){var n=this;this.matches.forEach(function(e,t){var r=n.matches[t]=Object.create(null);for(var i in e)try{i=n._makeAbs(i);var o=Kce.realpathSync(i,n.realpathCache);r[o]=!0}catch(s){if(s.syscall==="stat")r[n._makeAbs(i)]=!0;else throw s}})}Xm.finish(this)};Ln.prototype._process=function(n,e,t){G5(this instanceof Ln);for(var r=0;typeof n[r]=="string";)r++;var i;switch(r){case n.length:this._processSimple(n.join("/"),e);return;case 0:i=null;break;default:i=n.slice(0,r).join("/");break}var o=n.slice(r),s;i===null?s=".":((i_(i)||i_(n.join("/")))&&(!i||!i_(i))&&(i="/"+i),s=i);var a=this._makeAbs(s);if(!Fce(this,s)){var l=o[0]===H5.GLOBSTAR;l?this._processGlobStar(i,s,a,o,e,t):this._processReaddir(i,s,a,o,e,t)}};Ln.prototype._processReaddir=function(n,e,t,r,i,o){var s=this._readdir(t,o);if(s){for(var a=r[0],l=!!this.minimatch.negate,c=a._glob,u=this.dot||c.charAt(0)===".",d=[],f=0;f<s.length;f++){var g=s[f];if(g.charAt(0)!=="."||u){var b;l&&!n?b=!g.match(a):b=g.match(a),b&&d.push(g)}}var I=d.length;if(I!==0){if(r.length===1&&!this.mark&&!this.stat){this.matches[i]||(this.matches[i]=Object.create(null));for(var f=0;f<I;f++){var g=d[f];n&&(n.slice(-1)!=="/"?g=n+"/"+g:g=n+g),g.charAt(0)==="/"&&!this.nomount&&(g=rO.join(this.root,g)),this._emitMatch(i,g)}return}r.shift();for(var f=0;f<I;f++){var g=d[f],w;n?w=[n,g]:w=[g],this._process(w.concat(r),i,o)}}}};Ln.prototype._emitMatch=function(n,e){if(!Lce(this,e)){var t=this._makeAbs(e);if(this.mark&&(e=this._mark(e)),this.absolute&&(e=t),!this.matches[n][e]){if(this.nodir){var r=this.cache[t];if(r==="DIR"||Array.isArray(r))return}this.matches[n][e]=!0,this.stat&&this._stat(e)}}};Ln.prototype._readdirInGlobStar=function(n){if(this.follow)return this._readdir(n,!1);var e,t,r;try{t=this.fs.lstatSync(n)}catch(o){if(o.code==="ENOENT")return null}var i=t&&t.isSymbolicLink();return this.symlinks[n]=i,!i&&t&&!t.isDirectory()?this.cache[n]="FILE":e=this._readdir(n,!1),e};Ln.prototype._readdir=function(n,e){var t;if(e&&!nO(this.symlinks,n))return this._readdirInGlobStar(n);if(nO(this.cache,n)){var r=this.cache[n];if(!r||r==="FILE")return null;if(Array.isArray(r))return r}try{return this._readdirEntries(n,this.fs.readdirSync(n))}catch(i){return this._readdirError(n,i),null}};Ln.prototype._readdirEntries=function(n,e){if(!this.mark&&!this.stat)for(var t=0;t<e.length;t++){var r=e[t];n==="/"?r=n+r:r=n+"/"+r,this.cache[r]=!0}return this.cache[n]=e,e};Ln.prototype._readdirError=function(n,e){switch(e.code){case"ENOTSUP":case"ENOTDIR":var t=this._makeAbs(n);if(this.cache[t]="FILE",t===this.cwdAbs){var r=new Error(e.code+" invalid cwd "+this.cwd);throw r.path=this.cwd,r.code=e.code,r}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(n)]=!1;break;default:if(this.cache[this._makeAbs(n)]=!1,this.strict)throw e;this.silent||console.error("glob error",e);break}};Ln.prototype._processGlobStar=function(n,e,t,r,i,o){var s=this._readdir(t,o);if(s){var a=r.slice(1),l=n?[n]:[],c=l.concat(a);this._process(c,i,!1);var u=s.length,d=this.symlinks[t];if(!(d&&o))for(var f=0;f<u;f++){var g=s[f];if(!(g.charAt(0)==="."&&!this.dot)){var b=l.concat(s[f],a);this._process(b,i,!0);var I=l.concat(s[f],r);this._process(I,i,!0)}}}};Ln.prototype._processSimple=function(n,e){var t=this._stat(n);if(this.matches[e]||(this.matches[e]=Object.create(null)),!!t){if(n&&i_(n)&&!this.nomount){var r=/[\/\\]$/.test(n);n.charAt(0)==="/"?n=rO.join(this.root,n):(n=rO.resolve(this.root,n),r&&(n+="/"))}process.platform==="win32"&&(n=n.replace(/\\/g,"/")),this._emitMatch(e,n)}};Ln.prototype._stat=function(n){var e=this._makeAbs(n),t=n.slice(-1)==="/";if(n.length>this.maxLength)return!1;if(!this.stat&&nO(this.cache,e)){var s=this.cache[e];if(Array.isArray(s)&&(s="DIR"),!t||s==="DIR")return s;if(t&&s==="FILE")return!1}var r,i=this.statCache[e];if(!i){var o;try{o=this.fs.lstatSync(e)}catch(a){if(a&&(a.code==="ENOENT"||a.code==="ENOTDIR"))return this.statCache[e]=!1,!1}if(o&&o.isSymbolicLink())try{i=this.fs.statSync(e)}catch{i=o}else i=o}this.statCache[e]=i;var s=!0;return i&&(s=i.isDirectory()?"DIR":"FILE"),this.cache[e]=this.cache[e]||s,t&&s==="FILE"?!1:s};Ln.prototype._mark=function(n){return Xm.mark(this,n)};Ln.prototype._makeAbs=function(n){return Xm.makeAbs(this,n)}});var oO=F((nUe,Z5)=>{Z5.exports=X5;function X5(n,e){if(n&&e)return X5(n)(e);if(typeof n!="function")throw new TypeError("need wrapper function");return Object.keys(n).forEach(function(r){t[r]=n[r]}),t;function t(){for(var r=new Array(arguments.length),i=0;i<r.length;i++)r[i]=arguments[i];var o=n.apply(this,r),s=r[r.length-1];return typeof o=="function"&&o!==s&&Object.keys(s).forEach(function(a){o[a]=s[a]}),o}}});var aO=F((iUe,sO)=>{var eq=oO();sO.exports=eq(o_);sO.exports.strict=eq(tq);o_.proto=o_(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return o_(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return tq(this)},configurable:!0})});function o_(n){var e=function(){return e.called?e.value:(e.called=!0,e.value=n.apply(this,arguments))};return e.called=!1,e}function tq(n){var e=function(){if(e.called)throw new Error(e.onceError);return e.called=!0,e.value=n.apply(this,arguments)},t=n.name||"Function wrapped with `once`";return e.onceError=t+" shouldn't be called more than once",e.called=!1,e}});var nq=F((oUe,rq)=>{var Uce=oO(),ME=Object.create(null),Wce=aO();rq.exports=Uce(Vce);function Vce(n,e){return ME[n]?(ME[n].push(e),null):(ME[n]=[e],jce(n))}function jce(n){return Wce(function e(){var t=ME[n],r=t.length,i=Bce(arguments);try{for(var o=0;o<r;o++)t[o].apply(null,i)}finally{t.length>r?(t.splice(0,r),process.nextTick(function(){e.apply(null,i)})):delete ME[n]}})}function Bce(n){for(var e=n.length,t=[],r=0;r<e;r++)t[r]=n[r];return t}});var iO=F((lUe,oq)=>{oq.exports=Zm;var $ce=QK(),iq=xE(),sUe=iq.Minimatch,Jce=V5(),qce=require("events").EventEmitter,lO=require("path"),cO=require("assert"),KE=n_(),dO=Y5(),ef=tO(),Hce=ef.setopts,uO=ef.ownProp,pO=nq(),aUe=require("util"),Gce=ef.childrenIgnored,zce=ef.isIgnored,Qce=aO();function Zm(n,e,t){if(typeof e=="function"&&(t=e,e={}),e||(e={}),e.sync){if(t)throw new TypeError("callback provided to sync glob");return dO(n,e)}return new vr(n,e,t)}Zm.sync=dO;var Yce=Zm.GlobSync=dO.GlobSync;Zm.glob=Zm;function Xce(n,e){if(e===null||typeof e!="object")return n;for(var t=Object.keys(e),r=t.length;r--;)n[t[r]]=e[t[r]];return n}Zm.hasMagic=function(n,e){var t=Xce({},e);t.noprocess=!0;var r=new vr(n,t),i=r.minimatch.set;if(!n)return!1;if(i.length>1)return!0;for(var o=0;o<i[0].length;o++)if(typeof i[0][o]!="string")return!0;return!1};Zm.Glob=vr;Jce(vr,qce);function vr(n,e,t){if(typeof e=="function"&&(t=e,e=null),e&&e.sync){if(t)throw new TypeError("callback provided to sync glob");return new Yce(n,e)}if(!(this instanceof vr))return new vr(n,e,t);Hce(this,n,e),this._didRealPath=!1;var r=this.minimatch.set.length;this.matches=new Array(r),typeof t=="function"&&(t=Qce(t),this.on("error",t),this.on("end",function(l){t(null,l)}));var i=this;if(this._processing=0,this._emitQueue=[],this._processQueue=[],this.paused=!1,this.noprocess)return this;if(r===0)return a();for(var o=!0,s=0;s<r;s++)this._process(this.minimatch.set[s],s,!1,a);o=!1;function a(){--i._processing,i._processing<=0&&(o?process.nextTick(function(){i._finish()}):i._finish())}}vr.prototype._finish=function(){if(cO(this instanceof vr),!this.aborted){if(this.realpath&&!this._didRealpath)return this._realpath();ef.finish(this),this.emit("end",this.found)}};vr.prototype._realpath=function(){if(this._didRealpath)return;this._didRealpath=!0;var n=this.matches.length;if(n===0)return this._finish();for(var e=this,t=0;t<this.matches.length;t++)this._realpathSet(t,r);function r(){--n===0&&e._finish()}};vr.prototype._realpathSet=function(n,e){var t=this.matches[n];if(!t)return e();var r=Object.keys(t),i=this,o=r.length;if(o===0)return e();var s=this.matches[n]=Object.create(null);r.forEach(function(a,l){a=i._makeAbs(a),$ce.realpath(a,i.realpathCache,function(c,u){c?c.syscall==="stat"?s[a]=!0:i.emit("error",c):s[u]=!0,--o===0&&(i.matches[n]=s,e())})})};vr.prototype._mark=function(n){return ef.mark(this,n)};vr.prototype._makeAbs=function(n){return ef.makeAbs(this,n)};vr.prototype.abort=function(){this.aborted=!0,this.emit("abort")};vr.prototype.pause=function(){this.paused||(this.paused=!0,this.emit("pause"))};vr.prototype.resume=function(){if(this.paused){if(this.emit("resume"),this.paused=!1,this._emitQueue.length){var n=this._emitQueue.slice(0);this._emitQueue.length=0;for(var e=0;e<n.length;e++){var t=n[e];this._emitMatch(t[0],t[1])}}if(this._processQueue.length){var r=this._processQueue.slice(0);this._processQueue.length=0;for(var e=0;e<r.length;e++){var i=r[e];this._processing--,this._process(i[0],i[1],i[2],i[3])}}}};vr.prototype._process=function(n,e,t,r){if(cO(this instanceof vr),cO(typeof r=="function"),!this.aborted){if(this._processing++,this.paused){this._processQueue.push([n,e,t,r]);return}for(var i=0;typeof n[i]=="string";)i++;var o;switch(i){case n.length:this._processSimple(n.join("/"),e,r);return;case 0:o=null;break;default:o=n.slice(0,i).join("/");break}var s=n.slice(i),a;o===null?a=".":((KE(o)||KE(n.join("/")))&&(!o||!KE(o))&&(o="/"+o),a=o);var l=this._makeAbs(a);if(Gce(this,a))return r();var c=s[0]===iq.GLOBSTAR;c?this._processGlobStar(o,a,l,s,e,t,r):this._processReaddir(o,a,l,s,e,t,r)}};vr.prototype._processReaddir=function(n,e,t,r,i,o,s){var a=this;this._readdir(t,o,function(l,c){return a._processReaddir2(n,e,t,r,i,o,c,s)})};vr.prototype._processReaddir2=function(n,e,t,r,i,o,s,a){if(!s)return a();for(var l=r[0],c=!!this.minimatch.negate,u=l._glob,d=this.dot||u.charAt(0)===".",f=[],g=0;g<s.length;g++){var b=s[g];if(b.charAt(0)!=="."||d){var I;c&&!n?I=!b.match(l):I=b.match(l),I&&f.push(b)}}var w=f.length;if(w===0)return a();if(r.length===1&&!this.mark&&!this.stat){this.matches[i]||(this.matches[i]=Object.create(null));for(var g=0;g<w;g++){var b=f[g];n&&(n!=="/"?b=n+"/"+b:b=n+b),b.charAt(0)==="/"&&!this.nomount&&(b=lO.join(this.root,b)),this._emitMatch(i,b)}return a()}r.shift();for(var g=0;g<w;g++){var b=f[g],_;n&&(n!=="/"?b=n+"/"+b:b=n+b),this._process([b].concat(r),i,o,a)}a()};vr.prototype._emitMatch=function(n,e){if(!this.aborted&&!zce(this,e)){if(this.paused){this._emitQueue.push([n,e]);return}var t=KE(e)?e:this._makeAbs(e);if(this.mark&&(e=this._mark(e)),this.absolute&&(e=t),!this.matches[n][e]){if(this.nodir){var r=this.cache[t];if(r==="DIR"||Array.isArray(r))return}this.matches[n][e]=!0;var i=this.statCache[t];i&&this.emit("stat",e,i),this.emit("match",e)}}};vr.prototype._readdirInGlobStar=function(n,e){if(this.aborted)return;if(this.follow)return this._readdir(n,!1,e);var t="lstat\0"+n,r=this,i=pO(t,o);i&&r.fs.lstat(n,i);function o(s,a){if(s&&s.code==="ENOENT")return e();var l=a&&a.isSymbolicLink();r.symlinks[n]=l,!l&&a&&!a.isDirectory()?(r.cache[n]="FILE",e()):r._readdir(n,!1,e)}};vr.prototype._readdir=function(n,e,t){if(!this.aborted&&(t=pO("readdir\0"+n+"\0"+e,t),!!t)){if(e&&!uO(this.symlinks,n))return this._readdirInGlobStar(n,t);if(uO(this.cache,n)){var r=this.cache[n];if(!r||r==="FILE")return t();if(Array.isArray(r))return t(null,r)}var i=this;i.fs.readdir(n,Zce(this,n,t))}};function Zce(n,e,t){return function(r,i){r?n._readdirError(e,r,t):n._readdirEntries(e,i,t)}}vr.prototype._readdirEntries=function(n,e,t){if(!this.aborted){if(!this.mark&&!this.stat)for(var r=0;r<e.length;r++){var i=e[r];n==="/"?i=n+i:i=n+"/"+i,this.cache[i]=!0}return this.cache[n]=e,t(null,e)}};vr.prototype._readdirError=function(n,e,t){if(!this.aborted){switch(e.code){case"ENOTSUP":case"ENOTDIR":var r=this._makeAbs(n);if(this.cache[r]="FILE",r===this.cwdAbs){var i=new Error(e.code+" invalid cwd "+this.cwd);i.path=this.cwd,i.code=e.code,this.emit("error",i),this.abort()}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(n)]=!1;break;default:this.cache[this._makeAbs(n)]=!1,this.strict&&(this.emit("error",e),this.abort()),this.silent||console.error("glob error",e);break}return t()}};vr.prototype._processGlobStar=function(n,e,t,r,i,o,s){var a=this;this._readdir(t,o,function(l,c){a._processGlobStar2(n,e,t,r,i,o,c,s)})};vr.prototype._processGlobStar2=function(n,e,t,r,i,o,s,a){if(!s)return a();var l=r.slice(1),c=n?[n]:[],u=c.concat(l);this._process(u,i,!1,a);var d=this.symlinks[t],f=s.length;if(d&&o)return a();for(var g=0;g<f;g++){var b=s[g];if(!(b.charAt(0)==="."&&!this.dot)){var I=c.concat(s[g],l);this._process(I,i,!0,a);var w=c.concat(s[g],r);this._process(w,i,!0,a)}}a()};vr.prototype._processSimple=function(n,e,t){var r=this;this._stat(n,function(i,o){r._processSimple2(n,e,i,o,t)})};vr.prototype._processSimple2=function(n,e,t,r,i){if(this.matches[e]||(this.matches[e]=Object.create(null)),!r)return i();if(n&&KE(n)&&!this.nomount){var o=/[\/\\]$/.test(n);n.charAt(0)==="/"?n=lO.join(this.root,n):(n=lO.resolve(this.root,n),o&&(n+="/"))}process.platform==="win32"&&(n=n.replace(/\\/g,"/")),this._emitMatch(e,n),i()};vr.prototype._stat=function(n,e){var t=this._makeAbs(n),r=n.slice(-1)==="/";if(n.length>this.maxLength)return e();if(!this.stat&&uO(this.cache,t)){var i=this.cache[t];if(Array.isArray(i)&&(i="DIR"),!r||i==="DIR")return e(null,i);if(r&&i==="FILE")return e()}var o,s=this.statCache[t];if(s!==void 0){if(s===!1)return e(null,s);var a=s.isDirectory()?"DIR":"FILE";return r&&a==="FILE"?e():e(null,a,s)}var l=this,c=pO("stat\0"+t,u);c&&l.fs.lstat(t,c);function u(d,f){if(f&&f.isSymbolicLink())return l.fs.stat(t,function(g,b){g?l._stat2(n,t,null,f,e):l._stat2(n,t,g,b,e)});l._stat2(n,t,d,f,e)}};vr.prototype._stat2=function(n,e,t,r,i){if(t&&(t.code==="ENOENT"||t.code==="ENOTDIR"))return this.statCache[e]=!1,i();var o=n.slice(-1)==="/";if(this.statCache[e]=r,e.slice(-1)==="/"&&r&&!r.isDirectory())return i(null,!1,r);var s=!0;return r&&(s=r.isDirectory()?"DIR":"FILE"),this.cache[e]=this.cache[e]||s,o&&s==="FILE"?i():i(null,s,r)}});var Eq=F((cUe,iu)=>{var Dr=require("fs"),a_=require("os"),ri=require("path"),sq=require("crypto"),Xl={fs:Dr.constants,os:a_.constants},aq="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",dq=/XXXXXX/,eue=3,pq=(Xl.O_CREAT||Xl.fs.O_CREAT)|(Xl.O_EXCL||Xl.fs.O_EXCL)|(Xl.O_RDWR||Xl.fs.O_RDWR),tue=a_.platform()==="win32",rue=Xl.EBADF||Xl.os.errno.EBADF,nue=Xl.ENOENT||Xl.os.errno.ENOENT,mq=448,fq=384,iue="exit",ey=[],hq=Dr.rmdirSync.bind(Dr),gq=!1;function oue(n,e){return Dr.rm(n,{recursive:!0},e)}function vq(n){return Dr.rmSync(n,{recursive:!0})}function hO(n,e){let t=ty(n,e),r=t[0],i=t[1];hue(r,function(o,s){if(o)return i(o);let a=s.tries;(function l(){try{let c=bq(s);Dr.stat(c,function(u){if(!u)return a-- >0?l():i(new Error("Could not get a unique tmp filename, max tries reached "+c));i(null,c)})}catch(c){i(c)}})()})}function gO(n){let e=ty(n),t=e[0],r=gue(t),i=r.tries;do{let o=bq(r);try{Dr.statSync(o)}catch{return o}}while(i-- >0);throw new Error("Could not get a unique tmp filename, max tries reached")}function sue(n,e){let t=ty(n,e),r=t[0],i=t[1];hO(r,function(s,a){if(s)return i(s);Dr.open(a,pq,r.mode||fq,function(c,u){if(c)return i(c);if(r.discardDescriptor)return Dr.close(u,function(f){return i(f,a,void 0,mO(a,-1,r,!1))});{let d=r.discardDescriptor||r.detachDescriptor;i(null,a,u,mO(a,d?-1:u,r,!1))}})})}function aue(n){let e=ty(n),t=e[0],r=t.discardDescriptor||t.detachDescriptor,i=gO(t),o=Dr.openSync(i,pq,t.mode||fq);return t.discardDescriptor&&(Dr.closeSync(o),o=void 0),{name:i,fd:o,removeCallback:mO(i,r?-1:o,t,!0)}}function lue(n,e){let t=ty(n,e),r=t[0],i=t[1];hO(r,function(s,a){if(s)return i(s);Dr.mkdir(a,r.mode||mq,function(c){if(c)return i(c);i(null,a,yq(a,r,!1))})})}function cue(n){let e=ty(n),t=e[0],r=gO(t);return Dr.mkdirSync(r,t.mode||mq),{name:r,removeCallback:yq(r,t,!0)}}function uue(n,e){let t=function(r){if(r&&!fO(r))return e(r);e()};0<=n[0]?Dr.close(n[0],function(){Dr.unlink(n[1],t)}):Dr.unlink(n[1],t)}function due(n){let e=null;try{0<=n[0]&&Dr.closeSync(n[0])}catch(t){if(!vue(t)&&!fO(t))throw t}finally{try{Dr.unlinkSync(n[1])}catch(t){fO(t)||(e=t)}}if(e!==null)throw e}function mO(n,e,t,r){let i=s_(due,[e,n],r),o=s_(uue,[e,n],r,i);return t.keep||ey.unshift(i),r?i:o}function yq(n,e,t){let r=e.unsafeCleanup?oue:Dr.rmdir.bind(Dr),i=e.unsafeCleanup?vq:hq,o=s_(i,n,t),s=s_(r,n,t,o);return e.keep||ey.unshift(o),t?o:s}function s_(n,e,t,r){let i=!1;return function o(s){if(!i){let a=r||o,l=ey.indexOf(a);return l>=0&&ey.splice(l,1),i=!0,t||n===hq||n===vq?n(e):n(e,s||function(){})}}}function pue(){if(gq)for(;ey.length;)try{ey[0]()}catch{}}function lq(n){let e=[],t=null;try{t=sq.randomBytes(n)}catch{t=sq.pseudoRandomBytes(n)}for(let r=0;r<n;r++)e.push(aq[t[r]%aq.length]);return e.join("")}function ts(n){return typeof n>"u"}function ty(n,e){if(typeof n=="function")return[{},n];if(ts(n))return[{},e];let t={};for(let r of Object.getOwnPropertyNames(n))t[r]=n[r];return[t,e]}function mue(n,e,t){let r=ri.isAbsolute(n)?n:ri.join(e,n);Dr.stat(r,function(i){i?Dr.realpath(ri.dirname(r),function(o,s){if(o)return t(o);t(null,ri.join(s,ri.basename(r)))}):Dr.realpath(ri,t)})}function fue(n,e){let t=ri.isAbsolute(n)?n:ri.join(e,n);try{return Dr.statSync(t),Dr.realpathSync(t)}catch{let i=Dr.realpathSync(ri.dirname(t));return ri.join(i,ri.basename(t))}}function bq(n){let e=n.tmpdir;if(!ts(n.name))return ri.join(e,n.dir,n.name);if(!ts(n.template))return ri.join(e,n.dir,n.template).replace(dq,lq(6));let t=[n.prefix?n.prefix:"tmp","-",process.pid,"-",lq(12),n.postfix?"-"+n.postfix:""].join("");return ri.join(e,n.dir,t)}function Iq(n){if(!ts(n.name)){let e=n.name;if(ri.isAbsolute(e))throw new Error(`name option must not contain an absolute path, found "${e}".`);let t=ri.basename(e);if(t===".."||t==="."||t!==e)throw new Error(`name option must not contain a path, found "${e}".`)}if(!ts(n.template)&&!n.template.match(dq))throw new Error(`Invalid template, found "${n.template}".`);if(!ts(n.tries)&&isNaN(n.tries)||n.tries<0)throw new Error(`Invalid tries, found "${n.tries}".`);n.tries=ts(n.name)?n.tries||eue:1,n.keep=!!n.keep,n.detachDescriptor=!!n.detachDescriptor,n.discardDescriptor=!!n.discardDescriptor,n.unsafeCleanup=!!n.unsafeCleanup,n.prefix=ts(n.prefix)?"":n.prefix,n.postfix=ts(n.postfix)?"":n.postfix}function cq(n,e,t,r){if(ts(e))return r(null);mue(e,t,function(i,o){if(i)return r(i);let s=ri.relative(t,o);if(!o.startsWith(t))return r(new Error(`${n} option must be relative to "${t}", found "${s}".`));r(null,s)})}function uq(n,e,t){if(ts(e))return;let r=fue(e,t),i=ri.relative(t,r);if(!r.startsWith(t))throw new Error(`${n} option must be relative to "${t}", found "${i}".`);return i}function hue(n,e){bue(n,function(t,r){if(t)return e(t);n.tmpdir=r;try{Iq(n,r)}catch(i){return e(i)}cq("dir",n.dir,r,function(i,o){if(i)return e(i);n.dir=ts(o)?"":o,cq("template",n.template,r,function(s,a){if(s)return e(s);n.template=a,e(null,n)})})})}function gue(n){let e=n.tmpdir=Cq(n);Iq(n,e);let t=uq("dir",n.dir,e);return n.dir=ts(t)?"":t,n.template=uq("template",n.template,e),n}function vue(n){return Sq(n,-rue,"EBADF")}function fO(n){return Sq(n,-nue,"ENOENT")}function Sq(n,e,t){return tue?n.code===t:n.code===t&&n.errno===e}function yue(){gq=!0}function bue(n,e){return Dr.realpath(n&&n.tmpdir||a_.tmpdir(),e)}function Cq(n){return Dr.realpathSync(n&&n.tmpdir||a_.tmpdir())}process.addListener(iue,pue);Object.defineProperty(iu.exports,"tmpdir",{enumerable:!0,configurable:!1,get:function(){return Cq()}});iu.exports.dir=lue;iu.exports.dirSync=cue;iu.exports.file=sue;iu.exports.fileSync=aue;iu.exports.tmpName=hO;iu.exports.tmpNameSync=gO;iu.exports.setGracefulCleanup=yue});var Pq=F((tf,wq)=>{var OE=require("node-fetch"),Iue=OE.default||OE,l_=function(n,e){return/^\/\//.test(n)&&(n="https:"+n),Iue.call(this,n,e)};l_.ponyfill=!0;wq.exports=tf=l_;tf.fetch=l_;tf.Headers=OE.Headers;tf.Request=OE.Request;tf.Response=OE.Response;tf.default=l_});var mH=F((Y3e,pH)=>{"use strict";function hf(n){if(!(this instanceof hf))return new hf(n);n=n||{},this.concurrency=n.concurrency||1/0,this.pending=0,this.jobs=[],this.cbs=[],this._done=Kue.bind(this)}var Mue=["push","unshift","splice"];Mue.forEach(function(n){hf.prototype[n]=function(){var e=Array.prototype[n].apply(this.jobs,arguments);return this._run(),e}});Object.defineProperty(hf.prototype,"length",{get:function(){return this.pending+this.jobs.length}});hf.prototype._run=function(){if(this.pending!==this.concurrency){if(this.jobs.length){var n=this.jobs.shift();this.pending++,n(this._done),this._run()}if(this.pending===0)for(;this.cbs.length!==0;){var e=this.cbs.pop();process.nextTick(e)}}};hf.prototype.onDone=function(n){typeof n=="function"&&(this.cbs.push(n),this._run())};function Kue(){this.pending--,this._run()}pH.exports=hf});var gf=F((X3e,fH)=>{"use strict";fH.exports={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),EMPTY_BUFFER:Buffer.alloc(0),NOOP:()=>{}}});var TH=F((Z3e,_H)=>{var yH=require("fs"),du=require("path"),bH=require("os"),IH=typeof __webpack_require__=="function"?__non_webpack_require__:require,Oue=process.config&&process.config.variables||{},Fue=!!process.env.PREBUILDS_ONLY,hH=process.versions.modules,_O=Wue()?"electron":Uue()?"node-webkit":"node",TO=process.env.npm_config_arch||bH.arch(),RO=process.env.npm_config_platform||bH.platform(),SH=process.env.LIBC||(Vue(RO)?"musl":"glibc"),AO=process.env.ARM_VERSION||(TO==="arm64"?"8":Oue.arm_version)||"",CH=(process.versions.uv||"").split(".")[0];_H.exports=rc;function rc(n){return IH(rc.resolve(n))}rc.resolve=rc.path=function(n){n=du.resolve(n||".");try{var e=IH(du.join(n,"package.json")).name.toUpperCase().replace(/-/g,"_");process.env[e+"_PREBUILD"]&&(n=process.env[e+"_PREBUILD"])}catch{}if(!Fue){var t=gH(du.join(n,"build/Release"),vH);if(t)return t;var r=gH(du.join(n,"build/Debug"),vH);if(r)return r}var i=a(n);if(i)return i;var o=a(du.dirname(process.execPath));if(o)return o;var s=["platform="+RO,"arch="+TO,"runtime="+_O,"abi="+hH,"uv="+CH,AO?"armv="+AO:"","libc="+SH,"node="+process.versions.node,process.versions.electron?"electron="+process.versions.electron:"",typeof __webpack_require__=="function"?"webpack=true":""].filter(Boolean).join(" ");throw new Error("No native build was found for "+s+`
    loaded from: `+n+`
`);function a(l){var c=NO(du.join(l,"prebuilds")).map(EH),u=c.filter(wH(RO,TO)).sort(PH)[0];if(u){var d=du.join(l,"prebuilds",u.name),f=NO(d).map(kH),g=f.filter(xH(_O,hH)),b=g.sort(DH(_O))[0];if(b)return du.join(d,b.file)}}};function NO(n){try{return yH.readdirSync(n)}catch{return[]}}function gH(n,e){var t=NO(n).filter(e);return t[0]&&du.join(n,t[0])}function vH(n){return/\.node$/.test(n)}function EH(n){var e=n.split("-");if(e.length===2){var t=e[0],r=e[1].split("+");if(t&&r.length&&r.every(Boolean))return{name:n,platform:t,architectures:r}}}function wH(n,e){return function(t){return t==null||t.platform!==n?!1:t.architectures.includes(e)}}function PH(n,e){return n.architectures.length-e.architectures.length}function kH(n){var e=n.split("."),t=e.pop(),r={file:n,specificity:0};if(t==="node"){for(var i=0;i<e.length;i++){var o=e[i];if(o==="node"||o==="electron"||o==="node-webkit")r.runtime=o;else if(o==="napi")r.napi=!0;else if(o.slice(0,3)==="abi")r.abi=o.slice(3);else if(o.slice(0,2)==="uv")r.uv=o.slice(2);else if(o.slice(0,4)==="armv")r.armv=o.slice(4);else if(o==="glibc"||o==="musl")r.libc=o;else continue;r.specificity++}return r}}function xH(n,e){return function(t){return!(t==null||t.runtime!==n&&!Lue(t)||t.abi!==e&&!t.napi||t.uv&&t.uv!==CH||t.armv&&t.armv!==AO||t.libc&&t.libc!==SH)}}function Lue(n){return n.runtime==="node"&&n.napi}function DH(n){return function(e,t){return e.runtime!==t.runtime?e.runtime===n?-1:1:e.abi!==t.abi?e.abi?-1:1:e.specificity!==t.specificity?e.specificity>t.specificity?-1:1:0}}function Uue(){return!!(process.versions&&process.versions.nw)}function Wue(){return process.versions&&process.versions.electron||process.env.ELECTRON_RUN_AS_NODE?!0:typeof window<"u"&&window.process&&window.process.type==="renderer"}function Vue(n){return n==="linux"&&yH.existsSync("/etc/alpine-release")}rc.parseTags=kH;rc.matchTags=xH;rc.compareTags=DH;rc.parseTuple=EH;rc.matchTuple=wH;rc.compareTuples=PH});var KO=F((e6e,MO)=>{typeof process.addon=="function"?MO.exports=process.addon.bind(process):MO.exports=TH()});var AH=F((t6e,RH)=>{"use strict";var jue=(n,e,t,r,i)=>{for(var o=0;o<i;o++)t[r+o]=n[o]^e[o&3]},Bue=(n,e)=>{let t=n.length;for(var r=0;r<t;r++)n[r]^=e[r&3]};RH.exports={mask:jue,unmask:Bue}});var NH=F((r6e,OO)=>{"use strict";try{OO.exports=KO()(__dirname)}catch{OO.exports=AH()}});var U_=F((n6e,FO)=>{"use strict";var{EMPTY_BUFFER:$ue}=gf();function MH(n,e){if(n.length===0)return $ue;if(n.length===1)return n[0];let t=Buffer.allocUnsafe(e);for(var r=0,i=0;i<n.length;i++){let o=n[i];o.copy(t,r),r+=o.length}return t}function KH(n,e,t,r,i){for(var o=0;o<i;o++)t[r+o]=n[o]^e[o&3]}function OH(n,e){let t=n.length;for(var r=0;r<t;r++)n[r]^=e[r&3]}function FH(n){return n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}function L_(n){if(L_.readOnly=!0,Buffer.isBuffer(n))return n;var e;return n instanceof ArrayBuffer?e=Buffer.from(n):ArrayBuffer.isView(n)?e=Jue(n):(e=Buffer.from(n),L_.readOnly=!1),e}function Jue(n){let e=Buffer.from(n.buffer);return n.byteLength!==n.buffer.byteLength?e.slice(n.byteOffset,n.byteOffset+n.byteLength):e}try{let n=NH(),e=n.BufferUtil||n;FO.exports={concat:MH,mask(t,r,i,o,s){s<48?KH(t,r,i,o,s):e.mask(t,r,i,o,s)},toArrayBuffer:FH,toBuffer:L_,unmask(t,r){t.length<32?OH(t,r):e.unmask(t,r)}}}catch{FO.exports={concat:MH,mask:KH,toArrayBuffer:FH,toBuffer:L_,unmask:OH}}});var QE=F((i6e,jH)=>{"use strict";var que=mH(),zE=require("zlib"),LH=U_(),{kStatusCode:UH,NOOP:Hue}=gf(),Gue=Buffer.from([0,0,255,255]),zue=Buffer.from([0]),V_=Symbol("permessage-deflate"),pu=Symbol("total-length"),WH=Symbol("callback"),hp=Symbol("buffers"),LO=Symbol("error"),W_,UO=class{constructor(e,t,r){if(this._maxPayload=r|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!W_){let i=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;W_=new que({concurrency:i})}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate&&(this._deflate.close(),this._deflate=null)}acceptAsServer(e){let t=this._options,r=e.find(i=>!(t.serverNoContextTakeover===!1&&i.server_no_context_takeover||i.server_max_window_bits&&(t.serverMaxWindowBits===!1||typeof t.serverMaxWindowBits=="number"&&t.serverMaxWindowBits>i.server_max_window_bits)||typeof t.clientMaxWindowBits=="number"&&!i.client_max_window_bits));if(!r)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(r.server_no_context_takeover=!0),t.clientNoContextTakeover&&(r.client_no_context_takeover=!0),typeof t.serverMaxWindowBits=="number"&&(r.server_max_window_bits=t.serverMaxWindowBits),typeof t.clientMaxWindowBits=="number"?r.client_max_window_bits=t.clientMaxWindowBits:(r.client_max_window_bits===!0||t.clientMaxWindowBits===!1)&&delete r.client_max_window_bits,r}acceptAsClient(e){let t=e[0];if(this._options.clientNoContextTakeover===!1&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!t.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(t.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return t}normalizeParams(e){return e.forEach(t=>{Object.keys(t).forEach(r=>{var i=t[r];if(i.length>1)throw new Error(`Parameter "${r}" must have only a single value`);if(i=i[0],r==="client_max_window_bits"){if(i!==!0){let o=+i;if(!Number.isInteger(o)||o<8||o>15)throw new TypeError(`Invalid value for parameter "${r}": ${i}`);i=o}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${r}": ${i}`)}else if(r==="server_max_window_bits"){let o=+i;if(!Number.isInteger(o)||o<8||o>15)throw new TypeError(`Invalid value for parameter "${r}": ${i}`);i=o}else if(r==="client_no_context_takeover"||r==="server_no_context_takeover"){if(i!==!0)throw new TypeError(`Invalid value for parameter "${r}": ${i}`)}else throw new Error(`Unknown parameter "${r}"`);t[r]=i})}),e}decompress(e,t,r){W_.push(i=>{this._decompress(e,t,(o,s)=>{i(),r(o,s)})})}compress(e,t,r){W_.push(i=>{this._compress(e,t,(o,s)=>{i(),r(o,s)})})}_decompress(e,t,r){let i=this._isServer?"client":"server";if(!this._inflate){let o=`${i}_max_window_bits`,s=typeof this.params[o]!="number"?zE.Z_DEFAULT_WINDOWBITS:this.params[o];this._inflate=zE.createInflateRaw(Object.assign({},this._options.zlibInflateOptions,{windowBits:s})),this._inflate[V_]=this,this._inflate[pu]=0,this._inflate[hp]=[],this._inflate.on("error",Yue),this._inflate.on("data",VH)}this._inflate[WH]=r,this._inflate.write(e),t&&this._inflate.write(Gue),this._inflate.flush(()=>{let o=this._inflate[LO];if(o){this._inflate.close(),this._inflate=null,r(o);return}let s=LH.concat(this._inflate[hp],this._inflate[pu]);t&&this.params[`${i}_no_context_takeover`]?(this._inflate.close(),this._inflate=null):(this._inflate[pu]=0,this._inflate[hp]=[]),r(null,s)})}_compress(e,t,r){if(!e||e.length===0){process.nextTick(r,null,zue);return}let i=this._isServer?"server":"client";if(!this._deflate){let o=`${i}_max_window_bits`,s=typeof this.params[o]!="number"?zE.Z_DEFAULT_WINDOWBITS:this.params[o];this._deflate=zE.createDeflateRaw(Object.assign({},this._options.zlibDeflateOptions,{windowBits:s})),this._deflate[pu]=0,this._deflate[hp]=[],this._deflate.on("error",Hue),this._deflate.on("data",Que)}this._deflate.write(e),this._deflate.flush(zE.Z_SYNC_FLUSH,()=>{if(this._deflate){var o=LH.concat(this._deflate[hp],this._deflate[pu]);t&&(o=o.slice(0,o.length-4)),t&&this.params[`${i}_no_context_takeover`]?(this._deflate.close(),this._deflate=null):(this._deflate[pu]=0,this._deflate[hp]=[]),r(null,o)}})}};jH.exports=UO;function Que(n){this[hp].push(n),this[pu]+=n.length}function VH(n){if(this[pu]+=n.length,this[V_]._maxPayload<1||this[pu]<=this[V_]._maxPayload){this[hp].push(n);return}this[LO]=new RangeError("Max payload size exceeded"),this[LO][UH]=1009,this.removeListener("data",VH),this.reset()}function Yue(n){this[V_]._inflate=null,n[UH]=1007,this[WH](n)}});var $H=F((o6e,BH)=>{"use strict";var Oy=class{constructor(e,t){this.target=t,this.type=e}},WO=class extends Oy{constructor(e,t){super("message",t),this.data=e}},VO=class extends Oy{constructor(e,t,r){super("close",r),this.wasClean=r._closeFrameReceived&&r._closeFrameSent,this.reason=t,this.code=e}},jO=class extends Oy{constructor(e){super("open",e)}},BO=class extends Oy{constructor(e,t){super("error",t),this.message=e.message,this.error=e}},Xue={addEventListener(n,e){if(typeof e!="function")return;function t(s){e.call(this,new WO(s,this))}function r(s,a){e.call(this,new VO(s,a,this))}function i(s){e.call(this,new BO(s,this))}function o(){e.call(this,new jO(this))}n==="message"?(t._listener=e,this.on(n,t)):n==="close"?(r._listener=e,this.on(n,r)):n==="error"?(i._listener=e,this.on(n,i)):n==="open"?(o._listener=e,this.on(n,o)):this.on(n,e)},removeEventListener(n,e){let t=this.listeners(n);for(var r=0;r<t.length;r++)(t[r]===e||t[r]._listener===e)&&this.removeListener(n,t[r])}};BH.exports=Xue});var $O=F((s6e,JH)=>{"use strict";var YE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function nc(n,e,t){Object.prototype.hasOwnProperty.call(n,e)?n[e].push(t):n[e]=[t]}function Zue(n){let e={};if(n===void 0||n==="")return e;for(var t={},r=!1,i=!1,o=!1,s,a,l=-1,c=-1,u=0;u<n.length;u++){let g=n.charCodeAt(u);if(s===void 0)if(c===-1&&YE[g]===1)l===-1&&(l=u);else if(g===32||g===9)c===-1&&l!==-1&&(c=u);else if(g===59||g===44){if(l===-1)throw new SyntaxError(`Unexpected character at index ${u}`);c===-1&&(c=u);let b=n.slice(l,c);g===44?(nc(e,b,t),t={}):s=b,l=c=-1}else throw new SyntaxError(`Unexpected character at index ${u}`);else if(a===void 0)if(c===-1&&YE[g]===1)l===-1&&(l=u);else if(g===32||g===9)c===-1&&l!==-1&&(c=u);else if(g===59||g===44){if(l===-1)throw new SyntaxError(`Unexpected character at index ${u}`);c===-1&&(c=u),nc(t,n.slice(l,c),!0),g===44&&(nc(e,s,t),t={},s=void 0),l=c=-1}else if(g===61&&l!==-1&&c===-1)a=n.slice(l,u),l=c=-1;else throw new SyntaxError(`Unexpected character at index ${u}`);else if(i){if(YE[g]!==1)throw new SyntaxError(`Unexpected character at index ${u}`);l===-1?l=u:r||(r=!0),i=!1}else if(o)if(YE[g]===1)l===-1&&(l=u);else if(g===34&&l!==-1)o=!1,c=u;else if(g===92)i=!0;else throw new SyntaxError(`Unexpected character at index ${u}`);else if(g===34&&n.charCodeAt(u-1)===61)o=!0;else if(c===-1&&YE[g]===1)l===-1&&(l=u);else if(l!==-1&&(g===32||g===9))c===-1&&(c=u);else if(g===59||g===44){if(l===-1)throw new SyntaxError(`Unexpected character at index ${u}`);c===-1&&(c=u);var d=n.slice(l,c);r&&(d=d.replace(/\\/g,""),r=!1),nc(t,a,d),g===44&&(nc(e,s,t),t={},s=void 0),a=void 0,l=c=-1}else throw new SyntaxError(`Unexpected character at index ${u}`)}if(l===-1||o)throw new SyntaxError("Unexpected end of input");c===-1&&(c=u);let f=n.slice(l,c);return s===void 0?nc(e,f,{}):(a===void 0?nc(t,f,!0):r?nc(t,a,f.replace(/\\/g,"")):nc(t,a,f),nc(e,s,t)),e}function ede(n){return Object.keys(n).map(e=>{var t=n[e];return Array.isArray(t)||(t=[t]),t.map(r=>[e].concat(Object.keys(r).map(i=>{var o=r[i];return Array.isArray(o)||(o=[o]),o.map(s=>s===!0?i:`${i}=${s}`).join("; ")})).join("; ")).join(", ")}).join(", ")}JH.exports={format:ede,parse:Zue}});var HH=F((a6e,qH)=>{"use strict";function tde(n){let e=n.length,t=0;for(;t<e;)if((n[t]&128)===0)t++;else if((n[t]&224)===192){if(t+1===e||(n[t+1]&192)!==128||(n[t]&254)===192)return!1;t+=2}else if((n[t]&240)===224){if(t+2>=e||(n[t+1]&192)!==128||(n[t+2]&192)!==128||n[t]===224&&(n[t+1]&224)===128||n[t]===237&&(n[t+1]&224)===160)return!1;t+=3}else if((n[t]&248)===240){if(t+3>=e||(n[t+1]&192)!==128||(n[t+2]&192)!==128||(n[t+3]&192)!==128||n[t]===240&&(n[t+1]&240)===128||n[t]===244&&n[t+1]>143||n[t]>244)return!1;t+=4}else return!1;return!0}qH.exports=tde});var GH=F((l6e,JO)=>{"use strict";try{JO.exports=KO()(__dirname)}catch{JO.exports=HH()}});var qO=F(j_=>{"use strict";try{let n=GH();j_.isValidUTF8=typeof n=="object"?n.Validation.isValidUTF8:n}catch{j_.isValidUTF8=()=>!0}j_.isValidStatusCode=n=>n>=1e3&&n<=1013&&n!==1004&&n!==1005&&n!==1006||n>=3e3&&n<=4999});var QO=F((u6e,e4)=>{"use strict";var{Writable:rde}=require("stream"),zH=QE(),{BINARY_TYPES:nde,EMPTY_BUFFER:ide,kStatusCode:ode,kWebSocket:sde}=gf(),{concat:HO,toArrayBuffer:ade,unmask:lde}=U_(),{isValidStatusCode:cde,isValidUTF8:QH}=qO(),XE=0,YH=1,XH=2,ZH=3,GO=4,ude=5,zO=class extends rde{constructor(e,t,r){super(),this._binaryType=e||nde[0],this[sde]=void 0,this._extensions=t||{},this._maxPayload=r|0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=XE,this._loop=!1}_write(e,t,r){if(this._opcode===8&&this._state==XE)return r();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(r)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let r=this._buffers[0];return this._buffers[0]=r.slice(e),r.slice(0,e)}let t=Buffer.allocUnsafe(e);do{let r=this._buffers[0];e>=r.length?this._buffers.shift().copy(t,t.length-e):(r.copy(t,t.length-e,0,e),this._buffers[0]=r.slice(e)),e-=r.length}while(e>0);return t}startLoop(e){var t;this._loop=!0;do switch(this._state){case XE:t=this.getInfo();break;case YH:t=this.getPayloadLength16();break;case XH:t=this.getPayloadLength64();break;case ZH:this.getMask();break;case GO:t=this.getData(e);break;default:this._loop=!1;return}while(this._loop);e(t)}getInfo(){if(this._bufferedBytes<2){this._loop=!1;return}let e=this.consume(2);if((e[0]&48)!==0)return this._loop=!1,yi(RangeError,"RSV2 and RSV3 must be clear",!0,1002);let t=(e[0]&64)===64;if(t&&!this._extensions[zH.extensionName])return this._loop=!1,yi(RangeError,"RSV1 must be clear",!0,1002);if(this._fin=(e[0]&128)===128,this._opcode=e[0]&15,this._payloadLength=e[1]&127,this._opcode===0){if(t)return this._loop=!1,yi(RangeError,"RSV1 must be clear",!0,1002);if(!this._fragmented)return this._loop=!1,yi(RangeError,"invalid opcode 0",!0,1002);this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented)return this._loop=!1,yi(RangeError,`invalid opcode ${this._opcode}`,!0,1002);this._compressed=t}else if(this._opcode>7&&this._opcode<11){if(!this._fin)return this._loop=!1,yi(RangeError,"FIN must be set",!0,1002);if(t)return this._loop=!1,yi(RangeError,"RSV1 must be clear",!0,1002);if(this._payloadLength>125)return this._loop=!1,yi(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002)}else return this._loop=!1,yi(RangeError,`invalid opcode ${this._opcode}`,!0,1002);if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(e[1]&128)===128,this._payloadLength===126)this._state=YH;else if(this._payloadLength===127)this._state=XH;else return this.haveLength()}getPayloadLength16(){if(this._bufferedBytes<2){this._loop=!1;return}return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength()}getPayloadLength64(){if(this._bufferedBytes<8){this._loop=!1;return}let e=this.consume(8),t=e.readUInt32BE(0);return t>Math.pow(2,21)-1?(this._loop=!1,yi(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009)):(this._payloadLength=t*Math.pow(2,32)+e.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,yi(RangeError,"Max payload size exceeded",!1,1009);this._masked?this._state=ZH:this._state=GO}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=GO}getData(e){var t=ide;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}t=this.consume(this._payloadLength),this._masked&&lde(t,this._mask)}if(this._opcode>7)return this.controlMessage(t);if(this._compressed){this._state=ude,this.decompress(t,e);return}return t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage()}decompress(e,t){this._extensions[zH.extensionName].decompress(e,this._fin,(i,o)=>{if(i)return t(i);if(o.length){if(this._messageLength+=o.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return t(yi(RangeError,"Max payload size exceeded",!1,1009));this._fragments.push(o)}let s=this.dataMessage();if(s)return t(s);this.startLoop(t)})}dataMessage(){if(this._fin){let t=this._messageLength,r=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){var e;this._binaryType==="nodebuffer"?e=HO(r,t):this._binaryType==="arraybuffer"?e=ade(HO(r,t)):e=r,this.emit("message",e)}else{let i=HO(r,t);if(!QH(i))return this._loop=!1,yi(Error,"invalid UTF-8 sequence",!0,1007);this.emit("message",i.toString())}}this._state=XE}controlMessage(e){if(this._opcode===8)if(this._loop=!1,e.length===0)this.emit("conclude",1005,""),this.end();else{if(e.length===1)return yi(RangeError,"invalid payload length 1",!0,1002);{let t=e.readUInt16BE(0);if(!cde(t))return yi(RangeError,`invalid status code ${t}`,!0,1002);let r=e.slice(2);if(!QH(r))return yi(Error,"invalid UTF-8 sequence",!0,1007);this.emit("conclude",t,r.toString()),this.end()}}else this._opcode===9?this.emit("ping",e):this.emit("pong",e);this._state=XE}};e4.exports=zO;function yi(n,e,t,r){let i=new n(t?`Invalid WebSocket frame: ${e}`:e);return Error.captureStackTrace(i,yi),i[ode]=r,i}});var XO=F((d6e,n4)=>{"use strict";var{randomBytes:dde}=require("crypto"),t4=QE(),{EMPTY_BUFFER:pde}=gf(),{isValidStatusCode:mde}=qO(),{mask:r4,toBuffer:mu}=U_(),YO=class n{constructor(e,t){this._extensions=t||{},this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,t){let r=t.mask&&t.readOnly;var i=t.mask?6:2,o=e.length;e.length>=65536?(i+=8,o=127):e.length>125&&(i+=2,o=126);let s=Buffer.allocUnsafe(r?e.length+i:i);if(s[0]=t.fin?t.opcode|128:t.opcode,t.rsv1&&(s[0]|=64),s[1]=o,o===126?s.writeUInt16BE(e.length,2):o===127&&(s.writeUInt32BE(0,2),s.writeUInt32BE(e.length,6)),!t.mask)return[s,e];let a=dde(4);return s[1]|=128,s[i-4]=a[0],s[i-3]=a[1],s[i-2]=a[2],s[i-1]=a[3],r?(r4(e,a,s,i,e.length),[s]):(r4(e,a,e,0,e.length),[s,e])}close(e,t,r,i){var o;if(e===void 0)o=pde;else{if(typeof e!="number"||!mde(e))throw new TypeError("First argument must be a valid error code number");t===void 0||t===""?(o=Buffer.allocUnsafe(2),o.writeUInt16BE(e,0)):(o=Buffer.allocUnsafe(2+Buffer.byteLength(t)),o.writeUInt16BE(e,0),o.write(t,2))}this._deflating?this.enqueue([this.doClose,o,r,i]):this.doClose(o,r,i)}doClose(e,t,r){this.sendFrame(n.frame(e,{fin:!0,rsv1:!1,opcode:8,mask:t,readOnly:!1}),r)}ping(e,t,r){let i=mu(e);this._deflating?this.enqueue([this.doPing,i,t,mu.readOnly,r]):this.doPing(i,t,mu.readOnly,r)}doPing(e,t,r,i){this.sendFrame(n.frame(e,{fin:!0,rsv1:!1,opcode:9,mask:t,readOnly:r}),i)}pong(e,t,r){let i=mu(e);this._deflating?this.enqueue([this.doPong,i,t,mu.readOnly,r]):this.doPong(i,t,mu.readOnly,r)}doPong(e,t,r,i){this.sendFrame(n.frame(e,{fin:!0,rsv1:!1,opcode:10,mask:t,readOnly:r}),i)}send(e,t,r){let i=mu(e),o=this._extensions[t4.extensionName];var s=t.binary?2:1,a=t.compress;if(this._firstFragment?(this._firstFragment=!1,a&&o&&(a=i.length>=o._threshold),this._compress=a):(a=!1,s=0),t.fin&&(this._firstFragment=!0),o){let l={fin:t.fin,rsv1:a,opcode:s,mask:t.mask,readOnly:mu.readOnly};this._deflating?this.enqueue([this.dispatch,i,this._compress,l,r]):this.dispatch(i,this._compress,l,r)}else this.sendFrame(n.frame(i,{fin:t.fin,rsv1:!1,opcode:s,mask:t.mask,readOnly:mu.readOnly}),r)}dispatch(e,t,r,i){if(!t){this.sendFrame(n.frame(e,r),i);return}let o=this._extensions[t4.extensionName];this._deflating=!0,o.compress(e,r.fin,(s,a)=>{this._deflating=!1,r.readOnly=!1,this.sendFrame(n.frame(a,r),i),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[1].length,e[0].apply(this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[1].length,this._queue.push(e)}sendFrame(e,t){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}};n4.exports=YO});var tF=F((p6e,f4)=>{"use strict";var fde=require("events"),i4=require("crypto"),hde=require("https"),gde=require("http"),vde=require("net"),yde=require("tls"),Fy=require("url"),gp=QE(),l4=$H(),o4=$O(),bde=QO(),Ide=XO(),{BINARY_TYPES:s4,EMPTY_BUFFER:ZO,GUID:Sde,kStatusCode:Cde,kWebSocket:xo,NOOP:c4}=gf(),B_=["CONNECTING","OPEN","CLOSING","CLOSED"],eF=[8,13],Ede=30*1e3,Do=class n extends fde{constructor(e,t,r){super(),this.readyState=n.CONNECTING,this.protocol="",this._binaryType=s4[0],this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage="",this._closeTimer=null,this._closeCode=1006,this._extensions={},this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._isServer=!1,this._redirects=0,Array.isArray(t)?t=t.join(", "):typeof t=="object"&&t!==null&&(r=t,t=void 0),u4(this,e,t,r)):this._isServer=!0}get CONNECTING(){return n.CONNECTING}get CLOSING(){return n.CLOSING}get CLOSED(){return n.CLOSED}get OPEN(){return n.OPEN}get binaryType(){return this._binaryType}set binaryType(e){s4.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?(this._socket.bufferSize||0)+this._sender._bufferedBytes:0}get extensions(){return Object.keys(this._extensions).join()}setSocket(e,t,r){let i=new bde(this._binaryType,this._extensions,r);this._sender=new Ide(e,this._extensions),this._receiver=i,this._socket=e,i[xo]=this,e[xo]=this,i.on("conclude",kde),i.on("drain",xde),i.on("error",Dde),i.on("message",_de),i.on("ping",Tde),i.on("pong",Rde),e.setTimeout(0),e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",d4),e.on("data",$_),e.on("end",p4),e.on("error",m4),this.readyState=n.OPEN,this.emit("open")}emitClose(){if(this.readyState=n.CLOSED,!this._socket){this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[gp.extensionName]&&this._extensions[gp.extensionName].cleanup(),this._receiver.removeAllListeners(),this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==n.CLOSED){if(this.readyState===n.CONNECTING)return fu(this,this._req,"WebSocket was closed before the connection was established");if(this.readyState===n.CLOSING){this._closeFrameSent&&this._closeFrameReceived&&this._socket.end();return}this.readyState=n.CLOSING,this._sender.close(e,t,!this._isServer,r=>{r||(this._closeFrameSent=!0,this._closeFrameReceived&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),Ede)}}ping(e,t,r){if(typeof e=="function"?(r=e,e=t=void 0):typeof t=="function"&&(r=t,t=void 0),this.readyState!==n.OPEN){let i=new Error(`WebSocket is not open: readyState ${this.readyState} (${B_[this.readyState]})`);if(r)return r(i);throw i}typeof e=="number"&&(e=e.toString()),t===void 0&&(t=!this._isServer),this._sender.ping(e||ZO,t,r)}pong(e,t,r){if(typeof e=="function"?(r=e,e=t=void 0):typeof t=="function"&&(r=t,t=void 0),this.readyState!==n.OPEN){let i=new Error(`WebSocket is not open: readyState ${this.readyState} (${B_[this.readyState]})`);if(r)return r(i);throw i}typeof e=="number"&&(e=e.toString()),t===void 0&&(t=!this._isServer),this._sender.pong(e||ZO,t,r)}send(e,t,r){if(typeof t=="function"&&(r=t,t={}),this.readyState!==n.OPEN){let o=new Error(`WebSocket is not open: readyState ${this.readyState} (${B_[this.readyState]})`);if(r)return r(o);throw o}typeof e=="number"&&(e=e.toString());let i=Object.assign({binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0},t);this._extensions[gp.extensionName]||(i.compress=!1),this._sender.send(e||ZO,i,r)}terminate(){if(this.readyState!==n.CLOSED){if(this.readyState===n.CONNECTING)return fu(this,this._req,"WebSocket was closed before the connection was established");this._socket&&(this.readyState=n.CLOSING,this._socket.destroy())}}};B_.forEach((n,e)=>{Do[n]=e});["open","error","close","message"].forEach(n=>{Object.defineProperty(Do.prototype,`on${n}`,{get(){let e=this.listeners(n);for(var t=0;t<e.length;t++)if(e[t]._listener)return e[t]._listener},set(e){let t=this.listeners(n);for(var r=0;r<t.length;r++)t[r]._listener&&this.removeListener(n,t[r]);this.addEventListener(n,e)}})});Do.prototype.addEventListener=l4.addEventListener;Do.prototype.removeEventListener=l4.removeEventListener;f4.exports=Do;function u4(n,e,t,r){let i=Object.assign({protocolVersion:eF[1],maxPayload:104857600,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10},r,{createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:void 0,auth:void 0,host:void 0,path:void 0,port:void 0});if(!eF.includes(i.protocolVersion))throw new RangeError(`Unsupported protocol version: ${i.protocolVersion} (supported versions: ${eF.join(", ")})`);var o;typeof e=="object"&&e.href!==void 0?(o=e,n.url=e.href):(o=Fy.URL?new Fy.URL(e):Fy.parse(e),n.url=e);let s=o.protocol==="ws+unix:";if(!o.host&&(!s||!o.pathname))throw new Error(`Invalid URL: ${n.url}`);let a=o.protocol==="wss:"||o.protocol==="https:",l=a?443:80,c=i4.randomBytes(16).toString("base64"),u=a?hde.get:gde.get,d=o.search?`${o.pathname||"/"}${o.search}`:o.pathname||"/";var f;if(i.createConnection=a?Pde:wde,i.defaultPort=i.defaultPort||l,i.port=o.port||l,i.host=o.hostname.startsWith("[")?o.hostname.slice(1,-1):o.hostname,i.headers=Object.assign({"Sec-WebSocket-Version":i.protocolVersion,"Sec-WebSocket-Key":c,Connection:"Upgrade",Upgrade:"websocket"},i.headers),i.path=d,i.timeout=i.handshakeTimeout,i.perMessageDeflate&&(f=new gp(i.perMessageDeflate!==!0?i.perMessageDeflate:{},!1,i.maxPayload),i.headers["Sec-WebSocket-Extensions"]=o4.format({[gp.extensionName]:f.offer()})),t&&(i.headers["Sec-WebSocket-Protocol"]=t),i.origin&&(i.protocolVersion<13?i.headers["Sec-WebSocket-Origin"]=i.origin:i.headers.Origin=i.origin),o.auth?i.auth=o.auth:(o.username||o.password)&&(i.auth=`${o.username}:${o.password}`),s){let b=d.split(":");i.socketPath=b[0],i.path=b[1]}var g=n._req=u(i);i.timeout&&g.on("timeout",()=>{fu(n,g,"Opening handshake has timed out")}),g.on("error",b=>{n._req.aborted||(g=n._req=null,n.readyState=Do.CLOSING,n.emit("error",b),n.emitClose())}),g.on("response",b=>{let I=b.headers.location,w=b.statusCode;if(I&&i.followRedirects&&w>=300&&w<400){if(++n._redirects>i.maxRedirects){fu(n,g,"Maximum redirects exceeded");return}g.abort();let _=Fy.URL?new Fy.URL(I,e):Fy.resolve(e,I);u4(n,_,t,r)}else n.emit("unexpected-response",g,b)||fu(n,g,`Unexpected server response: ${b.statusCode}`)}),g.on("upgrade",(b,I,w)=>{if(n.emit("upgrade",b),n.readyState!==Do.CONNECTING)return;g=n._req=null;let _=i4.createHash("sha1").update(c+Sde).digest("base64");if(b.headers["sec-websocket-accept"]!==_){fu(n,I,"Invalid Sec-WebSocket-Accept header");return}let A=b.headers["sec-websocket-protocol"],R=(t||"").split(/, */);var V;if(!t&&A?V="Server sent a subprotocol but none was requested":t&&!A?V="Server sent no subprotocol":A&&!R.includes(A)&&(V="Server sent an invalid subprotocol"),V){fu(n,I,V);return}if(A&&(n.protocol=A),f)try{let ie=o4.parse(b.headers["sec-websocket-extensions"]);ie[gp.extensionName]&&(f.accept(ie[gp.extensionName]),n._extensions[gp.extensionName]=f)}catch{fu(n,I,"Invalid Sec-WebSocket-Extensions header");return}n.setSocket(I,w,i.maxPayload)})}function wde(n){return n.protocolVersion&&(n.path=n.socketPath),vde.connect(n)}function Pde(n){return n.path=void 0,n.servername=n.servername||n.host,yde.connect(n)}function fu(n,e,t){n.readyState=Do.CLOSING;let r=new Error(t);Error.captureStackTrace(r,fu),e.setHeader?(e.abort(),e.once("abort",n.emitClose.bind(n)),n.emit("error",r)):(e.destroy(r),e.once("error",n.emit.bind(n,"error")),e.once("close",n.emitClose.bind(n)))}function kde(n,e){let t=this[xo];t._socket.removeListener("data",$_),t._socket.resume(),t._closeFrameReceived=!0,t._closeMessage=e,t._closeCode=n,n===1005?t.close():t.close(n,e)}function xde(){this[xo]._socket.resume()}function Dde(n){let e=this[xo];e._socket.removeListener("data",$_),e.readyState=Do.CLOSING,e._closeCode=n[Cde],e.emit("error",n),e._socket.destroy()}function a4(){this[xo].emitClose()}function _de(n){this[xo].emit("message",n)}function Tde(n){let e=this[xo];e.pong(n,!e._isServer,c4),e.emit("ping",n)}function Rde(n){this[xo].emit("pong",n)}function d4(){let n=this[xo];this.removeListener("close",d4),this.removeListener("end",p4),n.readyState=Do.CLOSING,n._socket.read(),n._receiver.end(),this.removeListener("data",$_),this[xo]=void 0,clearTimeout(n._closeTimer),n._receiver._writableState.finished||n._receiver._writableState.errorEmitted?n.emitClose():(n._receiver.on("error",a4),n._receiver.on("finish",a4))}function $_(n){this[xo]._receiver.write(n)||this.pause()}function p4(){let n=this[xo];n.readyState=Do.CLOSING,n._receiver.end(),this.end()}function m4(){let n=this[xo];this.removeListener("error",m4),this.on("error",c4),n.readyState=Do.CLOSING,this.destroy()}});var v4=F((m6e,g4)=>{"use strict";var Ade=require("events"),Nde=require("crypto"),q_=require("http"),vf=QE(),h4=$O(),Mde=tF(),{GUID:Kde}=gf(),Ode=/^[+/0-9A-Za-z]{22}==$/,rF=class extends Ade{constructor(e,t){if(super(),e=Object.assign({maxPayload:100*1024*1024,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null},e),e.port==null&&!e.server&&!e.noServer)throw new TypeError('One of the "port", "server", or "noServer" options must be specified');e.port!=null?(this._server=q_.createServer((r,i)=>{let o=q_.STATUS_CODES[426];i.writeHead(426,{"Content-Length":o.length,"Content-Type":"text/plain"}),i.end(o)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server&&(this._removeListeners=Fde(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(r,i,o)=>{this.handleUpgrade(r,i,o,s=>{this.emit("connection",s,r)})}})),e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set),this.options=e}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(e&&this.once("close",e),this.clients)for(let r of this.clients)r.terminate();let t=this._server;if(t&&(this._removeListeners(),this._removeListeners=this._server=null,this.options.port!=null)){t.close(()=>this.emit("close"));return}process.nextTick(Lde,this)}shouldHandle(e){if(this.options.path){let t=e.url.indexOf("?");if((t!==-1?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,r,i){t.on("error",nF);let o=e.headers["sec-websocket-key"]!==void 0?e.headers["sec-websocket-key"].trim():!1,s=e.headers.upgrade,a=+e.headers["sec-websocket-version"],l={};if(e.method!=="GET"||s===void 0||s.toLowerCase()!=="websocket"||!o||!Ode.test(o)||a!==8&&a!==13||!this.shouldHandle(e))return J_(t,400);if(this.options.perMessageDeflate){let c=new vf(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let u=h4.parse(e.headers["sec-websocket-extensions"]);u[vf.extensionName]&&(c.accept(u[vf.extensionName]),l[vf.extensionName]=c)}catch{return J_(t,400)}}if(this.options.verifyClient){let c={origin:e.headers[`${a===8?"sec-websocket-origin":"origin"}`],secure:!!(e.connection.authorized||e.connection.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(c,(u,d,f,g)=>{if(!u)return J_(t,d||401,f,g);this.completeUpgrade(o,l,e,t,r,i)});return}if(!this.options.verifyClient(c))return J_(t,401)}this.completeUpgrade(o,l,e,t,r,i)}completeUpgrade(e,t,r,i,o,s){if(!i.readable||!i.writable)return i.destroy();let l=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${Nde.createHash("sha1").update(e+Kde).digest("base64")}`],c=new Mde(null);var u=r.headers["sec-websocket-protocol"];if(u&&(u=u.split(",").map(Ude),this.options.handleProtocols?u=this.options.handleProtocols(u,r):u=u[0],u&&(l.push(`Sec-WebSocket-Protocol: ${u}`),c.protocol=u)),t[vf.extensionName]){let d=t[vf.extensionName].params,f=h4.format({[vf.extensionName]:[d]});l.push(`Sec-WebSocket-Extensions: ${f}`),c._extensions=t}this.emit("headers",l,r),i.write(l.concat(`\r
`).join(`\r
`)),i.removeListener("error",nF),c.setSocket(i,o,this.options.maxPayload),this.clients&&(this.clients.add(c),c.on("close",()=>this.clients.delete(c))),s(c)}};g4.exports=rF;function Fde(n,e){for(let t of Object.keys(e))n.on(t,e[t]);return function(){for(let r of Object.keys(e))n.removeListener(r,e[r])}}function Lde(n){n.emit("close")}function nF(){this.destroy()}function J_(n,e,t,r){n.writable&&(t=t||q_.STATUS_CODES[e],r=Object.assign({Connection:"close","Content-type":"text/html","Content-Length":Buffer.byteLength(t)},r),n.write(`HTTP/1.1 ${e} ${q_.STATUS_CODES[e]}\r
`+Object.keys(r).map(i=>`${i}: ${r[i]}`).join(`\r
`)+`\r
\r
`+t)),n.removeListener("error",nF),n.destroy()}function Ude(n){return n.trim()}});var b4=F((f6e,y4)=>{"use strict";var H_=tF();H_.Server=v4();H_.Receiver=QO();H_.Sender=XO();y4.exports=H_});var S4=F((h6e,I4)=>{"use strict";I4.exports=b4()});var D4=F((X_,x4)=>{(function(n,e){typeof X_=="object"&&typeof x4<"u"?e(X_):typeof define=="function"&&define.amd?define(["exports"],e):(n=typeof globalThis<"u"?globalThis:n||self,e(n.lumino_algorithm={}))})(X_,function(n){"use strict";n.ArrayExt=void 0,function(L){function W(Z,ue,j,B){j===void 0&&(j=0),B===void 0&&(B=-1);var z=Z.length;if(z===0)return-1;j<0?j=Math.max(0,j+z):j=Math.min(j,z-1),B<0?B=Math.max(0,B+z):B=Math.min(B,z-1);var Ee;B<j?Ee=B+1+(z-j):Ee=B-j+1;for(var Ne=0;Ne<Ee;++Ne){var se=(j+Ne)%z;if(Z[se]===ue)return se}return-1}L.firstIndexOf=W;function fe(Z,ue,j,B){j===void 0&&(j=-1),B===void 0&&(B=0);var z=Z.length;if(z===0)return-1;j<0?j=Math.max(0,j+z):j=Math.min(j,z-1),B<0?B=Math.max(0,B+z):B=Math.min(B,z-1);var Ee;j<B?Ee=j+1+(z-B):Ee=j-B+1;for(var Ne=0;Ne<Ee;++Ne){var se=(j-Ne+z)%z;if(Z[se]===ue)return se}return-1}L.lastIndexOf=fe;function Re(Z,ue,j,B){j===void 0&&(j=0),B===void 0&&(B=-1);var z=Z.length;if(z===0)return-1;j<0?j=Math.max(0,j+z):j=Math.min(j,z-1),B<0?B=Math.max(0,B+z):B=Math.min(B,z-1);var Ee;B<j?Ee=B+1+(z-j):Ee=B-j+1;for(var Ne=0;Ne<Ee;++Ne){var se=(j+Ne)%z;if(ue(Z[se],se))return se}return-1}L.findFirstIndex=Re;function ze(Z,ue,j,B){j===void 0&&(j=-1),B===void 0&&(B=0);var z=Z.length;if(z===0)return-1;j<0?j=Math.max(0,j+z):j=Math.min(j,z-1),B<0?B=Math.max(0,B+z):B=Math.min(B,z-1);var Ee;j<B?Ee=j+1+(z-B):Ee=j-B+1;for(var Ne=0;Ne<Ee;++Ne){var se=(j-Ne+z)%z;if(ue(Z[se],se))return se}return-1}L.findLastIndex=ze;function tn(Z,ue,j,B){j===void 0&&(j=0),B===void 0&&(B=-1);var z=Re(Z,ue,j,B);return z!==-1?Z[z]:void 0}L.findFirstValue=tn;function jt(Z,ue,j,B){j===void 0&&(j=-1),B===void 0&&(B=0);var z=ze(Z,ue,j,B);return z!==-1?Z[z]:void 0}L.findLastValue=jt;function Ot(Z,ue,j,B,z){B===void 0&&(B=0),z===void 0&&(z=-1);var Ee=Z.length;if(Ee===0)return 0;B<0?B=Math.max(0,B+Ee):B=Math.min(B,Ee-1),z<0?z=Math.max(0,z+Ee):z=Math.min(z,Ee-1);for(var Ne=B,se=z-B+1;se>0;){var Gi=se>>1,td=Ne+Gi;j(Z[td],ue)<0?(Ne=td+1,se-=Gi+1):se=Gi}return Ne}L.lowerBound=Ot;function _t(Z,ue,j,B,z){B===void 0&&(B=0),z===void 0&&(z=-1);var Ee=Z.length;if(Ee===0)return 0;B<0?B=Math.max(0,B+Ee):B=Math.min(B,Ee-1),z<0?z=Math.max(0,z+Ee):z=Math.min(z,Ee-1);for(var Ne=B,se=z-B+1;se>0;){var Gi=se>>1,td=Ne+Gi;j(Z[td],ue)>0?se=Gi:(Ne=td+1,se-=Gi+1)}return Ne}L.upperBound=_t;function kr(Z,ue,j){if(Z===ue)return!0;if(Z.length!==ue.length)return!1;for(var B=0,z=Z.length;B<z;++B)if(j?!j(Z[B],ue[B]):Z[B]!==ue[B])return!1;return!0}L.shallowEqual=kr;function $r(Z,ue){ue===void 0&&(ue={});var j=ue.start,B=ue.stop,z=ue.step;if(z===void 0&&(z=1),z===0)throw new Error("Slice `step` cannot be zero.");var Ee=Z.length;j===void 0?j=z<0?Ee-1:0:j<0?j=Math.max(j+Ee,z<0?-1:0):j>=Ee&&(j=z<0?Ee-1:Ee),B===void 0?B=z<0?-1:Ee:B<0?B=Math.max(B+Ee,z<0?-1:0):B>=Ee&&(B=z<0?Ee-1:Ee);var Ne;z<0&&B>=j||z>0&&j>=B?Ne=0:z<0?Ne=Math.floor((B-j+1)/z+1):Ne=Math.floor((B-j-1)/z+1);for(var se=[],Gi=0;Gi<Ne;++Gi)se[Gi]=Z[j+Gi*z];return se}L.slice=$r;function Tr(Z,ue,j){var B=Z.length;if(!(B<=1)&&(ue<0?ue=Math.max(0,ue+B):ue=Math.min(ue,B-1),j<0?j=Math.max(0,j+B):j=Math.min(j,B-1),ue!==j)){for(var z=Z[ue],Ee=ue<j?1:-1,Ne=ue;Ne!==j;Ne+=Ee)Z[Ne]=Z[Ne+Ee];Z[j]=z}}L.move=Tr;function rn(Z,ue,j){ue===void 0&&(ue=0),j===void 0&&(j=-1);var B=Z.length;if(!(B<=1))for(ue<0?ue=Math.max(0,ue+B):ue=Math.min(ue,B-1),j<0?j=Math.max(0,j+B):j=Math.min(j,B-1);ue<j;){var z=Z[ue],Ee=Z[j];Z[ue++]=Ee,Z[j--]=z}}L.reverse=rn;function $(Z,ue,j,B){j===void 0&&(j=0),B===void 0&&(B=-1);var z=Z.length;if(!(z<=1)&&(j<0?j=Math.max(0,j+z):j=Math.min(j,z-1),B<0?B=Math.max(0,B+z):B=Math.min(B,z-1),!(j>=B))){var Ee=B-j+1;if(ue>0?ue=ue%Ee:ue<0&&(ue=(ue%Ee+Ee)%Ee),ue!==0){var Ne=j+ue;rn(Z,j,Ne-1),rn(Z,Ne,B),rn(Z,j,B)}}}L.rotate=$;function X(Z,ue,j,B){j===void 0&&(j=0),B===void 0&&(B=-1);var z=Z.length;if(z!==0){j<0?j=Math.max(0,j+z):j=Math.min(j,z-1),B<0?B=Math.max(0,B+z):B=Math.min(B,z-1);var Ee;B<j?Ee=B+1+(z-j):Ee=B-j+1;for(var Ne=0;Ne<Ee;++Ne)Z[(j+Ne)%z]=ue}}L.fill=X;function pe(Z,ue,j){var B=Z.length;ue<0?ue=Math.max(0,ue+B):ue=Math.min(ue,B);for(var z=B;z>ue;--z)Z[z]=Z[z-1];Z[ue]=j}L.insert=pe;function Ie(Z,ue){var j=Z.length;if(ue<0&&(ue+=j),!(ue<0||ue>=j)){for(var B=Z[ue],z=ue+1;z<j;++z)Z[z-1]=Z[z];return Z.length=j-1,B}}L.removeAt=Ie;function Je(Z,ue,j,B){j===void 0&&(j=0),B===void 0&&(B=-1);var z=W(Z,ue,j,B);return z!==-1&&Ie(Z,z),z}L.removeFirstOf=Je;function nn(Z,ue,j,B){j===void 0&&(j=-1),B===void 0&&(B=0);var z=fe(Z,ue,j,B);return z!==-1&&Ie(Z,z),z}L.removeLastOf=nn;function bt(Z,ue,j,B){j===void 0&&(j=0),B===void 0&&(B=-1);var z=Z.length;if(z===0)return 0;j<0?j=Math.max(0,j+z):j=Math.min(j,z-1),B<0?B=Math.max(0,B+z):B=Math.min(B,z-1);for(var Ee=0,Ne=0;Ne<z;++Ne)j<=B&&Ne>=j&&Ne<=B&&Z[Ne]===ue||B<j&&(Ne<=B||Ne>=j)&&Z[Ne]===ue?Ee++:Ee>0&&(Z[Ne-Ee]=Z[Ne]);return Ee>0&&(Z.length=z-Ee),Ee}L.removeAllOf=bt;function kt(Z,ue,j,B){j===void 0&&(j=0),B===void 0&&(B=-1);var z,Ee=Re(Z,ue,j,B);return Ee!==-1&&(z=Ie(Z,Ee)),{index:Ee,value:z}}L.removeFirstWhere=kt;function Qe(Z,ue,j,B){j===void 0&&(j=-1),B===void 0&&(B=0);var z,Ee=ze(Z,ue,j,B);return Ee!==-1&&(z=Ie(Z,Ee)),{index:Ee,value:z}}L.removeLastWhere=Qe;function At(Z,ue,j,B){j===void 0&&(j=0),B===void 0&&(B=-1);var z=Z.length;if(z===0)return 0;j<0?j=Math.max(0,j+z):j=Math.min(j,z-1),B<0?B=Math.max(0,B+z):B=Math.min(B,z-1);for(var Ee=0,Ne=0;Ne<z;++Ne)j<=B&&Ne>=j&&Ne<=B&&ue(Z[Ne],Ne)||B<j&&(Ne<=B||Ne>=j)&&ue(Z[Ne],Ne)?Ee++:Ee>0&&(Z[Ne-Ee]=Z[Ne]);return Ee>0&&(Z.length=z-Ee),Ee}L.removeAllWhere=At}(n.ArrayExt||(n.ArrayExt={}));function e(L){var W;return typeof L.iter=="function"?W=L.iter():W=new d(L),W}function t(L){return new f(L)}function r(L){return new g(L)}function i(L){return new b(L)}function o(L){return new I(L)}function s(L,W){for(var fe=0,Re=e(L),ze;(ze=Re.next())!==void 0;)if(W(ze,fe++)===!1)return}function a(L,W){for(var fe=0,Re=e(L),ze;(ze=Re.next())!==void 0;)if(!W(ze,fe++))return!1;return!0}function l(L,W){for(var fe=0,Re=e(L),ze;(ze=Re.next())!==void 0;)if(W(ze,fe++))return!0;return!1}function c(L){for(var W=0,fe=[],Re=e(L),ze;(ze=Re.next())!==void 0;)fe[W++]=ze;return fe}function u(L){for(var W=e(L),fe,Re={};(fe=W.next())!==void 0;)Re[fe[0]]=fe[1];return Re}var d=function(){function L(W){this._index=0,this._source=W}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var W=new L(this._source);return W._index=this._index,W},L.prototype.next=function(){if(!(this._index>=this._source.length))return this._source[this._index++]},L}(),f=function(){function L(W,fe){fe===void 0&&(fe=Object.keys(W)),this._index=0,this._source=W,this._keys=fe}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var W=new L(this._source,this._keys);return W._index=this._index,W},L.prototype.next=function(){if(!(this._index>=this._keys.length)){var W=this._keys[this._index++];return W in this._source?W:this.next()}},L}(),g=function(){function L(W,fe){fe===void 0&&(fe=Object.keys(W)),this._index=0,this._source=W,this._keys=fe}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var W=new L(this._source,this._keys);return W._index=this._index,W},L.prototype.next=function(){if(!(this._index>=this._keys.length)){var W=this._keys[this._index++];return W in this._source?this._source[W]:this.next()}},L}(),b=function(){function L(W,fe){fe===void 0&&(fe=Object.keys(W)),this._index=0,this._source=W,this._keys=fe}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var W=new L(this._source,this._keys);return W._index=this._index,W},L.prototype.next=function(){if(!(this._index>=this._keys.length)){var W=this._keys[this._index++];return W in this._source?[W,this._source[W]]:this.next()}},L}(),I=function(){function L(W){this._fn=W}return L.prototype.iter=function(){return this},L.prototype.clone=function(){throw new Error("An `FnIterator` cannot be cloned.")},L.prototype.next=function(){return this._fn.call(void 0)},L}();function w(){for(var L=[],W=0;W<arguments.length;W++)L[W]=arguments[W];return new _(e(L.map(e)))}var _=function(){function L(W){this._cloned=!1,this._source=W,this._active=void 0}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var W=new L(this._source.clone());return W._active=this._active&&this._active.clone(),W._cloned=!0,this._cloned=!0,W},L.prototype.next=function(){if(this._active===void 0){var W=this._source.next();if(W===void 0)return;this._active=this._cloned?W.clone():W}var fe=this._active.next();return fe!==void 0?fe:(this._active=void 0,this.next())},L}();function A(){return new R}var R=function(){function L(){}return L.prototype.iter=function(){return this},L.prototype.clone=function(){return new L},L.prototype.next=function(){},L}();function V(L,W){return W===void 0&&(W=0),new ie(e(L),W)}var ie=function(){function L(W,fe){this._source=W,this._index=fe}return L.prototype.iter=function(){return this},L.prototype.clone=function(){return new L(this._source.clone(),this._index)},L.prototype.next=function(){var W=this._source.next();if(W!==void 0)return[this._index++,W]},L}();function Q(L,W){return new te(e(L),W)}var te=function(){function L(W,fe){this._index=0,this._source=W,this._fn=fe}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var W=new L(this._source.clone(),this._fn);return W._index=this._index,W},L.prototype.next=function(){for(var W=this._fn,fe=this._source,Re;(Re=fe.next())!==void 0;)if(W(Re,this._index++))return Re},L}();function ae(L,W){for(var fe=0,Re=e(L),ze;(ze=Re.next())!==void 0;)if(W(ze,fe++))return ze}function Y(L,W){for(var fe=0,Re=e(L),ze;(ze=Re.next())!==void 0;)if(W(ze,fe++))return fe-1;return-1}function be(L,W){var fe=e(L),Re=fe.next();if(Re!==void 0){for(var ze=Re;(Re=fe.next())!==void 0;)W(Re,ze)<0&&(ze=Re);return ze}}function Fe(L,W){var fe=e(L),Re=fe.next();if(Re!==void 0){for(var ze=Re;(Re=fe.next())!==void 0;)W(Re,ze)>0&&(ze=Re);return ze}}function ft(L,W){var fe=e(L),Re=fe.next();if(Re!==void 0){for(var ze=Re,tn=Re;(Re=fe.next())!==void 0;)W(Re,ze)<0?ze=Re:W(Re,tn)>0&&(tn=Re);return[ze,tn]}}function ht(L,W){return new xt(e(L),W)}var xt=function(){function L(W,fe){this._index=0,this._source=W,this._fn=fe}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var W=new L(this._source.clone(),this._fn);return W._index=this._index,W},L.prototype.next=function(){var W=this._source.next();if(W!==void 0)return this._fn.call(void 0,W,this._index++)},L}();function ee(L,W,fe){return W===void 0?new ke(0,L,1):fe===void 0?new ke(L,W,1):new ke(L,W,fe)}var ke=function(){function L(W,fe,Re){this._index=0,this._start=W,this._stop=fe,this._step=Re,this._length=Te.rangeLength(W,fe,Re)}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var W=new L(this._start,this._stop,this._step);return W._index=this._index,W},L.prototype.next=function(){if(!(this._index>=this._length))return this._start+this._step*this._index++},L}(),Te;(function(L){function W(fe,Re,ze){return ze===0?1/0:fe>Re&&ze>0||fe<Re&&ze<0?0:Math.ceil((Re-fe)/ze)}L.rangeLength=W})(Te||(Te={}));function ve(L,W,fe){var Re=0,ze=e(L),tn=ze.next();if(tn===void 0&&fe===void 0)throw new TypeError("Reduce of empty iterable with no initial value.");if(tn===void 0)return fe;var jt=ze.next();if(jt===void 0&&fe===void 0)return tn;if(jt===void 0)return W(fe,tn,Re++);var Ot;fe===void 0?Ot=W(tn,jt,Re++):Ot=W(W(fe,tn,Re++),jt,Re++);for(var _t;(_t=ze.next())!==void 0;)Ot=W(Ot,_t,Re++);return Ot}function vt(L,W){return new dr(L,W)}function qi(L){return new dr(L,1)}var dr=function(){function L(W,fe){this._value=W,this._count=fe}return L.prototype.iter=function(){return this},L.prototype.clone=function(){return new L(this._value,this._count)},L.prototype.next=function(){if(!(this._count<=0))return this._count--,this._value},L}();function Pi(L){var W;return typeof L.retro=="function"?W=L.retro():W=new ed(L),W}var ed=function(){function L(W){this._source=W,this._index=W.length-1}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var W=new L(this._source);return W._index=this._index,W},L.prototype.next=function(){if(!(this._index<0||this._index>=this._source.length))return this._source[this._index--]},L}();function Br(L){var W=[],fe=new Set,Re=new Map;return s(L,ze),Re.forEach(function(jt,Ot){tn(Ot)}),W;function ze(jt){var Ot=jt[0],_t=jt[1],kr=Re.get(_t);kr?kr.push(Ot):Re.set(_t,[Ot])}function tn(jt){if(!fe.has(jt)){fe.add(jt);var Ot=Re.get(jt);Ot&&Ot.forEach(tn),W.push(jt)}}}function aa(L,W){return new tl(e(L),W)}var tl=function(){function L(W,fe){this._source=W,this._step=fe}return L.prototype.iter=function(){return this},L.prototype.clone=function(){return new L(this._source.clone(),this._step)},L.prototype.next=function(){for(var W=this._source.next(),fe=this._step-1;fe>0;--fe)this._source.next();return W},L}();n.StringExt=void 0,function(L){function W(jt,Ot,_t){_t===void 0&&(_t=0);for(var kr=new Array(Ot.length),$r=0,Tr=_t,rn=Ot.length;$r<rn;++$r,++Tr){if(Tr=jt.indexOf(Ot[$r],Tr),Tr===-1)return null;kr[$r]=Tr}return kr}L.findIndices=W;function fe(jt,Ot,_t){_t===void 0&&(_t=0);var kr=W(jt,Ot,_t);if(!kr)return null;for(var $r=0,Tr=0,rn=kr.length;Tr<rn;++Tr){var $=kr[Tr]-_t;$r+=$*$}return{score:$r,indices:kr}}L.matchSumOfSquares=fe;function Re(jt,Ot,_t){_t===void 0&&(_t=0);var kr=W(jt,Ot,_t);if(!kr)return null;for(var $r=0,Tr=_t-1,rn=0,$=kr.length;rn<$;++rn){var X=kr[rn];$r+=X-Tr-1,Tr=X}return{score:$r,indices:kr}}L.matchSumOfDeltas=Re;function ze(jt,Ot,_t){for(var kr=[],$r=0,Tr=0,rn=Ot.length;$r<rn;){for(var $=Ot[$r],X=Ot[$r];++$r<rn&&Ot[$r]===X+1;)X++;Tr<$&&kr.push(jt.slice(Tr,$)),$<X+1&&kr.push(_t(jt.slice($,X+1))),Tr=X+1}return Tr<jt.length&&kr.push(jt.slice(Tr)),kr}L.highlight=ze;function tn(jt,Ot){return jt<Ot?-1:jt>Ot?1:0}L.cmp=tn}(n.StringExt||(n.StringExt={}));function Kt(L,W){return new Hi(e(L),W)}var Hi=function(){function L(W,fe){this._source=W,this._count=fe}return L.prototype.iter=function(){return this},L.prototype.clone=function(){return new L(this._source.clone(),this._count)},L.prototype.next=function(){if(!(this._count<=0)){var W=this._source.next();if(W!==void 0)return this._count--,W}},L}();function ai(){for(var L=[],W=0;W<arguments.length;W++)L[W]=arguments[W];return new Ac(L.map(e))}var Ac=function(){function L(W){this._source=W}return L.prototype.iter=function(){return this},L.prototype.clone=function(){return new L(this._source.map(function(W){return W.clone()}))},L.prototype.next=function(){for(var W=new Array(this._source.length),fe=0,Re=this._source.length;fe<Re;++fe){var ze=this._source[fe].next();if(ze===void 0)return;W[fe]=ze}return W},L}();n.ArrayIterator=d,n.ChainIterator=_,n.EmptyIterator=R,n.EnumerateIterator=ie,n.FilterIterator=te,n.FnIterator=I,n.ItemIterator=b,n.KeyIterator=f,n.MapIterator=xt,n.RangeIterator=ke,n.RepeatIterator=dr,n.RetroArrayIterator=ed,n.StrideIterator=tl,n.TakeIterator=Hi,n.ValueIterator=g,n.ZipIterator=Ac,n.chain=w,n.each=s,n.empty=A,n.enumerate=V,n.every=a,n.filter=Q,n.find=ae,n.findIndex=Y,n.iter=e,n.iterFn=o,n.iterItems=i,n.iterKeys=t,n.iterValues=r,n.map=ht,n.max=Fe,n.min=be,n.minmax=ft,n.once=qi,n.range=ee,n.reduce=ve,n.repeat=vt,n.retro=Pi,n.some=l,n.stride=aa,n.take=Kt,n.toArray=c,n.toObject=u,n.topologicSort=Br,n.zip=ai,Object.defineProperty(n,"__esModule",{value:!0})})});var T4=F((Z_,_4)=>{(function(n,e){typeof Z_=="object"&&typeof _4<"u"?e(Z_):typeof define=="function"&&define.amd?define(["exports"],e):(n=typeof globalThis<"u"?globalThis:n||self,e(n.lumino_properties={}))})(Z_,function(n){"use strict";n.AttachedProperty=function(){function t(r){this._pid=e.nextPID(),this.name=r.name,this._create=r.create,this._coerce=r.coerce||null,this._compare=r.compare||null,this._changed=r.changed||null}return t.prototype.get=function(r){var i,o=e.ensureMap(r);return this._pid in o?i=o[this._pid]:i=o[this._pid]=this._createValue(r),i},t.prototype.set=function(r,i){var o,s=e.ensureMap(r);this._pid in s?o=s[this._pid]:o=s[this._pid]=this._createValue(r);var a=this._coerceValue(r,i);this._maybeNotify(r,o,s[this._pid]=a)},t.prototype.coerce=function(r){var i,o=e.ensureMap(r);this._pid in o?i=o[this._pid]:i=o[this._pid]=this._createValue(r);var s=this._coerceValue(r,i);this._maybeNotify(r,i,o[this._pid]=s)},t.prototype._createValue=function(r){var i=this._create;return i(r)},t.prototype._coerceValue=function(r,i){var o=this._coerce;return o?o(r,i):i},t.prototype._compareValue=function(r,i){var o=this._compare;return o?o(r,i):r===i},t.prototype._maybeNotify=function(r,i,o){var s=this._changed;s&&!this._compareValue(i,o)&&s(r,i,o)},t}(),function(t){function r(i){e.ownerData.delete(i)}t.clearData=r}(n.AttachedProperty||(n.AttachedProperty={}));var e;(function(t){t.ownerData=new WeakMap,t.nextPID=function(){var i=0;return function(){var o=Math.random(),s=(""+o).slice(2);return"pid-"+s+"-"+i++}}();function r(i){var o=t.ownerData.get(i);return o||(o=Object.create(null),t.ownerData.set(i,o),o)}t.ensureMap=r})(e||(e={})),Object.defineProperty(n,"__esModule",{value:!0})})});var tT=F((eT,R4)=>{(function(n,e){typeof eT=="object"&&typeof R4<"u"?e(eT,D4(),T4()):typeof define=="function"&&define.amd?define(["exports","@lumino/algorithm","@lumino/properties"],e):(n=typeof globalThis<"u"?globalThis:n||self,e(n.lumino_signaling={},n.lumino_algorithm,n.lumino_properties))})(eT,function(n,e,t){"use strict";n.Signal=function(){function i(o){this._blockedCount=0,this.sender=o}return i.prototype.block=function(o){this._blockedCount++;try{o()}finally{this._blockedCount--}},i.prototype.connect=function(o,s){return r.connect(this,o,s)},i.prototype.disconnect=function(o,s){return r.disconnect(this,o,s)},i.prototype.emit=function(o){this._blockedCount||r.emit(this,o)},i}(),function(i){function o(g,b){var I=r.blockedProperty;I.set(g,I.get(g)+1);try{b()}finally{I.set(g,I.get(g)-1)}}i.blockAll=o;function s(g,b){r.disconnectBetween(g,b)}i.disconnectBetween=s;function a(g){r.disconnectSender(g)}i.disconnectSender=a;function l(g){r.disconnectReceiver(g)}i.disconnectReceiver=l;function c(g){r.disconnectAll(g)}i.disconnectAll=c;function u(g){r.disconnectAll(g)}i.clearData=u;function d(){return r.exceptionHandler}i.getExceptionHandler=d;function f(g){var b=r.exceptionHandler;return r.exceptionHandler=g,b}i.setExceptionHandler=f}(n.Signal||(n.Signal={}));var r;(function(i){i.exceptionHandler=function(Q){console.error(Q)};function o(Q,te,ae){ae=ae||void 0;var Y=f.get(Q.sender);if(Y||(Y=[],f.set(Q.sender,Y)),w(Y,Q,te,ae))return!1;var be=ae||te,Fe=g.get(be);Fe||(Fe=[],g.set(be,Fe));var ft={signal:Q,slot:te,thisArg:ae};return Y.push(ft),Fe.push(ft),!0}i.connect=o;function s(Q,te,ae){ae=ae||void 0;var Y=f.get(Q.sender);if(!Y||Y.length===0)return!1;var be=w(Y,Q,te,ae);if(!be)return!1;var Fe=ae||te,ft=g.get(Fe);return be.signal=null,A(Y),A(ft),!0}i.disconnect=s;function a(Q,te){var ae=f.get(Q);if(!(!ae||ae.length===0)){var Y=g.get(te);!Y||Y.length===0||(e.each(Y,function(be){be.signal&&be.signal.sender===Q&&(be.signal=null)}),A(ae),A(Y))}}i.disconnectBetween=a;function l(Q){var te=f.get(Q);!te||te.length===0||(e.each(te,function(ae){if(ae.signal){var Y=ae.thisArg||ae.slot;ae.signal=null,A(g.get(Y))}}),A(te))}i.disconnectSender=l;function c(Q){var te=g.get(Q);!te||te.length===0||(e.each(te,function(ae){if(ae.signal){var Y=ae.signal.sender;ae.signal=null,A(f.get(Y))}}),A(te))}i.disconnectReceiver=c;function u(Q){l(Q),c(Q)}i.disconnectAll=u;function d(Q,te){if(!(i.blockedProperty.get(Q.sender)>0)){var ae=f.get(Q.sender);if(!(!ae||ae.length===0))for(var Y=0,be=ae.length;Y<be;++Y){var Fe=ae[Y];Fe.signal===Q&&_(Fe,te)}}}i.emit=d;var f=new WeakMap,g=new WeakMap,b=new Set,I=function(){var Q=typeof requestAnimationFrame=="function";return Q?requestAnimationFrame:setImmediate}();function w(Q,te,ae,Y){return e.find(Q,function(be){return be.signal===te&&be.slot===ae&&be.thisArg===Y})}function _(Q,te){var ae=Q.signal,Y=Q.slot,be=Q.thisArg;try{Y.call(be,ae.sender,te)}catch(Fe){i.exceptionHandler(Fe)}}function A(Q){b.size===0&&I(R),b.add(Q)}function R(){b.forEach(V),b.clear()}function V(Q){e.ArrayExt.removeAllWhere(Q,ie)}function ie(Q){return Q.signal===null}i.blockedProperty=new t.AttachedProperty({name:"blocked",create:function(){return 0}})})(r||(r={})),Object.defineProperty(n,"__esModule",{value:!0})})});var gF=F((pXe,q4)=>{"use strict";var Xde=require("child_process").spawn;function Zde(n){if(n){n=n.trim();var e=/your \d+x\d+ screen size is bogus\. expect trouble/gi;return n=n.replace(e,""),n.trim()}}function epe(n,e,t,r){typeof t=="function"&&(r=t,t=void 0);var i=!1,o=Xde(n,e,t),s="",a="";o.stdout.on("data",function(l){s+=l.toString()}),o.stderr.on("data",function(l){a+=l.toString()}),o.on("error",function(l){i||(i=!0,r(new Error(l)))}),o.on("close",function(l){if(!i){if(i=!0,a=Zde(a),a)return r(new Error(a));r(null,s,l)}})}q4.exports=epe});var G4=F((mXe,H4)=>{"use strict";var tpe=require("os"),rpe=gF();function npe(n){var e=["-A","-o","ppid,pid"];rpe("ps",e,function(t,r,i){if(t)return n(t);if(i!==0)return n(new Error("pidtree ps command exited with code "+i));try{r=r.split(tpe.EOL);for(var o=[],s=1;s<r.length;s++)r[s]=r[s].trim(),r[s]&&(r[s]=r[s].split(/\s+/),r[s][0]=parseInt(r[s][0],10),r[s][1]=parseInt(r[s][1],10),o.push(r[s]));n(null,o)}catch(a){n(a)}})}H4.exports=npe});var Q4=F((fXe,z4)=>{"use strict";var ipe=require("os"),ope=gF();function spe(n){var e=["PROCESS","get","ParentProcessId,ProcessId"],t={windowsHide:!0,windowsVerbatimArguments:!0};ope("wmic",e,t,function(r,i,o){if(r){n(r);return}if(o!==0){n(new Error("pidtree wmic command exited with code "+o));return}try{i=i.split(ipe.EOL);for(var s=[],a=1;a<i.length;a++)i[a]=i[a].trim(),i[a]&&(i[a]=i[a].split(/\s+/),i[a][0]=parseInt(i[a][0],10),i[a][1]=parseInt(i[a][1],10),s.push(i[a]));n(null,s)}catch(l){n(l)}})}z4.exports=spe});var eG=F((hXe,Z4)=>{"use strict";var X4=require("os"),ape={darwin:"ps",sunos:"ps",freebsd:"ps",netbsd:"ps",win:"wmic",linux:"ps",aix:"ps"},lpe={ps:()=>G4(),wmic:()=>Q4()},vF=X4.platform();vF.startsWith("win")&&(vF="win");var Y4=ape[vF];function cpe(n){Y4===void 0&&n(new Error(X4.platform()+" is not supported yet, please open an issue (https://github.com/simonepri/pidtree)"));var e=lpe[Y4]();e(n)}Z4.exports=cpe});var rG=F((gXe,tG)=>{"use strict";var upe=eG();function dpe(n,e,t){if(typeof e=="function"&&(t=e,e={}),typeof e!="object"&&(e={}),n=parseInt(n,10),isNaN(n)||n<-1){t(new TypeError("The pid provided is invalid"));return}upe(function(r,i){if(r){t(r);return}if(n===-1){for(var o=0;o<i.length;o++)i[o]=e.advanced?{ppid:i[o][0],pid:i[o][1]}:i[o]=i[o][1];t(null,i);return}for(var s,a=0;a<i.length;a++){if(i[a][1]===n){s=e.advanced?{ppid:i[a][0],pid:n}:n;break}i[a][0]===n&&(s=e.advanced?{pid:n}:n)}if(!s){t(new Error("No matching pid found"));return}for(var l={};i.length>0;){var c=i.pop();l[c[0]]?l[c[0]].push(c[1]):l[c[0]]=[c[1]]}for(var u=0,d=[s];u<d.length;){var f=e.advanced?d[u++].pid:d[u++];if(l[f]){for(var g=l[f].length,b=0;b<g;b++)d.push(e.advanced?{ppid:f,pid:l[f][b]}:l[f][b]);delete l[f]}}e.root||d.shift(),t(null,d)})}tG.exports=dpe});var oG=F((vXe,iG)=>{"use strict";function ppe(n,e,t){return new Promise(function(r,i){n(e,t,function(o,s){if(o)return i(o);r(s)})})}String.prototype.startsWith||(String.prototype.startsWith=function(n){return this.substring(0,n.length)===n});var nG=rG();function mpe(n,e,t){if(typeof e=="function"&&(t=e,e=void 0),typeof t=="function"){nG(n,e,t);return}return ppe(nG,n,e)}iG.exports=mpe});var mG=F((yXe,pG)=>{var sG=Array.prototype.slice,aG=typeof Object.keys=="function"?Object.keys:function(n){var e=[];for(var t in n)e.push(t);return e},lG=pG.exports=function(n,e){return n===0&&e===0?fpe(n,e):n===e?!0:n instanceof Date&&e instanceof Date?n.getTime()===e.getTime():dG(n)?dG(e):typeof n!="object"&&typeof e!="object"?n==e:hpe(n,e)};function cG(n){return n==null}function uG(n){return Object.prototype.toString.call(n)=="[object Arguments]"}function dG(n){return typeof n=="number"&&n!==n}function fpe(n,e){return 1/n===1/e}function hpe(n,e){if(cG(n)||cG(e)||n.prototype!==e.prototype)return!1;if(uG(n))return uG(e)?(n=sG.call(n),e=sG.call(e),lG(n,e)):!1;try{var t=aG(n),r=aG(e),i,o}catch{return!1}if(t.length!=r.length)return!1;for(t.sort(),r.sort(),o=t.length-1;o>=0;o--)if(t[o]!=r[o])return!1;for(o=t.length-1;o>=0;o--)if(i=t[o],!lG(n[i],e[i]))return!1;return!0}});var gG=F((bXe,hG)=>{"use strict";var fG="[a-fA-F\\d:]",Cp=n=>n&&n.includeBoundaries?`(?:(?<=\\s|^)(?=${fG})|(?<=${fG})(?=\\s|$))`:"",Fa="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",Tn="[a-fA-F\\d]{1,4}",wT=`
(?:
(?:${Tn}:){7}(?:${Tn}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${Tn}:){6}(?:${Fa}|:${Tn}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${Tn}:){5}(?::${Fa}|(?::${Tn}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${Tn}:){4}(?:(?::${Tn}){0,1}:${Fa}|(?::${Tn}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${Tn}:){3}(?:(?::${Tn}){0,2}:${Fa}|(?::${Tn}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${Tn}:){2}(?:(?::${Tn}){0,3}:${Fa}|(?::${Tn}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${Tn}:){1}(?:(?::${Tn}){0,4}:${Fa}|(?::${Tn}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${Tn}){0,5}:${Fa}|(?::${Tn}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),gpe=new RegExp(`(?:^${Fa}$)|(?:^${wT}$)`),vpe=new RegExp(`^${Fa}$`),ype=new RegExp(`^${wT}$`),yF=n=>n&&n.exact?gpe:new RegExp(`(?:${Cp(n)}${Fa}${Cp(n)})|(?:${Cp(n)}${wT}${Cp(n)})`,"g");yF.v4=n=>n&&n.exact?vpe:new RegExp(`${Cp(n)}${Fa}${Cp(n)}`,"g");yF.v6=n=>n&&n.exact?ype:new RegExp(`${Cp(n)}${wT}${Cp(n)}`,"g");hG.exports=yF});var vG=F((IXe,bpe)=>{bpe.exports={name:"is2",version:"2.0.7",description:"A type checking library where each exported function returns either true or false and does not throw. Also added tests.",license:"MIT",tags:["type","check","checker","checking","utilities","network","networking","credit","card","validation"],keywords:["type","check","checker","checking","utilities","network","networking","credit","card","validation"],author:"Enrico Marino <enrico.marino@email.com>",maintainers:"Edmond Meinfelder <edmond@stdarg.com>, Chris Oyler <christopher.oyler@gmail.com>",homepage:"http://github.com/stdarg/is2",repository:{type:"git",url:"git@github.com:stdarg/is2.git"},bugs:{url:"http://github.com/stdarg/is/issues"},main:"./index.js",scripts:{test:"./node_modules/.bin/mocha -C --reporter list tests.js"},engines:{node:">=v0.10.0"},dependencies:{"deep-is":"^0.1.3","ip-regex":"^4.1.0","is-url":"^1.2.4"},devDependencies:{mocha:"6.1.4",mongodb:"3.2.4"}}});var bG=F((SXe,yG)=>{yG.exports=Epe;var Ipe=/^(?:\w+:)?\/\/(\S+)$/,Spe=/^localhost[\:?\d]*(?:[^\:?\d]\S*)?$/,Cpe=/^[^\s\.]+\.\S{2,}$/;function Epe(n){if(typeof n!="string")return!1;var e=n.match(Ipe);if(!e)return!1;var t=e[1];return t?!!(Spe.test(t)||Cpe.test(t)):!1}});var CG=F(SG=>{"use strict";var IG={}.hasOwnProperty,Ir={}.toString,C=SG,wpe=mG(),Ppe=gG();C.version=vG().version;C.browser=function(){return!C.node()&&typeof window<"u"&&Ir.call(window)==="[object global]"};C.defined=function(n){return typeof n<"u"};C.def=C.defined;C.nodejs=function(){return process&&process.hasOwnProperty("version")&&process.hasOwnProperty("versions")};C.node=C.nodejs;C.undefined=function(n){return n===void 0};C.udef=C.undef=C.undefined;C.array=function(n){return Ir.call(n)==="[object Array]"};C.arr=C.ary=C.arry=C.array;C.arrayLike=function(n){return C.nullOrUndef(n)?!1:n!==void 0&&IG.call(n,"length")&&isFinite(n.length)};C.arrLike=C.arryLike=C.aryLike=C.arraylike=C.arrayLike;C.arguments=function(n){return Ir.call(n)==="[object Arguments]"};C.args=C.arguments;C.boolean=function(n){return Ir.call(n)==="[object Boolean]"};C.bool=C.boolean;C.buffer=function(n){return C.nodejs()&&Buffer&&Buffer.hasOwnProperty("isBuffer")&&Buffer.isBuffer(n)};C.buff=C.buf=C.buffer;C.date=function(n){return Ir.call(n)==="[object Date]"};C.error=function(n){return Ir.call(n)==="[object Error]"};C.err=C.error;C.false=function(n){return n===!1};C.function=function(n){return C.syncFunction(n)||C.asyncFunction(n)};C.fun=C.func=C.function;C.asyncFunction=function(n){return Ir.call(n)==="[object AsyncFunction]"};C.asyncFun=C.asyncFunc=C.asyncFunction;C.syncFunction=function(n){return Ir.call(n)==="[object Function]"};C.syncFun=C.syncFunc=C.syncFunction;C.null=function(n){return n===null};C.nullOrUndefined=function(n){return n===null||typeof n>"u"};C.nullOrUndef=C.nullOrUndefined;C.number=function(n){return Ir.call(n)==="[object Number]"};C.num=C.number;C.object=function(n){return Ir.call(n)==="[object Object]"};C.obj=C.object;C.regExp=function(n){return Ir.call(n)==="[object RegExp]"};C.re=C.regexp=C.regExp;C.string=function(n){return Ir.call(n)==="[object String]"};C.str=C.string;C.true=function(n){return n===!0};var kpe=new RegExp("[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}","i");C.uuid=function(n){return kpe.test(n)};C.equal=function(n,e){var t=Ir.call(n);return typeof n!=typeof e||t!==Ir.call(e)?!1:t==="[object Object]"||t==="[object Array]"?wpe(n,e):t==="[object Function]"?n.prototype===e.prototype:t==="[object Date]"?n.getTime()===e.getTime():n===e};C.objEquals=C.eq=C.equal;var xpe={boolean:1,number:1,string:1,undefined:1};C.hosted=function(n,e){if(C.nullOrUndef(n))return!1;var t=typeof e[n];return t==="object"?!!e[n]:!xpe[t]};C.instanceOf=function(n,e){return C.nullOrUndef(n)||C.nullOrUndef(e)?!1:n instanceof e};C.instOf=C.instanceof=C.instanceOf;C.objectInstanceOf=function(n,e){try{return Ir.call(n)==="[object Object]"&&n instanceof e}catch{return!1}};C.instOf=C.instanceOf=C.objInstOf=C.objectInstanceOf;C.type=function(n,e){return typeof n===e};C.a=C.type;C.empty=function(n){var e=Ir.call(n);if(e==="[object Array]"||e==="[object Arguments]")return n.length===0;if(e==="[object Object]"){for(var t in n)if(IG.call(n,t))return!1;return!0}return e==="[object String]"?n==="":!1};C.emptyArguments=function(n){return Ir.call(n)==="[object Arguments]"&&n.length===0};C.noArgs=C.emptyArgs=C.emptyArguments;C.emptyArray=function(n){return Ir.call(n)==="[object Array]"&&n.length===0};C.emptyArry=C.emptyAry=C.emptyArray;C.emptyArrayLike=function(n){return n.length===0};C.emptyArrLike=C.emptyArrayLike;C.emptyString=function(n){return C.string(n)&&n.length===0};C.emptyStr=C.emptyString;C.nonEmptyArray=function(n){return Ir.call(n)==="[object Array]"&&n.length>0};C.nonEmptyArr=C.nonEmptyArry=C.nonEmptyAry=C.nonEmptyArray;C.nonEmptyObject=function(n){return Ir.call(n)==="[object Object]"&&Object.keys(n).length>0};C.nonEmptyObj=C.nonEmptyObject;C.emptyObject=function(n){return Ir.call(n)==="[object Object]"&&Object.keys(n).length===0};C.emptyObj=C.emptyObject;C.nonEmptyString=function(n){return C.string(n)&&n.length>0};C.nonEmptyStr=C.nonEmptyString;C.even=function(n){return Ir.call(n)==="[object Number]"&&n%2===0};C.decimal=function(n){return Ir.call(n)==="[object Number]"&&n%1!==0};C.dec=C.decNum=C.decimal;C.integer=function(n){return Ir.call(n)==="[object Number]"&&n%1===0};C.int=C.integer;C.notANumber=function(n){return!C.num(n)||n!==n};C.nan=C.notANum=C.notANumber;C.odd=function(n){return!C.decimal(n)&&Ir.call(n)==="[object Number]"&&n%2!==0};C.oddNumber=C.oddNum=C.odd;C.positiveNumber=function(n){return Ir.call(n)==="[object Number]"&&n>0};C.pos=C.positive=C.posNum=C.positiveNum=C.positiveNumber;C.negativeNumber=function(n){return Ir.call(n)==="[object Number]"&&n<0};C.neg=C.negNum=C.negativeNum=C.negativeNumber;C.negativeInteger=function(n){return Ir.call(n)==="[object Number]"&&n%1===0&&n<0};C.negativeInt=C.negInt=C.negativeInteger;C.positiveInteger=function(n){return Ir.call(n)==="[object Number]"&&n%1===0&&n>0};C.posInt=C.positiveInt=C.positiveInteger;C.divisibleBy=function(n,e){return n===0?!1:Ir.call(n)==="[object Number]"&&e!==0&&n%e===0};C.divBy=C.divisBy=C.divisibleBy;C.greaterOrEqualTo=function(n,e){return n>=e};C.greaterOrEqual=C.ge=C.greaterOrEqualTo;C.greaterThan=function(n,e){return n>e};C.gt=C.greaterThan;C.lessThanOrEqualTo=function(n,e){return n<=e};C.lessThanOrEq=C.lessThanOrEqual=C.le=C.lessThanOrEqualTo;C.lessThan=function(n,e){return n<e};C.lt=C.lessThan;C.maximum=function(n,e){if(!C.arrayLike(e)||!C.number(n))return!1;for(var t=e.length;--t>-1;)if(n<e[t])return!1;return!0};C.max=C.maximum;C.minimum=function(n,e){if(!C.arrayLike(e)||!C.number(n))return!1;for(var t=e.length;--t>-1;)if(n>e[t])return!1;return!0};C.min=C.minimum;C.within=function(n,e,t){return n>=e&&n<=t};C.withIn=C.within;C.prettyClose=function(n,e,t){return!C.number(n)||!C.number(e)||C.defined(t)&&!C.posInt(t)?!1:(C.undefined(t)&&(t=2),n.toFixed(t)===e.toFixed(t))};C.closish=C.near=C.prettyClose;C.dnsAddress=function(n){return!(!C.nonEmptyStr(n)||n.length>255||_pe.test(n)||!Dpe.test(n))};C.dnsAddr=C.dns=C.dnsAddress;var Dpe=/^([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])(\.([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9]))*$/,_pe=/^([0-9]|[0-9][0-9\-]{0,61}[0-9])(\.([0-9]|[0-9][0-9\-]{0,61}[0-9]))*$/;C.emailAddress=function(n){return C.nonEmptyStr(n)?Tpe.test(n):!1};C.email=C.emailAddr=C.emailAddress;var Tpe=/^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*$/;C.ipv4Address=function(n){if(!C.nonEmptyStr(n)||n.length>15)return!1;var e=n.split(".");if(!C.array(e)||e.length!==4)return!1;for(var t=0;t<e.length;t++){var r=parseInt(e[t],10);if(isNaN(r)||r<0||r>255)return!1}return!0};C.ipv4=C.ipv4Addr=C.ipv4Address;C.ipv6Address=function(n){return C.nonEmptyStr(n)?Ppe.v6({extract:!0}).test(n):!1};C.ipv6=C.ipv6Addr=C.ipv6Address;C.ipAddress=function(n){return C.nonEmptyStr(n)?C.ipv4Address(n)||C.ipv6Address(n):!1};C.ip=C.ipAddr=C.ipAddress;C.hostAddress=function(n){return C.nonEmptyStr(n)?C.dns(n)||C.ipv4(n)||C.ipv6(n):!1};C.host=C.hostIp=C.hostAddr=C.hostAddress;C.port=function(n){return!(!C.num(n)||C.negativeInt(n)||n>65535)};C.systemPort=function(n){return!!(C.port(n)&&n<1024)};C.sysPort=C.systemPort;C.userPort=function(n){return!!(C.port(n)&&n>1023)};C.creditCardNumber=function(n){if(!C.str(n))return!1;var e=n.split(""),t,r;for(t=e.length-1,r=1;t>-1;t--,r++)r%2===0&&(e[t]*=2);n=e.join("");var i=0;for(t=0;t<n.length;t++)i+=Math.floor(n[t]);return i%10===0};C.creditCard=C.creditCardNum=C.creditCardNumber;C.americanExpressCardNumber=function(n){if(!C.str(n)||n.length!==15)return!1;var e=Math.floor(n.slice(0,2));return!(e!==34&&e!==37||!C.creditCardNumber(n))};C.amexCard=C.amexCardNum=C.americanExpressCardNumber;C.chinaUnionPayCardNumber=function(n){if(!C.str(n)||n.length<16&&n.length>19)return!1;var e=Math.floor(n.slice(0,2));return!(e!==62&&e!==88)};C.chinaUnion=C.chinaUnionPayCard=C.chinaUnionPayCardNumber;C.dinersClubCarteBlancheCardNumber=function(n){if(!C.str(n)||n.length!==14)return!1;var e=Math.floor(n.slice(0,3));return!(e<300||e>305||!C.creditCardNumber(n))};C.dinersClubCB=C.dinersClubCarteBlancheCard=C.dinersClubCarteBlancheCardNumber;C.dinersClubInternationalCardNumber=function(n){if(!C.str(n)||n.length!==14)return!1;var e=Math.floor(n.slice(0,3)),t=Math.floor(n.slice(0,2));return!((e<300||e>305)&&e!==309&&t!==36&&(t<38||t>39)||!C.creditCardNumber(n))};C.dinersClubInt=C.dinersClubInternationalCard=C.dinersClubInternationalCardNumber;C.dinersClubUSACanadaCardNumber=function(n){if(!C.str(n)||n.length!==16)return!1;var e=Math.floor(n.slice(0,2));return!(e!==54&&e!==55||!C.creditCardNumber(n))};C.dinersClub=C.dinersClubUSACanCard=C.dinersClubUSACanadaCardNumber;C.discoverCardNumber=function(n){if(!C.str(n)||n.length!==16)return!1;var e=Math.floor(n.slice(0,6)),t=Math.floor(n.slice(0,3));return!(n.slice(0,4)!=="6011"&&(e<622126||e>622925)&&(t<644||t>649)&&n.slice(0,2)!=="65"||!C.creditCardNumber(n))};C.discover=C.discoverCard=C.discoverCardNumber;C.instaPaymentCardNumber=function(n){if(!C.str(n)||n.length!==16)return!1;var e=Math.floor(n.slice(0,3));return!(e<637||e>639||!C.creditCardNumber(n))};C.instaPayment=C.instaPaymentCardNumber;C.jcbCardNumber=function(n){if(!C.str(n)||n.length!==16)return!1;var e=Math.floor(n.slice(0,4));return!(e<3528||e>3589||!C.creditCardNumber(n))};C.jcb=C.jcbCard=C.jcbCardNumber;C.laserCardNumber=function(n){if(!C.str(n)||n.length<16&&n.length>19)return!1;var e=Math.floor(n.slice(0,4)),t=[6304,6706,6771,6709];return!(t.indexOf(e)===-1||!C.creditCardNumber(n))};C.laser=C.laserCard=C.laserCardNumber;C.maestroCardNumber=function(n){if(!C.str(n)||n.length<12||n.length>19)return!1;var e=n.slice(0,4),t=["5018","5020","5038","5612","5893","6304","6759","6761","6762","6763","0604","6390"];return!(t.indexOf(e)===-1||!C.creditCardNumber(n))};C.maestro=C.maestroCard=C.maestroCardNumber;C.dankortCardNumber=function(n){return!(!C.str(n)||n.length!==16||n.slice(0,4)!=="5019"||!C.creditCardNumber(n))};C.dankort=C.dankortCard=C.dankortCardNumber;C.masterCardCardNumber=function(n){if(!C.str(n)||n.length!==16)return!1;var e=Math.floor(n.slice(0,2));return!(e<50||e>55||!C.creditCardNumber(n))};C.masterCard=C.masterCardCard=C.masterCardCardNumber;C.visaCardNumber=function(n){return!(!C.str(n)||n.length!==13&&n.length!==16||n.slice(0,1)!=="4"||!C.creditCardNumber(n))};C.visa=C.visaCard=C.visaCardNumber;C.visaElectronCardNumber=function(n){if(!C.str(n)||n.length!==16)return!1;var e=Math.floor(n.slice(0,4)),t=[4026,4405,4508,4844,4913,4917];return n.slice(0,6)!=="417500"&&t.indexOf(e)===-1||!C.creditCardNumber(n),!1};C.visaElectron=C.visaElectronCard=C.visaElectronCardNumber;var Rpe=/^[0-9a-fA-F]{24}$/;C.mongoId=C.objectId=C.objId=function(n){return!!n&&!Array.isArray(n)&&Rpe.test(String(n))};C.matching=C.match=C.inArgs=function(n){if(arguments.length<2)return!1;for(var e=!1,t=1;t<arguments.length;t++){var r=C.equal(n,arguments[t]);e=e||r}return e};C.streetAddress=function(n){if(!C.str(n))return!1;var e=/\b\d+[\s](?:[A-Za-z0-9.-]+[\s]+)+\b(ALLEY|ALY|AVENUE|AVE|BEND|BND|BLUFFS?|BLFS?|BOULEVARD|BLVD|BRANCH|BR|CENTERS?|CTRS?|CIRCLES?|CIRS?|CLIFFS?|CLFS?|COURTS?|CTS?|COVES?|CVS?|CREEK|CRK|CRESCENT|CRES|CREST|CRST|CROSSING|XING|DRIVES?|DRS?|EXPRESSWAY|EXPY|FREEWAY|FWY|HEIGHTS|HTS|HIGHWAY|HWY|HILLS?|HLS?|LANE|LN|LOOP|MANORS?|MNRS?|MOTORWAY|MTWY|MOUNT|MT|PARKS?|PARKWAYS?|PKWY|PASS|PLACE|PL|PLAZA|PLZ|POINTS?|PTS?|RIDGES?|RDGS?|ROADS?|RDS?|ROUTE|RTE?|SHOALS?|SHLS?|SHORES?|SHRS?|SPRINGS?|SPGS?|SPURS?|STREETS?|STS?|SUMMIT|SMT|TERRACE|TER|THROUGHWAY|TRWY|TRAFFICWAY|TRFY|TRAIL|TRL|TURNPIKE|TPKE|VALLEYS?|VLYS?|WAYS?)+(?:[\.\-\s\,]?)*((APARTMENT|APT|APPT|#|NUMBER|NUM|FLOOR|FL|\s)?(\d)*)\b/ig;return e.test(n)};C.street=C.address=C.streetAddress;C.zipCode=function(n){if(C.undefined(n)||!(C.string(n)||C.number(n)))return!1;var e=/^\d{5}(?:-\d{4})?$/;return e.test(n)};C.zip=C.zipCode;C.phoneNumber=function(n){if(!C.string(n))return!1;var e=/(?:(?:\+?1\s*(?:[.-]\s*)?)?(?:(\(?)(?:(\s*([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9]‌​)\s*)|([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9]))\)?)\s*(?:[.-]\s*)?)?([2-9]1[02-‌​9]|[2-9][02-9]1|[2-9][02-9]{2})\s*(?:[.-]\s*)?([0-9]{4})/g;return e.test(n)};C.phone=C.phoneNumber;var Ape=bG();C.url=function(n){return Ape(n)};C.uri=C.url;C.enumerator=function(n,e){var t=!1;if(!C.defined(n)||!C.defined(e)||!C.arrayLike(e))return t;for(var r=0,i=e.length;r<i;r++)if(C.equal(n,e[r])){t=!0;break}return t};C.enum=C.inArray=C.enumerator});var bF=F((EXe,EG)=>{var ab=1e3,lb=ab*60,cb=lb*60,Pf=cb*24,Npe=Pf*7,Mpe=Pf*365.25;EG.exports=function(n,e){e=e||{};var t=typeof n;if(t==="string"&&n.length>0)return Kpe(n);if(t==="number"&&isFinite(n))return e.long?Fpe(n):Ope(n);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(n))};function Kpe(n){if(n=String(n),!(n.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(n);if(e){var t=parseFloat(e[1]),r=(e[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return t*Mpe;case"weeks":case"week":case"w":return t*Npe;case"days":case"day":case"d":return t*Pf;case"hours":case"hour":case"hrs":case"hr":case"h":return t*cb;case"minutes":case"minute":case"mins":case"min":case"m":return t*lb;case"seconds":case"second":case"secs":case"sec":case"s":return t*ab;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function Ope(n){var e=Math.abs(n);return e>=Pf?Math.round(n/Pf)+"d":e>=cb?Math.round(n/cb)+"h":e>=lb?Math.round(n/lb)+"m":e>=ab?Math.round(n/ab)+"s":n+"ms"}function Fpe(n){var e=Math.abs(n);return e>=Pf?PT(n,e,Pf,"day"):e>=cb?PT(n,e,cb,"hour"):e>=lb?PT(n,e,lb,"minute"):e>=ab?PT(n,e,ab,"second"):n+" ms"}function PT(n,e,t,r){var i=e>=t*1.5;return Math.round(n/t)+" "+r+(i?"s":"")}});var IF=F((wXe,wG)=>{function Lpe(n){t.debug=t,t.default=t,t.coerce=l,t.disable=o,t.enable=i,t.enabled=s,t.humanize=bF(),t.destroy=c,Object.keys(n).forEach(u=>{t[u]=n[u]}),t.names=[],t.skips=[],t.formatters={};function e(u){let d=0;for(let f=0;f<u.length;f++)d=(d<<5)-d+u.charCodeAt(f),d|=0;return t.colors[Math.abs(d)%t.colors.length]}t.selectColor=e;function t(u){let d,f=null;function g(...b){if(!g.enabled)return;let I=g,w=Number(new Date),_=w-(d||w);I.diff=_,I.prev=d,I.curr=w,d=w,b[0]=t.coerce(b[0]),typeof b[0]!="string"&&b.unshift("%O");let A=0;b[0]=b[0].replace(/%([a-zA-Z%])/g,(V,ie)=>{if(V==="%%")return"%";A++;let Q=t.formatters[ie];if(typeof Q=="function"){let te=b[A];V=Q.call(I,te),b.splice(A,1),A--}return V}),t.formatArgs.call(I,b),(I.log||t.log).apply(I,b)}return g.namespace=u,g.useColors=t.useColors(),g.color=t.selectColor(u),g.extend=r,g.destroy=t.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>f===null?t.enabled(u):f,set:b=>{f=b}}),typeof t.init=="function"&&t.init(g),g}function r(u,d){let f=t(this.namespace+(typeof d>"u"?":":d)+u);return f.log=this.log,f}function i(u){t.save(u),t.names=[],t.skips=[];let d,f=(typeof u=="string"?u:"").split(/[\s,]+/),g=f.length;for(d=0;d<g;d++)f[d]&&(u=f[d].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.substr(1)+"$")):t.names.push(new RegExp("^"+u+"$")))}function o(){let u=[...t.names.map(a),...t.skips.map(a).map(d=>"-"+d)].join(",");return t.enable(""),u}function s(u){if(u[u.length-1]==="*")return!0;let d,f;for(d=0,f=t.skips.length;d<f;d++)if(t.skips[d].test(u))return!1;for(d=0,f=t.names.length;d<f;d++)if(t.names[d].test(u))return!0;return!1}function a(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function l(u){return u instanceof Error?u.stack||u.message:u}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}wG.exports=Lpe});var PG=F((ls,kT)=>{ls.formatArgs=Wpe;ls.save=Vpe;ls.load=jpe;ls.useColors=Upe;ls.storage=Bpe();ls.destroy=(()=>{let n=!1;return()=>{n||(n=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();ls.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Upe(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Wpe(n){if(n[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+n[0]+(this.useColors?"%c ":" ")+"+"+kT.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;n.splice(1,0,e,"color: inherit");let t=0,r=0;n[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(r=t))}),n.splice(r,0,e)}ls.log=console.debug||console.log||(()=>{});function Vpe(n){try{n?ls.storage.setItem("debug",n):ls.storage.removeItem("debug")}catch{}}function jpe(){let n;try{n=ls.storage.getItem("debug")}catch{}return!n&&typeof process<"u"&&"env"in process&&(n=process.env.DEBUG),n}function Bpe(){try{return localStorage}catch{}}kT.exports=IF()(ls);var{formatters:$pe}=kT.exports;$pe.j=function(n){try{return JSON.stringify(n)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var xG=F((PXe,kG)=>{"use strict";kG.exports=(n,e)=>{e=e||process.argv;let t=n.startsWith("-")?"":n.length===1?"-":"--",r=e.indexOf(t+n),i=e.indexOf("--");return r!==-1&&(i===-1?!0:r<i)}});var CF=F((kXe,DG)=>{"use strict";var Jpe=require("os"),La=xG(),Bi=process.env,ub;La("no-color")||La("no-colors")||La("color=false")?ub=!1:(La("color")||La("colors")||La("color=true")||La("color=always"))&&(ub=!0);"FORCE_COLOR"in Bi&&(ub=Bi.FORCE_COLOR.length===0||parseInt(Bi.FORCE_COLOR,10)!==0);function qpe(n){return n===0?!1:{level:n,hasBasic:!0,has256:n>=2,has16m:n>=3}}function Hpe(n){if(ub===!1)return 0;if(La("color=16m")||La("color=full")||La("color=truecolor"))return 3;if(La("color=256"))return 2;if(n&&!n.isTTY&&ub!==!0)return 0;let e=ub?1:0;if(process.platform==="win32"){let t=Jpe.release().split(".");return Number(process.versions.node.split(".")[0])>=8&&Number(t[0])>=10&&Number(t[2])>=10586?Number(t[2])>=14931?3:2:1}if("CI"in Bi)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some(t=>t in Bi)||Bi.CI_NAME==="codeship"?1:e;if("TEAMCITY_VERSION"in Bi)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(Bi.TEAMCITY_VERSION)?1:0;if(Bi.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in Bi){let t=parseInt((Bi.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(Bi.TERM_PROGRAM){case"iTerm.app":return t>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(Bi.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(Bi.TERM)||"COLORTERM"in Bi?1:(Bi.TERM==="dumb",e)}function SF(n){let e=Hpe(n);return qpe(e)}DG.exports={supportsColor:SF,stdout:SF(process.stdout),stderr:SF(process.stderr)}});var TG=F((Si,DT)=>{var Gpe=require("tty"),xT=require("util");Si.init=tme;Si.log=Xpe;Si.formatArgs=Qpe;Si.save=Zpe;Si.load=eme;Si.useColors=zpe;Si.destroy=xT.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");Si.colors=[6,2,3,4,5,1];try{let n=CF();n&&(n.stderr||n).level>=2&&(Si.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}Si.inspectOpts=Object.keys(process.env).filter(n=>/^debug_/i.test(n)).reduce((n,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(i,o)=>o.toUpperCase()),r=process.env[e];return/^(yes|on|true|enabled)$/i.test(r)?r=!0:/^(no|off|false|disabled)$/i.test(r)?r=!1:r==="null"?r=null:r=Number(r),n[t]=r,n},{});function zpe(){return"colors"in Si.inspectOpts?!!Si.inspectOpts.colors:Gpe.isatty(process.stderr.fd)}function Qpe(n){let{namespace:e,useColors:t}=this;if(t){let r=this.color,i="\x1B[3"+(r<8?r:"8;5;"+r),o=`  ${i};1m${e} \x1B[0m`;n[0]=o+n[0].split(`
`).join(`
`+o),n.push(i+"m+"+DT.exports.humanize(this.diff)+"\x1B[0m")}else n[0]=Ype()+e+" "+n[0]}function Ype(){return Si.inspectOpts.hideDate?"":new Date().toISOString()+" "}function Xpe(...n){return process.stderr.write(xT.format(...n)+`
`)}function Zpe(n){n?process.env.DEBUG=n:delete process.env.DEBUG}function eme(){return process.env.DEBUG}function tme(n){n.inspectOpts={};let e=Object.keys(Si.inspectOpts);for(let t=0;t<e.length;t++)n.inspectOpts[e[t]]=Si.inspectOpts[e[t]]}DT.exports=IF()(Si);var{formatters:_G}=DT.exports;_G.o=function(n){return this.inspectOpts.colors=this.useColors,xT.inspect(n,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};_G.O=function(n){return this.inspectOpts.colors=this.useColors,xT.inspect(n,this.inspectOpts)}});var RG=F((xXe,EF)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?EF.exports=PG():EF.exports=TG()});var wF=F(kf=>{"use strict";kf.check=OG;kf.waitUntilFreeOnHost=nme;kf.waitUntilFree=ime;kf.waitUntilUsedOnHost=FG;kf.waitUntilUsed=ome;kf.waitForStatus=TT;var Ua=CG(),rme=require("net"),AG=require("util"),_T=RG()("tcp-port-used"),NG=2e3,MG=250;function KG(){var n,e,t=new Promise(function(r,i){n=r,e=i});return{resolve:n,reject:e,promise:t}}function db(n,e,t,r,i){var o={};return o.port=n,o.host=e,o.inUse=t,o.retryTimeMs=r,o.timeOutMs=i,o}function OG(n,e){var t=KG(),r=!0,i,o;if(Ua.obj(n)?o=n:o=db(n,e),!Ua.port(o.port))return _T("Error invalid port: "+AG.inspect(o.port)),t.reject(new Error("invalid port: "+AG.inspect(o.port))),t.promise;Ua.nullOrUndefined(o.host)&&(_T("set host address to default 127.0.0.1"),o.host="127.0.0.1");function s(){i&&(i.removeAllListeners("connect"),i.removeAllListeners("error"),i.end(),i.destroy(),i.unref())}function a(){t.resolve(r),s()}function l(c){c.code!=="ECONNREFUSED"?t.reject(c):(r=!1,t.resolve(r)),s()}return i=new rme.Socket,i.once("connect",a),i.once("error",l),i.connect({port:o.port,host:o.host},function(){}),t.promise}function TT(n,e,t,r,i){var o=KG(),s,a=!1,l,c;if(Ua.obj(n)?c=n:c=db(n,e,t,r,i),!Ua.bool(c.inUse))return o.reject(new Error("inUse must be a boolean")),o.promise;Ua.positiveInt(c.retryTimeMs)||(c.retryTimeMs=MG,_T("set retryTime to default "+MG+"ms")),Ua.positiveInt(c.timeOutMs)||(c.timeOutMs=NG,_T("set timeOutMs to default "+NG+"ms"));function u(){s&&clearTimeout(s),l&&clearTimeout(l)}function d(){a=!0,u(),o.reject(new Error("timeout"))}s=setTimeout(d,c.timeOutMs);function f(){OG(c.port,c.host).then(function(g){if(!a)if(g===c.inUse){o.resolve(),u();return}else{l=setTimeout(function(){f()},c.retryTimeMs);return}},function(g){a||(o.reject(g),u())})}return f(),o.promise}function nme(n,e,t,r){var i;return Ua.obj(n)?(i=n,i.inUse=!1):i=db(n,e,!1,t,r),TT(i)}function ime(n,e,t){var r;return Ua.obj(n)?(r=n,r.host="127.0.0.1",r.inUse=!1):r=db(n,"127.0.0.1",!1,e,t),TT(r)}function FG(n,e,t,r){var i;return Ua.obj(n)?(i=n,i.inUse=!0):i=db(n,e,!0,t,r),TT(i)}function ome(n,e,t){var r;return Ua.obj(n)?(r=n,r.host="127.0.0.1",r.inUse=!0):r=db(n,"127.0.0.1",!0,e,t),FG(r)}});var BG=F((AT,lc)=>{(function(n,e){typeof AT=="object"&&typeof lc<"u"?e(AT):typeof define=="function"&&define.amd?define(["exports"],e):e(n.async=n.async||{})})(AT,function(n){"use strict";function e(S,P){P=P|0;for(var D=Math.max(S.length-P,0),O=Array(D),H=0;H<D;H++)O[H]=S[P+H];return O}var t=function(S){var P=e(arguments,1);return function(){var D=e(arguments);return S.apply(null,P.concat(D))}},r=function(S){return function(){var P=e(arguments),D=P.pop();S.call(this,P,D)}};function i(S){var P=typeof S;return S!=null&&(P=="object"||P=="function")}var o=typeof setImmediate=="function"&&setImmediate,s=typeof process=="object"&&typeof process.nextTick=="function";function a(S){setTimeout(S,0)}function l(S){return function(P){var D=e(arguments,1);S(function(){P.apply(null,D)})}}var c;o?c=setImmediate:s?c=process.nextTick:c=a;var u=l(c);function d(S){return r(function(P,D){var O;try{O=S.apply(this,P)}catch(H){return D(H)}i(O)&&typeof O.then=="function"?O.then(function(H){f(D,null,H)},function(H){f(D,H.message?H:new Error(H))}):D(null,O)})}function f(S,P,D){try{S(P,D)}catch(O){u(g,O)}}function g(S){throw S}var b=typeof Symbol=="function";function I(S){return b&&S[Symbol.toStringTag]==="AsyncFunction"}function w(S){return I(S)?d(S):S}function _(S){return function(P){var D=e(arguments,1),O=r(function(H,q){var re=this;return S(P,function(le,we){w(le).apply(re,H.concat(we))},q)});return D.length?O.apply(this,D):O}}var A=typeof global=="object"&&global&&global.Object===Object&&global,R=typeof self=="object"&&self&&self.Object===Object&&self,V=A||R||Function("return this")(),ie=V.Symbol,Q=Object.prototype,te=Q.hasOwnProperty,ae=Q.toString,Y=ie?ie.toStringTag:void 0;function be(S){var P=te.call(S,Y),D=S[Y];try{S[Y]=void 0;var O=!0}catch{}var H=ae.call(S);return O&&(P?S[Y]=D:delete S[Y]),H}var Fe=Object.prototype,ft=Fe.toString;function ht(S){return ft.call(S)}var xt="[object Null]",ee="[object Undefined]",ke=ie?ie.toStringTag:void 0;function Te(S){return S==null?S===void 0?ee:xt:ke&&ke in Object(S)?be(S):ht(S)}var ve="[object AsyncFunction]",vt="[object Function]",qi="[object GeneratorFunction]",dr="[object Proxy]";function Pi(S){if(!i(S))return!1;var P=Te(S);return P==vt||P==qi||P==ve||P==dr}var ed=9007199254740991;function Br(S){return typeof S=="number"&&S>-1&&S%1==0&&S<=ed}function aa(S){return S!=null&&Br(S.length)&&!Pi(S)}var tl={};function Kt(){}function Hi(S){return function(){if(S!==null){var P=S;S=null,P.apply(this,arguments)}}}var ai=typeof Symbol=="function"&&Symbol.iterator,Ac=function(S){return ai&&S[ai]&&S[ai]()};function L(S,P){for(var D=-1,O=Array(S);++D<S;)O[D]=P(D);return O}function W(S){return S!=null&&typeof S=="object"}var fe="[object Arguments]";function Re(S){return W(S)&&Te(S)==fe}var ze=Object.prototype,tn=ze.hasOwnProperty,jt=ze.propertyIsEnumerable,Ot=Re(function(){return arguments}())?Re:function(S){return W(S)&&tn.call(S,"callee")&&!jt.call(S,"callee")},_t=Array.isArray;function kr(){return!1}var $r=typeof n=="object"&&n&&!n.nodeType&&n,Tr=$r&&typeof lc=="object"&&lc&&!lc.nodeType&&lc,rn=Tr&&Tr.exports===$r,$=rn?V.Buffer:void 0,X=$?$.isBuffer:void 0,pe=X||kr,Ie=9007199254740991,Je=/^(?:0|[1-9]\d*)$/;function nn(S,P){var D=typeof S;return P=P??Ie,!!P&&(D=="number"||D!="symbol"&&Je.test(S))&&S>-1&&S%1==0&&S<P}var bt="[object Arguments]",kt="[object Array]",Qe="[object Boolean]",At="[object Date]",Z="[object Error]",ue="[object Function]",j="[object Map]",B="[object Number]",z="[object Object]",Ee="[object RegExp]",Ne="[object Set]",se="[object String]",Gi="[object WeakMap]",td="[object ArrayBuffer]",OL="[object DataView]",FL="[object Float32Array]",LL="[object Float64Array]",UL="[object Int8Array]",WL="[object Int16Array]",VL="[object Int32Array]",jL="[object Uint8Array]",BL="[object Uint8ClampedArray]",$L="[object Uint16Array]",JL="[object Uint32Array]",Fr={};Fr[FL]=Fr[LL]=Fr[UL]=Fr[WL]=Fr[VL]=Fr[jL]=Fr[BL]=Fr[$L]=Fr[JL]=!0,Fr[bt]=Fr[kt]=Fr[td]=Fr[Qe]=Fr[OL]=Fr[At]=Fr[Z]=Fr[ue]=Fr[j]=Fr[B]=Fr[z]=Fr[Ee]=Fr[Ne]=Fr[se]=Fr[Gi]=!1;function qL(S){return W(S)&&Br(S.length)&&!!Fr[Te(S)]}function HL(S){return function(P){return S(P)}}var ER=typeof n=="object"&&n&&!n.nodeType&&n,gh=ER&&typeof lc=="object"&&lc&&!lc.nodeType&&lc,GL=gh&&gh.exports===ER,aP=GL&&A.process,wR=function(){try{var S=gh&&gh.require&&gh.require("util").types;return S||aP&&aP.binding&&aP.binding("util")}catch{}}(),PR=wR&&wR.isTypedArray,zL=PR?HL(PR):qL,QL=Object.prototype,YL=QL.hasOwnProperty;function XL(S,P){var D=_t(S),O=!D&&Ot(S),H=!D&&!O&&pe(S),q=!D&&!O&&!H&&zL(S),re=D||O||H||q,le=re?L(S.length,String):[],we=le.length;for(var Ge in S)(P||YL.call(S,Ge))&&!(re&&(Ge=="length"||H&&(Ge=="offset"||Ge=="parent")||q&&(Ge=="buffer"||Ge=="byteLength"||Ge=="byteOffset")||nn(Ge,we)))&&le.push(Ge);return le}var ZL=Object.prototype;function eU(S){var P=S&&S.constructor,D=typeof P=="function"&&P.prototype||ZL;return S===D}function tU(S,P){return function(D){return S(P(D))}}var rU=tU(Object.keys,Object),nU=Object.prototype,iU=nU.hasOwnProperty;function oU(S){if(!eU(S))return rU(S);var P=[];for(var D in Object(S))iU.call(S,D)&&D!="constructor"&&P.push(D);return P}function lP(S){return aa(S)?XL(S):oU(S)}function sU(S){var P=-1,D=S.length;return function(){return++P<D?{value:S[P],key:P}:null}}function aU(S){var P=-1;return function(){var O=S.next();return O.done?null:(P++,{value:O.value,key:P})}}function lU(S){var P=lP(S),D=-1,O=P.length;return function H(){var q=P[++D];return q==="__proto__"?H():D<O?{value:S[q],key:q}:null}}function cU(S){if(aa(S))return sU(S);var P=Ac(S);return P?aU(P):lU(S)}function la(S){return function(){if(S===null)throw new Error("Callback was already called.");var P=S;S=null,P.apply(this,arguments)}}function MS(S){return function(P,D,O){if(O=Hi(O||Kt),S<=0||!P)return O(null);var H=cU(P),q=!1,re=0,le=!1;function we(xe,yt){if(re-=1,xe)q=!0,O(xe);else{if(yt===tl||q&&re<=0)return q=!0,O(null);le||Ge()}}function Ge(){for(le=!0;re<S&&!q;){var xe=H();if(xe===null){q=!0,re<=0&&O(null);return}re+=1,D(xe.value,xe.key,la(we))}le=!1}Ge()}}function rd(S,P,D,O){MS(P)(S,w(D),O)}function $n(S,P){return function(D,O,H){return S(D,P,O,H)}}function uU(S,P,D){D=Hi(D||Kt);var O=0,H=0,q=S.length;q===0&&D(null);function re(le,we){le?D(le):(++H===q||we===tl)&&D(null)}for(;O<q;O++)P(S[O],O,la(re))}var dU=$n(rd,1/0),Nc=function(S,P,D){var O=aa(S)?uU:dU;O(S,w(P),D)};function om(S){return function(P,D,O){return S(Nc,P,w(D),O)}}function kR(S,P,D,O){O=O||Kt,P=P||[];var H=[],q=0,re=w(D);S(P,function(le,we,Ge){var xe=q++;re(le,function(yt,Jr){H[xe]=Jr,Ge(yt)})},function(le){O(le,H)})}var KS=om(kR),xR=_(KS);function sm(S){return function(P,D,O,H){return S(MS(D),P,w(O),H)}}var am=sm(kR),cP=$n(am,1),DR=_(cP);function OS(S,P){for(var D=-1,O=S==null?0:S.length;++D<O&&P(S[D],D,S)!==!1;);return S}function pU(S){return function(P,D,O){for(var H=-1,q=Object(P),re=O(P),le=re.length;le--;){var we=re[S?le:++H];if(D(q[we],we,q)===!1)break}return P}}var mU=pU();function vh(S,P){return S&&mU(S,P,lP)}function fU(S,P,D,O){for(var H=S.length,q=D+(O?1:-1);O?q--:++q<H;)if(P(S[q],q,S))return q;return-1}function hU(S){return S!==S}function gU(S,P,D){for(var O=D-1,H=S.length;++O<H;)if(S[O]===P)return O;return-1}function FS(S,P,D){return P===P?gU(S,P,D):fU(S,hU,D)}var uP=function(S,P,D){typeof P=="function"&&(D=P,P=null),D=Hi(D||Kt);var O=lP(S),H=O.length;if(!H)return D(null);P||(P=H);var q={},re=0,le=!1,we=Object.create(null),Ge=[],xe=[],yt={};vh(S,function(Qr,on){if(!_t(Qr)){Jr(on,[Qr]),xe.push(on);return}var Jn=Qr.slice(0,Qr.length-1),Kc=Jn.length;if(Kc===0){Jr(on,Qr),xe.push(on);return}yt[on]=Kc,OS(Jn,function(Ph){if(!S[Ph])throw new Error("async.auto task `"+on+"` has a non-existent dependency `"+Ph+"` in "+Jn.join(", "));rl(Ph,function(){Kc--,Kc===0&&Jr(on,Qr)})})}),BX(),ki();function Jr(Qr,on){Ge.push(function(){nl(Qr,on)})}function ki(){if(Ge.length===0&&re===0)return D(null,q);for(;Ge.length&&re<P;){var Qr=Ge.shift();Qr()}}function rl(Qr,on){var Jn=we[Qr];Jn||(Jn=we[Qr]=[]),Jn.push(on)}function ys(Qr){var on=we[Qr]||[];OS(on,function(Jn){Jn()}),ki()}function nl(Qr,on){if(!le){var Jn=la(function(Ph,wA){if(re--,arguments.length>2&&(wA=e(arguments,1)),Ph){var PA={};vh(q,function(JX,qX){PA[qX]=JX}),PA[Qr]=wA,le=!0,we=Object.create(null),D(Ph,PA)}else q[Qr]=wA,ys(Qr)});re++;var Kc=w(on[on.length-1]);on.length>1?Kc(q,Jn):Kc(Jn)}}function BX(){for(var Qr,on=0;xe.length;)Qr=xe.pop(),on++,OS($X(Qr),function(Jn){--yt[Jn]===0&&xe.push(Jn)});if(on!==H)throw new Error("async.auto cannot execute tasks due to a recursive dependency")}function $X(Qr){var on=[];return vh(S,function(Jn,Kc){_t(Jn)&&FS(Jn,Qr,0)>=0&&on.push(Kc)}),on}};function lm(S,P){for(var D=-1,O=S==null?0:S.length,H=Array(O);++D<O;)H[D]=P(S[D],D,S);return H}var vU="[object Symbol]";function yU(S){return typeof S=="symbol"||W(S)&&Te(S)==vU}var bU=1/0,_R=ie?ie.prototype:void 0,TR=_R?_R.toString:void 0;function dP(S){if(typeof S=="string")return S;if(_t(S))return lm(S,dP)+"";if(yU(S))return TR?TR.call(S):"";var P=S+"";return P=="0"&&1/S==-bU?"-0":P}function IU(S,P,D){var O=-1,H=S.length;P<0&&(P=-P>H?0:H+P),D=D>H?H:D,D<0&&(D+=H),H=P>D?0:D-P>>>0,P>>>=0;for(var q=Array(H);++O<H;)q[O]=S[O+P];return q}function SU(S,P,D){var O=S.length;return D=D===void 0?O:D,!P&&D>=O?S:IU(S,P,D)}function CU(S,P){for(var D=S.length;D--&&FS(P,S[D],0)>-1;);return D}function EU(S,P){for(var D=-1,O=S.length;++D<O&&FS(P,S[D],0)>-1;);return D}function wU(S){return S.split("")}var PU="\\ud800-\\udfff",kU="\\u0300-\\u036f",xU="\\ufe20-\\ufe2f",DU="\\u20d0-\\u20ff",_U=kU+xU+DU,TU="\\ufe0e\\ufe0f",RU="\\u200d",AU=RegExp("["+RU+PU+_U+TU+"]");function NU(S){return AU.test(S)}var RR="\\ud800-\\udfff",MU="\\u0300-\\u036f",KU="\\ufe20-\\ufe2f",OU="\\u20d0-\\u20ff",FU=MU+KU+OU,LU="\\ufe0e\\ufe0f",UU="["+RR+"]",pP="["+FU+"]",mP="\\ud83c[\\udffb-\\udfff]",WU="(?:"+pP+"|"+mP+")",AR="[^"+RR+"]",NR="(?:\\ud83c[\\udde6-\\uddff]){2}",MR="[\\ud800-\\udbff][\\udc00-\\udfff]",VU="\\u200d",KR=WU+"?",OR="["+LU+"]?",jU="(?:"+VU+"(?:"+[AR,NR,MR].join("|")+")"+OR+KR+")*",BU=OR+KR+jU,$U="(?:"+[AR+pP+"?",pP,NR,MR,UU].join("|")+")",JU=RegExp(mP+"(?="+mP+")|"+$U+BU,"g");function qU(S){return S.match(JU)||[]}function FR(S){return NU(S)?qU(S):wU(S)}function HU(S){return S==null?"":dP(S)}var GU=/^\s+|\s+$/g;function zU(S,P,D){if(S=HU(S),S&&(D||P===void 0))return S.replace(GU,"");if(!S||!(P=dP(P)))return S;var O=FR(S),H=FR(P),q=EU(O,H),re=CU(O,H)+1;return SU(O,q,re).join("")}var QU=/^(?:async\s+)?(function)?\s*[^\(]*\(\s*([^\)]*)\)/m,YU=/,/,XU=/(=.+)?(\s*)$/,ZU=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg;function eW(S){return S=S.toString().replace(ZU,""),S=S.match(QU)[2].replace(" ",""),S=S?S.split(YU):[],S=S.map(function(P){return zU(P.replace(XU,""))}),S}function LR(S,P){var D={};vh(S,function(O,H){var q,re=I(O),le=!re&&O.length===1||re&&O.length===0;if(_t(O))q=O.slice(0,-1),O=O[O.length-1],D[H]=q.concat(q.length>0?we:O);else if(le)D[H]=O;else{if(q=eW(O),O.length===0&&!re&&q.length===0)throw new Error("autoInject task functions require explicit parameters.");re||q.pop(),D[H]=q.concat(we)}function we(Ge,xe){var yt=lm(q,function(Jr){return Ge[Jr]});yt.push(xe),w(O).apply(null,yt)}}),uP(D,P)}function vs(){this.head=this.tail=null,this.length=0}function UR(S,P){S.length=1,S.head=S.tail=P}vs.prototype.removeLink=function(S){return S.prev?S.prev.next=S.next:this.head=S.next,S.next?S.next.prev=S.prev:this.tail=S.prev,S.prev=S.next=null,this.length-=1,S},vs.prototype.empty=function(){for(;this.head;)this.shift();return this},vs.prototype.insertAfter=function(S,P){P.prev=S,P.next=S.next,S.next?S.next.prev=P:this.tail=P,S.next=P,this.length+=1},vs.prototype.insertBefore=function(S,P){P.prev=S.prev,P.next=S,S.prev?S.prev.next=P:this.head=P,S.prev=P,this.length+=1},vs.prototype.unshift=function(S){this.head?this.insertBefore(this.head,S):UR(this,S)},vs.prototype.push=function(S){this.tail?this.insertAfter(this.tail,S):UR(this,S)},vs.prototype.shift=function(){return this.head&&this.removeLink(this.head)},vs.prototype.pop=function(){return this.tail&&this.removeLink(this.tail)},vs.prototype.toArray=function(){for(var S=Array(this.length),P=this.head,D=0;D<this.length;D++)S[D]=P.data,P=P.next;return S},vs.prototype.remove=function(S){for(var P=this.head;P;){var D=P.next;S(P)&&this.removeLink(P),P=D}return this};function WR(S,P,D){if(P==null)P=1;else if(P===0)throw new Error("Concurrency must not be zero");var O=w(S),H=0,q=[],re=!1;function le(yt,Jr,ki){if(ki!=null&&typeof ki!="function")throw new Error("task callback must be a function");if(xe.started=!0,_t(yt)||(yt=[yt]),yt.length===0&&xe.idle())return u(function(){xe.drain()});for(var rl=0,ys=yt.length;rl<ys;rl++){var nl={data:yt[rl],callback:ki||Kt};Jr?xe._tasks.unshift(nl):xe._tasks.push(nl)}re||(re=!0,u(function(){re=!1,xe.process()}))}function we(yt){return function(Jr){H-=1;for(var ki=0,rl=yt.length;ki<rl;ki++){var ys=yt[ki],nl=FS(q,ys,0);nl===0?q.shift():nl>0&&q.splice(nl,1),ys.callback.apply(ys,arguments),Jr!=null&&xe.error(Jr,ys.data)}H<=xe.concurrency-xe.buffer&&xe.unsaturated(),xe.idle()&&xe.drain(),xe.process()}}var Ge=!1,xe={_tasks:new vs,concurrency:P,payload:D,saturated:Kt,unsaturated:Kt,buffer:P/4,empty:Kt,drain:Kt,error:Kt,started:!1,paused:!1,push:function(yt,Jr){le(yt,!1,Jr)},kill:function(){xe.drain=Kt,xe._tasks.empty()},unshift:function(yt,Jr){le(yt,!0,Jr)},remove:function(yt){xe._tasks.remove(yt)},process:function(){if(!Ge){for(Ge=!0;!xe.paused&&H<xe.concurrency&&xe._tasks.length;){var yt=[],Jr=[],ki=xe._tasks.length;xe.payload&&(ki=Math.min(ki,xe.payload));for(var rl=0;rl<ki;rl++){var ys=xe._tasks.shift();yt.push(ys),q.push(ys),Jr.push(ys.data)}H+=1,xe._tasks.length===0&&xe.empty(),H===xe.concurrency&&xe.saturated();var nl=la(we(yt));O(Jr,nl)}Ge=!1}},length:function(){return xe._tasks.length},running:function(){return H},workersList:function(){return q},idle:function(){return xe._tasks.length+H===0},pause:function(){xe.paused=!0},resume:function(){xe.paused!==!1&&(xe.paused=!1,u(xe.process))}};return xe}function VR(S,P){return WR(S,1,P)}var cm=$n(rd,1);function Mc(S,P,D,O){O=Hi(O||Kt);var H=w(D);cm(S,function(q,re,le){H(P,q,function(we,Ge){P=Ge,le(we)})},function(q){O(q,P)})}function fP(){var S=lm(arguments,w);return function(){var P=e(arguments),D=this,O=P[P.length-1];typeof O=="function"?P.pop():O=Kt,Mc(S,P,function(H,q,re){q.apply(D,H.concat(function(le){var we=e(arguments,1);re(le,we)}))},function(H,q){O.apply(D,[H].concat(q))})}}var jR=function(){return fP.apply(null,e(arguments).reverse())},tW=Array.prototype.concat,LS=function(S,P,D,O){O=O||Kt;var H=w(D);am(S,P,function(q,re){H(q,function(le){return le?re(le):re(null,e(arguments,1))})},function(q,re){for(var le=[],we=0;we<re.length;we++)re[we]&&(le=tW.apply(le,re[we]));return O(q,le)})},BR=$n(LS,1/0),$R=$n(LS,1),JR=function(){var S=e(arguments),P=[null].concat(S);return function(){var D=arguments[arguments.length-1];return D.apply(this,P)}};function yh(S){return S}function um(S,P){return function(D,O,H,q){q=q||Kt;var re=!1,le;D(O,function(we,Ge,xe){H(we,function(yt,Jr){yt?xe(yt):S(Jr)&&!le?(re=!0,le=P(!0,we),xe(null,tl)):xe()})},function(we){we?q(we):q(null,re?le:P(!1))})}}function qR(S,P){return P}var US=om(um(yh,qR)),bh=sm(um(yh,qR)),WS=$n(bh,1);function HR(S){return function(P){var D=e(arguments,1);D.push(function(O){var H=e(arguments,1);typeof console=="object"&&(O?console.error&&console.error(O):console[S]&&OS(H,function(q){console[S](q)}))}),w(P).apply(null,D)}}var GR=HR("dir");function zR(S,P,D){D=la(D||Kt);var O=w(S),H=w(P);function q(le){if(le)return D(le);var we=e(arguments,1);we.push(re),H.apply(this,we)}function re(le,we){if(le)return D(le);if(!we)return D(null);O(q)}re(null,!0)}function hP(S,P,D){D=la(D||Kt);var O=w(S),H=function(q){if(q)return D(q);var re=e(arguments,1);if(P.apply(this,re))return O(H);D.apply(null,[null].concat(re))};O(H)}function QR(S,P,D){hP(S,function(){return!P.apply(this,arguments)},D)}function YR(S,P,D){D=la(D||Kt);var O=w(P),H=w(S);function q(le){if(le)return D(le);H(re)}function re(le,we){if(le)return D(le);if(!we)return D(null);O(q)}H(re)}function XR(S){return function(P,D,O){return S(P,O)}}function VS(S,P,D){Nc(S,XR(w(P)),D)}function Ih(S,P,D,O){MS(P)(S,XR(w(D)),O)}var Sh=$n(Ih,1);function gP(S){return I(S)?S:r(function(P,D){var O=!0;P.push(function(){var H=arguments;O?u(function(){D.apply(null,H)}):D.apply(null,H)}),S.apply(this,P),O=!1})}function jS(S){return!S}var BS=om(um(jS,jS)),Ch=sm(um(jS,jS)),$S=$n(Ch,1);function ZR(S){return function(P){return P?.[S]}}function rW(S,P,D,O){var H=new Array(P.length);S(P,function(q,re,le){D(q,function(we,Ge){H[re]=!!Ge,le(we)})},function(q){if(q)return O(q);for(var re=[],le=0;le<P.length;le++)H[le]&&re.push(P[le]);O(null,re)})}function nW(S,P,D,O){var H=[];S(P,function(q,re,le){D(q,function(we,Ge){we?le(we):(Ge&&H.push({index:re,value:q}),le())})},function(q){q?O(q):O(null,lm(H.sort(function(re,le){return re.index-le.index}),ZR("value")))})}function vP(S,P,D,O){var H=aa(P)?rW:nW;H(S,P,w(D),O||Kt)}var JS=om(vP),Eh=sm(vP),qS=$n(Eh,1);function eA(S,P){var D=la(P||Kt),O=w(gP(S));function H(q){if(q)return D(q);O(H)}H()}var HS=function(S,P,D,O){O=O||Kt;var H=w(D);am(S,P,function(q,re){H(q,function(le,we){return le?re(le):re(null,{key:we,val:q})})},function(q,re){for(var le={},we=Object.prototype.hasOwnProperty,Ge=0;Ge<re.length;Ge++)if(re[Ge]){var xe=re[Ge].key,yt=re[Ge].val;we.call(le,xe)?le[xe].push(yt):le[xe]=[yt]}return O(q,le)})},tA=$n(HS,1/0),rA=$n(HS,1),nA=HR("log");function GS(S,P,D,O){O=Hi(O||Kt);var H={},q=w(D);rd(S,P,function(re,le,we){q(re,le,function(Ge,xe){if(Ge)return we(Ge);H[le]=xe,we()})},function(re){O(re,H)})}var iA=$n(GS,1/0),oA=$n(GS,1);function sA(S,P){return P in S}function aA(S,P){var D=Object.create(null),O=Object.create(null);P=P||yh;var H=w(S),q=r(function(le,we){var Ge=P.apply(null,le);sA(D,Ge)?u(function(){we.apply(null,D[Ge])}):sA(O,Ge)?O[Ge].push(we):(O[Ge]=[we],H.apply(null,le.concat(function(){var xe=e(arguments);D[Ge]=xe;var yt=O[Ge];delete O[Ge];for(var Jr=0,ki=yt.length;Jr<ki;Jr++)yt[Jr].apply(null,xe)})))});return q.memo=D,q.unmemoized=S,q}var zS;s?zS=process.nextTick:o?zS=setImmediate:zS=a;var lA=l(zS);function yP(S,P,D){D=D||Kt;var O=aa(P)?[]:{};S(P,function(H,q,re){w(H)(function(le,we){arguments.length>2&&(we=e(arguments,1)),O[q]=we,re(le)})},function(H){D(H,O)})}function cA(S,P){yP(Nc,S,P)}function uA(S,P,D){yP(MS(P),S,D)}var bP=function(S,P){var D=w(S);return WR(function(O,H){D(O[0],H)},P,1)},dA=function(S,P){var D=bP(S,P);return D.push=function(O,H,q){if(q==null&&(q=Kt),typeof q!="function")throw new Error("task callback must be a function");if(D.started=!0,_t(O)||(O=[O]),O.length===0)return u(function(){D.drain()});H=H||0;for(var re=D._tasks.head;re&&H>=re.priority;)re=re.next;for(var le=0,we=O.length;le<we;le++){var Ge={data:O[le],priority:H,callback:q};re?D._tasks.insertBefore(re,Ge):D._tasks.push(Ge)}u(D.process)},delete D.unshift,D};function pA(S,P){if(P=Hi(P||Kt),!_t(S))return P(new TypeError("First argument to race must be an array of functions"));if(!S.length)return P();for(var D=0,O=S.length;D<O;D++)w(S[D])(P)}function QS(S,P,D,O){var H=e(S).reverse();Mc(H,P,D,O)}function YS(S){var P=w(S);return r(function(O,H){return O.push(function(re,le){if(re)H(null,{error:re});else{var we;arguments.length<=2?we=le:we=e(arguments,1),H(null,{value:we})}}),P.apply(this,O)})}function mA(S){var P;return _t(S)?P=lm(S,YS):(P={},vh(S,function(D,O){P[O]=YS.call(this,D)})),P}function fA(S,P,D,O){vP(S,P,function(H,q){D(H,function(re,le){q(re,!le)})},O)}var hA=om(fA),IP=sm(fA),gA=$n(IP,1);function vA(S){return function(){return S}}function XS(S,P,D){var O=5,H=0,q={times:O,intervalFunc:vA(H)};function re(xe,yt){if(typeof yt=="object")xe.times=+yt.times||O,xe.intervalFunc=typeof yt.interval=="function"?yt.interval:vA(+yt.interval||H),xe.errorFilter=yt.errorFilter;else if(typeof yt=="number"||typeof yt=="string")xe.times=+yt||O;else throw new Error("Invalid arguments for async.retry")}if(arguments.length<3&&typeof S=="function"?(D=P||Kt,P=S):(re(q,S),D=D||Kt),typeof P!="function")throw new Error("Invalid arguments for async.retry");var le=w(P),we=1;function Ge(){le(function(xe){xe&&we++<q.times&&(typeof q.errorFilter!="function"||q.errorFilter(xe))?setTimeout(Ge,q.intervalFunc(we)):D.apply(null,arguments)})}Ge()}var yA=function(S,P){P||(P=S,S=null);var D=w(P);return r(function(O,H){function q(re){D.apply(null,O.concat(re))}S?XS(S,q,H):XS(q,H)})};function bA(S,P){yP(cm,S,P)}var ZS=om(um(Boolean,yh)),wh=sm(um(Boolean,yh)),eC=$n(wh,1);function IA(S,P,D){var O=w(P);KS(S,function(q,re){O(q,function(le,we){if(le)return re(le);re(null,{value:q,criteria:we})})},function(q,re){if(q)return D(q);D(null,lm(re.sort(H),ZR("value")))});function H(q,re){var le=q.criteria,we=re.criteria;return le<we?-1:le>we?1:0}}function SA(S,P,D){var O=w(S);return r(function(H,q){var re=!1,le;function we(){var Ge=S.name||"anonymous",xe=new Error('Callback function "'+Ge+'" timed out.');xe.code="ETIMEDOUT",D&&(xe.info=D),re=!0,q(xe)}H.push(function(){re||(q.apply(null,arguments),clearTimeout(le))}),le=setTimeout(we,P),O.apply(null,H)})}var iW=Math.ceil,oW=Math.max;function sW(S,P,D,O){for(var H=-1,q=oW(iW((P-S)/(D||1)),0),re=Array(q);q--;)re[O?q:++H]=S,S+=D;return re}function tC(S,P,D,O){var H=w(D);am(sW(0,S,1),P,H,O)}var CA=$n(tC,1/0),EA=$n(tC,1);function x(S,P,D,O){arguments.length<=3&&(O=D,D=P,P=_t(S)?[]:{}),O=Hi(O||Kt);var H=w(D);Nc(S,function(q,re,le){H(P,q,re,le)},function(q){O(q,P)})}function U(S,P){var D=null,O;P=P||Kt,Sh(S,function(H,q){w(H)(function(re,le){arguments.length>2?O=e(arguments,1):O=le,D=re,q(!re)})},function(){P(D,O)})}function je(S){return function(){return(S.unmemoized||S).apply(null,arguments)}}function rC(S,P,D){D=la(D||Kt);var O=w(P);if(!S())return D(null);var H=function(q){if(q)return D(q);if(S())return O(H);var re=e(arguments,1);D.apply(null,[null].concat(re))};O(H)}function aW(S,P,D){rC(function(){return!S.apply(this,arguments)},P,D)}var lW=function(S,P){if(P=Hi(P||Kt),!_t(S))return P(new Error("First argument to waterfall must be an array of functions"));if(!S.length)return P();var D=0;function O(q){var re=w(S[D++]);q.push(la(H)),re.apply(null,q)}function H(q){if(q||D===S.length)return P.apply(null,arguments);O(e(arguments,1))}O([])},jX={apply:t,applyEach:xR,applyEachSeries:DR,asyncify:d,auto:uP,autoInject:LR,cargo:VR,compose:jR,concat:BR,concatLimit:LS,concatSeries:$R,constant:JR,detect:US,detectLimit:bh,detectSeries:WS,dir:GR,doDuring:zR,doUntil:QR,doWhilst:hP,during:YR,each:VS,eachLimit:Ih,eachOf:Nc,eachOfLimit:rd,eachOfSeries:cm,eachSeries:Sh,ensureAsync:gP,every:BS,everyLimit:Ch,everySeries:$S,filter:JS,filterLimit:Eh,filterSeries:qS,forever:eA,groupBy:tA,groupByLimit:HS,groupBySeries:rA,log:nA,map:KS,mapLimit:am,mapSeries:cP,mapValues:iA,mapValuesLimit:GS,mapValuesSeries:oA,memoize:aA,nextTick:lA,parallel:cA,parallelLimit:uA,priorityQueue:dA,queue:bP,race:pA,reduce:Mc,reduceRight:QS,reflect:YS,reflectAll:mA,reject:hA,rejectLimit:IP,rejectSeries:gA,retry:XS,retryable:yA,seq:fP,series:bA,setImmediate:u,some:ZS,someLimit:wh,someSeries:eC,sortBy:IA,timeout:SA,times:CA,timesLimit:tC,timesSeries:EA,transform:x,tryEach:U,unmemoize:je,until:aW,waterfall:lW,whilst:rC,all:BS,allLimit:Ch,allSeries:$S,any:ZS,anyLimit:wh,anySeries:eC,find:US,findLimit:bh,findSeries:WS,forEach:VS,forEachSeries:Sh,forEachLimit:Ih,forEachOf:Nc,forEachOfSeries:cm,forEachOfLimit:rd,inject:Mc,foldl:Mc,foldr:QS,select:JS,selectLimit:Eh,selectSeries:qS,wrapSync:d};n.default=jX,n.apply=t,n.applyEach=xR,n.applyEachSeries=DR,n.asyncify=d,n.auto=uP,n.autoInject=LR,n.cargo=VR,n.compose=jR,n.concat=BR,n.concatLimit=LS,n.concatSeries=$R,n.constant=JR,n.detect=US,n.detectLimit=bh,n.detectSeries=WS,n.dir=GR,n.doDuring=zR,n.doUntil=QR,n.doWhilst=hP,n.during=YR,n.each=VS,n.eachLimit=Ih,n.eachOf=Nc,n.eachOfLimit=rd,n.eachOfSeries=cm,n.eachSeries=Sh,n.ensureAsync=gP,n.every=BS,n.everyLimit=Ch,n.everySeries=$S,n.filter=JS,n.filterLimit=Eh,n.filterSeries=qS,n.forever=eA,n.groupBy=tA,n.groupByLimit=HS,n.groupBySeries=rA,n.log=nA,n.map=KS,n.mapLimit=am,n.mapSeries=cP,n.mapValues=iA,n.mapValuesLimit=GS,n.mapValuesSeries=oA,n.memoize=aA,n.nextTick=lA,n.parallel=cA,n.parallelLimit=uA,n.priorityQueue=dA,n.queue=bP,n.race=pA,n.reduce=Mc,n.reduceRight=QS,n.reflect=YS,n.reflectAll=mA,n.reject=hA,n.rejectLimit=IP,n.rejectSeries=gA,n.retry=XS,n.retryable=yA,n.seq=fP,n.series=bA,n.setImmediate=u,n.some=ZS,n.someLimit=wh,n.someSeries=eC,n.sortBy=IA,n.timeout=SA,n.times=CA,n.timesLimit=tC,n.timesSeries=EA,n.transform=x,n.tryEach=U,n.unmemoize=je,n.until=aW,n.waterfall=lW,n.whilst=rC,n.all=BS,n.allLimit=Ch,n.allSeries=$S,n.any=ZS,n.anyLimit=wh,n.anySeries=eC,n.find=US,n.findLimit=bh,n.findSeries=WS,n.forEach=VS,n.forEachSeries=Sh,n.forEachLimit=Ih,n.forEachOf=Nc,n.forEachOfSeries=cm,n.forEachOfLimit=rd,n.inject=Mc,n.foldl=Mc,n.foldr=QS,n.select=JS,n.selectLimit=Eh,n.selectSeries=qS,n.wrapSync=d,Object.defineProperty(n,"__esModule",{value:!0})})});var xF=F((nZe,$G)=>{"use strict";function sme(n){t.debug=t,t.default=t,t.coerce=l,t.disable=s,t.enable=o,t.enabled=a,t.humanize=bF(),Object.keys(n).forEach(function(c){t[c]=n[c]}),t.instances=[],t.names=[],t.skips=[],t.formatters={};function e(c){for(var u=0,d=0;d<c.length;d++)u=(u<<5)-u+c.charCodeAt(d),u|=0;return t.colors[Math.abs(u)%t.colors.length]}t.selectColor=e;function t(c){var u;function d(){if(d.enabled){for(var f=arguments.length,g=new Array(f),b=0;b<f;b++)g[b]=arguments[b];var I=d,w=Number(new Date),_=w-(u||w);I.diff=_,I.prev=u,I.curr=w,u=w,g[0]=t.coerce(g[0]),typeof g[0]!="string"&&g.unshift("%O");var A=0;g[0]=g[0].replace(/%([a-zA-Z%])/g,function(V,ie){if(V==="%%")return V;A++;var Q=t.formatters[ie];if(typeof Q=="function"){var te=g[A];V=Q.call(I,te),g.splice(A,1),A--}return V}),t.formatArgs.call(I,g);var R=I.log||t.log;R.apply(I,g)}}return d.namespace=c,d.enabled=t.enabled(c),d.useColors=t.useColors(),d.color=e(c),d.destroy=r,d.extend=i,typeof t.init=="function"&&t.init(d),t.instances.push(d),d}function r(){var c=t.instances.indexOf(this);return c!==-1?(t.instances.splice(c,1),!0):!1}function i(c,u){return t(this.namespace+(typeof u>"u"?":":u)+c)}function o(c){t.save(c),t.names=[],t.skips=[];var u,d=(typeof c=="string"?c:"").split(/[\s,]+/),f=d.length;for(u=0;u<f;u++)d[u]&&(c=d[u].replace(/\*/g,".*?"),c[0]==="-"?t.skips.push(new RegExp("^"+c.substr(1)+"$")):t.names.push(new RegExp("^"+c+"$")));for(u=0;u<t.instances.length;u++){var g=t.instances[u];g.enabled=t.enabled(g.namespace)}}function s(){t.enable("")}function a(c){if(c[c.length-1]==="*")return!0;var u,d;for(u=0,d=t.skips.length;u<d;u++)if(t.skips[u].test(c))return!1;for(u=0,d=t.names.length;u<d;u++)if(t.names[u].test(c))return!0;return!1}function l(c){return c instanceof Error?c.stack||c.message:c}return t.enable(t.load()),t}$G.exports=sme});var JG=F((Hs,MT)=>{"use strict";function NT(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?NT=function(t){return typeof t}:NT=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},NT(n)}Hs.log=cme;Hs.formatArgs=lme;Hs.save=ume;Hs.load=dme;Hs.useColors=ame;Hs.storage=pme();Hs.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function ame(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function lme(n){if(n[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+n[0]+(this.useColors?"%c ":" ")+"+"+MT.exports.humanize(this.diff),!!this.useColors){var e="color: "+this.color;n.splice(1,0,e,"color: inherit");var t=0,r=0;n[0].replace(/%[a-zA-Z%]/g,function(i){i!=="%%"&&(t++,i==="%c"&&(r=t))}),n.splice(r,0,e)}}function cme(){var n;return(typeof console>"u"?"undefined":NT(console))==="object"&&console.log&&(n=console).log.apply(n,arguments)}function ume(n){try{n?Hs.storage.setItem("debug",n):Hs.storage.removeItem("debug")}catch{}}function dme(){var n;try{n=Hs.storage.getItem("debug")}catch{}return!n&&typeof process<"u"&&"env"in process&&(n=process.env.DEBUG),n}function pme(){try{return localStorage}catch{}}MT.exports=xF()(Hs);var mme=MT.exports.formatters;mme.j=function(n){try{return JSON.stringify(n)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var HG=F(($i,FT)=>{"use strict";var fme=require("tty"),OT=require("util");$i.init=Sme;$i.log=yme;$i.formatArgs=gme;$i.save=bme;$i.load=Ime;$i.useColors=hme;$i.colors=[6,2,3,4,5,1];try{KT=CF(),KT&&(KT.stderr||KT).level>=2&&($i.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}var KT;$i.inspectOpts=Object.keys(process.env).filter(function(n){return/^debug_/i.test(n)}).reduce(function(n,e){var t=e.substring(6).toLowerCase().replace(/_([a-z])/g,function(i,o){return o.toUpperCase()}),r=process.env[e];return/^(yes|on|true|enabled)$/i.test(r)?r=!0:/^(no|off|false|disabled)$/i.test(r)?r=!1:r==="null"?r=null:r=Number(r),n[t]=r,n},{});function hme(){return"colors"in $i.inspectOpts?!!$i.inspectOpts.colors:fme.isatty(process.stderr.fd)}function gme(n){var e=this.namespace,t=this.useColors;if(t){var r=this.color,i="\x1B[3"+(r<8?r:"8;5;"+r),o="  ".concat(i,";1m").concat(e," \x1B[0m");n[0]=o+n[0].split(`
`).join(`
`+o),n.push(i+"m+"+FT.exports.humanize(this.diff)+"\x1B[0m")}else n[0]=vme()+e+" "+n[0]}function vme(){return $i.inspectOpts.hideDate?"":new Date().toISOString()+" "}function yme(){return process.stderr.write(OT.format.apply(OT,arguments)+`
`)}function bme(n){n?process.env.DEBUG=n:delete process.env.DEBUG}function Ime(){return process.env.DEBUG}function Sme(n){n.inspectOpts={};for(var e=Object.keys($i.inspectOpts),t=0;t<e.length;t++)n.inspectOpts[e[t]]=$i.inspectOpts[e[t]]}FT.exports=xF()($i);var qG=FT.exports.formatters;qG.o=function(n){return this.inspectOpts.colors=this.useColors,OT.inspect(n,this.inspectOpts).split(`
`).map(function(e){return e.trim()}).join(" ")};qG.O=function(n){return this.inspectOpts.colors=this.useColors,OT.inspect(n,this.inspectOpts)}});var GG=F((iZe,DF)=>{"use strict";typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?DF.exports=JG():DF.exports=HG()});var XG=F((oZe,YG)=>{var pw=require("path"),zG=require("fs"),QG=parseInt("0777",8);YG.exports=hb.mkdirp=hb.mkdirP=hb;function hb(n,e,t,r){typeof e=="function"?(t=e,e={}):(!e||typeof e!="object")&&(e={mode:e});var i=e.mode,o=e.fs||zG;i===void 0&&(i=QG),r||(r=null);var s=t||function(){};n=pw.resolve(n),o.mkdir(n,i,function(a){if(!a)return r=r||n,s(null,r);switch(a.code){case"ENOENT":if(pw.dirname(n)===n)return s(a);hb(pw.dirname(n),e,function(l,c){l?s(l,c):hb(n,e,s,c)});break;default:o.stat(n,function(l,c){l||!c.isDirectory()?s(a,r):s(null,r)});break}})}hb.sync=function n(e,t,r){(!t||typeof t!="object")&&(t={mode:t});var i=t.mode,o=t.fs||zG;i===void 0&&(i=QG),r||(r=null),e=pw.resolve(e);try{o.mkdirSync(e,i),r=r||e}catch(a){switch(a.code){case"ENOENT":r=n(pw.dirname(e),t,r),n(e,t,r);break;default:var s;try{s=o.statSync(e)}catch{throw a}if(!s.isDirectory())throw a;break}}return r}});var tz=F(Pr=>{"use strict";var ZG=require("fs"),Cme=require("os"),Eme=require("net"),LT=require("path"),ez=BG(),RF=GG(),wme=XG().mkdirp,_F=RF("portfinder:testPort"),mw=RF("portfinder:getPort"),Pme=RF("portfinder:defaultHosts"),TF={};TF.testPort=function(n,e){e||(e=n,n={}),n.server=n.server||Eme.createServer(function(){}),_F("entered testPort(): trying",n.host,"port",n.port);function t(){_F("done w/ testPort(): OK",n.host,"port",n.port),n.server.removeListener("error",r),n.server.close(),e(null,n.port)}function r(i){if(_F("done w/ testPort(): failed",n.host,"w/ port",n.port,"with error",i.code),n.server.removeListener("listening",t),!(i.code=="EADDRINUSE"||i.code=="EACCES"))return e(i);var o=Pr.nextPort(n.port);if(o>Pr.highestPort)return e(new Error("No open ports available"));TF.testPort({port:o,host:n.host,server:n.server},e)}n.server.once("error",r),n.server.once("listening",t),n.host?n.server.listen(n.port,n.host):n.server.listen(n.port)};Pr.basePort=8e3;Pr.highestPort=65535;Pr.basePath="/tmp/portfinder";Pr.getPort=function(n,e){if(e||(e=n,n={}),n.port=Number(n.port)||Number(Pr.basePort),n.host=n.host||null,n.stopPort=Number(n.stopPort)||Number(Pr.highestPort),!n.startPort){if(n.startPort=Number(n.port),n.startPort<0)throw Error("Provided options.startPort("+n.startPort+") is less than 0, which are cannot be bound.");if(n.stopPort<n.startPort)throw Error("Provided options.stopPort("+n.stopPort+"is less than options.startPort ("+n.startPort+")")}if(n.host){for(var t,r=0;r<Pr._defaultHosts.length;r++)if(Pr._defaultHosts[r]===n.host){t=!0;break}t||Pr._defaultHosts.push(n.host)}var i=[],o;return ez.eachSeries(Pr._defaultHosts,function(s,a){return mw("in eachSeries() iteration callback: host is",s),TF.testPort({host:s,port:n.port},function(l,c){return l?(mw("in eachSeries() iteration callback testPort() callback","with an err:",l.code),o=s,a(l)):(mw("in eachSeries() iteration callback testPort() callback","with a success for port",c),i.push(c),a())})},function(s){if(s)if(mw("in eachSeries() result callback: err is",s),s.code==="EADDRNOTAVAIL"||s.code==="EINVAL")if(n.host===o){var a="Provided host "+n.host+" could NOT be bound. Please provide a different host address or hostname";return e(Error(a))}else{var l=Pr._defaultHosts.indexOf(o);return Pr._defaultHosts.splice(l,1),Pr.getPort(n,e)}else return e(s);if(i.sort(function(c,u){return c-u}),mw("in eachSeries() result callback: openPorts is",i),i[0]===i[i.length-1]){if(i[0]<=n.stopPort)return e(null,i[0]);var a="No open ports found in between "+n.startPort+" and "+n.stopPort;return e(Error(a))}else return Pr.getPort({port:i.pop(),host:n.host,startPort:n.startPort,stopPort:n.stopPort},e)})};Pr.getPortPromise=function(n){if(typeof Promise!="function")throw Error("Native promise support is not available in this version of node.Please install a polyfill and assign Promise to global.Promise before calling this method");return n||(n={}),new Promise(function(e,t){Pr.getPort(n,function(r,i){if(r)return t(r);e(i)})})};Pr.getPorts=function(n,e,t){t||(t=e,e={});var r=null;ez.timesSeries(n,function(i,o){r&&(e.port=Pr.nextPort(r)),Pr.getPort(e,function(s,a){s?o(s):(r=a,o(null,a))})},t)};Pr.getSocket=function(n,e){e||(e=n,n={}),n.mod=n.mod||parseInt(755,8),n.path=n.path||Pr.basePath+".sock";function t(){ZG.stat(n.path,function(o){o?o.code=="ENOENT"?e(null,n.path):e(o):(n.path=Pr.nextSocket(n.path),Pr.getSocket(n,e))})}function r(o){wme(o,n.mod,function(s){if(s)return e(s);n.exists=!0,t()})}function i(){var o=LT.dirname(n.path);ZG.stat(o,function(s,a){if(s||!a.isDirectory())return r(o);n.exists=!0,t()})}return n.exists?t():i()};Pr.nextPort=function(n){return n+1};Pr.nextSocket=function(n){var e=LT.dirname(n),t=LT.basename(n,".sock"),r=t.match(/^([a-zA-z]+)(\d*)$/i),i=parseInt(r[2]),o=r[1];return isNaN(i)&&(i=0),i+=1,LT.join(e,o+i+".sock")};Pr._defaultHosts=function(){var n={};try{n=Cme.networkInterfaces()}catch(l){if(l.syscall!=="uv_interface_addresses")throw l}for(var e=Object.keys(n),t="0.0.0.0",r=[t],i=0;i<e.length;i++)for(var o=n[e[i]],s=0;s<o.length;s++){var a=o[s];r.push(a.address)}return r.push(null),Pme("exports._defaultHosts is: %o",r),r}()});var cz=F(gb=>{"use strict";Object.defineProperty(gb,"__esModule",{value:!0});gb.encode=gb.decode=void 0;var sz=require("crypto"),AF="<IDS|MSG>",Dme=5;function VT(n){return JSON.parse(n.toString())}function az(n){return Object.assign({},{header:{},parent_header:{},metadata:{},content:{},idents:[],buffers:[]},n)}function lz(n){let e=n;switch(n){case"hmac-sha256":e="sha256";break}return e}function _me(n,e,t="sha256"){var r=0;let i=[];for(r=0;r<n.length;r++){var o=n[r];if(o.toString()===AF)break;i.push(o)}if(n.length-r<Dme)throw new Error("Message Decoding: Not enough message frames");if(n[r].toString()!==AF)throw new Error("Message Decoding: Missing delimiter");if(e){let u=lz(t);var s=n[r+1].toString(),a=sz.createHmac(u,e);a.update(n[r+2]),a.update(n[r+3]),a.update(n[r+4]),a.update(n[r+5]);var l=a.digest("hex");if(l!==s)throw new Error(`Message Decoding: Incorrect;
Obtained "${s}"
Expected "${l}"`)}var c=az({idents:i,header:VT(n[r+2]),parent_header:VT(n[r+3]),content:VT(n[r+5]),metadata:VT(n[r+4]),buffers:Array.prototype.slice.apply(n,[r+6])});return c}gb.decode=_me;function Tme(n,e,t="sha256"){let r=az(n),i=lz(t),o=r.idents,s=Buffer.from(JSON.stringify(r.header),"utf-8"),a=Buffer.from(JSON.stringify(r.parent_header),"utf-8"),l=Buffer.from(JSON.stringify(r.metadata),"utf-8"),c=Buffer.from(JSON.stringify(r.content),"utf-8"),u="";if(e){let f=sz.createHmac(i,e);f.update(s),f.update(a),f.update(l),f.update(c),u=f.digest("hex")}var d=o.concat([Buffer.from(AF),Buffer.from(u),s,a,l,c]).concat(r.buffers);return d}gb.encode=Tme});var Iz=F((Rnt,bz)=>{"use strict";bz.exports=({onlyFirst:n=!1}={})=>{let e=["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|");return new RegExp(e,n?void 0:"g")}});var Jz=F((lct,$z)=>{"use strict";var Qme=(n,e={})=>{let t=e.safe===!0||e.keepProtected===!0,r=!1,i=(o,s)=>{let a="",l,c;for(let u of o.nodes)switch(u.type){case"block":if(e.first&&r===!0){a+=i(u,o);break}if(e.preserveNewlines===!0){l=i(u,o),c=l.split(`
`),a+=`
`.repeat(c.length-1);break}if(t===!0&&u.protected===!0){a+=i(u,o);break}r=!0;break;case"line":if(e.first&&r===!0){a+=u.value;break}t===!0&&u.protected===!0&&(a+=u.value),r=!0;break;case"open":case"close":case"text":case"newline":default:{a+=u.value||"";break}}return a};return i(n)};$z.exports=Qme});var Hz=F((cct,qz)=>{"use strict";var v0=class{constructor(e){this.type=e.type,e.value&&(this.value=e.value),e.match&&(this.match=e.match),this.newline=e.newline||""}get protected(){return!!this.match&&this.match[1]==="!"}},jF=class extends v0{constructor(e){super(e),this.nodes=e.nodes||[]}push(e){this.nodes.push(e)}get protected(){return this.nodes.length>0&&this.nodes[0].protected===!0}};qz.exports={Node:v0,Block:jF}});var zz=F(Gz=>{"use strict";Gz.javascript={BLOCK_OPEN_REGEX:/^\/\*\*?(!?)/,BLOCK_CLOSE_REGEX:/^\*\/(\n?)/,LINE_REGEX:/^\/\/(!?).*/}});var Xz=F((dct,Yz)=>{"use strict";var{Node:Tp,Block:Qz}=Hz(),Yme=zz(),BF={ESCAPED_CHAR_REGEX:/^\\./,QUOTED_STRING_REGEX:/^(['"`])((?:\\.|[^\1])+?)(\1)/,NEWLINE_REGEX:/^\r*\n/},Xme=(n,e={})=>{if(typeof n!="string")throw new TypeError("Expected input to be a string");let t=new Qz({type:"root",nodes:[]}),r=[t],i=(e.language||"javascript").toLowerCase(),o=Yme[i];if(typeof o>"u")throw new Error(`Language "${i}" is not supported by strip-comments`);let{LINE_REGEX:s,BLOCK_OPEN_REGEX:a,BLOCK_CLOSE_REGEX:l}=o,c=t,u=n,d,f,g=[a,l].filter(Boolean),b=!1;g.every(R=>R.source==='^"""')&&(b=!0);let I=(R=u[0]||"")=>(u=u.slice(R.length),R),w=(R,V="text")=>{let ie=R.exec(u);if(ie)return I(ie[0]),{type:V,value:ie[0],match:ie}},_=R=>{if(f&&f.type==="text"&&R.type==="text"){f.value+=R.value;return}c.push(R),R.nodes&&(r.push(R),c=R),f=R},A=()=>{if(c.type==="root")throw new SyntaxError("Unclosed block comment");r.pop(),c=r[r.length-1]};for(;u!=="";){if(d=w(BF.ESCAPED_CHAR_REGEX,"text")){_(new Tp(d));continue}if(c.type!=="block"&&(!f||!/\w$/.test(f.value))&&!(b&&u.startsWith('"""'))&&(d=w(BF.QUOTED_STRING_REGEX,"text"))){_(new Tp(d));continue}if(d=w(BF.NEWLINE_REGEX,"newline")){_(new Tp(d));continue}if(a&&e.block&&!(b&&c.type==="block")&&(d=w(a,"open"))){_(new Qz({type:"block"})),_(new Tp(d));continue}if(l&&c.type==="block"&&e.block&&(d=w(l,"close"))){d.newline=d.match[1]||"",_(new Tp(d)),A();continue}if(s&&c.type!=="block"&&e.line&&(d=w(s,"line"))){_(new Tp(d));continue}if(d=w(/^[a-zABD-Z0-9\t ]+/,"text")){_(new Tp(d));continue}_(new Tp({type:"text",value:I(u[0])}))}return t};Yz.exports=Xme});var eQ=F((pct,Zz)=>{"use strict";var y0=Jz(),bw=Xz(),b0=Zz.exports=(n,e)=>{let t={...e,block:!0,line:!0};return y0(bw(n,t),t)};b0.block=(n,e)=>{let t={...e,block:!0};return y0(bw(n,t),t)};b0.line=(n,e)=>{let t={...e,line:!0};return y0(bw(n,t),t)};b0.first=(n,e)=>{let t={...e,block:!0,line:!0,first:!0};return y0(bw(n,t),t)};b0.parse=bw});var UQ=F((Bkt,LQ)=>{var kfe=typeof global=="object"&&global&&global.Object===Object&&global;LQ.exports=kfe});var VQ=F(($kt,WQ)=>{var xfe=UQ(),Dfe=typeof self=="object"&&self&&self.Object===Object&&self,_fe=xfe||Dfe||Function("return this")();WQ.exports=_fe});var d1=F((Jkt,jQ)=>{var Tfe=VQ(),Rfe=Tfe.Symbol;jQ.exports=Rfe});var $Q=F((qkt,BQ)=>{function Afe(n,e){for(var t=-1,r=n==null?0:n.length,i=Array(r);++t<r;)i[t]=e(n[t],t,n);return i}BQ.exports=Afe});var qQ=F((Hkt,JQ)=>{var Nfe=Array.isArray;JQ.exports=Nfe});var QQ=F((Gkt,zQ)=>{var HQ=d1(),GQ=Object.prototype,Mfe=GQ.hasOwnProperty,Kfe=GQ.toString,Fw=HQ?HQ.toStringTag:void 0;function Ofe(n){var e=Mfe.call(n,Fw),t=n[Fw];try{n[Fw]=void 0;var r=!0}catch{}var i=Kfe.call(n);return r&&(e?n[Fw]=t:delete n[Fw]),i}zQ.exports=Ofe});var XQ=F((zkt,YQ)=>{var Ffe=Object.prototype,Lfe=Ffe.toString;function Ufe(n){return Lfe.call(n)}YQ.exports=Ufe});var rY=F((Qkt,tY)=>{var ZQ=d1(),Wfe=QQ(),Vfe=XQ(),jfe="[object Null]",Bfe="[object Undefined]",eY=ZQ?ZQ.toStringTag:void 0;function $fe(n){return n==null?n===void 0?Bfe:jfe:eY&&eY in Object(n)?Wfe(n):Vfe(n)}tY.exports=$fe});var iY=F((Ykt,nY)=>{function Jfe(n){return n!=null&&typeof n=="object"}nY.exports=Jfe});var sY=F((Xkt,oY)=>{var qfe=rY(),Hfe=iY(),Gfe="[object Symbol]";function zfe(n){return typeof n=="symbol"||Hfe(n)&&qfe(n)==Gfe}oY.exports=zfe});var pY=F((Zkt,dY)=>{var aY=d1(),Qfe=$Q(),Yfe=qQ(),Xfe=sY(),Zfe=1/0,lY=aY?aY.prototype:void 0,cY=lY?lY.toString:void 0;function uY(n){if(typeof n=="string")return n;if(Yfe(n))return Qfe(n,uY)+"";if(Xfe(n))return cY?cY.call(n):"";var e=n+"";return e=="0"&&1/n==-Zfe?"-0":e}dY.exports=uY});var fY=F((ext,mY)=>{var ehe=pY();function the(n){return n==null?"":ehe(n)}mY.exports=the});var vY=F((txt,gY)=>{var rhe=fY(),hY=/[\\^$.*+?()[\]{}|]/g,nhe=RegExp(hY.source);function ihe(n){return n=rhe(n),n&&nhe.test(n)?n.replace(hY,"\\$&"):n}gY.exports=ihe});var Ige={};uW(Ige,{activate:()=>fge,deactivate:()=>hge});module.exports=pW(Ige);Reflect.metadata===void 0&&fW();var sr=require("vscode");function kh(){try{return(gW(),pW(hW)).isPreRelesVersionOfJupyterExtension===!0}catch{return!0}}var iC={isExiting:!1},SP="_builtin.JupyterServerSelectorForTesting",oC="_builtin.jupyterServerUrlProvider";var vW=!1;function yW(n){vW=n}function dm(){return vW}var bW=!1;function IW(n){bW=n}function Lr(){return bW}var ge="python",sC="markdown",ca="vscode-notebook-cell",ZX={scheme:"untitled",language:ge},eZ={scheme:"file",language:ge},CP={language:ge},tZ={scheme:ca,language:ge},SW=[ZX,eZ,tZ],xh="vscode-interactive-input",It="jupyter-notebook",nr="interactive";var il="GitHub.codespaces",_e="ms-toolsai.jupyter",EP="ms-toolsai.datawrangler",aC=["donjayamanne"],lC="ms-toolsai.vscode-jupyter-powertoys",CW="ms-security.ms-sentinel",Dh="ms-toolsai.jupyter-hub",EW="0c6ae279ed8443289764825290e4f9e2-1a736e7c-1324-4338-be46-fc2a58ae4d14-7255",nd="STANDARD_OUTPUT_CHANNEL",cC;(t=>(t.PythonInteractiveHelpLink="https://aka.ms/pyaiinstall",t.JupyterDataRateHelpLink="https://aka.ms/AA5ggm0"))(cC||={});var li;(o=>(o.JupyterServerRemoteLaunchNameSeparator=`
`,o.JupyterServerRemoteLaunchService=_e,o.JupyterServerUriListMax=10,o.IntellisenseTimeout=2e3,o.IntellisenseResolveTimeout=5e3))(li||={});var qn=!1;var rZ=!1;function Rr(){return rZ||uC()}var nZ=!1;function uC(){return nZ}var Le;(I=>(I.GeneratedThemeName="ipython-theme",I.MatplotLibDefaultParams="_VSCode_defaultMatplotlib_Params",I.MatplotLibFigureFormats="_VSCode_matplotLib_FigureFormats",I.DefaultCodeCellMarker="# %%",I.DefaultCommTarget="jupyter.widget",I.ALL_VARIABLES="ALL_VARIABLES",I.KERNEL_VARIABLES="KERNEL_VARIABLES",I.DEBUGGER_VARIABLES="DEBUGGER_VARIABLES",I.PYTHON_VARIABLES_REQUESTER="PYTHON_VARIABLES_REQUESTER",I.MULTIPLEXING_DEBUGSERVICE="MULTIPLEXING_DEBUGSERVICE",I.RUN_BY_LINE_DEBUGSERVICE="RUN_BY_LINE_DEBUGSERVICE",I.REMOTE_URI="https://remote/",I.REMOTE_URI_ID_PARAM="id",I.REMOTE_URI_HANDLE_PARAM="uriHandle",I.REMOTE_URI_EXTENSION_ID_PARAM="extensionId"))(Le||={});var _h;(r=>(r.ImportIPython=`{0}
from IPython import get_ipython

{1}`,r.MatplotLibInit=`import matplotlib
%matplotlib inline
${Le.MatplotLibDefaultParams} = dict(matplotlib.rcParams)
`,r.DisableJedi="%config Completer.use_jedi = False"))(_h||={});var Th="JUPYTER_OUTPUT_CHANNEL",kA="Default Light+",sn="ms-python.python",wP="ms-python.vscode-python-envs",id="ms-toolsai.jupyter-renderers",pm="ms-python.vscode-pylance",wW=["python","html","xml","javascript","markdown","latex","shellscript","bat","powershell","kusto","ruby","sql","perl","qsharp","raw"],PW=new Map([["bash","shellscript"],["c#","csharp"],["f#","fsharp"],["q#","qsharp"],["c++11","c++"],["c++12","c++"],["c++14","c++"]]),dC=["python","r","julia","c++","c#","f#","q#","powershell","java","scala","haskell","bash","cling","rust","sas","sos","ocaml"];var J;(se=>(se.RunAllCells="jupyter.runallcells",se.RunAllCellsAbove="jupyter.runallcellsabove",se.RunCellAndAllBelow="jupyter.runcellandallbelow",se.RunAllCellsAbovePalette="jupyter.runallcellsabove.palette",se.RunCellAndAllBelowPalette="jupyter.runcurrentcellandallbelow.palette",se.RunToLine="jupyter.runtoline",se.RunFromLine="jupyter.runfromline",se.RunCell="jupyter.runcell",se.RunCurrentCell="jupyter.runcurrentcell",se.RunCurrentCellAdvance="jupyter.runcurrentcelladvance",se.CreateNewInteractive="jupyter.createnewinteractive",se.ImportNotebookFile="jupyter.importnotebookfile",se.ExportFileAsNotebook="jupyter.exportfileasnotebook",se.InterruptKernel="jupyter.interruptkernel",se.RestartKernel="jupyter.restartkernel",se.RestartKernelAndRunAllCells="jupyter.restartkernelandrunallcells",se.RestartKernelAndRunUpToSelectedCell="jupyter.restartkernelandrunuptoselectedcell",se.NotebookEditorRemoveAllCells="jupyter.notebookeditor.removeallcells",se.NotebookEditorRunAllCells="jupyter.notebookeditor.runallcells",se.NotebookEditorRunSelectedCell="jupyter.notebookeditor.runselectedcell",se.NotebookEditorAddCellBelow="jupyter.notebookeditor.addcellbelow",se.ExpandAllCells="jupyter.expandallcells",se.CollapseAllCells="jupyter.collapseallcells",se.ExecSelectionInInteractiveWindow="jupyter.execSelectionInteractive",se.RunFileInInteractiveWindows="jupyter.runFileInteractive",se.DebugFileInInteractiveWindows="jupyter.debugFileInteractive",se.AddCellBelow="jupyter.addcellbelow",se.DebugCurrentCellPalette="jupyter.debugcurrentcell.palette",se.DebugCell="jupyter.debugcell",se.DebugStepOver="jupyter.debugstepover",se.DebugContinue="jupyter.debugcontinue",se.DebugStop="jupyter.debugstop",se.RunCurrentCellAndAddBelow="jupyter.runcurrentcellandaddbelow",se.InsertCellBelowPosition="jupyter.insertCellBelowPosition",se.InsertCellBelow="jupyter.insertCellBelow",se.InsertCellAbove="jupyter.insertCellAbove",se.DeleteCells="jupyter.deleteCells",se.SelectCell="jupyter.selectCell",se.SelectCellContents="jupyter.selectCellContents",se.ExtendSelectionByCellAbove="jupyter.extendSelectionByCellAbove",se.ExtendSelectionByCellBelow="jupyter.extendSelectionByCellBelow",se.MoveCellsUp="jupyter.moveCellsUp",se.MoveCellsDown="jupyter.moveCellsDown",se.ChangeCellToMarkdown="jupyter.changeCellToMarkdown",se.ChangeCellToCode="jupyter.changeCellToCode",se.GotoNextCellInFile="jupyter.gotoNextCellInFile",se.GotoPrevCellInFile="jupyter.gotoPrevCellInFile",se.ScrollToCell="jupyter.scrolltocell",se.CreateNewNotebook="jupyter.createnewnotebook",se.ViewJupyterOutput="jupyter.viewOutput",se.ExportAsPythonScript="jupyter.exportAsPythonScript",se.ExportToHTML="jupyter.exportToHTML",se.ExportToPDF="jupyter.exportToPDF",se.Export="jupyter.export",se.NativeNotebookExport="jupyter.notebookeditor.export",se.LatestExtension="jupyter.latestExtension",se.EnableLoadingWidgetsFrom3rdPartySource="jupyter.enableLoadingWidgetScriptsFromThirdPartySource",se.ShowDataViewer="jupyter.showDataViewer",se.ShowJupyterDataViewer="jupyter.showJupyterDataViewer",se.RefreshDataViewer="jupyter.refreshDataViewer",se.ClearSavedJupyterUris="jupyter.clearSavedJupyterUris",se.OpenVariableView="jupyter.openVariableView",se.OpenOutlineView="jupyter.openOutlineView",se.InteractiveClearAll="jupyter.interactive.clearAllCells",se.InteractiveGoToCode="jupyter.interactive.goToCode",se.InteractiveCopyCell="jupyter.interactive.copyCell",se.InteractiveExportAsNotebook="jupyter.interactive.exportasnotebook",se.InteractiveExportAs="jupyter.interactive.exportas",se.RunByLine="jupyter.runByLine",se.RunAndDebugCell="jupyter.runAndDebugCell",se.RunByLineNext="jupyter.runByLineNext",se.RunByLineStop="jupyter.runByLineStop",se.ReplayPylanceLog="jupyter.replayPylanceLog",se.ReplayPylanceLogStep="jupyter.replayPylanceLogStep",se.InstallPythonExtensionViaKernelPicker="jupyter.installPythonExtensionViaKernelPicker",se.InstallPythonViaKernelPicker="jupyter.installPythonViaKernelPicker",se.ContinueEditSessionInCodespace="jupyter.continueEditSessionInCodespace"))(J||={});var od;(r=>(r.DefaultDesignLenses=[J.RunCurrentCell,J.RunAllCellsAbove,J.DebugCell],r.DefaultDebuggingLenses=[J.DebugContinue,J.DebugStop,J.DebugStepOver],r.DebuggerCommands=[J.DebugContinue,J.DebugStop,J.DebugStepOver]))(od||={});var Cr;(ae=>(ae.HasCodeCells="jupyter.hascodecells",ae.IsInteractiveActive="jupyter.isinteractiveactive",ae.OwnsSelection="jupyter.ownsSelection",ae.HaveNativeCells="jupyter.havenativecells",ae.HaveNative="jupyter.havenative",ae.IsNativeActive="jupyter.isnativeactive",ae.IsInteractiveOrNativeActive="jupyter.isinteractiveornativeactive",ae.IsPythonOrNativeActive="jupyter.ispythonornativeactive",ae.IsPythonOrInteractiveActive="jupyter.ispythonorinteractiveeactive",ae.IsPythonOrInteractiveOrNativeActive="jupyter.ispythonorinteractiveornativeeactive",ae.CanRestartNotebookKernel="jupyter.notebookeditor.canrestartNotebookkernel",ae.CanInterruptNotebookKernel="jupyter.notebookeditor.canInterruptNotebookKernel",ae.CanRestartInteractiveWindowKernel="jupyter.interactive.canRestartNotebookKernel",ae.CanInterruptInteractiveWindowKernel="jupyter.interactive.canInterruptNotebookKernel",ae.RunByLineCells="jupyter.notebookeditor.runByLineCells",ae.RunByLineDocuments="jupyter.notebookeditor.runByLineDocuments",ae.DebugDocuments="jupyter.notebookeditor.debugDocuments",ae.IsPythonNotebook="jupyter.ispythonnotebook",ae.IsJupyterKernelSelected="jupyter.kernel.isjupyter",ae.IsDataViewerActive="jupyter.dataViewerActive",ae.HasNativeNotebookOrInteractiveWindowOpen="jupyter.hasNativeNotebookOrInteractiveWindowOpen",ae.ZmqAvailable="jupyter.zmqavailable",ae.ReplayLogLoaded="jupyter.replayLogLoaded",ae.KernelSource="jupyter.kernelSource"))(Cr||={});var mm;(l=>(l.PythonCellMarker=/^(#\s*%%|#\s*\<codecell\>|#\s*In\[\d*?\]|#\s*In\[ \])/,l.PythonMarkdownCellMarker=/^(#\s*%%\s*\[markdown\]|#\s*\<markdowncell\>)/,l.UrlPatternRegEx="(?<PREFIX>https?:\\/\\/)((\\(.+\\s+or\\s+(?<IP>.+)\\))|(?<LOCAL>[^\\s]+))(?<REST>:.+)",l.HttpPattern=/https?:\/\//,l.ShapeSplitterRegEx=/.*,\s*(\d+).*/,l.SvgHeightRegex=/(\<svg.*height=\")(.*?)\"/,l.SvgWidthRegex=/(\<svg.*width=\")(.*?)\"/,l.SvgSizeTagRegex=/\<svg.*tag=\"sizeTag=\{(.*),\s*(.*)\}\"/))(mm||={});var kW=Symbol("DataScienceStartupTime"),xA={major:4,minor:2},zi="application/vnd.jupyter.widget-view+json";var pC=8,Rh="unknown";var fC=class{constructor(e,t){this._data=t;this.expiryTime=e+Date.now()}get expired(){let e=this.expiryTime<=Date.now();return e&&(this._data=void 0),e}get data(){return this.expired&&(this._data=void 0),this._data}},mC=new Map;function xW(){return mC}function DW(n,e){let t=e.map(r=>`${JSON.stringify(r)}`).join("-Arg-Separator-");return`KeyPrefix=${n}-Args=${t}`}var fm=class{constructor(e,t=""){this.expiryDurationMs=e;this.cacheKey=t}get hasData(){let e=mC.get(this.cacheKey);return!!(e&&!e.expired)}get data(){return this.hasData?mC.get(this.cacheKey)?.data:void 0}set data(e){let t=new fC(this.expiryDurationMs,e);mC.set(this.cacheKey,t)}clear(){mC.delete(this.cacheKey)}};var _W=Symbol("MicrotaskDelay");async function Hn(n){return new Promise(e=>{setTimeout(()=>e(n),n)})}async function kP(n,e,t){return new Promise(r=>{let i,o=setTimeout(()=>i(!1),e),s=setInterval(()=>{n().then(a=>{a&&i(!0)}).catch(a=>i(!1))},t);i=a=>{clearTimeout(o),clearInterval(s),r(a)}})}function Bt(n,e,...t){let r=PP(e)?void 0:e;PP(e)&&t.push(e);let i,o=setTimeout(()=>i?.(r),n);return Promise.race([Promise.race(t).finally(()=>clearTimeout(o)),new Promise(s=>i=s)])}function Nh(n,e,...t){let r,i=setTimeout(()=>r?.(e),n);return Promise.race([Promise.race(t).finally(()=>clearTimeout(i)),new Promise((o,s)=>r=s)])}function sd(n){return typeof n?.then=="function"&&typeof n?.catch=="function"}function PP(n){return typeof n?.then=="function"}var DA=class{constructor(e=null){this.scope=e;this._resolved=!1;this._rejected=!1;this._promise=new Promise((t,r)=>{this._resolve=t,this._reject=r})}get value(){return this._value}resolve(e){this._value=e,this._resolve.apply(this.scope?this.scope:this,arguments),this._resolved=!0}reject(e){this._reject.apply(this.scope?this.scope:this,arguments),this._rejected=!0}get promise(){return this._promise}get resolved(){return this._resolved}get rejected(){return this._rejected}get completed(){return this._rejected||this._resolved}};function ne(n=null){return new DA(n)}function so(n){let e=ne();return n.then(e.resolve.bind(e)).catch(e.reject.bind(e)),e}var Ah=class{constructor(){this.currentPromise=Promise.resolve(void 0)}async chain(e){let t=ne(),r=this.currentPromise;return this.currentPromise=this.currentPromise.then(async()=>{try{let i=await e();t.resolve(i)}catch(i){throw t.reject(i),i}}),await r,t.promise}chainFinally(e){let t=ne();return this.currentPromise=this.currentPromise.finally(()=>e().then(r=>t.resolve(r)).catch(r=>t.reject(r))),t.promise}};var iZ=(n,e)=>{let t=!0,r=setTimeout(()=>{t=!1,e()},n);return{isTriggered:()=>t,dispose:()=>{clearTimeout(r),t=!1}}},oZ=n=>{let e=!0;return queueMicrotask(()=>{e&&(e=!1,n())}),{isTriggered:()=>e,dispose:()=>{e=!1}}},bs=class{constructor(e){this.defaultDelay=e;this.deferred=null,this.completionPromise=null,this.doResolve=null,this.doReject=null,this.task=null}trigger(e,t=this.defaultDelay){this.task=e,this.cancelTimeout(),this.completionPromise||(this.completionPromise=new Promise((i,o)=>{this.doResolve=i,this.doReject=o}).then(()=>{if(this.completionPromise=null,this.doResolve=null,this.task){let i=this.task;return this.task=null,i()}}),this.completionPromise.catch(h));let r=()=>{this.deferred=null,this.doResolve?.(null)};return this.deferred=t===_W?oZ(r):iZ(t,r),this.completionPromise}isTriggered(){return!!this.deferred?.isTriggered()}cancel(){this.cancelTimeout(),this.completionPromise&&(this.doReject?.(new Error("Canceled")),this.completionPromise=null)}cancelTimeout(){this.deferred?.dispose(),this.deferred=null}dispose(){this.cancel()}};function h(){}function ci(n){try{let e=n();sd(e)&&e.catch(h)}catch{}}function ad(n){if(!n)return!0;let e=n;return typeof e.path=="string"&&typeof e.scheme=="string"}function Gn(n){if(!n)return!1;let e=n;return typeof e.path=="string"&&typeof e.scheme=="string"}function RW(n){let e=Gn(n)?n:n.uri;return e.scheme.includes(ca)||e.path.endsWith(".interactive")}function ol(){return process.platform.toString()==="web"||process.browser===!0}function TW(n,e){return Gn(e)?e.toString():e}function ua(n,e){return n===e?!0:n&&!e||!n&&e?!1:JSON.stringify(n,TW)===JSON.stringify(e,TW)}var Me=class{constructor(){this.started=Date.now()}get elapsedTime(){return Date.now()-this.started}reset(){this.started=Date.now()}};var AW=xW();function _A(n){return function(e,t,r){let i=r.value,s=`Cache_Method_Output_${"constructor"in e&&e.constructor.name?e.constructor.name:""}.${t}`;r.value=async function(...a){if(Rr())return i.apply(this,a);let l=DW(s,a),c=AW.get(l);if(c&&!c.expired)return p.debug(`Cached data exists ${l}`),Promise.resolve(c.data);let u=i.apply(this,a);return u.then(d=>AW.set(l,new fC(n,d))).catch(h),u}}}function Yr(n){return function(e,t,r){let i=r.value,o=`Jupyter Extension (Error in ${n||t}, method:${t}):`;r.value=function(...s){try{let a=i.apply(this,s);if(a&&typeof a.then=="function"&&typeof a.catch=="function")return a.catch(l=>{Rr()||p.error(o,l)})}catch(a){if(Rr())return;p.error(o,a)}}}}function sZ(n,e,t){let r=new Me;try{t&&n(void 0);let i=e();return sd(i)?i.then(o=>(n({elapsed:r.elapsedTime,returnValue:o}),o)).catch(o=>{n({elapsed:r.elapsedTime,err:o})}):n({elapsed:r.elapsedTime,returnValue:i}),i}catch(i){throw n({elapsed:r.elapsedTime,err:i}),i}}function NW(n,e){return function(t,r,i){let o=i.value;return i.value=function(...s){let a={kind:"Class",name:t&&t.constructor?t.constructor.name:"",args:s,methodName:r,target:t},l=this;return sZ(c=>n(a,c),()=>o.apply(l,s),e)},i}}function Mh(){return function(n,e,t){let r=t.value;return t.value=function(...i){if(!Rr())throw new Error(`Function: ${e} can only be called from test code`);return r.apply(this,i)},t}}function TA(){return function(n,e,t){let r=t.value,i=`chainedPromiseFor_${e}`;return t.value=async function(...o){let s=this[i];s?s=s.then(()=>r.apply(this,o)):s=r.apply(this,o),this[i]=s;let a=s.then(l=>l).catch(l=>{throw this[i]=void 0,l});return a.catch(h),a},t}}function RA(n,e){if(Array.isArray(n))return n.map(t=>RA(t,e)).join(", ");if(n===void 0)return"undefined";if(n===null)return"null";try{return n&&n.path?`<Uri:${n.path}>`:JSON.stringify(n)}catch{return`<${e} cannot be serialized for logging>`}}function AA(n){if(!n)return"";try{return n.map((t,r)=>{let i=RA(t,"argument");return`Arg ${r+1}: ${i}`}).join(", ")}catch{return""}}function MW(n){return`Return Value: ${RA(n,"Return value")}`}function xP(){let n=new Date,e=String(n.getHours()).padStart(2,"0"),t=String(n.getMinutes()).padStart(2,"0"),r=String(n.getSeconds()).padStart(2,"0"),i=String(n.getMilliseconds()).padStart(3,"0");return`${e}:${t}:${r}.${i}`}function Be(n,e={removeEmptyEntries:!0,trim:!0}){n=n||"";let t=n.split(/\r?\n/g);return e&&e.trim&&(t=t.map(r=>r.trim())),e&&e.removeEmptyEntries&&(t=t.filter(r=>r.length>0)),t}function hC(n){return n&&(n.indexOf(" ")>=0&&!n.startsWith('"')&&!n.endsWith('"')?`"${n}"`:n.toString())}function gC(n){return n&&hC(n).replace(/\\/g,"/")}function hm(n){return n&&n.replace(/(^['"])|(['"]$)/g,"")}function vC(n,...e){return n.replace(/{(\d+)}/g,(t,r)=>e[r]===void 0?t:e[r])}function Kh(n){return n?n.replace(/\$\([a-z0-9\-]+?\)/gi,"").trim():n||""}function Oh(n){let e=n.split(`
`),t=e.find(r=>r.trim().length>0&&!r.trim().startsWith("#"));if(t){let r=t.match(/^\s*/)[0];return e.map(i=>i.startsWith(r)?i.replace(r,""):i).join(`
`)}return n}var VA=require("vscode");var _P="en",RP=!1,AP=!1,yC=!1,aZ=!1,lZ=!1,MA=!1,cZ=!1,uZ=!1,dZ=!1,DP,TP=_P,pZ,cd,Is=typeof self=="object"?self:typeof global=="object"?global:{},Wo;typeof Is.vscode<"u"&&typeof Is.vscode.process<"u"?Wo=Is.vscode.process:typeof process<"u"&&typeof process?.versions?.node=="string"&&(Wo=process);var KW=typeof Wo?.versions?.electron=="string",mZ=KW&&Wo?.type==="renderer";if(typeof Wo=="object"){RP=Wo.platform==="win32",AP=Wo.platform==="darwin",yC=Wo.platform==="linux",aZ=yC&&!!Wo.env.SNAP&&!!Wo.env.SNAP_REVISION,cZ=KW,dZ=!!Wo.env.CI||!!Wo.env.BUILD_ARTIFACTSTAGINGDIRECTORY,DP=_P,TP=_P;let n=Wo.env.VSCODE_NLS_CONFIG;if(n)try{let e=JSON.parse(n),t=e.availableLanguages["*"];DP=e.locale,TP=t||_P,pZ=e._translationsConfigFile}catch{}lZ=!0}else typeof navigator=="object"&&!mZ?(cd=navigator.userAgent,RP=cd.indexOf("Windows")>=0,AP=cd.indexOf("Macintosh")>=0,uZ=(cd.indexOf("Macintosh")>=0||cd.indexOf("iPad")>=0||cd.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,yC=cd.indexOf("Linux")>=0,MA=!0,DP=navigator.language,TP=DP):console.error("Unable to resolve platform.");var NA=0;AP?NA=1:RP?NA=3:yC&&(NA=2);var bC=RP,OW=AP,FW=yC;var NP=MA,qge=MA&&typeof Is.importScripts=="function";var sl=cd,ld=TP,fZ;(r=>{function n(){return ld}r.value=n;function e(){return ld.length===2?ld==="en":ld.length>=3?ld[0]==="e"&&ld[1]==="n"&&ld[2]==="-":!1}r.isDefaultVariant=e;function t(){return ld==="en"}r.isDefault=t})(fZ||={});var Hge=(()=>{if(typeof Is.postMessage=="function"&&!Is.importScripts){let n=[];Is.addEventListener("message",t=>{if(t.data&&t.data.vscodeScheduleAsyncWork)for(let r=0,i=n.length;r<i;r++){let o=n[r];if(o.id===t.data.vscodeScheduleAsyncWork){n.splice(r,1),o.callback();return}}});let e=0;return t=>{let r=++e;n.push({id:r,callback:t}),Is.postMessage({vscodeScheduleAsyncWork:r},"*")}}return n=>setTimeout(n)})();var hZ=!!(sl&&sl.indexOf("Chrome")>=0),Gge=!!(sl&&sl.indexOf("Firefox")>=0),zge=!!(!hZ&&sl&&sl.indexOf("Safari")>=0),Qge=!!(sl&&sl.indexOf("Edg/")>=0),Yge=!!(sl&&sl.indexOf("Android")>=0);var gm;if(typeof Is.vscode<"u"&&typeof Is.vscode.process<"u"){let n=Is.vscode.process;gm={get platform(){return n.platform},get arch(){return n.arch},get env(){return n.env},cwd(){return n.cwd()}}}else typeof process<"u"?gm={get platform(){return process.platform},get arch(){return process.arch},get env(){return process.env},cwd(){return process.env.VSCODE_CWD||process.cwd()}}:gm={get platform(){return bC?"win32":OW?"darwin":"linux"},get arch(){},get env(){return{}},cwd(){return"/"}};var MP=gm.cwd,LW=gm.env,ao=gm.platform,tve=gm.arch;var vZ=65,yZ=97,bZ=90,IZ=122,pd=46,zn=47,lo=92,ud=58,SZ=63,KP=class extends Error{constructor(e,t,r){let i;typeof t=="string"&&t.indexOf("not ")===0?(i="must not be",t=t.replace(/^not /,"")):i="must be";let o=e.indexOf(".")!==-1?"property":"argument",s=`The "${e}" ${o} ${i} of type ${t}`;s+=`. Received type ${typeof r}`,super(s),this.code="ERR_INVALID_ARG_TYPE"}};function pn(n,e){if(typeof n!="string")throw new KP(e,"string",n)}function Tt(n){return n===zn||n===lo}function KA(n){return n===zn}function dd(n){return n>=vZ&&n<=bZ||n>=yZ&&n<=IZ}function OP(n,e,t,r){let i="",o=0,s=-1,a=0,l=0;for(let c=0;c<=n.length;++c){if(c<n.length)l=n.charCodeAt(c);else{if(r(l))break;l=zn}if(r(l)){if(!(s===c-1||a===1))if(a===2){if(i.length<2||o!==2||i.charCodeAt(i.length-1)!==pd||i.charCodeAt(i.length-2)!==pd){if(i.length>2){let u=i.lastIndexOf(t);u===-1?(i="",o=0):(i=i.slice(0,u),o=i.length-1-i.lastIndexOf(t)),s=c,a=0;continue}else if(i.length!==0){i="",o=0,s=c,a=0;continue}}e&&(i+=i.length>0?`${t}..`:"..",o=2)}else i.length>0?i+=`${t}${n.slice(s+1,c)}`:i=n.slice(s+1,c),o=c-s-1;s=c,a=0}else l===pd&&a!==-1?++a:a=-1}return i}function UW(n,e){if(e===null||typeof e!="object")throw new KP("pathObject","Object",e);let t=e.dir||e.root,r=e.base||`${e.name||""}${e.ext||""}`;return t?t===e.root?`${t}${r}`:`${t}${n}${r}`:r}var Sn={resolve(...n){let e="",t="",r=!1;for(let i=n.length-1;i>=-1;i--){let o;if(i>=0){if(o=n[i],pn(o,"path"),o.length===0)continue}else e.length===0?o=MP():(o=LW[`=${e}`]||MP(),(o===void 0||o.slice(0,2).toLowerCase()!==e.toLowerCase()&&o.charCodeAt(2)===lo)&&(o=`${e}\\`));let s=o.length,a=0,l="",c=!1,u=o.charCodeAt(0);if(s===1)Tt(u)&&(a=1,c=!0);else if(Tt(u))if(c=!0,Tt(o.charCodeAt(1))){let d=2,f=d;for(;d<s&&!Tt(o.charCodeAt(d));)d++;if(d<s&&d!==f){let g=o.slice(f,d);for(f=d;d<s&&Tt(o.charCodeAt(d));)d++;if(d<s&&d!==f){for(f=d;d<s&&!Tt(o.charCodeAt(d));)d++;(d===s||d!==f)&&(l=`\\\\${g}\\${o.slice(f,d)}`,a=d)}}}else a=1;else dd(u)&&o.charCodeAt(1)===ud&&(l=o.slice(0,2),a=2,s>2&&Tt(o.charCodeAt(2))&&(c=!0,a=3));if(l.length>0)if(e.length>0){if(l.toLowerCase()!==e.toLowerCase())continue}else e=l;if(r){if(e.length>0)break}else if(t=`${o.slice(a)}\\${t}`,r=c,c&&e.length>0)break}return t=OP(t,!r,"\\",Tt),r?`${e}\\${t}`:`${e}${t}`||"."},normalize(n){pn(n,"path");let e=n.length;if(e===0)return".";let t=0,r,i=!1,o=n.charCodeAt(0);if(e===1)return KA(o)?"\\":n;if(Tt(o))if(i=!0,Tt(n.charCodeAt(1))){let a=2,l=a;for(;a<e&&!Tt(n.charCodeAt(a));)a++;if(a<e&&a!==l){let c=n.slice(l,a);for(l=a;a<e&&Tt(n.charCodeAt(a));)a++;if(a<e&&a!==l){for(l=a;a<e&&!Tt(n.charCodeAt(a));)a++;if(a===e)return`\\\\${c}\\${n.slice(l)}\\`;a!==l&&(r=`\\\\${c}\\${n.slice(l,a)}`,t=a)}}}else t=1;else dd(o)&&n.charCodeAt(1)===ud&&(r=n.slice(0,2),t=2,e>2&&Tt(n.charCodeAt(2))&&(i=!0,t=3));let s=t<e?OP(n.slice(t),!i,"\\",Tt):"";return s.length===0&&!i&&(s="."),s.length>0&&Tt(n.charCodeAt(e-1))&&(s+="\\"),r===void 0?i?`\\${s}`:s:i?`${r}\\${s}`:`${r}${s}`},isAbsolute(n){pn(n,"path");let e=n.length;if(e===0)return!1;let t=n.charCodeAt(0);return Tt(t)||e>2&&dd(t)&&n.charCodeAt(1)===ud&&Tt(n.charCodeAt(2))},join(...n){if(n.length===0)return".";let e,t;for(let o=0;o<n.length;++o){let s=n[o];pn(s,"path"),s.length>0&&(e===void 0?e=t=s:e+=`\\${s}`)}if(e===void 0)return".";let r=!0,i=0;if(typeof t=="string"&&Tt(t.charCodeAt(0))){++i;let o=t.length;o>1&&Tt(t.charCodeAt(1))&&(++i,o>2&&(Tt(t.charCodeAt(2))?++i:r=!1))}if(r){for(;i<e.length&&Tt(e.charCodeAt(i));)i++;i>=2&&(e=`\\${e.slice(i)}`)}return Sn.normalize(e)},relative(n,e){if(pn(n,"from"),pn(e,"to"),n===e)return"";let t=Sn.resolve(n),r=Sn.resolve(e);if(t===r||(n=t.toLowerCase(),e=r.toLowerCase(),n===e))return"";let i=0;for(;i<n.length&&n.charCodeAt(i)===lo;)i++;let o=n.length;for(;o-1>i&&n.charCodeAt(o-1)===lo;)o--;let s=o-i,a=0;for(;a<e.length&&e.charCodeAt(a)===lo;)a++;let l=e.length;for(;l-1>a&&e.charCodeAt(l-1)===lo;)l--;let c=l-a,u=s<c?s:c,d=-1,f=0;for(;f<u;f++){let b=n.charCodeAt(i+f);if(b!==e.charCodeAt(a+f))break;b===lo&&(d=f)}if(f!==u){if(d===-1)return r}else{if(c>u){if(e.charCodeAt(a+f)===lo)return r.slice(a+f+1);if(f===2)return r.slice(a+f)}s>u&&(n.charCodeAt(i+f)===lo?d=f:f===2&&(d=3)),d===-1&&(d=0)}let g="";for(f=i+d+1;f<=o;++f)(f===o||n.charCodeAt(f)===lo)&&(g+=g.length===0?"..":"\\..");return a+=d,g.length>0?`${g}${r.slice(a,l)}`:(r.charCodeAt(a)===lo&&++a,r.slice(a,l))},toNamespacedPath(n){if(typeof n!="string")return n;if(n.length===0)return"";let e=Sn.resolve(n);if(e.length<=2)return n;if(e.charCodeAt(0)===lo){if(e.charCodeAt(1)===lo){let t=e.charCodeAt(2);if(t!==SZ&&t!==pd)return`\\\\?\\UNC\\${e.slice(2)}`}}else if(dd(e.charCodeAt(0))&&e.charCodeAt(1)===ud&&e.charCodeAt(2)===lo)return`\\\\?\\${e}`;return n},dirname(n){pn(n,"path");let e=n.length;if(e===0)return".";let t=-1,r=0,i=n.charCodeAt(0);if(e===1)return Tt(i)?n:".";if(Tt(i)){if(t=r=1,Tt(n.charCodeAt(1))){let a=2,l=a;for(;a<e&&!Tt(n.charCodeAt(a));)a++;if(a<e&&a!==l){for(l=a;a<e&&Tt(n.charCodeAt(a));)a++;if(a<e&&a!==l){for(l=a;a<e&&!Tt(n.charCodeAt(a));)a++;if(a===e)return n;a!==l&&(t=r=a+1)}}}}else dd(i)&&n.charCodeAt(1)===ud&&(t=e>2&&Tt(n.charCodeAt(2))?3:2,r=t);let o=-1,s=!0;for(let a=e-1;a>=r;--a)if(Tt(n.charCodeAt(a))){if(!s){o=a;break}}else s=!1;if(o===-1){if(t===-1)return".";o=t}return n.slice(0,o)},basename(n,e){e!==void 0&&pn(e,"ext"),pn(n,"path");let t=0,r=-1,i=!0,o;if(n.length>=2&&dd(n.charCodeAt(0))&&n.charCodeAt(1)===ud&&(t=2),e!==void 0&&e.length>0&&e.length<=n.length){if(e===n)return"";let s=e.length-1,a=-1;for(o=n.length-1;o>=t;--o){let l=n.charCodeAt(o);if(Tt(l)){if(!i){t=o+1;break}}else a===-1&&(i=!1,a=o+1),s>=0&&(l===e.charCodeAt(s)?--s===-1&&(r=o):(s=-1,r=a))}return t===r?r=a:r===-1&&(r=n.length),n.slice(t,r)}for(o=n.length-1;o>=t;--o)if(Tt(n.charCodeAt(o))){if(!i){t=o+1;break}}else r===-1&&(i=!1,r=o+1);return r===-1?"":n.slice(t,r)},extname(n){pn(n,"path");let e=0,t=-1,r=0,i=-1,o=!0,s=0;n.length>=2&&n.charCodeAt(1)===ud&&dd(n.charCodeAt(0))&&(e=r=2);for(let a=n.length-1;a>=e;--a){let l=n.charCodeAt(a);if(Tt(l)){if(!o){r=a+1;break}continue}i===-1&&(o=!1,i=a+1),l===pd?t===-1?t=a:s!==1&&(s=1):t!==-1&&(s=-1)}return t===-1||i===-1||s===0||s===1&&t===i-1&&t===r+1?"":n.slice(t,i)},format:UW.bind(null,"\\"),parse(n){pn(n,"path");let e={root:"",dir:"",base:"",ext:"",name:""};if(n.length===0)return e;let t=n.length,r=0,i=n.charCodeAt(0);if(t===1)return Tt(i)?(e.root=e.dir=n,e):(e.base=e.name=n,e);if(Tt(i)){if(r=1,Tt(n.charCodeAt(1))){let d=2,f=d;for(;d<t&&!Tt(n.charCodeAt(d));)d++;if(d<t&&d!==f){for(f=d;d<t&&Tt(n.charCodeAt(d));)d++;if(d<t&&d!==f){for(f=d;d<t&&!Tt(n.charCodeAt(d));)d++;d===t?r=d:d!==f&&(r=d+1)}}}}else if(dd(i)&&n.charCodeAt(1)===ud){if(t<=2)return e.root=e.dir=n,e;if(r=2,Tt(n.charCodeAt(2))){if(t===3)return e.root=e.dir=n,e;r=3}}r>0&&(e.root=n.slice(0,r));let o=-1,s=r,a=-1,l=!0,c=n.length-1,u=0;for(;c>=r;--c){if(i=n.charCodeAt(c),Tt(i)){if(!l){s=c+1;break}continue}a===-1&&(l=!1,a=c+1),i===pd?o===-1?o=c:u!==1&&(u=1):o!==-1&&(u=-1)}return a!==-1&&(o===-1||u===0||u===1&&o===a-1&&o===s+1?e.base=e.name=n.slice(s,a):(e.name=n.slice(s,o),e.base=n.slice(s,a),e.ext=n.slice(o,a))),s>0&&s!==r?e.dir=n.slice(0,s-1):e.dir=e.root,e},sep:"\\",delimiter:";",win32:null,posix:null},Er={resolve(...n){let e="",t=!1;for(let r=n.length-1;r>=-1&&!t;r--){let i=r>=0?n[r]:MP();pn(i,"path"),i.length!==0&&(e=`${i}/${e}`,t=i.charCodeAt(0)===zn)}return e=OP(e,!t,"/",KA),t?`/${e}`:e.length>0?e:"."},normalize(n){if(pn(n,"path"),n.length===0)return".";let e=n.charCodeAt(0)===zn,t=n.charCodeAt(n.length-1)===zn;return n=OP(n,!e,"/",KA),n.length===0?e?"/":t?"./":".":(t&&(n+="/"),e?`/${n}`:n)},isAbsolute(n){return pn(n,"path"),n.length>0&&n.charCodeAt(0)===zn},join(...n){if(n.length===0)return".";let e;for(let t=0;t<n.length;++t){let r=n[t];pn(r,"path"),r.length>0&&(e===void 0?e=r:e+=`/${r}`)}return e===void 0?".":Er.normalize(e)},relative(n,e){if(pn(n,"from"),pn(e,"to"),n===e||(n=Er.resolve(n),e=Er.resolve(e),n===e))return"";let t=1,r=n.length,i=r-t,o=1,s=e.length-o,a=i<s?i:s,l=-1,c=0;for(;c<a;c++){let d=n.charCodeAt(t+c);if(d!==e.charCodeAt(o+c))break;d===zn&&(l=c)}if(c===a)if(s>a){if(e.charCodeAt(o+c)===zn)return e.slice(o+c+1);if(c===0)return e.slice(o+c)}else i>a&&(n.charCodeAt(t+c)===zn?l=c:c===0&&(l=0));let u="";for(c=t+l+1;c<=r;++c)(c===r||n.charCodeAt(c)===zn)&&(u+=u.length===0?"..":"/..");return`${u}${e.slice(o+l)}`},toNamespacedPath(n){return n},dirname(n){if(pn(n,"path"),n.length===0)return".";let e=n.charCodeAt(0)===zn,t=-1,r=!0;for(let i=n.length-1;i>=1;--i)if(n.charCodeAt(i)===zn){if(!r){t=i;break}}else r=!1;return t===-1?e?"/":".":e&&t===1?"//":n.slice(0,t)},basename(n,e){e!==void 0&&pn(e,"ext"),pn(n,"path");let t=0,r=-1,i=!0,o;if(e!==void 0&&e.length>0&&e.length<=n.length){if(e===n)return"";let s=e.length-1,a=-1;for(o=n.length-1;o>=0;--o){let l=n.charCodeAt(o);if(l===zn){if(!i){t=o+1;break}}else a===-1&&(i=!1,a=o+1),s>=0&&(l===e.charCodeAt(s)?--s===-1&&(r=o):(s=-1,r=a))}return t===r?r=a:r===-1&&(r=n.length),n.slice(t,r)}for(o=n.length-1;o>=0;--o)if(n.charCodeAt(o)===zn){if(!i){t=o+1;break}}else r===-1&&(i=!1,r=o+1);return r===-1?"":n.slice(t,r)},extname(n){pn(n,"path");let e=-1,t=0,r=-1,i=!0,o=0;for(let s=n.length-1;s>=0;--s){let a=n.charCodeAt(s);if(a===zn){if(!i){t=s+1;break}continue}r===-1&&(i=!1,r=s+1),a===pd?e===-1?e=s:o!==1&&(o=1):e!==-1&&(o=-1)}return e===-1||r===-1||o===0||o===1&&e===r-1&&e===t+1?"":n.slice(e,r)},format:UW.bind(null,"/"),parse(n){pn(n,"path");let e={root:"",dir:"",base:"",ext:"",name:""};if(n.length===0)return e;let t=n.charCodeAt(0)===zn,r;t?(e.root="/",r=1):r=0;let i=-1,o=0,s=-1,a=!0,l=n.length-1,c=0;for(;l>=r;--l){let u=n.charCodeAt(l);if(u===zn){if(!a){o=l+1;break}continue}s===-1&&(a=!1,s=l+1),u===pd?i===-1?i=l:c!==1&&(c=1):i!==-1&&(c=-1)}if(s!==-1){let u=o===0&&t?1:o;i===-1||c===0||c===1&&i===s-1&&i===o+1?e.base=e.name=n.slice(u,s):(e.name=n.slice(u,i),e.base=n.slice(u,s),e.ext=n.slice(i,s))}return o>0?e.dir=n.slice(0,o-1):t&&(e.dir="/"),e},sep:"/",delimiter:":",win32:null,posix:null};Er.win32=Sn.win32=Sn;Er.posix=Sn.posix=Er;var mn=ao==="win32"?Sn.normalize:Er.normalize,FP=ao==="win32"?Sn.isAbsolute:Er.isAbsolute,Ve=ao==="win32"?Sn.join:Er.join,WW=ao==="win32"?Sn.resolve:Er.resolve,LP=ao==="win32"?Sn.relative:Er.relative,it=ao==="win32"?Sn.dirname:Er.dirname,Ce=ao==="win32"?Sn.basename:Er.basename,Qi=ao==="win32"?Sn.extname:Er.extname,rve=ao==="win32"?Sn.format:Er.format,VW=ao==="win32"?Sn.parse:Er.parse,nve=ao==="win32"?Sn.toNamespacedPath:Er.toNamespacedPath,vn=ao==="win32"?Sn.sep:Er.sep,Qn=ao==="win32"?Sn.delimiter:Er.delimiter;var SC=require("vscode");var CZ=require("vscode");var UP=class{constructor(e){this.computeFn=e;this.lastCache=void 0;this.lastArgKey=void 0}get(e){let t=JSON.stringify(e);return this.lastArgKey!==t&&(this.lastArgKey=t,this.lastCache=this.computeFn(e)),this.lastCache}};var IC=class n{constructor(e){this.executor=e;this._didRun=!1}hasValue(){return this._didRun}getValue(){if(!this._didRun)try{this._value=this.executor()}catch(e){this._error=e}finally{this._didRun=!0}if(this._error)throw this._error;return this._value}get rawValue(){return this._value}map(e){return new n(()=>e(this.getValue()))}};function qW(n,e){return n<e?-1:n>e?1:0}function EZ(n,e,t=0,r=n.length,i=0,o=e.length){for(;t<r&&i<o;t++,i++){let l=n.charCodeAt(t),c=e.charCodeAt(i);if(l<c)return-1;if(l>c)return 1}let s=r-t,a=o-i;return s<a?-1:s>a?1:0}function HW(n,e,t=0,r=n.length,i=0,o=e.length){for(;t<r&&i<o;t++,i++){let l=n.charCodeAt(t),c=e.charCodeAt(i);if(l===c)continue;if(l>=128||c>=128)return EZ(n.toLowerCase(),e.toLowerCase(),t,r,i,o);jW(l)&&(l-=32),jW(c)&&(c-=32);let u=l-c;if(u!==0)return u}let s=r-t,a=o-i;return s<a?-1:s>a?1:0}function jW(n){return n>=97&&n<=122}function GW(n,e){return n.length===e.length&&HW(n,e)===0}function zW(n,e){let t=e.length;return e.length>n.length?!1:HW(n,e,0,t)===0}var BW=class n{constructor(e){this.confusableDictionary=e}static{this.ambiguousCharacterData=new IC(()=>JSON.parse('{"_common":[8232,32,8233,32,5760,32,8192,32,8193,32,8194,32,8195,32,8196,32,8197,32,8198,32,8200,32,8201,32,8202,32,8287,32,8199,32,8239,32,2042,95,65101,95,65102,95,65103,95,8208,45,8209,45,8210,45,65112,45,1748,45,8259,45,727,45,8722,45,10134,45,11450,45,1549,44,1643,44,8218,44,184,44,42233,44,894,59,2307,58,2691,58,1417,58,1795,58,1796,58,5868,58,65072,58,6147,58,6153,58,8282,58,1475,58,760,58,42889,58,8758,58,720,58,42237,58,451,33,11601,33,660,63,577,63,2429,63,5038,63,42731,63,119149,46,8228,46,1793,46,1794,46,42510,46,68176,46,1632,46,1776,46,42232,46,1373,96,65287,96,8219,96,8242,96,1370,96,1523,96,8175,96,65344,96,900,96,8189,96,8125,96,8127,96,8190,96,697,96,884,96,712,96,714,96,715,96,756,96,699,96,701,96,700,96,702,96,42892,96,1497,96,2036,96,2037,96,5194,96,5836,96,94033,96,94034,96,65339,91,10088,40,10098,40,12308,40,64830,40,65341,93,10089,41,10099,41,12309,41,64831,41,10100,123,119060,123,10101,125,65342,94,8270,42,1645,42,8727,42,66335,42,5941,47,8257,47,8725,47,8260,47,9585,47,10187,47,10744,47,119354,47,12755,47,12339,47,11462,47,20031,47,12035,47,65340,92,65128,92,8726,92,10189,92,10741,92,10745,92,119311,92,119355,92,12756,92,20022,92,12034,92,42872,38,708,94,710,94,5869,43,10133,43,66203,43,8249,60,10094,60,706,60,119350,60,5176,60,5810,60,5120,61,11840,61,12448,61,42239,61,8250,62,10095,62,707,62,119351,62,5171,62,94015,62,8275,126,732,126,8128,126,8764,126,65372,124,65293,45,120784,50,120794,50,120804,50,120814,50,120824,50,130034,50,42842,50,423,50,1000,50,42564,50,5311,50,42735,50,119302,51,120785,51,120795,51,120805,51,120815,51,120825,51,130035,51,42923,51,540,51,439,51,42858,51,11468,51,1248,51,94011,51,71882,51,120786,52,120796,52,120806,52,120816,52,120826,52,130036,52,5070,52,71855,52,120787,53,120797,53,120807,53,120817,53,120827,53,130037,53,444,53,71867,53,120788,54,120798,54,120808,54,120818,54,120828,54,130038,54,11474,54,5102,54,71893,54,119314,55,120789,55,120799,55,120809,55,120819,55,120829,55,130039,55,66770,55,71878,55,2819,56,2538,56,2666,56,125131,56,120790,56,120800,56,120810,56,120820,56,120830,56,130040,56,547,56,546,56,66330,56,2663,57,2920,57,2541,57,3437,57,120791,57,120801,57,120811,57,120821,57,120831,57,130041,57,42862,57,11466,57,71884,57,71852,57,71894,57,9082,97,65345,97,119834,97,119886,97,119938,97,119990,97,120042,97,120094,97,120146,97,120198,97,120250,97,120302,97,120354,97,120406,97,120458,97,593,97,945,97,120514,97,120572,97,120630,97,120688,97,120746,97,65313,65,119808,65,119860,65,119912,65,119964,65,120016,65,120068,65,120120,65,120172,65,120224,65,120276,65,120328,65,120380,65,120432,65,913,65,120488,65,120546,65,120604,65,120662,65,120720,65,5034,65,5573,65,42222,65,94016,65,66208,65,119835,98,119887,98,119939,98,119991,98,120043,98,120095,98,120147,98,120199,98,120251,98,120303,98,120355,98,120407,98,120459,98,388,98,5071,98,5234,98,5551,98,65314,66,8492,66,119809,66,119861,66,119913,66,120017,66,120069,66,120121,66,120173,66,120225,66,120277,66,120329,66,120381,66,120433,66,42932,66,914,66,120489,66,120547,66,120605,66,120663,66,120721,66,5108,66,5623,66,42192,66,66178,66,66209,66,66305,66,65347,99,8573,99,119836,99,119888,99,119940,99,119992,99,120044,99,120096,99,120148,99,120200,99,120252,99,120304,99,120356,99,120408,99,120460,99,7428,99,1010,99,11429,99,43951,99,66621,99,128844,67,71922,67,71913,67,65315,67,8557,67,8450,67,8493,67,119810,67,119862,67,119914,67,119966,67,120018,67,120174,67,120226,67,120278,67,120330,67,120382,67,120434,67,1017,67,11428,67,5087,67,42202,67,66210,67,66306,67,66581,67,66844,67,8574,100,8518,100,119837,100,119889,100,119941,100,119993,100,120045,100,120097,100,120149,100,120201,100,120253,100,120305,100,120357,100,120409,100,120461,100,1281,100,5095,100,5231,100,42194,100,8558,68,8517,68,119811,68,119863,68,119915,68,119967,68,120019,68,120071,68,120123,68,120175,68,120227,68,120279,68,120331,68,120383,68,120435,68,5024,68,5598,68,5610,68,42195,68,8494,101,65349,101,8495,101,8519,101,119838,101,119890,101,119942,101,120046,101,120098,101,120150,101,120202,101,120254,101,120306,101,120358,101,120410,101,120462,101,43826,101,1213,101,8959,69,65317,69,8496,69,119812,69,119864,69,119916,69,120020,69,120072,69,120124,69,120176,69,120228,69,120280,69,120332,69,120384,69,120436,69,917,69,120492,69,120550,69,120608,69,120666,69,120724,69,11577,69,5036,69,42224,69,71846,69,71854,69,66182,69,119839,102,119891,102,119943,102,119995,102,120047,102,120099,102,120151,102,120203,102,120255,102,120307,102,120359,102,120411,102,120463,102,43829,102,42905,102,383,102,7837,102,1412,102,119315,70,8497,70,119813,70,119865,70,119917,70,120021,70,120073,70,120125,70,120177,70,120229,70,120281,70,120333,70,120385,70,120437,70,42904,70,988,70,120778,70,5556,70,42205,70,71874,70,71842,70,66183,70,66213,70,66853,70,65351,103,8458,103,119840,103,119892,103,119944,103,120048,103,120100,103,120152,103,120204,103,120256,103,120308,103,120360,103,120412,103,120464,103,609,103,7555,103,397,103,1409,103,119814,71,119866,71,119918,71,119970,71,120022,71,120074,71,120126,71,120178,71,120230,71,120282,71,120334,71,120386,71,120438,71,1292,71,5056,71,5107,71,42198,71,65352,104,8462,104,119841,104,119945,104,119997,104,120049,104,120101,104,120153,104,120205,104,120257,104,120309,104,120361,104,120413,104,120465,104,1211,104,1392,104,5058,104,65320,72,8459,72,8460,72,8461,72,119815,72,119867,72,119919,72,120023,72,120179,72,120231,72,120283,72,120335,72,120387,72,120439,72,919,72,120494,72,120552,72,120610,72,120668,72,120726,72,11406,72,5051,72,5500,72,42215,72,66255,72,731,105,9075,105,65353,105,8560,105,8505,105,8520,105,119842,105,119894,105,119946,105,119998,105,120050,105,120102,105,120154,105,120206,105,120258,105,120310,105,120362,105,120414,105,120466,105,120484,105,618,105,617,105,953,105,8126,105,890,105,120522,105,120580,105,120638,105,120696,105,120754,105,1110,105,42567,105,1231,105,43893,105,5029,105,71875,105,65354,106,8521,106,119843,106,119895,106,119947,106,119999,106,120051,106,120103,106,120155,106,120207,106,120259,106,120311,106,120363,106,120415,106,120467,106,1011,106,1112,106,65322,74,119817,74,119869,74,119921,74,119973,74,120025,74,120077,74,120129,74,120181,74,120233,74,120285,74,120337,74,120389,74,120441,74,42930,74,895,74,1032,74,5035,74,5261,74,42201,74,119844,107,119896,107,119948,107,120000,107,120052,107,120104,107,120156,107,120208,107,120260,107,120312,107,120364,107,120416,107,120468,107,8490,75,65323,75,119818,75,119870,75,119922,75,119974,75,120026,75,120078,75,120130,75,120182,75,120234,75,120286,75,120338,75,120390,75,120442,75,922,75,120497,75,120555,75,120613,75,120671,75,120729,75,11412,75,5094,75,5845,75,42199,75,66840,75,1472,108,8739,73,9213,73,65512,73,1633,108,1777,73,66336,108,125127,108,120783,73,120793,73,120803,73,120813,73,120823,73,130033,73,65321,73,8544,73,8464,73,8465,73,119816,73,119868,73,119920,73,120024,73,120128,73,120180,73,120232,73,120284,73,120336,73,120388,73,120440,73,65356,108,8572,73,8467,108,119845,108,119897,108,119949,108,120001,108,120053,108,120105,73,120157,73,120209,73,120261,73,120313,73,120365,73,120417,73,120469,73,448,73,120496,73,120554,73,120612,73,120670,73,120728,73,11410,73,1030,73,1216,73,1493,108,1503,108,1575,108,126464,108,126592,108,65166,108,65165,108,1994,108,11599,73,5825,73,42226,73,93992,73,66186,124,66313,124,119338,76,8556,76,8466,76,119819,76,119871,76,119923,76,120027,76,120079,76,120131,76,120183,76,120235,76,120287,76,120339,76,120391,76,120443,76,11472,76,5086,76,5290,76,42209,76,93974,76,71843,76,71858,76,66587,76,66854,76,65325,77,8559,77,8499,77,119820,77,119872,77,119924,77,120028,77,120080,77,120132,77,120184,77,120236,77,120288,77,120340,77,120392,77,120444,77,924,77,120499,77,120557,77,120615,77,120673,77,120731,77,1018,77,11416,77,5047,77,5616,77,5846,77,42207,77,66224,77,66321,77,119847,110,119899,110,119951,110,120003,110,120055,110,120107,110,120159,110,120211,110,120263,110,120315,110,120367,110,120419,110,120471,110,1400,110,1404,110,65326,78,8469,78,119821,78,119873,78,119925,78,119977,78,120029,78,120081,78,120185,78,120237,78,120289,78,120341,78,120393,78,120445,78,925,78,120500,78,120558,78,120616,78,120674,78,120732,78,11418,78,42208,78,66835,78,3074,111,3202,111,3330,111,3458,111,2406,111,2662,111,2790,111,3046,111,3174,111,3302,111,3430,111,3664,111,3792,111,4160,111,1637,111,1781,111,65359,111,8500,111,119848,111,119900,111,119952,111,120056,111,120108,111,120160,111,120212,111,120264,111,120316,111,120368,111,120420,111,120472,111,7439,111,7441,111,43837,111,959,111,120528,111,120586,111,120644,111,120702,111,120760,111,963,111,120532,111,120590,111,120648,111,120706,111,120764,111,11423,111,4351,111,1413,111,1505,111,1607,111,126500,111,126564,111,126596,111,65259,111,65260,111,65258,111,65257,111,1726,111,64428,111,64429,111,64427,111,64426,111,1729,111,64424,111,64425,111,64423,111,64422,111,1749,111,3360,111,4125,111,66794,111,71880,111,71895,111,66604,111,1984,79,2534,79,2918,79,12295,79,70864,79,71904,79,120782,79,120792,79,120802,79,120812,79,120822,79,130032,79,65327,79,119822,79,119874,79,119926,79,119978,79,120030,79,120082,79,120134,79,120186,79,120238,79,120290,79,120342,79,120394,79,120446,79,927,79,120502,79,120560,79,120618,79,120676,79,120734,79,11422,79,1365,79,11604,79,4816,79,2848,79,66754,79,42227,79,71861,79,66194,79,66219,79,66564,79,66838,79,9076,112,65360,112,119849,112,119901,112,119953,112,120005,112,120057,112,120109,112,120161,112,120213,112,120265,112,120317,112,120369,112,120421,112,120473,112,961,112,120530,112,120544,112,120588,112,120602,112,120646,112,120660,112,120704,112,120718,112,120762,112,120776,112,11427,112,65328,80,8473,80,119823,80,119875,80,119927,80,119979,80,120031,80,120083,80,120187,80,120239,80,120291,80,120343,80,120395,80,120447,80,929,80,120504,80,120562,80,120620,80,120678,80,120736,80,11426,80,5090,80,5229,80,42193,80,66197,80,119850,113,119902,113,119954,113,120006,113,120058,113,120110,113,120162,113,120214,113,120266,113,120318,113,120370,113,120422,113,120474,113,1307,113,1379,113,1382,113,8474,81,119824,81,119876,81,119928,81,119980,81,120032,81,120084,81,120188,81,120240,81,120292,81,120344,81,120396,81,120448,81,11605,81,119851,114,119903,114,119955,114,120007,114,120059,114,120111,114,120163,114,120215,114,120267,114,120319,114,120371,114,120423,114,120475,114,43847,114,43848,114,7462,114,11397,114,43905,114,119318,82,8475,82,8476,82,8477,82,119825,82,119877,82,119929,82,120033,82,120189,82,120241,82,120293,82,120345,82,120397,82,120449,82,422,82,5025,82,5074,82,66740,82,5511,82,42211,82,94005,82,65363,115,119852,115,119904,115,119956,115,120008,115,120060,115,120112,115,120164,115,120216,115,120268,115,120320,115,120372,115,120424,115,120476,115,42801,115,445,115,1109,115,43946,115,71873,115,66632,115,65331,83,119826,83,119878,83,119930,83,119982,83,120034,83,120086,83,120138,83,120190,83,120242,83,120294,83,120346,83,120398,83,120450,83,1029,83,1359,83,5077,83,5082,83,42210,83,94010,83,66198,83,66592,83,119853,116,119905,116,119957,116,120009,116,120061,116,120113,116,120165,116,120217,116,120269,116,120321,116,120373,116,120425,116,120477,116,8868,84,10201,84,128872,84,65332,84,119827,84,119879,84,119931,84,119983,84,120035,84,120087,84,120139,84,120191,84,120243,84,120295,84,120347,84,120399,84,120451,84,932,84,120507,84,120565,84,120623,84,120681,84,120739,84,11430,84,5026,84,42196,84,93962,84,71868,84,66199,84,66225,84,66325,84,119854,117,119906,117,119958,117,120010,117,120062,117,120114,117,120166,117,120218,117,120270,117,120322,117,120374,117,120426,117,120478,117,42911,117,7452,117,43854,117,43858,117,651,117,965,117,120534,117,120592,117,120650,117,120708,117,120766,117,1405,117,66806,117,71896,117,8746,85,8899,85,119828,85,119880,85,119932,85,119984,85,120036,85,120088,85,120140,85,120192,85,120244,85,120296,85,120348,85,120400,85,120452,85,1357,85,4608,85,66766,85,5196,85,42228,85,94018,85,71864,85,8744,118,8897,118,65366,118,8564,118,119855,118,119907,118,119959,118,120011,118,120063,118,120115,118,120167,118,120219,118,120271,118,120323,118,120375,118,120427,118,120479,118,7456,118,957,118,120526,118,120584,118,120642,118,120700,118,120758,118,1141,118,1496,118,71430,118,43945,118,71872,118,119309,86,1639,86,1783,86,8548,86,119829,86,119881,86,119933,86,119985,86,120037,86,120089,86,120141,86,120193,86,120245,86,120297,86,120349,86,120401,86,120453,86,1140,86,11576,86,5081,86,5167,86,42719,86,42214,86,93960,86,71840,86,66845,86,623,119,119856,119,119908,119,119960,119,120012,119,120064,119,120116,119,120168,119,120220,119,120272,119,120324,119,120376,119,120428,119,120480,119,7457,119,1121,119,1309,119,1377,119,71434,119,71438,119,71439,119,43907,119,71919,87,71910,87,119830,87,119882,87,119934,87,119986,87,120038,87,120090,87,120142,87,120194,87,120246,87,120298,87,120350,87,120402,87,120454,87,1308,87,5043,87,5076,87,42218,87,5742,120,10539,120,10540,120,10799,120,65368,120,8569,120,119857,120,119909,120,119961,120,120013,120,120065,120,120117,120,120169,120,120221,120,120273,120,120325,120,120377,120,120429,120,120481,120,5441,120,5501,120,5741,88,9587,88,66338,88,71916,88,65336,88,8553,88,119831,88,119883,88,119935,88,119987,88,120039,88,120091,88,120143,88,120195,88,120247,88,120299,88,120351,88,120403,88,120455,88,42931,88,935,88,120510,88,120568,88,120626,88,120684,88,120742,88,11436,88,11613,88,5815,88,42219,88,66192,88,66228,88,66327,88,66855,88,611,121,7564,121,65369,121,119858,121,119910,121,119962,121,120014,121,120066,121,120118,121,120170,121,120222,121,120274,121,120326,121,120378,121,120430,121,120482,121,655,121,7935,121,43866,121,947,121,8509,121,120516,121,120574,121,120632,121,120690,121,120748,121,1199,121,4327,121,71900,121,65337,89,119832,89,119884,89,119936,89,119988,89,120040,89,120092,89,120144,89,120196,89,120248,89,120300,89,120352,89,120404,89,120456,89,933,89,978,89,120508,89,120566,89,120624,89,120682,89,120740,89,11432,89,1198,89,5033,89,5053,89,42220,89,94019,89,71844,89,66226,89,119859,122,119911,122,119963,122,120015,122,120067,122,120119,122,120171,122,120223,122,120275,122,120327,122,120379,122,120431,122,120483,122,7458,122,43923,122,71876,122,66293,90,71909,90,65338,90,8484,90,8488,90,119833,90,119885,90,119937,90,119989,90,120041,90,120197,90,120249,90,120301,90,120353,90,120405,90,120457,90,918,90,120493,90,120551,90,120609,90,120667,90,120725,90,5059,90,42204,90,71849,90,65282,34,65284,36,65285,37,65286,38,65290,42,65291,43,65294,46,65295,47,65296,48,65297,49,65298,50,65299,51,65300,52,65301,53,65302,54,65303,55,65304,56,65305,57,65308,60,65309,61,65310,62,65312,64,65316,68,65318,70,65319,71,65324,76,65329,81,65330,82,65333,85,65334,86,65335,87,65343,95,65346,98,65348,100,65350,102,65355,107,65357,109,65358,110,65361,113,65362,114,65364,116,65365,117,65367,119,65370,122,65371,123,65373,125],"_default":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"cs":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"de":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"es":[8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"fr":[65374,126,65306,58,65281,33,8216,96,8245,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"it":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"ja":[8211,45,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65292,44,65307,59],"ko":[8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"pl":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"pt-BR":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"qps-ploc":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"ru":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,305,105,921,73,1009,112,215,120,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"tr":[160,32,8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"zh-hans":[65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41],"zh-hant":[8211,45,65374,126,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65307,59]}'))}static{this.cache=new UP(e=>{function t(u){let d=new Map;for(let f=0;f<u.length;f+=2)d.set(u[f],u[f+1]);return d}function r(u,d){let f=new Map(u);for(let[g,b]of d)f.set(g,b);return f}function i(u,d){if(!u)return d;let f=new Map;for(let[g,b]of u)d.has(g)&&f.set(g,b);return f}let o=this.ambiguousCharacterData.getValue(),s=e.filter(u=>!u.startsWith("_")&&u in o);s.length===0&&(s=["_default"]);let a;for(let u of s){let d=t(o[u]);a=i(a,d)}let l=t(o._common),c=r(l,a);return new n(c)})}static getInstance(e){return n.cache.get(Array.from(e))}static{this._locales=new IC(()=>Object.keys(n.ambiguousCharacterData.getValue()).filter(e=>!e.startsWith("_")))}static getLocales(){return n._locales.getValue()}isAmbiguous(e){return this.confusableDictionary.has(e)}getPrimaryConfusable(e){return this.confusableDictionary.get(e)}getConfusableCodePoints(){return new Set(this.confusableDictionary.keys())}},$W=class n{static getRawData(){return JSON.parse("[9,10,11,12,13,32,127,160,173,847,1564,4447,4448,6068,6069,6155,6156,6157,6158,7355,7356,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8203,8204,8205,8206,8207,8234,8235,8236,8237,8238,8239,8287,8288,8289,8290,8291,8292,8293,8294,8295,8296,8297,8298,8299,8300,8301,8302,8303,10240,12288,12644,65024,65025,65026,65027,65028,65029,65030,65031,65032,65033,65034,65035,65036,65037,65038,65039,65279,65440,65520,65521,65522,65523,65524,65525,65526,65527,65528,65532,78844,119155,119156,119157,119158,119159,119160,119161,119162,917504,917505,917506,917507,917508,917509,917510,917511,917512,917513,917514,917515,917516,917517,917518,917519,917520,917521,917522,917523,917524,917525,917526,917527,917528,917529,917530,917531,917532,917533,917534,917535,917536,917537,917538,917539,917540,917541,917542,917543,917544,917545,917546,917547,917548,917549,917550,917551,917552,917553,917554,917555,917556,917557,917558,917559,917560,917561,917562,917563,917564,917565,917566,917567,917568,917569,917570,917571,917572,917573,917574,917575,917576,917577,917578,917579,917580,917581,917582,917583,917584,917585,917586,917587,917588,917589,917590,917591,917592,917593,917594,917595,917596,917597,917598,917599,917600,917601,917602,917603,917604,917605,917606,917607,917608,917609,917610,917611,917612,917613,917614,917615,917616,917617,917618,917619,917620,917621,917622,917623,917624,917625,917626,917627,917628,917629,917630,917631,917760,917761,917762,917763,917764,917765,917766,917767,917768,917769,917770,917771,917772,917773,917774,917775,917776,917777,917778,917779,917780,917781,917782,917783,917784,917785,917786,917787,917788,917789,917790,917791,917792,917793,917794,917795,917796,917797,917798,917799,917800,917801,917802,917803,917804,917805,917806,917807,917808,917809,917810,917811,917812,917813,917814,917815,917816,917817,917818,917819,917820,917821,917822,917823,917824,917825,917826,917827,917828,917829,917830,917831,917832,917833,917834,917835,917836,917837,917838,917839,917840,917841,917842,917843,917844,917845,917846,917847,917848,917849,917850,917851,917852,917853,917854,917855,917856,917857,917858,917859,917860,917861,917862,917863,917864,917865,917866,917867,917868,917869,917870,917871,917872,917873,917874,917875,917876,917877,917878,917879,917880,917881,917882,917883,917884,917885,917886,917887,917888,917889,917890,917891,917892,917893,917894,917895,917896,917897,917898,917899,917900,917901,917902,917903,917904,917905,917906,917907,917908,917909,917910,917911,917912,917913,917914,917915,917916,917917,917918,917919,917920,917921,917922,917923,917924,917925,917926,917927,917928,917929,917930,917931,917932,917933,917934,917935,917936,917937,917938,917939,917940,917941,917942,917943,917944,917945,917946,917947,917948,917949,917950,917951,917952,917953,917954,917955,917956,917957,917958,917959,917960,917961,917962,917963,917964,917965,917966,917967,917968,917969,917970,917971,917972,917973,917974,917975,917976,917977,917978,917979,917980,917981,917982,917983,917984,917985,917986,917987,917988,917989,917990,917991,917992,917993,917994,917995,917996,917997,917998,917999]")}static{this._data=void 0}static getData(){return this._data||(this._data=new Set(n.getRawData())),this._data}static isInvisibleCharacter(e){return n.getData().has(e)}static get codePoints(){return n.getData()}};function md(n){return n===47||n===92}function OA(n){return n.replace(/[\\/]/g,Er.sep)}function QW(n){return n.indexOf("/")===-1&&(n=OA(n)),/^[a-zA-Z]:(\/|$)/.test(n)&&(n="/"+n),n}function FA(n,e=Er.sep){if(!n)return"";let t=n.length,r=n.charCodeAt(0);if(md(r)){if(md(n.charCodeAt(1))&&!md(n.charCodeAt(2))){let o=3,s=o;for(;o<t&&!md(n.charCodeAt(o));o++);if(s!==o&&!md(n.charCodeAt(o+1))){for(o+=1;o<t;o++)if(md(n.charCodeAt(o)))return n.slice(0,o+1).replace(/[\\/]/g,e)}}return e}else if(wZ(r)&&n.charCodeAt(1)===58)return md(n.charCodeAt(2))?n.slice(0,2)+e:n.slice(0,2);let i=n.indexOf("://");if(i!==-1){for(i+=3;i<t;i++)if(md(n.charCodeAt(i)))return n.slice(0,i+1)}return""}function LA(n,e,t,r=vn){if(n===e)return!0;if(!n||!e||e.length>n.length)return!1;if(t){if(!zW(n,e))return!1;if(e.length===n.length)return!0;let o=e.length;return e.charAt(e.length-1)===r&&o--,n.charAt(o)===r}return e.charAt(e.length-1)!==r&&(e+=r),n.indexOf(e)===0}function wZ(n){return n>=65&&n<=90||n>=97&&n<=122}var al;(ee=>(ee.inMemory="inmemory",ee.vscode="vscode",ee.internal="private",ee.walkThrough="walkThrough",ee.walkThroughSnippet="walkThroughSnippet",ee.http="http",ee.https="https",ee.file="file",ee.mailto="mailto",ee.untitled="untitled",ee.data="data",ee.command="command",ee.vscodeRemote="vscode-remote",ee.vscodeRemoteResource="vscode-remote-resource",ee.vscodeUserData="vscode-userdata",ee.vscodeCustomEditor="vscode-custom-editor",ee.vscodeNotebook="vscode-notebook",ee.vscodeNotebookCell="vscode-notebook-cell",ee.vscodeNotebookCellMetadata="vscode-notebook-cell-metadata",ee.vscodeNotebookCellOutput="vscode-notebook-cell-output",ee.vscodeInteractive="vscode-interactive",ee.vscodeInteractiveInput="vscode-interactive-input",ee.vscodeSettings="vscode-settings",ee.vscodeWorkspaceTrust="vscode-workspace-trust",ee.vscodeTerminal="vscode-terminal",ee.webviewPanel="webview-panel",ee.vscodeWebview="vscode-webview",ee.extension="extension",ee.vscodeFileResource="vscode-file",ee.tmp="tmp",ee.vsls="vsls"))(al||={});function da(n){return NP?n?.path||"":n?.fsPath||""}var CC=class{constructor(e){this._ignorePathCasing=e}compare(e,t,r=!1){return e===t?0:qW(this.getComparisonKey(e,r),this.getComparisonKey(t,r))}isEqual(e,t,r=!1){return e===t?!0:!e||!t?!1:this.getComparisonKey(e,r)===this.getComparisonKey(t,r)}getComparisonKey(e,t=!1){return e.with({path:this._ignorePathCasing(e)?e.path.toLowerCase():void 0,fragment:void 0}).toString()}ignorePathCasing(e){return this._ignorePathCasing(e)}isEqualOrParent(e,t,r=!1,i=bC?"\\":"/"){if(e.scheme===t.scheme){if(e.scheme===al.file)return LA(da(e),da(t),this._ignorePathCasing(e),i)&&e.query===t.query&&(r||e.fragment===t.fragment);if(YW(e.authority,t.authority))return LA(e.path,t.path,this._ignorePathCasing(e),"/")&&e.query===t.query&&(r||e.fragment===t.fragment)}return!1}joinPath(e,...t){return SC.Uri.joinPath(e,...t)}basenameOrAuthority(e){return pr(e)||e.authority}basename(e,t){return Er.basename(e.path,t)}extname(e){return Er.extname(e.path)}dirname(e){if(e.path.length===0)return e;let t;return e.scheme===al.file?t=SC.Uri.file(it(da(e))).path:(t=Er.dirname(e.path),e.authority&&t.length&&t.charCodeAt(0)!==47&&(console.error(`dirname("${e.toString})) resulted in a relative path`),t="/")),e.with({path:t})}normalizePath(e){if(!e.path.length)return e;let t;return e.scheme===al.file?t=SC.Uri.file(mn(da(e))).path:t=Er.normalize(e.path),e.with({path:t})}relativePath(e,t){if(e.scheme!==t.scheme||!YW(e.authority,t.authority))return;if(e.scheme===al.file){let o=LP(da(e),da(t));return bC?OA(o):o}let r=e.path||"/",i=t.path||"/";if(this._ignorePathCasing(e)){let o=0;for(let s=Math.min(r.length,i.length);o<s&&!(r.charCodeAt(o)!==i.charCodeAt(o)&&r.charAt(o).toLowerCase()!==i.charAt(o).toLowerCase());o++);r=i.substr(0,o)+r.substr(o)}return Er.relative(r,i)}resolvePath(e,t){if(e.scheme===al.file){let r=SC.Uri.file(WW(da(e),t));return e.with({authority:r.authority,path:r.path})}return t=QW(t),e.with({path:Er.resolve(e.path,t)})}isAbsolutePath(e){return!!e.path&&e.path[0]==="/"}isEqualAuthority(e,t){return e===t||e!==void 0&&t!==void 0&&GW(e,t)}hasTrailingPathSeparator(e,t=vn){if(e.scheme===al.file){let r=da(e);return r.length>FA(r).length&&r[r.length-1]===t}else{let r=e.path;return r.length>1&&r.charCodeAt(r.length-1)===47&&!/^[a-zA-Z]:(\/$|\\$)/.test(e.fsPath)}}removeTrailingPathSeparator(e,t=vn){return XW(e,t)?e.with({path:e.path.substr(0,e.path.length-1)}):e}addTrailingPathSeparator(e,t=vn){let r=!1;if(e.scheme===al.file){let i=da(e);r=i!==void 0&&i.length===FA(i).length&&i[i.length-1]===t}else{t="/";let i=e.path;r=i.length===1&&i.charCodeAt(i.length-1)===47}return!r&&!XW(e,t)?e.with({path:e.path+"/"}):e}},ir=new CC(()=>!1),Sve=new CC(n=>n.scheme===al.file?!FW:!0),Cve=new CC(n=>!0),an=ir.isEqual.bind(ir),Fh=ir.isEqualOrParent.bind(ir),fn=ir.getComparisonKey.bind(ir),Eve=ir.basenameOrAuthority.bind(ir),pr=ir.basename.bind(ir),fd=ir.extname.bind(ir),Nn=ir.dirname.bind(ir),zt=ir.joinPath.bind(ir),wve=ir.normalizePath.bind(ir),UA=ir.relativePath.bind(ir),Pve=ir.resolvePath.bind(ir),kve=ir.isAbsolutePath.bind(ir),YW=ir.isEqualAuthority.bind(ir),XW=ir.hasTrailingPathSeparator.bind(ir),xve=ir.removeTrailingPathSeparator.bind(ir),Dve=ir.addTrailingPathSeparator.bind(ir),kZ;(o=>{o.META_DATA_LABEL="label",o.META_DATA_DESCRIPTION="description",o.META_DATA_SIZE="size",o.META_DATA_MIME="mime";function i(s){let a=new Map;s.path.substring(s.path.indexOf(";")+1,s.path.lastIndexOf(";")).split(";").forEach(u=>{let[d,f]=u.split(":");d&&f&&a.set(d,f)});let c=s.path.substring(0,s.path.indexOf(";"));return c&&a.set(o.META_DATA_MIME,c),a}o.parseMetaData=i})(kZ||={});function Ur(n=process.platform){return/^win/.test(n)?"Windows":/^darwin/.test(n)?"OSX":/^linux/.test(n)?"Linux":"Unknown"}function Lh(n,e){return n.replace(/^~(?=$|\/|\\)/,e)}function xZ(){if(!ol())return VA.Uri.file(require("os").homedir())}function Ae(n){let e=Ur()==="Windows";if(n){let t=da(n);return t&&t.startsWith(vn)&&t.length>1&&t[1]!==vn&&e?t.slice(1):t||""}return""}function M(n,e=[],t){t=t||xZ();let r;typeof n=="string"&&(r=VA.Uri.file(n)),typeof n!="string"&&(r=n);let i=WA(r,void 0,t),o=e.find(l=>r&&Fh(r,l.uri,!0));if(e.length>1&&o)return`${o.name}${vn}${WA(r,o.uri,t)}`;let s=o?[WA(r,o.uri,t)]:[],a=i;return[i,...s].forEach(l=>{l.length<a.length&&(a=l)}),a}function WA(n,e,t){let r=Ur()==="Windows";if(n&&e&&Fh(n,e,!0)){let i=UA(e,n);if(i)return r?i.replace(/\//g,"\\"):i}if(n&&t&&Fh(n,t,!0)){let i=UA(t,n);if(i)return i=r?i.replace(/\//g,"\\"):i,`~${vn}${i}`}return Ae(n)}var eV=k(ZW());function Ut(n){let e=this,t=!1,r;return function(){return t||(t=!0,r=n.apply(e,arguments)),r}}var BA;(w=>{function n(_){return _&&typeof _=="object"&&typeof _[Symbol.iterator]=="function"}w.is=n;let e=Object.freeze([]);function t(){return e}w.empty=t;function*r(_){yield _}w.single=r;function i(_){return n(_)?_:r(_)}w.wrap=i;function o(_){return _||e}w.from=o;function s(_){return!_||_[Symbol.iterator]().next().done===!0}w.isEmpty=s;function a(_){return _[Symbol.iterator]().next().value}w.first=a;function l(_,A){for(let R of _)if(A(R))return!0;return!1}w.some=l;function c(_,A){for(let R of _)if(A(R))return R}w.find=c;function*u(_,A){for(let R of _)A(R)&&(yield R)}w.filter=u;function*d(_,A){let R=0;for(let V of _)yield A(V,R++)}w.map=d;function*f(..._){for(let A of _)for(let R of A)yield R}w.concat=f;function g(_,A,R){let V=R;for(let ie of _)V=A(V,ie);return V}w.reduce=g;function*b(_,A,R=_.length){for(A<0&&(A+=_.length),R<0?R+=_.length:R>_.length&&(R=_.length);A<R;A++)yield _[A]}w.slice=b;function I(_,A=Number.POSITIVE_INFINITY){let R=[];if(A===0)return[R,_];let V=_[Symbol.iterator]();for(let ie=0;ie<A;ie++){let Q=V.next();if(Q.done)return[R,w.empty()];R.push(Q.value)}return[R,{[Symbol.iterator](){return V}}]}w.consume=I})(BA||={});var tV;function rV(n){tV=n}function pa(n){return tV?.push(n),n}function G(n){if(BA.is(n)){for(let e of n)if(e)try{e.dispose()}catch(t){console.warn(`dispose() failed for ${e}`,t)}return Array.isArray(n)?[]:n}else if(n)return n.dispose(),n}var or=class n{constructor(...e){this._toDispose=new Set;this._isDisposed=!1;e.forEach(t=>this.add(t)),pa(this)}static{this.DISABLE_DISPOSED_WARNING=!1}dispose(){this._isDisposed||(this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{G(this._toDispose)}finally{this._toDispose.clear()}}add(e){if(!e)return e;if(e===this)throw new Error("Cannot register a disposable on itself!");return this._isDisposed?n.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(e),e}},Qt=class{constructor(...e){this._store=new or;this._isDisposed=!1;e.forEach(t=>this._store.add(t)),pa(this)}get isDisposed(){return this._isDisposed}dispose(){this._store.dispose(),this._isDisposed=!0}_register(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(e)}},Yn=class extends Qt{constructor(){super(),this._onDidDispose=new eV.EventEmitter,this.onDidDispose=this._onDidDispose.event}dispose(){super.dispose(),this._onDidDispose.fire(),this._onDidDispose.dispose()}};var Uh=class{constructor(){this._store=new Map;this._isDisposed=!1}dispose(){this._isDisposed=!0,this.clearAndDisposeAll()}clearAndDisposeAll(){if(this._store.size)try{G(this._store.values())}finally{this._store.clear()}}has(e){return this._store.has(e)}get(e){return this._store.get(e)}set(e,t,r=!1){this._isDisposed&&console.warn(new Error("Trying to add a disposable to a DisposableMap that has already been disposed of. The added object will be leaked!").stack),r||this._store.get(e)?.dispose(),this._store.set(e,t)}deleteAndDispose(e){this._store.get(e)?.dispose(),this._store.delete(e)}[Symbol.iterator](){return this._store[Symbol.iterator]()}};var WP=class{constructor(){this.references=new Map}acquire(e,...t){let r=this.references.get(e);r||(r={counter:0,object:this.createReferencedObject(e,...t)},this.references.set(e,r));let{object:i}=r,o=Ut(()=>{r&&--r.counter===0&&(this.destroyReferencedObject(e,r.object),this.references.delete(e))});return r.counter++,{object:i,dispose:o}}};var E=require("vscode");var et=require("vscode"),$A=60,JA=$A*60,EC=JA*24,nV=EC*7,iV=EC*30,oV=EC*365;function Wh(n,e,t,r){typeof n!="number"&&(n=n.getTime());let i=Math.round((new Date().getTime()-n)/1e3);if(i<-30)return et.l10n.t("in {0}",Wh(new Date().getTime()+i*1e3,!1));if(!r&&i<30)return et.l10n.t("now");let o;return i<$A?(o=i,e?o===1?t?et.l10n.t("{0} second ago",o):et.l10n.t("{0} sec ago",o):t?et.l10n.t("{0} seconds ago",o):et.l10n.t("{0} secs ago",o):o===1?t?et.l10n.t("{0} second",o):et.l10n.t("{0} sec",o):t?et.l10n.t("{0} seconds",o):et.l10n.t("{0} secs",o)):i<JA?(o=Math.floor(i/$A),e?o===1?t?et.l10n.t("{0} minute ago",o):et.l10n.t("{0} min ago",o):t?et.l10n.t("{0} minutes ago",o):et.l10n.t("{0} mins ago",o):o===1?t?et.l10n.t("{0} minute",o):et.l10n.t("{0} min",o):t?et.l10n.t("{0} minutes",o):et.l10n.t("{0} mins",o)):i<EC?(o=Math.floor(i/JA),e?o===1?t?et.l10n.t("{0} hour ago",o):et.l10n.t("{0} hr ago",o):t?et.l10n.t("{0} hours ago",o):et.l10n.t("{0} hrs ago",o):o===1?t?et.l10n.t("{0} hour",o):et.l10n.t("{0} hr",o):t?et.l10n.t("{0} hours",o):et.l10n.t("{0} hrs",o)):i<nV?(o=Math.floor(i/EC),e?o===1?et.l10n.t("{0} day ago",o):et.l10n.t("{0} days ago",o):o===1?et.l10n.t("{0} day",o):et.l10n.t("{0} days",o)):i<iV?(o=Math.floor(i/nV),e?o===1?t?et.l10n.t("{0} week ago",o):et.l10n.t("{0} wk ago",o):t?et.l10n.t("{0} weeks ago",o):et.l10n.t("{0} wks ago",o):o===1?t?et.l10n.t("{0} week",o):et.l10n.t("{0} wk",o):t?et.l10n.t("{0} weeks",o):et.l10n.t("{0} wks",o)):i<oV?(o=Math.floor(i/iV),e?o===1?t?et.l10n.t("{0} month ago",o):et.l10n.t("{0} mo ago",o):t?et.l10n.t("{0} months ago",o):et.l10n.t("{0} mos ago",o):o===1?t?et.l10n.t("{0} month",o):et.l10n.t("{0} mo",o):t?et.l10n.t("{0} months",o):et.l10n.t("{0} mos",o)):(o=Math.floor(i/oV),e?o===1?t?et.l10n.t("{0} year ago",o):et.l10n.t("{0} yr ago",o):t?et.l10n.t("{0} years ago",o):et.l10n.t("{0} yrs ago",o):o===1?t?et.l10n.t("{0} year",o):et.l10n.t("{0} yr",o):t?et.l10n.t("{0} years",o):et.l10n.t("{0} yrs",o))}var A2=k(N());var Gh=class{async createHash(e,t="SHA-256"){return ga(e,t)}};Gh=v([(0,A2.injectable)()],Gh);var yk={},R2=!1,bk;typeof window=="object"?bk=window.crypto:typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?bk=self.crypto:bk=require("node:crypto").webcrypto;async function ga(n,e){let t=n.includes("/")||n.includes("\\")||n.endsWith(".interactive");if(t&&yk[n])return yk[n];let r=await hie(n,e);return t&&!R2&&(Object.keys(yk).length>1e4&&(R2=!0),yk[n]=r),r}async function hie(n,e){let t=new TextEncoder().encode(n),r=await bk.subtle.digest({name:e},t);return Array.from(new Uint8Array(r)).map(o=>o.toString(16).padStart(2,"0")).join("")}function Lc(n){if(typeof n=="string")try{let[e,t,r]=`${n.trim()}...`.split(".").map(i=>parseInt(i,10));return isNaN(e)?"":isNaN(t)?e.toString():isNaN(r)?`${e}.${t}`:`${e}.${t}.${r}`}catch(e){return p.error(`Failed to parse version ${n}`,e),""}return n?`${n.major}.${n.minor}.${n.micro}`:""}async function ot(n){return ga(n,"SHA-256")}var Sk=k(Ik());var _C=require("vscode");var $e=class extends Error{constructor(t,r){super(r);this.category=t;this.isJupyterError=!0}},mt=class n extends $e{constructor(t,r,i){super(i||wN(r),t);this.originalException=r;r&&(this.stack=`${new Error("").stack}

${r.stack}`)}static from(t,r){return r instanceof $e?r:new n(t,r)}static unwrap(t){return t&&(t instanceof n&&t.originalException&&t.originalException instanceof $e&&(t=t.originalException),t)}};function wN(n){return n&&n instanceof $e?n.category:"unknown"}function Hr(n){let e=mr(n);if(qn&&p.ci(`Python Env Info for ${JSON.stringify(n)} is ${JSON.stringify(e)}`),e){let l=[];typeof e.version?.major=="number"&&(l.push(e.version.major.toString()),typeof e.version.minor=="number"&&(l.push(e.version.minor.toString()),typeof e.version.micro=="number"&&l.push(e.version.micro.toString())));let c=l.length?l.join("."):"",u=e.environment?.name||(e.environment?pr(e.environment?.folderUri):""),d=c?`Python ${c}`:"Python";return qr(n)&&u?u:u?`${u} (${d})`:d}if(Object.keys(n).length===1&&n.id)return n.id;let t=Lc(Ri(n)||"").trim(),r=qr(n),i=t?`Python ${t}`:"Python",o=Vo(n);if(r&&o)return o;let s=[];o&&s.push(o);let a=Ue(n);return a&&a!=="Unknown"&&s.push(a),[i,s.length?`(${s.join(": ")})`:""].join(" ").trim()}function Vo(n){let e=mr(n),t=e?.environment?.name;return!t&&e?.environment?.folderUri&&Ue(n)==="Conda"&&(t=pr(e?.environment?.folderUri)),t}var yie=["Unknown","Conda","PipEnv","Poetry","Pyenv","Venv","VirtualEnv","VirtualEnvWrapper"];function Ue(n){let e=mr(n);return e?bie(e):"Unknown"}function bie(n){if(n.environment?.type==="Conda")return"Conda";let e=[["Conda","Conda"],["Pyenv","Pyenv"],["Pipenv","PipEnv"],["Poetry","Poetry"],["VirtualEnvWrapper","VirtualEnvWrapper"],["VirtualEnv","VirtualEnv"],["Venv","Venv"]];for(let[t,r]of e)if(n.tools.includes(t))return r;if(n.environment?.type==="VirtualEnvironment")return"VirtualEnv";for(let t of yie)if(n.tools.some(r=>r.toLowerCase()===t.toLowerCase()))return t;return"Unknown"}async function zh(n){return n?.id?(await Sk.PythonExtension.api()).environments.resolveEnvironment(n.id):void 0}var Zi;function N2(n){Zi=n}function qr(n){if(!n||!Zi)return!1;let e=mr(n);return e&&Ue(e)==="Conda"&&!e.executable.uri}function mr(n){if(n){if(!Zi)throw new mt("Python API not initialized",void 0,"pythonAPINotInitialized");return typeof n=="string"?Zi.environments.known.find(e=>e.id===n||e.path===n||e.executable.uri?.fsPath===n):Zi.environments.known.find(e=>e.id===n.id)}}async function Ps(n){if(!n?.id)return;if(Zi){let r=Zi.environments.known.find(i=>i.id===n.id);if(r?.executable?.sysPrefix)return r.executable.sysPrefix}let t=await(await Sk.PythonExtension.api()).environments.resolveEnvironment(n.id).then(r=>r?.executable?.sysPrefix);return t||p.warn(`Unable to find sysPrefix for interpreter ${M(n.id)}`),t}function Qh(n){if(!n?.id)return;if(!Zi)throw new mt("Python API not initialized",void 0,"pythonAPINotInitialized");return Zi.environments.known.find(t=>t.id===n.id)?.executable?.sysPrefix}async function yd(n,e=!1){if(!n?.id)return;if(Zi&&!e){let i=Zi.environments.known.find(o=>o.id===n.id);if(i?.version)return i.version}let r=await(await Sk.PythonExtension.api()).environments.resolveEnvironment(n.id);return r?.version||p.warn(`Unable to find Version for interpreter ${M(n.id)}`),r?.version}function Ri(n){if(!n?.id)return;if(!Zi)throw new mt("Python API not initialized",void 0,"pythonAPINotInitialized");return Zi.environments.known.find(t=>t.id===n.id)?.version}function mo(){return Zi?Zi.environments.known:[]}function Ai(n){if(!n)return;let e,t=n.id;if(n.executable.uri)e=n.executable.uri;else if(Ue(n)==="Conda")e=Ur()==="Windows"?_C.Uri.joinPath(n.environment?.folderUri||_C.Uri.file(n.path),"python.exe"):_C.Uri.joinPath(n.environment?.folderUri||_C.Uri.file(n.path),"bin","python");else{p.warn(`Python environment ${M(n.id)} excluded as Uri is undefined`);return}return{id:t,uri:e}}function Iie(n){return Hr(n)}var ce;(A=>(A.bannerLabelYes=E.l10n.t("Yes"),A.bannerLabelNo=E.l10n.t("No"),A.canceled=E.l10n.t("Canceled"),A.cancel=E.l10n.t("Cancel"),A.ok=E.l10n.t("Ok"),A.refresh=E.l10n.t("Refresh"),A.refreshing=E.l10n.t("Refreshing..."),A.install=E.l10n.t("Install"),A.downloadAndInstall=E.l10n.t("Download and Install"),A.loadingExtension=E.l10n.t("Jupyter Extension loading..."),A.handleExtensionActivationError=E.l10n.t("Extension activation failed, run the 'Developer: Toggle Developer Tools' command for more information."),A.doNotShowAgain=E.l10n.t("Do not show again"),A.reload=E.l10n.t("Reload"),A.moreInfo=E.l10n.t("More Info"),A.learnMore=E.l10n.t("Learn more"),A.and=E.l10n.t("and"),A.reportThisIssue=E.l10n.t("Report this issue"),A.clickHereForMoreInfoWithHtml=R=>E.l10n.t("Click <a href='{0}'>here</a> for more info.",R)))(ce||={});var Im;(t=>(t.notInGroup=r=>E.l10n.t("User does not belong to experiment group '{0}'",r),t.inGroup=r=>E.l10n.t("User belongs to experiment group '{0}'",r)))(Im||={});var PN;(e=>e.jupyter=E.l10n.t("Jupyter"))(PN||={});var kN;(e=>e.currentWorkingDirectory="cwd:")(kN||={});var xN;(e=>e.bannerMessage=E.l10n.t("Would you like shift-enter to send code to the new Interactive Window experience?"))(xN||={});var DN;(e=>e.bannerMessage=E.l10n.t("Can you please take a minute to tell us about your notebooks experience in VS Code?"))(DN||={});var Ck;(t=>(t.bannerLabelYes=E.l10n.t("Yes, take survey now"),t.bannerLabelNo=E.l10n.t("No, thanks")))(Ck||={});var y;(x=>(x.warnWhenSelectingKernelWithUnSupportedPythonVersion=E.l10n.t("The version of Python associated with the selected kernel is no longer supported. Please consider selecting a different kernel."),x.installingPythonExtension=E.l10n.t("Installing Python extension and locating kernels."),x.pythonExtensionRequired=E.l10n.t("The Python Extension is required to perform that task. Click Yes to open Python Extension installation page."),x.rendererExtensionRequired=E.l10n.t("The Renderer Extension is required to view IPyWidgets. Click Yes to open Jupyter Notebook Renderer Extension installation page."),x.rendererExtension1015Required=E.l10n.t("The installed version of the Renderer Extension is outdated and requires and update to view IPyWidgets. Click Yes to open Jupyter Notebook Renderer Extension installation page."),x.pythonExtensionInstalled=E.l10n.t("Python Extension is now installed. Some features might not be available until a notebook or interactive window session is restarted."),x.unknownPackage=E.l10n.t("unknown"),x.interactiveWindowTitleFormat=U=>E.l10n.t("Interactive - {0}",U),x.interactiveWindowModeBannerTitle=E.l10n.t({message:"Do you want to open a new Interactive Window for this file? [More Information](command:workbench.action.openSettings?%5B%22jupyter.interactiveWindowMode%22%5D).",args:[],comment:'The string "command:workbench.action.openSettings?%5B%22jupyter.interactiveWindowMode%22%5D" should not be translated. It is a command that opens the settings page with the "jupyter.interactiveWindowMode" setting selected.'}),x.interactiveWindowModeBannerSwitchYes=E.l10n.t("Yes"),x.interactiveWindowModeBannerSwitchNo=E.l10n.t("No"),x.dataExplorerTitle=E.l10n.t("Data Viewer"),x.badWebPanelFormatString=U=>E.l10n.t({message:"<html><body><h1>{0} is not a valid file name</h1></body></html>",args:[U],comment:["Only translate the text within the HTML tags"]}),x.installingMissingDependencies=E.l10n.t("Installing missing dependencies"),x.validatingKernelDependencies=E.l10n.t("Validating kernel dependencies"),x.performingExport=E.l10n.t("Performing Export"),x.exportNotebookToPython=E.l10n.t("Exporting Notebook to Python"),x.sessionDisposed=E.l10n.t("Cannot execute code, session has been disposed. Please try restarting the Kernel."),x.passwordFailure=E.l10n.t("Failed to connect to password protected server. Check that password is correct."),x.incorrectPassword=E.l10n.t("Incorrect Password."),x.exportDialogFilter=E.l10n.t("Jupyter Notebooks"),x.exportDialogComplete=U=>E.l10n.t("Notebook written to {0}",U),x.exportDialogFailed=U=>E.l10n.t("Failed to export notebook. {0}",U),x.exportOpenQuestion1=E.l10n.t("Open in editor"),x.runCellLensCommandTitle=E.l10n.t("Run Cell"),x.importDialogTitle=E.l10n.t("Import Jupyter Notebook"),x.importDialogFilter="Jupyter Notebooks",x.notebookCheckForImportNo=E.l10n.t("Later"),x.libraryRequiredToLaunchJupyterNotInstalled=U=>E.l10n.t("Running cells requires {0} package.",U),x.librariesRequiredToLaunchJupyterNotInstalled=U=>E.l10n.t("Running cells requires {0} package.",U),x.libraryRequiredToLaunchJupyterNotInstalledInterpreter=(U,je)=>E.l10n.t("Running cells with '{0}' requires the {1} package.",U,je),x.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreter=(U,je)=>E.l10n.t("Running cells with '{0}' requires the {1} package.",U,je),x.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreterAndRequiresUpdate=(U,je)=>E.l10n.t("Running cells with '{0}' requires the {1} package to be installed or requires an update.",U,je),x.librariesRequiredToLaunchJupyterNotInstalledInterpreter=(U,je)=>E.l10n.t("Running cells with '{0}' requires the {1} package.",U,je),x.createANewPythonEnvironment=()=>E.l10n.t("[Create a Python Environment](command:jupyter.createPythonEnvAndSelectController) with the required packages."),x.installPackageInstructions=(U,je)=>E.l10n.t(`Install '{0}' into the Python environment. 
Command: '{1}'`,U,je),x.OrInstallPackageInstructions=(U,je)=>E.l10n.t("Or install '{0}' using the command: '{1}'",U,je),x.pythonCondaKernelsWithoutPython=E.l10n.t("The Python Runtime and IPyKernel will be automatically installed upon selecting this environment."),x.selectJupyterInterpreter=E.l10n.t("Select an Interpreter to start Jupyter"),x.jupyterInstall=E.l10n.t("Install"),x.currentlySelectedJupyterInterpreterForPlaceholder=U=>E.l10n.t("Selected Environment {0}",U),x.jupyterNotSupported=U=>E.l10n.t("Jupyter cannot be started. Error attempting to locate Jupyter: {0}",U),x.jupyterNotebookNotInstalledOrNotFound=U=>{if(U){let je=Iie(U);return E.l10n.t("Failed to start Jupyter Server as the packages 'jupyter' and 'notebook' could not be located in the Python environment '{0}'.",je)}else return E.l10n.t("Failed to start Jupyter Server as the packages 'jupyter' and 'notebook' could not be located in the Python environment.")},x.jupyterNotSupportedBecauseOfEnvironment=(U,je)=>E.l10n.t("Activating {0} to run Jupyter failed with {1}",U,je),x.jupyterNbConvertNotSupported=E.l10n.t("Jupyter nbconvert is not installed"),x.jupyterLaunchTimedOut=E.l10n.t("The Jupyter notebook server failed to launch in time"),x.jupyterLaunchNoURL=E.l10n.t("Failed to find the URL of the launched Jupyter notebook server"),x.jupyterSelfCertFail=U=>E.l10n.t(`The security certificate used by server {0} was not issued by a trusted certificate authority.\r
This may indicate an attempt to steal your information.\r
Do you want to enable the Allow Unauthorized Remote Connection setting for this workspace to allow you to connect?`,U),x.jupyterExpiredCertFail=U=>E.l10n.t(`The security certificate used by server {0} has expired.\r
This may indicate an attempt to steal your information.\r
Do you want to enable the Allow Unauthorized Remote Connection setting for this workspace to allow you to connect?`,U),x.jupyterSelfCertFailErrorMessageOnly=E.l10n.t(`The security certificate used by server was not issued by a trusted certificate authority.\r
This may indicate an attempt to steal your information.`),x.jupyterSelfCertExpiredErrorMessageOnly=E.l10n.t(`The security certificate used by server has expired.\r
This may indicate an attempt to steal your information.`),x.jupyterSelfCertEnable=E.l10n.t("Yes, connect anyways"),x.jupyterSelfCertClose=E.l10n.t("No, close the connection"),x.pythonInteractiveHelpLink=E.l10n.t("See <https://aka.ms/pyaiinstall> for help on installing Jupyter."),x.importingFormat=U=>E.l10n.t("Importing {0}",U),x.startingJupyter=E.l10n.t("Starting Jupyter Server"),x.connectingToKernel=U=>E.l10n.t("Connecting to kernel: {0}",U),x.connectingToJupyter=E.l10n.t("Connecting to Jupyter Server"),x.exportingFormat=U=>E.l10n.t("Exporting {0}",U),x.runAllCellsLensCommandTitle=E.l10n.t("Run All Cells"),x.runAllCellsAboveLensCommandTitle=E.l10n.t("Run Above"),x.runCellAndAllBelowLensCommandTitle=E.l10n.t("Run Below"),x.restartKernelMessage=E.l10n.t("Do you want to restart the Jupyter kernel? All variables will be lost."),x.restartKernelMessageYes=E.l10n.t("Restart"),x.restartKernelMessageDontAskAgain=E.l10n.t("Don't Ask Again"),x.automaticallyReconnectingToAKernelProgressMessage=U=>E.l10n.t("Reconnecting to the kernel {0}",U),x.restartingKernelStatus=U=>E.l10n.t("Restarting Kernel {0}",U),x.interruptingKernelFailed=E.l10n.t("Kernel interrupt failed. Jupyter Server is hung. Please reload VS Code."),x.sessionStartFailedWithKernel=U=>E.l10n.t({message:`Failed to start the Kernel '{0}'. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[U],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),x.failedToStartJupyter=U=>E.l10n.t({message:`Failed to start Jupyter in the environment '{0}'. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[U],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),x.failedToStartJupyterWithErrorInfo=(U,je)=>E.l10n.t({message:`Failed to start Jupyter in the environment '{0}'. 
{1} 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[U,je],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),x.failedToStartJupyterDueToOutdatedTraitlets=(U,je)=>E.l10n.t({message:`Failed to start Jupyter in the environment '{0}' possibly due to an outdated version of 'traitlets'. 
{1} 
Consider updating the 'traitlets' module to '5.1.1' or later. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[U,je],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel',"Do not translate the text 'traitlets', that is a Python module name"]}),x.failedToStartKernel=E.l10n.t("Failed to start the Kernel."),x.failedToRestartKernel=E.l10n.t("Failed to restart the Kernel."),x.failedToInterruptKernel=E.l10n.t("Failed to interrupt the Kernel."),x.rawKernelStartFailedDueToTimeout=U=>E.l10n.t({message:`Unable to start Kernel '{0}' due to a connection timeout. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[U],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),x.rawKernelStartFailedDueToTimeoutWaitingForPort=U=>E.l10n.t({message:`Unable to start Kernel '{0}' due to a timeout waiting for the ports to get used. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[U],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),x.viewJupyterLogForFurtherInfo=E.l10n.t({message:"View Jupyter [log](command:jupyter.viewOutput) for further details.",comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),x.kernelDied=U=>E.l10n.t({message:"The kernel died. Error: {0}... View Jupyter [log](command:jupyter.viewOutput) for further details.",args:[U],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),x.kernelDiedWithoutError=U=>E.l10n.t({message:"The kernel '{0}' died. Click [here](https://aka.ms/vscodeJupyterKernelCrash) for more info. View Jupyter [log](command:jupyter.viewOutput) for further details.",args:[U],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel',"Do not translate the link https://aka.ms/vscodeJupyterKernelCrash"]}),x.failedToStartAnUntrustedKernelSpec=(U,je)=>E.l10n.t({message:`The kernel '{0}' was not started as it is located in an insecure location '{1}'.  
Click [here](https://aka.ms/JupyterTrustedKernelPaths) for further details, optionally update the setting [jupyter.kernels.trusted](command:workbench.action.openSettings?["jupyter.kernels.trusted"]) to trust the kernel.`,args:[U,je],comment:['Do not translate the text "jupyter.kernels.trusted", that is a setting in VS Code','Do not translate the text command:workbench.action.openSettings?["jupyter.kernels.trusted"], that is a command Id that will be used by VS Code to open the output panel',"Do not translate the link https://aka.ms/JupyterTrustedKernelPaths"]}),x.kernelDiedWithoutErrorAndAutoRestarting=U=>E.l10n.t({message:"The kernel '{0}' died and is being automatically restarted by Jupyter. Click [here](https://aka.ms/vscodeJupyterKernelCrash) for more info. View Jupyter [log](command:jupyter.viewOutput) for further details.",args:[U],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel',"Do not translate the link https://aka.ms/vscodeJupyterKernelCrash"]}),x.kernelCrashedDueToCodeInCurrentOrPreviousCell=E.l10n.t({message:`The Kernel crashed while executing code in the current cell or a previous cell. 
Please review the code in the cell(s) to identify a possible cause of the failure. 
Click <a href='https://aka.ms/vscodeJupyterKernelCrash'>here</a> for more info. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel',"Do not translate the link https://aka.ms/vscodeJupyterKernelCrash"]}),x.kernelDisconnected=U=>E.l10n.t("Unable to connect to the kernel '{0}', please verify the Jupyter Server connection. View Jupyter [log](command:jupyter.viewOutput) for further details.",U),x.cannotRunCellKernelIsDead=U=>E.l10n.t("Cannot run cells, as the kernel '{0}' is dead.",U),x.showJupyterLogs=E.l10n.t("Show Jupyter Logs."),x.restartKernel=E.l10n.t("Restart Kernel"),x.reloadRequired=E.l10n.t("Please reload the window for new settings to take effect."),x.restartedKernelHeader=U=>E.l10n.t("Restarted {0}",U),x.connectedKernelHeader=U=>E.l10n.t("Connected to {0}",U),x.restartingKernelCustomHeader=U=>E.l10n.t("_Restarting {0}..._",U),x.restartingKernelHeader=E.l10n.t("_Restarting kernel..._"),x.startingNewKernelHeader=E.l10n.t("_Connecting to kernel..._"),x.startingNewKernelCustomHeader=U=>E.l10n.t("_Connecting to {0}..._",U),x.noKernelConnected=E.l10n.t("No kernel connected"),x.jupyterSelectUriCommandLabel=E.l10n.t("Enter the URL of the running Jupyter Server..."),x.jupyterSelectUriInputTitle=E.l10n.t("Enter the URL of the running Jupyter Server"),x.jupyterSelectUriInputPlaceholder=E.l10n.t("Enter the URL of the running Jupyter Server"),x.connectToToTheJupyterServer=U=>E.l10n.t("Connect to the Jupyter Server {0}",U),x.enterOrSelectRemoteJupyterPlaceholder=E.l10n.t("Enter a remote URL, or select a remote server"),x.selectRemoteJupyterPlaceholder=E.l10n.t("Select a remote server"),x.jupyterServerLastConnectionForQuickPickDescription=U=>E.l10n.t("Last connected {0}",Wh(U,!0,!1,!1)),x.jupyterServerNotUsedBeforeQuickPickSeparatorTitle=E.l10n.t("Jupyter Servers"),x.jupyterSelectURIInvalidURI=E.l10n.t("Invalid URL specified"),x.jupyterSelectURIMustBeHttpOrHttps=E.l10n.t("Invalid protocol in URL specified, only HTTP or HTTPS are supported."),x.jupyterSelectLiveRemoteKernelDescription=(U,je)=>U?je===0?E.l10n.t("Last activity {0}",Wh(U,!0,!1,!1)):je===1?E.l10n.t("Last activity {0}, 1 connection",Wh(U,!0,!1,!1)):E.l10n.t("Last activity {0}, {1} connections",Wh(U,!0,!1,!1),je.toString()):je===0?"":je===1?E.l10n.t("1 connection"):E.l10n.t("{0} connections",je.toString()),x.installJupyterHub=E.l10n.t("Install the JupyterHub extension to connect to JupyterHub servers."),x.useJupyterHubExtension=E.l10n.t("Select 'Existing JupyterHub Server...' from the Kernel Picker"),x.useJupyterHubExtensionDetail=E.l10n.t("Use this option when connecting to JupyterHub servers"),x.installJupyterHubDetail=E.l10n.t("Once installed, open the Kernel Picker and select 'Existing JupyterHub Server...'"),x.jupyterSelectUserAndPasswordTitle=E.l10n.t("Enter your user name and password to connect to Jupyter Hub"),x.jupyterRenameServer=E.l10n.t("Change Server Display Name (Leave Blank To Use URL)"),x.jupyterServerUriDisplayNameInputPlaceholder=E.l10n.t("Enter a display name"),x.jupyterSelectUserPrompt=E.l10n.t("Enter your user name"),x.jupyterSelectPasswordPrompt=E.l10n.t("Enter your password"),x.jupyterSelectPasswordTitle=E.l10n.t("Enter your password for the Jupyter Server"),x.pythonNotInstalled=E.l10n.t(`Python is not installed. 
Please download and install Python in order to execute cells in this notebook. 
Once installed please reload VS Code.`),x.pleaseReloadVSCodeOncePythonHasBeenInstalled=E.l10n.t("Upon installing Python please reload VS Code."),x.jupyterNotebookFailure=U=>E.l10n.t(`Jupyter notebook failed to launch. \r
{0}`,U),x.remoteJupyterServerProvidedBy3rdPartyExtensionNoLongerValid=U=>E.l10n.t("The remote Jupyter Server contributed by the extension '{0}' is no longer available.",U),x.remoteJupyterConnectionFailedWithServerWithError=(U,je)=>E.l10n.t("Failed to connect to the remote Jupyter Server '{0}'. Verify the server is running and reachable. ({1}).",U,je),x.remoteJupyterConnectionFailedWithServer=U=>E.l10n.t("Failed to connect to the remote Jupyter Server '{0}'. Verify the server is running and reachable.",U),x.remoteJupyterConnectionFailedWithoutServerWithError=U=>E.l10n.t("Connection failure. Verify the server is running and reachable. ({0}).",U),x.remoteJupyterConnectionFailedWithoutServerWithErrorWeb=U=>E.l10n.t(`Connection failure. Verify the server is running and reachable from a browser. ({0}). 
When connecting from vscode.dev Jupyter servers must be started with specific options to connect. 
Click [here](https://aka.ms/vscjremoteweb) for more information.`,U),x.removeRemoteJupyterConnectionButtonText=E.l10n.t("Forget Connection"),x.jupyterNotebookRemoteConnectFailedWeb=U=>E.l10n.t(`Failed to connect to remote Jupyter Server.\r
Check that the Jupyter Server URL can be reached from a browser.\r
{0}. Click [here](https://aka.ms/vscjremoteweb) for more information.`,U),x.packageNotInstalledWindowsLongPathNotEnabledError=(U,je)=>E.l10n.t(`Support for Windows Long Path has not been enabled, hence the package {0} could not be installed into the Python Environment '{1}'.
Please ensure that support for Windows Long Path is enabled.
See [here](https://pip.pypa.io/warnings/enable-long-paths) for more information.`,U,je),x.changeRemoteJupyterConnectionButtonText=E.l10n.t("Manage Connections"),x.rawConnectionBrokenError=E.l10n.t("Direct kernel connection broken"),x.jupyterServerCrashed=U=>E.l10n.t(`Jupyter Server crashed. Unable to connect. \r
Error code from Jupyter: {0}`,U.toString()),x.jupyterKernelSpecModuleNotFound=U=>E.l10n.t(`'Kernelspec' module not installed in the selected interpreter ({0}).
 Please re-install or update 'jupyter'.`,U),x.interruptKernelStatus=U=>E.l10n.t("Interrupting Kernel {0}",U),x.exportPythonQuickPickLabel=E.l10n.t("Python Script"),x.exportHTMLQuickPickLabel=E.l10n.t("HTML"),x.exportPDFQuickPickLabel=E.l10n.t("PDF"),x.restartKernelAfterInterruptMessage=U=>E.l10n.t("Interrupting the kernel '{0}' timed out. Do you want to restart the kernel instead? All variables will be lost.",U),x.documentMismatch=U=>E.l10n.t("Cannot run cells, duplicate documents for {0} found.",U),x.jupyterGetVariablesBadResults=E.l10n.t("Failed to fetch variable info from the Jupyter Server."),E.l10n.t("Failure to create an 'Interactive' window. Try reinstalling the Python Extension."),x.jupyterGetVariablesExecutionError=U=>E.l10n.t(`Failure during variable extraction: \r
{0}`,U),x.selectKernel=E.l10n.t("Change Kernel"),x.selectDifferentKernel=E.l10n.t("Select a different Kernel"),x.kernelFilterPlaceholder=E.l10n.t("Choose the kernels that are available in the kernel picker."),x.recommendedItemCategoryInQuickPick=E.l10n.t("Recommended"),x.selectedKernelCategoryInQuickPick=E.l10n.t("Selected"),x.createPythonEnvironmentInQuickPick=E.l10n.t("Create Python Environment"),x.createPythonEnvironmentInQuickPickTooltip=E.l10n.t("Create an isolated Python Environment per workspace folder"),x.selectDifferentJupyterInterpreter=E.l10n.t("Change Interpreter"),x.pandasTooOldForViewingFormat=(U,je)=>E.l10n.t({message:"Python package 'pandas' is version {0}. Version {1} or greater is required for viewing data.",args:[U,je],comment:["Do not translate 'pandas' as that is a Python module name"]}),x.pandasRequiredForViewing=U=>E.l10n.t({message:"Python package 'pandas' version {0} (or above) is required for viewing data.",args:[U],comment:["Do not translate 'pandas' as that is a Python module name"]}),x.tooManyColumnsMessage=E.l10n.t("Variables with over a 1000 columns may take a long time to display. Are you sure you wish to continue?"),x.tooManyColumnsYes=E.l10n.t("Yes"),x.tooManyColumnsNo=E.l10n.t("No"),x.tooManyColumnsDontAskAgain=E.l10n.t("Don't Ask Again"),x.plotViewerTitle=E.l10n.t("Plots"),x.exportPlotTitle=E.l10n.t("Save plot image"),x.pdfFilter="PDF",x.pngFilter="PNG",x.svgFilter="SVG",x.exportImageFailed=U=>E.l10n.t("Error exporting image: {0}",U),x.jupyterDataRateExceeded=E.l10n.t({message:"Cannot view variable because data rate exceeded. Please restart your server with a higher data rate limit. For example, --NotebookApp.iopub_data_rate_limit=10000000000.0",comment:["Do not translate the text --NotebookApp.iopub_data_rate_limit=10000000000.0 as that is a command argument."]}),x.addCellBelowCommandTitle=E.l10n.t("Add cell"),x.debugCellCommandTitle=E.l10n.t("Debug Cell"),x.debugStepOverCommandTitle=E.l10n.t("Step over"),x.debugContinueCommandTitle=E.l10n.t("Continue"),x.debugStopCommandTitle=E.l10n.t("Stop"),x.runCurrentCellAndAddBelow=E.l10n.t("Run current cell and add empty cell below"),x.jupyterDebuggerNotInstalledError=U=>E.l10n.t("Pip module {0} is required for debugging cells. You will need to install it to debug cells.",U),x.jupyterDebuggerOutputParseError=U=>E.l10n.t("Unable to parse {0} output, please log an issue with https://github.com/microsoft/vscode-jupyter",U),x.cellStopOnErrorMessage=E.l10n.t("Cell was canceled due to an error in a previous cell."),x.scrollToCellTitleFormatMessage=U=>E.l10n.t("Go to [{0}]",U.toString()),x.instructionComments=U=>E.l10n.t(`# To add a new cell, type '{0}'
# To add a new markdown cell, type '{0} [markdown]'
`,U),x.exportButtonTitle=E.l10n.t("Export"),x.exportAsQuickPickPlaceholder=E.l10n.t("Export As..."),x.openExportedFileMessage=E.l10n.t("Would you like to open the exported file?"),x.openExportFileYes=E.l10n.t("Yes"),x.openExportFileNo=E.l10n.t("No"),x.exportFailedGeneralMessage=E.l10n.t({message:"Please check the 'Jupyter' [output](command:jupyter.viewOutput) panel for further details.",comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),x.exportToPDFDependencyMessage=E.l10n.t(`If you have not installed xelatex (TeX), you will need to do so before you can export to PDF. For further instructions, please see https://nbconvert.readthedocs.io/en/latest/install.html#installing-tex. \r
To avoid installing xelatex (TeX), you might want to try exporting to HTML and using your browser's "Print to PDF" feature.`),x.failedExportMessage=E.l10n.t("Export failed."),x.startingJupyterLogMessage=(U,je)=>E.l10n.t("Starting Jupyter from {0} with arguments {1}",U,je),x.waitingForJupyterSessionToBeIdle=E.l10n.t("Waiting for Jupyter Session to be idle"),x.gettingListOfKernelsForRemoteConnection=E.l10n.t("Fetching Kernels"),x.gettingListOfKernelSpecs=E.l10n.t("Fetching Kernel specs"),x.startingJupyterNotebook=E.l10n.t("Starting Jupyter Notebook"),x.registeringKernel=E.l10n.t("Registering Kernel"),x.jupyterCommandLineReloadQuestion=E.l10n.t("Please reload the window when changing the Jupyter command line."),x.jupyterCommandLineReloadAnswer=E.l10n.t("Reload"),x.createdNewKernel=(U,je)=>E.l10n.t("{0}: Kernel started: {1}",U,je),x.kernelInvalid=U=>E.l10n.t("Kernel {0} is not usable. Check the Jupyter output tab for more information.",U),x.removeRemoteJupyterServerEntryInQuickPick=E.l10n.t("Remove"),x.loadClassFailedWithNoInternet=(U,je)=>E.l10n.t("Error loading {0}:{1}. Internet connection required for loading 3rd party widgets.",U,je),x.useCDNForWidgetsNoInformation=E.l10n.t("Widgets require us to download supporting files from a 3rd party website."),x.enableCDNForWidgetsSetting=(U,je)=>E.l10n.t("Widgets require us to download supporting files from a 3rd party website. (Error loading {0}:{1}).",U,je),x.enableCDNForWidgetsButton=E.l10n.t("Enable Downloads"),x.unhandledMessage=(U,je)=>E.l10n.t("Unhandled kernel message from a widget: {0} : {1}",U,je),x.cdnWidgetScriptNotAccessibleWarningMessage=(U,je)=>E.l10n.t("Unable to download widget '{0}' from 3rd party website {1}, due to network access. Expected behavior may be affected. Click [here](https://aka.ms/PVSCIPyWidgets) for more information.",U,je),x.widgetScriptNotFoundOnCDNWidgetMightNotWork=(U,je,rC)=>E.l10n.t("Unable to find widget '{0}' version '{1}' from configured widget sources {2}. Expected behavior may be affected. Click [here](https://aka.ms/PVSCIPyWidgets) for more information.",U,je,rC),x.insecureSessionMessage=E.l10n.t("Connecting over HTTP without a token may be an insecure connection. Do you want to connect to a possibly insecure server?"),x.insecureSessionDenied=E.l10n.t("Denied connection to insecure server."),x.selectKernelForEditor=E.l10n.t("[Select a kernel](command:_notebook.selectKernel) to run cells."),x.needIpykernel6=E.l10n.t("Ipykernel setup required for this feature"),x.setup=E.l10n.t("Setup"),x.showDataViewerFail=E.l10n.t("Failed to create the Data Viewer. Check the Jupyter tab of the Output window for more info."),x.defaultNotebookName=E.l10n.t("default"),x.recommendExtensionForNotebookLanguage=(U,je)=>E.l10n.t("The {0} extension is recommended for notebooks targeting the language '{1}'",U,je),x.kernelWasNotStarted=E.l10n.t("Kernel was not started. A kernel session is needed to start debugging."),x.noNotebookToDebug=E.l10n.t("No active notebook document to debug."),x.cantStartDebugging=E.l10n.t("Can't start debugging."),x.restartNotSupported=E.l10n.t("Restarting is not supported in the interactive window."),x.importingIpynb=E.l10n.t("Importing notebook file"),x.exportingToFormat=U=>E.l10n.t("Exporting to {0}",U),x.kernelCategoryForJupyterSession=E.l10n.t("Jupyter Session"),x.kernelDefaultRemoteDisplayName=E.l10n.t("Remote"),x.kernelCategoryForJupyterKernel=E.l10n.t("Jupyter Kernel"),x.kernelCategoryForRemoteJupyterKernel=E.l10n.t("Jupyter Kernel"),x.kernelCategoryForConda=E.l10n.t("Conda Env"),x.kernelCategoryForCondaWithoutPython=E.l10n.t("Conda Env Without Python"),x.kernelCategoryForPoetry=E.l10n.t("Poetry Env"),x.kernelCategoryForPipEnv=E.l10n.t("Pipenv Env"),x.kernelCategoryForPyEnv=E.l10n.t("PyEnv Env"),x.kernelCategoryForGlobal=E.l10n.t("Global Env"),x.kernelCategoryForVirtual=E.l10n.t("Virtual Env"),x.fileSeemsToBeInterferingWithKernelStartup=U=>E.l10n.t("The file '{0}' seems to be overriding built in modules and interfering with the startup of the kernel. Consider renaming the file and starting the kernel again.",U),x.moduleSeemsToBeInterferingWithKernelStartup=U=>E.l10n.t("The module '{0}' seems to be overriding built in modules and interfering with the startup of the kernel. Consider renaming the folder and starting the kernel again.",U),x.pipCondaInstallHoverWarning=(U,je)=>E.l10n.t("'!{0} install' could install packages into the wrong environment. [More info]({1})",U,je),x.percentPipCondaInstallInsteadOfBang=U=>E.l10n.t({message:"Use '%{0} install' instead of '!{0} install'",args:[U],comment:['Do not translate the string within quotes, such as "%{0} install" and "!{0} install" as that is a Jupyter Shell Magic command']}),x.replacePipCondaInstallCodeAction=U=>E.l10n.t("Replace with '%{0} install'",U),x.failedToStartKernelDueToMissingModule=U=>E.l10n.t("The kernel failed to start due to the missing module '{0}'. Consider installing this module.",U),x.failedToStartKernelDueToImportFailure=U=>E.l10n.t("The kernel failed to start as the module '{0}' could not be imported.",U),x.failedToStartKernelDueToImportFailureFromFile=(U,je)=>E.l10n.t("The kernel failed to start as '{0}' could not be imported from '{1}'.",U,je),x.failedToStartKernelDueToUnknownDllLoadFailure=E.l10n.t("The kernel failed to start as a dll could not be loaded."),x.failedToStartKernelDueToDllLoadFailure=U=>E.l10n.t("The kernel failed to start as the dll '{0}' could not be loaded.",U),x.failedToStartKernelDueToWin32APIFailure=E.l10n.t("The kernel failed to start due to an error with the Win32api module. Consider (re) installing this module."),x.failedToStartKernelDueToPyZmqFailure=E.l10n.t({message:"The kernel failed to start due to an error with the 'pyzmq' module. Consider re-installing this module.",comment:['Do not translate the string "pyzmq" as that is a Python module.']}),x.failedToStartKernelDueToOldIPython=E.l10n.t("The kernel failed to start due to an outdated version of IPython. Consider updating this module to the latest version."),x.failedToStartKernelDueToOldIPyKernel=E.l10n.t("The kernel failed to start due to an outdated version of IPyKernel. Consider updating this module to the latest version."),x.failedToStartKernelDueToMissingPythonEnv=U=>E.l10n.t("The kernel failed to start as the Python Environment '{0}' is no longer available. Consider selecting another kernel or refreshing the list of Python Environments.",U),x.matplotlibWidgetInsteadOfOther=E.l10n.t("'%matplotlib' widget works best inside of VS Code"),x.matplotlibWidgetCodeActionTitle=E.l10n.t("More info"),x.allowExtensionToUseJupyterKernelApi=(U,je)=>E.l10n.t("Do you want to give the extension '{0}' access to the Jupyter Kernels? Clicking '{1}' would allow this extension to execute code against the Jupyter Kernels.",U,je),x.thanksForUsingJupyterKernelApiPleaseRegisterWithUs=U=>E.l10n.t("Thank you for trying the Jupyter API. Please file an issue on our repo to allow the extension {0} to use this API in production. This would prevent us from breaking your extension when updating the API (as it is still a work in progress).",U),x.activatingPythonEnvironment=U=>E.l10n.t("Activating Python Environment '{0}'",U),x.runningKernelStartupHooksFor=U=>E.l10n.t("Running Kernel startup hooks in '{0}'",U),x.cellAtFormat=(U,je)=>E.l10n.t("{0} Cell {1}",U,je),x.jupyterServerConsoleOutputChannel=E.l10n.t("Jupyter Server Console"),x.kernelConsoleOutputChannel=U=>E.l10n.t("{0} Kernel Console Output",U),x.webNotSupported=E.l10n.t("Operation not supported in web version of Jupyter Extension."),x.failedToInstallPythonExtension=E.l10n.t("Failed to install the Python Extension."),x.filesPossiblyOverridingPythonModulesMayHavePreventedKernelFromStarting=U=>E.l10n.t("Some of the following files found in the working directory may have prevented the Kernel from starting. Consider renaming them.",U),x.listOfFilesWithLinksThatMightNeedToBeRenamed=U=>E.l10n.t("File(s): {0} might need to be renamed.",U),x.failedToGetVersionOfPandas=E.l10n.t("Failed to get version of Pandas to use the Data Viewer."),x.failedToInstallPandas=E.l10n.t("Failed to install Pandas to use the Data Viewer."),x.localKernelSpecs=E.l10n.t("Jupyter Kernel..."),x.localPythonEnvironments=E.l10n.t("Python Environments..."),x.quickPickTitleForSelectionOfJupyterServer=E.l10n.t("Select a Jupyter Server"),x.UserJupyterServerUrlProviderDisplayName=E.l10n.t("Existing Jupyter Server..."),x.UserJupyterServerUrlProviderDetail=E.l10n.t("Connect to an existing Jupyter Server"),x.kernelPickerSelectKernelTitle=E.l10n.t("Select Kernel"),x.kernelPickerSelectLocalKernelSpecTitle=E.l10n.t("Select a Jupyter Kernel"),x.quickPickSelectPythonEnvironmentTitle=E.l10n.t("Select a Python Environment"),x.kernelPickerSelectKernelFromRemoteTitle=U=>E.l10n.t("Select a Kernel from {0}",U),x.kernelPickerSelectKernelFromRemoteTitleWithoutName=E.l10n.t("Select a Jupyter Kernel"),x.installPythonExtensionViaKernelPickerTitle=E.l10n.t("Install Python Extension"),x.installPythonExtensionViaKernelPickerToolTip=E.l10n.t("Python Extension is required to detect and use Python environments for the execution of code cells."),x.installPythonQuickPickTitle=E.l10n.t("Install Python"),x.installPythonQuickPickToolTip=E.l10n.t("Python Environments not detected. Upon installation reload VS Code or refresh the list of Kernels."),x.failedToFetchKernelSpecsRemoteErrorMessageForQuickPickLabel=E.l10n.t({message:"$(error) Unable to connect to the remote server",comment:"Do not translate the string $(error) as that is a VS Code icon."}),x.failedToFetchKernelSpecsRemoteErrorMessageForQuickPickDetail=E.l10n.t("Ensure the server is running and reachable."),x.dataViewerDeprecationMessage=E.l10n.t("The built-in data viewer will be deprecated soon. Please install other data viewing extensions to keep the ability to inspect data."),x.dataViewerDeprecationRecommendationActionMessage=E.l10n.t("See Recommended Extensions"),x.dataViewerExtensionRequired=E.l10n.t("A Data Viewer Extension is required to view data frames. Click Yes to see recommended extensions."),x.selectExternalDataViewer=E.l10n.t("Select DataFrame Viewer")))(y||={});var Ft;(ve=>(ve.collapseSingle=E.l10n.t("Collapse"),ve.expandSingle=E.l10n.t("Expand"),ve.noRowsInDataViewer=E.l10n.t("No rows match current filter"),ve.sliceIndexError=E.l10n.t({message:"Index {0} out of range for axis {1} with {2} elements",comment:["Do not translate the strings {0}, {1} and {2} as they are variable names and will be replaced later"]}),ve.sliceMismatchedAxesError=E.l10n.t({message:"Expected {0} axes, got {1} in slice expression",comment:["Do not translate the strings {0} and {2} as they are variable names and will be replaced later"]}),ve.fetchingDataViewer=E.l10n.t("Fetching data ..."),ve.dataViewerHideFilters=E.l10n.t("Hide filters"),ve.dataViewerShowFilters=E.l10n.t("Show filters"),ve.refreshDataViewer=E.l10n.t("Refresh data viewer"),ve.sliceSummaryTitle=E.l10n.t("SLICING"),ve.sliceData=E.l10n.t("Slice Data"),ve.sliceSubmitButton=E.l10n.t("Apply"),ve.sliceDropdownAxisLabel=E.l10n.t("Axis"),ve.sliceDropdownIndexLabel=E.l10n.t("Index"),ve.variableExplorerNameColumn=E.l10n.t("Name"),ve.variableExplorerTypeColumn=E.l10n.t("Type"),ve.variableExplorerCountColumn=E.l10n.t("Size"),ve.variableExplorerValueColumn=E.l10n.t("Value"),ve.collapseVariableExplorerLabel=E.l10n.t("Variables"),ve.variableLoadingValue=E.l10n.t("Loading..."),ve.showDataExplorerTooltip=E.l10n.t("Show variable snapshot in data viewer"),ve.noRowsInVariableExplorer=E.l10n.t("No variables defined"),ve.loadingRowsInVariableExplorer=E.l10n.t("Loading variables"),ve.previousPlot=E.l10n.t("Previous"),ve.nextPlot=E.l10n.t("Next"),ve.panPlot=E.l10n.t("Pan"),ve.zoomInPlot=E.l10n.t("Zoom in"),ve.zoomOutPlot=E.l10n.t("Zoom out"),ve.exportPlot=E.l10n.t("Export to different formats"),ve.deletePlot=E.l10n.t("Remove"),ve.selectedImageListLabel=E.l10n.t("Selected Image"),ve.selectedImageLabel=E.l10n.t("Image"),ve.errorOutputExceedsLinkToOpenFormatString=E.l10n.t({message:"Output exceeds the <a href={0}>size limit</a>. Open the full output data <a href={1}>in a text editor</a>",comment:['Do not translate the the Hyperlink text "<a href={0}>size limit</a>" and "<a href={1}>in a text editor</a>". However the text inside those tags can be translated']}),ve.dvDeprecationWarning=E.l10n.t('The built-in data viewer will be deprecated and no longer usable starting with Visual Studio Code 1.92. Please <a href="command:workbench.extensions.search?%22@tag:jupyterVariableViewers%22">install other data viewing extensions</a> to continue inspecting data')))(Ft||={});var TC;(r=>(r.SHOW_DEPRECATED_FEATURE_PROMPT_FORMAT_ON_SAVE=E.l10n.t({message:"The setting 'python.formatting.formatOnSave' is deprecated, please use 'editor.formatOnSave'.",comment:['Do not translate the string "python.formatting.formatOnSave" as that is a setting in VS Code','Do not translate the string "editor.formatOnSave" as that is a setting in VS Code']}),r.SHOW_DEPRECATED_FEATURE_PROMPT_LINT_ON_TEXT_CHANGE=E.l10n.t({message:"The setting 'python.linting.lintOnTextChange' is deprecated, please enable 'python.linting.lintOnSave' and 'files.autoSave'.",comment:['Do not translate the string "python.linting.lintOnTextChange" as that is a setting in VS Code','Do not translate the string "python.linting.lintOnSave" as that is a setting in VS Code']}),r.SHOW_DEPRECATED_FEATURE_PROMPT_FOR_AUTO_COMPLETE_PRELOAD_MODULES=E.l10n.t({message:"The setting 'python.autoComplete.preloadModules' is deprecated, please consider using Pylance Language Server ('python.languageServer' setting).",comment:['Do not translate the string "python.autoComplete.preloadModules" as that is a setting in VS Code','Do not translate the string "python.languageServer" as that is a setting in VS Code']})))(TC||={});var Yh;(r=>(r.noCondaOrPipInstaller=E.l10n.t("There is no Conda or Pip installer available in the selected environment."),r.noPipInstaller=E.l10n.t("There is no Pip installer available in the selected environment."),r.searchForHelp=E.l10n.t("Search for help")))(Yh||={});var _N;(e=>e.installingModule=t=>E.l10n.t("Installing {0}",t))(_N||={});var K2=TN(),Ek=class{constructor(e,t,r){this.channel=e;this.homeReplaceRegEx=t,this.userNameReplaceRegEx=r}format(e,t,...r){let i=e?`${xP()} [${e}] ${K2(t,...r)}`:K2(t,...r);return this.homeReplaceRegEx&&(i=i.replace(this.homeReplaceRegEx,"~")),this.userNameReplaceRegEx&&(i=i.replace(this.userNameReplaceRegEx,"<username>")),i}error(e,...t){this.channel.appendLine(this.format("error",e,...t))}warn(e,...t){this.channel.appendLine(this.format("warn",e,...t))}info(e,...t){this.channel.appendLine(this.format("info",e,...t))}debug(e,...t){this.channel.appendLine(this.format("debug",e,...t))}trace(e,...t){this.channel.appendLine(this.format("trace",e,...t))}ci(e,...t){}};var O2=TN();function RC(n,e,...t){let i=[...t].length===0?O2(e):O2(e,...t);return n?`${n} ${xP()}: ${i}`:i}var wk=class{constructor(e){this.prefix=e}error(e,...t){console.error(RC("error",`${this.prefix||""} ${e}`,...t))}warn(e,...t){console.warn(RC("warn",`${this.prefix||""} ${e}`,...t))}info(e,...t){console.info(RC("info",`${this.prefix||""} ${e}`,...t))}debug(e,...t){console.log(RC("debug",`${this.prefix||""} ${e}`,...t))}trace(e,...t){console.trace(RC("trace",`${this.prefix||""} ${e}`,...t))}ci(e,...t){}};var kk="",W2=3,bd=[],Id=sr.LogLevel.Info,p={error:(n,...e)=>Sie(n,...e),warn:(n,...e)=>$2(n,...e),info:(n,...e)=>Cie(n,...e),debug:(n,...e)=>Eie(n,...e),trace:(n,...e)=>wie(n,...e),ci:(n,...e)=>{e&&Array.isArray(e)?U2(n,...e):U2(n)}};function V2(n){Id=L2(),pa(sr.workspace.onDidChangeConfiguration(t=>{t.affectsConfiguration("jupyter.logging")&&(Id=L2())}));let e=sr.window.createOutputChannel(PN.jupyter,"log");return F2(new Ek(e,n?.homePathRegEx,n?.userNameRegEx)),n.addConsoleLogger&&F2(new wk(qn?void 0:"Jupyter Extension:")),e}function F2(n){return bd.push(n),{dispose:()=>{bd=bd.filter(e=>e!==n)}}}function L2(){try{let{level:n}=sr.workspace.getConfiguration("jupyter").get("logging",{level:"Info"});switch(n){case"debug":case"Debug":return sr.LogLevel.Debug;case"warn":case"Warn":case"warning":case"Warning":return sr.LogLevel.Warning;case"Off":case"off":return sr.LogLevel.Off;case"Error":case"error":return sr.LogLevel.Error;case"Trace":case"trace":return sr.LogLevel.Trace;default:return sr.LogLevel.Info}}catch(n){return console.error("Failed to get logging level from configuration",n),sr.LogLevel.Info}}function j2(n){kk=n.toLowerCase()}function B2(...n){return Id<=sr.LogLevel.Debug?n:n.map(t=>{if(!(t instanceof Error)||!("isJupyterError"in t))return t;let r=[`${t.name}: ${t.message}`.trim()];if("kernelConnectionMetadata"in t&&t.kernelConnectionMetadata&&typeof t.kernelConnectionMetadata=="object"&&"id"in t.kernelConnectionMetadata&&(r.push(`Kernel Id = ${t.kernelConnectionMetadata.id}`),"interpreter"in t.kernelConnectionMetadata&&t.kernelConnectionMetadata.interpreter&&typeof t.kernelConnectionMetadata.interpreter=="object"&&"id"in t.kernelConnectionMetadata.interpreter&&typeof t.kernelConnectionMetadata.interpreter.id=="string"&&r.push(`Interpreter Id = ${M(t.kernelConnectionMetadata.interpreter.id)}`)),t.stack){let o=Be(t.stack),s=o.find(a=>a.indexOf("at ")===0);o.length===1||(o.length===1?r.push(o[0]):o.length>1&&s?.length?r.push(s):r.push(o[0]))}let i=["stack","message","name","kernelConnectionMetadata","category","exitCode","isJupyterError"];return Object.keys(t).filter(o=>i.indexOf(o)===-1).forEach(o=>r.push(`${o} = ${String(t[o]).trim()}`)),r.filter(o=>o.trim().length).map((o,s)=>s===0?o:`    > ${o}`).join(`
`)})}function Sie(n,...e){Id<=sr.LogLevel.Error&&(e=B2(...e),bd.forEach(t=>t.error(n,...e)))}function $2(n,...e){Id<=sr.LogLevel.Warning&&(e=B2(...e),bd.forEach(t=>t.warn(n,...e)))}function Cie(n,...e){Id<=sr.LogLevel.Info&&bd.forEach(t=>t.info(n,...e))}function Eie(n,...e){Id<=sr.LogLevel.Debug&&bd.forEach(t=>t.debug(n,...e))}function wie(n,...e){Id<=sr.LogLevel.Trace&&bd.forEach(t=>t.trace(n,...e))}function U2(n,...e){if(qn)if(typeof n=="function"){let r=n(),i="",o=[];typeof r=="string"?i=r:(i=r.shift(),o=r),p.info(i,...o)}else p.info(n,...e)}function ui(n,e=W2){return J2({message:n,opts:e,level:sr.LogLevel.Debug})}function Zh(n){return J2({message:n,opts:W2,level:sr.LogLevel.Error})}var Uc=new WeakMap;function Wc(n){return(e,t,r)=>{Uc.has(e)||Uc.set(e,new Map);let i=Uc.get(e);i||Uc.set(e,i=new Map),i.has(t)||i.set(t,[]),i.get(t).push({parameterIndex:r,propertyOfParameterToLog:n})}}function eg(){return(n,e,t)=>{Uc.has(n)||Uc.set(n,new Map);let r=Uc.get(n);r||Uc.set(n,r=new Map),r.has(e)||r.set(e,[]),r.get(e).push({parameterIndex:t,ignore:!0})}}function J2(n){return NW((e,t)=>_ie(n,t,e),(n.opts&4)>0)}function Pie(n){let{kind:e,name:t,args:r}=n;return(!e||e==="")&&(e="Function"),(!t||t==="")&&(t="<anon>"),r||(r=[]),{kind:e,name:t,args:r,methodName:n.methodName||"",target:n.target||void 0}}function kie(n){if(!n)return!1;let e=n;return typeof e.path=="string"&&typeof e.scheme=="string"}function RN(n){let e=kk?n.toLowerCase().indexOf(kk):-1;return e===-1?n:`~${n.substring(e+kk.length)}`}function xie(n,e,t,r){if(kie(t))return RN(t.path);if(!t)return t;let o=Uc.get(n)?.get(e)?.find(a=>a.parameterIndex===r);if(!o)return typeof t=="string"?RN(t):t;if("ignore"in o&&o.ignore)return"";let s=t;return"propertyOfParameterToLog"in o&&o.propertyOfParameterToLog&&(s=t[o.propertyOfParameterToLog]),typeof s=="string"?RN(s):s}function Die(n,e,t){t=Pie(t);let r=[n.message];return r.push(`${t.kind} name = ${t.name}`.trim()),e?(r.push(`completed in ${e.elapsed}ms`),r.push(`has a ${e.returnValue?"truthy":"falsy"} return value`)):r[r.length-1]=`${r[r.length-1]} (started execution)`,(n.opts&1)===1&&(n.level===sr.LogLevel.Debug?r.push(AA(t.args.map((i,o)=>t?xie(t.target,t.methodName,i,o):i))):r.push(AA(t.args))),e&&(n.opts&2)===2&&r.push(MW(e.returnValue)),r.join(", ")}function _ie(n,e,t){let r=Die(n,e,t);e?e.err===void 0?n.level&&n.level===sr.LogLevel.Error||(n.level?Pk(n.level,r):Pk(sr.LogLevel.Info,r)):Pk(sr.LogLevel.Error,r,e.err):n.level&&n.level!==sr.LogLevel.Error&&Pk(n.level,r)}function Pk(n,e,...t){switch(n){case sr.LogLevel.Error:p.error(e,...t);break;case sr.LogLevel.Warning:$2(e,...t);break;case sr.LogLevel.Info:p.info(e,...t);break;case sr.LogLevel.Debug:case sr.LogLevel.Trace:p.debug(e,...t);break;default:break}}var el=require("vscode");var CM=require("vscode");var q2=Symbol("IsDevMode"),jo=Symbol("IOutputChannel"),H2=Symbol("IS_WINDOWS"),K=Symbol("IDisposableRegistry"),We=Symbol("IGlobalMemento"),dt=Symbol("IGlobalMemento"),di=Symbol("IWorkspaceMemento");var Pl=Symbol("IPersistentStateFactory"),Abe=Symbol("IRandom"),oe=Symbol("IConfigurationService"),tt=Symbol("ExtensionContext"),va=Symbol("IExtensions"),G2=Symbol("IJupyterExtensionBanner"),xk=Symbol("IFeaturesManager"),tg=Symbol("ICryptoUtils"),ya=Symbol("IAsyncDisposableRegistry");var Sd=Symbol("IExperimentService"),Dk=Symbol("IDataScienceCommandListener"),rg=Symbol("IVariableScriptGenerator"),ng=Symbol("IDataFrameScriptGenerator");var kx=require("vscode");var z2=require("events"),AC=k(N());try{(0,AC.decorate)((0,AC.injectable)(),z2.EventEmitter)}catch(n){p.warn("Failed to decorate EventEmitter for DI (possibly already decorated by another Extension)",n)}var Se=class{constructor(e){this.container=e;Se._instance=this}static get instance(){return Se._instance}get(e,t){return t?this.container.getNamed(e,t):this.container.get(e)}getAll(e,t){return t?this.container.getAllNamed(e,t):this.container.getAll(e)}tryGet(e,t){try{return t?this.container.getNamed(e,t):this.container.get(e)}catch{}}};Se=v([(0,AC.injectable)()],Se);var pt=require("vscode");var tr=Symbol("IPythonApi"),qe=Symbol("IPythonExtensionChecker");var Rs=k(N());var NC="Python Kernel Debug Adapter",MC="Python Interactive Window Debug Adapter";var Rk=require("node-fetch"),FC=k(Q2());var ig=require("vscode");var ks=class extends $e{constructor(t,r,i){super("jupyterconnection",t+(r?`
${r}`:""));this.interpreter=i}};var hn=class extends $e{constructor(){super("sessionDisposed",y.sessionDisposed)}};var _k=class{static outputHasModuleNotInstalledError(e,t){return!!(t&&(t.indexOf(`No module named ${e}`)>0||t.indexOf(`No module named '${e}'`)>0))}};function og(n=""){if(!n)return;let e=/\S+Error: /g,t=`${n.trim()}: `.split(`
`).filter(s=>s.trim().length).reverse();if(t.length===0)return;let r=t[0],o=((r.match(e)?r:void 0)||"").split(":");return o.length&&o[0].endsWith("Error")?o[0]:void 0}function Tk(n=""){let e=X2(n);return e?e[1]:void 0}function X2(n=""){if(!n)return;let e=n.trim().split(`
`).map(t=>t.trim()).filter(t=>t.trim().length).reverse();if(e.length!==0&&e[0].includes("Error"))return[e.length>1?e[1]:"",e[0]]}function Z2(n){if(!n)return;let t=(Array.isArray(n)?n[0]:n).split(`
`).map(l=>l.trim().toLowerCase()).filter(l=>l.length).reverse().find(l=>l.startsWith("file ")&&l.includes(", line ")&&l.includes(".py")&&l.includes(".py"));if(!t)return;let i=(t.substring(0,t.lastIndexOf(".py"))+".py").replace(/\\/g,"/").split("/"),o=i.indexOf("site-packages"),s=o>=0&&i.length>o+1?i[o+1]:"",a=i.reverse();if(!(a.length<2))return{fileName:a[0],folderName:a[1],packageName:s}}function Sm(n,e,t,r="",i=[]){let o=e instanceof $e?e.stdErr||e.stack||"":e.toString(),s=X2(o),a=o.toLowerCase();if(e instanceof hn)return{reason:"sessionDisposed",message:y.sessionDisposed,moreInfoLink:"https://aka.ms/kernelDisposedCannotRunCell",telemetrySafeTags:["deadSession"]};if(a.includes("ImportError: No module named 'win32api'".toLowerCase()))return{reason:"importWin32apiFailure",message:y.failedToStartKernelDueToWin32APIFailure,moreInfoLink:"https://aka.ms/kernelFailuresWin32Api",telemetrySafeTags:["win32api"]};if(a.includes("ImportError: DLL load failed".toLowerCase())&&a.includes("win32api"))return{reason:"importWin32apiFailure",message:y.failedToStartKernelDueToWin32APIFailure,moreInfoLink:"https://aka.ms/kernelFailuresWin32Api",telemetrySafeTags:["dll.load.failed","win32api"]};if(a.includes("ImportError: DLL load failed".toLowerCase())){let u=s&&s[0].toLowerCase().startsWith("import")?s[0].substring(6).trim():void 0;return{reason:"dllLoadFailure",moduleName:u,message:u?y.failedToStartKernelDueToDllLoadFailure(u):y.failedToStartKernelDueToUnknownDllLoadFailure,moreInfoLink:"https://aka.ms/kernelFailuresDllLoad",telemetrySafeTags:["dll.load.failed"]}}if(a.includes("AssertionError: Couldn't find Class NSProcessInfo".toLowerCase()))return{reason:"oldIPythonFailure",message:y.failedToStartKernelDueToOldIPython,moreInfoLink:"https://aka.ms/kernelFailuresOldIPython",telemetrySafeTags:["oldipython"]};if(a.includes("NotImplementedError".toLowerCase())&&a.includes("asyncio".toLowerCase())&&a.includes("events.py".toLowerCase()))return{reason:"oldIPyKernelFailure",message:y.failedToStartKernelDueToOldIPyKernel,moreInfoLink:"https://aka.ms/kernelFailuresOldIPyKernel",telemetrySafeTags:["oldipykernel"]};{let u=[];if(a.includes("ImportError: cannot import name".toLowerCase())&&a.includes("from partially initialized module".toLowerCase())&&a.includes("zmq.backend.cython".toLowerCase())&&u.push("zmq.backend.cython"),a.includes("zmq".toLowerCase())&&a.includes("cython".toLowerCase())&&a.includes("__init__.py".toLowerCase())&&u.push("zmq.cython"),a.includes("zmq.error.ZMQError")&&u.push("zmq.error"),u.length)return{reason:"zmqModuleFailure",message:y.failedToStartKernelDueToPyZmqFailure,moreInfoLink:"https://aka.ms/kernelFailuresPyzmq",telemetrySafeTags:u}}if(s&&s[1].toLowerCase().startsWith("importerror")){let u=Y2(s[1]);if(u&&r){let d=Aie(u.moduleName,u.fileName,n,r);return d||{reason:"importFailure",moduleName:u.moduleName,fileName:u.fileName,message:u.fileName?y.failedToStartKernelDueToImportFailureFromFile(u.moduleName,u.fileName):y.failedToStartKernelDueToImportFailure(u.moduleName),moreInfoLink:u.fileName?"https://aka.ms/kernelFailuresModuleImportErrFromFile":"https://aka.ms/kernelFailuresModuleImportErr",telemetrySafeTags:["import.error"]}}}let l="No module named".toLowerCase(),c="is not a package".toLowerCase();if(a.includes(l)&&!c){let u=Be(o).map(f=>f.trim()).filter(f=>f.length).find(f=>f.toLowerCase().includes(l)),d=u?u.substring(u.toLowerCase().indexOf(l)+l.length).trim():"";if(u)return{reason:"moduleNotFound",moduleName:d,message:y.failedToStartKernelDueToMissingModule(d),moreInfoLink:"https://aka.ms/kernelFailuresMissingModule",telemetrySafeTags:["module.notfound.error"]}}else if(a.includes(l)&&c){let u=Be(o).map(I=>I.trim()).filter(I=>I.length).find(I=>I.toLowerCase().includes(l)),d=u?u.substring(u.toLowerCase().indexOf(l)+l.length).trim():"",f="",g="";d.split("'").length>2&&(f=d.split("'").slice(-2)[0]||"",f=f?`${f}.py`:"",g=f||"",d=d.split("'")[1]||d);let b=i.filter(I=>pr(I).toLowerCase()==="__init__.py").map(I=>pr(Nn(I)));return d&&f&&d!==f&&i.some(I=>pr(I).toLowerCase()===f.toLowerCase())?{reason:"overridingBuiltinModules",fileName:f,moduleName:d,message:y.fileSeemsToBeInterferingWithKernelStartup(f),moreInfoLink:"https://aka.ms/kernelFailuresOverridingBuiltInModules",telemetrySafeTags:["import.error","override.modules"]}:d&&b&&d!==g&&b.some(I=>I.toLowerCase()===g.toLowerCase())?{reason:"overridingBuiltinModules",folderName:g,moduleName:d,message:y.moduleSeemsToBeInterferingWithKernelStartup(g),moreInfoLink:"https://aka.ms/kernelFailuresOverridingBuiltInModules",telemetrySafeTags:["import.error","override.modules"]}:{reason:"moduleNotFound",moduleName:d,message:y.failedToStartKernelDueToMissingModule(d),moreInfoLink:"https://aka.ms/kernelFailuresMissingModule",telemetrySafeTags:["module.notfound.error"]}}else if(e instanceof $e&&e.category==="invalidkernel"&&i.length){let u=pr(i[0]);return{reason:"overridingBuiltinModules",fileName:u,moduleName:pr(i[0],".py"),message:y.fileSeemsToBeInterferingWithKernelStartup(u),moreInfoLink:"https://aka.ms/kernelFailuresOverridingBuiltInModules",telemetrySafeTags:["import.error","override.modules"]}}else if(s&&s[1].toLowerCase().startsWith("ModuleNotFoundError".toLowerCase())){let u=Y2(s[1]);if(u)return{reason:"moduleNotFound",moduleName:u.moduleName,message:y.failedToStartKernelDueToMissingModule(u.moduleName),moreInfoLink:"https://aka.ms/kernelFailuresMissingModule",telemetrySafeTags:["module.notfound.error"]}}if(e instanceof ks){let u=Be(o).map(w=>w.trim()).reverse().find(w=>w.toLowerCase().includes("error: ")),d="AttributeError: 'Namespace' object has no attribute '_flags'",f=["jupyter.startup.failure"],g,b="jupyterStartFailure",I=Be(e.message,{removeEmptyEntries:!0,trim:!0}).reverse().find(w=>w.toLowerCase().includes("error: "));if(I=I||Be(e.stdErr||"",{removeEmptyEntries:!0,trim:!0}).reverse().find(w=>w.toLowerCase().includes("error: ")),a.includes(d.toLowerCase())?(b="jupyterStartFailureOutdatedTraitlets",u=y.failedToStartJupyterDueToOutdatedTraitlets(t||"",I||""),f.push("outdated.traitlets"),g="https://aka.ms/kernelFailuresJupyterTrailtletsOutdated"):(u=I?y.failedToStartJupyterWithErrorInfo(t||"",I):y.failedToStartJupyter(t||""),g=void 0),u)return{reason:b,message:u,pythonError:I,moreInfoLink:g,telemetrySafeTags:f}}}function Y2(n){n=n.replace(/"/g,"'");let e=n.match(/'[^\\']*(\\'[^\\']*)*'/g),t=n.match(/\((.*?)\)/g),r,i;return e&&e[0].length>2&&(r=e[0],r=r.substring(1,r.length-1)),t&&t[0].length>2&&(i=t[0],i=i.substring(1,i.length-1)),r?{moduleName:r,fileName:i}:void 0}function Aie(n,e,t,r){if(r&&t.length!==0&&e&&!e.toLowerCase().startsWith(r)&&t.some(i=>e.toLowerCase().startsWith(i.uri.fsPath.toLowerCase())))return{reason:"overridingBuiltinModules",fileName:e,moduleName:n,message:y.fileSeemsToBeInterferingWithKernelStartup(M(ig.Uri.file(e),t||[])),moreInfoLink:"https://aka.ms/kernelFailuresOverridingBuiltInModules",telemetrySafeTags:["import.error","override.modules"]}}function sg(n){if(!n)return;let e=/\[([^\[\]]*)\]\((.*?)\)/gm,t;for(;(t=e.exec(n))!==null;)t.length===3&&(n=n.replace(t[0],`<a href='${t[2]}'>${t[1]}</a>`));let r=Be(n,{removeEmptyEntries:!1,trim:!1}).map(i=>`\x1B[1;31m${i}`).join(`
`);return new ig.NotebookCellOutput([ig.NotebookCellOutputItem.error({message:"",name:"",stack:r})])}var Nie=[Mie,Kie];function ej(n){let e=[],t=Array.isArray(n)?n[0].toLowerCase():n.toLowerCase();Nie.forEach(i=>i(t,e));let r=Sm([],t,void 0);return r?.telemetrySafeTags.length&&e.push(...r.telemetrySafeTags),Array.from(new Set(e)).join(",")}function Mie(n,e=[]){n.includes("ChildProcess.exithandler".toLowerCase())&&e.push("childproc.exit")}function Kie(n,e=[]){n.includes("KernelRestarter: restart failed".toLowerCase())&&e.push("KernelRestarter.failed")}function tj(){return(new Error().stack||"").split(`
`).filter(n=>n.includes(_e))}async function rj(n,e){n.failed=!0,n.failureCategory=n.failureCategory||wN(e);let t=!Rk.FetchError&&e?.name==="TypeError"&&e?.message==="Failed to fetch",i=(t||Rk.FetchError!==void 0)&&Lie(e,t?TypeError:Rk.FetchError);n.failureCategory==="unknown"&&i&&(n.failureCategory="fetcherror"),n.stackTrace=Oie(e),typeof e=="string"&&(n.failureSubCategory="errorisstring");let o=e.stdErr?e.stdErr:e.stack||"";if(!o)return;n.failureSubCategory=n.failureSubCategory||ej(o);let s=Z2(o);s&&([n.pythonErrorFile,n.pythonErrorFolder,n.pythonErrorPackage]=await Promise.all([Promise.resolve(n.pythonErrorFile||ot(s.fileName)),Promise.resolve(n.pythonErrorFolder||ot(s.folderName)),Promise.resolve(n.pythonErrorPackage||ot(s.packageName))]))}function AN(n){if(n.stack&&Array.isArray(n.stack)){let e={...n,stack:n.stack.join(`
`)};return FC.parse.call(FC,e)}return FC.parse.call(FC,n)}function Oie(n){let e="";for(let t of AN(n)){let r=t.getFileName();if(r){let i=t.getLineNumber(),o=t.getColumnNumber();e+=`
	at ${Fie(t)} ${r}:${i}:${o}`}else e+=`
	at <anonymous>`}return e.trim().replace(/\\/g,"/")}function Fie(n){let e=[];return typeof n.getTypeName()=="string"&&n.getTypeName().length>0&&e.push(n.getTypeName()),typeof n.getMethodName()=="string"&&n.getMethodName().length>0&&e.push(n.getMethodName()),typeof n.getFunctionName()=="string"&&n.getFunctionName().length>0&&(e.length!==2||e.join(".")!==n.getFunctionName())&&e.push(n.getFunctionName()),e.join(".")}function Lie(n,e){return e?n instanceof e||n instanceof mt&&n.originalException instanceof e:(console.error("Error type is not defined",n),!1)}var Ak=require("vscode");function Uie(){try{return require("vscode")===void 0?!1:oj()!==void 0}catch{return!1}}function Mk(){return Ak.workspace.getConfiguration("telemetry").inspect("enableTelemetry").globalValue===!1}function Kk(n){return Ak.workspace.onDidChangeConfiguration(e=>{if(!e.affectsConfiguration("telemetry"))return;let r=Ak.workspace.getConfiguration("telemetry").inspect("enableTelemetry").globalValue===!1;n(r)})}var Nk={};function ag(n,e){let t=n;uC()&&t.startsWith("ds_")||(e===void 0?delete Nk[t]:Nk[t]=e)}var NN;function oj(){if(NN)return NN;let n=require("@vscode/extension-telemetry").default;return NN=new n(EW)}function nj(n,e){let t={};return Object.getOwnPropertyNames(e).forEach(r=>{if(!(e[r]===void 0||e[r]===null))try{t[r]=typeof e[r]=="string"?e[r]:typeof e[r]=="object"?"object":e[r].toString()}catch(i){p.error(`Failed to serialize ${r} for ${n}`,i)}}),t}function T(n,e,t,r){!sj(n.toString())&&(Rr()||!Uie())||Wie(n,e,t,r)}function sj(n){return n==="DATASCIENCE.JUPYTER_NOTEBOOK_EDIT_PERFORMANCE"||n==="DATASCIENCE.JUPYTER_JUPYTER_NOTEBOOK_EXEC_PERFORMANCE"||n==="DATASCIENCE.JUPYTER_NOTEBOOK_EXEC_PERFORMANCE"}function Wie(n,e,t,r){let i=oj(),o={},s=n;r?(o={},Object.assign(o,Nk),Object.assign(o,t||{}),rj(o,r).then(()=>{o=nj(s,o),i.sendTelemetryEvent(s,o,e)}).catch(h)):(t&&(o=nj(s,t)),Object.assign(o,Nk),sj(s)?i.sendDangerousTelemetryEvent(s,o,e):i.sendTelemetryEvent(s,o,e))}var ij=new Set;function fr(n,e){return function(t,r,i){let o=i.value;return i.value=function(...s){let a=e||{},l=new Me,c=`${n.toString()}${JSON.stringify(a)}`,u=!ij.has(c);ij.add(c);let d=o.apply(this,s);return d&&typeof d.then=="function"&&typeof d.catch=="function"?d.then(f=>{let g={...a};return u&&(g.firstTime=u),T(n,l?{duration:l?.elapsedTime}:void 0,g),f}).catch(f=>{let g={...a};g.failed=!0,T(n,l?{duration:l?.elapsedTime}:{},g,f)}):T(n,l?{duration:l?.elapsedTime}:void 0,a),d},i}}function ln(n,e){return function(t,r,i){let o=i.value;return i.value=function(...s){return T(n,void 0,e),o.apply(this,s)},i}}function Vie(){return{isInsiderExtension:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Whether this is the Insider version of the Jupyter extension or not. Common to all events."},isPythonExtensionInstalled:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Whether Python extension is installed or not. Common to all events."},rawKernelSupported:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Whether the raw kernel is supported or not. Common to all events."}}}function gt(){return{duration:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth",isMeasurement:!0}}}function fo(){return{resourceType:{classification:"PublicNonPersonalData",comment:"",purpose:"FeatureInsight"}}}function Vc(){return{failed:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},failureCategory:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},failureSubCategory:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonErrorFile:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonErrorFolder:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonErrorPackage:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},stackTrace:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"}}}function Ni(){return{properties:{actionSource:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},disableUI:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},userExecutedCell:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},resourceHash:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"},pythonEnvironmentVersion:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonEnvironmentType:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonEnvironmentPath:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonEnvironmentPackages:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},kernelSessionId:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},kernelLanguage:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},kernelSpecHash:{classification:"EndUserPseudonymizedInformation",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},kernelConnectionType:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},isUsingActiveInterpreter:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},capturedEnvVars:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},newKernelPicker:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},...fo()}}}var xIe={...gt(),...Vc(),...Vie()};var lj,cj,uj,dj,pj,mj,fj,hj,gj,vj,yj,bj,Ij,Sj,Cj,Ej,wj,Pj,kj,xj,Dj,_j,Tj,Rj,Aj,Nj,Mj,Kj,Oj,Fj,Lj,Uj,Wj,Vj,jj,Bj,$j,Jj,qj,Hj,Gj,zj,Qj,Yj,Xj,Zj,e9,t9,r9,n9,i9,o9,s9,a9,l9,c9,u9,d9,p9,m9,f9,h9,g9,v9,y9,b9,I9,S9,C9,E9,w9,P9,k9,x9,D9,_9,T9,R9,A9,N9,M9,K9,O9,F9,L9,U9,W9,V9,j9,B9,$9,J9,q9,H9,G9,z9,Q9,Y9,X9,Z9,eB,tB,rB,nB,iB,oB,sB,aB,lB,cB,uB,dB,pB,mB,fB,hB,gB,vB,yB,bB,IB,SB,CB,EB,wB,PB,kB,xB,DB,_B,TB,RB,AB,NB,MB,KB,OB,FB,LB,UB,WB,VB,jB,BB,$B,JB,qB,HB,GB,zB,QB,YB,XB,ZB,e$,t$,r$,n$,i$,o$,s$,a$,l$,c$,u$,d$;d$="EXTENSION.LOAD",u$="DS_INTERNAL.EXPERIMENT_LOAD",c$="ENVFILE_VARIABLE_SUBSTITUTION",l$="ENVFILE_WORKSPACE",a$="HASHED_PACKAGE_NAME",s$="DS_INTERNAL.ACTIVE_INTERPRETER_LISTING_PERF",o$="DS_INTERNAL.CELL_OUTPUT_MIME_TYPE",i$="DS_INTERNAL.GET_ACTIVATED_ENV_VARIABLES",n$="OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_REQUEST_EX",r$="OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_ERROR_EX",t$="OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_SUCCESS_EX",e$="DATASCIENCE.ADD_CELL_BELOW",ZB="DS_INTERNAL.CODE_LENS_ACQ_TIME",XB="DS_INTERNAL.DOCUMENT_WITH_CODE_CELLS",YB="DATASCIENCE.DEBUG_CONTINUE",QB="DATASCIENCE.DEBUG_CURRENT_CELL",zB="DATASCIENCE.DEBUG_STEP_OVER",GB="DATASCIENCE.DEBUG_STOP",HB="DATASCIENCE.DEBUG_FILE_INTERACTIVE",qB="DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",JB="DS_INTERNAL.JUPYTER_KERNEL_SPEC",$B="DATASCIENCE.ENTER_REMOTE_JUPYTER_URL",BB="DATASCIENCE.DISABLE_INTERACTIVE_SHIFT_ENTER",jB="DATASCIENCE.ENABLE_INTERACTIVE_SHIFT_ENTER",VB="DS_INTERNAL.PERCEIVED_JUPYTER_STARTUP_NOTEBOOK",WB="DATASCIENCE.EXPORT_PYTHON_FILE",UB="DATASCIENCE.EXPORT_PYTHON_FILE_AND_OUTPUT",LB="DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK",FB="DATASCIENCE.EXPORT_NOTEBOOK_AS",OB="DATASCIENCE.IMPORT_NOTEBOOK",KB="DATASCIENCE.EXPORT_NOTEBOOK_AS_COMMAND",MB="DATASCIENCE.EXPORT_NOTEBOOK_AS_FAILED",NB="DS_INTERNAL.GET_PASSWORD_FAILURE",AB="DS_INTERNAL.GET_PASSWORD_SUCCESS",RB="DS_INTERNAL.JUPYTER_HUB_PASSWORD",TB="DS_INTERNAL.SHOW_DATA_NO_PANDAS",_B="DS_INTERNAL.SHOW_DATA_PANDAS_TOO_OLD",DB="DS_INTERNAL.SHOW_DATA_PANDAS_OK",xB="DS_INTERNAL.SHOW_DATA_PANDAS_INSTALL_CANCELED",kB="DATASCIENCE.NATIVE.OPEN_NOTEBOOK_ALL",PB="DATASCIENCE.OPEN_PLOT_VIEWER",wB="DATASCIENCE.RUN_ALL_CELLS",EB="DATASCIENCE.RUN_SELECTION_OR_LINE",CB="DATASCIENCE.RUN_CURRENT_CELL",SB="DATASCIENCE.RUN_ALL_CELLS_ABOVE",IB="DATASCIENCE.RUN_CELL_AND_ALL_BELOW",bB="DATASCIENCE.RUN_CURRENT_CELL_AND_ADVANCE",yB="DATASCIENCE.RUN_FILE_INTERACTIVE",vB="DATASCIENCE.RUN_TO_LINE",gB="DATASCIENCE.RUN_FROM_LINE",hB="DATASCIENCE.RUN_INSERT_CELL_BELOW_POSITION",fB="DATASCIENCE.RUN_INSERT_CELL_BELOW",mB="DATASCIENCE.RUN_INSERT_CELL_ABOVE",pB="DATASCIENCE.RUN_DELETE_CELLS",dB="DATASCIENCE.RUN_SELECT_CELL",uB="DATASCIENCE.RUN_SELECT_CELL_CONTENTS",cB="DATASCIENCE.RUN_EXTEND_SELECTION_BY_CELL_ABOVE",lB="DATASCIENCE.RUN_EXTEND_SELECTION_BY_CELL_BELOW",aB="DATASCIENCE.RUN_MOVE_CELLS_UP",sB="DATASCIENCE.RUN_MOVE_CELLS_DOWN",oB="DATASCIENCE.RUN_CHANGE_CELL_TO_MARKDOWN",iB="DATASCIENCE.RUN_CHANGE_CELL_TO_CODE",nB="DATASCIENCE.GOTO_NEXT_CELL_IN_FILE",rB="DATASCIENCE.GOTO_PREV_CELL_IN_FILE",tB="DATASCIENCE.RUN_CURRENT_CELL_AND_ADD_BELOW",eB="DATASCIENCE.SELFCERTSMESSAGECLOSE",Z9="DATASCIENCE.SELFCERTSMESSAGEENABLED",X9="DATASCIENCE.USER_INSTALLED_JUPYTER",Y9="DATASCIENCE.USER_INSTALLED_PANDAS",Q9="DATASCIENCE.USER_DID_NOT_INSTALL_JUPYTER",z9="DATASCIENCE.USER_DID_NOT_INSTALL_PANDAS",G9="DS_INTERNAL.PYTHON_NOT_INSTALLED",H9="DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",q9="DS_INTERNAL.PYTHON_EXTENSION_INSTALLED_VIA_KERNEL_PICKER",J9="DS_INTERNAL.PYTHON_MODULE_INSTALL",$9="DS_INTERNAL.SHIFTENTER_BANNER_SHOWN",B9="DATASCIENCE.START_SHOW_DATA_EXPLORER",j9="DATASCIENCE.SHOW_DATA_EXPLORER",V9="DATASCIENCE.SHOW_DATA_EXPLORER_ROWS_LOADED",W9="DATASCIENCE.FAILED_SHOW_DATA_EXPLORER",U9="DATASCIENCE.REFRESH_DATA_VIEWER",L9="DS_INTERNAL.JUPYTER_ZMQ_SUPPORT",F9="DS_INTERNAL.JUPYTER_ZMQ_SUPPORT_FAILURE",O9="DS_INTERNAL.VARIABLE_EXPLORER_FETCH_TIME",K9="DS_INTERNAL.VARIABLE_EXPLORER_VARIABLE_COUNT",M9="DATASCIENCE.KERNEL_SPEC_LANGUAGE",N9="DS_INTERNAL.KERNEL_LAUNCHER_PERF",A9="GLOBAL_PYTHON_KERNELSPEC",R9="DS_INTERNAL.NEW_FILE_USED_IN_INTERACTIVE",T9="DS_INTERNAL.CREATED_INTERACTIVE_WINDOW",_9="DS_INTERNAL.IPYWIDGET_USED_BY_USER",D9="DS_INTERNAL.IPYWIDGET_DISCOVER_WIDGETS_NB_EXTENSIONS",x9="DS_INTERNAL.IPYWIDGET_DISCOVERY_ERRORED",k9="DS_INTERNAL.IPYWIDGET_LOAD_SUCCESS",P9="DS_INTERNAL.IPYWIDGET_LOAD_FAILURE",w9="DS_INTERNAL.IPYWIDGET_WIDGET_VERSION_NOT_SUPPORTED_LOAD_FAILURE",E9="DS_INTERNAL.IPYWIDGET_PROMPT_TO_USE_CDN",C9="DS_INTERNAL.IPYWIDGET_PROMPT_TO_USE_CDN_SELECTION",S9="DS_INTERNAL.IPYWIDGET_RENDER_FAILURE",I9="DS_INTERNAL.IPYWIDGET_UNHANDLED_MESSAGE",b9="DS_INTERNAL.RAWKERNEL_INFO_RESPONSE",y9="DS_INTERNAL.RAWKERNEL_PROCESS_LAUNCH",v9="DATASCIENCE.EXECUTE_CELL",g9="DATASCIENCE.EXECUTE_CODE",h9="DATASCIENCE.RESUME_EXECUTE_CELL",f9="DATASCIENCE.NOTEBOOK_START",m9="DS_INTERNAL.SWITCH_KERNEL",p9="DATASCIENCE.NOTEBOOK_INTERRUPT",d9="DATASCIENCE.NOTEBOOK_RESTART",u9="DS_INTERNAL.RAWKERNEL_SESSION_NO_IPYKERNEL",c9="DS_INTERNAL.RAWKERNEL_SESSION_KERNEL_PROCESS_EXITED",l9="DATASCIENCE.NOTEBOOK_FIRST_START_BREAKDOWN",a9="DATASCIENCE.NOTEBOOK_FIRST_KERNEL_AUTO_SELECTION_BREAKDOWN",s9="DS_INTERNAL.RAWKERNEL_SESSION_SHUTDOWN",o9="DS_INTERNAL.RAWKERNEL_SESSION_DISPOSED",i9="DATASCIENCE.RUN_BY_LINE_VARIABLE_HOVER",n9="DS_INTERNAL.KERNEL_COUNT",r9="DS_INTERNAL.VSCNOTEBOOK_CELL_TRANSLATION_FAILED",t9="DS_INTERNAL.INTERACTIVE_FILE_TOOLTIPS_PERF",e9="DS_INTERNAL.NATIVE_VARIABLE_VIEW_LOADED",Zj="DS_INTERNAL.NATIVE_VARIABLE_VIEW_MADE_VISIBLE",Xj="DATAVIEWER.WEBVIEW_LOADED",Yj="PLOTVIEWER.WEBVIEW_LOADED",Qj="DS_INTERNAL.COMMAND_EXECUTED",zj="DATASCIENCE.DATA_VIEWER_SLICE_ENABLEMENT_STATE_CHANGED",Gj="DATASCIENCE.DATA_VIEWER_DATA_DIMENSIONALITY",Hj="DATASCIENCE.DATA_VIEWER_SLICE_OPERATION",qj="DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",Jj="DATASCIENCE.RECOMMENT_EXTENSION",$j="DATASCIENCE.DEBUGGING.CLICKED_ON_SETUP",Bj="DATASCIENCE.DEBUGGING.CLOSED_MODAL",jj="DATASCIENCE.DEBUGGING.IPYKERNEL6_STATUS",Vj="DATASCIENCE.DEBUGGING.CLICKED_RUNBYLINE",Wj="DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUNBYLINE",Uj="DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_IW_JUPYTER",Lj="DATASCIENCE.DEBUGGING.CLICKED_RUN_AND_DEBUG_CELL",Fj="DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUN_AND_DEBUG_CELL",Oj="DATASCIENCE.DEBUGGING.ENDED_SESSION",Kj="DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION",Mj="DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION_CANNOT_RESOLVE",Nj="DATASCIENCE.JUPYTER_KERNEL_API_USAGE",Aj="DATASCIENCE.JUPYTER_URI_CAN_BE_PARSED_AS_URI",Rj="DATASCIENCE.JUPYTER_NEW_KERNEL_API_USAGE",Tj="DATASCIENCE.JUPYTER_NEW_KERNELS_API_USAGE",_j="DATASCIENCE.JUPYTER_NEW_KERNEL_API_EXEC",Dj="DATASCIENCE.JUPYTER_NEW_KERNEL_API_KERNEL_STARTUP_WAIT_UNTIL",xj="DATASCIENCE.JUPYTER_API_USAGE",kj="DATASCIENCE.JUPYTER_KERNEL_API_ACCESS",Pj="DATASCIENCE.JUPYTER_KERNEL_STARTUP_HOOK",wj="DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE",Ej="DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE",Cj="DATASCIENCE.KERNEL_CRASH",Sj="DATASCIENCE.JUPYTER_KERNEL_HIDDEN_VIA_FILTER",Ij="DATASCIENCE.JUPYTER_KERNEL_FILTER_USED",bj="DS_INTERNAL.RUNTEST",yj="DS_INTERNAL.PREFERRED_KERNEL_EXACT_MATCH",vj="DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",gj="DS_INTERNAL.IPYWIDGET_TIME_TO_COPY_NBEXTENSIONS_DIR",hj="DATASCIENCE.NO_ACTIVE_KERNEL_SESSION",fj="DATAVIEWER.USING_INTERPRETER",mj="DATAVIEWER.USING_KERNEL",pj="DATASCIENCE.JUPYTER_NOTEBOOK_EXEC_PERFORMANCE",dj="DATASCIENCE.JUPYTER_JUPYTER_NOTEBOOK_EXEC_PERFORMANCE",uj="DATASCIENCE.JUPYTER_NOTEBOOK_EDIT_PERFORMANCE",cj="InvokeTool",lj="DATASCIENCE.JUPYTER_CONFIGURE_NOTEBOOK_TOOL_CALL";var aj=class{constructor(){this[d$]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{totalActivateTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},codeLoadingTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},workspaceFolderCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}}};this[u$]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:gt()};this[c$]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[l$]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[a$]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{hashedNamev2:{classification:"SystemMetaData",purpose:"FeatureInsight"},when:{classification:"SystemMetaData",purpose:"FeatureInsight"},...fo()}};this[s$]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{firstTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}},measures:gt()};this[o$]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{mimeType:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},when:{classification:"SystemMetaData",purpose:"FeatureInsight"},...fo()}};this[i$]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{envType:{classification:"SystemMetaData",purpose:"FeatureInsight"},failed:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},reason:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},source:{classification:"SystemMetaData",purpose:"FeatureInsight"}},measures:gt()};this[n$]={owner:"IanMatthewHuff",source:"User Action",feature:["DataFrameViewer","VariableViewer"]};this[r$]={owner:"IanMatthewHuff",source:"N/A",feature:["DataFrameViewer","VariableViewer"]};this[t$]={owner:"IanMatthewHuff",source:"User Action",feature:["DataFrameViewer","VariableViewer"]};this[e$]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action",measures:gt()};this[ZB]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action",measures:gt()};this[XB]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:{codeLensUpdateTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},maxCellCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0}}};this[YB]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[QB]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[zB]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[GB]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[HB]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[qB]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:{...Vc(),failed:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},reason:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Reason for failure to fetch kernel specs"},sessionManagerReady:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},specsManagerReady:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},wasSessionManagerReady:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},wasSpecsManagerReady:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}},measures:gt()};this[JB]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{kernelSpecHash:{classification:"EndUserPseudonymizedInformation",purpose:"FeatureInsight"},serverIdHash:{classification:"SystemMetaData",purpose:"FeatureInsight"},providerExtensionId:{classification:"SystemMetaData",purpose:"FeatureInsight"},baseUrlHash:{classification:"SystemMetaData",purpose:"FeatureInsight"},kernelId:{classification:"SystemMetaData",purpose:"FeatureInsight"},kernelConnectionType:{classification:"SystemMetaData",purpose:"FeatureInsight"},kernelLanguage:{classification:"SystemMetaData",purpose:"FeatureInsight"},envType:{classification:"SystemMetaData",purpose:"FeatureInsight"},isArgv0SameAsInterpreter:{classification:"SystemMetaData",purpose:"FeatureInsight"},argv0:{classification:"SystemMetaData",purpose:"FeatureInsight"},argv:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[$B]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:{serverIdHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},baseUrlHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},failed:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"},isLocalHost:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"},isJupyterHub:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"},reason:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"}}};this[BB]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[jB]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[VB]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:Ni().properties,measures:{...gt()}};this[WB]={owner:"IanMatthewHuff",feature:["Import-Export","InteractiveWindow"],source:"User Action"};this[UB]={owner:"IanMatthewHuff",feature:["Import-Export","InteractiveWindow"],source:"User Action"};this[LB]={owner:"IanMatthewHuff",feature:["Import-Export","InteractiveWindow"],source:"User Action",properties:{format:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[FB]={owner:"IanMatthewHuff",feature:["Import-Export"],source:"N/A",properties:{format:{classification:"SystemMetaData",purpose:"FeatureInsight"},cancelled:{classification:"SystemMetaData",purpose:"FeatureInsight"},successful:{classification:"SystemMetaData",purpose:"FeatureInsight"},opened:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[OB]={owner:"IanMatthewHuff",feature:["Import-Export"],source:"User Action",properties:{scope:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[KB]={owner:"IanMatthewHuff",feature:["Import-Export"],source:"User Action",properties:{format:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[MB]={owner:"IanMatthewHuff",feature:["Import-Export"],source:"N/A",properties:{format:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[NB]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[AB]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[RB]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failed:{classification:"SystemMetaData",purpose:"FeatureInsight"},info:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[TB]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[_B]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[DB]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[xB]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[kB]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{nbformat:{classification:"PublicNonPersonalData",isMeasurement:!0,purpose:"FeatureInsight"},nbformat_minor:{classification:"PublicNonPersonalData",isMeasurement:!0,purpose:"FeatureInsight"}}};this[PB]={owner:"IanMatthewHuff",feature:["PlotViewer"],source:"User Action"};this[wB]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[EB]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[CB]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[SB]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[IB]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[bB]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[yB]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[vB]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A"};this[gB]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A"};this[hB]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:gt()};this[fB]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:gt()};this[mB]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:gt()};this[pB]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:gt()};this[dB]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:gt()};this[uB]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:gt()};this[cB]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:gt()};this[lB]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:gt()};this[aB]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:gt()};this[sB]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:gt()};this[oB]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:gt()};this[iB]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:gt()};this[nB]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:gt()};this[rB]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:gt()};this[tB]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:gt()};this[eB]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[Z9]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[X9]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"]};this[Y9]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[Q9]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"]};this[z9]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[G9]={owner:"IanMatthewHuff",feature:["KernelPicker"],source:"User Action",properties:{action:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[H9]={owner:"donjayamanne",feature:["KernelPicker"],source:"User Action",properties:{action:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[q9]={owner:"donjayamanne",feature:["KernelPicker"],source:"User Action",properties:{action:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[J9]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{action:{classification:"SystemMetaData",purpose:"FeatureInsight"},isModulePresent:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},moduleName:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pythonEnvType:{classification:"SystemMetaData",purpose:"FeatureInsight"},resourceHash:{classification:"SystemMetaData",purpose:"FeatureInsight"},...fo()},measures:gt()};this[$9]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A"};this[B9]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"User Action",measures:gt()};this[j9]={owner:"IanMatthewHuff",source:"N/A",feature:["DataFrameViewer"],measures:{rows:{classification:"PublicNonPersonalData",purpose:"FeatureInsight",isMeasurement:!0},columns:{classification:"PublicNonPersonalData",purpose:"FeatureInsight",isMeasurement:!0}}};this[V9]={owner:"IanMatthewHuff",source:"N/A",feature:["DataFrameViewer"],measures:{rowsTimer:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}}};this[W9]={owner:"amunger",feature:["DataFrameViewer","VariableViewer"],source:"N/A",properties:{reason:{classification:"SystemMetaData",purpose:"FeatureInsight"},fromVariableView:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[U9]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"User Action"};this[L9]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failed:{classification:"SystemMetaData",purpose:"FeatureInsight"},fallbackTried:{classification:"SystemMetaData",purpose:"FeatureInsight"},alpine:{classification:"SystemMetaData",purpose:"FeatureInsight"},zmqarch:{classification:"SystemMetaData",purpose:"FeatureInsight"},libc:{classification:"SystemMetaData",purpose:"FeatureInsight"},armv:{classification:"SystemMetaData",purpose:"FeatureInsight"},distro_id:{classification:"SystemMetaData",purpose:"FeatureInsight"},distro_version_id:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[F9]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failed:{classification:"SystemMetaData",purpose:"FeatureInsight"},fallbackTried:{classification:"SystemMetaData",purpose:"FeatureInsight"},alpine:{classification:"SystemMetaData",purpose:"FeatureInsight"},zmqarch:{classification:"SystemMetaData",purpose:"FeatureInsight"},libc:{classification:"SystemMetaData",purpose:"FeatureInsight"},armv:{classification:"SystemMetaData",purpose:"FeatureInsight"},distro_id:{classification:"SystemMetaData",purpose:"FeatureInsight"},distro_version_id:{classification:"SystemMetaData",purpose:"FeatureInsight"},errorMessage:{classification:"CallstackOrException",purpose:"FeatureInsight"},fallbackErrorMessage:{classification:"CallstackOrException",purpose:"FeatureInsight"},zmqBinaries:{classification:"CallstackOrException",purpose:"FeatureInsight"}}};this[O9]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A",measures:gt()};this[K9]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A",measures:{variableCount:{classification:"PublicNonPersonalData",purpose:"FeatureInsight",isMeasurement:!0}}};this[M9]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:{kind:{classification:"SystemMetaData",purpose:"FeatureInsight"},language:{classification:"SystemMetaData",purpose:"FeatureInsight"},usesShell:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[N9]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:{...Vc(),...fo()},measures:{...gt()}};this[A9]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{kernelConnectionType:{classification:"SystemMetaData",purpose:"FeatureInsight"},pythonPathDefined:{classification:"SystemMetaData",purpose:"FeatureInsight"},pythonEnvFound:{classification:"SystemMetaData",purpose:"FeatureInsight"},language:{classification:"SystemMetaData",purpose:"FeatureInsight"},kernelSpecHash:{classification:"EndUserPseudonymizedInformation",purpose:"FeatureInsight"},argv0:{classification:"SystemMetaData",purpose:"FeatureInsight"},isCreatedByUs:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[R9]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A"};this[T9]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",properties:{hasKernel:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"If the kernel was known at the time of creation"},hasOwner:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"If the window was created for a text file"},mode:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Creation mode: multiple, perfile or single"},restored:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Was the window restored from a previous session"}},measures:{windowCount:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Number of active interactive windows the user has open",isMeasurement:!0}}};this[_9]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{cdnSearched:{classification:"SystemMetaData",purpose:"FeatureInsight"},hashedName:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},source:{classification:"SystemMetaData",purpose:"FeatureInsight"},moduleName:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},modelName:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},moduleVersion:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[D9]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{type:{classification:"SystemMetaData",purpose:"FeatureInsight"}},measures:gt()};this[x9]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A"};this[k9]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{moduleHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},moduleVersion:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[P9]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{timedout:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},isOnline:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},moduleHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},moduleVersion:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[w9]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{moduleHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},moduleVersion:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[E9]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A"};this[C9]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{selection:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[S9]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A"};this[I9]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{msg_type:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"}}};this[b9]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",tags:["KernelStartup"],measures:{...gt(),attempts:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}},properties:{...Ni().properties,timedout:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}}};this[y9]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",tags:["KernelStartup"],measures:gt()};this[v9]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",tags:["Cell Execution"],measures:{...gt()},properties:{...Ni().properties,...Vc()}};this[g9]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",tags:["Code Execution"],measures:gt(),properties:{...Ni().properties,...Vc(),extensionId:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[h9]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",tags:["Cell Execution"],properties:{...Ni().properties,...Vc()}};this[f9]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",tags:["KernelStartup"],properties:{...Ni().properties,...Vc()}};this[m9]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:Ni().properties};this[p9]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",properties:{result:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},...fo(),...Vc(),...Ni().properties},measures:{...gt()}};this[d9]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",properties:{...fo(),...Vc(),...Ni().properties},measures:gt()};this[u9]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{...fo(),...Ni().properties},measures:{reason:{classification:"SystemMetaData",isMeasurement:!0,purpose:"PerformanceAndHealth"}}};this[c9]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{exitReason:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},...fo(),...Ni().properties},measures:{exitCode:{classification:"CallstackOrException",purpose:"PerformanceAndHealth",isMeasurement:!0}}};this[l9]={owner:"donjayamanne",feature:["Notebook"],source:"N/A",properties:{...fo(),...Ni().properties,manuallySelectedKernel:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},wasAlreadyOpen:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}},measures:{...gt(),computeCwd:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},duration:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},envVars:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},executeCell:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},getConnection:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},interruptHandle:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},kernelIdle:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},kernelInfo:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},kernelReady:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},portUsage:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},postKernelStart:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},preExecuteCellTelemetry:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},pythonEnvVars:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},sessionTelemetry:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},spawn:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},startKernel:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},startupCode:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},updateConnection:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},codeCellCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},mdCellCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},codeCellCharLength:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},mdCellCharLength:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},outputCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},outputsByteSize:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},attachmentCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},attachmentCharLength:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0}}};this[a9]={owner:"donjayamanne",feature:["Notebook"],source:"N/A",properties:{...fo(),...Ni().properties,wasAlreadyOpen:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}},measures:{...gt(),callPythonApi:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},activatePython:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},discoverEnv:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},createController:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},selectController:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0}}};this[s9]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{isRequestToShutdownRestartSession:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},stacktrace:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},...fo(),...Ni().properties}};this[o9]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{stacktrace:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},...fo(),...Ni().properties}};this[i9]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[n9]={owner:"donjayamanne",feature:["KernelPicker"],source:"N/A",measures:{kernelSpecCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},kernelInterpreterCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},kernelLiveCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},localKernelSpecCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},remoteKernelSpecCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}}};this[r9]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{outputType:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"}}};this[t9]={owner:"IanMatthewHuff",feature:["InteractiveWindow"],tags:["IntelliSense"],source:"N/A",measures:gt(),properties:{isResultNull:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[e9]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A",measures:gt()};this[Zj]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A"};this[Xj]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A",measures:gt()};this[Yj]={owner:"IanMatthewHuff",feature:["PlotViewer"],source:"N/A",measures:gt()};this[Qj]={owner:"amunger",feature:"N/A",source:"N/A",properties:{command:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[zj]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"User Action",properties:{newState:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Gj]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A",measures:{numberOfDimensions:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0}}};this[Hj]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"User Action",properties:{source:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[qj]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failed:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},reason:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},dependenciesInstalled:{classification:"SystemMetaData",purpose:"FeatureInsight"},envType:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Jj]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{extensionId:{classification:"SystemMetaData",purpose:"FeatureInsight"},action:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[$j]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[Bj]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[jj]={owner:"roblourens",feature:["Debugger"],properties:{status:{classification:"SystemMetaData",purpose:"FeatureInsight"}},source:"N/A"};this[Vj]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[Wj]={owner:"roblourens",feature:["Debugger"],source:"N/A"};this[Uj]={owner:"roblourens",feature:["Debugger"],source:"N/A"};this[Lj]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[Fj]={owner:"roblourens",feature:["Debugger"],source:"N/A"};this[Oj]={owner:"roblourens",feature:["Debugger"],source:"N/A",properties:{reason:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Kj]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{...gt(),requestDuration:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},timesExceededTimeout:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},completionItems:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}},properties:{kernelConnectionType:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelLanguage:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},monacoLanguage:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},cancelled:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},completed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelStatusAfterRequest:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelStatusBeforeRequest:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},requestSent:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Mj]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{kernelConnectionType:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelLanguage:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Nj]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pemUsed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Aj]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failureReason:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Rj]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{executionCount:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"}},properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pemUsed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Tj]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{accessAllowed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pemUsed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[_j]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{executionCount:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"},cancelledAfter:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"},requestAcknowledgedAfter:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"},requestSentAfter:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"},...gt()},properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},cancelled:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},requestAcknowledged:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},requestSent:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},cancelledBeforeRequestAcknowledged:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},cancelledBeforeRequestSent:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},mimeTypes:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},failed:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"}}};this[Dj]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:gt(),properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[xj]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{clientExtId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pemUsed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[kj]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},allowed:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Pj]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},providerId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}},measures:gt()};this[wj]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A"};this[Ej]={owner:"roblourens",feature:["InteractiveWindow","Debugger"],source:"N/A"};this[Cj]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{...Ni().properties,...fo()}};this[Sj]={owner:"donjayamanne",source:"N/A",feature:["KernelPicker"]};this[Ij]={owner:"donjayamanne",source:"User Action",feature:["KernelPicker"]};this[bj]={owner:"amunger",feature:"N/A",source:"N/A",properties:{testName:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},testResult:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},perfWarmup:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},commitHash:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},timedCheckpoints:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}}};this[yj]={owner:"donjayamanne",feature:["KernelPicker"],source:"N/A",measures:{matchedReason:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[vj]={owner:"donjayamanne",feature:["Notebook","Notebook"],tags:["Widgets"],source:"N/A",measures:{requireEntryPointCount:{classification:"SystemMetaData",isMeasurement:!0,purpose:"PerformanceAndHealth"}},properties:{failed:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},failure:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},patternUsedToRegisterRequireConfig:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},widgetFolderNameHash:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[gj]={owner:"donjayamanne",feature:["Notebook","Notebook"],tags:["Widgets"],source:"N/A",measures:gt()};this[hj]={owner:"donjayamanne",feature:["DataFrameViewer"],source:"N/A"};this[fj]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[mj]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[pj]={owner:"donjayamanne",feature:["Notebook","Notebook"],tags:["Widgets"],source:"N/A",measures:{...gt(),codeCellCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Total number of code cells.",isMeasurement:!0},markdownCellCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Total number of markdown cells.",isMeasurement:!0},preExecuteDuration:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Total time spent in VS Code before starting execution.",isMeasurement:!0},executeDuration:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Total time spent executing cells.",isMeasurement:!0},postExecuteDuration:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Total time spent in VS Code after executing cells.",isMeasurement:!0}},properties:{outputType:{classification:"PublicNonPersonalData",purpose:"FeatureInsight",comment:"The kind of outputs generated in the notebook, text, html or images."}}};this[dj]={owner:"donjayamanne",feature:["Notebook","Notebook"],tags:["Widgets"],source:"N/A",measures:{...gt(),codeCellCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Total number of code cells.",isMeasurement:!0},markdownCellCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Total number of markdown cells.",isMeasurement:!0}},properties:{outputType:{classification:"PublicNonPersonalData",purpose:"FeatureInsight",comment:"The kind of outputs generated in the notebook, text, html or images."}}};this[uj]={owner:"donjayamanne",feature:["Notebook","Notebook"],tags:["Widgets"],source:"N/A",measures:{...gt(),codeCellCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Total number of code cells.",isMeasurement:!0},markdownCellCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Total number of markdown cells.",isMeasurement:!0}}};this[cj]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{toolName:{classification:"PublicNonPersonalData",purpose:"FeatureInsight",comment:"The name of the tool that was called."},resourceHash:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"},failed:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Whether there was a failure. Common to most of the events."},failureCategory:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"A reason that we generate (e.g. kerneldied, noipykernel, etc), more like a category of the error. Common to most of the events."}}};this[lj]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{resourceHash:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"},installedPythonExtension:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},isPython:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},createdEnv:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}}}}};var Cd=require("vscode");function xl(n){let e=kl(n.uri);return ot(e.path)}function Bo(n=Cd.Uri.file(""),e=Cd.Uri.file(""),t=Ur(),r=!1){let i=kl(n,t,t=="Windows"||r),o=kl(e,t,t=="Windows"||r);return i===o||an(i,o,!0)}function kl(n=Cd.Uri.file(""),e=Ur(),t=!1){let r=Ae(n);return t&&(r=r.toLowerCase()),r.endsWith("/bin/python")?["Linux","OSX"].includes(e)?r.endsWith("/bin/python")&&r.split("/").length>4?Cd.Uri.file(r.replace("/bin/python","/python")):Cd.Uri.file(r):Cd.Uri.file(r):Cd.Uri.file(r)}var p$=require("vscode");var ho=class{constructor(){this.promises=new Set;this._onStateChange=new p$.EventEmitter;this.onStateChange=this._onStateChange.event}get isComplete(){return this.promises.size===0}dispose(){this._onStateChange.dispose()}push(e){this.promises.add(e),this._onStateChange.fire(),e.finally(()=>{this.promises.delete(e),this.isComplete&&this._onStateChange.fire()}).catch(h)}};var Ok=class extends mt{constructor(e){super("Python Extension failed to activate",e,"pythonExtension")}};var Fk=class extends $e{constructor(){super("pythonExtension","Python Extension API not exported")}};var H$=k(km());var xm=require("vscode");var Hk=class{};function Ds(n,e=""){let t=n?xm.workspace.getWorkspaceFolder(n):xm.workspace.workspaceFolders?xm.workspace.workspaceFolders[0]:void 0;return t?mn(Ur()==="Windows"?t.uri.path.toUpperCase():t.uri.path):e}function _l(){return(Array.isArray(xm.workspace.workspaceFolders)&&xm.workspace.workspaceFolders.length>0?xm.workspace.workspaceFolders[0]:void 0)?.uri}var Rm=require("vscode");var T$=k(km());var _m=require("vscode");var _$=require("vscode");function ba(n){return(e,t=null,r)=>{let i=!1,o;return o=n(s=>{if(!i)return o?o.dispose():i=!0,e.call(t,s)},null,r),i&&o.dispose(),o}}function $C(n,e=null,t){return new Promise(r=>ba(n)(r,e,t))}var Dm=class{constructor(){this._listeners=new Set}get event(){return this._event||(this._event=(e,t,r)=>{this._listeners.add(t?e.bind(t):e);let i=new _$.Disposable(()=>this._listeners.delete(e));return r?.push(i),i}),this._event}async fireAsync(e,t){if(this._listeners){this._asyncDeliveryQueue||(this._asyncDeliveryQueue=[]);for(let r of this._listeners)this._asyncDeliveryQueue.push([r,e]);for(;this._asyncDeliveryQueue.length>0&&!t.isCancellationRequested;){let[r,i]=this._asyncDeliveryQueue.shift(),o=[],s={...i,token:t,waitUntil:a=>{if(Object.isFrozen(o))throw new Error("waitUntil can NOT be called asynchronous");o.push(a)}};try{r(s)}catch(a){console.error(a);continue}Object.freeze(o),await Promise.allSettled(o).then(a=>{for(let l of a)l.status==="rejected"&&console.error(l.reason)})}}}dispose(){this._listeners.clear()}};var woe={output_type:"stream",name:"stdout",text:""},Poe={output_type:"error",ename:"",evalue:"",traceback:[""]},koe={output_type:"display_data",data:{},metadata:{}},xoe={output_type:"execute_result",execution_count:0,data:{},metadata:{}},rSe={stream:new Set(Object.keys(woe)),error:new Set(Object.keys(Poe)),display_data:new Set(Object.keys(koe)),execute_result:new Set(Object.keys(xoe))};function to(n){return n&&fd(n).toLowerCase().endsWith("ipynb")?"notebook":"interactive"}function Tl(n){return n=n.toLowerCase(),n.length===2&&n.endsWith("#")?`${n.substring(0,1)}sharp`:PW.get(n)||n}function St(n){return typeof n=="string"?n===It||n===nr:n.notebookType===It||n.notebookType===nr}function Mi(n){let e=n.metadata;return JSON.parse(JSON.stringify(e?.metadata||{}))}function R$(n){let e=n.metadata;return{nbformat:e?.nbformat,nbformat_minor:e?.nbformat_minor}}async function A$(n,e){let t=new _m.WorkspaceEdit;t.set(n.uri,[_m.NotebookEdit.updateNotebookMetadata(ZN({...n.metadata||{},metadata:e}))]),await _m.workspace.applyEdit(t)}function hg(n){return _m.workspace.notebookDocuments.find(e=>St(e)&&e.getCells().some(t=>t.document===n))}function _s(n){if(Array.isArray(n)){let e="";for(let t=0;t<n.length;t+=1){let r=n[t];t<n.length-1&&!r.endsWith(`
`)?e=e.concat(`${r}
`):e=e.concat(r)}return e}return n.toString()}function gg(n){if(Array.isArray(n))return n;let e=n.toString();if(e.length>0){let t=e.split(`
`);return t.map((r,i)=>i<t.length-1?`${r}
`:r).filter(r=>r.length>0)}return[]}function Doe(n){let e=n;do n=e,e=n.replace(/[^\n]\x08/gm,"");while(e.length<n.length);return n}function _oe(n){for(n=n.replace(/\r+\n/gm,`
`);n.search(/\r[^$]/g)>-1;){var e=n.match(/^(.*)\r+/m)[1],t=n.match(/\r+(.*)$/m)[1];t=t+e.slice(t.length,e.length),n=n.replace(/\r+.*$/m,"\r").replace(/^.*\r/m,t)}return n}function N$(n){return _oe(Doe(n))}var Gk="'''",zk='"""';function Tm(n,e,t){let r,i,o=0;for(let s of n){let a=s.trim(),l=a.startsWith(Gk)?Gk:a.startsWith(zk)?zk:void 0,c=a.includes(Gk)?Gk:a.includes(zk)?zk:void 0;if(i)i===c&&(i=void 0),t(s,o);else if(r)r===l&&(r=void 0),r&&e(s,o);else if(c&&!l){let u=a.indexOf(c);i=a.lastIndexOf(c)!==u?void 0:c,t(s,o)}else if(l){let u=a.indexOf(l,3);r=u>=0?void 0:l,a.length>3&&e(a.slice(3,u>=0?u:void 0),o)}else a.startsWith("#")?e(a.slice(1),o):t(s,o);o+=1}}function vg(n,e=`
`,t){return n.map((r,i)=>{let o=t?t(r):r;return i===n.length-1?`${o}`:`${o}${e}`})}function Toe(n){let e=[];return Tm(n,t=>e.push(t),t=>{}),e}function Qk(n){return vg(Toe(n.slice(n.length>1?1:0)))}function M$(n){let e=n.length,t=-1;return n.forEach((r,i)=>{r.trim()&&(e=i,t<0&&(t=i))}),t>=0?n.slice(t,e+1):[]}function Yk(n){let e=/^\s*(\d+)\.(\d+)\.(.+)\s*$/.exec(n);if(e&&e.length>2){let t=parseInt(e[1],10),r=parseInt(e[2],10),i=parseInt(e[3],10);return(0,T$.parse)(`${t}.${r}.${i}`,!0)??void 0}}function Ed(n){let e=JSON.parse(JSON.stringify(n.metadata||{}))||{metadata:{}};return e.metadata=e.metadata||{},e}function ZN(n){return Roe(n)}function Roe(n){return Array.isArray(n)?n.map(ZN):n!=null&&typeof n=="object"&&Object.keys(n).length>0?Object.keys(n).sort().reduce((e,t)=>(e[t]=ZN(n[t]),e),{}):n}async function Ts(n,e=[]){let t=$C(n.onDidDispose,void 0,e);n.dispose(),await t}var Xk=new Map,tM=new Map,eM;function K$(n){eM=n}function rM(n,e){if(!n.pythonEnvironmentPath)return;let t=ne();Aoe({interpreterHash:n.pythonEnvironmentPath}).then(r=>{n.pythonEnvironmentPackages=r||n.pythonEnvironmentPackages,e&&(e.pythonEnvironmentPackages=r||e.pythonEnvironmentPackages)}).catch(()=>{}).finally(()=>{t.resolve()})}async function Aoe(n){if(!eM)return p.error("Python package provider is not initialized."),"{}";let e;if("interpreter"in n?e=n.interpreter:e=tM.get(n.interpreterHash),!e)return"{}";let t=await eM(e);return!t||t.size===0?"{}":JSON.stringify(Object.fromEntries(t))}async function O$(n){if(!n)return{};let e=Xk.get(fn(n)),t=to(n);if(!e&&t)return{resourceType:t,resourceHash:n?await ot(n.toString()):void 0};if(!e)return{};let r=JSON.parse(JSON.stringify(e[0]));return rM(e[0],r),r}function Ct(n,e,t,r,i){O$(n).then(o=>{Object.assign(o,r||{}),T(e,t,o,i)}).catch(h)}var Pn=!1,yg=new WeakMap,Zk=new Map,bg,L$=0;function kn(n){if(!n)return;if(Gn(n)&&!Zk.has(n.toString())){let t=Rm.workspace.notebookDocuments.find(r=>r.uri.toString()===n.toString());t&&Zk.set(n.toString(),new WeakRef(t))}let e=Gn(n)?Zk.get(n.toString())?.deref():n;if(e)return yg.get(e)?.tracker}function U$(n){let e=new or;return bg=n,L$=n.elapsedTime,Rm.workspace.notebookDocuments.forEach(t=>yg.set(t,F$(t,!0,n))),e.add(Rm.workspace.onDidOpenNotebookDocument(t=>{!yg.has(t)&&!Pn&&yg.set(t,F$(t,!1,n))})),e.add(Rm.workspace.onDidCloseNotebookDocument(t=>{yg.delete(t),Zk.delete(t.uri.toString())})),e}function W$(n){yg.get(n)?.tracker.kernelManuallySelected()}var ex={starAfter:-1,completedAfter:-1},nM=new Map,V$=new Map,Noe=new Map,j$=Ut(()=>(ex.starAfter=bg?.elapsedTime,{stop:Ut(()=>{ex.completedAfter=bg.elapsedTime})}));function B$(n,e){nM.set(n,bg?.elapsedTime),Noe.set(n,e||"")}function $$(n){n.executable.uri&&V$.set(n.id,bg?.elapsedTime)}function F$(n,e,t){let r=bg.elapsedTime,i=t.elapsedTime,o={openedAfter:i},s=c=>(c==="executeCell"&&(Pn=!0),o[`${c}StartedAfter`]=t.elapsedTime,{stop:Ut(()=>{o[`${c}CompletedAfter`]=t.elapsedTime})}),a={wasAlreadyOpen:e},l=()=>{};return{measures:o,info:a,tracker:{kernelSelected:Ut((c,u)=>{let d=nM.get(c);typeof d=="number"&&(a.wasAlreadyOpen?o.controllerCreatedAfter=nM.get(c):o.controllerCreatedAfter=r-d),o.interpreterDiscoveredAfter=V$.get(u||""),o.kernelSelectedAfter=t.elapsedTime,a.manuallySelectedKernel||Ooe(n,{wasAlreadyOpen:a.wasAlreadyOpen},{controllerCreatedAfter:o.controllerCreatedAfter,kernelSelectedAfter:o.kernelSelectedAfter,openedAfter:i,interpreterDiscoveredAfter:o.interpreterDiscoveredAfter})}),kernelManuallySelected:Ut(()=>a.manuallySelectedKernel=!0),cellExecutionCount:Pn?l:Ut(c=>o.executeCellCount=c),preExecuteCellTelemetry:Pn?l:Ut(()=>s("preExecuteCellTelemetry")),startKernel:Pn?l:Ut(()=>s("startKernel")),executeCell:Pn?l:Ut(()=>s("executeCell")),executeCellAcknowledged:Pn?l:Ut(()=>{o.executeCellAcknowledgedAfter=t.elapsedTime,Moe(n,a,o)}),jupyterSessionTelemetry:Pn?l:Ut(()=>s("sessionTelemetry")),postKernelStartup:Pn?l:Ut(()=>s("postKernelStart")),computeCwd:Pn?l:Ut(()=>s("computeCwd")),getConnection:Pn?l:Ut(()=>s("getConnection")),updateConnection:Pn?l:Ut(()=>s("updateConnection")),kernelReady:Pn?l:Ut(()=>s("kernelReady")),portUsage:Pn?l:Ut(()=>s("portUsage")),spawn:Pn?l:Ut(()=>s("spawn")),pythonEnvVars:Pn?l:Ut(()=>s("pythonEnvVars")),envVars:Pn?l:Ut(()=>s("envVars")),interruptHandle:Pn?l:Ut(()=>s("interruptHandle")),kernelInfo:Pn?l:Ut(()=>s("kernelInfo")),kernelIdle:Pn?l:Ut(()=>s("kernelIdle"))}}}var Moe=Ut(function(n,e,t){if(typeof t.preExecuteCellTelemetryStartedAfter!="number"||typeof t.preExecuteCellTelemetryCompletedAfter!="number"||typeof t.executeCellAcknowledgedAfter!="number"||typeof t.startKernelStartedAfter!="number"||typeof t.startKernelCompletedAfter!="number"||typeof t.executeCellStartedAfter!="number"||typeof t.sessionTelemetryStartedAfter!="number"||typeof t.sessionTelemetryCompletedAfter!="number"||typeof t.postKernelStartStartedAfter!="number"||typeof t.postKernelStartCompletedAfter!="number"||typeof t.kernelInfoStartedAfter!="number"||typeof t.kernelInfoCompletedAfter!="number"||typeof t.kernelIdleStartedAfter!="number"||typeof t.kernelIdleCompletedAfter!="number"||typeof t.computeCwdStartedAfter!="number"||typeof t.computeCwdCompletedAfter!="number"||typeof t.kernelReadyStartedAfter!="number"||typeof t.kernelReadyCompletedAfter!="number"||typeof t.getConnectionStartedAfter!="number"||typeof t.getConnectionCompletedAfter!="number"||typeof t.updateConnectionStartedAfter!="number"||typeof t.updateConnectionCompletedAfter!="number"||typeof t.portUsageStartedAfter!="number"||typeof t.portUsageCompletedAfter!="number"||typeof t.spawnStartedAfter!="number"||typeof t.spawnCompletedAfter!="number"||typeof t.pythonEnvVarsStartedAfter!="number"||typeof t.pythonEnvVarsCompletedAfter!="number"||typeof t.envVarsStartedAfter!="number"||typeof t.envVarsCompletedAfter!="number")return;let r={duration:0,preExecuteCellTelemetry:0,startKernel:0,executeCell:0};{let c=[{name:"preExecuteCellTelemetry",start:t.preExecuteCellTelemetryStartedAfter,end:t.preExecuteCellTelemetryCompletedAfter},{name:"startKernel",start:t.startKernelStartedAfter,end:t.startKernelCompletedAfter},{name:"executeCell",start:t.executeCellStartedAfter,end:t.executeCellAcknowledgedAfter}],u=t.executeCellAcknowledgedAfter-t.preExecuteCellTelemetryStartedAfter;r.duration=u,JC(r,c,u,t.openedAfter)}let i={sessionTelemetry:0,postKernelStart:0,computeCwd:0,getConnection:0,updateConnection:0,kernelReady:0,portUsage:0,spawn:0};{let c=[{name:"sessionTelemetry",start:t.sessionTelemetryStartedAfter,end:t.sessionTelemetryCompletedAfter},{name:"postKernelStart",start:t.postKernelStartStartedAfter,end:t.postKernelStartCompletedAfter},{name:"computeCwd",start:t.computeCwdStartedAfter,end:t.computeCwdCompletedAfter},{name:"getConnection",start:t.getConnectionStartedAfter,end:t.getConnectionCompletedAfter},{name:"updateConnection",start:t.updateConnectionStartedAfter,end:t.updateConnectionCompletedAfter},{name:"spawn",start:t.spawnStartedAfter,end:t.spawnCompletedAfter},{name:"portUsage",start:t.portUsageStartedAfter,end:t.portUsageCompletedAfter},{name:"kernelReady",start:t.kernelReadyStartedAfter,end:t.kernelReadyCompletedAfter}],u=t.startKernelCompletedAfter-t.startKernelStartedAfter;JC(i,c,u,t.openedAfter)}let o={startupCode:0,kernelInfo:0,kernelIdle:0};{let c=[{name:"startupCode",start:t.postKernelStartStartedAfter,end:t.kernelInfoStartedAfter},{name:"kernelInfo",start:t.kernelInfoStartedAfter,end:t.kernelInfoCompletedAfter},{name:"kernelIdle",start:t.kernelIdleStartedAfter,end:t.kernelIdleCompletedAfter}],u=t.postKernelStartCompletedAfter-t.postKernelStartStartedAfter;JC(o,c,u,t.openedAfter)}let s={pythonEnvVars:0,envVars:0,interruptHandle:0};{let c=[{name:"pythonEnvVars",start:t.pythonEnvVarsStartedAfter,end:t.pythonEnvVarsCompletedAfter},{name:"envVars",start:t.envVarsStartedAfter,end:t.envVarsCompletedAfter},{name:"interruptHandle",start:t.interruptHandleStartedAfter||0,end:t.interruptHandleCompletedAfter||0}],u=t.spawnCompletedAfter-t.spawnStartedAfter;JC(s,c,u,t.openedAfter)}let a=Koe(n),l={...r,...i,...o,...s,...a};Ct(n.uri,"DATASCIENCE.NOTEBOOK_FIRST_START_BREAKDOWN",l,e)});function Koe(n){let e={attachmentCharLength:0,attachmentCount:0,codeCellCharLength:0,codeCellCount:0,mdCellCharLength:0,mdCellCount:0,outputCount:0,outputsByteSize:0};return n.getCells().forEach(t=>{let r=t.document.lineAt(t.document.lineCount-1).range.end,i=t.document.offsetAt(r);if(t.kind===Rm.NotebookCellKind.Markup){e.mdCellCount+=1,e.mdCellCharLength+=i;try{let s=Ed(t).attachments||{};Object.keys(s).forEach(a=>{e.attachmentCount+=1;let l=s[a];typeof l=="object"&&Object.keys(l).forEach(c=>{let u=l[c];u&&typeof u=="string"&&(e.attachmentCharLength+=u.length)})})}catch(o){p.warn("Error parsing attachments in cell metadata",o)}}else e.codeCellCount+=1,e.codeCellCharLength+=i,e.outputCount+=t.outputs.length,e.outputsByteSize+=t.outputs.reduce((o,s)=>o+s.items.reduce((a,l)=>a+l.data.byteLength,0),0)}),e}var Ooe=Ut(function(n,e,t){if(t.pythonExtensionActivationStartedAfter=ex.starAfter,t.pythonExtensionActivationCompletedAfter=ex.completedAfter,typeof t.controllerCreatedAfter>"u"||typeof t.interpreterDiscoveredAfter>"u"||typeof t.pythonExtensionActivationCompletedAfter>"u"||typeof t.pythonExtensionActivationStartedAfter>"u")return;let r=[{name:"callPythonApi",start:L$,end:t.pythonExtensionActivationStartedAfter},{name:"activatePython",start:t.pythonExtensionActivationStartedAfter,end:t.pythonExtensionActivationCompletedAfter},{name:"discoverEnv",start:t.pythonExtensionActivationCompletedAfter,end:t.interpreterDiscoveredAfter},{name:"createController",start:t.interpreterDiscoveredAfter,end:t.controllerCreatedAfter},{name:"selectController",start:t.controllerCreatedAfter,end:t.kernelSelectedAfter}],i=t.kernelSelectedAfter-t.openedAfter,o={duration:i};JC(o,r,i,t.openedAfter),Ct(n.uri,"DATASCIENCE.NOTEBOOK_FIRST_KERNEL_AUTO_SELECTION_BREAKDOWN",o,e)});function JC(n,e,t,r){e.sort((i,o)=>i.start-o.start).forEach(i=>{typeof r=="number"&&r>=i.start&&r<=i.end?n[i.name]=(i.end-r)*100/t:typeof r=="number"&&r>i.end?n[i.name]=0:(typeof r=="number"&&r<i.start||typeof r!="number")&&(n[i.name]=(i.end-i.start)*100/t)})}var Ia=require("vscode");function wd(n){return Ur()==="Windows"?mn(n).toUpperCase():mn(n)}function Pd(n,e){return wd(n)===wd(e)}function Ig(n,e){return e.endsWith(vn)||(e+=vn),n.endsWith(vn)||(n+=vn),wd(n).startsWith(wd(e))}var J$=k(Ik());async function q$(n,e,t,r){let i=Foe(n,e.environments.known.filter(a=>!t.isPythonEnvironmentExcluded(a)));if(i)return p.trace(`For ${M(n.uri)} found local Python environment: ${M(i.path)}`),i;let o=r.getPythonEnvironment(n.uri);if(o)return p.trace(`For ${M(n.uri)} found Python environment: ${M(o.path)}`),e.environments.resolveEnvironment(o.id);let s=await Sg(n.uri);return p.trace(`For ${M(n.uri)} found recommeded Python environment: ${M(s?.path)}`),s}function Foe(n,e){let t=Ia.workspace.getWorkspaceFolder(n.uri)?.uri||(Ia.workspace.workspaceFolders?.length===1?Ia.workspace.workspaceFolders[0].uri:void 0),r=tx(Nn(n.uri),e);if(r)return r;if(t)return tx(t,e)}function tx(n,e){let t=e.filter(r=>Ig(r.environment?.folderUri?.fsPath||r.executable.uri?.fsPath||r.path,n.fsPath));return t.find(r=>Ue(r)==="Venv"&&r.environment?.name?.toLowerCase()===".venv")||t.find(r=>Ue(r)==="Conda"&&r.environment?.name?.toLowerCase()===".conda")||t.find(r=>["VirtualEnv","VirtualEnvWrapper"].includes(Ue(r))&&r.environment?.name?.toLowerCase()===".venv")||t.find(r=>r.environment?.name?.toLowerCase()===".venv"||r.environment?.name?.toLowerCase()===".conda")||t.length?t[0]:void 0}async function Sg(n){try{let e=await Bt(5e3,Ia.commands.executeCommand("python.getRecommendedEnvironment",n));if(!e){p.trace(`No recommended Python environment found for ${M(n)}`);return}if(p.trace(`Got a recommended Python environment for ${M(n)}, ${e.reason} and ${M(e.environment?.path)}`),e.reason==="workspaceUserSelected"||e.reason==="globalUserSelected"&&(!Ia.workspace.workspaceFolders?.length||Ia.env.remoteName==="dev-container"))return e.environment;let t=Ia.workspace.getConfiguration("python").get("defaultInterpreterPath",void 0);if(Ia.env.remoteName==="dev-container"&&t)try{let r=e.environment;if(r.path!==t&&(r=await(await J$.PythonExtension.api()).environments.resolveEnvironment(t)),r&&r.path===t)return p.trace(`Using the default interpreter path ${t} as the recommended Python environment`),r}catch{}}catch{return}}function qC(n,e){if(n){let t={...n,uri:pt.Uri.file(n.path||""),id:e||n.id};return delete t.path,t}}function G$(n){let e,t=n.id;if(n.executable.uri)e=n.executable.uri;else if(Ue(n)==="Conda")e=Ur()==="Windows"?pt.Uri.joinPath(n.environment?.folderUri||pt.Uri.file(n.path),"python.exe"):pt.Uri.joinPath(n.environment?.folderUri||pt.Uri.file(n.path),"bin","python");else{p.warn(`Python environment ${M(n.id)} excluded as Uri is undefined`);return}return{id:t,uri:e}}function Am(n){if(n){let e=Object.assign({},n,{path:Ae(n.uri)});return delete e.uri,e}}var Cg=class{constructor(e,t){this.disposables=e;this.extensionChecker=t;this.api=ne();this.didActivatePython=new pt.EventEmitter;this._pythonExtensionHooked=ne();this.extensionChecker.isPythonExtensionInstalled||pt.extensions.onDidChange(async()=>{this.extensionChecker.isPythonExtensionInstalled&&await this.registerHooks()},this,this.disposables),this.disposables.push(this.didActivatePython)}get onDidActivatePythonExtension(){return this.didActivatePython.event}get pythonExtensionHooked(){return this._pythonExtensionHooked.promise}get pythonExtensionVersion(){return this._pythonExtensionVersion}getApi(){return this.init().catch(h),this.api.promise}async getNewApi(){await this.init();let e=pt.extensions.getExtension(sn);return e?.packageJSON?.version&&(this._pythonExtensionVersion=new H$.SemVer(e?.packageJSON?.version)),e?.exports&&(N2(e.exports),e.exports.environments.known.forEach(t=>{$$(t)})),e?.exports}setApi(e){this.api.resolved||!pt.workspace.isTrusted||this.api.resolve(e)}async init(){if(this.initialized)return;pt.extensions.getExtension(sn)?await this.registerHooks():await this.extensionChecker.showPythonExtensionInstallRequiredPrompt(),this.initialized=!0}async registerHooks(){if(this.hooksRegistered)return;let e=pt.extensions.getExtension(sn);if(!e)return;let t=!1;if(!e.isActive){let r=j$();try{let i=e.activate();i.then(()=>r.stop(),()=>r.stop()),await i,t=!0}catch(i){p.error("Failed activating the python extension: ",i),this.api.reject(new Ok(i));return}}this.hooksRegistered||(this.hooksRegistered=!0,t&&this.didActivatePython.fire(),e.exports?.jupyter?e.exports.jupyter.registerHooks():(p.error("Python extension is not exporting the jupyter API"),this.api.reject(new Fk)),this._pythonExtensionHooked.resolve())}};Cg=v([(0,Rs.injectable)(),m(0,(0,Rs.inject)(K)),m(1,(0,Rs.inject)(qe))],Cg);var kd=class{constructor(e){this.disposables=e;this.pythonExtensionInstallationStatusChanged=new pt.EventEmitter;pt.extensions.onDidChange(this.extensionsChangeHandler.bind(this),this,this.disposables),this.previousInstallState=this.isPythonExtensionInstalled}get onPythonExtensionInstallationStatusChanged(){return this.pythonExtensionInstallationStatusChanged.event}get isPythonExtensionInstalled(){return pt.extensions.getExtension(sn)!==void 0}get isPythonExtensionActive(){return pt.extensions.getExtension(sn)?.isActive===!0}async directlyInstallPythonExtension(){return pt.commands.executeCommand("workbench.extensions.installExtension",sn,{context:{skipWalkthrough:!0}})}async showPythonExtensionInstallRequiredPrompt(){if(!pt.workspace.isTrusted)return;kd.promptDisplayed=!0;let e=ce.bannerLabelYes;T("DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",void 0,{action:"displayed"}),await pt.window.showInformationMessage(y.pythonExtensionRequired,{modal:!0},e)===e?(T("DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",void 0,{action:"download"}),await this.installPythonExtension()):T("DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",void 0,{action:"dismissed"})}async installPythonExtension(){pt.commands.executeCommand("extension.open",sn).then(h,h)}async extensionsChangeHandler(){let e=this.isPythonExtensionInstalled;e!==this.previousInstallState&&(this.pythonExtensionInstallationStatusChanged.fire(e?"installed":"uninstalled"),this.previousInstallState=e)}};kd=v([(0,Rs.injectable)(),m(0,(0,Rs.inject)(K))],kd);var Eg=class{constructor(e,t,r,i){this.apiProvider=e;this.extensionChecker=t;this.disposables=r;this.context=i;this.didChangeInterpreter=new pt.EventEmitter;this.didChangeInterpreters=new pt.EventEmitter;this._onDidEnvironmentVariablesChange=new pt.EventEmitter;this._onDidRemoveInterpreter=new pt.EventEmitter;this.onDidRemoveInterpreter=this._onDidRemoveInterpreter.event;this.onDidEnvironmentVariablesChange=this._onDidEnvironmentVariablesChange.event;this._status="idle";this._onDidChangeStatus=new pt.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this.refreshPromises=new ho;this.onResumeEnvDetection=new pt.EventEmitter;this.workspaceCachedActiveInterpreter=new Set;this.lastLoggedResourceAndInterpreterId="";this.pythonEnvHashes=new Map;this.loggedEnvsWithoutInterpreterPath=new Set;this.pendingInterpreterChangeEventTriggers=new Map;this.pendingInterpretersChangeEventTriggers=new Map;this.extensionChecker.isPythonExtensionInstalled&&!this.extensionChecker.isPythonExtensionActive&&this.apiProvider.onDidActivatePythonExtension(()=>{this.hookupOnDidChangeInterpreterEvent()},this,this.disposables),pt.workspace.onDidGrantWorkspaceTrust(()=>this.refreshInterpreters(!0),this,this.disposables),this.disposables.push(this._onDidChangeStatus),this.disposables.push(this.refreshPromises),this.disposables.push(this.onResumeEnvDetection),this.refreshPromises.onStateChange(()=>{this.status=this.refreshPromises.isComplete?"idle":"refreshing"})}get status(){return this._status}set status(e){this._status!==e&&(this._status=e,this._onDidChangeStatus.fire())}initialize(){this.hookupOnDidChangeInterpreterEvent()}async hasWorkspaceSpecificEnvironment(){if(!(pt.workspace.workspaceFolders||[]).length)return!1;let e=await this.getApi();return e?!!(pt.workspace.workspaceFolders||[]).some(t=>tx(t.uri,e.environments.known)):!1}async resolveEnvironment(e){return this.getApi().then(t=>{if(!t)return;let r=typeof e=="string"?t.environments.known.find(i=>i.id===e||i.path===e):e;return t.environments.resolveEnvironment(r||e)})}get onDidChangeInterpreter(){return this.hookupOnDidChangeInterpreterEvent(),this.didChangeInterpreter.event}get onDidChangeInterpreters(){return this.hookupOnDidChangeInterpreterEvent(),this.didChangeInterpreters.event}async refreshInterpreters(e=!1){let t=(async()=>{let r=await this.getApi();if(r)try{await r.environments.refreshEnvironments({forceRefresh:e}),this.hookupOnDidChangeInterpreterEvent(),p.debug("Refreshed Environments")}catch{p.error("Failed to refresh the list of interpreters")}})();this.refreshPromises.push(t),this.refreshPromises.push(t.then(()=>Hn(1e3))),await t}async getActiveInterpreter(e){if(!pt.workspace.isTrusted)return;let t=new Me;this.hookupOnDidChangeInterpreterEvent(),!e&&pt.workspace.workspaceFolders?.length===1&&(e=pt.workspace.workspaceFolders[0].uri),pt.workspace.workspaceFolders?.length&&(e=(e?pt.workspace.getWorkspaceFolder(e)?.uri:void 0)||pt.workspace.workspaceFolders[0].uri);let r=Ds(e),i=this.getApi().then(async o=>{if(!o)return;let s=o.environments.getActiveEnvironmentPath(e),a=await o.environments.resolveEnvironment(s);return this.trackResolvedEnvironment(a)});return i.then(()=>{this.workspaceCachedActiveInterpreter.has(r)||(this.workspaceCachedActiveInterpreter.add(r),T("DS_INTERNAL.ACTIVE_INTERPRETER_LISTING_PERF",{duration:t.elapsedTime},{firstTime:!0}))}).catch(o=>{p.warn(`Failed to get active interpreter from Python for workspace ${r}`,o)}),(qn||[pt.ExtensionMode.Development,pt.ExtensionMode.Test].includes(this.context.extensionMode))&&i.then(o=>{let s=`${M(e)}'-${M(o?.id)}`;if(this.lastLoggedResourceAndInterpreterId===s)return;this.lastLoggedResourceAndInterpreterId=s;let a=Ri(o);p.trace(`Active Interpreter ${e?`for '${M(e)}' `:""}is ${M(o?.id)} (${o&&Ue(o)}, '${o?Vo(o):""}', ${a?.major}.${a?.minor}.${a?.micro})`)}).catch(h),i}getInterpreterHash(e){return this.pythonEnvHashes.get(e)}async getInterpreterDetails(e,t){if(!pt.workspace.isTrusted)throw new Error("Unable to determine active Interpreter as Workspace is not trusted");this.hookupOnDidChangeInterpreterEvent();try{return await this.getApi().then(async r=>{if(!r||t?.isCancellationRequested)return;let i=r.environments.known.find(l=>Gn(e)?Bo(l.executable.uri,e):typeof e=="string"?l.id===e:Bo(pt.Uri.file(l.path),pt.Uri.file(e.path))),o=Gn(e)?M(e):typeof e=="string"?e:M(pt.Uri.file(e.path));if(i){let l=await r.environments.resolveEnvironment(i),c=this.trackResolvedEnvironment(l);return p.ci(`Interpreter details for ${o} from Python is ${JSON.stringify(l)} and our mapping is ${JSON.stringify(c)}`),c}let s=o;if(this.loggedEnvsWithoutInterpreterPath.has(s)||(this.loggedEnvsWithoutInterpreterPath.add(s),p.warn(`No interpreter with path ${o} found in Python API, will convert Uri path to string as Id ${o}`)),t?.isCancellationRequested)return;let a=await r.environments.resolveEnvironment(Gn(e)?e.fsPath:typeof e=="string"?e:e.path);return this.trackResolvedEnvironment(a)})}catch(r){p.warn(`Failed to get Python interpreter details from Python Extension API for ${typeof e=="string"?e:M(Gn(e)?e:pt.Uri.file(e.path))}`,r);return}}trackResolvedEnvironment(e){if(e){let t=Ai(e);return t?(xl(t).then(r=>{this.pythonEnvHashes.set(t.id,r)}).catch(h),this.triggerEventIfAllowed("interpretersChangeEvent",t),t):void 0}}triggerEventIfAllowed(e,t){e==="interpreterChangeEvent"?this.pendingInterpreterChangeEventTriggers.set(t?.id||"",t):this.pendingInterpretersChangeEventTriggers.set(t?.id||"",t),this.triggerPendingEvents()}triggerPendingEvents(){this.pendingInterpreterChangeEventTriggers.forEach(t=>this.didChangeInterpreter.fire(t)),this.pendingInterpreterChangeEventTriggers.clear();let e=Array.from(this.pendingInterpretersChangeEventTriggers.values());if(e.length){let t=e.filter(r=>!!r);t.length!==e.length&&t.length===0?this.didChangeInterpreters.fire([]):this.didChangeInterpreters.fire(t)}this.pendingInterpretersChangeEventTriggers.clear()}async getApi(){if(this.extensionChecker.isPythonExtensionInstalled)return this.apiPromise||(this.apiPromise=this.apiProvider.getNewApi()),this.apiPromise}hookupOnDidChangeInterpreterEvent(){if(this.eventHandlerAdded)return;let e=new Uh;this.disposables.push(e),this.getApi().then(t=>{!this.eventHandlerAdded&&t&&(this.eventHandlerAdded=!0,t.environments.onDidEnvironmentVariablesChange(r=>{p.debug(`Detected changes to env file ${r.resource?.uri?.path} in PythonApi`),this._onDidEnvironmentVariablesChange.fire()},this,this.disposables),t.environments.onDidChangeActiveEnvironmentPath(()=>{p.trace("Detected change in Active Python environment via Python API"),this.workspaceCachedActiveInterpreter.clear(),this.triggerEventIfAllowed("interpreterChangeEvent",void 0)},this,this.disposables),t.environments.onDidChangeEnvironments(async r=>{if(p.trace(`Python API env change detected, ${r.type} => '${r.env.id}'`),r.type==="remove"){let s=setTimeout(()=>{p.trace(`Python API env change detected & removed after 30000, ${r.type} => '${r.env.id}'`),e.deleteAndDispose(r.env.id),this.triggerEventIfAllowed("interpreterChangeEvent",void 0),this.triggerEventIfAllowed("interpretersChangeEvent",void 0),this._onDidRemoveInterpreter.fire({id:r.env.id})},3e4);e.set(r.env.id,new pt.Disposable(()=>clearTimeout(s)));return}e.deleteAndDispose(r.env.id);let i=Ai(mr(r.env));i&&(this.triggerEventIfAllowed("interpreterChangeEvent",i),this.triggerEventIfAllowed("interpretersChangeEvent",i))},this,this.disposables),this.didChangeInterpreters.fire(mo().map(Ai).filter(r=>!!r).map(r=>r)))}).catch(h)}};Eg=v([(0,Rs.injectable)(),m(0,(0,Rs.inject)(tr)),m(1,(0,Rs.inject)(qe)),m(2,(0,Rs.inject)(K)),m(3,(0,Rs.inject)(tt))],Eg);var wg=require("vscode");function rx(n,e){let t=n.length>0?`?token=${n}`:"";return`${e}${t}`}function nx(n,e,t){return n?t.createSystemVariables(e).resolve(n):e?it(Ae(e)):process.cwd()}async function ix(n,e){let t=y.jupyterSelfCertEnable,r=y.jupyterSelfCertClose,i=await wg.window.showErrorMessage(y.jupyterSelfCertFail(e),{modal:!0},t,r);return i===t?(T("DATASCIENCE.SELFCERTSMESSAGEENABLED"),await n.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,wg.ConfigurationTarget.Workspace),!0):(i===r&&T("DATASCIENCE.SELFCERTSMESSAGECLOSE"),!1)}async function ox(n,e){let t=y.jupyterSelfCertEnable,r=y.jupyterSelfCertClose,i=await wg.window.showErrorMessage(y.jupyterExpiredCertFail(e),{modal:!0},t,r);return i===t?(T("DATASCIENCE.SELFCERTSMESSAGEENABLED"),await n.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,wg.ConfigurationTarget.Workspace),!0):(i===r&&T("DATASCIENCE.SELFCERTSMESSAGECLOSE"),!1)}function HC(n,e,t,r,i,o,s){let a=e.baseUrl,l=e.token,c=new URL(e.baseUrl).hostname,u=e.authorizationHeader&&Object.keys(e?.authorizationHeader??{}).length>0?e.authorizationHeader:void 0;l&&n.extensionId===_e&&n.id===oC&&(u=u||{},u.Authorization=u.Authorization||`token ${l}`);let d=u?()=>u:void 0,f={baseUrl:a,appUrl:"",wsUrl:a.replace("http","ws"),fetch:e.fetch,WebSocket:e.WebSocket},g=t.getRequestInit();(!(l===""||l==="null")||d)&&(f={...f,token:l,appendToken:!0});let I=i.getSettings(void 0).allowUnauthorizedRemoteConnection;if(a.startsWith("https")&&I&&r){let A=r.createHttpRequestAgent();g={...g,agent:A}}let{ServerConnection:w}=require("@jupyterlab/services");return f={...f,init:g,WebSocket:e.WebSocket?t.wrapWebSocketCtor(e.WebSocket):t.getWebsocketCtor(void 0,I,d),fetch:e.fetch||t.getFetchMethod(),Request:t.getRequestCtor(void 0,I,d),Headers:t.getHeadersCtor()},{baseUrl:a,providerId:n.id,serverProviderHandle:n,token:l,hostName:c,displayName:e&&e.displayName?e.displayName:rx(l,a),dispose:()=>s?.dispose(),rootDirectory:o,getAuthHeader:d,settings:w.makeSettings(f)}}async function z$(n){let e=Lt(n);return ga(e,"SHA-256")}var Loe=new Set([_e,"ms-toolsai.vscode-ai","GitHub.codespaces"].map(n=>n.toLowerCase()));function Lt(n){return Loe.has(n.extensionId.toLowerCase())?`${Le.REMOTE_URI}?${Le.REMOTE_URI_ID_PARAM}=${n.id}&${Le.REMOTE_URI_HANDLE_PARAM}=${encodeURI(n.handle)}`:`${Le.REMOTE_URI}?${Le.REMOTE_URI_ID_PARAM}=${n.id}&${Le.REMOTE_URI_HANDLE_PARAM}=${encodeURI(n.handle)}&${Le.REMOTE_URI_EXTENSION_ID_PARAM}=${encodeURI(n.extensionId)}`}async function sx(n){if(!ol()&&n.interpreter?.uri){let e=n.interpreter.uri.fsPath,t=kl(n.interpreter.uri).fsPath,r=n.id.replace(e,t);return ot(r)}return ot(n.id)}var As=class{static fromJSON(e){let t=Object.assign(e,{});switch(t.interpreter&&(t.interpreter=qC(t.interpreter,"")),e.kind){case"startUsingLocalKernelSpec":return xd.create(t);case"connectToLiveRemoteKernel":return GC.create(t);case"startUsingRemoteKernelSpec":return zC.create(t);case"startUsingPythonInterpreter":return $o.create(t);default:throw new Error(`Invalid object to be deserialized into a connection, kind = ${t.kind}`)}}},GC=class n{constructor(e){this.kind="connectToLiveRemoteKernel";this.kernelModel=e.kernelModel,this.interpreter=e.interpreter,this.baseUrl=e.baseUrl,this.id=e.id,this.serverProviderHandle=e.serverProviderHandle,lx(this)}static create(e){return new n(e)}updateModel(e){Object.assign(this.kernelModel,e)}getHashId(){return sx(this)}toJSON(){return{id:this.id,kind:this.kind,baseUrl:this.baseUrl,interpreter:Am(this.interpreter),kernelModel:this.kernelModel,serverProviderHandle:this.serverProviderHandle}}static fromJSON(e){return As.fromJSON(e)}},xd=class n{constructor(e){this.kind="startUsingLocalKernelSpec";this.kernelSpec=e.kernelSpec,this.interpreter=e.interpreter,this.id=e.id,lx(this)}static create(e){return new n(e)}getHashId(){return sx(this)}toJSON(){return{id:this.id,kernelSpec:this.kernelSpec,interpreter:Am(this.interpreter),kind:this.kind}}static fromJSON(e){return As.fromJSON(e)}},zC=class n{constructor(e){this.kind="startUsingRemoteKernelSpec";this.interpreter=e.interpreter,this.kernelSpec=e.kernelSpec,this.baseUrl=e.baseUrl,this.id=e.id,this.serverProviderHandle=e.serverProviderHandle,lx(this)}static create(e){return new n(e)}getHashId(){return sx(this)}toJSON(){return{id:this.id,kernelSpec:this.kernelSpec,interpreter:Am(this.interpreter),baseUrl:this.baseUrl,kind:this.kind,serverProviderHandle:this.serverProviderHandle}}static fromJSON(e){return As.fromJSON(e)}},$o=class n{constructor(e){this.kind="startUsingPythonInterpreter";this.kernelSpec=e.kernelSpec,this.interpreter=e.interpreter,this.id=e.id,lx(this)}static create(e){return new n(e)}getHashId(){return sx(this)}toJSON(){return{id:this.id,kernelSpec:this.kernelSpec,interpreter:Am(this.interpreter),kind:this.kind}}updateInterpreter(e){Object.assign(this.interpreter,e)}static fromJSON(e){return As.fromJSON(e)}};function at(n){return n.kind==="startUsingLocalKernelSpec"||n.kind==="startUsingPythonInterpreter"}function Dt(n){return!at(n)}var ye=Symbol("IKernelProvider"),Nm=Symbol("IThirdPartyKernelProvider");var ax=Symbol("IJupyterServerConnector"),QC=Symbol("IKernelSessionFactory");var go=Symbol("IKernelDependencyService"),Ar=Symbol("IKernelFinder"),Pg=Symbol("ITracebackFormatter");var Bc=Symbol("IStartupCodeProviders"),Q$=new Set;function lx(n){if(Q$.has(n.id))return;Q$.add(n.id);let e="kernelSpec"in n?n.kernelSpec:void 0,t=e?.language||(n.kind==="startUsingPythonInterpreter"?ge:void 0),r="",i="",o="interpreter"in n?n.interpreter:void 0,s="<#>",a;e&&Array.isArray(e.argv)&&e.argv.length>0&&(r=e.argv[0],a=r.toLowerCase()===o?.uri?.fsPath?.toLowerCase(),Ce(r)!==r&&(r=`<P>${Ce(r)}`),i=e.argv.map(g=>g.includes("/")||g.includes("\\")?`<P>${Ce(g)}`:g).join(s));let l="kernelSpec"in n&&n.kernelSpec.specFile?ot(n.kernelSpec.specFile):Promise.resolve(""),c=ot(n.id),u=Dt(n)?ot(Lt(n.serverProviderHandle)):Promise.resolve(""),d=Dt(n)?n.serverProviderHandle.extensionId:_e,f=Dt(n)?ot(n.baseUrl.toLowerCase()):Promise.resolve("");Promise.all([l,c,u,f]).then(([g,b,I,w])=>T("DS_INTERNAL.JUPYTER_KERNEL_SPEC",void 0,{kernelId:b,serverIdHash:I,kernelSpecHash:g,baseUrlHash:w,providerExtensionId:d,kernelConnectionType:n.kind,kernelLanguage:t,envType:o&&Ue(o),isArgv0SameAsInterpreter:a,argv0:r,argv:i})).catch(h)}var Mm=Symbol("IKernelWorkingDirectory");var Lm=require("vscode");var cx="application/vnd.vscode.chat_message",Y$=`
def __VSCODE_inject_module():

    def __VSCODE_call_function(function, callback, data=None):
        __VSCODE_send_chat_message__(function, data, callback=callback)

    def __VSCODE_send_chat_message__(function, data, callback):
        requests = {}
        try:
            requests = __VSCODE_send_chat_message__.__requests
        except Exception:
            __VSCODE_send_chat_message__.__requests = requests

        import uuid as __VSCODE_send_chat_message__uuid
        import IPython.display as __VSCODE_send_chat_message__ipython_display

        id = str(__VSCODE_send_chat_message__uuid.uuid4())
        requests[id] = callback
        data_is_none = data is None
        __VSCODE_send_chat_message__ipython_display.display({"${cx}": data}, metadata={"id":id, "function": function, "dataIsNone": data_is_none}, raw=True)

        del __VSCODE_send_chat_message__ipython_display
        del __VSCODE_send_chat_message__uuid

    def __VSCODE_on_chat_message(id, data):
        requests = {}
        try:
            requests = __VSCODE_send_chat_message__.__requests
        except Exception:
            __VSCODE_send_chat_message__.__requests = requests

        if id in requests:
            requests[id](data)
            del requests[id]
        else:
            raise NotImplementedError(f"Callback not found for message {id}")

    import sys as __VSCODE_send_chat_message__sys
    import IPython as __VSCODE_send_chat_message__IPython
    chat = type(__VSCODE_send_chat_message__IPython)("chat")
    chat.send_message = __VSCODE_send_chat_message__
    chat.call_function = __VSCODE_call_function
    chat.__on_message = __VSCODE_on_chat_message
    __VSCODE_send_chat_message__sys.modules["vscode"] = type(__VSCODE_send_chat_message__IPython)("vscode")
    __VSCODE_send_chat_message__sys.modules["vscode"].chat = chat
    del __VSCODE_send_chat_message__sys
    del __VSCODE_send_chat_message__IPython


__VSCODE_inject_module()
del __VSCODE_inject_module
`,Uoe=[[new RegExp("\\\\","g"),"\\\\"],[new RegExp('"',"g"),'\\"'],[new RegExp("'","g"),"'"],[new RegExp("\\\b","g"),"\\b"],[new RegExp("\\f","g"),"\\f"],[new RegExp("\\n","g"),"\\n"],[new RegExp("\\r","g"),"\\r"],[new RegExp("\\t","g"),"\\t"]];function X$(n,e){let t=YC(e),r=typeof t=="string"?`"${t}"`:"None";return`
import vscode as __vscode
try:
    __vscode.chat.__on_message('${n}', ${r})
finally:
    del __vscode
`}function YC(n){if(typeof n!="string")return n;for(let[e,t]of Uoe)n=n.replace(e,t);return n}var On=require("vscode"),PJ=k(iM());var oM=class{constructor(e,t,r,i=!1){this._impl=e;this.controllerId=t;this._endCallback=r;this.clearOutputOnStartWithTime=i;this._started=!1}get started(){return this._started}get cell(){return this._impl.cell}get token(){return this._impl.token}get executionOrder(){return this._impl.executionOrder}set executionOrder(e){e&&kn(this._impl.cell.notebook)?.executeCellAcknowledged(),this._impl.executionOrder=e}startIfNecessary(){this.started||(this._started=!0,this._impl.start())}start(e){this.started||(this._started=!0,this._impl.start(e),this._startTime=e,this.clearOutputOnStartWithTime?(p.trace(`Start cell ${this.cell.index} execution @ ${e} (clear output)`),this._impl.clearOutput().then(h,h)):p.trace(`Start cell ${this.cell.index} execution @ ${e}`))}end(e,t){if(this._endCallback)try{this._impl.end(e,t,this.errorInfo),p.trace(`Cell ${this.cell.index} completed in ${((t||0)-(this._startTime||0))/1e3}s (start: ${this._startTime}, end: ${t})`)}finally{this._endCallback(),this._endCallback=void 0}}clearOutput(e){return this.startIfNecessary(),this._impl.clearOutput(e)}replaceOutput(e,t){return this.startIfNecessary(),this._impl.replaceOutput(e,t)}appendOutput(e,t){return this.startIfNecessary(),this._impl.appendOutput(e,t)}replaceOutputItems(e,t){return this.startIfNecessary(),this._impl.replaceOutputItems(e,t)}appendOutputItems(e,t){return this.startIfNecessary(),this._impl.appendOutputItems(e,t)}},Ki=class n{static{this._map=new WeakMap}static getOrCreate(e,t,r=!1){let i;if(i=this.get(e),!i)i=n.create(e,t,r);else if(i.controllerId!==t.id){let o=i;o.end(void 0),i=n.create(e,t,r),o.started&&i.start(new Date().getTime())}return i}static get(e){return n._map.get(e)}static create(e,t,r=!1){let i=new oM(t.createNotebookCellExecution(e),t.id,()=>{n._map.delete(e)},r);return n._map.set(e,i),i}};var Xoe=k(fJ()),$c=require("vscode");var Dd=class{constructor(e,t,r,i){this.specFile=t;this.interpreterPath=r;this.isRegisteredByVSC=i;this.name=e.name,this.argv=e.argv,this.language=e.language,this.executable=e.argv&&e.argv.length>0?e.argv[0]:"",this.display_name=e.display_name,this.metadata=e.metadata,this.env=e.env,this.interrupt_mode=e.interrupt_mode}};function XC(n){if(n.hasOwnProperty("text/html")){let e=n["text/html"];typeof e=="string"&&e.includes('<iframe id="tensorboard-frame-')&&(n["text/html"]=e.replace(/new URL\((.*), window.location\)/,'new URL("http://localhost")'))}return n}var Km="{connection_file}";function hJ(n){return n.argv.findIndex(e=>e.includes(Km))}var kg="-jvsc-",Zoe=/^python\d*.?\d*$/;async function Ns(n,e){return ese(await pM(n),n,e)}function ese(n,e,t){let r=e?{path:Ae(e.uri)}:{},i={name:n,language:"python",display_name:(e?mr(e)?.environment?.name:"")||"Python 3",metadata:{interpreter:r},argv:["python","-m","ipykernel_launcher","-f",Km],env:{},resources:{}},o=t&&i.name?zt(t,i.name,"kernel.json"):void 0;return new Dd(i,o?Ae(o):void 0,Ae(e?.uri),"registeredByNewVersionOfExt")}function gJ(n){let e=JSON.parse(JSON.stringify(n));return e.env&&Object.keys(e.env).forEach(r=>{if(e.env){let i=e.env[r];i!=null&&(e.env[r]=i.toString())}}),e}function xg(n){let e=n?.kernelspec;return n?.language_info?.name&&n.language_info.name!==ge?!1:e?.name?.includes(ge)?!0:e?.language===ge||n?.language_info?.name===ge}function eE(n){let e=n.metadata?.vscode?.originalSpecFile||n.metadata?.originalSpecFile,t=e?Ce(it(e)):n.name||"",r=n.metadata?.vscode?.originalDisplayName||n.display_name||"";return!!(t.toLowerCase().match(Zoe)||r.toLowerCase()==="python 3 (ipykernel)"||r.toLowerCase()==="python 3")}function tse(n){if(n.includes(kg)){let e=/[a-f0-9]$/;if(n.substring(n.lastIndexOf(kg)+kg.length).search(e)!==-1){let t=n.substring(0,n.lastIndexOf(kg));return t.toLowerCase().endsWith(".ipynb")||t.toLowerCase().endsWith(".py")?t:`${t}.ipynb`}}return n}function dx(n){return n.kind!=="connectToLiveRemoteKernel"}function Dg(n){return n.kind==="connectToLiveRemoteKernel"}function Oi(n,e,t){e=cM(n)?e:void 0;let r=n.name,i=Kn(n);if(i&&r.includes(ZC)&&(r=r.substring(r.indexOf(ZC)),i==="registeredByNewVersionOfExtForCustomKernelSpec")){let c=n.metadata?.vscode?.originalSpecFile||n.metadata?.originalSpecFile;c&&(r=`${r}#${Ce(it(c))}`)}let o="";cM(n)?o=n.argv.slice(1).filter(c=>!["-f","{connection_file}"].includes(c)).join("#").toLowerCase():o=n.argv.join("#").toLowerCase();let s=t?`${t}.`:"",a=Ae(kl(n.interpreterPath?$c.Uri.file(n.interpreterPath):$c.Uri.file(n.executable))),l=Ae(kl(e?.uri))||"";return`${s}${n.id||""}.${r}.${a}.${l}.${o}`}function lt(n){let e=nse(n);if(!n)return e;switch(n.kind){case"connectToLiveRemoteKernel":{let r=tse(n.kernelModel?.notebook?.path||n.kernelModel?.model?.path||"");return r?`${e} (${r})`:e}case"startUsingRemoteKernelSpec":case"startUsingLocalKernelSpec":if(n.interpreter&&Ue(n.interpreter)!=="Unknown"){let r=Vo(n.interpreter);if(n.kernelSpec.language===ge){let i=`Python ${Lc(Ri(n.interpreter))||""}`.trim();return r?`${e} (${i})`:e}else return r?`${e} (${r})`:e}else return e;case"startUsingPythonInterpreter":let t=(Lc(Ri(n.interpreter))||"").trim();return n.interpreter&&Ue(n.interpreter)!=="Unknown"?n.kernelSpec.display_name&&Kn(n.kernelSpec)==="registeredByNewVersionOfExtForCustomKernelSpec"?n.kernelSpec.display_name:rse(n.interpreter):`Python ${t}`.trim()}return e}function rse(n){if(Ue(n)==="Unknown")return"";let e=(Lc(Ri(n))||"").trim(),t=qr(n),r=e.trim()?`Python ${e}`:"Python",i=Vo(n);return t&&i?i:i?`${i} (${r})`:r}function nse(n){if(!n)return"";let e=n.kind==="connectToLiveRemoteKernel"?n.kernelModel.display_name:n.kernelSpec?.display_name,t=n.kind==="connectToLiveRemoteKernel"?n.kernelModel.name:n.kernelSpec?.name,r=n.kind==="startUsingPythonInterpreter"?Hr(n.interpreter):void 0;return[e,t,r,""].find(i=>typeof i=="string"&&i.length>0)||""}function _d(n,e=""){return n?n.kind==="connectToLiveRemoteKernel"?n.kernelModel.name:n.kernelSpec?.name:e}function ise(n){if(!n)return;let e=Dg(n)?n.kernelModel:void 0,t=dx(n)?n.kernelSpec:void 0;if(n.kind==="startUsingPythonInterpreter"||(n.kind==="startUsingRemoteKernelSpec"||n.kind==="startUsingLocalKernelSpec")&&n.kernelSpec.language===ge){let r=t?.metadata?.interpreter?.path||t?.interpreterPath||t?.executable;if(r==="/python"||r==="python"){let i=mr(n.interpreter);return i?.environment?.folderUri||(i?$c.Uri.file(i.path):void 0)}return r?$c.Uri.file(r):void 0}else{let r=e?.executable||t?.executable||t?.metadata?.interpreter?.path||t?.interpreterPath;return r?$c.Uri.file(r):void 0}}function uM(n,e=""){if(n?.kind==="connectToLiveRemoteKernel"){let t;if(typeof n.kernelModel.lastActivityTime=="string")try{t=new Date(n.kernelModel.lastActivityTime)}catch(r){p.debug(`Error parsing date ${r}`)}else t=n.kernelModel.lastActivityTime;return y.jupyterSelectLiveRemoteKernelDescription(t,n.kernelModel.numberOfConnections)}return e}function dM(n,e){if(n?.kind==="connectToLiveRemoteKernel")return;let t=ise(n),r=$c.workspace.workspaceFolders?$c.workspace.workspaceFolders:[];return t?M(t,r,e.homeDir):""}function vJ(n){if(!n)return;if(n.interpreter)return n.interpreter;let e=Dg(n)?n.kernelModel:void 0;if(e?.metadata?.interpreter)return qC(e?.metadata?.interpreter,"");let t=dx(n)?n.kernelSpec:void 0;return qC(t?.metadata?.interpreter,"")}function _g(n){return n.kind==="startUsingLocalKernelSpec"||n.kind==="startUsingPythonInterpreter"&&n.kernelSpec&&Kn(n.kernelSpec)==="registeredByNewVersionOfExtForCustomKernelSpec"}function Xe(n){if(!n)return!1;if(n.kind==="startUsingPythonInterpreter")return!0;let e=Dg(n)?n.kernelModel:void 0,t=dx(n)?n.kernelSpec:void 0;return e?.language===ge||cM(t)}function cM(n){return(n?.language||"").toLowerCase()===ge}function yo(n){if(!n)return;if(n.kind==="startUsingPythonInterpreter")return ge;let e=Dg(n)?n.kernelModel:void 0,t=dx(n)?n.kernelSpec:void 0;return e?.language||yJ(t)}function px(n){if(!n)return;let e=n.kernelspec;return yJ(e)||n.language_info?.name}function yJ(n){return n?.language}var ZC="jvsc74a57bd0";async function pM(n){let t=(Lc(Ri(n))||"3").replace(/\./g,""),r=n?`python${t}`:"";return n?`${r}${ZC}${await xl(n)}`:"python3"}function Kn(n){if(n.isRegisteredByVSC)return n.isRegisteredByVSC;if(!n.name)return;let e=n.metadata?.vscode?.originalSpecFile||n.metadata?.originalSpecFile,t=e?Ce(it(e)):n.name,r=eE({...n,name:t})?Object.keys(n.env||{}).length>0:typeof e=="string"&&!e.includes(ZC);if(n.name.includes(ZC))return r?"registeredByNewVersionOfExtForCustomKernelSpec":"registeredByNewVersionOfExt";let i=/[a-f0-9]{32}$/;if(n.metadata?.interpreter&&n.name.toLowerCase().search(i)!==-1)return"registeredByOldVersionOfExt"}function bJ(n,e){return!n&&!e?!0:!n&&e||n&&!e?!1:n?.id===e?.id}async function gn(n,e,t){p.trace(`Executing silently Code (${n.status}) = ${Be(e.substring(0,100)).join("\\n")}`);let r=require("@jupyterlab/services"),i=n.requestExecute({code:e.replace(/\r\n/g,`
`),silent:!1,stop_on_error:!1,allow_stdin:!0,store_history:!1},!0),o=[];i.onIOPub=a=>{if(r.KernelMessage.isStreamMsg(a))if(p.ci(`Got io pub message (stream), ${Be(a.content.text.substr(0,100)).join("\\n")}`),o.length>0&&o[o.length-1].output_type==="stream"&&o[o.length-1].name===a.content.name){let l=o[o.length-1];l.text+=a.content.text}else{let l={name:a.content.name,text:a.content.text,output_type:"stream"};o.push(l)}else if(r.KernelMessage.isExecuteResultMsg(a)){p.ci("Got io pub message (execresult)}");let l={data:a.content.data,execution_count:a.content.execution_count,metadata:a.content.metadata,output_type:"execute_result"};o.push(l)}else if(r.KernelMessage.isDisplayDataMsg(a)){p.ci("Got io pub message (displaydata)}");let l={data:a.content.data,metadata:a.content.metadata,output_type:"display_data"};o.push(l)}else if(r.KernelMessage.isErrorMsg(a)){if(p.ci(`Got io pub message (error), ${a.content.ename},${a.content.evalue}, ${a.content.traceback.join().substring(0,100)}}`),t?.traceErrors){let c=`${t.traceErrorsMessage||"Failed to execute (silent) code against the kernel"}, 
Code = ${e}
Error details: `;p.error(`${c} ${a.content.ename},${a.content.evalue}, ${a.content.traceback.join()}`)}let l={ename:a.content.ename,evalue:a.content.evalue,traceback:a.content.traceback,output_type:"error"};o.push(l)}else p.ci(`Got io pub message (${a.header.msg_type})`)},await i.done;let s=Be(e.substring(0,100)).join("\\n");return t&&ose(o,t,s),p.trace(`Executing silently Code (completed) = ${s} with ${o.length} output(s)`),o}function IJ(n,e,t,r){e=e.replace(/\r\n/g,`
`);let i=require("@jupyterlab/services"),o=n.requestExecute({code:e,silent:!1,stop_on_error:!1,allow_stdin:!1,store_history:!1},!0),s=Ut(t);return o.onIOPub=a=>{s(),i.KernelMessage.isStreamMsg(a)?r(vo({output_type:"stream",name:a.content.name,text:a.content.text})):i.KernelMessage.isExecuteResultMsg(a)?r(vo({output_type:"execute_result",data:a.content.data,metadata:a.content.metadata,transient:a.content.transient,execution_count:a.content.execution_count})):i.KernelMessage.isDisplayDataMsg(a)?r(vo({output_type:"display_data",data:XC(a.content.data),metadata:a.content.metadata,transient:a.content.transient})):i.KernelMessage.isUpdateDisplayDataMsg(a)?r(vo({output_type:"display_data",data:XC(a.content.data),metadata:a.content.metadata,transient:a.content.transient})):i.KernelMessage.isErrorMsg(a)?r(vo({output_type:"error",ename:a.content.ename,evalue:a.content.evalue,traceback:a.content.traceback})):i.KernelMessage.isExecuteInputMsg(a)||i.KernelMessage.isStatusMsg(a)||p.warn(`Got unexpected io pub message when executing code sillenty (${a.header.msg_type})`)},o}function ose(n,e,t){n.filter(r=>r.output_type==="error").forEach(r=>{let i=r,o=`${i.ename}: ${i.evalue} 
 ${i.traceback.map(a=>`    ${a}`).join(`
`)}`,s=`${e.traceErrorsMessage||""} ${t} ${o}`;e.traceErrors?p.error(s):p.warn(s),e.telemetryName&&T(e.telemetryName)})}function Tg(n){return typeof Buffer<"u"&&typeof Buffer.from=="function"?Buffer.from(n,"base64"):Uint8Array.from(atob(n),e=>e.charCodeAt(0))}var sse=new TextDecoder;function mx(n){if(typeof Buffer<"u"&&typeof Buffer.from=="function")return Buffer.from(n).toString("base64");{let e=sse.decode(n);return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(t,r){return String.fromCharCode(Number.parseInt("0x"+r))}))}}var SJ=["application/vnd.*","application/vdom.*","application/geo+json","application/x-nteract-model-debug+json","text/html","application/javascript","image/gif","text/latex","text/markdown","image/png","image/svg+xml","image/jpeg","application/json","text/plain"];function CJ(n){if(n.mime.startsWith("application/vnd."))try{return new TextDecoder().decode(n.data).length===0}catch{}return!1}function ase(n){return n.sort((e,t)=>{let r=(s,a)=>(s.endsWith(".*")&&(s=s.substr(0,s.indexOf(".*"))),a.startsWith(s)),i=SJ.findIndex(s=>r(s,e.mime)),o=SJ.findIndex(s=>r(s,t.mime));return CJ(e)&&(i=-1),CJ(t)&&(o=-1),i=i==-1?100:i,o=o==-1?100:o,i-o})}var Td=class n{static{this.cellStates=new WeakMap}static getCellState(e){return n.cellStates.get(e)?.state}static getCellStatus(e){return(n.cellStates.get(e)?.stateTransition||[]).join(", ")||""}static setCellState(e,t){let r=n.cellStates.get(e)?.start||new Me,i=n.cellStates.get(e)?.stateTransition||[];i.push(`${t} ${i.length===0?"@ start":`After ${r.elapsedTime}ms`}`),n.cellStates.set(e,{stateTransition:i,state:t,start:r})}};function ct(n,e){let t=typeof e=="string"?()=>e:e;p.ci(()=>`Cell Index:${n.index}, of document ${pr(n.notebook.uri)} with state:${Td.getCellStatus(n)}, exec: ${n.executionSummary?.executionOrder}. ${t()}. called from ${tj()}`)}var Ag=new Map;Ag.set("display_data",hx);Ag.set("error",dse);Ag.set("execute_result",hx);Ag.set("stream",lse);Ag.set("update_display_data",hx);function vo(n){let e=Ag.get(n.output_type),t;return e?t=e(n):(p.warn(`Unable to translate cell from ${n.output_type} to NotebookCellData for VS Code.`),t=hx(n)),t}function mM(n){let e={outputType:n.output_type};switch(n.transient&&(e.transient=n.transient),n.output_type){case"display_data":case"execute_result":case"update_display_data":{e.executionCount=n.execution_count,e.metadata=n.metadata?JSON.parse(JSON.stringify(n.metadata)):{};break}default:break}return e}function Om(n){return n.metadata}function hx(n){let e=mM(n);("image/svg+xml"in n.data||"image/png"in n.data)&&(e.__displayOpenPlotIcon=!0);let t=[];if(n.data)for(let r in n.data)t.push(use(r,n.data[r]));return new On.NotebookCellOutput(ase(t),e)}function lse(n){let e=_s(n.text),t=n.name==="stderr"?On.NotebookCellOutputItem.stderr:On.NotebookCellOutputItem.stdout;return new On.NotebookCellOutput([t(e)],mM(n))}function cse(n){if(n.items.length>0)return n.items[0].mime==="application/vnd.code.notebook.stderr"?"stderr":"stdout"}function EJ(n){let e=n.items[0];if(!e.data)return{output_type:"error",ename:"",evalue:"",traceback:[]};let t=n.metadata?.originalError,r=JSON.parse(new TextDecoder().decode(e.data));return{output_type:"error",ename:r.name,evalue:r.message,traceback:t?.traceback||gg(r.stack||r.message||"")}}var Rg=new TextDecoder,kJ=["text/plain","text/markdown","application/vnd.code.notebook.stderr","application/vnd.code.notebook.stdout"];function fx(n,e){if(!e)return"";try{if(n==="application/vnd.code.notebook.error"){let t=Rg.decode(e);return JSON.parse(t)}else if(n.startsWith("text/")||kJ.includes(n)){let t=Rg.decode(e);return gg(t)}else{if(n.startsWith("image/")&&n!=="image/svg+xml")return mx(e);if(n.toLowerCase().startsWith("application/vnd.holoviews_load.v")&&n.toLowerCase().endsWith("+json")){let t=Rg.decode(e);try{return t.length>0?JSON.parse(t):t}catch{return t}}else if(n.toLowerCase().includes("json")){let t=Rg.decode(e);return t.length>0?JSON.parse(t):t}else return Rg.decode(e)}}catch(t){return p.error(`Failed to convert ${n} output from a buffer ${typeof e}, ${e}`,t),""}}function use(n,e){if(!e)return On.NotebookCellOutputItem.text("",n);try{if((n.startsWith("text/")||kJ.includes(n))&&(Array.isArray(e)||typeof e=="string")){let t=Array.isArray(e)?_s(e):e;return On.NotebookCellOutputItem.text(t,n)}else return n.startsWith("image/")&&typeof e=="string"&&n!=="image/svg+xml"?new On.NotebookCellOutputItem(Tg(e),n):typeof e=="object"&&e!==null&&!Array.isArray(e)?On.NotebookCellOutputItem.text(JSON.stringify(e),n):(e=Array.isArray(e)?_s(e):e,On.NotebookCellOutputItem.text(e,n))}catch(t){return p.error(`Failed to convert ${n} output to a buffer ${typeof e}, ${e}`,t),On.NotebookCellOutputItem.text("")}}function wJ(n){let e=[];n.items.filter(r=>r.mime==="application/vnd.code.notebook.stderr"||r.mime==="application/vnd.code.notebook.stdout").map(r=>Rg.decode(r.data)).forEach(r=>{let i=r.split(`
`);e.length&&i.length&&i[0].length>0&&(e[e.length-1]=`${e[e.length-1]}${i.shift()}`);for(let o of i)e.push(o)});for(let r=0;r<e.length-1;r++)e[r]=`${e[r]}
`;return e.length&&e[e.length-1].length===0&&e.pop(),{output_type:"stream",name:cse(n)||"stdout",text:e}}function fM(n){let e=n.metadata,t;switch(e?.outputType){case"error":{t=EJ(n);break}case"stream":{t=wJ(n);break}case"display_data":{t={output_type:"display_data",data:n.items.reduce((i,o)=>(i[o.mime]=fx(o.mime,o.data),i),{}),metadata:e?.metadata||{}};break}case"execute_result":{t={output_type:"execute_result",data:n.items.reduce((i,o)=>(i[o.mime]=fx(o.mime,o.data),i),{}),metadata:e?.metadata||{},execution_count:typeof e?.executionCount=="number"?e?.executionCount:null};break}case"update_display_data":{t={output_type:"update_display_data",data:n.items.reduce((i,o)=>(i[o.mime]=fx(o.mime,o.data),i),{}),metadata:e?.metadata||{}};break}default:{let i=n.items.length===1&&n.items.every(l=>l.mime==="application/vnd.code.notebook.error"),o=n.items.every(l=>l.mime==="application/vnd.code.notebook.stderr"||l.mime==="application/vnd.code.notebook.stdout");if(i)return EJ(n);let s=e?.outputType||(o?"stream":"display_data");T("DS_INTERNAL.VSCNOTEBOOK_CELL_TRANSLATION_FAILED",void 0,{outputType:s});let a;s==="stream"?a=wJ(n):s==="display_data"?a={data:{},metadata:{},output_type:"display_data"}:a={output_type:s},e?.metadata&&(a.metadata=e.metadata),n.items.length>0&&(a.data=n.items.reduce((l,c)=>(l[c.mime]=fx(c.mime,c.data),l),{})),t=a;break}}return t&&e&&e.transient&&(t.transient=e.transient),t}function dse(n){return n=n||{output_type:"error",ename:"",evalue:"",traceback:[]},new On.NotebookCellOutput([On.NotebookCellOutputItem.error({name:n?.ename||"",message:n?.evalue||"",stack:(n?.traceback||[]).join(`
`)})],{...mM(n),originalError:n})}async function xJ(n,e,t){let r=!1,i;if(!n)return{changed:r,kernelId:i};n?.language_info?.name||(n.language_info=n.language_info||{name:""});let o;switch(e?.kind){case"connectToLiveRemoteKernel":o=e.kernelModel.language;break;case"startUsingRemoteKernelSpec":case"startUsingLocalKernelSpec":o=e.kernelSpec.language;break;case"startUsingPythonInterpreter":o=ge;break;default:break}if(n.language_info.name!==o&&o&&(n.language_info.name=o,r=!0),t&&"language_info"in t&&t.language_info)(0,PJ.default)(n.language_info,t.language_info)||(n.language_info=JSON.parse(JSON.stringify(t.language_info)),r=!0);else{let a=Xe(e),l=a?vJ(e):void 0,c=await yd(l),u=c?`${c.major}.${c.minor}.${c.micro}`:"";l&&c&&n&&n.language_info&&n.language_info.version!==u?(n.language_info.version=u,r=!0):!l&&n?.language_info&&a&&(n.language_info=void 0,r=!0)}let s=e&&Dg(e)?e.kernelModel:e&&"kernelSpec"in e?e.kernelSpec:void 0;if(e?.kind==="startUsingPythonInterpreter"){let a=e.kernelSpec,l=a.display_name||mr(e.interpreter)?.environment?.name||"",c="";switch(Kn(a)){case"registeredByOldVersionOfExt":case"registeredByNewVersionOfExt":c="python3";break;case"registeredByNewVersionOfExtForCustomKernelSpec":{c=(a.metadata?.vscode?.originalSpecFile?Ce(it(a.metadata.vscode.originalSpecFile)):void 0)||a.name,l=a.metadata?.vscode?.originalDisplayName||l;break}default:c=a.name;break}(n.kernelspec?.name!==c||n.kernelspec?.display_name!==l)&&(r=!0,n.kernelspec={name:c,language:ge,display_name:l},"vscode"in n&&delete n.vscode,"interpreter"in n&&delete n.interpreter)}else if(s&&!n.kernelspec){let a=s.metadata?.vscode?.originalSpecFile?Ce(it(s.metadata.vscode.originalSpecFile)):void 0;n.kernelspec={name:a||s.name||s.display_name||"",display_name:s.metadata?.vscode?.originalDisplayName||s.display_name||s.name||""},s.language&&(n.kernelspec.language=s.language),i=s.id,r=!0}else if(s&&n.kernelspec){let l=(s.metadata?.vscode?.originalSpecFile?Ce(it(s.metadata.vscode.originalSpecFile)):void 0)||s.name||s.display_name||"",c=s.metadata?.vscode?.originalDisplayName||s.display_name||s.name||"",u=s.language||s.language||"";(n.kernelspec.name!==l||n.kernelspec.language!==u||n.kernelspec.display_name!==c||i!==s.id)&&(r=!0,n.kernelspec.name=l,n.kernelspec.display_name=c,n.kernelspec.language=u,i=s.id);try{delete n.kernelspec.metadata}catch{}}return{changed:r,kernelId:i}}async function Jc(n,e,t,r){let i=sg(t);if(!i){let a=Ki.get(n);r&&a?.started&&a.end(r?void 0:!1,n.executionSummary?.timing?.endTime);return}Ki.get(n)||(r=!0);let o=Ki.getOrCreate(n,e),s=o.executionOrder;o.started||(o.start(n.executionSummary?.timing?.startTime),o.executionOrder=n.executionSummary?.executionOrder||s),await o.appendOutput(i),o.end(r?void 0:!1,n.executionSummary?.timing?.endTime)}var pse=/(?:\u001b\[|\u009b)[=?>!]?[\d;:]*["$#'* ]?[a-zA-Z@^`{}|~]/,mse=/(?:\u001b\]|\u009d).*?(?:\u001b\\|\u0007|\u009c)/,fse=/\u001b(?:[ #%\(\)\*\+\-\.\/]?[a-zA-Z0-9\|}~@])/,hse=new RegExp("(?:"+[pse.source,mse.source,fse.source].join("|")+")","g");function gse(n){return n&&(n=n.replace(hse,"")),n.trim()}function DJ(n,e){let t=/Cell\s+In\s*\[(?<executionCount>\d+)\],\s*line (?<lineNumber>\d+).*/,r=/Input\s+?In\s*\[(?<executionCount>\d+)\][^<]*<cell line:\s?(?<lineNumber>\d+)>.*/,i;for(let s of n){let a=gse(s),l=t.exec(a)??r.exec(a);if(l&&l.groups){i=parseInt(l.groups.lineNumber);break}}let o;if(i&&i>0&&i<=e.document.lineCount){let s=e.document.lineAt(i-1),a=s.text.split("#")[0].trimEnd().length;o=new On.Range(new On.Position(s.lineNumber,s.firstNonWhitespaceCharacterIndex),new On.Position(s.lineNumber,a))}return o}var tE=new WeakMap;function gx(n,e,t){let i=Om(t)?.transient?.display_id;if(t.metadata?.outputType!=="display_data"||!i)return;let o=tE.get(e)||new Map;tE.set(e,o);let s=o.get(n)||[];o.set(n,s),s.push(i),s.length>1e3&&s.shift()}function _J(n,e){let t=tE.get(n)||new Map;for(let r of t.values())if(r.includes(e))return!0;return!1}function TJ(n,e,t){return((tE.get(e)||new Map).get(n)||[]).includes(t)}function RJ(n,e){let t=tE.get(n)||new Map;for(let r of t.values()){let i=r.indexOf(e);i>=0&&r.splice(i,1)}}var yn=require("vscode");var Ng=new Map,AJ=new Set,bx=new yn.EventEmitter;pa(bx);function NJ(n){return bx.event(n)}async function MJ(n){if(!yn.workspace.isTrusted)return{accessAllowed:!1};if(n===_e)return{accessAllowed:!0};let e=Ng.get(n);return e||(e=vse(n),Ng.set(n,e),e.then(({result:t})=>{(t==="learnMore"||t==="cancelled")&&Ng.get(n)===e&&(Ng.delete(n),AJ.add(n))})),e.then(({result:t})=>({accessAllowed:t==="allowed"}))}async function vse(n){let e=await hM();if(e.get(n)===!0)return{result:"allowed"};if(e.get(n)===!1)return p.warn(`Kernel API access already revoked for extension ${n}`),{result:"denied"};let t=yn.extensions.getExtension(n)?.packageJSON?.displayName;if(!t)return p.error(`Kernel API access revoked, as extension ${n} does not exist!`),{result:"denied"};let r=yn.l10n.t("Allow"),i=yn.l10n.t("Deny"),o=await yn.window.showInformationMessage(yn.l10n.t("Do you want to grant Kernel access to the extension {0} ({1})?",t,n),{modal:!0,detail:yn.l10n.t("This allows the extension to execute code against Jupyter Kernels.")},r,ce.learnMore,i);switch(o===ce.learnMore?yn.env.openExternal(yn.Uri.parse("https://aka.ms/vscodeJupyterKernelApiAccess")).then(h,h):(o===r||o===i)&&await yse(n,o===r),o){case r:return{result:"allowed"};case ce.learnMore:return{result:"learnMore"};case i:return p.error(`Kernel API access revoked for extension ${n}`),{result:"denied"};default:return{result:"cancelled"}}}async function KJ(){let n=new Set,[e]=await Promise.all([hM().then(t=>new Map(t)),...Array.from(Ng.entries()).map(async([t,r])=>{(await r).result!=="allowed"&&n.add(t)})]);return n.forEach(t=>e.set(t,!1)),AJ.forEach(t=>e.set(t,e.get(t)===!0)),e}var vx="API.Access",Rd;async function hM(n=!1){let e=Se.instance.get(tt);if(e.extensionMode===yn.ExtensionMode.Test)return new Map;if(Ut(()=>{Se.instance.get(K).push(e.secrets.onDidChange(i=>{i.key===vx&&(Rd=void 0)}))})(),Rd&&!n)return Rd;let t="";try{return t=await e.secrets.get(vx),!t||t.length===0?new Map:(Rd=new Map(Object.entries(JSON.parse(t))),Rd)}catch(r){return p.error(`Failed to parse API access information ${t}`,r),new Map}}var yx=Promise.resolve();async function OJ(n){return yx=yx.then(async()=>{await Promise.all(Array.from(Ng.entries()).map(async([t,r])=>{let i=await r;i.result=n.includes(t)===!0?"allowed":"denied"})),Rd=new Map(n.map(t=>[t,!0]));let e=Se.instance.get(tt);if(e.extensionMode!==yn.ExtensionMode.Test)try{await e.secrets.store(vx,JSON.stringify(Object.fromEntries(Rd))),bx.fire()}catch(t){p.error(`Failed to update API access information ${JSON.stringify(Object.fromEntries(Rd))}`,t)}})}async function yse(n,e){return yx=yx.then(async()=>{let t=Se.instance.get(tt);if(t.extensionMode===yn.ExtensionMode.Test)return;let r=await hM(!0);if(e!==r.get(n)){r.set(n,e);try{await t.secrets.store(vx,JSON.stringify(Object.fromEntries(r))),bx.fire()}catch(i){p.error(`Failed to store API access information ${JSON.stringify(Object.fromEntries(r))}`,i)}}})}var FJ=" (Interactive)",He=Symbol("IControllerRegistration");var Ix=Symbol("IRemoteNotebookKernelSourceSelector"),Sx=Symbol("ILocalNotebookKernelSourceSelector"),Fm=Symbol("ILocalPythonNotebookKernelSourceSelector"),Ad=Symbol("IConnectionDisplayData");var bo=require("vscode");var gM=class extends WP{constructor(t,r){super();this.controller=t;this.notebook=r}dispose(){this.disposeExistingExecution()}createReferencedObject(t,...r){return this.existingExecutions||(this.existingExecutions=this.controller.createNotebookExecution(this.notebook),this.existingExecutions.start()),this.existingExecutions}destroyReferencedObject(t,r){this.disposeExistingExecution()}disposeExistingExecution(){try{this.existingExecutions?.end()}catch{}this.existingExecutions=void 0}},Cx=class n{constructor(e,t,r){this.extensionId=e;this.kernel=t;this.executionRefCountedDisposableFactory=r?new gM(r,t.notebook):void 0;let i=bo.extensions.getExtension(e)?.packageJSON?.displayName||e;this.notebook=bo.workspace.notebookDocuments.find(o=>o.uri.toString()===t.resourceUri?.toString()),this.controllerDisplayName=lt(t.kernelConnectionMetadata),this.title=bo.l10n.t("Executing code in {0} from {1}",this.controllerDisplayName,i),this.eventHandler=bo.window.onDidChangeVisibleNotebookEditors(this.showProgressImpl,this)}static{this.notificationsPerExtension=new WeakMap}dispose(){this.eventHandler.dispose(),this.disposable?.dispose(),this.executionRefCountedDisposableFactory?.dispose()}show(){let e;try{e=this.executionRefCountedDisposableFactory?.acquire("")}catch{}if(this.deferred&&!this.deferred.completed){let t=this.deferred;this.deferred=ne(),t.resolve()}else this.deferred=ne(),this.showProgress().catch(h);return this.disposable=new bo.Disposable(()=>{e?.dispose(),this.deferred?.resolve()})}async showProgress(){await Hn(1e3),!(!this.deferred||this.deferred.completed||this.displayInProgress)&&(this.shouldDisplayProgress=!0,await Promise.all([this.showProgressImpl(),this.waitUntilCompleted()]),this.shouldDisplayProgress=!1)}async showProgressImpl(){let e=n.notificationsPerExtension.get(this.kernel)||new Set;n.notificationsPerExtension.set(this.kernel,e),!e.has(this.extensionId)&&(e.add(this.extensionId),!(!this.notebook||!this.shouldDisplayProgress)&&bo.window.visibleNotebookEditors.some(t=>t.notebook===this.notebook)&&(this.displayInProgress=!0,await bo.window.withProgress({location:bo.ProgressLocation.Notification,title:this.title},async()=>this.waitUntilCompleted()),this.displayInProgress=!1))}async waitUntilCompleted(){let e=this.deferred;for(;e&&!e.completed;)await e.promise,e=this.deferred}};var yM=class extends Error{constructor(){super(Lm.l10n.t("Access to Jupyter Kernel has been revoked")),this.name="vscode.jupyter.apiAccessRevoked"}},bM=class n extends Qt{constructor(t,r,i,o){super();this.extensionId=t;this.kernel=r;this.execution=i;this._onDidChangeStatus=this._register(new Lm.EventEmitter);this._onDidReceiveDisplayUpdate=this._register(new Lm.EventEmitter);this.progress=this._register(new Cx(t,r,o)),this._register(ba(r.onDisposed)(()=>this.progress.dispose())),this.language=r.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel"?ge:r.kernelConnectionMetadata.kernelSpec.language||ge,this._register(this.kernel.onStatusChanged(()=>this._onDidChangeStatus.fire(this.kernel.status))),this._register(i.onDidReceiveDisplayUpdate(a=>{let l=this.kernel.session,c=Om(a);c?.outputType==="display_data"&&c?.transient?.display_id&&l&&TJ(this.extensionId,l,c?.transient?.display_id)&&this._onDidReceiveDisplayUpdate.fire(a)}));let s=this;this._api=Object.freeze({language:this.language,get status(){return s.kernel.status},onDidChangeStatus:s.onDidChangeStatus.bind(this),get onDidReceiveDisplayUpdate(){if(![_e,lC,EP].includes(t)&&!aC.includes(t.split(".")[0]))throw new Error(`Proposed API is not supported for extension ${t}`);return s.onDidReceiveDisplayUpdate.bind(this)},executeCode:(a,l)=>this.executeCode(a,l),shutdown(){if(![_e,lC,CW].includes(t)&&!aC.includes(t.split(".")[0]))throw new Error(`Proposed API is not supported for extension ${t}`);return s.shutdown()}})}get status(){return this.kernel.status}get onDidChangeStatus(){return this._onDidChangeStatus.event}get onDidReceiveDisplayUpdate(){return this._onDidReceiveDisplayUpdate.event}static createApiKernel(t,r,i,o){let s=new n(t,r,i,o);return Se.instance.get(K).push(s),{api:s._api,progress:s.progress}}async checkAccess(){if(this.extensionId===_e)return;if(this.accessAllowed||(this.accessAllowed=this.doCheckAccess(),this._register(NJ(()=>this.accessAllowed=void 0))),!await this.accessAllowed)throw new yM}async doCheckAccess(){let r=(await MJ(this.extensionId)).accessAllowed;return T("DATASCIENCE.JUPYTER_NEW_KERNELS_API_USAGE",void 0,{extensionId:this.extensionId,pemUsed:"getKernel",accessAllowed:r}),r}async*executeCode(t,r){await this.checkAccess();for await(let i of this.executeCodeInternal(t,void 0,r))yield i}async shutdown(){await this.checkAccess(),p.debug(`Shutting down kernel ${this.kernel.id} via API for extension ${this.extensionId}`);try{await this.kernel.shutdown()}catch(t){throw p.error(`Failed to shutdown kernel ${this.kernel.id} for extension ${this.extensionId}`,t),t}try{await this.kernel.dispose()}catch(t){throw p.error(`Failed to dispose kernel ${this.kernel.id} for extension ${this.extensionId}`,t),t}}async*executeCodeInternal(t,r={},i){let o=!1,s={executionCount:this.execution.executionCount,requestSentAfter:0,requestAcknowledgedAfter:0,cancelledAfter:0,duration:0},a={kernelId:"",extensionId:this.extensionId,cancelled:!1,requestSent:!1,requestAcknowledged:!1,cancelledBeforeRequestSent:!1,cancelledBeforeRequestAcknowledged:!1,mimeTypes:"",failed:!1},l=new Me,c=new Set;if(bse(this.extensionId,this.kernel,"executeCode",s.executionCount).catch(h),this.kernel.disposed)throw a.failed=!0,vM(this.kernel,s,a).catch(h),new Error("Kernel is disposed");if(!this.kernel.session?.kernel)throw a.failed=!0,vM(this.kernel,s,a).catch(h),this.kernel.status==="dead"||this.kernel.status==="terminating"?new Error("Kernel is dead or terminating"):new Error("Kernel connection not available to execute 3rd party code");let u=[];u.push({dispose:()=>{s.duration=l.elapsedTime,a.mimeTypes=Array.from(c).join(","),o=!0,vM(this.kernel,s,a).catch(h)}});let d=Se.instance.get(ye).getKernelExecution(this.kernel),f={started:new Lm.EventEmitter,executionAcknowledged:new Lm.EventEmitter};f.started.event(()=>{a.requestSent=!0,s.requestSentAfter=l.elapsedTime,!i.isCancellationRequested&&this.extensionId!==_e&&u.push(this.progress.show())},this,u),f.executionAcknowledged.event(()=>{a.requestAcknowledged=!0,s.requestAcknowledgedAfter=l.elapsedTime},this,u),i.onCancellationRequested(()=>{o||(a.cancelled=!0,s.cancelledAfter=l.elapsedTime,a.cancelledBeforeRequestSent=!a.requestSent,a.cancelledBeforeRequestAcknowledged=!a.requestAcknowledged,p.debug(`Code execution cancelled by extension ${this.extensionId}`))},this,u);try{for await(let g of d.executeCode(t,this.extensionId,f,i))if(gx(this.extensionId,this.kernel.session,g),g.items.forEach(b=>c.add(b.mime)),r&&LJ(g))for await(let b of this.handleChatOutput(g,d,f,c,r,i))yield b;else yield g}finally{G(u)}}async*handleChatOutput(t,r,i,o,s={},a){let l=t.items.find(w=>w.mime===cx);if(!l)return;let c=(t.metadata||{}).metadata,u=c.function,d=c.id,f=c.dataIsNone?void 0:new TextDecoder().decode(l.data),g=s[u];if(!g)throw new Error(`Chat Function ${u} not found`);let b=await g(f),I=X$(d,b);for await(let w of r.executeCode(I,this.extensionId,i,a))if(w.items.forEach(_=>o.add(_.mime)),LJ(w))for await(let _ of this.handleChatOutput(w,r,i,o,s,a))yield _;else yield w}};function LJ(n){return n.items.some(e=>e.mime===cx)}async function bse(n,e,t,r){let i=await ot(e.id);T("DATASCIENCE.JUPYTER_NEW_KERNEL_API_USAGE",{executionCount:r},{kernelId:i,pemUsed:t,extensionId:n})}async function vM(n,e,t){t.kernelId=await ot(n.id),T("DATASCIENCE.JUPYTER_NEW_KERNEL_API_EXEC",e,t)}function Ex(n,e){let t=Se.instance.get(ye),r=Se.instance.get(He).getSelected(e.notebook)?.controller;return bM.createApiKernel(n,e,t.getKernelExecution(e),r)}var Mg=k(N());var wx=Symbol("IReservedPythonNamedProvider"),Nd=Symbol("IInterpreterPackages"),Px=Symbol("IWorkspaceInterpreterTracker");var Sa=class{constructor(e){this.workspaceInterpreterTracker=e;Sa.isActiveWorkspaceInterpreter=this.isActiveWorkspaceInterpreterImpl.bind(this)}activate(){this.workspaceInterpreterTracker?.activate()}isActiveWorkspaceInterpreterImpl(e,t){return this.workspaceInterpreterTracker?.isActiveWorkspaceInterpreter(e,t)??!1}};Sa.isActiveWorkspaceInterpreter=()=>!1,Sa=v([(0,Mg.injectable)(),m(0,(0,Mg.inject)(Px)),m(0,(0,Mg.optional)())],Sa);async function ro(n,e){if(!n)return;let t=fn(n),[r,i]=Xk.get(t)||[{resourceType:to(n),resourceHash:n?await ot(n.toString()):void 0,kernelSessionId:await ot(Date.now().toString()),capturedEnvVars:void 0,userExecutedCell:void 0,disableUI:void 0,kernelLanguage:void 0,kernelId:void 0,kernelSpecHash:void 0,isUsingActiveInterpreter:void 0,pythonEnvironmentType:void 0,pythonEnvironmentPath:void 0,pythonEnvironmentVersion:void 0,kernelConnectionType:void 0},{previouslySelectedKernelConnectionId:""}];typeof e.capturedEnvVars=="boolean"&&(r.capturedEnvVars=e.capturedEnvVars),e.userExecutedCell&&(r.userExecutedCell=!0),typeof e.disableUI=="boolean"&&(r.disableUI=e.disableUI);let o=e.kernelConnection;if(o){let s=o.id;i.previouslySelectedKernelConnectionId!==s&&(r.userExecutedCell=e.userExecutedCell,r.disableUI=e.disableUI),i.previouslySelectedKernelConnectionId&&i.previouslySelectedKernelConnectionId!==s&&(r.kernelSessionId=await ot(Date.now().toString()));let a;switch(o.kind){case"connectToLiveRemoteKernel":a=o.kernelModel.language;break;case"startUsingRemoteKernelSpec":case"startUsingLocalKernelSpec":a=o.kernelSpec.language;break;case"startUsingPythonInterpreter":a=ge;break;default:break}let l="kernelSpec"in o&&o.kernelSpec.specFile?ot(o.kernelSpec.specFile):Promise.resolve("");r.kernelLanguage=a,[r.kernelId,r.kernelSpecHash]=await Promise.all([ot(o.id),l]),i.previouslySelectedKernelConnectionId=o.id;let c=o.interpreter;if(c){r.isUsingActiveInterpreter=Sa.isActiveWorkspaceInterpreter(n,c),r.pythonEnvironmentType=Ue(c);let[u,d]=await Promise.all([ot(Ae(kl(c.uri))),yd(c)]);r.pythonEnvironmentPath=u,tM.set(r.pythonEnvironmentPath,c),d?r.pythonEnvironmentVersion=`${d.major}.${d.minor}.${d.micro}`:r.pythonEnvironmentVersion=void 0,rM(r)}r.kernelConnectionType=r.kernelConnectionType||o?.kind}else i.previouslySelectedKernelConnectionId="";Xk.set(t,[r,i])}async function Ca(n,e){await ro(n,{kernelConnection:e,userExecutedCell:!0})}var IM=new Map;function WJ(n){return IM.has(n)||IM.set(n,{onDidStart:void 0,kernels:new WeakMap}),IM.get(n)}function UJ(n,e){let t=WJ(e),r=t.kernels.get(n)||Ex(e,n);return t.kernels.set(n,r),r}function VJ(n){return{async getKernel(e){let t,r=Se.instance.get(ye),i=kx.workspace.notebookDocuments.find(a=>a.uri.toString()===e.toString()),o=r.get(i||e);if(!o||!o.startedAtLeastOnce||!o.userStartedKernel){T("DATASCIENCE.JUPYTER_NEW_KERNELS_API_USAGE",void 0,{extensionId:n,pemUsed:"getKernel",accessAllowed:t});return}n!==_e&&Ca(o.resourceUri,o.kernelConnectionMetadata);let{api:s}=UJ(o,n);return s},get onDidStart(){if(![_e,EP].includes(n)&&!aC.includes(n.split(".")[0]))throw new Error(`Proposed API is not supported for extension ${n}`);let e=WJ(n);if(!e.onDidStart){let t=Se.instance.get(ye),r=Se.instance.get(K);e.onDidStart=new kx.EventEmitter,r.push(e.onDidStart,t.onDidPostInitializeKernel(({kernel:i,token:o,waitUntil:s})=>{let{api:a,progress:l}=UJ(i,n);e.onDidStart?.fire({uri:i.uri,kernel:a,token:o,waitUntil:c=>{let u=so(Promise.resolve(c));s(c);let d=l.show(),f=new Me;u.promise.finally(()=>{p.trace(`${n} took ${f.elapsedTime}ms during kernel startup`),Ct(i.resourceUri,"DATASCIENCE.JUPYTER_NEW_KERNEL_API_KERNEL_STARTUP_WAIT_UNTIL",{duration:f.elapsedTime},{extensionId:n}),d.dispose()})}})}),e.onDidStart)}return e.onDidStart.event}}}var Kg=Symbol("JupyterServerHelper"),xx=Symbol("INotebookImporter"),Og=Symbol("INotebookExporter"),Md=Symbol("IJupyterInterpreterDependencyManager"),Fg=Symbol("INbConvertInterpreterDependencyChecker"),Dx=Symbol("INbConvertExportToPythonService"),Lg=Symbol("IJupyterServerProvider"),Xt=Symbol("IJupyterServerUriStorage"),_x=Symbol("IJupyterKernelService"),Kd=Symbol("IJupyterRequestAgentCreator"),qc=Symbol("IJupyterRequestCreator"),Tx=Symbol("INotebookStarter"),Um=Symbol("ILiveRemoteKernelConnectionUsageTracker"),Rx=Symbol("IJupyterRemoteCachedKernelValidator"),Jt=Symbol("IJupyterServerProviderRegistry");function Ax(n,e,t,r,i){T("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:r,pemUsed:"createJupyterServerCollection"});let s=i.get(Jt).createJupyterServerCollection(r,n,Kh(e),t);return{dispose:()=>{s?.dispose()},get id(){return n},set label(l){s.label=Kh(l)},get label(){return s.label},set documentation(l){s.documentation=l},get documentation(){return s.documentation},set commandProvider(l){s.commandProvider=l},get commandProvider(){return s.commandProvider}}}var jJ=!1;function BJ(n,e){if(jJ)return;jJ=!0,e.get(tr).setApi(n)}var Ud=require("vscode");var Ug=k(N());var Kl=k(N());var Od=class extends $e{constructor(t,r){super("remotejupyterserveruriprovider",r.message||r.toString());this.serverProviderHandle=t;this.originalError=r}};var pi=class extends $e{constructor(e){super("jupyterselfcert",e)}static isSelfCertsError(e){let t=e?.message??"";return t.indexOf("reason: self signed certificate")>=0||t.indexOf("reason: unable to verify the first certificate")>=0||t.indexOf("reason: unable to get issuer certificate")>=0||t.indexOf("is not in the cert's list")>=0}};var Nl=class extends $e{constructor(e){super("jupyterselfexpiredcert",e)}static isSelfCertsExpiredError(e){return e.message.indexOf("reason: certificate has expired")>=0}};var Gr=Symbol("IDataScienceErrorHandler"),xn=class extends $e{constructor(t,r,i){super(t,r);this.kernelConnectionMetadata=i}},Ml=class extends mt{constructor(t,r,i){super(t,r);this.kernelConnectionMetadata=i}};var Fi=class extends $e{constructor(t,r,i){super("remotejupyterserverconnection",y.remoteJupyterConnectionFailedWithServerWithError($J(t),i.message||i.toString()));this.url=t;this.serverProviderHandle=r;this.originalError=i;this.baseUrl=$J(t)}};function $J(n){let e=new URL(n);return`${e.protocol}//${e.host}/`}var rE=require("vscode");var JJ=require("vscode");var Fd=class n extends Yn{constructor(t){super();this.serverSettings=t;this._isDisposing=!1;this.kernelSpecManager=new this.jupyterlab.KernelSpecManager({serverSettings:this.serverSettings}),this.kernelManager=new this.jupyterlab.KernelManager({serverSettings:this.serverSettings}),this.sessionManager=new this.jupyterlab.SessionManager({serverSettings:this.serverSettings,kernelManager:this.kernelManager}),this.contentsManager=new this.jupyterlab.ContentsManager({serverSettings:this.serverSettings})}get jupyterlab(){return this._jupyterlab||(this._jupyterlab=require("@jupyterlab/services")),this._jupyterlab}static create(t){return new n(t)}dispose(){this.isDisposed||this._isDisposing||(this._isDisposing=!0,(async()=>{p.trace("Disposing Jupyter Lab Helper");try{this.contentsManager&&(p.trace("SessionManager - dispose contents manager"),this.contentsManager.dispose()),this.sessionManager&&!this.sessionManager.isDisposed&&(p.trace("ShutdownSessionAndConnection - dispose session manager"),await Bt(1e4,this.sessionManager.ready),this.sessionManager.dispose()),this.kernelManager?.isDisposed||this.kernelManager?.dispose(),this.kernelSpecManager?.isDisposed||this.kernelSpecManager?.dispose()}catch(t){p.error("Exception on Jupyter Lab Helper shutdown: ",t)}finally{p.trace("Finished disposing Jupyter Lab Helper")}})().catch(h).finally(()=>super.dispose()))}async getRunningSessions(){if(!this.sessionManager)return[];await Bt(1e4,this.sessionManager.ready).catch(h),await this.sessionManager.refreshRunning();let t=[],r=this.sessionManager.running(),i=r.next().value;for(;i;)t.push(i),i=r.next().value;return t}async getRunningKernels(){let t=await this.jupyterlab.KernelAPI.listRunning(this.serverSettings),r=new Set;return t.map(i=>{let o=i;return{id:i.id,name:i.name,lastActivityTime:o.last_activity?new Date(Date.parse(o.last_activity.toString())):new Date,numberOfConnections:o.connections?parseInt(o.connections.toString(),10):0}}).filter(i=>r.has(i.id)?!1:(r.add(i.id),!0))}async getKernelSpecs(){if(!this.serverSettings||!this.sessionManager||!this.contentsManager)throw new hn;try{let t=new Me,r=this.kernelSpecManager;if(!r)return p.error(`No SessionManager to enumerate kernelspecs (no specs manager). Returning a default kernel. Specs ${JSON.stringify(this.kernelSpecManager?.specs?.kernelspecs||{})}.`),T("DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",void 0,{failed:!0,reason:"NoSpecsManager"}),[await Ns()];let i={wasSessionManagerReady:this.sessionManager.isReady,wasSpecsManagerReady:r.isReady,sessionManagerReady:this.sessionManager.isReady,specsManagerReady:r.isReady,waitedForChangeEvent:!1},o=(c={})=>r.specs&&Object.keys(r.specs.kernelspecs).length?r.specs.kernelspecs:c,s=o();await Bt(1e4,this.sessionManager.ready),i.sessionManagerReady=this.sessionManager.isReady,await Bt(1e4,r.refreshSpecs()),i.specsManagerReady=r.isReady;let a=!1;if(r&&Object.keys(r.specs?.kernelspecs||{}).length===0){let c=[],u=ne(),d=u.resolve.bind(u);r.specsChanged.connect(d),c.push(new JJ.Disposable(()=>r.specsChanged.disconnect(d)));let f=Promise.all([u.promise,r.ready,r.refreshSpecs(),this.sessionManager.ready]);await Bt(1e4,f),i.waitedForChangeEvent=!0,u.completed||(a=!0,T("DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",void 0,{failed:!0,sessionManagerReady:this.sessionManager.isReady,specsManagerReady:r.isReady,reason:r.isReady?this.sessionManager.isReady?"SpecsDidNotChangeInTime":"SessionManagerIsNotReady":"SpecManagerIsNotReady"})),G(c)}let l=o(s);if(Object.keys(l||{}).length){let c=[];return Object.entries(l).forEach(([u,d])=>{d&&c.push(new Dd(d))}),T("DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",{duration:t.elapsedTime},i),c}else return p.error(`Jupyter Lab Helper cannot enumerate kernelspecs. Returning a default kernel. Specs ${JSON.stringify(l)}.`),a||T("DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",void 0,{failed:!0,reason:"NoSpecsEventAfterRefresh"}),[await Ns()]}catch(t){return p.error("Jupyter Lab Helper:getKernelSpecs failure: ",t),[]}}};var un=class{constructor(e,t,r,i,o){this.jupyterPickerRegistration=e;this.configService=t;this.errorHandler=r;this.requestAgentCreator=i;this.requestCreator=o}async createConnectionInfo(e){let t=await this.getJupyterServerUri(e);if(!t)throw new Error(`Unable to get resolved server information for ${e.extensionId}:${e.id}:${e.handle}`);let r={baseUrl:t.connectionInformation.baseUrl.toString(!0),displayName:t.label,token:t.connectionInformation.token||"",authorizationHeader:t.connectionInformation.headers||{},fetch:t.connectionInformation.fetch,mappedRemoteNotebookDir:void 0,WebSocket:t.connectionInformation.WebSocket};return HC(e,r,this.requestCreator,this.requestAgentCreator,this.configService,rE.Uri.file(""))}async validateRemoteUri(e,t,r){let i;if(!t){let s=await this.getJupyterServerUri(e);if(s)t={baseUrl:s.connectionInformation.baseUrl.toString(!0),displayName:s.label,token:s.connectionInformation.token||"",authorizationHeader:s.connectionInformation.headers||{},fetch:s.connectionInformation.fetch,mappedRemoteNotebookDir:void 0,WebSocket:s.connectionInformation.WebSocket};else throw new Error(`Unable to get resolved server information for ${e.extensionId}:${e.id}:${e.handle}`)}let o=HC(e,t,this.requestCreator,this.requestAgentCreator,this.configService,rE.Uri.file(""));try{i=Fd.create(o.settings),await Promise.all([i.getRunningKernels(),i.getKernelSpecs()])}catch(s){if(pi.isSelfCertsError(s)){if(!await ix(this.configService,s.message))throw s}else if(Nl.isSelfCertsExpiredError(s)){if(!await ox(this.configService,s.message))throw s}else throw t&&!r&&await this.errorHandler.handleError(new Fi(t.baseUrl,e,s)),s}finally{o.dispose(),i&&i.dispose()}}async getJupyterServerUri(e){let t=new rE.CancellationTokenSource;try{let r=this.jupyterPickerRegistration.jupyterCollections.find(l=>l.extensionId===e.extensionId&&l.id===e.id)||await this.jupyterPickerRegistration.activateThirdPartyExtensionAndFindCollection(e.extensionId,e.id);if(!r)return;let i=await Promise.resolve(r.serverProvider.provideJupyterServers(t.token)),o=i?.find(l=>l.id===e.handle);if(!o&&i?.length===0)try{o=await r.serverProvider.resolveJupyterServer({id:e.handle,label:""},t.token)}catch{}if(!o)return;if(o.connectionInformation)return o;let s=await Promise.resolve(r.serverProvider.resolveJupyterServer(o,t.token));if(!s?.connectionInformation)return;let a=Object.assign({},o);return a.connectionInformation=s.connectionInformation,a}catch(r){throw r instanceof $e?r:new Od(e,r)}finally{t.dispose()}}};un=v([(0,Kl.injectable)(),m(0,(0,Kl.inject)(Jt)),m(1,(0,Kl.inject)(oe)),m(2,(0,Kl.inject)(Gr)),m(3,(0,Kl.inject)(Kd)),m(3,(0,Kl.optional)()),m(4,(0,Kl.inject)(qc))],un);var Ea=class{constructor(e,t,r){this.serverUriStorage=e;this.jupyterConnection=t;this.serverProviderRegistry=r}async addJupyterServer(e){if(e.extensionId.toLowerCase()!=il.toLowerCase())throw new Error("Deprecated API");try{await this.jupyterConnection.validateRemoteUri(e)}catch(t){p.error(`Error in validating the Remote Uri ${e.id}.${e.handle}`,t);return}this.serverProviderRegistry.jupyterCollections.some(t=>t.extensionId===e.extensionId)||await this.serverUriStorage.add(e)}};Ea=v([(0,Ug.injectable)(),m(0,(0,Ug.inject)(Xt)),m(1,(0,Ug.inject)(un)),m(2,(0,Ug.inject)(Jt))],Ea);var HJ=k(N()),Ol=require("vscode");var Ld=require("vscode");var qJ="Canceled";function Zt(n,e=!1){return typeof n!="object"||!n?!1:!!(n instanceof Ld.CancellationError||e&&n instanceof Error&&(n.message.includes("Canceled")||n.message.includes(ce.canceled))||n.name===qJ&&n.message===qJ)}async function Rt(n,e,...t){let r;return PP(e)?(t.push(e),r=void 0):r=e,n?n.isCancellationRequested?r:new Promise((i,o)=>{if(n.isCancellationRequested)return i(r);let s=n.onCancellationRequested(()=>{s.dispose(),i(r)});Promise.race(t).then(i,o).finally(()=>s.dispose())}):await Promise.race(t)}async function Nt(n,...e){if(!n)return Promise.race(e);if(n.isCancellationRequested)throw new Ld.CancellationError;return new Promise((t,r)=>{if(n.isCancellationRequested)return r(new Ld.CancellationError);let i=n.onCancellationRequested(()=>{i.dispose(),r(new Ld.CancellationError)});Promise.race(e).then(t,r).finally(()=>i.dispose())})}function Wg(...n){let e=new Ld.CancellationTokenSource,t=[];for(let i of n)i&&(i.isCancellationRequested&&e.cancel(),i.onCancellationRequested(()=>e.cancel(),void 0,t));let r=e.dispose.bind(e);return e.dispose=()=>{r(),G(t)},e}var bn;(e=>{function n(t){if(t?.isCancellationRequested)throw new Ld.CancellationError}e.throwIfCanceled=n})(bn||={});function GJ(n){let e=new Map,t=(a,l)=>{if(!e.has(a)){let c={id:a,label:l.displayName,connectionInformation:{baseUrl:Ol.Uri.parse(l.baseUrl),token:l.token,fetch:l.fetch,headers:l.authorizationHeader,WebSocket:l.WebSocket}};e.set(a,{serverUri:l,server:c})}return e.get(a).server},r=new Ol.EventEmitter,i={async provideJupyterServers(a){let l=n.getHandles?await Nt(a,n.getHandles()):[];return!l||l.length===0?[]:Nt(a,Promise.all(l.map(c=>n.getServerUri(c).then(u=>t(c,u)))))},resolveJupyterServer(a,l){return a},onDidChangeServers:r.event};if(!n.handleQuickPick||!n.getQuickPickEntryItems)return{serverProvider:i};let o=new Map;return{serverProvider:i,commandProvider:{async handleCommand(a,l){let c=o.get(a.label);if(!c||!n.handleQuickPick)return;let u=await Nt(l,n.handleQuickPick(c,!0));if(u==="back")return;if(!u)throw new Ol.CancellationError;let d=await n.getServerUri(u);return t(u,d)},async provideCommands(a,l){return n.getQuickPickEntryItems?(await Nt(l,Promise.resolve(n.getQuickPickEntryItems()))).map(u=>{let d={label:Kh(u.label),canBeAutoSelected:u.default,description:Kh(u.description)};return o.set(d.label,u),d}):[]}}}}var SM=class extends Yn{constructor(t,r,i,o){super();this.extensionId=t;this.id=r;this.label=i;this.serverProvider=o;this._onDidChangeProvider=new Ol.EventEmitter;this.onDidChangeProvider=this._onDidChangeProvider.event}set commandProvider(t){this._commandProvider=t,this._onDidChangeProvider.fire()}get commandProvider(){return this._commandProvider}},Vg=class extends Qt{constructor(){super();this._onDidChangeCollections=new Ol.EventEmitter;this._collections=new Map;Se.instance.get(K).push(this)}get onDidChangeCollections(){return this._onDidChangeCollections.event}get jupyterCollections(){return Array.from(this._collections.values())}async activateThirdPartyExtensionAndFindCollection(t,r){return await this.loadExtension(t,r).catch(h),this.jupyterCollections.find(i=>i.extensionId===t&&i.id===r)}async loadExtension(t,r){if(t===_e)return;let i=Ol.extensions.getExtension(t);if(!i)throw new Error(`Extension '${t}' that provides Jupyter Server '${r}' not found`);i.isActive||await i.activate().then(h,h)}createJupyterServerCollection(t,r,i,o){let s=`${t}#${r}`;if(this._collections.has(s)&&t!==_e)throw new Error(`Jupyter Server Provider with id ${s} already exists`);let a=new SM(t,r,i,o);return this._collections.set(s,a),this._onDidChangeCollections.fire({added:[a],removed:[]}),this._register(a.onDidDispose(()=>{this._collections.delete(s),this._onDidChangeCollections.fire({removed:[a],added:[]})},this)),a}};Vg=v([(0,HJ.injectable)()],Vg);var Nx=Symbol("IExportedKernelServiceFactory");function Ise(n,e){return new Promise(t=>{e.onDidChange(r=>{for(let i of r.added)Dt(i.connection)&&i.connection.serverProviderHandle.id===n.id&&i.connection.serverProviderHandle.handle===n.handle&&t()})})}function zJ(n,e){let t=e.get(va),r=n.id.startsWith("_builtin")?_e:t.determineExtensionFromCallStack().extensionId;if(p.error(`The API registerRemoteServerProvider has being deprecated and will be removed soon, please use createJupyterServerCollection (extension ${r}).`),r.toLowerCase()!=il.toLowerCase())throw new Error("Deprecated API");T("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:r,pemUsed:"registerRemoteServerProvider"});let{serverProvider:i,commandProvider:o}=GJ(n),s=Ax(n.id,n.displayName||n.detail||n.id,i,r,e);return o&&(s.commandProvider=o),{dispose:()=>{s.dispose()}}}function QJ(n){return n.then(()=>void 0).catch(e=>(p.error("Failure during activation.",e),Promise.reject(e)))}function YJ(n){let e=n.get(va);return T("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:e.determineExtensionFromCallStack().extensionId,pemUsed:"registerRemoteServerProvider"}),n.get(Nx).getService()}async function XJ(n,e,t){let r=t.get(va);p.error("The API addRemoteJupyterServer has being deprecated and will be removed soon, please use createJupyterServerCollection.");let i=r.determineExtensionFromCallStack().extensionId;if(i.toLowerCase()!=il.toLowerCase())throw new Error("Deprecated API");T("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:i,pemUsed:"addRemoteJupyterServer"});let o=t.get(Ea),s=t.get(He),a=Ise({id:n,handle:e},s);await o.addJupyterServer({id:n,handle:e,extensionId:i}),await a}async function ZJ(n,e,t){let r=t.get(va);T("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:r.determineExtensionFromCallStack().extensionId,pemUsed:"openNotebook"});let i=t.get(He),o=typeof e=="string"?e:void 0,s=typeof e=="string"?void 0:e,a=o&&i.all.find(c=>c.id===e)?.id;if(!a&&s&&!ol()&&(a=i.all.find(c=>c.kind==="startUsingPythonInterpreter"&&c.interpreter.id===s.id)?.id,!a)){let u=await t.get(Fm).getKernelConnection(s);a=u&&i.all.find(d=>d.id===u?.id)?.id}if(!a)throw new Error(`Kernel ${e} not found.`);let l=Ud.window.activeNotebookEditor?.notebook?.uri?.toString()===n.toString()?Ud.window.activeNotebookEditor:await Ud.window.showNotebookDocument(await Ud.workspace.openNotebookDocument(n));return await Ud.commands.executeCommand("notebook.selectKernel",{notebookEditor:l,id:a,extension:_e}),l.notebook}var Fn=Symbol("INotebookEditorProvider"),jg=Symbol("INotebookPythonEnvironmentService");function e3(n,e,t,r){let i=t.get(va),o=t.get(jg),s={ready:QJ(n),registerPythonApi:a=>BJ(a,t),registerRemoteServerProvider:a=>zJ(a,t),getKernelService:()=>YJ(t),addRemoteJupyterServer:(a,l)=>XJ(a,l,t),openNotebook:async(a,l)=>ZJ(a,l,t),createJupyterServerCollection:(a,l,c)=>Ax(a,l,c,i.determineExtensionFromCallStack().extensionId,t),get kernels(){return VJ(i.determineExtensionFromCallStack().extensionId)},onDidChangePythonEnvironment:o.onDidChangeEnvironment,getPythonEnvironment(a){return o.getPythonEnvironment(a)}};return(Rr()||r.extensionMode===CM.ExtensionMode.Development||r.extensionMode===CM.ExtensionMode.Test)&&(s.serviceContainer=t,s.serviceManager=e),s}var t3=require("vscode"),r3={codeLoadingTime:0,endActivateTime:0,startActivateTime:0,totalActivateTime:0,workspaceFolderCount:0};function n3(n,e){if(!Rr())try{n.endActivateTime=e.elapsedTime,n.totalActivateTime=e.elapsedTime,Object.assign(r3,n),o3(n),T("EXTENSION.LOAD",n)}catch(t){p.error("sendStartupTelemetry() failed.",t)}}function i3(n,e,t){try{let r={};e.endActivateTime=t.elapsedTime,e.totalActivateTime=t.elapsedTime,Object.assign(r3,e),o3(e),T("EXTENSION.LOAD",e,r,n)}catch(r){p.error("sendErrorTelemetry() failed.",r)}}function o3(n){let e=t3.workspace.workspaceFolders?.length??0;n.workspaceFolderCount=e}var Mx=Symbol("IExtensionActivationManager"),me=Symbol("IExtensionSyncActivationService");var Hc=k(N());var Fl=Symbol("IEnvironmentVariablesService"),Ll=Symbol("ICustomEnvironmentVariablesProvider");var rt=Symbol("IInterpreterService");var Fx=k(N()),wa=require("vscode");var Sse={JupyterSessionWaitForIdleSession:y.waitingForJupyterSessionToBeIdle,KernelsGetKernelForRemoteConnection:y.gettingListOfKernelsForRemoteConnection,KernelsGetKernelSpecs:y.gettingListOfKernelSpecs,KernelsRegisterKernel:y.registeringKernel,NotebookConnect:y.connectingToJupyter,NotebookStart:y.startingJupyterNotebook,InstallingMissingDependencies:y.installingMissingDependencies,ExportNotebookToPython:y.exportNotebookToPython,PerformingExport:y.performingExport};function Ox(n){return Sse[n]}var ut=class{constructor(e){this.kernelResourceProgressReporter=new Map;e.push(this),ut.instance=this}activate(){}dispose(){G(Array.from(ut.disposables))}static createProgressReporter(e,t,r){if(!ut.instance)return new wa.Disposable(h);let i=e?fn(e):"";return ut.instance.kernelResourceProgressReporter.has(i)?ut.reportProgress(e,t):ut.createProgressReporterInternal(i,t,r)}static wrapAndReportProgress(e,t,r){let i=e?fn(e):"";if(!ut.instance)return r();let o=new or,s=setTimeout(()=>{o.isDisposed||o.add(ut.reportProgressInternal(i,t))},2e3);return o.add(new wa.Disposable(()=>clearTimeout(s))),r().finally(()=>o.dispose())}static reportProgress(e,t){let r=Ox(t)||t,i=e?fn(e):"";return r?ut.reportProgressInternal(i,r||""):new wa.Disposable(()=>h)}static reportProgressInternal(e,t){if(!ut.instance)return new wa.Disposable(h);let r=ut.instance.kernelResourceProgressReporter.get(e);if(r||(r={title:t,pendingProgress:[],progressList:[],dispose:h},ut.instance.kernelResourceProgressReporter.set(e,r)),r.reporter)r.progressList.push(t),r.reporter.report({message:t});else{if(r.progressList.includes(t))return new wa.Disposable(h);r.pendingProgress.push(t)}return{dispose:()=>{try{if(!r)return;let i=r.progressList.findIndex(o=>o===t);if(i>=0&&r.progressList.splice(i),r.progressList.length>0){let o=r.progressList[r.progressList.length-1];r.reporter&&r.reporter.report({message:o===r.title&&r.reporter?"":o})}else ut.instance.kernelResourceProgressReporter.delete(e),r.dispose()}catch(i){p.error(`Failed to dispose Progress reporter for ${e}`,i)}}}}static createProgressReporterInternal(e,t,r){let i=ne(),o=new wa.Disposable(()=>i.resolve()),s=ut.instance.kernelResourceProgressReporter.get(e)||{title:t,pendingProgress:[],progressList:[],tokenSources:[],dispose:()=>{o.dispose()}},a=!1,l=()=>{a||(a=!0,wa.window.withProgress({location:wa.ProgressLocation.Notification,title:t},async(c,u)=>{let d=ut.instance.kernelResourceProgressReporter.get(e);if(d){for(d.reporter=c;d.pendingProgress.length>0;){let f=d.pendingProgress.shift();f===t?d.progressList.push(f):f!==t&&f&&(d.progressList.push(f),c.report({message:f}))}await Rt(u,i.promise),ut.instance.kernelResourceProgressReporter.get(e)===d&&ut.instance.kernelResourceProgressReporter.delete(e),ut.disposables.delete(o)}}).then(h,h))};return ut.instance.kernelResourceProgressReporter.set(e,{...s,dispose:()=>o.dispose(),show:l}),ut.disposables.add(o),s.pendingProgress.push(t),r||l(),{dispose:()=>o.dispose(),show:l}}};ut.disposables=new Set,ut=v([(0,Fx.injectable)(),m(0,(0,Fx.inject)(K))],ut);var Bg=k(N()),Lx=require("vscode");var xr=Symbol("IPlatformService"),nt=Symbol("IFileSystem");var ixe=Symbol("IBufferDecoder"),Li=Symbol("IProcessServiceFactory"),nE=class extends $e{constructor(e){super("unknown",e)}};var EM=class{constructor(e,t){this.uri=e;this.value=t}};function Cse(n){return Array.isArray(n)}var a3,Io=class n{constructor(e,t){this[a3]="ResourceMap";if(e instanceof n)this.map=new Map(e.map),this.toKey=t??n.defaultToKey;else if(Cse(e)){this.map=new Map,this.toKey=t??n.defaultToKey;for(let[r,i]of e)this.set(r,i)}else this.map=new Map,this.toKey=e??n.defaultToKey}static{this.defaultToKey=e=>e.toString()}set(e,t){return this.map.set(this.toKey(e),new EM(e,t)),this}get(e){return this.map.get(this.toKey(e))?.value}has(e){return this.map.has(this.toKey(e))}get size(){return this.map.size}clear(){this.map.clear()}delete(e){return this.map.delete(this.toKey(e))}forEach(e,t){typeof t<"u"&&(e=e.bind(t));for(let[,r]of this.map)e(r.value,r.uri,this)}*values(){for(let e of this.map.values())yield e.value}*keys(){for(let e of this.map.values())yield e.uri}*entries(){for(let e of this.map.values())yield[e.uri,e.value]}*[(a3=Symbol.toStringTag,Symbol.iterator)](){for(let[,e]of this.map)yield[e.uri,e.value]}},l3,Ul=class{constructor(e,t){this[l3]="ResourceSet";!e||typeof e=="function"?this._map=new Io(e):(this._map=new Io(t),e.forEach(this.add,this))}get size(){return this._map.size}add(e){return this._map.set(e,e),this}clear(){this._map.clear()}delete(e){return this._map.delete(e)}forEach(e,t){this._map.forEach((r,i)=>e.call(t,i,i,this))}has(e){return this._map.has(e)}entries(){return this._map.entries()}keys(){return this._map.keys()}values(){return this._map.keys()}[(l3=Symbol.toStringTag,Symbol.iterator)](){return this.keys()}};var c3,s3=class{constructor(){this[c3]="LinkedMap";this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){return this._head?.value}get last(){return this._tail?.value}has(e){return this._map.has(e)}get(e,t=0){let r=this._map.get(e);if(r)return t!==0&&this.touch(r,t),r.value}set(e,t,r=0){let i=this._map.get(e);if(i)i.value=t,r!==0&&this.touch(i,r);else{switch(i={key:e,value:t,next:void 0,previous:void 0},r){case 0:this.addItemLast(i);break;case 1:this.addItemFirst(i);break;case 2:this.addItemLast(i);break;default:this.addItemLast(i);break}this._map.set(e,i),this._size++}return this}delete(e){return!!this.remove(e)}remove(e){let t=this._map.get(e);if(t)return this._map.delete(e),this.removeItem(t),this._size--,t.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");let e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,t){let r=this._state,i=this._head;for(;i;){if(t?e.bind(t)(i.value,i.key,this):e(i.value,i.key,this),this._state!==r)throw new Error("LinkedMap got modified during iteration.");i=i.next}}keys(){let e=this,t=this._state,r=this._head,i={[Symbol.iterator](){return i},next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(r){let o={value:r.key,done:!1};return r=r.next,o}else return{value:void 0,done:!0}}};return i}values(){let e=this,t=this._state,r=this._head,i={[Symbol.iterator](){return i},next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(r){let o={value:r.value,done:!1};return r=r.next,o}else return{value:void 0,done:!0}}};return i}entries(){let e=this,t=this._state,r=this._head,i={[Symbol.iterator](){return i},next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(r){let o={value:[r.key,r.value],done:!1};return r=r.next,o}else return{value:void 0,done:!0}}};return i}[(c3=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(e){if(e>=this.size)return;if(e===0){this.clear();return}let t=this._head,r=this.size;for(;t&&r>e;)this._map.delete(t.key),t=t.next,r--;this._head=t,this._size=r,t&&(t.previous=void 0),this._state++}addItemFirst(e){if(!this._head&&!this._tail)this._tail=e;else if(this._head)e.next=this._head,this._head.previous=e;else throw new Error("Invalid list");this._head=e,this._state++}addItemLast(e){if(!this._head&&!this._tail)this._head=e;else if(this._tail)e.previous=this._tail,this._tail.next=e;else throw new Error("Invalid list");this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{let t=e.next,r=e.previous;if(!t||!r)throw new Error("Invalid list");t.previous=r,r.next=t}e.next=void 0,e.previous=void 0,this._state++}touch(e,t){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(t!==1&&t!==2)){if(t===1){if(e===this._head)return;let r=e.next,i=e.previous;e===this._tail?(i.next=void 0,this._tail=i):(r.previous=i,i.next=r),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(t===2){if(e===this._tail)return;let r=e.next,i=e.previous;e===this._head?(r.previous=void 0,this._head=r):(r.previous=i,i.next=r),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}}toJSON(){let e=[];return this.forEach((t,r)=>{e.push([r,t])}),e}fromJSON(e){this.clear();for(let[t,r]of e)this.set(t,r)}};var Wl=class{constructor(e,t,r){this.processFactory=e;this.platform=t;this.fs=r;this.userSitePaths=new Io}async getExecutablesPath(e){let t=e.executable.uri;if(!(Ue(e)!=="Unknown"||!t)){if(!this.userSitePaths.has(t)){let r=this.getUserSitePathImpl(t);r.catch(()=>{this.userSitePaths.get(t)===r&&this.userSitePaths.delete(t)}),this.userSitePaths.set(t,r)}return this.userSitePaths.get(t)}}async getUserSitePathImpl(e){let t=await this.processFactory.create(void 0),r="USER_BASE_VALUE",i=this.platform.isWindows?"USER_SITE":"USER_BASE",{stdout:o}=await t.exec(e.fsPath,["-c",`import site;print("${r}");print(site.${i});print("${r}");`]);if(o.includes(r)){let s=o.substring(o.indexOf(r)+r.length,o.lastIndexOf(r)).trim(),a=Lx.Uri.file(s),l;if(this.platform.isWindows?l=Lx.Uri.joinPath(Nn(a),"Scripts"):l=Lx.Uri.joinPath(a,"bin"),!l||!this.fs.exists(l))throw new Error(`USER_SITE ${l.fsPath} dir does not exist for the interpreter ${M(e)}`);return p.trace(`USER_SITE for ${M(e)} is ${l.fsPath}`),l}else throw new Error(`USER_SITE not found for the interpreter ${M(e)}. Stdout: ${o}`)}};v([Yr()],Wl.prototype,"getExecutablesPath",1),Wl=v([(0,Bg.injectable)(),m(0,(0,Bg.inject)(Li)),m(1,(0,Bg.inject)(xr)),m(2,(0,Bg.inject)(nt))],Wl);var wM=require("vscode");var u3=6e4,Wd=class{constructor(e,t,r,i,o,s){this.interpreterService=e;this.customEnvVarsService=t;this.apiProvider=r;this.extensionChecker=i;this.envVarsService=o;this.globalExecPaths=s;this.disposables=[];this.activatedEnvVariablesCache=new Map;this.cachedEnvVariables=new Map;this.customEnvVarsService.onDidEnvironmentVariablesChange(this.clearCache,this,this.disposables),this.interpreterService.onDidChangeInterpreter(this.clearCache,this,this.disposables),this.interpreterService.onDidEnvironmentVariablesChange(this.clearCache,this,this.disposables)}clearCache(){this.activatedEnvVariablesCache.clear(),this.cachedEnvVariables.clear()}dispose(){this.disposables.forEach(e=>e.dispose())}async getActivatedEnvironmentVariables(e,t,r){let i=y.activatingPythonEnvironment(Hr(t));return ut.wrapAndReportProgress(e,i,async()=>this.getActivatedEnvironmentVariablesImplWithCaching(e,t.id,r))}async getActivatedEnvironmentVariablesImplWithCaching(e,t,r){let i=await this.interpreterService.resolveEnvironment(t);if(!i){p.warn(`Failed to resolve environment for ${t}`);return}let o=`${e?.toString()||""}${t}`,s=this.activatedEnvVariablesCache.get(o);if(s&&s.time.elapsedTime>=u3&&this.activatedEnvVariablesCache.delete(o),!this.activatedEnvVariablesCache.has(o)){let l=this.getActivatedEnvironmentVariablesImpl(e,i,r);l.catch(h),this.activatedEnvVariablesCache.set(o,{promise:l,time:new Me})}let a=this.activatedEnvVariablesCache.get(o).promise;return r?a:Rt(r,a)}async getActivatedEnvironmentVariablesImpl(e,t,r){if(!this.extensionChecker.isPythonExtensionInstalled)return;let i=new Me;return this.getActivatedEnvironmentVariablesFromPython(e,t,r).then(o=>{if(!r?.isCancellationRequested)return o}).catch(o=>{p.error(`Failed to get env vars with python ${M(t.id)} in ${i.elapsedTime}ms`,o)})}async getActivatedEnvironmentVariablesFromPython(e,t,r){let i=`${e?.toString()||""}${t.id||""}`,o=this.cachedEnvVariables.get(i);if(o&&o.lastRequestedTime.elapsedTime>u3&&this.cachedEnvVariables.delete(i),!this.cachedEnvVariables.has(i)){let s=this.getActivatedEnvironmentVariablesFromPythonImpl(e,t,r);this.cachedEnvVariables.set(i,{promise:s,lastRequestedTime:new Me})}return Rt(r,this.cachedEnvVariables.get(i).promise)}async getActivatedEnvironmentVariablesFromPythonImpl(e,t,r){e=e||(wM.workspace.workspaceFolders?.length?wM.workspace.workspaceFolders[0].uri:void 0);let i=new Me,o=this.customEnvVarsService.getEnvironmentVariables(e,"RunPythonCode").catch(()=>{}),s="emptyVariables",a,l=await this.apiProvider.getApi().then(u=>u.getActivatedEnvironmentVariables(e,t,!1).catch(d=>{p.error(`Failed to get activated env variables from Python Extension for ${M(t.path)}`,d),s="failedToGetActivatedEnvVariablesFromPython"}));if(r?.isCancellationRequested)return;let c=Ue(t);if(T("DS_INTERNAL.GET_ACTIVATED_ENV_VARIABLES",{duration:i.elapsedTime},{envType:c,source:"python",failed:Object.keys(l||{}).length===0,reason:s},a),l?p.debug(`Got env vars from Python Ext in ${i.elapsedTime}ms for ${M(t.path)}, with env var count ${Object.keys(l||{}).length}.`):c==="Conda"?p.error(`Failed to get activated conda env vars for ${M(t.path)}
                 in ${i.elapsedTime}ms`):p.warn(`Failed to get activated env vars for ${M(t.path)} in ${i.elapsedTime}ms`),!l){let u=await o;if(l={},Ue(t)==="Conda"){let I=await Ps(t);I?l.CONDA_PREFIX=I:p.warn(`Failed to get the SysPrefix for the Conda Environment ${M(t.path)}}`)}this.envVarsService.mergeVariables(process.env,l),this.envVarsService.mergeVariables(u,l),this.envVarsService.mergePaths(process.env,l),process.env.PYTHONPATH&&(l.PYTHONPATH=process.env.PYTHONPATH);let d=u?Object.keys(u).find(I=>I.toLowerCase()=="path"):void 0;d&&u[d]&&this.envVarsService.appendPath(l,u[d]),u.PYTHONPATH&&this.envVarsService.appendPythonPath(l,u.PYTHONPATH);let f=await this.globalExecPaths.getExecutablesPath(t).catch(h);if(r?.isCancellationRequested)return;let g=l.PATH||l.Path,b=g?g.split(Qn):[];f&&b[1]!==f.fsPath?(p.trace(`Prepend PATH with user site path for ${M(t.path)}, user site ${f.fsPath}`),this.envVarsService.prependPath(l,f.fsPath)):qr(t)||p.error(`Unable to determine site packages path for python ${M(t.path)} (${Ue(t)})`),!l.PATH&&l.Path&&(l.PATH=l.Path)}return t.executable.uri&&(p.trace(`Prepend PATH with python bin for ${M(t.path)}`),this.envVarsService.prependPath(l,it(t.executable.uri.fsPath))),l}};v([ui("Getting activated env variables",1),m(1,Wc("id"))],Wd.prototype,"getActivatedEnvironmentVariablesImpl",1),v([m(1,Wc("id")),m(2,eg())],Wd.prototype,"getActivatedEnvironmentVariablesFromPython",1),Wd=v([(0,Hc.injectable)(),m(0,(0,Hc.inject)(rt)),m(1,(0,Hc.inject)(Ll)),m(2,(0,Hc.inject)(tr)),m(3,(0,Hc.inject)(qe)),m(4,(0,Hc.inject)(Fl)),m(5,(0,Hc.inject)(Wl))],Wd);var Ms=Symbol("IEnvironmentActivationService");var Jg=k(N()),qg=require("vscode");var $g=class{constructor(e,t,r){this.disposables=e;this.extensionChecker=t;this.pythonApi=r;this._changed=new qg.EventEmitter;this._registered=!1;qg.window.onDidChangeActiveNotebookEditor(()=>{this._changed.fire()},this,e)}activate(){this.extensionChecker.isPythonExtensionActive?this.registerStatusFilter():this.pythonApi.onDidActivatePythonExtension(this.registerStatusFilter,this,this.disposables)}get changed(){return this._changed.event}get hidden(){return!!(qg.window.activeNotebookEditor&&St(qg.window.activeNotebookEditor.notebook))}registerStatusFilter(){this._registered||(this._registered=!0,this.pythonApi.getApi().then(e=>{e.registerInterpreterStatusFilter&&(e.registerInterpreterStatusFilter(this),this._changed.fire())}).catch(h))}};$g=v([(0,Jg.injectable)(),m(0,(0,Jg.inject)(K)),m(1,(0,Jg.inject)(qe)),m(2,(0,Jg.inject)(tr))],$g);function d3(n){n.addSingleton(tr,Cg),n.addSingleton(qe,kd),n.addSingleton(rt,Eg),n.addSingleton(me,$g),n.addSingleton(Ms,Wd)}var p3=k(N());var iE=require("vscode");var Hg=class{activate(){iE.commands.registerCommand("jupyter.reloadVSCode",this.onReloadVSCode,this)}async onReloadVSCode(e){await iE.window.showInformationMessage(e,ce.reload)===ce.reload&&iE.commands.executeCommand("workbench.action.reloadWindow").then(h,h)}};Hg=v([(0,p3.injectable)()],Hg);var m3=k(N()),no=require("vscode");var Gc=class{get activeDebugConsole(){return no.debug.activeDebugConsole}get activeDebugSession(){return p.ci(`Getting active debug session, ${no.debug.activeDebugSession?.name}`),no.debug.activeDebugSession}get breakpoints(){return no.debug.breakpoints}get onDidChangeActiveDebugSession(){return no.debug.onDidChangeActiveDebugSession}get onDidStartDebugSession(){return no.debug.onDidStartDebugSession}get onDidReceiveDebugSessionCustomEvent(){return no.debug.onDidReceiveDebugSessionCustomEvent}get onDidTerminateDebugSession(){return no.debug.onDidTerminateDebugSession}get onDidChangeBreakpoints(){return no.debug.onDidChangeBreakpoints}registerDebugConfigurationProvider(e,t){return no.debug.registerDebugConfigurationProvider(e,t)}registerDebugAdapterTrackerFactory(e,t){return no.debug.registerDebugAdapterTrackerFactory(e,t)}startDebugging(e,t,r){return no.debug.startDebugging(e,t,r)}addBreakpoints(e){no.debug.addBreakpoints(e)}removeBreakpoints(e){no.debug.removeBreakpoints(e)}};Gc.instance=new Gc,Gc=v([(0,m3.injectable)()],Gc);var Ux=k(N()),PM=require("vscode");var Gg=class{constructor(e){this.extensionContext=e;this.testingState=new Map}async store(e,t,r){if(qn&&this.extensionContext.extensionMode!==PM.ExtensionMode.Production){this.testingState.set(`${e}#${t}`,r||"");return}if(r)await this.extensionContext.secrets.store(`${e}.${t}`,r);else try{await this.extensionContext.secrets.delete(`${e}.${t}`)}catch(i){p.error(i)}}async retrieve(e,t){if(qn&&this.extensionContext.extensionMode!==PM.ExtensionMode.Production)return this.testingState.get(`${e}#${t}`);try{return await this.extensionContext.secrets.get(`${e}.${t}`)}catch{try{await this.extensionContext.secrets.delete(`${e}.${t}`);return}catch(i){p.error(i)}}}};Gg=v([(0,Ux.injectable)(),m(0,(0,Ux.inject)(tt))],Gg);var Wx=k(N()),oE=require("vscode");var zg=class{constructor(e){this._extensions=[];e.push(oE.extensions.onDidChange(()=>this._extensions=oE.extensions.all)),this._extensions=oE.extensions.all}get extensions(){return this._extensions}determineExtensionFromCallStack(e){e=e||new Error().stack;try{let t=oE.extensions.getExtension(_e).extensionUri.toString().toLowerCase(),r=[];if(e){r=e.split(`
`).map(l=>{let c=/\((.*)\)/.exec(l),u=c?c[1]:void 0;try{let d=/\((.*)\:\d*\:\d*\)/.exec(l);if(!d)return u;if(!u||u.startsWith(d[1]))return d[1]}catch{}return u}).filter(l=>l&&!l.toLowerCase().startsWith(t));let i=t.split(/[\\/]/),o=i.findIndex(l=>l.startsWith(_e)),s=o===-1?void 0:i[o-1];AN(new Error("Ex")).forEach(l=>{let c=l.getFileName();c&&!c.toLowerCase().startsWith(t)&&r.push(c)});for(let l of r){let c=this.extensions.find(u=>u.id!==_e&&(l.toLowerCase().startsWith(u.extensionUri.fsPath.toLowerCase())||l.toLowerCase().startsWith(u.extensionUri.path.toLowerCase())));if(c)return{extensionId:c.id,displayName:c.packageJSON.displayName}}let a=r.find(l=>l.includes(_e));if(a&&(a=a.substring(0,a.indexOf(_e)-1)),!s||!a)return{extensionId:Rh,displayName:y.unknownPackage};for(let l of r.filter(c=>c.startsWith(a)&&!c.includes(_e))){let c=l.substring(a.length).substring(1).split(/[\\/]/)[0];c.includes("-")&&(c=c.substring(0,c.lastIndexOf("-")));let u=this.extensions.find(d=>d.id===c);if(u)return{extensionId:u.id,displayName:u.packageJSON.displayName}}}return p.error("Unable to determine the caller of the extension API for trace stack",e),p.error("Jupyter Root",t),p.error("Frames",r),{extensionId:Rh,displayName:y.unknownPackage}}catch(t){return p.error("Unable to determine the caller of the extension API for trace stack.",e),p.error("Failure error",t),{extensionId:Rh,displayName:y.unknownPackage}}}};zg=v([(0,Wx.injectable)(),m(0,(0,Wx.inject)(K))],zg);var Vx=Symbol("IWorkspaceService"),Ui=Symbol("IDebugManager"),Vl=Symbol("IApplicationEnvironment"),DDe=Symbol("IWebviewPanelMessageListener"),_De=Symbol("IWebviewViewMessageListener"),TDe=Symbol("IWebview"),RDe=Symbol("IWebviewView"),ADe=Symbol("IWebviewPanel"),Vd=Symbol("IWebviewPanelProvider"),jx=Symbol("IWebviewViewProvider"),sE=Symbol("IEncryptedStorage");var f3=k(N());var Qg=class{constructor(){this._list=[]}async dispose(){let e=this._list.map(t=>t.dispose());await Promise.all(e),this._list=[]}push(e){e&&this._list.push(e)}get list(){return this._list}};Qg=v([(0,f3.injectable)()],Qg);var Jd=k(N()),N3=require("vscode"),aE=k(R3());var eD=class{setSharedProperty(e,t){ag(e,t)}postEvent(e,t){let r={};t.forEach((i,o)=>{r[o]=i}),T(e,void 0,r)}};var VM=k(require("vscode")),tD=k(N());var ev=class{constructor(e){this.extensionContext=e}get extensionVersion(){return this.extensionContext.extension.packageJSON.version}};ev=v([(0,tD.injectable)(),m(0,(0,tD.inject)(tt))],ev);function Ks(){return VM.env.appName.indexOf("Insider")>0||VM.env.appName.indexOf("Code - OSS Dev")>=0?"insiders":"stable"}var Bse="VSCode.ABExp.FeatureData",jM="vscode",tv=class{constructor(e,t,r){this.configurationService=e;this.appEnvironment=t;this.globalState=r;this._optInto=[];this._optOutFrom=[];this.settings=e.getSettings(void 0);let i=this.settings.experiments.optInto,o=this.settings.experiments.optOutFrom;if(this._optInto=i.filter(l=>!l.endsWith("control")),this._optOutFrom=o.filter(l=>!l.endsWith("control")),!this.enabled)return;let s;Ks()==="insiders"?s=aE.TargetPopulation.Insiders:s=aE.TargetPopulation.Public;let a=new eD;this.experimentationService=(0,aE.getExperimentationService)(_e,this.appEnvironment.extensionVersion,s,a,this.globalState)}get enabled(){return this.settings.experiments.enabled&&!this.settings.experiments.optOutFrom.includes("All")}async activate(){this.experimentationService&&this.enabled&&(await this.experimentationService.initializePromise,this.getFeatures().length===0&&await this.experimentationService.initialFetch,this.logExperiments())}inExperiment(e){return!this.experimentationService||!this.enabled||this._optOutFrom.includes(e.toString())?!1:this._optInto.includes(e.toString())||this._optInto.includes("All")?(this.experimentationService.getTreatmentVariable(jM,e),!0):e==="DoNotWaitForZmqPortsToBeUsed"&&(Ks()==="insiders"||kh())||e==="DataViewerContribution"&&(Ks()==="insiders"||kh())?!0:this.experimentationService.getTreatmentVariable(jM,e)===!0}async getExperimentValue(e){if(!(!this.experimentationService||!this.enabled||this._optOutFrom.includes(e)))return this.experimentationService.getTreatmentVariable(jM,e)}getFeatures(){return this.globalState.get(Bse,{features:[]}).features}logExperiments(){let e=N3.workspace.getConfiguration("telemetry"),t=!1;if(e&&e.get("enableTelemetry")===!1&&(p.info("Telemetry is disabled"),t=!0),e&&e.get("telemetryLevel")==="off"&&(p.info("Telemetry level is off"),t=!0),t&&p.info("Experiments are disabled, only manually opted experiments are active."),this._optOutFrom.includes("All"))return;if(this._optInto.includes("All")){p.info(Im.inGroup("All"));return}let r=new Set(this._optInto),i=new Set;this._optOutFrom.filter(o=>o!=="All").forEach(o=>{p.info(Im.notInGroup(o))}),this._optInto.filter(o=>o!=="All").forEach(o=>{i.add(o),p.info(Im.inGroup(o))}),t&&!i.has("DoNotWaitForZmqPortsToBeUsed")&&(Ks()==="insiders"||kh())&&p.info(Im.inGroup("DoNotWaitForZmqPortsToBeUsed")),t||this.getFeatures().forEach(o=>{o.toLowerCase().startsWith("jupyter")&&!this._optOutFrom.includes(o)&&!this._optInto.includes(o)&&(r.add(o),p.info(Im.inGroup(o)))})}};tv=v([(0,Jd.injectable)(),m(0,(0,Jd.inject)(oe)),m(1,(0,Jd.inject)(Vl)),m(2,(0,Jd.inject)(We)),m(2,(0,Jd.named)(dt))],tv);var nD=k(N()),Jo=require("vscode");var rD=require("vscode");function qd(n){rD.env.openExternal(typeof n=="string"?rD.Uri.parse(n):n).then(h,h)}var $se=[{doNotDisplayPromptStateKey:"SHOW_DEPRECATED_FEATURE_PROMPT_FORMAT_ON_SAVE",message:TC.SHOW_DEPRECATED_FEATURE_PROMPT_FORMAT_ON_SAVE,moreInfoUrl:"https://github.com/Microsoft/vscode-python/issues/309",setting:{setting:"formatting.formatOnSave",values:["true",!0]}},{doNotDisplayPromptStateKey:"SHOW_DEPRECATED_FEATURE_PROMPT_LINT_ON_TEXT_CHANGE",message:TC.SHOW_DEPRECATED_FEATURE_PROMPT_LINT_ON_TEXT_CHANGE,moreInfoUrl:"https://github.com/Microsoft/vscode-python/issues/313",setting:{setting:"linting.lintOnTextChange",values:["true",!0]}},{doNotDisplayPromptStateKey:"SHOW_DEPRECATED_FEATURE_PROMPT_FOR_AUTO_COMPLETE_PRELOAD_MODULES",message:TC.SHOW_DEPRECATED_FEATURE_PROMPT_FOR_AUTO_COMPLETE_PRELOAD_MODULES,moreInfoUrl:"https://github.com/Microsoft/vscode-python/issues/1704",setting:{setting:"autoComplete.preloadModules"}}],rv=class{constructor(e){this.persistentStateFactory=e;this._onDidChangeFeatures=new Jo.EventEmitter;this.onDidChangeFeatures=this._onDidChangeFeatures.event;this._features={};this.disposables=[];this._updateFeatures(),this.disposables.push(Jo.workspace.onDidChangeConfiguration(()=>{this._updateFeatures()}))}get features(){return this._features}set features(e){this._features=e,this._onDidChangeFeatures.fire()}_updateFeatures(){this.features={}}dispose(){this.disposables.forEach(e=>e.dispose())}initialize(){$se.forEach(this.registerDeprecation.bind(this))}registerDeprecation(e){Array.isArray(e.commands)&&e.commands.forEach(t=>{this.disposables.push(Jo.commands.registerCommand(t,()=>this.notifyDeprecation(e),this))}),e.setting&&this.checkAndNotifyDeprecatedSetting(e)}async notifyDeprecation(e){let t=this.persistentStateFactory.createGlobalPersistentState(e.doNotDisplayPromptStateKey,!0);if(!t.value)return;let r="Learn more",i="Never show again",o=await Jo.window.showInformationMessage(e.message,r,i);if(o)switch(o){case r:{qd(e.moreInfoUrl);break}case i:{await t.updateValue(!1);break}default:throw new Error("Selected option not supported.")}}checkAndNotifyDeprecatedSetting(e){let t=!1;Array.isArray(Jo.workspace.workspaceFolders)&&Jo.workspace.workspaceFolders.length>0?Jo.workspace.workspaceFolders.forEach(r=>{t||(t=this.isDeprecatedSettingAndValueUsed(Jo.workspace.getConfiguration("jupyter",r.uri),e.setting))}):t=this.isDeprecatedSettingAndValueUsed(Jo.workspace.getConfiguration("jupyter"),e.setting),t&&this.notifyDeprecation(e).catch(r=>p.debug("Jupyter Extension: notifyDeprecation",r))}isDeprecatedSettingAndValueUsed(e,t){if(!e.has(t.setting))return!1;let r=e.get(t.setting);return!Array.isArray(t.values)||t.values.length===0?Array.isArray(r)?r.length>0:!0:!Array.isArray(t.values)||t.values.length===0?r===void 0?!1:Array.isArray(r)?r.length>0:!0:t.values.indexOf(e.get(t.setting))>=0}};rv=v([(0,nD.injectable)(),m(0,(0,nD.inject)(Pl))],rv);var Hd=k(N());var iD=class{constructor(e,t,r,i){this.storage=e;this.key=t;this.defaultValue=r;this.expiryDurationMs=i}get value(){if(this.expiryDurationMs){let e=this.storage.get(this.key,{data:this.defaultValue});return!e||!e.expiry||e.expiry<Date.now()?this.defaultValue:e.data}else return this.storage.get(this.key,this.defaultValue)}async updateValue(e){this.expiryDurationMs?await this.storage.update(this.key,{data:e,expiry:Date.now()+this.expiryDurationMs}):await this.storage.update(this.key,e)}},nv=class{constructor(e,t){this.globalState=e;this.workspaceState=t}createGlobalPersistentState(e,t,r){return new iD(this.globalState,e,t,r)}createWorkspacePersistentState(e,t,r){return new iD(this.workspaceState,e,t,r)}};nv=v([(0,Hd.injectable)(),m(0,(0,Hd.inject)(We)),m(0,(0,Hd.named)(dt)),m(1,(0,Hd.inject)(We)),m(1,(0,Hd.named)(di))],nv);var M3="Path",K3="PATH",O3=/^win/.test(process.platform);var F3=k(N()),Bl=require("vscode");var De=class n extends Error{static{this.back=new n("back")}static{this.cancel=new n("cancel")}static{this.resume=new n("resume")}},lE=class{constructor(){this.steps=[]}run(e,t){return this.stepThrough(e,t)}async showQuickPick(e){return this.showLazyLoadQuickPick(e).selection}showLazyLoadQuickPick({title:e,step:t,totalSteps:r,items:i,activeItem:o,placeholder:s,buttons:a,shouldResume:l,matchOnDescription:c,matchOnDetail:u,acceptFilterBoxTextAsSelection:d,startBusy:f,stopBusy:g,validate:b,onDidTriggerItemButton:I,onDidTriggerButton:w,supportBackInFirstStep:_,onDidChangeItems:A,ignoreFocusOut:R}){let V=[],ie=ne(),Q=Bl.window.createQuickPick();return Q.title=e,Q.step=t,Q.totalSteps=r,Q.placeholder=s,Q.ignoreFocusOut=R??!0,Q.items=i,g&&(Q.busy=f??!1,g(()=>{Q.enabled&&(Q.busy=!1)},this,V)),A&&(Q.keepScrollPosition=!0,A(te=>{Q.items=te},this,V)),I&&Q.onDidTriggerItemButton(te=>I(te),void 0,V),Q.matchOnDescription=c||!1,Q.matchOnDetail=u||!1,o?Q.activeItems=[o]:Q.activeItems=[],Q.buttons=[...this.steps.length>1||_?[Bl.QuickInputButtons.Back]:[],...a||[]],V.push(Q.onDidTriggerButton(te=>{te===Bl.QuickInputButtons.Back?ie.reject(De.back):w?w(te):ie.resolve(te)}),Q.onDidChangeSelection(async te=>{let ae=te.length?te[0].label:"",Y=!!ae;if(ae&&b&&te.length){Q.enabled=!1,Q.busy=!0;let be=await b(te[0]);be&&(Y=!1,await Bl.window.showErrorMessage(be,{modal:!0})),Q.enabled=!0,Q.busy=!1}Y&&ie.resolve(te[0])}),Q.onDidHide(()=>{(async()=>{ie.reject(l&&await l()?De.resume:De.cancel)})().catch(ie.reject)})),d&&V.push(Q.onDidAccept(async()=>{if(!Q.busy){let te=b?await b(Q):void 0;te?(Q.enabled=!1,Q.busy=!0,await Bl.window.showErrorMessage(te),Q.enabled=!0,Q.busy=!1):ie.resolve(Q.value)}})),this.current&&this.current.dispose(),this.current=Q,this.current.show(),ie.promise.finally(()=>G(V)).catch(h),{quickPick:Q,selection:ie.promise}}async showInputBox({title:e,step:t,totalSteps:r,value:i,prompt:o,validate:s,password:a,buttons:l,shouldResume:c,validationMessage:u}){let d=[];try{return await new Promise((f,g)=>{let b=Bl.window.createInputBox();b.title=e,b.step=t,b.totalSteps=r,b.password=!!a,b.value=i||"",b.prompt=o,b.validationMessage=u||"",b.ignoreFocusOut=!0,b.validationMessage=u||"",b.buttons=[...this.steps.length>1?[Bl.QuickInputButtons.Back]:[],...l||[]],d.push(b.onDidTriggerButton(I=>{I===Bl.QuickInputButtons.Back?g(De.back):f(I)}),b.onDidAccept(async()=>{let I=b.value;b.enabled=!1,b.busy=!0;let w=await s(I);w?(b.validationMessage=w,b.show()):(b.validationMessage="",f(I)),b.enabled=!0,b.busy=!1}),b.onDidChangeValue(async()=>{b.validationMessage=""}),b.onDidHide(()=>{(async()=>{b.busy||g(c&&await c()?De.resume:De.cancel)})().catch(g)})),this.current&&this.current.dispose(),this.current=b,this.current.show()})}finally{d.forEach(f=>f.dispose())}}async stepThrough(e,t){let r=e;for(;r;){this.steps.push(r),this.current&&(this.current.enabled=!1,this.current.busy=!0);try{r=await r(this,t)}catch(i){if(i===De.back)this.steps.pop(),r=this.steps.pop();else if(i===De.resume)r=this.steps.pop();else if(i===De.cancel)r=void 0;else throw i;if(!r)return i}}this.current&&this.current.dispose()}},oD=Symbol("IMultiStepInputFactory"),iv=class{create(){return new lE}};iv=v([(0,F3.injectable)()],iv);var L3=k(N()),U3=require("vscode");var ov=class{activate(){U3.languages.getLanguages().then(e=>{e.map(t=>t.toLowerCase()).forEach(t=>{dC.includes(t)||dC.push(t)})},h)}};ov=v([(0,L3.injectable)()],ov);var W3=Symbol("IServiceManager"),Ze=Symbol("IServiceContainer");var Qc=k(Qo());var V7=require("os"),uK;function j7(n){uK=n}async function B7(n,e={}){return(await uK.get(Li).create(void 0)).shellExec(n,e)}function uv(n){return Qc.pathExists(n)}function dK(n){return Qc.pathExistsSync(n)}function $7(n){return Qc.readFile(n,"utf-8")}function J7(n){return Qc.readFileSync(n,"utf-8")}var q7=n=>Lh(n,(0,V7.homedir)());function H7(n){return uK.get(oe).getSettings()[n]}var Y7=k(N()),Hm=k(require("os")),X7=k(km()),mK=require("vscode");var pK=require("vscode"),z7=k(require("os"));var G7=z7.homedir();function qm(n){return process.env[n]}function Qd(){if(Ur()==="Windows")return pK.Uri.file(qm("USERPROFILE")||G7);let n=qm("HOME")||qm("HOMEPATH")||G7;return pK.Uri.file(n.replace(/\\/g,"/"))}var dv=k(km());function Q7(n){n=n.replace(/\.00*(?=[1-9]|0\.)/,".");let e=dv.coerce(n);return e===null||!dv.valid(e)?new dv.SemVer("0.0.0"):e}var ql=class{constructor(){this._homeDir=Qd()||mK.Uri.file(Hm.homedir());this._tempDir=mK.Uri.file(Hm.tmpdir());this.osType=Ur();this.osType,"Unknown"}get homeDir(){return this._homeDir}get tempDir(){return this._tempDir}get pathVariableName(){return this.isWindows?M3:K3}async getVersion(){if(this.version)return this.version;switch(this.osType){case"Windows":case"OSX":try{let e=(0,X7.coerce)(Hm.release());if(e)return this.version=e;throw new Error("Unable to parse version")}catch{return Q7(Hm.release())}default:throw new Error("Not Supported")}}get isWindows(){return this.osType==="Windows"}get isMac(){return this.osType==="OSX"}get isLinux(){return this.osType==="Linux"}};ql=v([(0,Y7.injectable)()],ql);function Z7(n){n.addSingleton(xr,ql),j7(n.get(Ze))}var CD=k(N()),r8=require("vscode");var Gm=require("child_process"),SD=require("vscode");var fK="utf8";var bD=require("vscode"),e8=require("os"),ID=bD.Uri.file((0,e8.homedir)());function t8(n,e){let t=e?[{uri:bD.Uri.file(e),name:"",index:0}]:[];return M(n?bD.Uri.file(n):void 0,t,ID)}function qt(n,e=[]){return M(n,e,ID)}function hK(n,e,t){let r=e.reduce((o,s,a)=>{let l=hC(s);return(s.startsWith('"')&&s.endsWith('"')||s.startsWith("'")&&s.endsWith("'")&&(s.includes("/")||s.includes("\\")))&&(l=`${s[0]}${qt(s.substr(1))}`),a===0?l:`${o} ${l}`},""),i=[`Process Execution: ${qt(n)} ${r}`];t&&t.cwd&&i.push(`    > ${kN.currentWorkingDirectory} ${qt(t.cwd.toString())}`),p.info(i.join(`
`))}var gK=class{decode(e){return Buffer.concat(e).toString(fK)}},Yd=class Yd{constructor(e){this.env=e;this.processesToKill=new Set;this.decoder=new gK}static isAlive(e){try{return e?(process.kill(e,0),!0):!1}catch{return!1}}static kill(e){try{if(!e)return;process.platform==="win32"?(0,Gm.execSync)(`taskkill /pid ${e} /T /F`):process.kill(e)}catch{}}dispose(){this.processesToKill.forEach(e=>{try{e.dispose()}catch{}})}execObservable(e,t,r={}){let i=this.getDefaultOptions(r),o=(0,Gm.spawn)(e,t,i),s=!1;p.ci(`Exec observable ${e}, ${t.join(" ")}`);let a=[],l={dispose:function(){o&&!o.killed&&!s&&Yd.kill(o.pid),o&&o.unref(),G(a)}};this.processesToKill.add(l);let c=_le();a.push(c);let u=(f,g,b)=>{f.on(g,b),a.push({dispose:()=>f.removeListener(g,b)})};r.token&&a.push(r.token.onCancellationRequested(()=>{!s&&!o.killed&&(Yd.kill(o.pid),s=!0)}));let d=(f,g)=>{let b=this.decoder.decode([g]);f==="stderr"&&r.throwOnStdErr?c.reject(new nE(b)):c.fire({source:f,out:b})};return u(o.stdout,"data",f=>d("stdout",f)),u(o.stderr,"data",f=>d("stderr",f)),o.once("close",()=>{s=!0,c.resolve(),a.forEach(f=>f.dispose())}),o.once("exit",()=>{s=!0,c.resolve(),a.forEach(f=>f.dispose())}),o.once("error",f=>{s=!0,c.reject(f),a.forEach(g=>g.dispose())}),hK(e,t,r),{proc:o,out:c,dispose:l.dispose}}exec(e,t,r={}){let i=this.getDefaultOptions(r),o=(0,Gm.spawn)(e,t,i),s=ne(),a={dispose:()=>{!o.killed&&!s.completed&&Yd.kill(o.pid)}};this.processesToKill.add(a);let l=[],c=(f,g,b)=>{f.on(g,b),l.push({dispose:()=>f.removeListener(g,b)})};r.token&&l.push(r.token.onCancellationRequested(a.dispose));let u=[];c(o.stdout,"data",f=>u.push(f));let d=[];return c(o.stderr,"data",f=>{r.mergeStdOutErr&&u.push(f),d.push(f)}),o.once("close",()=>{if(s.completed)return;let f=d.length===0?void 0:this.decoder.decode(d);if(f&&f.length>0&&r.throwOnStdErr)s.reject(new nE(f));else{let g=this.decoder.decode(u);s.resolve({stdout:g,stderr:f})}l.forEach(g=>g.dispose())}),o.once("error",f=>{s.reject(f),l.forEach(g=>g.dispose())}),hK(e,t,r),s.promise}shellExec(e,t={}){let r=this.getDefaultOptions(t);return new Promise((i,o)=>{let s,a=(0,Gm.exec)(e,r,(c,u,d)=>{s?.dispose(),c&&c!==null?o(c):r.throwOnStdErr&&d&&d.length?o(new Error(d)):i({stderr:d&&d.length>0?d:void 0,stdout:u})});t.token&&(s=t.token.onCancellationRequested(()=>{a.exitCode===null&&!a.killed&&(o(new SD.CancellationError),Yd.kill(a.pid))}));let l={dispose:()=>{a.killed||Yd.kill(a.pid)}};this.processesToKill.add(l)})}getDefaultOptions(e){let t={...e},r=t;if(r){let i=r.encoding=typeof r.encoding=="string"&&r.encoding.length>0?r.encoding:fK;delete r.encoding,r.encoding=i}if(!t.env||Object.keys(t.env).length===0){let i=this.env?this.env:process.env;t.env={...i}}else t.env={...t.env};return t.env.PYTHONUNBUFFERED="1",t.env.PYTHONIOENCODING||(t.env.PYTHONIOENCODING="utf-8"),t.env.PYTHON_FROZEN_MODULES||(t.env.PYTHON_FROZEN_MODULES="on"),t}};v([ui("Execing shell command",5),m(1,eg())],Yd.prototype,"shellExec",1);var ka=Yd;function _le(){let n=new SD.EventEmitter,e=ne();return e.promise.catch(h),{get onDidChange(){return n.event},get done(){return e.promise},resolve:e.resolve.bind(e),reject:e.reject.bind(e),fire:n.fire.bind(n),dispose:()=>{n.dispose()}}}var zm=class{constructor(e){this.envVarsService=e}async create(e,t){if(!r8.workspace.isTrusted)throw new Error("Workspace not trusted");let r=await this.envVarsService.getEnvironmentVariables(e,"RunNonPythonCode",t);return pa(new ka(r))}};v([ui("Create ProcessService",5)],zm.prototype,"create",1),zm=v([(0,CD.injectable)(),m(0,(0,CD.inject)(Ll))],zm);function n8(n){n.addSingleton(Li,zm)}var o8=k(require("os")),wD=k(N());var pv=k(require("vscode")),i8;(l=>{let n=pv.FileSystemError.FileNotFound().name,e=pv.FileSystemError.FileExists().name,t=pv.FileSystemError.FileIsADirectory().name,r=pv.FileSystemError.FileNotADirectory().name,i=pv.FileSystemError.NoPermissions().name,o=[n,e,t,r,i];function s(c,u){if(o.includes(c.name))return c.name===u}function a(c){return s(c,n)}l.isFileNotFound=a})(i8||={});function Tle(n,e){let t=n.code;if(t)return t===e}function ED(n){let e=i8.isFileNotFound(n);return e!==void 0?e:Tle(n,"ENOENT")}var s8=require("vscode");var mv=class{constructor(e){this.fs=e}async parseFile(e,t){if(e)try{return Rle(await this.fs.readFile(s8.Uri.file(e)),t)}catch(r){ED(r)||p.error(`Failed to parse env file ${e}`,r)}}mergeVariables(e,t){t&&Object.keys(e).forEach(r=>{let i=r.toLowerCase();if(i=="pythonpath"||i=="path")return;let o=Object.keys(t).find(s=>s.toLowerCase()===i)||r;t[o]=e[r]})}mergePaths(e,t){let r=Object.keys(e).find(o=>o.toLowerCase()==="path"),i=Object.keys(t).find(o=>o.toLowerCase()==="path")||r;r&&i&&(t[i]=e[r])}appendPythonPath(e,...t){return this.appendPaths(e,"PYTHONPATH",!0,...t)}appendPath(e,...t){return this.appendPaths(e,"PATH",!0,...t)}prependPath(e,...t){return this.appendPaths(e,"PATH",!1,...t)}appendPaths(e,t,r,...i){let o=i.filter(f=>typeof f=="string"&&f.trim().length>0).map(f=>f.trim()).join(Qn);if(o.length===0)return e;let s=t.toLowerCase(),a=e?Object.keys(e).find(f=>f.toLowerCase()==s):void 0,l=e&&a?e[a]:void 0,c=a||t;l&&typeof l=="string"&&l.length>0?r&&!(e[c]||"").endsWith(Qn+o)?e[c]=l+Qn+o:!r&&!(e[c]||"").startsWith(o+Qn)&&(e[c]=o+Qn+l):e[c]=o;let d=["Path","PATH"].find(f=>f!==c);if(o8.platform()==="win32"&&d&&d in e&&typeof e[d]=="string"){let f=e[d],g=d;f&&typeof f=="string"&&f.length>0?r&&!(e[g]||"").endsWith(Qn+o)?e[g]=f+Qn+o:!r&&!(e[g]||"").startsWith(o+Qn)&&(e[g]=o+Qn+f):e[g]=o}return e}};mv=v([(0,wD.injectable)(),m(0,(0,wD.inject)(nt))],mv);function Rle(n,e){let t=e||{},r={};return n.toString().split(`
`).forEach((i,o)=>{let[s,a]=Ale(i);s!==""&&(r[s]=Mle(a,r,t))}),r}function Ale(n){let e=n.match(/^\s*([a-zA-Z]\w*)\s*=\s*(.*?)?\s*$/);if(!e)return["",""];let t=e[1],r=e[2];return r&&r!==""?r[0]==="'"&&r[r.length-1]==="'"?(r=r.substring(1,r.length-1),r=r.replace(/\\n/gm,`
`)):r[0]==='"'&&r[r.length-1]==='"'&&(r=r.substring(1,r.length-1),r=r.replace(/\\n/gm,`
`)):r="",[t,r]}var Nle=/\${([a-zA-Z]\w*)?([^}\w].*)?}/g;function Mle(n,e,t,r=""){let i=!1,o=n;return o=o.replace(Nle,(s,a,l,c,u)=>c>0&&u[c-1]==="\\"?s:l&&l!==""||!a||a===""?(i=!0,s):e[a]||t[a]||r),!i&&o!==n&&(n=o,T("ENVFILE_VARIABLE_SUBSTITUTION")),n.replace(/\\\$/g,"$")}var Hl=k(N());var Eo=require("vscode");var xa=require("vscode");var vK={number:"number",string:"string",undefined:"undefined",object:"object",function:"function"};function yK(n){return Array.isArray?Array.isArray(n):!!(n&&typeof n.length===vK.number&&n.constructor===Array)}function PD(n){return typeof n===vK.string||n instanceof String}function bK(n){return typeof n===vK.object&&n!==null&&!Array.isArray(n)&&!(n instanceof RegExp)&&!(n instanceof Date)}var kD=class{resolve(e){return PD(e)?this.__resolveString(e):yK(e)?this.__resolveArray(e):bK(e)?this.__resolveLiteral(e):e}resolveAny(e){return PD(e)?this.__resolveString(e):yK(e)?this.__resolveAnyArray(e):bK(e)?this.__resolveAnyLiteral(e):e}__resolveString(e){let t=/\$\{(.*?)\}/g;return e.replace(t,(r,i)=>{let o=this[i];return PD(o)?o:r&&(r.indexOf("env.")>0||r.indexOf("env:")>0)?"":r})}__resolveLiteral(e){let t=Object.create(null);return Object.keys(e).forEach(r=>{let i=e[r];t[r]=this.resolve(i)}),t}__resolveAnyLiteral(e){let t=Object.create(null);return Object.keys(e).forEach(r=>{let i=e[r];t[r]=this.resolveAny(i)}),t}__resolveArray(e){return e.map(t=>this.__resolveString(t))}__resolveAnyArray(e){return e.map(t=>this.resolveAny(t))}};var fv=class extends kD{constructor(e,t){super();let r=e?xa.workspace.getWorkspaceFolder(e):void 0;this._workspaceFolder=r?r.uri.fsPath:t?.fsPath||__dirname,this._workspaceFolderName=Ce(this._workspaceFolder),this._fileWorkspaceFolder=this._workspaceFolder,this._filePath=e?e.fsPath:void 0,xa.window&&xa.window.activeTextEditor&&(this._lineNumber=xa.window.activeTextEditor.selection.anchor.line+1,this._selectedText=xa.window.activeTextEditor.document.getText(new xa.Range(xa.window.activeTextEditor.selection.start,xa.window.activeTextEditor.selection.end))),this._execPath=process.execPath,Object.keys(process.env).forEach(i=>{this[`env:${i}`]=this[`env.${i}`]=process.env[i]})}get userHome(){return Qd().fsPath}get cwd(){return this.workspaceFolder}get workspaceRoot(){return this._workspaceFolder}get workspaceFolder(){return this._workspaceFolder}get fileWorkspaceFolder(){return this._fileWorkspaceFolder}get workspaceRootFolderName(){return this._workspaceFolderName}get workspaceFolderBasename(){return this._workspaceFolderName}get file(){return this._filePath}get relativeFile(){return this.file?LP(this._workspaceFolder,this.file):void 0}get relativeFileDirname(){return this.relativeFile?it(this.relativeFile):void 0}get fileBasename(){return this.file?Ce(this.file):void 0}get fileBasenameNoExtension(){return this.file?VW(this.file).name:void 0}get fileDirname(){return this.file?it(this.file):void 0}get fileDirnameBasename(){return this.fileDirname?Ce(this.fileDirname):void 0}get pathSeparator(){return vn}get fileExtname(){return this.file?Qi(this.file):void 0}get lineNumber(){return this._lineNumber}get selectedText(){return this._selectedText}get execPath(){return this._execPath}};var DD=require("vscode"),hE,xD=!1;function a8(){u8()&&c8()}async function l8(n,e){if(u8()){let r=new fv(e,void 0).resolveAny(d8());await n.exists(DD.Uri.file(r))&&c8()}}function c8(){T("ENVFILE_WORKSPACE"),xD=!0}function u8(){return!xD}function d8(){return hE||(hE=DD.workspace.getConfiguration("python").inspect("envFile")?.defaultValue||""),hE}var Ole;(t=>{function n({telemetrySent:r,defaultSetting:i}){r!==void 0&&(xD=r),d8!==void 0&&(hE=i)}t.setState=n;function e(){hE=void 0,xD=!1}t.resetState=e})(Ole||={});var Fle=60*1e3,Qm=class{constructor(e,t,r,i,o=Fle){this.envVarsService=e;this.extensionChecker=r;this.pythonApi=i;this.cacheDuration=o;this.trackedWorkspaceFolders=new Set;this.fileWatchers=new Set;this.disposables=[];this.changeEventEmitter=new Eo.EventEmitter;t.push(this)}get onDidEnvironmentVariablesChange(){return this.changeEventEmitter.event}dispose(){this.changeEventEmitter.dispose(),G(this.disposables)}async getEnvironmentVariables(e,t,r){if(e=e||(Eo.workspace.workspaceFolders?.length?Eo.workspace.workspaceFolders[0].uri:void 0),t==="RunPythonCode")return this._getEnvironmentVariables(e,t,r);let i=new fm(this.cacheDuration,this.getCacheKeyForMergedVars(e));if(i.hasData&&i.data)return p.debug(`Cached data exists getEnvironmentVariables, ${e?e.fsPath:"<No Resource>"}`),i.data;let o=this._getEnvironmentVariables(e,t,r);return o.then(s=>{r?.isCancellationRequested||(i.data=s)}).catch(h),o}async getCustomEnvironmentVariables(e,t,r){e=e||(Eo.workspace.workspaceFolders?.length?Eo.workspace.workspaceFolders[0].uri:void 0);let i=this.getWorkspaceFolderUri(e);if(!i){p.ci(`No workspace folder found for ${e?e.fsPath:"<No Resource>"}`);return}if(t==="RunPythonCode"&&this.extensionChecker.isPythonExtensionInstalled){let l=await this.pythonApi.getNewApi();if(l&&!r?.isCancellationRequested)return this.pythonEnvVarChangeEventHooked||(this.pythonEnvVarChangeEventHooked=!0,l.environments.onDidEnvironmentVariablesChange(c=>{p.debug(`Python env vars changed ${c.resource?.uri?.path}`),this.onEnvironmentFileChanged(c.resource?.uri),this.changeEventEmitter.fire(c.resource?.uri)},this,this.disposables)),l.environments.getEnvironmentVariables(i)}let o=new fm(this.cacheDuration,this.getCacheKeyForCustomVars(e));if(o.hasData)return p.debug(`Cached custom vars data exists getCustomEnvironmentVariables, ${e?e.fsPath:"<No Resource>"}`),o.data;if(r?.isCancellationRequested)return;this.trackedWorkspaceFolders.add(i.fsPath||"");let s=this.getEnvFile(i);this.createFileWatcher(s,i);let a=this.envVarsService.parseFile(s,process.env);return a.then(l=>{r?.isCancellationRequested||(o.data=l)}).catch(h),a}createFileWatcher(e,t){let r=this.getCacheKeyForMergedVars(t);if(this.fileWatchers.has(r))return;let i=new Eo.RelativePattern(Eo.Uri.file(it(e)),Ce(e)),o=Eo.workspace.createFileSystemWatcher(i,!1,!1,!1);o?(this.disposables.push(o),this.fileWatchers.add(r),o.onDidChange(()=>this.onEnvironmentFileChanged(t),this,this.disposables),o.onDidCreate(()=>this.onEnvironmentFileCreated(t),this,this.disposables),o.onDidDelete(()=>this.onEnvironmentFileChanged(t),this,this.disposables)):p.error("Failed to create file watcher for environment file")}getEnvFile(e){return Ve(e.fsPath,".env")}async _getEnvironmentVariables(e,t,r){let i=await this.getCustomEnvironmentVariables(e,t,r);if(r?.isCancellationRequested)return{};if(i&&t==="RunPythonCode"&&this.extensionChecker.isPythonExtensionInstalled)return i;i||(i={});let o={};this.envVarsService.mergeVariables(process.env,o),this.envVarsService.mergeVariables(i,o),this.envVarsService.mergePaths(process.env,o),process.env.PYTHONPATH&&(o.PYTHONPATH=process.env.PYTHONPATH);let s=i?Object.keys(i).find(a=>a.toLowerCase()=="path"):void 0;return s&&i[s]&&this.envVarsService.appendPath(o,i[s]),i.PYTHONPATH&&this.envVarsService.appendPythonPath(o,i.PYTHONPATH),o}getWorkspaceFolderUri(e){let t=Eo.workspace.workspaceFolders||[],r=t.length===1?t[0].uri:void 0;return e&&Eo.workspace.getWorkspaceFolder(e)?.uri||r}onEnvironmentFileCreated(e){this.onEnvironmentFileChanged(e),a8()}onEnvironmentFileChanged(e){new fm(this.cacheDuration,this.getCacheKeyForMergedVars(e)).clear(),new fm(this.cacheDuration,this.getCacheKeyForCustomVars(e)).clear(),this.changeEventEmitter.fire(e)}getCacheKeyForMergedVars(e){return`${Ds(e)}:RunNonPythonCode`}getCacheKeyForCustomVars(e){return`${Ds(e)}:RunNonPythonCode:CustomVars`}};v([ui("Get Custom Env Variables",1)],Qm.prototype,"getEnvironmentVariables",1),Qm=v([(0,Hl.injectable)(),m(0,(0,Hl.inject)(Fl)),m(1,(0,Hl.inject)(K)),m(2,(0,Hl.inject)(qe)),m(3,(0,Hl.inject)(tr)),m(4,(0,Hl.inject)("number")),m(4,(0,Hl.optional)())],Qm);function p8(n){n.addSingleton(Fl,mv),n.addSingleton(Ll,Qm)}var m8=k(N()),Xd=require("vscode");var IK=require("vscode");var hv=class{activate(){Xd.commands.registerCommand("jupyter.runInDedicatedExtensionHost",this.updateAffinity,this)}async updateAffinity(){let e=IK.workspace.getConfiguration("extensions").get("experimental.affinity"),t=0;e&&Object.values(e).forEach(o=>{t=Math.max(t,o)});let r=t+1,i={"ms-toolsai.jupyter":r,"ms-toolsai.jupyter-renderers":r};Xd.extensions.getExtension(sn)&&(i[sn]=r),Xd.extensions.getExtension(pm)&&(i[pm]=r),await IK.workspace.getConfiguration("extensions").update("experimental.affinity",{...e??{},...i},Xd.ConfigurationTarget.Global),Xd.commands.executeCommand("workbench.action.reloadWindow").then(h,h)}};hv=v([(0,m8.injectable)()],hv);var gE=require("vscode");var Gl=k(N());var f8=["currentServerHash","connectToLocalKernelsOnly","JUPYTER_LOCAL_KERNELSPECS","JUPYTER_LOCAL_KERNELSPECS_V1","JUPYTER_LOCAL_KERNELSPECS_V2","JUPYTER_LOCAL_KERNELSPECS_V3","JUPYTER_REMOTE_KERNELSPECS","JUPYTER_REMOTE_KERNELSPECS_V1","JUPYTER_REMOTE_KERNELSPECS_V2","JUPYTER_REMOTE_KERNELSPECS_V3","JUPYTER_LOCAL_KERNELSPECS_V4","JUPYTER_REMOTE_KERNELSPECS_V4-","LOCAL_KERNEL_SPECS_CACHE_KEY_V_2022_10","LOCAL_KERNEL_PYTHON_AND_RELATED_SPECS_CACHE_KEY_V_2022_10","user-jupyter-server-uri-list-v2","REGISTRATION_ID_EXTENSION_OWNER_MEMENTO_KEY","jupyter.jupyterServer.uriList","CACHE_KEY_FOR_JUPYTER_KERNEL_PATHS_."],gv=class{constructor(e,t,r,i){this.globalState=e;this.crypto=t;this.workspaceState=r;this.extensionContext=i}activate(){this.removeOldCachedItems().then(h,h)}async removeOldCachedItems(){await Promise.all([await this.getUriAccountKey()].concat(f8).filter(t=>this.globalState.get(t,void 0)!==void 0).map(t=>this.globalState.update(t,void 0).then(h,h)));let e=this.workspaceState.keys().filter(t=>t.startsWith("LAST_EXECUTED_CELL_")&&!t.startsWith("LAST_EXECUTED_CELL_V2_"));await Promise.all(e.map(t=>this.workspaceState.update(t,void 0))),await Promise.all(f8.map(t=>this.globalState.keys().filter(r=>r.startsWith(t)).map(r=>this.globalState.update(r,void 0).then(h,h))).flat()),await this.extensionContext.secrets.delete(`${li.JupyterServerRemoteLaunchService}.remote-uri-list`).then(h,h)}async getUriAccountKey(){let e=_l();return e?this.crypto.createHash(Ae(e),"SHA-512"):gE.workspace.workspaceFile?this.crypto.createHash(Ae(gE.workspace.workspaceFile),"SHA-512"):gE.env.machineId}};gv=v([(0,Gl.injectable)(),m(0,(0,Gl.inject)(We)),m(0,(0,Gl.named)(dt)),m(1,(0,Gl.inject)(tg)),m(2,(0,Gl.inject)(We)),m(2,(0,Gl.named)(di)),m(3,(0,Gl.inject)(tt))],gv);function h8(n){n.addSingletonInstance(H2,O3),n.addSingleton(va,zg),n.addSingleton(Pl,nv),n.addSingleton(Ui,Gc),n.addSingleton(Vl,ev),n.addSingleton(sE,Gg),n.addSingleton(tg,Gh),n.addSingleton(Sd,tv),n.addSingleton(xk,rv),n.addSingleton(ya,Qg),n.addSingleton(oD,iv),n.addSingleton(me,ov),n.addSingleton(me,gv),n.addSingleton(me,Hg),n.addSingleton(me,hv),Z7(n),n8(n),p8(n)}var _D=Symbol("ICodeExecutionHelper");var Wi=require("vscode");var g8=k(N());var vv=class{async getFileToExecute(){let e=Wi.window.activeTextEditor;if(!e){Wi.window.showErrorMessage("No open file to run in terminal").then(h,h);return}if(e.document.isUntitled){Wi.window.showErrorMessage("The active file needs to be saved before it can be run").then(h,h);return}if(e.document.languageId!==ge){Wi.window.showErrorMessage("The active file is not a Python source file").then(h,h);return}return e.document.isDirty&&await e.document.save(),e.document.uri}getSelectedTextToExecute(e){if(!e)return;let t=e.selection,r;return t.isEmpty?r=e.document.lineAt(t.start.line).text:t.isSingleLine?r=this.getSingleLineSelectionText(e):r=this.getMultiLineSelectionText(e),Oh(r.trimEnd())}async saveFileIfDirty(e){let t=Wi.workspace.textDocuments.filter(r=>r.uri.path===e.path);t.length===1&&t[0].isDirty&&await t[0].save()}getSingleLineSelectionText(e){let t=e.selection,r=new Wi.Range(t.start,t.end),i=e.document.getText(r),o=e.document.lineAt(t.start.line).text;return i.trim()===o.trim()?o:i}getMultiLineSelectionText(e){let t=e.selection,r=new Wi.Range(t.start,t.end),i=e.document.getText(r),o=new Wi.Range(new Wi.Position(t.start.line,0),new Wi.Position(t.end.line,e.document.lineAt(t.end.line).text.length)),s=e.document.getText(o);if(i.trim()===s.trim())return s;let a=e.document.lineAt(t.start.line).text,l=new Wi.Range(t.start,new Wi.Position(t.start.line,a.length)),c=e.document.getText(l);return c.trimStart()===a.trimStart()?a+i.substring(c.length):i}};vv=v([(0,g8.injectable)()],vv);function v8(n){n.addSingleton(_D,vv)}var Zd=k(N()),b8=k(km()),vE=require("vscode");var y8="CONDA_INFORMATION_CACHE";function SK(n){return n&&FP(n.fsPath)&&n.fsPath.startsWith(vn)&&`${vn}${Ce(n.fsPath)}`===n.fsPath?Ce(n.fsPath):n?.fsPath}var Fs=class{constructor(e,t,r){this.pythonApi=e;this.globalState=t;this.fs=r}async getCondaVersion(){if(this._version)return this._version;if(this._previousVersionCall)return this._previousVersionCall;let e=async()=>{let t=this.getCondaVersionFromPython();t.then(i=>{this._version=i,this.updateCache().catch(h)}).catch(h);let r=so(this.getCachedInformation());return await Promise.race([r.promise,t]),r.completed&&r.value?.version?this._version=r.value.version:t};return this._previousVersionCall=e(),this._previousVersionCall}async getCondaFile(){if(this._file)return SK(this._file);if(this._previousFileCall)return this._previousFileCall.then(SK);let e=async()=>{let t=this.pythonApi.getApi().then(i=>i.getCondaFile?i.getCondaFile():void 0);t.then(i=>{p.trace(`Conda file is ${i}`),this._file=i?vE.Uri.file(i):void 0,this.updateCache().catch(h)}).catch(h);let r=so(this.getCachedInformation());return await Promise.race([r.promise,t]),r.completed&&r.value?.file?this._file=r.value.file:t.then(i=>i?vE.Uri.file(i):void 0)};return this._previousFileCall=e(),this._previousFileCall.then(SK)}async isCondaAvailable(){return typeof this.isAvailable=="boolean"?this.isAvailable:this.getCondaVersion().then(e=>this.isAvailable=e!==void 0).catch(()=>this.isAvailable=!1)}async updateCache(){if(!this._file||!this._version)return;let e=this._file.fsPath.toLowerCase().endsWith("conda")?"":await this.fs.getFileHash(this._file);await this.globalState.update(y8,{version:this._version.raw,file:this._file.fsPath,fileHash:e})}async getCachedInformation(){let e=this.globalState.get(y8,void 0);if(!e)return;let t=e.file.toLowerCase().endsWith("conda")?"":await this.fs.getFileHash(vE.Uri.file(e.file));if(e.fileHash===t)return{version:new b8.SemVer(e.version),file:vE.Uri.file(e.file)}}async getCondaVersionFromPython(){return this.pythonApi.getApi().then(e=>e.getCondaVersion?e.getCondaVersion():void 0)}};Fs=v([(0,Zd.injectable)(),m(0,(0,Zd.inject)(tr)),m(1,(0,Zd.inject)(We)),m(1,(0,Zd.named)(dt)),m(2,(0,Zd.inject)(nt))],Fs);var yE=k(N());var S8=k(TD());var I8="_VSCODE_getDataFrame",RD=S8.default`
                            try:
                                del _VSCODE_getDataFrame
                            except:
                                pass
                            `,zl=class{constructor(e,t){this.fs=e;this.context=t}async generateCodeToGetDataFrameInfo(e){let t=await this.getContentsOfDataFrameScript(),r=e.isDebugging?"True":"False",i=`${I8}("info", ${r}, ${e.variableName})`;return e.isDebugging?{initializeCode:t,code:i,cleanupCode:RD}:{code:`${t}

${i}

${RD}`}}async generateCodeToGetDataFrameRows(e){let t=await this.getContentsOfDataFrameScript(),r=e.isDebugging?"True":"False",i=`${I8}("rows", ${r}, ${e.variableName}, ${e.startIndex}, ${e.endIndex})`;return e.isDebugging?{initializeCode:t,code:i,cleanupCode:RD}:{code:`${t}

${i}

${RD}`}}async getContentsOfDataFrameScript(){if(zl.contentsOfDataFrameScript)return zl.contentsOfDataFrameScript;let e=zt(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers","dataframes","vscodeDataFrame.py"),t=await this.fs.readFile(e);return zl.contentsOfDataFrameScript=t,t}};zl=v([(0,yE.injectable)(),m(0,(0,yE.inject)(nt)),m(1,(0,yE.inject)(tt))],zl);var IE=k(N());function AD(n,e){e===void 0&&(e=!1);var t=n.length,r=0,i="",o=0,s=16,a=0,l=0,c=0,u=0,d=0;function f(R,V){for(var ie=0,Q=0;ie<R||!V;){var te=n.charCodeAt(r);if(te>=48&&te<=57)Q=Q*16+te-48;else if(te>=65&&te<=70)Q=Q*16+te-65+10;else if(te>=97&&te<=102)Q=Q*16+te-97+10;else break;r++,ie++}return ie<R&&(Q=-1),Q}function g(R){r=R,i="",o=0,s=16,d=0}function b(){var R=r;if(n.charCodeAt(r)===48)r++;else for(r++;r<n.length&&yv(n.charCodeAt(r));)r++;if(r<n.length&&n.charCodeAt(r)===46)if(r++,r<n.length&&yv(n.charCodeAt(r)))for(r++;r<n.length&&yv(n.charCodeAt(r));)r++;else return d=3,n.substring(R,r);var V=r;if(r<n.length&&(n.charCodeAt(r)===69||n.charCodeAt(r)===101))if(r++,(r<n.length&&n.charCodeAt(r)===43||n.charCodeAt(r)===45)&&r++,r<n.length&&yv(n.charCodeAt(r))){for(r++;r<n.length&&yv(n.charCodeAt(r));)r++;V=r}else d=3;return n.substring(R,V)}function I(){for(var R="",V=r;;){if(r>=t){R+=n.substring(V,r),d=2;break}var ie=n.charCodeAt(r);if(ie===34){R+=n.substring(V,r),r++;break}if(ie===92){if(R+=n.substring(V,r),r++,r>=t){d=2;break}var Q=n.charCodeAt(r++);switch(Q){case 34:R+='"';break;case 92:R+="\\";break;case 47:R+="/";break;case 98:R+="\b";break;case 102:R+="\f";break;case 110:R+=`
`;break;case 114:R+="\r";break;case 116:R+="	";break;case 117:var te=f(4,!0);te>=0?R+=String.fromCharCode(te):d=4;break;default:d=5}V=r;continue}if(ie>=0&&ie<=31)if(bE(ie)){R+=n.substring(V,r),d=2;break}else d=6;r++}return R}function w(){if(i="",d=0,o=r,l=a,u=c,r>=t)return o=t,s=17;var R=n.charCodeAt(r);if(EK(R)){do r++,i+=String.fromCharCode(R),R=n.charCodeAt(r);while(EK(R));return s=15}if(bE(R))return r++,i+=String.fromCharCode(R),R===13&&n.charCodeAt(r)===10&&(r++,i+=`
`),a++,c=r,s=14;switch(R){case 123:return r++,s=1;case 125:return r++,s=2;case 91:return r++,s=3;case 93:return r++,s=4;case 58:return r++,s=6;case 44:return r++,s=5;case 34:return r++,i=I(),s=10;case 47:var V=r-1;if(n.charCodeAt(r+1)===47){for(r+=2;r<t&&!bE(n.charCodeAt(r));)r++;return i=n.substring(V,r),s=12}if(n.charCodeAt(r+1)===42){r+=2;for(var ie=t-1,Q=!1;r<ie;){var te=n.charCodeAt(r);if(te===42&&n.charCodeAt(r+1)===47){r+=2,Q=!0;break}r++,bE(te)&&(te===13&&n.charCodeAt(r)===10&&r++,a++,c=r)}return Q||(r++,d=1),i=n.substring(V,r),s=13}return i+=String.fromCharCode(R),r++,s=16;case 45:if(i+=String.fromCharCode(R),r++,r===t||!yv(n.charCodeAt(r)))return s=16;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return i+=b(),s=11;default:for(;r<t&&_(R);)r++,R=n.charCodeAt(r);if(o!==r){switch(i=n.substring(o,r),i){case"true":return s=8;case"false":return s=9;case"null":return s=7}return s=16}return i+=String.fromCharCode(R),r++,s=16}}function _(R){if(EK(R)||bE(R))return!1;switch(R){case 125:case 93:case 123:case 91:case 34:case 58:case 44:case 47:return!1}return!0}function A(){var R;do R=w();while(R>=12&&R<=15);return R}return{setPosition:g,getPosition:function(){return r},scan:e?A:w,getToken:function(){return s},getTokenValue:function(){return i},getTokenOffset:function(){return o},getTokenLength:function(){return r-o},getTokenStartLine:function(){return l},getTokenStartCharacter:function(){return o-u},getTokenError:function(){return d}}}function EK(n){return n===32||n===9||n===11||n===12||n===160||n===5760||n>=8192&&n<=8203||n===8239||n===8287||n===12288||n===65279}function bE(n){return n===10||n===13||n===8232||n===8233}function yv(n){return n>=48&&n<=57}var ND;(function(n){n.DEFAULT={allowTrailingComma:!1}})(ND||(ND={}));function C8(n,e){var t=[],r=new Object,i=void 0,o={value:{},offset:0,length:0,type:"object",parent:void 0},s=!1;function a(l,c,u,d){o.value=l,o.offset=c,o.length=u,o.type=d,o.colonOffset=void 0,i=o}try{kK(n,{onObjectBegin:function(l,c){if(e<=l)throw r;i=void 0,s=e>l,t.push("")},onObjectProperty:function(l,c,u){if(e<c||(a(l,c,u,"property"),t[t.length-1]=l,e<=c+u))throw r},onObjectEnd:function(l,c){if(e<=l)throw r;i=void 0,t.pop()},onArrayBegin:function(l,c){if(e<=l)throw r;i=void 0,t.push(0)},onArrayEnd:function(l,c){if(e<=l)throw r;i=void 0,t.pop()},onLiteralValue:function(l,c,u){if(e<c||(a(l,c,u,E8(l)),e<=c+u))throw r},onSeparator:function(l,c,u){if(e<=c)throw r;if(l===":"&&i&&i.type==="property")i.colonOffset=c,s=!1,i=void 0;else if(l===","){var d=t[t.length-1];typeof d=="number"?t[t.length-1]=d+1:(s=!0,t[t.length-1]=""),i=void 0}}})}catch(l){if(l!==r)throw l}return{path:t,previousNode:i,isAtPropertyKey:s,matches:function(l){for(var c=0,u=0;c<l.length&&u<t.length;u++)if(l[c]===t[u]||l[c]==="*")c++;else if(l[c]!=="**")return!1;return c===l.length}}}function wK(n,e,t){e===void 0&&(e=[]),t===void 0&&(t=ND.DEFAULT);var r={type:"array",offset:-1,length:-1,children:[],parent:void 0};function i(l){r.type==="property"&&(r.length=l-r.offset,r=r.parent)}function o(l){return r.children.push(l),l}var s={onObjectBegin:function(l){r=o({type:"object",offset:l,length:-1,parent:r,children:[]})},onObjectProperty:function(l,c,u){r=o({type:"property",offset:c,length:-1,parent:r,children:[]}),r.children.push({type:"string",value:l,offset:c,length:u,parent:r})},onObjectEnd:function(l,c){i(l+c),r.length=l+c-r.offset,r=r.parent,i(l+c)},onArrayBegin:function(l,c){r=o({type:"array",offset:l,length:-1,parent:r,children:[]})},onArrayEnd:function(l,c){r.length=l+c-r.offset,r=r.parent,i(l+c)},onLiteralValue:function(l,c,u){o({type:E8(l),offset:c,length:u,parent:r,value:l}),i(c+u)},onSeparator:function(l,c,u){r.type==="property"&&(l===":"?r.colonOffset=c:l===","&&i(c))},onError:function(l,c,u){e.push({error:l,offset:c,length:u})}};kK(n,s,t);var a=r.children[0];return a&&delete a.parent,a}function PK(n,e){if(n){for(var t=n,r=0,i=e;r<i.length;r++){var o=i[r];if(typeof o=="string"){if(t.type!=="object"||!Array.isArray(t.children))return;for(var s=!1,a=0,l=t.children;a<l.length;a++){var c=l[a];if(Array.isArray(c.children)&&c.children[0].value===o){t=c.children[1],s=!0;break}}if(!s)return}else{var u=o;if(t.type!=="array"||u<0||!Array.isArray(t.children)||u>=t.children.length)return;t=t.children[u]}}return t}}function MD(n){switch(n.type){case"array":return n.children.map(MD);case"object":for(var e=Object.create(null),t=0,r=n.children;t<r.length;t++){var i=r[t],o=i.children[1];o&&(e[i.children[0].value]=MD(o))}return e;case"null":case"string":case"number":case"boolean":return n.value;default:return}}function kK(n,e,t){t===void 0&&(t=ND.DEFAULT);var r=AD(n,!1);function i(Y){return Y?function(){return Y(r.getTokenOffset(),r.getTokenLength(),r.getTokenStartLine(),r.getTokenStartCharacter())}:function(){return!0}}function o(Y){return Y?function(be){return Y(be,r.getTokenOffset(),r.getTokenLength(),r.getTokenStartLine(),r.getTokenStartCharacter())}:function(){return!0}}var s=i(e.onObjectBegin),a=o(e.onObjectProperty),l=i(e.onObjectEnd),c=i(e.onArrayBegin),u=i(e.onArrayEnd),d=o(e.onLiteralValue),f=o(e.onSeparator),g=i(e.onComment),b=o(e.onError),I=t&&t.disallowComments,w=t&&t.allowTrailingComma;function _(){for(;;){var Y=r.scan();switch(r.getTokenError()){case 4:A(14);break;case 5:A(15);break;case 3:A(13);break;case 1:I||A(11);break;case 2:A(12);break;case 6:A(16);break}switch(Y){case 12:case 13:I?A(10):g();break;case 16:A(1);break;case 15:case 14:break;default:return Y}}}function A(Y,be,Fe){if(be===void 0&&(be=[]),Fe===void 0&&(Fe=[]),b(Y),be.length+Fe.length>0)for(var ft=r.getToken();ft!==17;){if(be.indexOf(ft)!==-1){_();break}else if(Fe.indexOf(ft)!==-1)break;ft=_()}}function R(Y){var be=r.getTokenValue();return Y?d(be):a(be),_(),!0}function V(){switch(r.getToken()){case 11:var Y=r.getTokenValue(),be=Number(Y);isNaN(be)&&(A(2),be=0),d(be);break;case 7:d(null);break;case 8:d(!0);break;case 9:d(!1);break;default:return!1}return _(),!0}function ie(){return r.getToken()!==10?(A(3,[],[2,5]),!1):(R(!1),r.getToken()===6?(f(":"),_(),ae()||A(4,[],[2,5])):A(5,[],[2,5]),!0)}function Q(){s(),_();for(var Y=!1;r.getToken()!==2&&r.getToken()!==17;){if(r.getToken()===5){if(Y||A(4,[],[]),f(","),_(),r.getToken()===2&&w)break}else Y&&A(6,[],[]);ie()||A(4,[],[2,5]),Y=!0}return l(),r.getToken()!==2?A(7,[2],[]):_(),!0}function te(){c(),_();for(var Y=!1;r.getToken()!==4&&r.getToken()!==17;){if(r.getToken()===5){if(Y||A(4,[],[]),f(","),_(),r.getToken()===4&&w)break}else Y&&A(6,[],[]);ae()||A(4,[],[4,5]),Y=!0}return u(),r.getToken()!==4?A(8,[4],[]):_(),!0}function ae(){switch(r.getToken()){case 3:return te();case 1:return Q();case 10:return R(!0);default:return V()}}return _(),r.getToken()===17?t.allowEmptyContent?!0:(A(4,[],[]),!1):ae()?(r.getToken()!==17&&A(9,[],[]),!0):(A(4,[],[]),!1)}function E8(n){switch(typeof n){case"boolean":return"boolean";case"number":return"number";case"string":return"string";case"object":{if(n){if(Array.isArray(n))return"array"}else return"null";return"object"}default:return"null"}}var xK=C8;var w8=wK,P8=PK;var k8=MD;var _K=require("vscode");var KD=k(N()),Yc=require("vscode");var fi=class{constructor(e){this.disposables=[];this._onDidChange=new Yc.EventEmitter;e.push(this),Lr()||Yc.workspace.onDidChangeConfiguration(t=>{t.affectsConfiguration("jupyter.kernels.excludePythonEnvironments")&&this._onDidChange.fire()},this,this.disposables)}get onDidChange(){return this._onDidChange.event}dispose(){this._onDidChange.dispose(),G(this.disposables)}isPythonEnvironmentExcluded(e){if(Lr())return!1;let t=this.getExcludedPythonEnvironments(),r=DK(e,t),i="uri"in e?e.uri:e.executable.uri;return r&&(T("DATASCIENCE.JUPYTER_KERNEL_HIDDEN_VIA_FILTER"),p.debug(`Python Env hidden via filter: ${M(i)}`)),r}getExcludedPythonEnvironments(){if(!Yc.workspace.workspaceFolders||Yc.workspace.workspaceFolders.length===0)return Yc.workspace.getConfiguration("jupyter",void 0).get("kernels.excludePythonEnvironments",[]);let e=[];return Yc.workspace.workspaceFolders.forEach(t=>{e.push(...Yc.workspace.getConfiguration("jupyter",t.uri).get("kernels.excludePythonEnvironments",[]))}),e}};fi=v([(0,KD.injectable)(),m(0,(0,KD.inject)(K))],fi);function DK(n,e){let t="uri"in n?n.envPath:n.environment?.folderUri,r="uri"in n?n.uri:n.executable.uri;return!r&&!t?!1:e.some(o=>{let s=M(o.trim()).toLowerCase().replace(/\\/g,"/");if(o=o.trim().toLowerCase().replace(/\\/g,"/"),o.length===0||s.length===0)return!1;let a=M(r).toLowerCase().replace(/\\/g,"/"),l=r?r.fsPath.toLowerCase().replace(/\\/g,"/"):"";if(o===a||s===a||o===l||s===l)return!0;let c=M(t||"").toLowerCase().replace(/\\/g,"/"),u=M(t||"").toLowerCase().replace(/\\/g,"/");return o===c||s===c||o===u||s===u})}var ep=class{constructor(e,t){this.disposableRegistry=e;this.pythonExtChecker=t;this.supportedWorkspaceTypes={untrustedWorkspace:!1,virtualWorkspace:!1}}async activate(){this.disposableRegistry.push(_K.languages.registerCompletionItemProvider({language:"json"},this,",","[")),this.disposableRegistry.push(_K.languages.registerCompletionItemProvider({language:"jsonc"},this,",","["))}async provideCompletionItems(e,t,r){if(!this.pythonExtChecker.isPythonExtensionInstalled||!this.pythonExtChecker.isPythonExtensionActive||mo().length===0||!ep.canProvideCompletions(e,t))return[];let i=this.getCurrentItemsInList(e,t);return mo().filter(o=>!DK(o,i)).map(o=>{let s=Hr(o),a=M(o.executable.uri);return{label:s,detail:a,insertText:`"${a.replace(/\\/g,"\\\\")}"`,filterText:`${s} ${a}`}})}static canProvideCompletions(e,t){if(Ce(e.uri.fsPath)!=="settings.json")return!1;let r=xK(e.getText(),e.offsetAt(t));return r.path[0]==="jupyter.kernels.excludePythonEnvironments"&&r.path.length===2}getCurrentItemsInList(e,t){try{let r=e.getText(),i=xK(r,e.offsetAt(t)),o=w8(r),s=P8(o,[i.path[0]]);if(!s)return[];let a=k8(s);return Array.isArray(a)?a:[]}catch(r){return p.warn("Failed to provide completions for python env filter",r),[]}}};ep=v([(0,IE.injectable)(),m(0,(0,IE.inject)(K)),m(1,(0,IE.inject)(qe))],ep);var x8=k(N()),Vi=require("vscode");var bv=class{activate(){this.migrateFilters().catch(h)}async migrateFilters(){let e=Array.isArray(Vi.workspace.workspaceFolders)?Vi.workspace.workspaceFolders:[];await this.migrateWorkspaceFilters(Vi.workspace.getConfiguration("jupyter",void 0),Vi.ConfigurationTarget.Global),e.length===0?await this.migrateWorkspaceFilters(Vi.workspace.getConfiguration("jupyter",void 0),Vi.ConfigurationTarget.Global):e.length===1?await this.migrateWorkspaceFilters(Vi.workspace.getConfiguration("jupyter",e[0].uri),Vi.ConfigurationTarget.WorkspaceFolder):(await this.migrateWorkspaceFilters(Vi.workspace.getConfiguration("jupyter",void 0),Vi.ConfigurationTarget.Workspace),await Promise.all(e.map(t=>this.migrateWorkspaceFilters(Vi.workspace.getConfiguration("jupyter",t.uri),Vi.ConfigurationTarget.WorkspaceFolder))))}async migrateWorkspaceFilters(e,t){let r=e.inspect("kernels.filter"),i=[];switch(t){case Vi.ConfigurationTarget.Global:i=r?.globalValue||[];break;case Vi.ConfigurationTarget.Workspace:i=r?.workspaceValue||[];break;default:i=r?.workspaceFolderValue||[]}let o=i.filter(s=>s.type==="pythonEnvironment").map(s=>s.path);i.length&&await e.update("kernels.filter",void 0,t),o.length&&await e.update("kernels.excludePythonEnvironments",Array.from(new Set(o)),t)}};bv=v([(0,x8.injectable)()],bv);var OD=k(N());var TK=require("vscode");var Iv=class{constructor(e){this.disposables=e}activate(){this.disposables.push(TK.commands.registerCommand("jupyter.filterKernels",()=>TK.commands.executeCommand("workbench.action.openSettings","jupyter.kernels.excludePythonEnvironments").then(h,h),this))}};Iv=v([(0,OD.injectable)(),m(0,(0,OD.inject)(K))],Iv);var FD=k(N());var Xc=Symbol("IModuleInstaller"),_Ae=Symbol("IPythonInstallation"),Sv=Symbol("IInstallationChannelManager"),SE=Symbol("IProductService"),CE=Symbol("IProductPathService");var ji=Symbol("IInstaller");var wv=require("vscode");var Cv=class{constructor(e){this.serviceContainer=e}async getInstallationChannel(e,t){let r=await this.getInstallationChannels(t);if(r.length>=1)return r[0];if(r.length===0){await this.showNoInstallersMessage(t);return}}async getInstallationChannels(e){let t=this.serviceContainer.getAll(Xc),r=[];if(t.length===0)return[];t.sort((a,l)=>l.priority-a.priority);let i=t[0].priority;for(let a of t.filter(l=>l.type!=="UV"&&l.type!=="PythonExt")){if(a.priority!==i){if(r.length>0)break;i=a.priority}await a.isSupported(e)&&r.push(a)}if(r.length>0)return r;let o=t.find(a=>a.type==="PythonExt"),s=t.find(a=>a.type==="UV");return o&&await o.isSupported(e)?[o]:s&&await s.isSupported(e)?[s]:[]}async showNoInstallersMessage(e){let t=Ue(e);if(await wv.window.showErrorMessage(t==="Conda"?Yh.noCondaOrPipInstaller:Yh.noPipInstaller,{modal:!0},Yh.searchForHelp)===Yh.searchForHelp){let i=this.serviceContainer.get(xr),o=i.isWindows?"Windows":i.isMac?"MacOS":"Linux";wv.env.openExternal(wv.Uri.parse(`https://www.bing.com/search?q=Install Pip ${o} ${t==="Conda"?"Conda":""}`))}}};Cv=v([(0,FD.injectable)(),m(0,(0,FD.inject)(Ze))],Cv);var WD=k(N());var LD=require("vscode");function hi(n){switch(n){case 18:return"jupyter";case 20:return"notebook";case 23:return"pandas";case 19:return"ipykernel";case 22:return"nbconvert";case 21:return"kernelspec";case 27:return"pip";case 28:return"ensurepip";default:throw new mt(`Product ${n} cannot be installed as a Python Module.`,void 0,"unknownProduct")}}var D8=require("os");var Pv=class extends $e{constructor(t,r,i){super("windowsLongPathNotEnabled",i);this.product=t;this.interpreter=r;this.originalMessage=i}};var Vr=Symbol("IPythonExecutionFactory"),HAe=Symbol("IPythonExecutionService");var Po=class{constructor(e){this.serviceContainer=e}async installModule(e,t,r,i,o){let s=typeof e=="string"?e:hi(e),a=await this.getExecutionArgs(s,t,i),l=this.serviceContainer.get(Vr),c=this.serviceContainer.get(Li),u=this.serviceContainer.get(Ms),d=this.serviceContainer.get(Fl);if(r.token.isCancellationRequested)return;let f=async(b,I)=>{let w=ne(),_=[];I.onCancellationRequested(()=>{r.cancel(),w.resolve()},this,_);let A;if(a.useShellExec){let te=await c.create(void 0);if(r.token.isCancellationRequested)return;try{let ae=await te.shellExec(a.args.join(" "),{cwd:a.cwd});p.debug(ae.stdout),w.resolve()}catch(ae){w.reject(ae)}}else if(a.exe){let te=await u.getActivatedEnvironmentVariables(void 0,t);if(r.token.isCancellationRequested)return;let ae={...process.env};d.mergeVariables(te||{},ae),d.mergePaths(te||{},ae);let Y=await c.create(void 0);if(r.token.isCancellationRequested)return;A=Y.execObservable(a.exe,a.args,{encoding:"utf-8",token:I,env:ae,cwd:a.cwd})}else{let te=await l.createActivatedEnvironment({interpreter:t});if(r.token.isCancellationRequested)return;A=te.execObservable(a.args,{encoding:"utf-8",token:I,cwd:a.cwd})}let R,V,ie=[".","..","..."],Q=0;return A&&(A.out.onDidChange(te=>{let ae=ie[Q%3],Y=te.out.trim();Q+=1;let be=Y.length>28?`${Y.substring(0,28)}${ae}`:Y;b?.report({message:be}),p.debug(te.out),te.source==="stderr"&&(V?V+=te.out:!V&&te.out.includes("ERROR: Could not install packages")&&(V=te.out.substring(te.out.indexOf("ERROR: Could not install packages"))),R=te.out)},this,_),A.out.done.then(()=>{A?.proc?.exitCode!==0?V&&V.includes("https://pip.pypa.io/warnings/enable-long-paths")?(V=Be(V,{trim:!0,removeEmptyEntries:!0}).filter(te=>!te.startsWith("[notice]")).join(D8.EOL),w.reject(new Pv(e,t,V))):w.reject(R||A?.proc?.exitCode):w.resolve()},te=>{w.reject(te)}).finally(()=>G(_))),w.promise},g={location:LD.ProgressLocation.Notification,cancellable:!0,title:_N.installingModule(s)};o?await f(void 0,r.token):await LD.window.withProgress(g,async(b,I)=>f(b,I))}};var $le=[hi(18),hi(20)];function UD(n,e){return $le.includes(e)?n==="pip"?["jupyter-client<8","pyzmq<25"]:["jupyter_client<8","pyzmq<25"]:[]}var _8=require("vscode");var kv=class extends Po{constructor(e){super(e)}get name(){return"Conda"}get displayName(){return"Conda"}get type(){return"Conda"}get priority(){return 0}async isSupported(e){if(this._isCondaAvailable===!1)return!1;let t=this.serviceContainer.get(Fs);return this._isCondaAvailable=await t.isCondaAvailable(),this._isCondaAvailable?Ue(e)==="Conda":!1}async installModule(e,t,r,i,o){if(await super.installModule(e,t,r,i,o),qr(t)){if(!this.serviceContainer.get(qe).isPythonExtensionActive)return;let l=await this.serviceContainer.get(rt).getInterpreterDetails(t.id);l&&!qr(l)&&Object.assign(t,l)}}async getExecutionArgs(e,t,r=0){let o=await this.serviceContainer.get(Fs).getCondaFile(),s=mr(t)?.environment?.name,a=this.getEnvironmentPath(t),l=[r&1?"update":"install"];return[19,23,22,18,20].map(hi).includes(e)&&l.push("-c","conda-forge"),s?(l.push("--name"),l.push(hC(s))):a&&(l.push("--prefix"),l.push(gC(a))),r&2&&l.push("--update-deps"),r&4&&l.push("--force-reinstall"),l.push(e),l.push(...UD("conda",e)),l.push("-y"),{exe:o,args:l}}getEnvironmentPath(e){let t,r=mr(e);if(r?.environment?.folderUri)return r.environment.folderUri.fsPath;t=r?.executable.uri||_8.Uri.file(e.id);let i=it(t.fsPath),o=Ce(i);return["BIN","SCRIPTS"].indexOf(o.toUpperCase())!==-1?Ve(i,".."):i}};kv=v([(0,WD.injectable)(),m(0,(0,WD.inject)(Ze))],kv);var jD=k(N());function Jle(){let n=qm("PIPENV_MAX_DEPTH");if(n===void 0)return 3;let e=parseInt(n,10);return isNaN(e)?(p.error(`PIPENV_MAX_DEPTH is incorrectly set. Converting value '${n}' to number results in NaN`),1):e}async function T8(n,e){let t=qm("PIPENV_PIPFILE")||"Pipfile",r=e.lookIntoParentDirectories?Jle():1;for(;r>0&&!Pd(n,it(n));){let i=Ve(n,t);if(await uv(i))return i;n=it(n),r-=1}}async function qle(n){let e=Ve(n,".project");if(!await uv(e))return;let t=await $7(e);if(!await uv(t)){p.error(`The .project file inside environment folder: ${n} doesn't contain a valid path to the project`);return}return t}async function Hle(n){let e=it(it(n.fsPath)),t=await qle(e);if(!(t===void 0||!Ce(wd(e)).startsWith(`${Ce(wd(t))}-`)))return T8(t,{lookIntoParentDirectories:!1})}async function R8(n,e){let t=await Hle(n);if(!t)return!1;let r=qm("PIPENV_NO_INHERIT")===void 0,i=await T8(e.fsPath,{lookIntoParentDirectories:r});return i?Pd(t,i):!1}var VD=require("vscode");function wE(n){let e="executable"in n?n.executable.uri||VD.Uri.file(n.path):n.uri;return VD.workspace.getWorkspaceFolder(e)?.uri||_l()}var N8=require("vscode");var A8="pipenv",xv=class extends Po{constructor(e){super(e)}get name(){return"pipenv"}get type(){return"Pipenv"}get displayName(){return A8}get priority(){return 10}async isSupported(e){if(ad(e)){let t=await this.serviceContainer.get(rt).getActiveInterpreter(e),r=e?N8.workspace.getWorkspaceFolder(e):void 0;return!t||!r||Ue(t)!=="PipEnv"?!1:R8(t.uri,r.uri)}else return Ue(e)==="PipEnv"}async getExecutionArgs(e,t,r=0){let o=[r&4||r&2||r&1?"update":"install",e,"--dev"],s=wE(t);return{args:o,exe:A8,cwd:s?Ae(s):void 0}}};xv=v([(0,jD.injectable)(),m(0,(0,jD.inject)(Ze))],xv);var BD=k(N());var Yo=Ve(__dirname,"..");var M8=Ve(Yo,"pythonFiles");var K8=require("vscode");var Dv=class extends Po{constructor(e){super(e)}get name(){return"Pip"}get type(){return"Pip"}get displayName(){return"Pip"}get priority(){return 0}async isSupported(e){switch(Ue(e)){case"Conda":case"PipEnv":case"Poetry":return!1}return this.isPipAvailable(e)}async getExecutionArgs(e,t,r=0){if(e===hi(27))return await this.serviceContainer.get(ji).isInstalled(28,t)?{args:["-m","ensurepip"]}:{args:[Ve(M8,"get-pip.py")]};let i=[],o=K8.workspace.getConfiguration("http").get("proxy","");return o.length>0&&(i.push("--proxy"),i.push(o)),i.push("install","-U"),r&4&&i.push("--force-reinstall"),Ue(t)==="Unknown"&&i.push("--user"),{args:["-m","pip",...i,e].concat(UD("pip",e))}}isPipAvailable(e){return this.serviceContainer.get(Vr).create({resource:void 0,interpreter:e}).then(r=>r.isModuleInstalled("pip")).catch(()=>!1)}};Dv=v([(0,BD.injectable)(),m(0,(0,BD.inject)(Ze))],Dv);var PE=k(N());var Gle=5e4,Zc=class Zc{constructor(e,t){this.command=e;this.cwd=t;this.fixCwd()}static{this.poetryPromise=new Map}static async getPoetry(e){if(zle(e))return(Zc.poetryPromise.get(e)===void 0||Rr())&&Zc.poetryPromise.set(e,Zc.locate(e)),Zc.poetryPromise.get(e)}static async locate(e){p.debug(`Getting poetry for cwd ${e}`);function*t(){let r=H7("poetryPath");r&&r!=="poetry"&&(yield r),yield"poetry";let i=Qd();if(i){let o=Ve(i.fsPath,".poetry","bin","poetry");dK(o)&&(yield o)}}for(let r of t()){p.debug(`Probing poetry binary for ${e}: ${r}`);let i=new Zc(r,e);if(await i.getEnvList()!==void 0)return p.debug(`Found poetry via filesystem probing for ${e}: ${r}`),i;p.debug(`Failed to find poetry for ${e}: ${r}`)}p.debug(`No poetry binary found for ${e}`)}async getEnvList(){return this.getEnvListCached(this.command,this.cwd)}async getEnvListCached(e,t){let r=await this.safeShellExecute(`${e} env list --full-path`);if(!r)return;let i="(Activated)";return(await Promise.all(Be(r.stdout).map(async s=>{s.endsWith(i)&&(s=s.slice(0,-i.length));let a=s.trim();return await uv(a)?a:void 0}))).filter(s=>s!==void 0).map(s=>s)}async getActiveEnvPath(){return this.getActiveEnvPathCached(this.cwd)}async getActiveEnvPathCached(e){let t=await this.safeShellExecute(`${this.command} env info -p`,!0);if(t)return t.stdout.trim()}async getVirtualenvsPathSetting(){let e=await this.safeShellExecute(`${this.command} config virtualenvs.path`);if(e)return e.stdout.trim()}fixCwd(){if(Ur()==="Windows"&&/^[a-z]:/.test(this.cwd)){let e=this.cwd.split(":");e[0]=e[0].toUpperCase(),this.cwd=e.join(":")}}async safeShellExecute(e,t=!1){let r=new Me,i=await B7(e,{cwd:this.cwd,throwOnStdErr:!0,timeout:Gle}).catch(o=>{t?p.debug(o):p.error(o)});return p.debug(`Time taken to run ${e} in ms`,r.elapsedTime),i}};v([_A(3e4)],Zc.prototype,"getEnvListCached",1),v([_A(2e4)],Zc.prototype,"getActiveEnvPathCached",1);var $D=Zc;async function O8(n,e,t){let i=await(t?new $D(t,e):await $D.getPoetry(e))?.getActiveEnvPath();return i?Ig(n,i):!1}function zle(n){let e=Ve(n,"pyproject.toml");return!(!dK(e)||!J7(e).includes("[tool.poetry]"))}var F8=require("vscode");var Qle="poetry",_v=class extends Po{constructor(t,r){super(t);this.configurationService=r}get name(){return"poetry"}get type(){return"Poetry"}get displayName(){return Qle}get priority(){return 10}async isSupported(t){if(Ue(t)!=="Poetry")return!1;let r=wE(t);if(r){let i="executable"in t?t.executable.uri||F8.Uri.file(t.path):t.uri;return O8(i.fsPath,r.fsPath,this.configurationService.getSettings(void 0).poetryPath)}return!1}async getExecutionArgs(t,r){let o=[this.configurationService.getSettings(void 0).poetryPath,"add","--dev",t],s=wE(r)?.fsPath;return{useShellExec:!0,args:o,cwd:s}}};_v=v([(0,PE.injectable)(),m(0,(0,PE.inject)(Ze)),m(1,(0,PE.inject)(oe))],_v);var Ql=k(N()),J8=require("vscode");var hr=new Map;hr.set(18,"jupyter");hr.set(20,"notebook");hr.set(19,"ipykernel");hr.set(22,"nbconvert");hr.set(21,"kernelspec");hr.set(23,"pandas");hr.set(27,"pip");hr.set(28,"ensurepip");var tp=k(N());var L8=new Set(["ipykernel","ipython-genutils","jupyter","jupyter-client","jupyter-core","ipywidgets","nbconvert","nbformat","notebook","pyzmq","pyzmq32","tornado","traitlets"].map(n=>n.toLowerCase())),U8="NOT INSTALLED",Ls=class{constructor(e,t,r,i,o){this.pythonExtensionChecker=e;this.interpreterService=t;this.executionFactory=r;this.apiProvider=i;this.disposables=o;this.interpreterInformation=new Map;this.pendingInterpreterInformation=new Map;this.pendingInterpreterBeforeActivation=new Set;this.interpreterPackages=new Map;Ls._instance=this,this.apiProvider.onDidActivatePythonExtension(()=>this.pendingInterpreterBeforeActivation.forEach(s=>this.trackPackages(s)),this,this.disposables)}static get instance(){return Ls._instance}getPackageVersions(e){if(!this.pythonExtensionChecker.isPythonExtensionInstalled)return Promise.resolve(new Map);let t=fn(e.uri),r=this.interpreterInformation.get(t);return r||(r=ne(),this.interpreterInformation.set(t,r),this.trackInterpreterPackages(e).catch(h)),r.promise}async getPackageVersion(e,t){if(!this.pythonExtensionChecker.isPythonExtensionInstalled)return Promise.resolve(void 0);let r=await this.getPackageVersions(e),i=await ot(t.toLocaleLowerCase());if(!r.has(i))return;let o=r.get(i);if(o)return o===U8?void 0:o}trackPackages(e,t){this.trackPackagesInternal(e,t).catch(h)}async listPackages(e){if(!this.pythonExtensionChecker.isPythonExtensionInstalled)return[];let t=Ds(e);if(!this.interpreterPackages.has(t)){let r=this.listPackagesImpl(e);this.interpreterPackages.set(t,r),r.catch(i=>{this.interpreterPackages.get(t)===r&&this.interpreterPackages.delete(t),p.warn(`Failed to get list of installed packages for ${t}`,i)})}return this.interpreterPackages.get(t).then(r=>Array.from(r))}async listPackagesImpl(e){let t=await this.interpreterService.getActiveInterpreter(e);if(!t)return new Set;let r=await this.executionFactory.createActivatedEnvironment({interpreter:t,resource:e}),i="389a87b7-288f-4235-92bf-73bf19bf6491",o=`import pkgutil;import json;print("${i}");print(json.dumps(list([x.name for x in pkgutil.iter_modules()])));print("${i}");`,s=await r.exec(["-c",o],{throwOnStdErr:!1});if(s.stdout){let a=JSON.parse(s.stdout.split(i)[1].trim());return new Set(a.concat(a.map(l=>l.toLowerCase())))}else return p.error(`Failed to get list of installed packages for ${qt(t.uri)}`,s.stderr),new Set}async trackPackagesInternal(e,t){if(!this.pythonExtensionChecker.isPythonExtensionActive){this.pendingInterpreterBeforeActivation.add(e);return}let r;if(ad(e)){let i=await this.interpreterService.getActiveInterpreter(e);if(!i)return;r=i}else r=e;this.trackInterpreterPackages(r,t).catch(h)}async trackInterpreterPackages(e,t){let r=fn(e.uri);if(this.pendingInterpreterInformation.has(r)&&!t)return;let i=this.getPackageInformation({interpreter:e});i.finally(()=>{let o=setTimeout(()=>{this.pendingInterpreterInformation.get(r)===i&&this.pendingInterpreterInformation.delete(r)},3e5),s={dispose:()=>clearTimeout(o)};this.disposables.push(s)}).catch(h),this.pendingInterpreterInformation.set(r,i)}async getPackageInformation({interpreter:e}){if(qr(e))return;let r=await(await this.executionFactory.createActivatedEnvironment({interpreter:e})).execModule("pip",["list"],{throwOnStdErr:!1,mergeStdOutErr:!0}),i=new Map;await Promise.all(Array.from(L8).map(async a=>{i.set(await ot(a),U8)})),await Promise.all(r.stdout.split(`
`).map(a=>a.trim().toLowerCase()).filter(a=>a.length>0).map(async a=>{let l=a.split(" ").filter(f=>f.trim().length);if(l.length<2)return;let[c,u]=l;if(!L8.has(c.toLowerCase().trim()))return;let d=Lc(u);i.set(await ot(c),d||"")}));let o=fn(e.uri),s=this.interpreterInformation.get(o);s||(s=ne(),this.interpreterInformation.set(o,s)),s.resolve(i)}};Ls=v([(0,tp.injectable)(),m(0,(0,tp.inject)(qe)),m(1,(0,tp.inject)(rt)),m(2,(0,tp.inject)(Vr)),m(3,(0,tp.inject)(tr)),m(4,(0,tp.inject)(K))],Ls);var W8=new Set;async function JD(n,e,t){if(ad(t))return;W8.add(t.id);let r=`${await xl(t)}#${hr.get(e)}`;await n.update(r,!0)}async function V8(n,e,t){let r=`${await xl(t)}#${hr.get(e)}`;await n.update(r,void 0)}async function j8(n,e,t){let r=`${await xl(t)}#${hr.get(e)}`;return n.get(r,!1)}function B8(n){return W8.has(n.id)}async function q8(n,e,t){let r=`${await xl(t)}#${hr.get(e)}`;if(n.get(r,!1))return!0;let i=hi(e),o=Ls.instance?Ls.instance.getPackageVersion(t,i).then(s=>typeof s=="string"?"found":"notfound").catch(s=>{p.error("Failed to get interpreter package version",s)}):Promise.resolve(void 0);try{let s=await Bt(500,o);if(typeof s=="string")return s==="found"}catch{p.error(`Failed to check if package exists ${hr.get(e)}`)}}var qD=class{constructor(e,t){this.serviceContainer=e;this.configService=e.get(oe),this.productService=e.get(SE),this.persistentStateFactory=e.get(Pl)}async install(e,t,r,i,o,s){let l=await this.serviceContainer.get(Sv).getInstallationChannel(e,t);if(!l)return 2;if(r.token.isCancellationRequested)return 3;let c=i===!0?6:void 0;return o===!0&&(c=c?c|8:8),await l.installModule(e,t,r,c,s),r.token.isCancellationRequested?3:this.isInstalled(e,t).then(u=>u?0:2)}async isInstalled(e,t){let r=this.getExecutableNameFromSettings(e,void 0);return this.isExecutableAModule(e,void 0)?(await this.serviceContainer.get(Vr).createActivatedEnvironment({resource:void 0,interpreter:t})).isModuleInstalled(r):(await this.serviceContainer.get(Li).create(void 0)).exec(r,["--version"],{mergeStdOutErr:!0}).then(()=>!0).catch(()=>!1)}getExecutableNameFromSettings(e,t){let r=this.productService.getProductType(e);return this.serviceContainer.get(CE,r).getExecutableNameFromSettings(e,t)}isExecutableAModule(e,t){let r=this.productService.getProductType(e);return this.serviceContainer.get(CE,r).isExecutableAModule(e,t)}};v([ui("Checking if product is installed"),m(1,Wc("path"))],qD.prototype,"isInstalled",1);var Tv=class{constructor(e,t,r,i){this.serviceContainer=e;this.interpreterPackages=t;this.memento=r;this.output=i;this._onInstalled=new J8.EventEmitter;this.productService=e.get(SE)}get onInstalled(){return this._onInstalled.event}dispose(){}async install(e,t,r,i,o,s){t&&this.interpreterPackages.trackPackages(t);let a="installed";try{let l=await this.createInstaller(e).install(e,t,r,i,o,s);switch(JD(this.memento,e,t).catch(h),l===0&&this._onInstalled.fire({product:e,resource:t}),l){case 3:a="cancelled";break;case 0:a="installed";break;case 2:a="ignored";break;case 1:a="disabled";break;default:break}return l}catch(l){throw a="failed",l}finally{T("DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:a,moduleName:hr.get(e)})}}async isInstalled(e,t){return this.createInstaller(e).isInstalled(e,t)}translateProductToModuleName(e){return hi(e)}createInstaller(e){switch(this.productService.getProductType(e)){case"DataScience":return new qD(this.serviceContainer,this.output);default:break}throw new mt(`Unknown product ${e}`,void 0,"unknownProduct")}};Tv=v([(0,Ql.injectable)(),m(0,(0,Ql.inject)(Ze)),m(1,(0,Ql.inject)(Nd)),m(2,(0,Ql.inject)(We)),m(2,(0,Ql.named)(dt)),m(3,(0,Ql.inject)(jo)),m(3,(0,Ql.named)(nd))],Tv);var HD=k(N()),AK=require("vscode");var H8=k(require("vscode")),Rv;async function Av(){if(Rv)return Rv;let n=H8.extensions.getExtension("ms-python.vscode-python-envs");if(n)return n.isActive?(Rv=n.exports,Rv):(await n.activate(),Rv=n.exports,Rv)}var Nv=class extends Po{constructor(e){super(e)}get name(){return"PythonEnvsApi"}get type(){return"PythonExt"}get displayName(){return"Python Environment Installer"}get priority(){return 100}async isSupported(e){try{let t=await Av();return t?await this.resolveEnvironment(e,t)!==void 0:!1}catch(t){return p.error("PythonEnvsApiInstaller.isSupported failed",t),!1}}async installModule(e,t,r,i,o){let s=typeof e=="string"?e:hi(e);try{let a=await Av();if(!a)throw new Error("Python Environment Extension API not available");let l=await this.resolveEnvironment(t,a);if(!l)throw new Error("Unable to resolve Python environment with API");let c={install:[s],upgrade:!!(i&&i&1),showSkipOption:!1};await a.managePackages(l,c)}catch(a){throw p.error(`PythonEnvsApiInstaller failed to install ${s}:`,a),a}}async getExecutionArgs(){throw new Error("getExecutionArgs should not be called for PythonEnvsApiInstaller")}async resolveEnvironment(e,t){try{return"path"in e?await t.resolveEnvironment(AK.Uri.file(e.id))||await t.resolveEnvironment(AK.Uri.file(e.path)):"uri"in e?await t.resolveEnvironment(e.uri):void 0}catch(r){p.debug(`Failed to resolve environment: ${r}`);return}}};Nv=v([(0,HD.injectable)(),m(0,(0,HD.inject)(Ze))],Nv);var GD=k(N());var NK=class{constructor(e){this.serviceContainer=e;this.configService=e.get(oe),this.productInstaller=e.get(ji)}isExecutableAModule(e,t){if(e===21)return!1;let r;try{r=this.productInstaller.translateProductToModuleName(e,2)}catch{}let i=this.getExecutableNameFromSettings(e,t);return typeof r=="string"&&r.length>0&&Ce(i)===i}},Mv=class extends NK{constructor(e){super(e)}getExecutableNameFromSettings(e,t){return this.productInstaller.translateProductToModuleName(e,2)}};Mv=v([(0,GD.injectable)(),m(0,(0,GD.inject)(Ze))],Mv);var G8=k(N());var Kv=class{constructor(){this.ProductTypes=new Map;this.ProductTypes.set(18,"DataScience"),this.ProductTypes.set(20,"DataScience"),this.ProductTypes.set(19,"DataScience"),this.ProductTypes.set(22,"DataScience"),this.ProductTypes.set(21,"DataScience"),this.ProductTypes.set(23,"DataScience"),this.ProductTypes.set(27,"DataScience"),this.ProductTypes.set(28,"DataScience")}getProductType(e){return this.ProductTypes.get(e)}};Kv=v([(0,G8.injectable)()],Kv);var zD=k(N());var Ov=class{constructor(e){this.interpreterService=e}activate(){this.interpreterService.initialize()}};Ov=v([(0,zD.injectable)(),m(0,(0,zD.inject)(rt))],Ov);var MK=require("vscode"),Fv=k(N());var Us=class{constructor(e,t,r){this.title=y.localPythonEnvironments;this._onDidChange=new MK.EventEmitter;this._onDidChangeStatus=new MK.EventEmitter;this.onDidChange=this._onDidChange.event;this.onDidChangeStatus=this._onDidChangeStatus.event;this.refreshedOnceBefore=!1;this.disposables=[];this.promiseMonitor=new ho;this._status="idle";r.push(this),this.promiseMonitor.onStateChange(()=>this.status=this.promiseMonitor.isComplete?"idle":"discovering",this,this.disposables);let i=()=>{let o=e.getNewApi();this.promiseMonitor.push(o),o.then(s=>{if(this.api=s,!s){this.status="idle",this._onDidChangeStatus.fire();return}this._onDidChange.fire(),s.environments.onDidChangeEnvironments(()=>this._onDidChange.fire(),this,this.disposables)}).catch(s=>p.error("Failed to get python api",s))};t.isPythonExtensionInstalled?i():t.onPythonExtensionInstallationStatusChanged(()=>{t.isPythonExtensionInstalled&&i()},this,this.disposables)}get items(){return this.api?(this.refreshedOnceBefore||(this.refreshedOnceBefore=!0,this.refresh().catch(h)),this.api.environments.known):[]}get status(){return this._status}set status(e){this._status=e,this._onDidChangeStatus.fire()}activate(){}dispose(){G(this.disposables)}async refresh(){if(!this.api)return;let e=this.api.environments.refreshEnvironments();this.promiseMonitor.push(e),await e.catch(h)}withFilter(e){return new Proxy(this,{get(t,r){switch(r){case"items":return t.items.filter(e);case"dispose":return h;default:return t[r]}}})}};Us=v([(0,Fv.injectable)(),m(0,(0,Fv.inject)(tr)),m(1,(0,Fv.inject)(qe)),m(2,(0,Fv.inject)(K))],Us);var Uv=k(N());function KK(n,e){if(Array.isArray(n)){let t=n.slice(1);return e&&t.push(...e),{args:t,command:n[0],python:[...n],pythonExecutable:n[n.length-1]}}return{command:n,args:e||[],python:[n],pythonExecutable:n}}function z8(n,e){let t={command:n.command,args:[...n.args],python:[...n.python],pythonExecutable:n.pythonExecutable};return e&&t.args.push(...e),t.pythonExecutable===void 0&&(t.pythonExecutable=t.python[t.python.length-1]),t}var Z8=require("vscode");function OK(n,e){return["-m",n,...e]}function Q8(){let n=["-c","import sys;print(sys.executable)"];function e(t){return t.trim()}return[n,e]}function Y8(n){let e=["-c",`import ${n};print('6af208d0-cb9c-427f-b937-ff563e17efdf')`];function t(r){return r.includes("6af208d0-cb9c-427f-b937-ff563e17efdf")?!0:(p.debug(`Module ${n} is not installed. Output ${r}`),!1)}return[e,t]}async function e5(n,e){let[t,r]=Q8(),i=z8(n,t),o=await e(i.command,i.args);return Z8.Uri.file(r(o.stdout))}var QD=class{constructor(e,t){this.deps=t;if(this.pythonEnvId=e.id,"executable"in e){if(!e.executable.uri)throw new mt(`interpreter.executable.uri is not defined for ${e.id}`,void 0,"invalidInterpreter");this.executable=e.executable.uri}else this.executable=e.uri}getExecutionInfo(e=[]){let t=this.deps.getPythonArgv(this.executable);return KK(t,e)}getExecutionObservableInfo(e=[]){let t=this.deps.getObservablePythonArgv(this.executable);return KK(t,e)}async getExecutablePath(){if(await this.deps.isValidExecutable(this.executable))return this.executable;let e=this.getExecutionInfo();return e5(e,this.deps.exec)}async isModuleInstalled(e){let[t,r]=Y8(e),i=this.getExecutionInfo(t);try{let o=await this.deps.exec(i.command,i.args,{throwOnStdErr:!1});return r(o.stdout)}catch(o){return p.warn(`Module ${e} not installed in environment ${this.pythonEnvId}`,o),!1}}};function t5(n,e,t,r,i){return{getPythonArgv:o=>e||[Ae(o)],getObservablePythonArgv:o=>t||[Ae(o)],isValidExecutable:n,exec:async(o,s,a)=>r(o,s,Object.assign({throwOnStdErr:!0},a||{})),shellExec:async(o,s)=>i(o,{timeout:s})}}function r5(n,e,t){let r=t5(async i=>t.exists(i),void 0,void 0,(i,o,s)=>e.exec(i,o,s),(i,o)=>e.shellExec(i,o));return new QD(n,r)}function n5(n,e,t,r,i){let o=["run"];e.name===""?o.push("-p",e.path):o.push("-n",e.name);let s=[n,...o,"python"],a=t5(async l=>i.exists(l),s,void 0,(l,c,u)=>r.exec(l,c,u),(l,c)=>r.shellExec(l,c));return new QD(t,a)}var YD=class extends $e{constructor(t){super("notinstalled",`Module '${t}' not installed.`);this.moduleName=t}};var FK=class{constructor(e){this.deps=e}execObservable(e,t){let r={...t},i=this.deps.getExecutionObservableInfo(e);return this.deps.execObservable(i.command,i.args,r)}execModuleObservable(e,t,r){let i=OK(e,t),o={...r},s=this.deps.getExecutionObservableInfo(i),a={...r};return a.token=void 0,this.deps.execObservable(s.command,s.args,o)}async exec(e,t){let r={...t},i=this.deps.getExecutionInfo(e);return this.deps.exec(i.command,i.args,r)}async execModule(e,t,r){let i=OK(e,t),o={...r},s=this.deps.getExecutionInfo(i),a=await this.deps.exec(s.command,s.args,o);if(e&&_k.outputHasModuleNotInstalledError(e,a.stderr)&&!await this.deps.isModuleInstalled(e))throw new YD(e);return a}};function i5(n,e){let t={isModuleInstalled:async r=>e.isModuleInstalled(r),getExecutionInfo:r=>e.getExecutionInfo(r),getExecutionObservableInfo:r=>e.getExecutionObservableInfo(r),exec:async(r,i,o)=>n.exec(r,i,o),execObservable:(r,i,o)=>n.execObservable(r,i,o)};return new FK(t)}var XD=require("vscode");var Lv=class{constructor(e,t,r){this.serviceContainer=e;this.activationHelper=t;this.processServiceFactory=r;this.disposables=this.serviceContainer.get(K),this.fileSystem=this.serviceContainer.get(nt)}async create(e){let t=await this.processServiceFactory.create(e.resource);return o5(e.interpreter,t,this.fileSystem,void 0)}async createActivatedEnvironment(e){if(e.resource=e.resource?e.resource:XD.workspace.workspaceFolders?.length?XD.workspace.workspaceFolders[0].uri:void 0,!XD.workspace.isTrusted)throw new Error("Workspace not trusted");let t=await this.activationHelper.getActivatedEnvironmentVariables(e.resource,e.interpreter);if(!(t&&Object.keys(t).length>0))return this.create({resource:e.resource,interpreter:e.interpreter});let i=new ka({...t});return this.disposables.push(i),o5(e.interpreter,i,this.fileSystem)}};Lv=v([(0,Uv.injectable)(),m(0,(0,Uv.inject)(Ze)),m(1,(0,Uv.inject)(Ms)),m(2,(0,Uv.inject)(Li))],Lv);function o5(n,e,t,r){let i=r5(n,e,t);if(r){let[s,a]=r;i=n5(s,a,n,e,t)}let o=i5(e,i);return{isModuleInstalled:s=>i.isModuleInstalled(s),execObservable:(s,a)=>o.execObservable(s,a),execModuleObservable:(s,a,l)=>o.execModuleObservable(s,a,l),exec:(s,a)=>o.exec(s,a),execModule:(s,a,l)=>o.execModule(s,a,l)}}var eu=k(N()),tu=require("vscode");var s5="https://aka.ms/JupyterKernelStartFailureOverrideReservedName",a5=["abc","aifc","antigravity","argparse","array","ast","asynchat","asyncio","asyncore","atexit","audioop","base64","bdb","binascii","binhex","bisect","builtins","bz2","cProfile","calendar","cgi","cgitb","chunk","cmath","cmd","code","codecs","codeop","collections","colorsys","compileall","concurrent","configparser","contextlib","contextvars","copy","copyreg","crypt","csv","ctypes","curses","dataclasses","datetime","dbm","decimal","difflib","dis","distutils","doctest","email","encodings","ensurepip","enum","errno","faulthandler","fcntl","filecmp","fileinput","fnmatch","formatter","fractions","ftplib","functools","gc","genericpath","getopt","getpass","gettext","glob","graphlib","grp","gzip","hashlib","heapq","hmac","html","http","idlelib","imaplib","imghdr","imp","importlib","inspect","io","ipaddress","itertools","json","keyword","lib2to3","linecache","locale","logging","lzma","mailbox","mailcap","marshal","math","mimetypes","mmap","modulefinder","multiprocessing","netrc","nis","nntplib","ntpath","nturl2path","numbers","opcode","operator","optparse","os","parser","pathlib","pdb","pickle","pickletools","pipes","pkgutil","platform","plistlib","poplib","posix","posixpath","pprint","profile","pstats","pty","pwd","py_compile","pyclbr","pydoc","pydoc_data","queue","quopri","random","re","readline","reprlib","resource","rlcompleter","runpy","sched","secrets","select","selectors","shelve","shlex","shutil","signal","site","smtpd","smtplib","sndhdr","socket","socketserver","sqlite3","sre_compile","sre_constants","sre_parse","ssl","stat","statistics","string","stringprep","struct","subprocess","sunau","symbol","symtable","sys","sysconfig","syslog","tabnanny","tarfile","telnetlib","tempfile","termios","textwrap","this","threading","time","timeit","tkinter","token","tokenize","trace","traceback","tracemalloc","tty","turtle","turtledemo","types","typing","unicodedata","unittest","urllib","uu","uuid","warnings","wave","weakref","webbrowser","wsgiref","xdrlib","xml","xmlrpc","zipapp","zipfile","zipimport","zlib","zoneinfo"];var D5=k(xE());var gr=Symbol("IFileSystemNode");var yce="jupyter.pythonPackages",BK="diagnostics.reservedPythonNames.exclude",Vv=class{constructor(e,t,r,i){this.cache=e;this.platform=t;this.fs=i;this.ignoredFiles=new Set;this.cachedModules=new Set;this.pendingUpdate=Promise.resolve();this.disposables=[];r.push(this),this.cachedModules=new Set(this.cache.get(yce,a5).map(o=>o.toLowerCase())),tu.workspace.onDidChangeConfiguration(o=>{o.affectsConfiguration(`jupyter.${BK}`)&&this.initializeIgnoreList()},this,this.disposables),this.initializeIgnoreList()}dispose(){G(this.disposables)}async getUriOverridingReservedPythonNames(e){let[t,r]=await Promise.all([this.fs.searchLocal("*.py",e.fsPath,!0),this.fs.searchLocal("*/__init__.py",e.fsPath,!0)]),i=[],o=Promise.all(t.map(a=>tu.Uri.joinPath(e,a)).map(async a=>{await this.isReserved(a)&&i.push({uri:a,type:"file"})})),s=Promise.all(r.map(a=>tu.Uri.joinPath(e,a)).map(async a=>{await this.isReserved(a)&&i.push({uri:a,type:"__init__"})}));return await Promise.all([o,s]),i}async isReserved(e){if(!e.fsPath.toLowerCase().endsWith(".py"))return!1;await this.pendingUpdate;let t=this.platform.isWindows?e.fsPath.toLowerCase():e.fsPath;if(Array.from(this.ignoredFiles).some(o=>{if(o===t||(0,D5.default)(t,o,{dot:!0}))return!0}))return!1;let r=pr(e,fd(e)).toLowerCase(),i=r==="__init__"?pr(Nn(e)).toLowerCase():r;return this.cachedModules.has(i)}async addToIgnoreList(e){await this.pendingUpdate;let t=tu.workspace.getConfiguration("jupyter"),r=this.platform.isWindows?e.fsPath.toLowerCase():e.fsPath;this.initializeIgnoreList();let i=this.ignoredFiles.size;if(this.ignoredFiles.add(r),i!==this.ignoredFiles.size)return this.pendingUpdate=this.pendingUpdate.finally(()=>t.update(BK,Array.from(this.ignoredFiles),tu.ConfigurationTarget.Global)),this.pendingUpdate}initializeIgnoreList(){let t=tu.workspace.getConfiguration("jupyter").get(BK,[]);this.platform.isWindows&&(t=t.map(r=>r.toLowerCase())),this.ignoredFiles=new Set(t)}};Vv=v([(0,eu.injectable)(),m(0,(0,eu.inject)(We)),m(0,(0,eu.named)(dt)),m(1,(0,eu.inject)(xr)),m(2,(0,eu.inject)(K)),m(3,(0,eu.inject)(gr))],Vv);var DE=k(N());var JK=k(TD());var $K="_VSCODE_getVariable",jv=JK.default`
                            try:
                                del _VSCODE_getVariable
                            except:
                                pass
                            `,Zo=class{constructor(e,t){this.fs=e;this.context=t}async generateCodeToGetVariableInfo(e){let t=await this.getContentsOfScript(),r=e.isDebugging?"True":"False",i=`${$K}("info", ${r}, ${e.variableName})`;return e.isDebugging?{initializeCode:t,code:i,cleanupCode:jv}:{code:`${t}

${i}

${jv}`}}async generateCodeToGetVariableProperties(e){let t=await this.getContentsOfScript(),r=e.isDebugging?"True":"False",i=`${$K}("properties", ${r}, ${e.variableName}, ${e.stringifiedAttributeNameList})`;return e.isDebugging?{initializeCode:t,code:i,cleanupCode:jv}:{code:`${t}

${i}

${jv}`}}async generateCodeToGetAllVariableDescriptions(e){let t=await this.getContentsOfVariablesScript();return e?t=t+`

return _VSCODE_getAllChildrenDescriptions('${e.root}', ${JSON.stringify(e.propertyChain)}, ${e.startIndex})`:t=t+`

variables= %who_ls
return _VSCODE_getVariableDescriptions(variables)`,t}async generateCodeToGetVariableTypes(e){let r=`${await this.getContentsOfScript()}

_VSCODE_rwho_ls = %who_ls
`,i=e.isDebugging?"True":"False",o=JK.default`
        try:
            del _VSCODE_rwho_ls
        except:
            pass
        `,s=`${$K}("types", ${i}, _VSCODE_rwho_ls)`;return e.isDebugging?{initializeCode:r,code:s,cleanupCode:`${jv}
${o}`}:{code:`${r}${s}

${jv}
${o}`}}async generateCodeToGetVariableValueSummary(e){let t=await this.getContentsOfVariablesScript();return t=t+`

variables= %who_ls
return _VSCODE_getVariableSummary(${e})`,t}async getContentsOfScript(){if(Zo.contentsOfScript)return Zo.contentsOfScript;let e=zt(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers","getVariableInfo","vscodeGetVariableInfo.py"),t=await this.fs.readFile(e);return Zo.contentsOfScript=t,t}async getContentsOfVariablesScript(){if(Zo.contentsOfVariablesScript)return Zo.contentsOfVariablesScript;let e=zt(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers","getVariableInfo","vscodeGetVariablesForProvider.py"),t=await this.fs.readFile(e);return Zo.contentsOfVariablesScript=t,t}};Zo=v([(0,DE.injectable)(),m(0,(0,DE.inject)(nt)),m(1,(0,DE.inject)(tt))],Zo);var _E=require("vscode");var $v=k(N());var Bv=class{constructor(e,t,r){this.pythonExtensionChecker=e;this.disposables=t;this.interpreterService=r;this.workspaceInterpreters=new Map}activate(){this.trackActiveInterpreters(),_E.extensions.onDidChange(this.trackActiveInterpreters,this,this.disposables)}isActiveWorkspaceInterpreter(e,t){if(!t)return!1;let r=Ds(e),i=this.workspaceInterpreters.get(r);return i?Bo(i,t.uri):!1}trackActiveInterpreters(){Lr()||this.trackingInterpreters||!this.pythonExtensionChecker.isPythonExtensionActive||(this.trackingInterpreters=!0,this.interpreterService.onDidChangeInterpreter(async()=>{let e=Array.isArray(_E.workspace.workspaceFolders)?_E.workspace.workspaceFolders.map(t=>t.uri):[];await Promise.all(e.map(async t=>{try{let r=Ds(t),i=await this.interpreterService.getActiveInterpreter(t);this.workspaceInterpreters.set(r,i?.uri)}catch{}}))},this,this.disposables))}};Bv=v([(0,$v.injectable)(),m(0,(0,$v.inject)(qe)),m(1,(0,$v.inject)(K)),m(2,(0,$v.inject)(rt))],Bv);var TE=k(N());var Jv=class extends Po{constructor(t,r){super(t);this.processServiceFactory=r}get name(){return"UvInstaller"}get type(){return"UV"}get displayName(){return"UV Installer"}get priority(){return 200}async isSupported(t){return await zh(t)?this.isInstalledPromise?this.isInstalledPromise:(this.isInstalledPromise=this.isUvInstalled(),this.isInstalledPromise):!1}async getExecutionArgs(t,r,i){let o=await zh(r);if(!o)throw new Error("Unable to get interpreter information");let s=["pip","install"];return i&&i&1&&s.push("--upgrade"),s.push("--python",o.executable.uri?.fsPath||o.path,t),{exe:"uv",args:s}}async isUvInstalled(){let t=await this.processServiceFactory.create(void 0);try{return!!(await t.exec("uv",["--version"],{throwOnStdErr:!0,env:process.env})).stdout}catch{return!1}}};Jv=v([(0,TE.injectable)(),m(0,(0,TE.inject)(Ze)),m(1,(0,TE.inject)(Li))],Jv);function _5(n){n.addSingleton(Vr,Lv),n.addSingleton(Fs,Fs),n.addSingleton(Wl,Wl),n.addSingleton(Nd,Ls),n.addSingleton(me,Sa),n.addSingleton(me,Ov),n.addSingleton(Px,Bv),n.addSingleton(me,bv),n.addSingleton(me,Iv),n.addSingleton(me,ep),n.addSingleton(fi,fi),n.addSingleton(wx,Vv),n.addSingleton(rg,Zo),n.addSingleton(ng,zl),n.addSingleton(Xc,Nv),n.addSingleton(Xc,Jv),n.addSingleton(Xc,kv),n.addSingleton(Xc,Dv),n.addSingleton(Xc,xv),n.addSingleton(Xc,_v),n.addSingleton(Sv,Cv),n.addSingleton(SE,Kv),n.addSingleton(ji,Tv),n.addSingleton(CE,Mv,"DataScience"),n.addSingleton(Us,Us),n.addBinding(Us,me)}var N5=k(N()),Hv=require("vscode");var R5=new Set;function A5(n){R5.add(n)}function T5(n){try{R5.forEach(e=>e.report(n))}catch(e){p.error("Failed to report progress",e)}}function qv(n){return function(e,t,r){let i=r.value;r.value=async function(...o){return T5({action:n,phase:"started"}),i.apply(this,o).finally(()=>{T5({action:n,phase:"completed"})})}}}var es=class{constructor(){this.progressReporters=[];this.actionPhases=new Map;this.currentActions=[];A5(this)}get currentAction(){return this.currentActions.length===0?void 0:this.currentActions[this.currentActions.length-1]}createProgressIndicator(e,t=!1){let r=new Hv.CancellationTokenSource,i=ne(),o={location:Hv.ProgressLocation.Notification,cancellable:t,title:e};return Hv.window.withProgress(o,async(s,a)=>{a.onCancellationRequested(()=>{a.isCancellationRequested&&r.cancel(),i.resolve()}),r.token.onCancellationRequested(()=>{i.resolve()}),this.progressReporters.push(s),await i.promise}).then(h,h),{token:r.token,dispose:()=>i.resolve()}}report(e){if(this.progressReporters.length!==0&&(this.actionPhases.set(e.action,e.phase),e.phase==="started"&&this.currentActions.push(e.action),!!this.currentAction)){for(;this.actionPhases.get(this.currentAction)&&this.actionPhases.get(this.currentAction)!=="started";)this.actionPhases.delete(this.currentAction),this.currentActions.pop();this.updateProgressMessage()}}updateProgressMessage(){if(!this.currentAction||this.progressReporters.length===0)return;let e=Ox(this.currentAction);e&&this.progressReporters.forEach(t=>t.report({message:e}))}};es=v([(0,N5.injectable)()],es);var M5=k(N());var ti=require("vscode");var ru=require("vscode");var RE=class n{constructor(e){this.jupyterConfig=e}static{this.migratedSettings={interactiveWindowMode:"interactiveWindow.creationMode",interactiveWindowViewColumn:"interactiveWindow.viewColumn",splitRunFileIntoCells:"interactiveWindow.splitRunFileIntoCells",interactiveReplNotebook:"interactiveWindow.notebookRepl",sendSelectionToInteractiveWindow:"interactiveWindow.textEditor.executeSelection",normalizeSelectionForInteractiveWindow:"interactiveWindow.textEditor.normalizeSelection",magicCommandsAsComments:"interactiveWindow.textEditor.magicCommandsAsComments",enableAutoMoveToNextCell:"interactiveWindow.textEditor.autoMoveToNextCell",newCellOnRunLast:"interactiveWindow.textEditor.autoAddNewCell",pythonCellFolding:"interactiveWindow.textEditor.cellFolding",enableCellCodeLens:"interactiveWindow.codeLens.enable",addGotoCodeLenses:"interactiveWindow.codeLens.enableGotoCell",codeLenses:"interactiveWindow.codeLens.commands",debugCodeLenses:"interactiveWindow.codeLens.debugCommands","interactiveWindow.codeLes.debugCommands":"interactiveWindow.codeLens.debugCommands",codeRegularExpression:"interactiveWindow.cellMarker.codeRegex",markdownRegularExpression:"interactiveWindow.cellMarker.markdownRegex",decorateCells:"interactiveWindow.cellMarker.decorateCells",defaultCellMarker:"interactiveWindow.cellMarker.default",enableExtendedKernelCompletions:"enableExtendedPythonKernelCompletions"}}static{this.fullSettingIds={...this.migratedSettings}}async migrateSettings(){let e=[];for(let t of Object.keys(n.migratedSettings))e.push(...this.migrateSetting(t,n.migratedSettings[t]));e.push(this.migrateIntellisenseSettings());try{await Promise.all(e)}catch(t){Gv(t)}}async migrateIntellisenseSettings(){let e="pythonCompletionTriggerCharacters",t="completionTriggerCharacters",r=this.jupyterConfig.inspect(e),i=this.jupyterConfig.inspect(t);try{if(r?.globalValue===r?.defaultValue||!i||i?.globalValue&&i.globalValue[ge])return;if(typeof r?.globalValue=="string"){let o=i.globalValue||i.defaultValue||{};o[ge]=r.globalValue.split(""),await this.jupyterConfig.update(t,o,ru.ConfigurationTarget.Global).then(h,Gv)}}finally{r?.globalValue&&await this.jupyterConfig.update(e,void 0,ru.ConfigurationTarget.Global).then(h,Gv)}}migrateSetting(e,t){let r=this.jupyterConfig.inspect(e),i=this.jupyterConfig.inspect(t),o=[];if(r?.workspaceValue!==void 0){let s=Promise.resolve();i?.workspaceValue===void 0&&(s=this.jupyterConfig.update(t,r.workspaceValue,ru.ConfigurationTarget.Workspace)),o.push(s.then(()=>this.jupyterConfig.update(e,void 0,ru.ConfigurationTarget.Workspace),Gv))}if(r?.workspaceFolderValue!==void 0){let s=Promise.resolve();i?.workspaceFolderValue===void 0&&(s=this.jupyterConfig.update(t,r.workspaceFolderValue,ru.ConfigurationTarget.WorkspaceFolder)),o.push(s.then(()=>this.jupyterConfig.update(e,void 0,ru.ConfigurationTarget.WorkspaceFolder),Gv))}if(r?.globalValue!==void 0){let s=Promise.resolve();i?.globalValue===void 0&&(s=this.jupyterConfig.update(t,r.globalValue,ru.ConfigurationTarget.Global)),o.push(s.then(()=>this.jupyterConfig.update(e,void 0,ru.ConfigurationTarget.Global),Gv))}return o}};function Gv(n){p.warn("Error migrating Jupyter configuration",n)}function bce(n){return(e,t,r)=>{let i=null,o=null;if(typeof r.value=="function"?(i="value",o=r.value):typeof r.get=="function"&&(i="get",o=r.get),!o)throw new Error("not supported");r[i]=n(o,t)}}function zv(n,e,t){return bce((r,i)=>{let o=`$debounce$${i}`,s=`$debounce$result$${i}`;return function(...a){this[s]||(this[s]=t?t():void 0),clearTimeout(this[o]),e&&(this[s]=e(this[s],...a),a=[this[s]]),this[o]=setTimeout(()=>{r.apply(this,a),this[s]=t?t():void 0},n)}})}var Da=class Da{constructor(e,t,r){this._systemVariablesCtor=t;this._type=r;this.allowUnauthorizedRemoteConnection=!1;this.jupyterInterruptTimeout=1e4;this.jupyterLaunchTimeout=6e4;this.jupyterLaunchRetries=3;this.notebookFileRoot="";this.useDefaultConfigForJupyter=!1;this.sendSelectionToInteractiveWindow=!1;this.splitRunFileIntoCells=!0;this.markdownRegularExpression="";this.codeRegularExpression="";this.errorBackgroundColor="";this.variableExplorerExclude="";this.decorateCells="currentCell";this.enableCellCodeLens=!1;this.askForLargeDataFrames=!1;this.enableAutoMoveToNextCell=!1;this.askForKernelRestart=!1;this.codeLenses="";this.debugCodeLenses="";this.debugpyDistPath="";this.stopOnFirstLineWhileDebugging=!1;this.magicCommandsAsComments=!1;this.pythonExportMethod="direct";this.stopOnError=!1;this.addGotoCodeLenses=!1;this.runStartupCommands=[];this.debugJustMyCode=!1;this.defaultCellMarker="";this.themeMatplotlibPlots=!1;this.disableJupyterAutoStart=!1;this.enablePythonKernelLogging=!1;this.jupyterCommandLineArguments=[];this.widgetScriptSources=[];this.interactiveWindowMode="multiple";this.pythonCellFolding=!0;this.interactiveWindowViewColumn="secondGroup";this.disableZMQSupport=!1;this.forceIPyKernelDebugger=!1;this.verboseLogging=!1;this.showVariableViewWhenDebugging=!0;this.newCellOnRunLast=!0;this.logKernelOutputSeparately=!1;this.development=!1;this.poetryPath="";this.excludeUserSitePackages=!1;this.enableExtendedPythonKernelCompletions=!1;this.formatStackTraces=!1;this.interactiveReplNotebook=!1;this._changeEmitter=new ti.EventEmitter;this._disposables=[];this._workspaceRoot=e,this.initialize(),ti.workspace.isTrusted===!1&&(this.disableJupyterAutoStart=!0)}get onDidChange(){return this._changeEmitter.event}static{this.jupyterSettings=new Map}static getInstance(e,t,r){let i=Da.getSettingsUriAndTarget(e).uri,o=i?i.path:"",s=Da.jupyterSettings.get(o);return s?s._type==="web"&&r==="node"&&(s._systemVariablesCtor=t,s._type=r):(s=new Da(i,t,r),Da.jupyterSettings.set(o,s)),s}static getSettingsUriAndTarget(e){let t=e?ti.workspace.getWorkspaceFolder(e):void 0,r=t?t.uri:void 0;!r&&Array.isArray(ti.workspace.workspaceFolders)&&ti.workspace.workspaceFolders.length>0&&(r=ti.workspace.workspaceFolders[0].uri);let i=r?ti.ConfigurationTarget.WorkspaceFolder:ti.ConfigurationTarget.Global;return{uri:r,target:i}}static dispose(){if(!Rr())throw new Error("Dispose can only be called from unit tests");Da.jupyterSettings.forEach(e=>e&&e.dispose()),Da.jupyterSettings.clear()}dispose(){this._disposables.forEach(e=>e&&e.dispose()),this._disposables=[]}createSystemVariables(e){return new this._systemVariablesCtor(e,this._workspaceRoot)}toJSON(){let e={};return this.getSerializableKeys().forEach(r=>e[r]=this[r]),e}update(e,t){let r=this.createSystemVariables(void 0),i=r.resolveAny(e.get("experiments"));this.experiments?Object.assign(this.experiments,i):this.experiments=i,this.experiments=this.experiments?this.experiments:{enabled:!0,optInto:[],optOutFrom:[]};let o=(a,l)=>{let c=RE.fullSettingIds[a],u=c&&l.get(c)!==void 0?l.get(c):l.get(a),d=r.resolveAny(u);d!==void 0&&(this[a]=d)};this.getSerializableKeys().filter(a=>a!=="experiments"&&a!=="logging"&&a!=="kernelPickerType").forEach(a=>o(a,e)),t&&o("poetryPath",t)}onWorkspaceFoldersChanged(){let e=(ti.workspace.workspaceFolders||[]).map(i=>i.uri.path),r=Array.from(Da.jupyterSettings.keys()).filter(i=>e.indexOf(i)<0);if(r.length>0)for(let i of r)Da.jupyterSettings.delete(i)}initialize(){let e=()=>{let i=ti.workspace.getConfiguration("jupyter",this._workspaceRoot),o=ti.workspace.getConfiguration("python",this._workspaceRoot);this.update(i,o),this.debounceChangeNotification()};this._disposables.push(ti.workspace.onDidChangeWorkspaceFolders(this.onWorkspaceFoldersChanged,this)),this._disposables.push(ti.workspace.onDidChangeConfiguration(i=>{i.affectsConfiguration("jupyter")&&e(),i.affectsConfiguration("python.poetryPath")&&e()}));let t=ti.workspace.getConfiguration("jupyter",this._workspaceRoot),r=ti.workspace.getConfiguration("python",this._workspaceRoot);t&&(this.update(t,r),this.migrateSettings(t).catch(h))}async migrateSettings(e){await new RE(e).migrateSettings()}debounceChangeNotification(){this._changeEmitter.fire()}fireChangeNotification(){this._changeEmitter.fire()}getSerializableKeys(){return Object.getOwnPropertyNames(this).filter(e=>!e.startsWith("_"))}};v([zv(1)],Da.prototype,"debounceChangeNotification",1);var Qv=Da;var Yl=require("vscode");var t_=class{async updateSectionSetting(e,t,r,i,o){let a={uri:i,target:o||Yl.ConfigurationTarget.WorkspaceFolder};e==="jupyter"&&o!==Yl.ConfigurationTarget.Global&&(a=Qv.getSettingsUriAndTarget(i));let l=Yl.workspace.getConfiguration(e,a.uri),c=l.inspect(t);c!==void 0&&(o===Yl.ConfigurationTarget.Global&&c.globalValue===r||o===Yl.ConfigurationTarget.Workspace&&c.workspaceValue===r||o===Yl.ConfigurationTarget.WorkspaceFolder&&c.workspaceFolderValue===r)||(await l.update(t,r,o),o&&await this.verifySetting(l,o,t,r))}async updateSetting(e,t,r,i){return this.updateSectionSetting("jupyter",e,t,r,i)}async verifySetting(e,t,r,i){if(Rr()&&!uC()){let o=0;do{let s=e.inspect(r);if(!s&&i===void 0||s&&i!==void 0&&(t===Yl.ConfigurationTarget.Global?s.globalValue:t===Yl.ConfigurationTarget.Workspace?s.workspaceValue:s.workspaceFolderValue)===i)break;await new Promise(a=>setTimeout(a,250)),o+=1}while(o<20)}}};var Yv=class extends t_{getSettings(e){return Qv.getInstance(e,fv,"node")}};Yv=v([(0,M5.injectable)()],Yv);var Un=k(Qo()),Tq=k(iO()),Rq=k(N()),Aq=k(Eq()),Nq=require("util");var Dq=k(N()),ap=k(require("vscode"));var kq=k(Pq()),xq=require("vscode"),Zl=class{constructor(e=kq.fetch){this.fetchImplementation=e;this.requestOptions={};let t=xq.workspace.getConfiguration("http").get("proxy","");t&&(this.requestOptions={headers:{proxy:t}})}async downloadFile(e){return this.fetchImplementation(e,this.requestOptions)}async exists(e){try{return(await this.downloadFile(e)).status===200}catch(t){return p.debug(`HttpClient - Failure checking for file ${e}: ${t}`),!1}}};var _q="utf8",ry=class{constructor(){this.vscfs=ap.workspace.fs}arePathsSame(e,t){return an(e,t)}async getFiles(e){return(await this.vscfs.readDirectory(e)).filter(r=>r[1]===ap.FileType.File).map(r=>ap.Uri.file(r[0]))}async copy(e,t,r){await this.vscfs.copy(e,t,r)}async createDirectory(e){await this.vscfs.createDirectory(e)}async delete(e){await this.vscfs.delete(e)}async readFile(e){let t=await this.vscfs.readFile(e);return new TextDecoder().decode(t)}async stat(e){return this.vscfs.stat(e)}async writeFile(e,t){return this.vscfs.writeFile(e,typeof t=="string"?new TextEncoder().encode(t):t)}async exists(e,t){if(e.scheme.toLowerCase()==="http"||e.scheme.toLowerCase()==="https")return new Zl().exists(e.toString());let r;try{r=await this.stat(e)}catch(i){return ED(i)||p.error(`stat() failed for "${e}"`,i),!1}return t===void 0?!0:t===ap.FileType.Unknown?r.type===ap.FileType.Unknown:(r.type&t)===t}async getFileHash(e){let t=await this.stat(e),r=`${t.ctime}-${t.mtime}`;return ga(r,"SHA-512")}};ry=v([(0,Dq.injectable)()],ry);var Mq=require("vscode");var ou=class extends ry{constructor(){super(),this.globFiles=(0,Nq.promisify)(Tq.default)}createLocalWriteStream(e){return Un.createWriteStream(e)}async createTemporaryLocalFile(e){let t=typeof e=="string"?e:e.fileExtension,r=e&&typeof e=="object"?e.prefix:void 0,i={postfix:t,prefix:r};return new Promise((o,s)=>{Aq.file(i,(a,l,c,u)=>{if(a)return s(a);o({filePath:l,dispose:u})})})}async searchLocal(e,t,r){let i;t&&(i={...i,cwd:t}),r&&(i={...i,dot:r});let o=await this.globFiles(e,i);return Array.isArray(o)?o:[]}async writeLocalFile(e,t){return await Un.ensureDir(it(e)),Un.writeFile(e,t)}async readFile(e){if(rf(e)){let t=await Un.readFile(Ae(e));return Buffer.from(t).toString(_q)}else return super.readFile(e)}async delete(e){rf(e)?await this.exists(e)&&((await this.stat(e)).type===Mq.FileType.Directory?await new Promise(r=>Un.rm(Ae(e),{force:!0,recursive:!0},r)):await Un.unlink(Ae(e))):await super.delete(e)}async exists(e,t){return rf(e)?Un.pathExists(Ae(e)):super.exists(e,t)}async createDirectory(e){rf(e)?await Un.ensureDir(Ae(e)):await this.vscfs.createDirectory(e)}async writeFile(e,t){if(rf(e)){let r=Ae(e);return await Un.ensureDir(it(r)),Un.writeFile(r,typeof t=="string"?Buffer.from(t):t)}else await this.vscfs.writeFile(e,typeof t=="string"?new TextEncoder().encode(t):t)}async copy(e,t,r){if(rf(e)&&rf(t)){let i=typeof r===void 0||typeof r?.overwrite==null?!0:r?.overwrite;await Un.copy(Ae(e),Ae(t),{overwrite:i})}else await super.copy(e,t,r)}};ou=v([(0,Rq.injectable)()],ou);function rf(n){return n.scheme==="file"}var FE=k(Qo());var Kq=k(N()),Oq=require("vscode");var ny=class extends Hk{async computeWorkingDirectory(e){return LE(e)}};ny=v([(0,Kq.injectable)()],ny);async function LE(n){let e=n&&n.scheme==="file"?await FE.pathExists(n.fsPath):!1;return(n&&n.scheme==="file"?await FE.pathExists(it(n.fsPath)):!1)&&n&&n.fsPath.includes(".")?it(n.fsPath):e&&n&&(await FE.stat(n.fsPath)).isDirectory()?n.fsPath:n&&Oq.workspace.getWorkspaceFolder(n)?.uri.fsPath||_l()?.fsPath||process.cwd()}var nf=k(N());var Fq=require("vscode");var iy=class{constructor(e,t){this.jupyterOutput=e;this.disposableRegistry=t}register(){this.disposableRegistry.push(Fq.commands.registerCommand(J.ViewJupyterOutput,this.viewJupyterOutput,this))}viewJupyterOutput(){this.jupyterOutput.show(!0)}};iy=v([(0,nf.injectable)(),m(0,(0,nf.inject)(jo)),m(0,(0,nf.named)(nd)),m(1,(0,nf.inject)(K))],iy);var UE=k(N()),Uq=require("vscode");var Lq=require("vscode");var oy=class{constructor(e,t,r,i=[]){this.fs=e;this.disposableRegistry=t;this.options=r;this.loadFailedEmitter=new Lq.EventEmitter;let o={enableScripts:!0,localResourceRoots:[this.options.rootPath,this.options.cwd,...i]};r.webviewHost?(this.webviewHost=r.webviewHost,this.webviewHost.webview.options=o):this.webviewHost=this.createWebview(o),this.loadPromise=this.load()}get loadFailed(){return this.loadFailedEmitter.event}asWebviewUri(e){if(!this.webviewHost?.webview)throw new Error("WebView not initialized, too early to get a Uri");return this.webviewHost.webview.asWebviewUri(e)}postMessage(e){this.webviewHost?.webview&&this.webviewHost?.webview.postMessage(e)}async generateLocalReactHtml(){if(!this.webviewHost?.webview)throw new Error("WebView not initialized, too early to get a Uri");let e=this.webviewHost.webview.asWebviewUri(this.options.cwd).toString(),t=this.options.scripts.map(o=>this.webviewHost.webview.asWebviewUri(o)),r=this.webviewHost.webview.asWebviewUri(this.options.rootPath).toString();return`<!doctype html>
        <html lang="en">
            <head>
                <meta charset="utf-8">
                <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
                <meta http-equiv="Content-Security-Policy" content="img-src 'self' data: https: http: blob: ${this.webviewHost.webview.cspSource}; default-src 'unsafe-inline' 'unsafe-eval' data: https: http: blob: ${this.webviewHost.webview.cspSource};">
                <meta name="theme-color" content="#000000">
                <meta name="theme" content="${Le.GeneratedThemeName}"/>
                <title>VS Code Python React UI</title>
                <base href="${e}${e.endsWith("/")?"":"/"}"/>
                </head>
            <body>
                <noscript>You need to enable JavaScript to run this app.</noscript>
                <div id="root"></div>
                <script type="text/javascript">
                    // Public path that will be used by webpack.
                    window.__PVSC_Public_Path = "${r}/";
                    function resolvePath(relativePath) {
                        if (relativePath && relativePath[0] == '.' && relativePath[1] != '.') {
                            return "${e}" + relativePath.substring(1);
                        }

                        return "${e}" + relativePath;
                    }
                    function forceTestMiddleware() {
                        return false;
                    }
                </script>
                ${t.map(o=>`<script type="text/javascript" src="${o}"></script>`).join(`
`)}
            </body>
        </html>`}async load(){try{this.webviewHost?.webview&&((await Promise.all(this.options.scripts.map(t=>this.fs.exists(t)))).every(t=>t===!0)?(this.webviewHost.webview.html=await this.generateLocalReactHtml(),this.postLoad(this.webviewHost)):this.webviewHost.webview.html=y.badWebPanelFormatString(this.options.scripts.join(", ")))}catch(e){p.error(`Error Loading WebviewPanel: ${e}`),this.loadFailedEmitter.fire()}}};var vO=class extends oy{constructor(t,r,i,o=[]){super(t,r,i,o);this.panelOptions=i;this._onDidChangeVisibility=new Uq.EventEmitter}get visible(){return this.webviewHost?this.webviewHost.visible:!1}get onDidChangeVisibility(){return this._onDidChangeVisibility.event}createWebview(t){throw new Error("Webview Views must be passed in an initial view")}postLoad(t){this.disposableRegistry.push(t.onDidDispose(()=>{this.webviewHost=void 0,this.panelOptions.listener.dispose()})),this.disposableRegistry.push(t.webview.onDidReceiveMessage(r=>{this.panelOptions.listener.onMessage(r.type,r.payload)})),this.disposableRegistry.push(t.onDidChangeVisibility(()=>{this._onDidChangeVisibility.fire()})),this._onDidChangeVisibility.fire()}},sy=class{constructor(e,t){this.disposableRegistry=e;this.fs=t}async create(e){return new vO(this.fs,this.disposableRegistry,e)}};sy=v([(0,UE.injectable)(),m(0,(0,UE.inject)(K)),m(1,(0,UE.inject)(nt))],sy);var ly=k(N()),c_=require("vscode");var yO=class extends oy{get panel(){return this.webviewHost}get panelOptions(){return this.options}constructor(e,t,r,i=[]){super(e,t,r,i)}async show(e){await this.loadPromise,this.panel&&(e?this.panel.visible||this.panel.reveal(this.panel.viewColumn,e):this.panel.active||this.panel.reveal(this.panel.viewColumn,e))}close(){this.panel&&this.panel.dispose()}get viewColumn(){return this.panel?.viewColumn}isVisible(){return this.panel?this.panel.visible:!1}isActive(){return this.panel?this.panel.active:!1}setTitle(e){this.panelOptions.title=e,this.panel&&(this.panel.title=e)}createWebview(e){return c_.window.createWebviewPanel(this.panelOptions.title.toLowerCase().replace(" ",""),this.panelOptions.title,{viewColumn:this.panelOptions.viewColumn,preserveFocus:!0},{retainContextWhenHidden:!0,enableFindWidget:!0,...e})}postLoad(e){this.disposableRegistry.push(e.onDidDispose(()=>{this.webviewHost=void 0,this.panelOptions.listener.dispose()})),this.disposableRegistry.push(e.webview.onDidReceiveMessage(t=>{this.panelOptions.listener.onMessage(t.type,t.payload)})),this.disposableRegistry.push(e.onDidChangeViewState(t=>{this.panelOptions.listener.onChangeViewState(this)})),this.panelOptions.listener.onChangeViewState(this)}},ay=class{constructor(e,t,r){this.disposableRegistry=e;this.fs=t;this.context=r}async create(e){let t=[c_.Uri.file(Ve(this.context.extensionPath,"temp"))];return Array.isArray(e.additionalPaths)&&t.push(...e.additionalPaths),new yO(this.fs,this.disposableRegistry,e,t)}};ay=v([(0,ly.injectable)(),m(0,(0,ly.inject)(K)),m(1,(0,ly.inject)(nt)),m(2,(0,ly.inject)(tt))],ay);function Wq(n){n.addSingleton(ou,ou),n.addBinding(ou,gr),n.addBinding(ou,nt),n.addSingleton(Vx,ny),n.addSingleton(oe,Yv),d3(n),h8(n),v8(n),_5(n),n.addSingletonInstance(kW,Date.now()),n.addSingleton(es,es),n.addSingleton(me,ut),n.addSingleton(Dk,iy),n.add(jx,sy),n.add(Vd,ay)}var of=k(N()),Jq=require("vscode");var up=k(N()),dy=require("vscode");var WE=k(N()),su=require("vscode");var cy=Symbol("IJupyterCommandFactory"),lp=Symbol("IJupyterSubCommandExecutionService");function Sue(n){n.sort((e,t)=>e===18?-1:t===18?1:e===20?-1:t===20?1:0)}function bO(n,e){let t=Hr(e)||mr(e)?.environment?.folderUri?.fsPath||e.uri.fsPath,r=n.map(i=>hr.get(i)).filter(i=>!!i).map(i=>i);switch(r.length){case 0:return"";case 1:return t?y.libraryRequiredToLaunchJupyterNotInstalledInterpreter(t,r[0]):y.libraryRequiredToLaunchJupyterNotInstalled(r[0]);default:{let i=r.pop();return t?y.librariesRequiredToLaunchJupyterNotInstalledInterpreter(t,`${r.join(", ")} ${ce.and} ${i}`):y.librariesRequiredToLaunchJupyterNotInstalled(`${r.join(", ")} ${ce.and} ${i}`)}}}var Ws=class{constructor(e,t){this.installer=e;this.commandFactory=t;this.dependenciesInstalledInInterpreter=new Set}async installMissingDependencies(e,t){let r=new su.CancellationTokenSource;try{let i=Ue(e)==="Conda"?Promise.resolve(void 0):this.installer.isInstalled(27,e),[o,s]=await Promise.all([this.getDependenciesNotInstalled(e,void 0),i]);if(o.length===0)return 0;let a=bO(s===!1?[27].concat(o):o,e);switch(T("DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"displayed",moduleName:hr.get(18),pythonEnvType:Ue(e)}),await su.window.showErrorMessage(a,{modal:!0},y.jupyterInstall,y.selectDifferentJupyterInterpreter)){case y.jupyterInstall:{o.includes(21)&&!o.includes(18)&&o.push(18);let c=o.filter(d=>d!==21);Sue(c);let u=c.shift();for(;u;)if(await Rt(r.token,2,this.installer.install(u,e,r,void 0,s===!1))===0){u=c.shift();continue}else return 2;return T("DATASCIENCE.USER_INSTALLED_JUPYTER"),this.checkKernelSpecAvailability(e)}case y.selectDifferentJupyterInterpreter:return T("DATASCIENCE.USER_DID_NOT_INSTALL_JUPYTER"),1;case y.pythonInteractiveHelpLink:return su.env.openExternal(su.Uri.parse(cC.PythonInteractiveHelpLink)),T("DATASCIENCE.USER_DID_NOT_INSTALL_JUPYTER"),2;default:return T("DATASCIENCE.USER_DID_NOT_INSTALL_JUPYTER"),2}}finally{r.dispose()}}async areDependenciesInstalled(e,t){return this.getDependenciesNotInstalled(e,t).then(r=>r.length===0)}async getDependenciesNotInstalled(e,t){let r=fn(e.uri);if(this.dependenciesInstalledInInterpreter.has(r))return[];let i=[];if(await Rt(t,Promise.all([this.installer.isInstalled(18,e).then(s=>s?void 0:i.push(18)),this.installer.isInstalled(20,e).then(s=>s?void 0:i.push(20))])),i.length>0)return i;if(t?.isCancellationRequested)return[];let o=await this.isKernelSpecAvailable(e,t).then(s=>s?[]:[21]);return o.length===0&&this.dependenciesInstalledInInterpreter.add(r),o}async isKernelSpecAvailable(e,t){return this.commandFactory.createInterpreterCommand("kernelspec","jupyter",["-m","jupyter","kernelspec"],e,!1).exec(["--version"],{throwOnStdErr:!0}).then(()=>!0).catch(i=>(p.error("Kernel spec not found: ",i),!1))}async checkKernelSpecAvailability(e,t){return await this.isKernelSpecAvailable(e)?0:t?.isCancellationRequested?2:await su.window.showErrorMessage(y.jupyterKernelSpecModuleNotFound(e.uri.fsPath),{modal:!0},y.selectDifferentJupyterInterpreter)===y.selectDifferentJupyterInterpreter?1:2}};v([qv("InstallingMissingDependencies")],Ws.prototype,"installMissingDependencies",1),Ws=v([(0,WE.injectable)(),m(0,(0,WE.inject)(ji)),m(1,(0,WE.inject)(cy))],Ws);var f_=k(N());var h_=require("vscode");var jq=require("vscode");function u_(n,e){let t=Hr(n),i={label:`${n.id===e.recommended?.id?"$(star-full) ":qr(n)?"$(warning) ":""}${t}`};return i.description=M(n.executable.uri||n.path,jq.workspace.workspaceFolders||[],new ql().homeDir),i.tooltip=qr(n)?y.pythonCondaKernelsWithoutPython:"",i}function d_(n){switch(Ue(n)){case"Conda":return qr(n)?{label:y.kernelCategoryForCondaWithoutPython,sortKey:"Z"}:{label:y.kernelCategoryForConda};case"PipEnv":return{label:y.kernelCategoryForPipEnv};case"Poetry":return{label:y.kernelCategoryForPoetry};case"Pyenv":return{label:y.kernelCategoryForPyEnv};case"Venv":case"VirtualEnv":case"VirtualEnvWrapper":return{label:y.kernelCategoryForVirtual};default:return{label:y.kernelCategoryForGlobal}}}var Vs=k(N()),Bq=require("vscode");var p_="INTERPRETER_PATH_SELECTED_FOR_JUPYTER_SERVER",IO="INTERPRETER_PATH_WAS_SELECTED_FOR_JUPYTER_SERVER",_a=class{constructor(e){this.memento=e}get interpreterSetAtleastOnce(){return!!this.selectedPythonPath||this.memento.get(IO,!1)}get selectedPythonPath(){if(this._interpreterPath)return this._interpreterPath;let e=this.memento.get(p_,void 0);if(e)return Bq.Uri.parse(e)}updateSelectedPythonPath(e){this._interpreterPath=e,this.memento.update(p_,e?.toString()).then(h,h),this.memento.update(IO,!0).then(h,h)}};_a=v([(0,Vs.injectable)(),m(0,(0,Vs.inject)(We)),m(0,(0,Vs.named)(dt))],_a);var uy=class{constructor(e,t,r,i){this.api=e;this.memento=t;this.checker=r;this.disposables=i}activate(){this.activateBackground().catch(h),this.api.onDidActivatePythonExtension(this.activateBackground,this,this.disposables)}async activateBackground(){!this.memento.get(p_)&&this.checker.isPythonExtensionActive&&await this.migrateSettings()}async migrateSettings(){if(this.settingsMigrated)return;this.settingsMigrated=!0;let t=(await this.api.getApi()).getInterpreterPathSelectedForJupyterServer();await this.memento.update(p_,t),await this.memento.update(IO,!0)}};uy=v([(0,Vs.injectable)(),m(0,(0,Vs.inject)(tr)),m(1,(0,Vs.inject)(We)),m(1,(0,Vs.named)(dt)),m(2,(0,Vs.inject)(qe)),m(3,(0,Vs.inject)(K))],uy);var oo=require("vscode");var CO=class{constructor(e){this.label=e}},m_=class extends CO{constructor(t,r){super(t);this.sortKey=r;this.kind=oo.QuickPickItemKind.Separator}},cp=class extends Qt{constructor(t,r,i,o,s,a){super();this.provider=t;this.createQuickPickItem=r;this.getCategory=i;this.options=o;this.createErrorQuickPickItem=s;this._title=a;this.categories=new Map;this.quickPickItems=[];this.previouslyEnteredValue="";this.commands=[];this._placeholder="";this.quickPickItemMap=new WeakSet;this.errorQuickPickItemMap=new WeakSet}set recommended(t){let r=this._recommended?.id!==t?.id;this._recommended=t,r&&this.quickPick&&this.rebuildQuickPickItems(this.quickPick)}get recommended(){return this._recommended}set placeholder(t){this.quickPick&&(this.quickPick.placeholder=t),this._placeholder=t}get placeholder(){return this._placeholder}set selected(t){let r=this._selected!==t;this._selected=t,r&&this.quickPick&&this.rebuildQuickPickItems(this.quickPick)}get selected(){return this._selected}createQuickPick(){let t=[],r={iconPath:new oo.ThemeIcon("refresh"),tooltip:ce.refresh},i=this.quickPick=oo.window.createQuickPick();return t.push(i),this.quickPickItems=[],i.placeholder=this.placeholder,i.matchOnDescription=!0,i.buttons=this.options.supportsBack?[oo.QuickInputButtons.Back,r]:[r],i.ignoreFocusOut=!0,i.busy=!0,i.value=this.previouslyEnteredValue,i.onDidChangeValue(o=>this.previouslyEnteredValue=o,this,t),i.onDidHide(()=>G(t),this,t),i.title=this._title||y.kernelPickerSelectKernelFromRemoteTitleWithoutName,this.provider.then(o=>{this.resolvedProvider=o,this._title||(i.title=y.kernelPickerSelectKernelFromRemoteTitle(o.title)),i.busy=o.status==="discovering",o.onDidChange(()=>this.updateQuickPickItems(i,o),this,t),i.onDidTriggerButton(async a=>{a===r&&(i.busy=!0,await o.refresh().catch(h),this.updateQuickPickItems(i,o),i.busy=!1)},this,t);let s;o.onDidChangeStatus(()=>{switch(s&&clearTimeout(s),o.status){case"discovering":i.busy=!0;break;case"idle":s=setTimeout(()=>i.busy=!1,500),t.push(new oo.Disposable(()=>s&&clearTimeout(s)));break}},this,t),$q(o.items.map(a=>this.toQuickPickItem(a)),(a,l)=>SO(this.getCategory(a.item,this),this.getCategory(l.item,this))).forEach(a=>{let l=this.connectionToCategory(a[0].item);this.quickPickItems.push(l),a.sort((c,u)=>c.label.localeCompare(u.label)),this.quickPickItems.push(...a),this.categories.set(l,new Set(a))}),this.updateQuickPickItems(i,o)}).catch(o=>p.error(`Failed to get quick pick items for ${i.title}`,o)),t.forEach(o=>this._register(o)),{quickPick:i,disposables:t}}isCommandQuickPickItem(t){return this.commands.indexOf(t)>=0}addCommand(t,r,i){let o;i&&(o={execute:()=>Promise.resolve(void 0),label:y.recommendedItemCategoryInQuickPick,kind:oo.QuickPickItemKind.Separator},this.commands.push(o));let s=t;return s.execute=r,this.commands.push(s),this.quickPick&&this.rebuildQuickPickItems(this.quickPick),{dispose:()=>{if(o){let l=this.commands.indexOf(o);l>=0&&this.commands.splice(l,1)}let a=this.commands.indexOf(s);a>=0&&this.commands.splice(a,1)}}}async selectItem(t){for(;!t.isCancellationRequested;){let{quickPick:r,disposables:i}=this.createQuickPick();r.show();try{this.previouslySelectedItem=void 0;let o=await new Promise((s,a)=>{r.onDidChangeSelection(l=>{if(l.length){let c=l[0];this.isSelectorQuickPickItem(c)?s(c.item):this.isCommandQuickPickItem(c)?s(c):this.isErrorQuickPickItem(c)}}),r.onDidTriggerButton(l=>l===oo.QuickInputButtons.Back?s(De.back):void 0,this,i),r.onDidHide(()=>s(void 0),this,i)});if(t.isCancellationRequested||!o)return;if(o instanceof De)return o===De.back?De.back:void 0;if(o&&"label"in o&&this.isCommandQuickPickItem(o)){this.previouslySelectedItem=o;let s=await o.execute();if(!s||s===De.back)continue;return s instanceof De,s}return o||void 0}finally{G(i)}}}updateQuickPickItems(t,r){let i=new Map(t.items.filter(a=>this.isSelectorQuickPickItem(a)).map(a=>a).map(a=>[a.item.id,a.item])),o=new Map(r.items.map(a=>[a.id,a]));this.quickPickItems=this.quickPickItems.map(a=>{if(this.isSelectorQuickPickItem(a)){let l=i.get(a.item.id);if(l&&l!==a.item)return this.toQuickPickItem(l);let c=o.get(a.item.id);if(c){let u=this.toQuickPickItem(c);if(JSON.stringify({...a,item:""})!==JSON.stringify({...u,item:""}))return this.toQuickPickItem(c)}}return a});let s=r.items.filter(a=>!i.has(a.id)).map(a=>this.toQuickPickItem(a));this.removeOutdatedQuickPickItems(t,r),$q(s,(a,l)=>SO(this.getCategory(a.item,this),this.getCategory(l.item,this))).forEach(a=>{a.sort((u,d)=>u.label.localeCompare(d.label));let l=this.connectionToCategory(a[0].item),c=this.quickPickItems.find(u=>u.kind===oo.QuickPickItemKind.Separator&&u.label===l.label);if(c){let u=this.quickPickItems.indexOf(c),d=this.categories.get(c),f=new Map(Array.from(d).map(I=>[I.item.id,I])),g=d.size;a.forEach(I=>{let w=f.get(I.item.id);w&&d.delete(w),d.add(I)});let b=Array.from(d);b.sort((I,w)=>I.label.localeCompare(w.label)),this.quickPickItems.splice(u+1,g,...b)}else{a.sort((f,g)=>f.label.localeCompare(g.label)),this.categories.set(l,new Set(a));let u=this.quickPickItems.filter(f=>f instanceof m_).map((f,g)=>[f,g]);u.push([l,-1]),u.sort((f,g)=>SO(f[0],g[0]));let d=u.findIndex(f=>f[1]===-1);if(d===0){this.quickPickItems.splice(0,0,l,...a);return}else if(d===u.length-1)this.quickPickItems.push(l,...a);else{let f=this.quickPickItems.findIndex(g=>g.kind===-1&&g.label===u[d+1][0].label);f=f>=0?f:0,this.quickPickItems.splice(f,0,l,...a)}}}),this.rebuildQuickPickItems(t)}rebuildQuickPickItems(t){let r=this.recommended?this.toQuickPickItem(this.recommended):void 0,i=[];r&&i.push({label:y.recommendedItemCategoryInQuickPick,kind:oo.QuickPickItemKind.Separator},r);let o=this.commands.findIndex(g=>g.kind===oo.QuickPickItemKind.Separator&&g.label===y.recommendedItemCategoryInQuickPick),s=o>=0&&o+1<this.commands.length?this.commands[o+1]:void 0,a=r||s;a=this.selected?this.quickPickItems.filter(g=>this.isSelectorQuickPickItem(g)).map(g=>g).find(g=>g.item.id===this.selected?.id):a;let l=this.quickPickItems.filter(g=>!this.isSelectorQuickPickItem(g)||g.item.id!==r?.item?.id),c=t.activeItems.length?t.activeItems[0]:void 0;a&&c&&(this.isSelectorQuickPickItem(c)?!s&&a&&"item"in a&&c.item.id!==a.item.id&&(a=void 0):s&&s?.label===c.label||(a=void 0));let u=this.resolvedProvider?.lastError?this.toErrorQuickPickItem(this.resolvedProvider.lastError):void 0,d=[].concat(Array.from(this.commands)).concat(i).concat(l).concat(u?[u]:[]),f=a?[a]:t.activeItems.length?[t.activeItems[0]]:[];if(f.length&&!d.includes(f[0])){let g=f[0],b=this.isSelectorQuickPickItem(g)&&d.find(I=>this.isSelectorQuickPickItem(I)&&I.item.id===g.item.id);b?f[0]=b:f.length=0}t.items=d,t.activeItems=f,!t.activeItems.length&&this.previouslySelectedItem&&d.includes(this.previouslySelectedItem)&&(t.activeItems=[this.previouslySelectedItem])}isErrorQuickPickItem(t){return this.errorQuickPickItemMap.has(t)}toErrorQuickPickItem(t){if(!this.createErrorQuickPickItem)return;let r=this.createErrorQuickPickItem(t,this);return this.errorQuickPickItemMap.add(r),r}isSelectorQuickPickItem(t){return this.quickPickItemMap.has(t)}toQuickPickItem(t){let r=this.createQuickPickItem(t,this);return r.item=t,this.quickPickItemMap.add(r),r}removeOutdatedQuickPickItems(t,r){let i=t.items.filter(a=>this.isSelectorQuickPickItem(a)).map(a=>a).map(a=>a.item.id),o=new Map(r.items.map(a=>[a.id,a])),s=i.filter(a=>!o.has(a));if(s.length){let a=[];this.categories.forEach((l,c)=>{l.forEach(u=>{s.includes(u.item.id)&&(l.delete(u),a.push(u))}),l.size||(a.push(c),this.categories.delete(c))}),this.quickPickItems=this.quickPickItems.filter(l=>!a.includes(l)),this.rebuildQuickPickItems(t)}}connectionToCategory(t){let r=this.getCategory(t,this);return new m_(r.label,r.sortKey||r.label)}};function $q(n,e){let t=[],r;for(let i of n.slice(0).sort(e))!r||e(r[0],i)!==0?(r=[i],t.push(r)):r.push(i);return t}function SO(n,e){return(n.sortKey||n.label).localeCompare(e.sortKey||e.label,void 0,{sensitivity:"accent"})}var au=class{constructor(e){this.serviceContainer=e}async selectPythonInterpreter(){let e=await this.selectPythonEnvironment();return e?.executable?.uri&&await this.serviceContainer.get(rt).getInterpreterDetails(e.executable.uri)}async selectPythonEnvironment(){let e=new h_.CancellationTokenSource,t=new ql,r=this.serviceContainer.get(_a).selectedPythonPath,i=Se.instance.get(fi),o=Se.instance.get(Us).withFilter(u=>!qr(u)&&!i.isPythonEnvironmentExcluded(u)),s=()=>o.items.find(u=>Bo(u.executable.uri,r,t.osType)),a=r?y.currentlySelectedJupyterInterpreterForPlaceholder(M(r,h_.workspace.workspaceFolders||[],t.homeDir)):"",l=[],c=new cp(Promise.resolve(o),u_,d_,{supportsBack:!1},void 0,y.quickPickSelectPythonEnvironmentTitle);c.placeholder=a,c.selected=s(),l.push(c),l.push(e);try{if(!c.selected&&r){let d=o.onDidChange(()=>{c.selected=s(),c.selected&&d.dispose()});l.push(d)}let u=await c.selectItem(e.token);return!u||u instanceof De?void 0:u}catch(u){p.error("Failed to select a Python Environment to start Jupyter",u)}finally{G(l)}}};au=v([(0,f_.injectable)(),m(0,(0,f_.inject)(Ze))],au);var vi=class{constructor(e,t,r,i,o){this.interpreterSelectionState=e;this.jupyterInterpreterSelector=t;this.interpreterConfiguration=r;this.interpreterService=i;this._onDidChangeInterpreter=new dy.EventEmitter;dy.workspace.onDidGrantWorkspaceTrust(()=>{this.getInitialInterpreterPromiseFailed&&(this.getInitialInterpreterPromise=void 0,this.getInitialInterpreterPromiseFailed=!1)},this,o)}get onDidChangeInterpreter(){return this._onDidChangeInterpreter.event}async getSelectedInterpreter(e){return await this.setInitialInterpreter(e),this._selectedInterpreter}async setInitialInterpreter(e){return this.getInitialInterpreterPromise||(this.getInitialInterpreterPromise=this.getInitialInterpreterImpl(e).then(t=>(t&&this.changeSelectedInterpreterProperty(t),t)),this.getInitialInterpreterPromise.catch(()=>this.getInitialInterpreterPromiseFailed=!0)),this.getInitialInterpreterPromise}async selectInterpreter(){let e=await this.jupyterInterpreterSelector.selectPythonInterpreter();if(!e)return;switch(await this.interpreterConfiguration.installMissingDependencies(e,void 0)){case 0:return await this.setAsSelectedInterpreter(e),e;case 2:return;default:return this.selectInterpreter()}}async installMissingDependencies(e){let t=await this.getSelectedInterpreter(),r=t;if(!r&&(r=await this.interpreterService.getActiveInterpreter(void 0),!r))return e&&await dy.window.showErrorMessage(e.message,{modal:!0},y.selectDifferentJupyterInterpreter)!==y.selectDifferentJupyterInterpreter?2:(await this.selectInterpreter(),1);let i=await this.interpreterConfiguration.installMissingDependencies(r,e);return i===1?(r=await this.selectInterpreter(),r?0:2):(i===0&&r!==t&&await this.setAsSelectedInterpreter(r),i)}async setAsSelectedInterpreter(e){await this.setInitialInterpreter(),this.changeSelectedInterpreterProperty(e)}changeSelectedInterpreterProperty(e){this._selectedInterpreter=e,this._onDidChangeInterpreter.fire(e),this.interpreterSelectionState.updateSelectedPythonPath(e.uri)}async validateInterpreterPath(e,t){try{let r=await Rt(t,this.interpreterService.getInterpreterDetails(e));if(r&&await this.interpreterConfiguration.areDependenciesInstalled(r,t))return r}catch{}}async getInitialInterpreterImpl(e){let t;if(this.interpreterSelectionState.selectedPythonPath&&(t=await this.validateInterpreterPath(this.interpreterSelectionState.selectedPythonPath,e),t||this.interpreterSelectionState.updateSelectedPythonPath(void 0)),!t){let r=await this.interpreterService.getActiveInterpreter(void 0);r&&await this.interpreterConfiguration.areDependenciesInstalled(r,e)&&(t=r)}return t}};vi=v([(0,up.injectable)(),m(0,(0,up.inject)(_a)),m(1,(0,up.inject)(au)),m(2,(0,up.inject)(Ws)),m(3,(0,up.inject)(rt)),m(4,(0,up.inject)(K))],vi);var g_=Symbol("IKernelLauncher"),_n=Symbol("IRawNotebookSupportedService"),v_=Symbol("IRawKernelSessionFactory");var py=class{constructor(e,t,r,i){this.jupyterInterpreterService=e;this.disposables=t;this.rawSupported=r;this.extensionChecker=i;this.notebookOpened=!1}activate(){this.disposables.push(Jq.workspace.onDidOpenNotebookDocument(this.onDidOpenNotebookEditor,this)),this.disposables.push(this.jupyterInterpreterService.onDidChangeInterpreter(this.onDidChangeInterpreter,this))}onDidOpenNotebookEditor(e){St(e)&&(this.notebookOpened=!0,T("DATASCIENCE.NATIVE.OPEN_NOTEBOOK_ALL",R$(e)),!this.rawSupported.isSupported&&this.extensionChecker.isPythonExtensionInstalled&&this.jupyterInterpreterService.setInitialInterpreter().catch(h))}onDidChangeInterpreter(){this.notebookOpened&&!this.rawSupported.isSupported&&this.extensionChecker.isPythonExtensionInstalled&&this.jupyterInterpreterService.setInitialInterpreter().catch(h)}};py=v([(0,of.injectable)(),m(0,(0,of.inject)(vi)),m(1,(0,of.inject)(K)),m(2,(0,of.inject)(_n)),m(3,(0,of.inject)(qe))],py);var y_=k(N()),qq=require("vscode");var Zr=class{static dispose(){G(Zr.disposables)}constructor(e){e.push({dispose:()=>{Zr.dispose()}})}activate(){qq.workspace.onDidChangeNotebookDocument(e=>{St(e.notebook)&&e.cellChanges.filter(t=>t.outputs?.length===0).map(t=>{let r=Zr.cellToDisplayIdMapping.get(t.cell);r&&(Zr.cellToDisplayIdMapping.delete(t.cell),Zr.displayIdCellOutputMappingPerDocument.get(e.notebook)?.delete(r))})})}static trackOutputByDisplayId(e,t,r,i){let o=Zr.displayIdCellOutputMappingPerDocument.get(e.notebook);o||(o=new Map,Zr.displayIdCellOutputMappingPerDocument.set(e.notebook,o)),o.set(t,{outputContainer:r,cell:e,outputItems:i}),Zr.cellToDisplayIdMapping.set(e,t)}static getMappedOutput(e,t){let r=Zr.displayIdCellOutputMappingPerDocument.get(e);if(!r)return;let i=r.get(t);return i?.cell.document.isClosed?void 0:i}};Zr.displayIdCellOutputMappingPerDocument=new WeakMap,Zr.cellToDisplayIdMapping=new WeakMap,Zr.disposables=[],Zr=v([(0,y_.injectable)(),m(0,(0,y_.inject)(K))],Zr);var sf=k(N());var EO="Active_Kernel_Id_List",Cue=100,rs=class{constructor(e,t){this.globalMemento=e;this.crypto=t}async getPreferredRemoteKernelId(e){let t=this.globalMemento.get(EO,[]);if(t.length){let r=e.uri,i=await this.crypto.createHash(r.toString()),o=t.find(s=>s.fileHash===i);return p.trace(`Preferred Remote kernel for ${M(r)} is ${o?.kernelId}`),o?.kernelId}}async clearPreferredRemoteKernelId(e){await this.updatePreferredRemoteKernelIdInternal(e)}async storePreferredRemoteKernelId(e,t){await this.updatePreferredRemoteKernelIdInternal(e,t)}async updatePreferredRemoteKernelIdInternal(e,t){let r=!1,i=JSON.parse(JSON.stringify(this.globalMemento.get(EO,[]))),o=await this.crypto.createHash(e.toString()),s=i.findIndex(a=>a.fileHash===o);for(s>=0&&(r=!0,i.splice(s,1)),t&&(r=!0,i.push({fileHash:o,kernelId:t}),p.trace(`Storing Preferred remote kernel for ${M(e)} is ${t}`));i.length>Cue;)r=!0,i.shift();r&&await this.globalMemento.update(EO,i)}};rs=v([(0,sf.injectable)(),m(0,(0,sf.inject)(We)),m(0,(0,sf.named)(dt)),m(1,(0,sf.inject)(tg))],rs);var fy=k(N());var b_=require("vscode");var ar;(r=>{let n=pa(new b_.EventEmitter);r.onDidChangeNotebookCellExecutionState=n.event;function t(i,o,s){if(o!==1||!s){n.fire({cell:i,state:o});return}let a=pa(b_.workspace.onDidChangeNotebookDocument(l=>{if(l.notebook!==i.notebook)return;l.cellChanges.find(u=>u.cell===i)?.cell?.executionSummary?.executionOrder===s&&(a.dispose(),n.fire({cell:i,state:1}))}))}r.changeCellState=t})(ar||={});var Eue=1e3,my=class{constructor(e,t,r){this.serverStorage=e;this.kernelProvider=t;this.disposables=[];this.timeouts=new Set;this.kernelSpecificUpdates=new WeakMap;r.push(this)}dispose(){G(this.disposables),G(Array.from(this.timeouts.values()))}activate(){this.disposables.push(ar.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this))}onDidChangeNotebookCellExecutionState(e){let t=this.kernelProvider.get(e.cell.notebook);if(!t)return;let r=t.kernelConnectionMetadata;if(!Dt(r))return;let i=this.kernelSpecificUpdates.get(t)||new bs(Eue);this.kernelSpecificUpdates.set(t,i),i.trigger(()=>{t.disposed||t.disposing||this.serverStorage.update(r.serverProviderHandle).catch(h)})}};my=v([(0,fy.injectable)(),m(0,(0,fy.inject)(Xt)),m(1,(0,fy.inject)(ye)),m(2,(0,fy.inject)(K))],my);var Ta=k(N()),VE=require("vscode");var Hq=require("vscode"),Mt=class{constructor(e){this._event=new Hq.EventEmitter;this._disableUI=e}get disableUI(){return this._disableUI}set disableUI(e){let t=this._disableUI!==e;this._disableUI=e,t&&this._event.fire()}get onDidChangeDisableUI(){return this._event.event}dispose(){this._event.dispose()}},I_=class extends Mt{constructor(t,r){super(t);this.ignoreTriggeringOnPostInitialized=r}};var wue="last-python-notebook-created",Gq="last-notebook-created",hy=class{constructor(e,t,r,i,o,s){this.configService=e;this.serverConnector=t;this.disposables=r;this.rawKernelSupport=i;this.mementoStorage=o;this.kernelProvider=s;VE.workspace.onDidOpenNotebookDocument(this.onDidOpenNotebook.bind(this),this,r)}activate(){this.checkDateForServerStart(),this.disposables.push(this.kernelProvider.onDidStartKernel(this.kernelStarted,this))}get lastNotebookCreated(){let e=this.mementoStorage.get(Gq);return e?new Date(e):void 0}checkDateForServerStart(){this.shouldAutoStartStartServer(this.lastNotebookCreated)&&this.createServerIfNecessary().catch(h)}shouldAutoStartStartServer(e){if(!e)return!1;let r=new Date().getTime()-e.getTime();return Math.floor(r/(24*3600*1e3))<=7}async createServerIfNecessary(){if(!VE.workspace.isTrusted||this.rawKernelSupport.isSupported)return;let e=new VE.CancellationTokenSource,t=new Mt(!0);try{p.info("Attempting to start a server because of preload conditions ..."),this.configService.getSettings(void 0).disableJupyterAutoStart||await this.serverConnector.connect({resource:void 0,ui:t,token:e.token})}catch(r){p.error("Error starting server in serverPreload: ",r)}finally{t.dispose(),e.dispose()}}onDidOpenNotebook(e){St(e)&&this.createServerIfNecessary().catch(h)}kernelStarted(e){let t=yo(e.kernelConnectionMetadata);this.mementoStorage.update(Gq,Date.now()).then(h,h),t===ge&&this.mementoStorage.update(wue,Date.now()).then(h,h)}};hy=v([(0,Ta.injectable)(),m(0,(0,Ta.inject)(oe)),m(1,(0,Ta.inject)(ax)),m(2,(0,Ta.inject)(K)),m(3,(0,Ta.inject)(_n)),m(4,(0,Ta.inject)(We)),m(4,(0,Ta.named)(di)),m(5,(0,Ta.inject)(ye))],hy);var ko=k(N());var js=k(N());var ns=class extends $e{constructor(e){super("jupyterinstall",e)}};var Nr=require("vscode");var af=class extends xn{constructor(e){super("timeout",y.rawKernelStartFailedDueToTimeout(lt(e)),e)}};var dp=class extends Ml{constructor(t,r,i,o){super(t,i,o);this.stdErr=r}};var gy=class extends xn{constructor(e){super("timeout",y.rawKernelStartFailedDueToTimeoutWaitingForPort(lt(e)),e)}};var ec=class extends xn{constructor(t=-1,r,i){super("kerneldied",y.kernelDied(r.trim()),i);this.exitCode=t;this.stdErr=r}};var lf=class extends xn{constructor(t,r){super("noipykernel",y.kernelInvalid(lt(r)),r);this.reason=t}};var Ra=class extends Ml{constructor(e){super(y.kernelDiedWithoutError(lt(e)),void 0,e)}};var S_=class extends $e{constructor(e){super("jupyterexpiredcert",e)}};var pp=class extends $e{constructor(t){super("invalidremotejupyterserverurihandle","Server handle not in list of known handles");this.serverProviderHandle=t}};var lu=class extends $e{constructor(t,r,i){super("jupyternotebooknotinstalled",t+(r?`
${r}`:""));this.interpreter=i}};var zq=new Map;function C_(n,e){zq.set(Lt(n),e)}function vy(n,e,t){let r=e.jupyterCollections.find(i=>i.extensionId===n.extensionId&&i.id===n.id);return zq.get(Lt(n))||r?.label||t||`${n.id}:${n.handle}`}var by=class{constructor(e,t,r,i,o,s,a){this.dependencyManager=e;this.configuration=t;this.kernelDependency=r;this.serverUriStorage=i;this.jupyterUriProviderRegistration=o;this.fs=s;this.interpreterService=a;this.handledErrors=new WeakSet;this.handledKernelErrors=new WeakSet}async handleError(e){if(p.warn("DataScience Error",e),e=mt.unwrap(e),!this.handledErrors.has(e)){if(this.handledErrors.add(e),e instanceof ns)await this.dependencyManager?.installMissingDependencies(e);else if(e instanceof pi)await ix(this.configuration,e.message);else if(e instanceof S_)await ox(this.configuration,e.message);else if(!Zt(e))if(e instanceof af||e instanceof gy)Nr.window.showErrorMessage(e.message).then(h,h);else if(e instanceof dp||e instanceof ec||e instanceof lu||e instanceof ks)Nr.window.showErrorMessage(yy(e)).then(h,h);else if(e instanceof Fi&&Lr())Nr.window.showErrorMessage(y.jupyterNotebookRemoteConnectFailedWeb(e.baseUrl)).then(h,h);else if(e instanceof Fi){let t=await this.handleJupyterServerConnectionError(e,void 0);Nr.window.showErrorMessage(t).then(h,h)}else if(e instanceof Od){let t=await this.handleJupyterServerUriProviderError(e,void 0);Nr.window.showErrorMessage(t).then(h,h)}else{let t=Qq(e.message||e.toString());Nr.window.showErrorMessage(t).then(h,h)}}}async getErrorMessageForDisplayInCell(e,t,r){return this.getErrorMessageForDisplayInCellImpl(e,t,r,!1)}async getErrorMessageForDisplayInCellOutput(e,t,r){return this.getErrorMessageForDisplayInCellImpl(e,t,r,!0)}async getErrorMessageForDisplayInCellImpl(e,t,r,i){if(e=mt.unwrap(e),Zt(e)||p.error("Error in execution (get message for cell)",e),e instanceof Ra)return"";if(e instanceof lf){let o=this.interpreterService?await this.interpreterService.hasWorkspaceSpecificEnvironment():!1;return wO(e.kernelConnectionMetadata,!o&&!Lr()&&i)||e.message}else{if(e instanceof ns)return xue(e)||e.message;if(e instanceof Fi&&!Lr())return e.message;if(e instanceof Fi&&Lr())return y.jupyterNotebookRemoteConnectFailedWeb(e.baseUrl);if(Zt(e))return"";if(e instanceof Pv){let o=typeof e.product=="string"?e.product:hr.get(e.product)||`${e.product}`,s=Hr(e.interpreter)||e.interpreter.id||"",a=mr(e.interpreter),l=M(a?.executable.uri),c=s?` ${s} (${l})`:l;return y.packageNotInstalledWindowsLongPathNotEnabledError(o,c)}else{if((e instanceof dp||e instanceof ec)&&(e.kernelConnectionMetadata.kind==="startUsingLocalKernelSpec"||e.kernelConnectionMetadata.kind==="startUsingPythonInterpreter")&&e.kernelConnectionMetadata.interpreter&&!await this.fs.exists(e.kernelConnectionMetadata.interpreter.uri))return y.failedToStartKernelDueToMissingPythonEnv(Hr(e.kernelConnectionMetadata.interpreter)||Vo(e.kernelConnectionMetadata.interpreter)||M(e.kernelConnectionMetadata.interpreter.uri));if((e instanceof dp||e instanceof ec)&&(e.kernelConnectionMetadata.kind==="startUsingLocalKernelSpec"||e.kernelConnectionMetadata.kind==="startUsingPythonInterpreter")&&e.kernelConnectionMetadata.interpreter&&this.kernelDependency&&!await this.kernelDependency.areDependenciesInstalled(e.kernelConnectionMetadata,void 0,!0)){let o=this.interpreterService?await this.interpreterService.hasWorkspaceSpecificEnvironment():!1;return wO(e.kernelConnectionMetadata,!o&&!Lr()&&i)||e.message}else if(e instanceof xn||e instanceof Ml){let[o,s]=await Promise.all([this.getFilesInWorkingDirectoryThatCouldPotentiallyOverridePythonModules(r),Ps(e.kernelConnectionMetadata.interpreter)]),a=Sm(Nr.workspace.workspaceFolders||[],e,lt(e.kernelConnectionMetadata),s,o.map(l=>l.uri));if(a){if(a.reason==="moduleNotFound"&&["ipykernel_launcher","ipykernel"].includes(a.moduleName)){let c=this.interpreterService?await this.interpreterService.hasWorkspaceSpecificEnvironment():!1;return wO(e.kernelConnectionMetadata,!c&&!Lr()&&i)||e.message}let l=[a.message];return a.moreInfoLink&&l.push(ce.clickHereForMoreInfoWithHtml(a.moreInfoLink)),at(e.kernelConnectionMetadata)&&a.reason==="moduleNotFound"&&!["ipykernel_launcher","ipykernel"].includes(a.moduleName)&&await this.addErrorMessageIfPythonArePossiblyOverridingPythonModules(l,r),l.join(`
`)}}else{if(e instanceof Fi)return this.handleJupyterServerConnectionError(e,t);if(e instanceof Od)return this.handleJupyterServerUriProviderError(e,t);if(e instanceof pp){let o=Nr.extensions.getExtension(e.serverProviderHandle.extensionId)?.packageJSON.displayName||e.serverProviderHandle.extensionId;return yy(y.remoteJupyterServerProvidedBy3rdPartyExtensionNoLongerValid(o),t)}}}}return yy(e,t)}async handleJupyterServerUriProviderError(e,t){let r=await vy(e.serverProviderHandle,this.jupyterUriProviderRegistration),i=e.originalError?.message||e.message;return yy(y.remoteJupyterConnectionFailedWithServerWithError(r,i),t)}async handleJupyterServerConnectionError(e,t){let r=await vy(e.serverProviderHandle,this.jupyterUriProviderRegistration,e.baseUrl),i=e.originalError.message||"";return yy(y.remoteJupyterConnectionFailedWithServerWithError(r,i),t)}async handleJupyterServerProviderConnectionError(e,t){let r=new Nr.CancellationTokenSource;try{let i=await Promise.resolve(t.serverProvider.provideJupyterServers(r.token));return i&&(i.find(o=>o.id===e.handle)||await this.serverUriStorage.remove(e).catch(h)),!0}catch{return!1}finally{r.dispose()}}async handleKernelError(e,t,r,i,o){if(Zt(e)||p.warn(`Kernel Error, context = ${t}`,e),e=mt.unwrap(e),Zt(e))return this.sendKernelTelemetry(e,t,i,"cancelled"),1;if(e instanceof lf)if(p.warn(`Jupyter Kernel Dependency Error, reason=${e.reason}`,e),this.sendKernelTelemetry(e,t,i,e.category),e.reason===4&&this.kernelDependency){let s=new Nr.CancellationTokenSource;try{let a=o==="3rdPartyExtension";return this.kernelDependency.installMissingDependencies({resource:i,kernelConnection:r,ui:new Mt(!1),token:s.token,ignoreCache:!0,cannotChangeKernels:a})}finally{s.dispose()}}else return e.reason;else{if((t==="start"||t==="restart")&&e instanceof ns)return this.sendKernelTelemetry(e,t,i,e.category),(this.dependencyManager?await this.dependencyManager.installMissingDependencies(e):2)===0?0:1;if(e instanceof Fi||e instanceof Od||e instanceof pp){this.sendKernelTelemetry(e,t,i,e.category);let s=e instanceof pp?"":e instanceof Fi?e.originalError.message||"":e.originalError?.message||e.message,a=e.serverProviderHandle.extensionId,l=e.serverProviderHandle.id,c=this.jupyterUriProviderRegistration.jupyterCollections.find(I=>I.extensionId===a&&I.id==l);if(!c||await this.handleJupyterServerProviderConnectionError(e.serverProviderHandle,c))return 3;let u=e instanceof Fi?e.baseUrl:"",d=vy(e.serverProviderHandle,this.jupyterUriProviderRegistration,u),f=e instanceof pp?Nr.extensions.getExtension(e.serverProviderHandle.extensionId)?.packageJSON.displayName||e.serverProviderHandle.extensionId:"",g=o==="jupyterExtension"?[y.selectDifferentKernel]:[];switch(await Nr.window.showErrorMessage(e instanceof pp?y.remoteJupyterServerProvidedBy3rdPartyExtensionNoLongerValid(f):y.remoteJupyterConnectionFailedWithServer(d),{detail:s,modal:!0},y.removeRemoteJupyterConnectionButtonText,y.changeRemoteJupyterConnectionButtonText,...g)){case y.removeRemoteJupyterConnectionButtonText:return await this.serverUriStorage.remove(e.serverProviderHandle).catch(h),1;case y.changeRemoteJupyterConnectionButtonText:return 1;case y.selectDifferentKernel:return 3}return 1}else if(e instanceof pi){this.sendKernelTelemetry(e,t,i,e.category);let s=y.jupyterSelfCertEnable,a=y.jupyterSelfCertClose;return Nr.window.showErrorMessage(y.jupyterSelfCertFail(e.message),s,a).then(l=>{l===s?(T("DATASCIENCE.SELFCERTSMESSAGEENABLED"),this.configuration.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,Nr.ConfigurationTarget.Workspace).catch(h)):l===a&&T("DATASCIENCE.SELFCERTSMESSAGECLOSE")}).then(h,h),2}else{if((t==="start"||t==="restart")&&r.kind==="startUsingPythonInterpreter"&&this.interpreterService&&!await this.fs.exists(r.interpreter.uri))return this.sendKernelTelemetry(e,t,i,"pythonEnvironmentMissing"),Nr.window.showErrorMessage(y.failedToStartKernelDueToMissingPythonEnv(Hr(r.interpreter)||Vo(r.interpreter)||M(r.interpreter.uri))).then(h,h),this.interpreterService.refreshInterpreters(!0).catch(h),2;if((t==="start"||t==="restart")&&this.kernelDependency&&!await this.kernelDependency.areDependenciesInstalled(r,void 0,!0)){this.sendKernelTelemetry(e,t,i,"noipykernel");let s=new Nr.CancellationTokenSource;try{let a=o==="3rdPartyExtension";return this.kernelDependency.installMissingDependencies({resource:i,kernelConnection:r,ui:new Mt(!1),token:s.token,ignoreCache:!0,cannotChangeKernels:a})}finally{s.dispose()}}else{let[s,a]=await Promise.all([this.getFilesInWorkingDirectoryThatCouldPotentiallyOverridePythonModules(i),Ps(r.interpreter)]),l=Sm(Nr.workspace.workspaceFolders||[],e,lt(r),a,s.map(c=>c.uri));return this.sendKernelTelemetry(e,t,i,l?.reason),l?this.showMessageWithMoreInfo(l.message,l?.moreInfoLink).catch(h):this.showMessageWithMoreInfo(yy(e,t)).catch(h),2}}}}sendKernelTelemetry(e,t,r,i){this.handledKernelErrors.has(e)||(this.handledKernelErrors.add(e),t==="start"&&Ct(r,"DATASCIENCE.NOTEBOOK_START",void 0,{disableUI:!1,failureCategory:i},e))}async showMessageWithMoreInfo(e,t){e.includes(J.ViewJupyterOutput)||(e=`${e} 
${y.viewJupyterLogForFurtherInfo}`);let r=t?[ce.learnMore]:[];await Nr.window.showErrorMessage(e,...r).then(i=>{i===ce.learnMore&&t&&Nr.env.openExternal(Nr.Uri.parse(t))})}};by=v([m(0,(0,js.inject)(Md)),m(0,(0,js.optional)()),m(1,(0,js.inject)(oe)),m(2,(0,js.inject)(go)),m(2,(0,js.optional)()),m(3,(0,js.inject)(Xt)),m(4,(0,js.inject)(Jt)),m(5,(0,js.inject)(nt)),m(6,(0,js.inject)(rt)),m(6,(0,js.optional)())],by);var Pue={restart:y.failedToRestartKernel,start:y.failedToStartKernel,interrupt:y.failedToInterruptKernel,execution:""};function yy(n,e){n=typeof n=="string"?n:mt.unwrap(n);let t=e?Pue[e]:"",r="";return n instanceof lu?r=y.jupyterNotebookNotInstalledOrNotFound(n.interpreter):n instanceof $e?r=Tk(n.stdErr)||n.stdErr||n.message:r=typeof n=="string"?n:n.message,Qq(t,r)}function kue(n){return(new RegExp(/\[([^\[]+)\]\((.*)\)/).exec(n)?.length??0)>0}function Qq(n="",e=""){n&&e.startsWith(n.substring(0,n.length-1))&&(n="");let t=[n,e].map(r=>r.trim()).filter(r=>r.length>0).join(` 
`);return!kue(t)&&t.length&&t.indexOf("command:jupyter.viewOutput")===-1?`${t.endsWith(".")?t:t+"."} 
${y.viewJupyterLogForFurtherInfo}`:t}function wO(n,e){if(n.kind==="connectToLiveRemoteKernel"||n.kind==="startUsingRemoteKernelSpec"||!n.interpreter)return;let t=Hr(n.interpreter)||Ae(n.interpreter.uri),r=hr.get(19),i=hi(19),o=`${gC(Ae(n.interpreter.uri))} -m pip install ${i} -U --force-reinstall`;if(n.interpreter&&Ue(n.interpreter)==="Conda"){let a=mr(n.interpreter);a?.environment?.name?o=`conda install -n ${a?.environment?.name} ${i} --update-deps --force-reinstall`:a?.environment?.folderUri&&(o=`conda install -p ${Ae(a?.environment?.folderUri)} ${i} --update-deps --force-reinstall`)}else n.interpreter&&Ue(n.interpreter)==="Unknown"&&(o=`${gC(Ae(n.interpreter.uri))} -m pip install ${i} -U --user --force-reinstall`);let s=[y.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreter(t,hr.get(19))];return e?B8(n.interpreter)?s.push(y.createANewPythonEnvironment()):(s.push(y.createANewPythonEnvironment()),s.push(y.OrInstallPackageInstructions(r,o))):s.push(y.installPackageInstructions(r,o)),s.join(`
`)}function xue(n){let e=`${hr.get(18)} ${ce.and} ${hr.get(20)}`,t=[18,20].map(hi).join(" "),r=`python -m pip install ${t} -U
or
conda install ${t} -U`,i=y.installPackageInstructions(e,r);return n.message+`
`+i+`
`+ce.clickHereForMoreInfoWithHtml("https://aka.ms/installJupyterForVSCode")}var Iy=class extends by{constructor(t,r,i,o,s,a,l,c){super(t,r,i,o,s,l,c);this.reservedPythonNames=a}async addErrorMessageIfPythonArePossiblyOverridingPythonModules(t,r){let i=await this.getFilesInWorkingDirectoryThatCouldPotentiallyOverridePythonModules(r);if(i.length>0){let o=r?Nn(r):void 0,s=i.map(l=>{if(l.type==="file"){let c=r?M(l.uri,[],o):pr(l.uri);return`<a href='${l.uri.toString()}?line=1'>${c}</a>`}else{let c=r?M(l.uri,[],o):`${pr(Nn(l.uri))}/__init__.py`;return`<a href='${l.uri.toString()}?line=1'>${c}</a>`}}),a="";s.length===1?a=s[0]:a=`${s.slice(0,-1).join(", ")} ${ce.and} ${s.slice(-1)}`,t.push(y.filesPossiblyOverridingPythonModulesMayHavePreventedKernelFromStarting(a)),t.push(y.listOfFilesWithLinksThatMightNeedToBeRenamed(a)),t.push(ce.clickHereForMoreInfoWithHtml(s5))}}async getFilesInWorkingDirectoryThatCouldPotentiallyOverridePythonModules(t){return t?this.reservedPythonNames.getUriOverridingReservedPythonNames(Nn(t)):[]}};Iy=v([(0,ko.injectable)(),m(0,(0,ko.inject)(Md)),m(0,(0,ko.optional)()),m(1,(0,ko.inject)(oe)),m(2,(0,ko.inject)(go)),m(2,(0,ko.optional)()),m(3,(0,ko.inject)(Xt)),m(4,(0,ko.inject)(Jt)),m(5,(0,ko.inject)(wx)),m(6,(0,ko.inject)(nt)),m(7,(0,ko.inject)(rt))],Iy);var w_=k(N());var jE=class{constructor(e,t,r,i){this.moduleName=e;this.args=t;this.pythonExecutionFactory=r;this._interpreter=i;this.interpreterPromise=Promise.resolve(this._interpreter),this.pythonLauncher=this.interpreterPromise.then(async o=>r.createActivatedEnvironment({interpreter:o}))}interpreter(){return this.interpreterPromise}async exec(e,t){let r={...t},i=await this.pythonLauncher,o=[...this.args,...e],s=o[1];return o.shift(),o.shift(),i.execModule(s,o,r)}},PO=class extends jE{constructor(e,t,r,i){super(e,t,r,i)}},kO=class extends jE{constructor(e,t,r,i){super(e,t,r,i)}async exec(e,t){let r,i={stdout:""};try{i=await super.exec(e,t)}catch(a){r=a}if(!i.stderr&&!r)return i;let o=()=>{if(r)throw p.error("Exception attempting to enumerate kernelspecs: ",r),r;return i},s=await this.interpreter();if(!s||this.moduleName.toLowerCase()!=="jupyter"||this.args.join(" ").toLowerCase()!=="-m jupyter kernelspec".toLowerCase())return o();try{if(e.join(" ").toLowerCase()==="list --json")return i=await this.getKernelSpecList(s,t),i;if(e.join(" ").toLowerCase()==="--version")return i=await this.getKernelSpecVersion(s,t),i}catch(a){p.error("Failed to get a list of the kernelspec using python script",a)}return o()}async getKernelSpecList(e,t){return(await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:e})).exec([Ve(Yo,"pythonFiles","vscode_datascience_helpers","getJupyterKernels.py")],{...t,throwOnStdErr:!0})}async getKernelSpecVersion(e,t){return(await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:e})).exec([Ve(Yo,"pythonFiles","vscode_datascience_helpers","getJupyterKernelspecVersion.py")],{...t,throwOnStdErr:!0})}},Sy=class{constructor(e){this.executionFactory=e}createInterpreterCommand(e,t,r,i){return e==="notebook"?new PO(t,r,this.executionFactory,i):e==="kernelspec"?new kO(t,r,this.executionFactory,i):new jE(t,r,this.executionFactory,i)}};Sy=v([(0,w_.injectable)(),m(0,(0,w_.inject)(Vr))],Sy);var BE=k(N());var Yq=require("vscode");var Cy=class{constructor(e,t){this.service=e;this.disposables=t}activate(){this.disposables.push(Yq.commands.registerCommand("jupyter.selectJupyterInterpreter",()=>{this.service.selectInterpreter().catch(h)}))}};Cy=v([(0,BE.injectable)(),m(0,(0,BE.inject)(vi)),m(1,(0,BE.inject)(K))],Cy);var $s=k(N());var nH=k(require("crypto")),Bs=k(N()),Ey=k(Qo());var yr=require("vscode");var Xq=k(Qo()),Zq=require("vscode");async function P_(n){try{let e=await Xq.realpath(n.fsPath);return Ur()!="Windows"&&(e=e.replace(/\\/g,"/")),Zq.Uri.file(e)}catch{return n}}var Aa=require("vscode");var x_="version";function k_(n){return`${x_}-${n.extension.packageJSON.version||"version"}`}async function $E(n,e){if(ol())return Aa.Uri.joinPath(n.globalStorageUri,k_(n));{let t=Aa.Uri.joinPath(Aa.Uri.file(n.globalStorageUri.fsPath),k_(n));if(e)try{await e.createDirectory(t)}catch(r){p.warn(`Failed to create temp directory (${t.fsPath}), falling back to extension dir`,r),t=Aa.Uri.joinPath(n.extensionUri,"temp"),await e.createDirectory(t)}return t}}async function eH(n){try{let e=await Aa.workspace.fs.readDirectory(n.globalStorageUri);await Promise.all(e.filter(([t,r])=>t.startsWith(x_)&&r===Aa.FileType.Directory).map(([t])=>Aa.workspace.fs.delete(Aa.Uri.joinPath(n.globalStorageUri,t),{recursive:!0}))).catch(h)}catch{}}var Due=Ve("AppData","Roaming","jupyter","kernels"),tH=Ve(".local","share","jupyter","kernels"),rH=Ve("Library","Jupyter","kernels"),_ue=Ve("AppData","Roaming","jupyter","runtime"),Tue=Ve("Library","Jupyter","runtime"),iH=Ve("share","jupyter","kernels"),D_="CACHE_KEY_FOR_JUPYTER_KERNELSPEC_ROOT_PATH.",xO="CACHE_KEY_FOR_JUPYTER_KERNEL_PATHS_V2",zr=class{constructor(e,t,r,i,o,s,a){this.platformService=e;this.envVarsProvider=t;this.globalState=i;this.fs=o;this.context=s;this.pythonExecFactory=a;this.cachedDataDirs=new Map;this.runtimeDirIsWritable=!1;this.envVarsProvider.onDidEnvironmentVariablesChange(()=>{this.cachedJupyterPaths=void 0},this,r)}async getKernelSpecTempRegistrationFolder(){let e=zt(await $E(this.context),"jupyter","kernels");return await this.fs.createDirectory(e),e}async getKernelSpecRootPath(){let e=this.getCachedRootPath();return e||this.cachedKernelSpecRootPath?e||this.cachedKernelSpecRootPath:(this.cachedKernelSpecRootPath=(async()=>{let t=this.platformService.homeDir;if(t)return this.platformService.isWindows?P_(zt(t,Due)):this.platformService.isMac?zt(t,rH):zt(t,tH)})(),this.cachedKernelSpecRootPath.then(t=>{p.trace(`Getting Jupyter KernelSpec Root Path ${t?.toString()}`),this.updateCachedRootPath(t)}).catch(h),this.cachedKernelSpecRootPath)}async getRuntimeDir(){let e=await this.getRuntimeDirImpl();if(e)return e;let t=yr.Uri.joinPath(await $E(this.context),"jupyter","runtime");return await Ey.ensureDir(t.fsPath),p.trace(`Using extension runtime directory ${t.fsPath}`),t}async getRuntimeDirImpl(){let e,t=this.platformService.homeDir;if(process.env.JUPYTER_RUNTIME_DIR?e=yr.Uri.file(mn(process.env.JUPYTER_RUNTIME_DIR)):t&&(this.platformService.isWindows?e=await P_(zt(t,_ue)):this.platformService.isMac?e=zt(t,Tue):e=process.env.XDG_RUNTIME_DIR?yr.Uri.file(Ve(process.env.XDG_RUNTIME_DIR,"jupyter","runtime")):zt(t,".local","share","jupyter","runtime")),!e){p.error("Failed to determine Jupyter runtime directory");return}try{if(await this.fs.createDirectory(e),!this.runtimeDirIsWritable){let r=`temp-test-write-access-${nH.randomBytes(20).toString("hex")}.txt`,i=zt(e,r);await Ey.writeFile(i.fsPath,""),await Ey.unlink(i.fsPath).catch(h)}return e}catch(r){p.error(`Failed to create/or verify write access to runtime directory ${e}`,r)}}async getDataDirs(e){let t=e.interpreter?e.interpreter.uri.toString():"";return this.cachedDataDirs.has(t)||this.cachedDataDirs.set(t,this.getDataDirsImpl(e.resource,e.interpreter)),this.cachedDataDirs.get(t)}async getDataDirsImpl(e,t){let r=new Io,i=await this.getJupyterPaths();for(let f of i)f&&!r.has(f)&&r.set(f,r.size);if(t)try{p.ci(`Getting Jupyter Data Dir for ${t.uri.fsPath}`);let f=await this.pythonExecFactory.createActivatedEnvironment({interpreter:t,resource:e}),g=yr.Uri.joinPath(this.context.extensionUri,"pythonFiles","printJupyterDataDir.py"),b=await f.exec([g.fsPath],{});if(b.stdout.trim().length){let I=yr.Uri.file(b.stdout.trim());await this.fs.exists(I)&&(r.has(I)||r.set(I,r.size))}else p.debug(`Got an empty Jupyter Data Dir from ${t.id}, stderr = ${b.stderr}`)}catch(f){p.error(`Failed to get DataDir based on ENABLE_USER_SITE for ${Hr(t)}`,f)}let o;t&&(o=await Ps(t));let s=o?yr.Uri.joinPath(yr.Uri.file(o),"share","jupyter"):void 0,a=this.getSystemJupyterPaths(),l=s?new Ul(a).has(s)?void 0:s:void 0,c=this.getJupyterDataDir(),u=(process.env.JUPYTER_PREFER_ENV_PATH||"no").toLowerCase();return["no","n","false","off","0","0.0"].includes(u)?[c,l].forEach(f=>{f&&!r.has(f)&&r.set(f,r.size)}):[l,c].forEach(f=>{f&&!r.has(f)&&r.set(f,r.size)}),a.forEach(f=>{f&&!r.has(f)&&r.set(f,r.size)}),Array.from(r.entries()).sort((f,g)=>f[1]-g[1]).map(f=>f[0])}getJupyterConfigDir(){return process.env.JUPYTER_CONFIG_DIR?yr.Uri.file(mn(process.env.JUPYTER_CONFIG_DIR)):this.platformService.homeDir?yr.Uri.joinPath(this.platformService.homeDir,".jupyter"):void 0}getSystemJupyterPaths(){if(this.platformService.isWindows){let e=process.env.PROGRAMDATA?mn(process.env.PROGRAMDATA):void 0;return e?[yr.Uri.joinPath(yr.Uri.file(e),"jupyter")]:[]}else return[yr.Uri.file("/usr/local/share/jupyter"),yr.Uri.file("/usr/share/jupyter")]}getJupyterDataDir(){if(process.env.JUPYTER_DATA_DIR)return yr.Uri.file(mn(process.env.JUPYTER_DATA_DIR));if(this.platformService.homeDir)switch(this.platformService.osType){case"OSX":return yr.Uri.joinPath(this.platformService.homeDir,"Library","Jupyter");case"Windows":let e=process.env.APPDATA?yr.Uri.file(mn(process.env.APPDATA)):"";if(e)return yr.Uri.joinPath(e,"jupyter");let t=this.getJupyterConfigDir();return t?yr.Uri.joinPath(t,"data"):yr.Uri.joinPath(this.platformService.homeDir,"Library","Jupyter");default:{let r=process.env.XDG_DATA_HOME?yr.Uri.file(mn(process.env.XDG_DATA_HOME)):yr.Uri.joinPath(this.platformService.homeDir,".local","share");return yr.Uri.joinPath(r,"jupyter")}}}async getKernelSpecRootPaths(e){if(this.cachedKernelSpecRootPaths?.promise&&this.cachedKernelSpecRootPaths.stopWatch.elapsedTime<=6e4)return this.cachedKernelSpecRootPaths.promise;let t=new Me,r=this.getKernelSpecRootPathsImpl(e);this.cachedKernelSpecRootPaths={promise:r,stopWatch:t};let i=e.onCancellationRequested(()=>{this.cachedKernelSpecRootPaths?.promise===r&&(this.cachedKernelSpecRootPaths=void 0)},this);r.then(s=>{this.cachedKernelSpecRootPaths?.promise===r&&s.length&&(this.updateCachedKernelSpecPaths(s).catch(h),this.cachedKernelSpecRootPaths.promise=Promise.resolve(s))}).catch(h),r.finally(()=>i.dispose()).catch(h);let o=this.getCachedKernelSpecPaths();return o.length?o:r}async getKernelSpecRootPathsImpl(e){let t=new Ul,[r,i]=await Promise.all([this.getDataDirs({resource:void 0}),this.getKernelSpecRootPath()]);if(e.isCancellationRequested)return[];for(let o of r){let s=zt(o,"kernels");t.add(s)}if(i&&t.add(i),this.platformService.isWindows)process.env.PROGRAMDATA&&t.add(yr.Uri.file(Ve(process.env.PROGRAMDATA,"jupyter","kernels")));else{let o=this.platformService.isMac?rH:tH;t.add(yr.Uri.file(Ve("/","usr","share","jupyter","kernels"))),t.add(yr.Uri.file(Ve("/","usr","local","share","jupyter","kernels"))),this.platformService.homeDir&&t.add(zt(this.platformService.homeDir,o))}return p.debug(`Kernel Spec Root Paths, ${Array.from(t).map(o=>M(o)).join(", ")}`),Array.from(t)}async getJupyterPaths(e){return this.cachedJupyterPaths=this.cachedJupyterPaths||this.getJupyterPathSubPaths(e),this.cachedJupyterPaths}async getJupyterPathSubPaths(e,t){let r=new Ul,i=await this.envVarsProvider.getEnvironmentVariables(void 0,"RunPythonCode");if(e?.isCancellationRequested)return[];let o=i.JUPYTER_PATH?i.JUPYTER_PATH.split(Qn).map(s=>t?Ve(s,t):s):[];return o.length>0&&(await Promise.all(o.map(async a=>P_(yr.Uri.file(a))))).forEach(a=>{a&&r.add(a)}),p.debug(`Jupyter Paths ${M(t)}: ${Array.from(r).map(s=>M(s))}`),Array.from(r)}getCachedKernelSpecPaths(){return this.globalState.get(xO,[]).map(e=>yr.Uri.parse(e))}async updateCachedKernelSpecPaths(e){let t=this.globalState.get(xO,[]),r=e.map(yr.Uri.toString);t.join(",")!==r.join(",")&&await this.globalState.update(xO,r)}getCachedRootPath(){if(this.globalState.get(D_)){let e=this.globalState.get(D_);if(e)return yr.Uri.parse(e)}}updateCachedRootPath(e){e?this.globalState.update(D_,e.toString()).then(h,h):this.globalState.update(D_,void 0).then(h,h)}};v([ui("getDataDirsImpl",7),m(1,Wc("id"))],zr.prototype,"getDataDirsImpl",1),zr=v([(0,Bs.injectable)(),m(0,(0,Bs.inject)(xr)),m(1,(0,Bs.inject)(Ll)),m(2,(0,Bs.inject)(K)),m(3,(0,Bs.inject)(We)),m(3,(0,Bs.named)(dt)),m(4,(0,Bs.inject)(gr)),m(5,(0,Bs.inject)(tt)),m(6,(0,Bs.inject)(Vr))],zr);var cf=class{constructor(e,t,r,i,o,s,a){this.jupyterInterpreter=e;this.interpreterService=t;this.jupyterDependencyService=r;this.pythonExecutionFactory=i;this.jupyterOutputChannel=o;this.jupyterPaths=s;this.activationHelper=a}async refreshCommands(){}async isNotebookSupported(e){let t=await this.jupyterInterpreter.getSelectedInterpreter(e);return t?this.jupyterDependencyService.areDependenciesInstalled(t,e):!1}async getReasonForJupyterNotebookNotBeingSupported(e){let t=await this.jupyterInterpreter.getSelectedInterpreter(e);if(!t&&(t=await this.interpreterService.getActiveInterpreter(void 0),!t))return y.selectJupyterInterpreter;let r=await this.jupyterDependencyService.getDependenciesNotInstalled(t,e);return r.length===0?"":r.length===1&&r[0]===21?y.jupyterKernelSpecModuleNotFound(t.uri.fsPath):bO(r,t)}async getSelectedInterpreter(e){return this.jupyterInterpreter.getSelectedInterpreter(e)}async startNotebook(e,t){let r=await this.getSelectedInterpreterAndThrowIfNotAvailable(t.token);this.jupyterOutputChannel.appendLine(y.startingJupyterLogMessage(qt(r.uri),e.join(" ")));let i=await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:r}),o={...t};o.token=void 0;let s=await this.activationHelper.getActivatedEnvironmentVariables(void 0,r)||process.env,a=(process.env.JUPYTER_PATH||s.JUPYTER_PATH||"").split(Qn).filter(c=>c.trim().length);a.push(Nn(await this.jupyterPaths.getKernelSpecTempRegistrationFolder()).fsPath),o.env={...s,JUPYTER_PATH:a.join(Qn)},p.trace(`Start Jupyter Notebook with JUPYTER_PATH=${a.join(Qn)}`),p.trace(`Start Jupyter Notebook with PYTHONPATH=${s.PYTHONPATH||""}`);let l=Object.keys(s).filter(c=>c.toLowerCase()==="path");if(l.length){let c=l.map(u=>`${u}=${s[u]}`).join(",");p.trace(`Start Jupyter Notebook with PATH variable. ${c}`)}else p.error("Start Jupyter Notebook without a PATH variable");return i.execModuleObservable("jupyter",["notebook"].concat(e),o)}async getRunningJupyterServers(e){let t=await this.getSelectedInterpreterAndThrowIfNotAvailable(e),r=await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:t}),i={mergeStdOutErr:!0,token:e},o=Ve(Yo,"pythonFiles","vscode_datascience_helpers","getServerInfo.py"),s=await r.exec([o],i),a;try{a=JSON.parse(s.stdout.trim())}catch(l){p.warn("Failed to parse JSON when getting server info out from getServerInfo.py",l);return}return a}async installMissingDependencies(e){return this.jupyterInterpreter.installMissingDependencies(e)}async getSelectedInterpreterAndThrowIfNotAvailable(e){let t=await this.jupyterInterpreter.getSelectedInterpreter(e);if(!t){let r=await this.getReasonForJupyterNotebookNotBeingSupported();throw new ns(r)}return t}};cf=v([(0,$s.injectable)(),m(0,(0,$s.inject)(vi)),m(1,(0,$s.inject)(rt)),m(2,(0,$s.inject)(Ws)),m(3,(0,$s.inject)(Vr)),m(4,(0,$s.inject)(jo)),m(4,(0,$s.named)(Th)),m(5,(0,$s.inject)(zr)),m(6,(0,$s.inject)(Ms))],cf);var __=k(N());var uf=class{constructor(e){this.pythonExecutionFactory=e}async exportNotebookToPython(e,t,r,i){let o=await this.pythonExecutionFactory.createActivatedEnvironment({resource:e,interpreter:t}),s=r?[e.fsPath,"--to","python","--stdout","--template",r]:[e.fsPath,"--to","python","--stdout"];return o.execModule("jupyter",["nbconvert"].concat(s),{throwOnStdErr:!1,encoding:"utf8",token:i}).then(a=>{if(a.stdout==="")throw p.error("nbconvert zero size output"),new Error(a.stderr);return a.stdout})}};v([qv("ExportNotebookToPython")],uf.prototype,"exportNotebookToPython",1),uf=v([(0,__.injectable)(),m(0,(0,__.inject)(Vr))],uf);var JE=k(N());var wy=class{constructor(e,t){this.installer=e;this.commandFactory=t;this.nbconvertInstalledInInterpreter=new Ul}async isNbConvertInstalled(e,t){if(this.nbconvertInstalledInInterpreter.has(e.uri))return!0;let r=!!await this.installer.isInstalled(22,e)&&!!await this.installer.isInstalled(18,e);return r===!0&&this.nbconvertInstalledInInterpreter.add(e.uri),r}async getNbConvertVersion(e,t){let i=await this.commandFactory.createInterpreterCommand("nbconvert","jupyter",["-m","jupyter","nbconvert"],e,!1).exec(["--version"],{throwOnStdErr:!0});return Yk(i.stdout)}};wy=v([(0,JE.injectable)(),m(0,(0,JE.inject)(ji)),m(1,(0,JE.inject)(cy))],wy);var pf=k(N());var Py=require("vscode");var mp=k(N());var sH=require("vscode");var Na=class{constructor(e,t,r,i,o){this.interpreterService=e;this.envActivation=t;this.envVarsService=r;this.customEnvVars=i;this.configService=o}async getEnvironmentVariables(e,t,r,i){let o=r.env&&Object.keys(r.env).length>0?Object.assign({},r.env):void 0,s=(r.language||"").toLowerCase()===ge;if(!t&&r.interpreterPath&&(t=await this.interpreterService.getInterpreterDetails(sH.Uri.file(r.interpreterPath),i).catch(d=>{p.error("Failed to fetch interpreter information for interpreter that owns a kernel",d)})),i?.isCancellationRequested)return;let[a,l]=await Promise.all([this.customEnvVars.getCustomEnvironmentVariables(e,s?"RunPythonCode":"RunNonPythonCode",i).catch(h),t?this.envActivation.getActivatedEnvironmentVariables(e,t,i).catch(d=>{p.error("Failed to get env variables for interpreter, hence no variables for Kernel",d)}):void 0]);if(i?.isCancellationRequested)return;await ro(e,{capturedEnvVars:Object.keys(l||{}).length>0}),!l&&Object.keys(a||{}).length===0&&p.debug("No custom variables nor do we have a conda environment");let c={...process.env};process.platform==="win32"&&(c={},Object.keys(process.env).forEach(d=>{c[d.toUpperCase()]=process.env[d]})),o=o||{},a=a||{};let u={};for(let[d,f]of Object.entries(o||{}))typeof f=="string"&&oH(d,f,process.env)!==f&&(u[d]=f,delete o[d]);s||t?(l=l||a,Object.assign(c,l,o),this.configService.getSettings(void 0).excludeUserSitePackages&&(p.info(`Adding env Variable PYTHONNOUSERSITE to ${M(t?.uri)}`),c.PYTHONNOUSERSITE="True"),s&&(c.PYDEVD_IPYTHON_COMPATIBLE_DEBUGGING="1")):(this.envVarsService.mergeVariables(o,c),this.envVarsService.mergeVariables(a,c));for(let[d,f]of Object.entries(u))c[d]=oH(d,f,c);return c}};Na=v([(0,mp.injectable)(),m(0,(0,mp.inject)(rt)),m(1,(0,mp.inject)(Ms)),m(2,(0,mp.inject)(Fl)),m(3,(0,mp.inject)(Ll)),m(4,(0,mp.inject)(oe))],Na);var Rue=/\${([a-zA-Z]\w*)?([^}\w].*)?}/g;function oH(n,e,t){if(!e.includes("$"))return e;let r=!1,i=e;return i=i.replace(Rue,(o,s,a,l,c)=>l>0&&c[l-1]==="\\"?o:a&&a!==""||!s||s===""?(r=!0,o):t[s]||""),!r&&i!==e&&(p.debug(`${n} value in kernelSpec updated from ${e} to ${i}`),e=i),e.replace(/\\\$/g,"$")}var aH=require("vscode");async function lH(n,e,t){if(!t.interpreter||!Xe(t)||!n.kernel||n.kernel.status==="dead"||n.kernel.status==="terminating"||t.kind!=="startUsingLocalKernelSpec"&&t.kind!=="startUsingPythonInterpreter")return;let r=new Me;try{let i=await gn(n.kernel,`import sys as _VSCODE_sys
print(_VSCODE_sys.executable); del _VSCODE_sys`);if(i.length===0)return;let o=i[0];if(o.name!=="stdout"&&o.output_type!=="stream")return;let s=_s(o.text).trim().toLowerCase(),a=Bo(t.interpreter.uri,aH.Uri.file(s));await ro(e,{interpreterMatchesKernel:a})}catch(i){p.error(`Failed to compare interpreters after ${r.elapsedTime}ms`,i)}}function Aue(n){let e="kernelSpec"in n?n:void 0;if(e?.kind==="startUsingPythonInterpreter")return!0;if(e&&!at(e))return!1;let t=e?e.kernelSpec:n;return T_(t.argv[0])}function cu(n){let e="kernelSpec"in n?n:void 0;if(e?.kind==="startUsingPythonInterpreter")return!0;if(e&&!at(e))return!1;let t=e?e.kernelSpec:n;if(t.language&&t.language.toLowerCase()!==ge||!Aue(n))return!1;let r=t.argv.indexOf("-m");if(r===-1)return!1;let i=t.argv.length-1>=r?t.argv[r+1].toLowerCase():void 0;return i?i.includes("ipykernel_launcher")||i.includes("ipykernel"):!1}function T_(n){return n=Ce(n).trim().toLowerCase(),n==="python"||n==="python3"||n==="python.exe"||n==="python3.exe"}var df=class{constructor(e,t,r,i){this.kernelDependencyService=e;this.fs=t;this.jupyterPaths=r;this.kernelEnvVars=i}async ensureKernelIsUsable(e,t,r,i,o){if(p.debug(`Check if a kernel ${t.id} is usable`),cu(t)&&t.interpreter){let a=await this.kernelDependencyService.installMissingDependencies({resource:e,kernelConnection:t,ui:r,token:i,ignoreCache:!0,cannotChangeKernels:o});switch(a){case 1:case 3:case 2:case 4:throw new lf(a,t);default:break}}var s=void 0;at(t)&&(s=t.kernelSpec.specFile,!s||!await this.fs.exists(Py.Uri.file(s))?s=await this.registerKernel(t,i):t.interpreter&&s&&Ce(it(s)).toLowerCase()!=t.kernelSpec.name.toLowerCase()&&(s=await this.registerKernel(t,i)),t.interpreter&&s?(p.debug(`Updating Kernel Environment for ${t.id} for interpreter ${t.interpreter.id}`),await this.updateKernelEnvironment(e,t,s,i)):p.trace(`Not Updating Kernel Environment for ${t.id}`))}async registerKernel(e,t){let r=await this.jupyterPaths.getKernelSpecTempRegistrationFolder();if(!e.kernelSpec||t.isCancellationRequested||!e.kernelSpec.name)return;let i=zt(r,e.kernelSpec.name,"kernel.json");if(await this.fs.exists(i))return p.info(`Kernel spec file for ${e.id} already exists ${M(i)}`),i.fsPath;let o={...e.kernelSpec};if(e.kernelSpec.specFile&&!Pd(Ae(i),e.kernelSpec.specFile)&&(o.metadata=o.metadata||{},o.metadata={...o.metadata,vscode:{...o.metadata.vscode||{},originalSpecFile:e.kernelSpec.metadata?.vscode?.originalSpecFile||e.kernelSpec.specFile,originalDisplayName:e.kernelSpec.metadata?.vscode?.originalDisplayName||e.kernelSpec.display_name}}),e.interpreter&&(o.metadata={...o.metadata,interpreter:Am(e.interpreter)}),p.info(`RegisterKernel for ${e.id} into ${M(i)}`),p.debug(`RegisterKernel for ${e.id} into ${M(i)} with contents ${JSON.stringify(o)}`),await this.fs.writeFile(i,JSON.stringify(o,void 0,4)),t.isCancellationRequested)return;let s=o.metadata?.vscode?.originalSpecFile||o.metadata?.originalSpecFile;if(s){let a=it(s),l=it(i.fsPath),c=await this.fs.searchLocal("*.*[^json]",a);await Promise.all(c.map(async u=>{let d=Ve(a,u),f=Ve(l,u);await this.fs.copy(Py.Uri.file(d),Py.Uri.file(f))}))}return i.fsPath}async updateKernelEnvironment(e,t,r,i){let o=t.interpreter,s=t.kernelSpec,a=await this.jupyterPaths.getKernelSpecTempRegistrationFolder(),l=s;if(r&&a){let c=Ce(r).toLowerCase()===s.name.toLowerCase()?r:zt(a,s.name,"kernel.json").fsPath;if(!await this.fs.exists(Py.Uri.file(c))){p.warn(`Spec file for ${t.id} does not exist ${c} hence not updating env vars.`);return}let u=Py.Uri.file(c);try{let d=JSON.parse(await this.fs.readFile(u));if(i?.isCancellationRequested||(d.metadata?.interpreter?(cu(s)&&(p.debug(`Python KernelSpec argv[0] updated for ${t.id} from '${d.argv[0]}' to '${M(o.uri)}'`),d.argv[0]=o.uri.fsPath),d.metadata=d.metadata||{},d.metadata.interpreter=o):p.trace(`KernelSpec argv[0] not updated for ${t.id} ('${d.argv[0]}')`),d.env=await this.kernelEnvVars.getEnvironmentVariables(e,o,l),d=gJ(d),await this.fs.writeFile(u,JSON.stringify(d,void 0,2)),p.debug(`Updated kernel spec for ${t.id} with environment variables for ${M(u)}`),i?.isCancellationRequested))return;l.metadata=d.metadata}catch(d){if(i?.isCancellationRequested)return;throw p.error(`Failed to update kernel spec for ${t.id} with environment variables for ${M(u)}`,d),d}}else p.warn(`Either Kernel spec file or root spec file path does not exist for ${t.id}.`)}};v([Zh("Failed to register an interpreter as a kernel")],df.prototype,"registerKernel",1),df=v([(0,pf.injectable)(),m(0,(0,pf.inject)(go)),m(1,(0,pf.inject)(gr)),m(2,(0,pf.inject)(zr)),m(3,(0,pf.inject)(Na))],df);var qE=k(N());var cH=require("vscode");var ky=class{constructor(e,t){this.liveKernelConnectionTracker=e;this.providerRegistration=t}async isValid(e){if(!this.liveKernelConnectionTracker.wasKernelUsed(e))return!1;let t=await this.providerRegistration.jupyterCollections.find(i=>i.extensionId===e.serverProviderHandle.extensionId&&i.id===e.serverProviderHandle.id);if(!t)return p.warn(`Extension ${e.serverProviderHandle.extensionId} may have been uninstalled for provider ${e.serverProviderHandle.id}, handle ${e.serverProviderHandle.handle}`),!1;let r=new cH.CancellationTokenSource;try{let i=await Promise.resolve(t.serverProvider.provideJupyterServers(r.token));return i?i.map(o=>o.id).includes(e.serverProviderHandle.handle)?!0:(p.warn(`Hiding remote kernel ${e.id} for ${t.id} as the remote Jupyter Server ${e.serverProviderHandle.extensionId}:${e.serverProviderHandle.id}:${e.serverProviderHandle.handle} is no longer available`),!1):!1}catch(i){return p.warn(`Failed to fetch remote servers from ${e.serverProviderHandle.extensionId}:${e.serverProviderHandle.id}`,i),!1}finally{r.dispose()}}};ky=v([(0,qE.injectable)(),m(0,(0,qE.inject)(Um)),m(1,(0,qE.inject)(Jt))],ky);var R_=require("vscode"),Js=k(N());var xy=class extends xn{constructor(e){super("timeout",y.jupyterLaunchTimedOut,e)}};var lr=function(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID.bind(crypto);let n=new Uint8Array(16),e=[];for(let t=0;t<256;t++)e.push(t.toString(16).padStart(2,"0"));return function(){crypto.getRandomValues(n),n[6]=n[6]&15|64,n[8]=n[8]&63|128;let r=0,i="";return i+=e[n[r++]],i+=e[n[r++]],i+=e[n[r++]],i+=e[n[r++]],i+="-",i+=e[n[r++]],i+=e[n[r++]],i+="-",i+=e[n[r++]],i+=e[n[r++]],i+="-",i+=e[n[r++]],i+=e[n[r++]],i+="-",i+=e[n[r++]],i+=e[n[r++]],i+=e[n[r++]],i+=e[n[r++]],i+=e[n[r++]],i+=e[n[r++]],i}}();var Dy=class extends Yn{constructor(t,r,i,o,s,a){super();this.interpreterService=t;this.disposableRegistry=r;this.configuration=o;this.notebookStarter=s;this.jupyterInterpreterService=a;this._isDisposing=!1;this.disposableRegistry.push(this.interpreterService.onDidChangeInterpreter(()=>this.onSettingsChanged())),this.disposableRegistry.push(this),R_.workspace.onDidChangeConfiguration(l=>{l.affectsConfiguration("python.dataScience",void 0)&&this.onSettingsChanged()},this,this.disposableRegistry),i.push({dispose:()=>Ts(this)})}dispose(){this._isDisposing||(this._isDisposing=!0,this.cache?this.cache.then(t=>t.dispose()).catch(h).finally(()=>super.dispose()):super.dispose())}async startServer(t,r){if(this.isDisposed||this._isDisposing)throw new Error("Notebook server is disposed");if(!this.cache){let i=this.cache=this.startJupyterWithRetry(t,r);i.catch(o=>{p.error("Failed to start the Jupyter Server",o),this.cache===i&&(this.cache=void 0)})}return this.cache}async refreshCommands(){await this.jupyterInterpreterService?.refreshCommands()}async isJupyterServerSupported(t){return this.jupyterInterpreterService?this.jupyterInterpreterService.isNotebookSupported(t):!1}async getJupyterServerError(){return this.jupyterInterpreterService?this.jupyterInterpreterService.getReasonForJupyterNotebookNotBeingSupported():y.webNotSupported}async getUsableJupyterPython(t){return!this.usablePythonInterpreter&&!this.isDisposed&&!this._isDisposing&&this.jupyterInterpreterService&&(this.usablePythonInterpreter=await Nt(t,this.jupyterInterpreterService.getSelectedInterpreter(t))),this.usablePythonInterpreter}startJupyterWithRetry(t,r){return Nt(r,(async()=>{let o,s=1,a=Math.max(1,this.configuration.getSettings(void 0).jupyterLaunchRetries),l;for(;s<=a&&!this.isDisposed&&!this._isDisposing;){try{return o=await this.startImpl(t,r),p.trace("Connection complete server"),o}catch(c){if(l=c,c instanceof xy&&s<a)p.info("Retry because of wait for idle problem."),o?.dispose(),s+=1;else throw o&&(this.isDisposed||this._isDisposing),c}throw l}throw new Error("Max number of attempts reached")})())}async startImpl(t,r){p.debug("Launching server");let i=this.configuration.getSettings(t),o=i.useDefaultConfigForJupyter,s=await LE(t),a=_l(),l=nx(s,a?zt(a,`${lr()}.txt`):void 0,i);if(!this.notebookStarter)throw new Error("Notebook Starter cannot be undefined");return this.notebookStarter.start(t,o,this.configuration.getSettings(void 0).jupyterCommandLineArguments,R_.Uri.file(l),r)}onSettingsChanged(){this.usablePythonInterpreter=void 0}};Dy=v([(0,Js.injectable)(),m(0,(0,Js.inject)(rt)),m(1,(0,Js.inject)(K)),m(2,(0,Js.inject)(ya)),m(3,(0,Js.inject)(oe)),m(4,(0,Js.inject)(Tx)),m(4,(0,Js.optional)()),m(5,(0,Js.inject)(lp)),m(5,(0,Js.optional)())],Dy);var HE=k(N());var A_=class extends mt{constructor(){super("Python Extension not installed",void 0,"pythonExtension")}};var _y=class{constructor(e,t){this.jupyterServerProvider=e;this.extensionChecker=t;this.startupUi=new Mt(!0)}async connect(e){e.ui.disableUI||(this.startupUi.disableUI=!1);let t=e.ui.onDidChangeDisableUI(()=>{e.ui.disableUI||(this.startupUi.disableUI=!1,t.dispose())});if(e.ui=this.startupUi,this.extensionChecker.isPythonExtensionInstalled)return this.jupyterServerProvider.getOrStartServer(e).finally(()=>t.dispose());throw t.dispose(),this.startupUi.disableUI||await this.extensionChecker.showPythonExtensionInstallRequiredPrompt(),new A_}};_y=v([(0,HE.injectable)(),m(0,(0,HE.inject)(Lg)),m(1,(0,HE.inject)(qe))],_y);var mf=k(N());var N_=class extends $e{constructor(){super("nodeonly",y.webNotSupported)}};var Ty=class{constructor(e,t){this.jupyterServerHelper=e;this.interpreterService=t}async getOrStartServer(e){if(!this.serverPromise){let t=this.serverPromise=this.startServerImpl(e);t.catch(()=>{t===this.serverPromise&&(this.serverPromise=void 0)})}return this.serverPromise}async startServerImpl(e){let t=this.jupyterServerHelper;if(!t)throw new N_;try{if(p.trace("Checking for server usability."),!await this.checkUsable())throw p.trace("Server not usable (should ask for install now)"),new ns(y.jupyterNotSupported(await t.getJupyterServerError()));p.debug("Starting notebook server.");let i=await t.startServer(e.resource,e.token);return bn.throwIfCanceled(e.token),i}catch(r){throw e.token?.isCancellationRequested&&Zt(r)||await t.refreshCommands(),r}}async checkUsable(){try{return this.jupyterServerHelper?!!await this.jupyterServerHelper.getUsableJupyterPython():!0}catch(e){let t=await this.interpreterService.getActiveInterpreter(void 0);if(t){let r=Hr(t)||Ae(t.uri);throw new Error(y.jupyterNotSupportedBecauseOfEnvironment(r,e.toString()))}else throw new ns(y.jupyterNotSupported(this.jupyterServerHelper?await this.jupyterServerHelper.getJupyterServerError():"Error"))}}};Ty=v([(0,mf.injectable)(),m(0,(0,mf.inject)(Kg)),m(0,(0,mf.optional)()),m(1,(0,mf.inject)(rt))],Ty);var uH=k(require("child_process")),uu=k(N()),dH=k(require("os"));var GE=require("vscode");var K_=require("vscode");var Ry=class extends $e{constructor(t,r,i){super("jupytercannotbelaunchedwitheroot",t+(r?`
${r}`:""));this.interpreter=i}};var Nue=new RegExp(mm.UrlPatternRegEx),M_=class{constructor(e,t,r,i,o,s){this.launchResult=e;this.notebookDir=t;this.rootDir=r;this.getServerInfo=i;this.serviceContainer=o;this.interpreter=s;this.startPromise=ne();this.output="";this.subscriptions=[];this.ready=this.startPromise.promise;let l=o.get(oe).getSettings(void 0).jupyterLaunchTimeout;this.launchTimeout=setTimeout(()=>{this.startPromise.completed||this.rejectStartPromise(y.jupyterLaunchTimedOut)},l);let c=0;e.proc&&e.proc.on("exit",u=>c=u||0),this.subscriptions.push(e.out.onDidChange(u=>{p.trace(u.out),this.output+=u.out,mm.HttpPattern.exec(this.output)&&!this.startPromise.completed&&this.getServerInfo().then(d=>this.getJupyterURL(d,this.output)).catch(d=>p.warn("Failed to get server info",d))})),e.out.done.then(()=>this.rejectStartPromise(y.jupyterServerCrashed(c))).catch(u=>this.rejectStartPromise(u))}dispose(){clearTimeout(this.launchTimeout),G(this.subscriptions)}getJupyterURL(e,t){if(e&&e.length>0&&!this.startPromise.completed){let r=e.find(i=>Pd(Ae(this.notebookDir),Ae(K_.Uri.file(i.notebook_dir))));if(r){let i=r.url,o=r.token;this.resolveStartPromise(i,o)}}if(!this.startPromise.completed){let i=Nue.exec(t)?.groups;if(!this.startPromise.completed&&i&&(i.LOCAL||i.IP)){let o=i.LOCAL?i.LOCAL:i.IP,s=`${i.PREFIX}${o}${i.REST}`,a;try{a=new URL(s)}catch(c){p.error(`Failed to parse ${s}`,c),this.rejectStartPromise(y.jupyterLaunchNoURL);return}let l=a.pathname.endsWith("/tree")?a.pathname.replace("/tree",""):a.pathname;this.resolveStartPromise(`${a.protocol}//${a.host}${l}`,`${a.searchParams.get("token")}`)}}}resolveStartPromise(e,t){if(clearTimeout(this.launchTimeout),!this.startPromise.rejected){let r=this.serviceContainer.get(oe),i=this.serviceContainer.get(qc),o=this.serviceContainer.get(Kd),s=HC({handle:"",id:"_builtin.jupyterServerLauncher",extensionId:_e},{baseUrl:e,token:t,displayName:rx(t,e)},i,o,r,this.rootDir,new K_.Disposable(()=>this.launchResult.dispose()));this.startPromise.resolve(s)}}rejectStartPromise(e){if(clearTimeout(this.launchTimeout),!this.startPromise.resolved){e=typeof e=="string"?e:e.message;let t,r=this.output;r.includes("Jupyter command `jupyter-notebook` not found")?t=new lu(e,r,this.interpreter):r.includes("Running as root is not recommended. Use --allow-root to bypass")?t=new Ry(e,r,this.interpreter):t=new ks(e,r,this.interpreter),this.startPromise.reject(t)}}};var Ay=require("vscode");var qs=new Set;function O_(...n){let e=new or;try{let t=new class{async providePortAttributes(r,i){if(n.includes(r.port))return new Ay.PortAttributes(Ay.PortAutoForwardAction.Ignore)}};for(let r of n){let i={portRange:r};e.add(Ay.workspace.registerPortAttributesProvider(i,t))}}catch(t){p.error("Failure in registering port attributes",t)}return e}var Ny=class{constructor(e,t,r,i){this.jupyterInterpreterService=e;this.fs=t;this.serviceContainer=r;this.jupyterOutputChannel=i;this.disposables=[]}dispose(){for(;this.disposables.length>0;){let e=this.disposables.shift();try{e&&e.dispose()}catch{}}}async start(e,t,r,i,o){p.info("Starting Jupyter Server");let s=0,a,l=[],c=ut.reportProgress(e,"NotebookStart");try{let u=this.generateTempDir();u.then(w=>this.disposables.push(w)).catch(h);let d=await this.generateArguments(t,r,u,i.fsPath);bn.throwIfCanceled(o);let[f,g,b]=await Promise.all([this.jupyterInterpreterService.startNotebook(d||[],{throwOnStdErr:!1,encoding:"utf8",token:o}),u,this.jupyterInterpreterService.getSelectedInterpreter(o).catch(()=>{})]);f.proc&&(f.proc.on("exit",w=>s=w),f.out.onDidChange(w=>this.jupyterOutputChannel.append(w.out))),f&&o.onCancellationRequested(()=>{f.dispose()},this,l),p.debug("Waiting for Jupyter Notebook"),a=new M_(f,GE.Uri.file(g.path),i,()=>this.jupyterInterpreterService.getRunningJupyterServers(o),this.serviceContainer,b),bn.throwIfCanceled(o);let I=await Nt(o,a.ready);try{let w=parseInt(new URL(I.baseUrl).port||"0",10);if(w&&!isNaN(w)){let _=O_(w);f.proc&&f.proc.on("exit",()=>{qs.delete(w),_.dispose()}),qs.add(w)}}catch(w){p.error(`Parsing failed ${I.baseUrl}`,w)}return G(l),I}catch(u){throw G(l),Zt(u)||u instanceof ks||u instanceof Ry||u instanceof lu?u:await this.jupyterInterpreterService.isNotebookSupported()?s!==0?new Error(y.jupyterServerCrashed(s)):mt.from(y.jupyterNotebookFailure(u),u):new ns(await this.jupyterInterpreterService.getReasonForJupyterNotebookNotBeingSupported())}finally{c.dispose(),a?.dispose()}}async generateDefaultArguments(e,t,r){let i=[];i.push(Promise.resolve("--no-browser")),i.push(Promise.resolve(this.getNotebookDirArgument(r))),e&&i.push(this.getConfigArgument(t)),i.push(Promise.resolve("--NotebookApp.iopub_data_rate_limit=10000000000.0"));let[o,s]=await Promise.all([Promise.all(i),this.getDockerArguments()]),a=process.env&&process.env.VSCODE_JUPYTER_DEBUG_JUPYTER?["--debug"]:[];return[...o,...s,...a]}async generateCustomArguments(e){return[...["--no-browser","--NotebookApp.iopub_data_rate_limit=10000000000.0","--KernelManager.autorestart=False"],...e]}async generateArguments(e,t,r,i){return!t||t.length===0?this.generateDefaultArguments(e,r,i):this.generateCustomArguments(t)}getNotebookDirArgument(e){return`--notebook-dir="${e.replace(/\\/g,"\\\\")}"`}async getConfigArgument(e){let t=await e,r=Ve(t.path,"jupyter_notebook_config.py");return await this.fs.writeFile(GE.Uri.file(r),""),p.debug(`Generating custom default config at ${r}`),`--config=${r}`}async getDockerArguments(){let e=[];try{let t=await this.fs.readFile(GE.Uri.file("/proc/self/cgroup")).catch(()=>"");return!t.includes("docker")&&!t.includes("kubepods")?e:(e.push("--ip"),e.push("127.0.0.1"),new Promise(r=>{uH.exec("id",{encoding:"utf-8"},(i,o)=>{o&&o.toString().includes("(root)")&&e.push("--allow-root"),r(e)})}))}catch{return e}}async generateTempDir(){let e=GE.Uri.file(Ve(dH.tmpdir(),lr()));return await this.fs.createDirectory(e),{path:Ae(e),dispose:async()=>{let t=0;for(;t<10;)try{await this.fs.delete(e),t=10}catch{t+=1}}}}};Ny=v([(0,uu.injectable)(),m(0,(0,uu.inject)(lp)),m(1,(0,uu.inject)(nt)),m(2,(0,uu.inject)(Ze)),m(3,(0,uu.inject)(jo)),m(3,(0,uu.named)(Th))],Ny);var tc=require("vscode"),ff=k(N());var My=class extends Qt{constructor(t,r){super();this._onDidLoad=this._register(new tc.EventEmitter);this._onDidChangeUri=this._register(new tc.EventEmitter);this._onDidRemoveUris=this._register(new tc.EventEmitter);this._onDidAddUri=this._register(new tc.EventEmitter);this._all=[];r.push(this),this.newStorage=this._register(new DO(t))}get onDidLoad(){return this._onDidLoad.event}get onDidChange(){return this._onDidChangeUri.event}get onDidRemove(){return this._onDidRemoveUris.event}get onDidAdd(){return this._onDidAddUri.event}get all(){return this.updateStore(),this._all}hookupStorageEvents(){this.storageEventsHooked||(this.storageEventsHooked=!0,this._register(this.newStorage.onDidAdd(t=>this._onDidAddUri.fire(t),this)),this._register(this.newStorage.onDidChange(t=>this._onDidChangeUri.fire(t),this)),this._register(this.newStorage.onDidRemove(t=>this._onDidRemoveUris.fire(t),this)))}updateStore(){this.hookupStorageEvents();let t=this._all;return this._all=this.newStorage.getAll(),(t.length!==this._all.length||JSON.stringify(this._all)!==JSON.stringify(t))&&this._onDidLoad.fire(),this._all}async clear(){this.hookupStorageEvents(),await this.newStorage.clear(),this._all=[],this._onDidLoad.fire()}async add(t,r){this.hookupStorageEvents(),p.ci(`setUri: ${t.id}.${t.handle}`);let i={time:r?.time??Date.now(),displayName:"",provider:t};await this.newStorage.add(i),this.updateStore()}async update(t){this.hookupStorageEvents(),await this.newStorage.update(t),this.updateStore()}async remove(t){this.hookupStorageEvents(),await this.newStorage.remove(t),this.updateStore()}};My=v([(0,ff.injectable)(),m(0,(0,ff.inject)(We)),m(0,(0,ff.named)(dt)),m(1,(0,ff.inject)(K))],My);var DO=class{constructor(e){this.memento=e;this._onDidChangeUri=new tc.EventEmitter;this._onDidRemoveUris=new tc.EventEmitter;this._onDidAddUri=new tc.EventEmitter;this.updatePromise=Promise.resolve();this.mementoKey=`MEMENTO_KEY_FOR_STORING_USED_JUPYTER_PROVIDERS_${tc.env.machineId}`}get onDidChange(){return this._onDidChangeUri.event}get onDidRemove(){return this._onDidRemoveUris.event}get onDidAdd(){return this._onDidAddUri.event}dispose(){this._onDidAddUri.dispose(),this._onDidChangeUri.dispose(),this._onDidRemoveUris.dispose()}async add(e){return this.updatePromise=this.updatePromise.then(async()=>{let t=this.getAll(),r=t.find(a=>Lt(a.provider)===Lt(e.provider)),o=[{displayName:e.displayName||r?.displayName||Lt(e.provider),serverHandle:e.provider,time:e.time}].concat(t.sort((a,l)=>l.time-a.time).filter(a=>Lt(a.provider)!==Lt(e.provider)).map(a=>({displayName:a.displayName,serverHandle:a.provider,time:a.time}))),s=o.splice(li.JupyterServerUriListMax);if(await this.memento.update(this.mementoKey,o),r||this._onDidAddUri.fire(e),s.length){let a=s.map(l=>({provider:l.serverHandle,time:l.time,displayName:l.displayName||""}));this._onDidRemoveUris.fire(a.map(l=>l.provider))}this._onDidChangeUri.fire()}).catch(h)}async update(e){let r=this.getAll().find(o=>o.provider.id===e.id&&o.provider.handle===e.handle),i={provider:e,time:Date.now(),displayName:r?.displayName||""};await this.add(i)}async remove(e){await(this.updatePromise=this.updatePromise.then(async()=>{let t=!1;try{let r=this.getAll();if(r.length===0)return;let i=r.filter(s=>s.provider.id!==e.id||s.provider.handle!==e.handle),o=r.filter(s=>s.provider.id===e.id&&s.provider.handle===e.handle);if(i.length===0)await this.clear();else if(o.length){let s=i.map(a=>({displayName:a.displayName,serverHandle:a.provider,time:a.time}));t=!0,await this.memento.update(this.mementoKey,s),this._onDidRemoveUris.fire(o.map(a=>a.provider))}}finally{t||this._onDidRemoveUris.fire([e])}}).catch(t=>p.error(`Failed to remove Server handle ${JSON.stringify(e)}`,t)))}getAll(){let e=this.memento.get(this.mementoKey,[]),t=[];return e.forEach(async r=>{let i=Lt(r.serverHandle),o={time:r.time,displayName:r.displayName||i,provider:r.serverHandle};t.push(o)}),t}async clear(){let e=this.getAll();await this.memento.update(this.mementoKey,[]),e.length&&this._onDidRemoveUris.fire(e.map(t=>t.provider))}};var fp=k(N());var F_="removeKernelUrisAndSessionsUsedByResources",Ky=class{constructor(e,t,r){this.disposables=e;this.uriStorage=t;this.memento=r;this.usedRemoteKernelServerIdsAndSessions={}}activate(){this.usedRemoteKernelServerIdsAndSessions=this.memento.get(F_,{}),this.uriStorage.onDidRemove(this.onDidRemoveServers,this,this.disposables)}wasKernelUsed(e){let t=Lt(e.serverProviderHandle);return t in this.usedRemoteKernelServerIdsAndSessions&&typeof e.kernelModel.id=="string"&&e.kernelModel.id in this.usedRemoteKernelServerIdsAndSessions[t]}trackKernelIdAsUsed(e,t,r){let i=Lt(t);this.usedRemoteKernelServerIdsAndSessions[i]=this.usedRemoteKernelServerIdsAndSessions[i]||{},this.usedRemoteKernelServerIdsAndSessions[i][r]=this.usedRemoteKernelServerIdsAndSessions[i][r]||[];let o=this.usedRemoteKernelServerIdsAndSessions[i][r];o.includes(e.toString())||(o.push(e.toString()),this.memento.update(F_,this.usedRemoteKernelServerIdsAndSessions).then(h,h))}trackKernelIdAsNotUsed(e,t,r){let i=Lt(t);if(!(i in this.usedRemoteKernelServerIdsAndSessions)||!(r in this.usedRemoteKernelServerIdsAndSessions[i]))return;let o=this.usedRemoteKernelServerIdsAndSessions[i][r];!Array.isArray(o)||!o.includes(e.toString())||(o.splice(o.indexOf(e.toString()),1),o.length===0&&delete this.usedRemoteKernelServerIdsAndSessions[i][r],Object.keys(this.usedRemoteKernelServerIdsAndSessions[i]).length===0&&delete this.usedRemoteKernelServerIdsAndSessions[i],this.memento.update(F_,this.usedRemoteKernelServerIdsAndSessions).then(h,h))}onDidRemoveServers(e){e.forEach(t=>{let r=Lt(t);delete this.usedRemoteKernelServerIdsAndSessions[r],this.memento.update(F_,this.usedRemoteKernelServerIdsAndSessions).then(h,h)})}};Ky=v([(0,fp.injectable)(),m(0,(0,fp.inject)(K)),m(1,(0,fp.inject)(Xt)),m(2,(0,fp.inject)(We)),m(2,(0,fp.named)(dt))],Ky);var yf=k(require("node-fetch")),E4=k(S4());var C4=require("vscode");function iF(n){return class extends n{constructor(...r){super(...r);this._onAnyMessage=new C4.EventEmitter;this.onAnyMessage=this._onAnyMessage.event;this.msgChain=Promise.resolve(),this.sendChain=Promise.resolve(),this.receiveHooks=[],this.sendHooks=[]}patchSuperEmit(r){super.emit=r}send(r,i){this.sendHooks?this.sendChain=this.sendChain.then(()=>Promise.all(this.sendHooks.map(o=>o(r,i)))).then(()=>super.send(r,i)):super.send(r,i)}handleEvent(r,i,...o){return i==="message"&&this.receiveHooks.length?(this.msgChain=this.msgChain.then(()=>Promise.all(this.receiveHooks.map(s=>s(o[0])))).then(()=>r(i,...o)).catch(s=>p.error(`Exception while handling messages: ${s}`)),!0):r(i,...o)}emit(r,...i){if(r==="unexpected-response"&&i.length===2){let o=i[1];p.error(`Error in websocket: (${o?.statusCode}) ${o?.statusMessage}, ${o?.path}, Headers = ${JSON.stringify(o?.headers)}`)}return r==="error"&&p.error("Error in websocket",i.length?i[0]:void 0),this.handleEvent((o,...s)=>super.emit(o,...s),r,...i)}addReceiveHook(r){this.receiveHooks.push(r)}removeReceiveHook(r){this.receiveHooks=this.receiveHooks.filter(i=>i!==r)}addSendHook(r){this.sendHooks.push(r)}removeSendHook(r){this.sendHooks=this.sendHooks.filter(i=>i!==r)}}}var w4=k(N());var bi=new Map;var Ly=class{getRequestCtor(e,t,r){class i extends yf.Request{constructor(s,a){super(s,a);let l=this.headers,c=r();Object.keys(c).forEach(f=>l.append(f,c[f].toString())),l.set("Content-Type","application/json");let d=l.append.bind(l);l.append=(f,g)=>{f.toLowerCase()!=="authorization"&&d(f,g)}}}return r&&Object.keys(r()||{}).length?i:yf.Request}getWebsocketCtor(e,t,r){let i=()=>{let s={},a;if(t&&(s={...s,rejectUnauthorized:!1}),e&&(a={Cookie:e}),r){let l=r();a=a?{...a,...l}:l}return a&&(s={...s,headers:a}),s};class o extends iF(E4.default){constructor(a,l){super(a,l,i());let c,u=/.*\/kernels\/(.*)\/.*/.exec(a);u&&u.length>1&&(this.kernelId=u[1]),this.kernelId?(bi.set(this.kernelId,this),this.on("close",()=>{c&&this.timer!==c&&clearInterval(c),bi.get(this.kernelId)===this&&bi.delete(this.kernelId)})):p.error("KernelId not extracted from Kernel WebSocket URL"),c=this.timer=setInterval(()=>this.ping(h),3e4)}}return o}wrapWebSocketCtor(e){class t extends iF(e){constructor(i,o,s){super(i,o,s);let a,l=/.*\/kernels\/(.*)\/.*/.exec(i);l&&l.length>1&&(this.kernelId=l[1]),this.kernelId?(bi.set(this.kernelId,this),this.on("close",()=>{a&&this.timer!==a&&clearInterval(a),bi.get(this.kernelId)===this&&bi.delete(this.kernelId)})):p.error("KernelId not extracted from Kernel WebSocket URL"),a=this.timer=setInterval(()=>this.ping(h),3e4)}}return t}getFetchMethod(){return yf.default}getHeadersCtor(){return yf.Headers}getRequestInit(){return{cache:"no-store",credentials:"same-origin"}}};Ly=v([(0,w4.injectable)()],Ly);var P4=require("https"),k4=k(N());var Uy=class{createHttpRequestAgent(){return new P4.Agent({rejectUnauthorized:!1})}};Uy=v([(0,k4.injectable)()],Uy);var os=k(N());var is=require("vscode");var Wde=["/bin/sh","/bin/bash","/bin/zsh"];function G_(n,e){let t=(n.argv||[]).some(r=>(r=r.toLowerCase(),Wde.some(i=>r.includes(i))));T("DATASCIENCE.KERNEL_SPEC_LANGUAGE",void 0,{language:n.language,kind:e,usesShell:t})}var Wy="remoteKernelSpecCache.json";var Vde=2e3,z_=class extends Yn{constructor(t,r,i,o,s,a,l,c,u,d){super();this.id=t;this.displayName=r;this.env=i;this.cachedRemoteKernelValidator=o;this.kernelProvider=a;this.serverProviderHandle=l;this.jupyterConnection=c;this.fs=u;this.context=d;this._status="idle";this._onDidChangeStatus=new is.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this.promiseMonitor=new ho;this.kernelIdsToHide=new Set;this.kind="remote";this.cache=[];this._onDidChangeKernels=new is.EventEmitter;this.onDidChangeKernels=this._onDidChangeKernels.event;this._onDidChange=new is.EventEmitter;this.onDidChange=this._onDidChange.event;this.cacheFile=is.Uri.joinPath(d.globalStorageUri,Wy),this.cacheKey=Lt(l),this._register(s.registerKernelFinder(this)),this._register(this._onDidChangeKernels.event(()=>this._onDidChange.fire(),this)),this._register(this._onDidChangeKernels),this._register(this._onDidChange),this._register(this._onDidChangeStatus),this._register(this.promiseMonitor)}get status(){return this._status}set status(t){this._status!==t&&(this._status=t,this._onDidChangeStatus.fire())}get lastError(){return this._lastError}get kernels(){return this.cache}get items(){return this.kernels}get title(){return this.displayName}dispose(){super.dispose(),this._cacheUpdateCancelTokenSource?.dispose(),this.kernelDisposeDelayTimer?.dispose()}async activate(){this.promiseMonitor.onStateChange(()=>{this.status=this.promiseMonitor.isComplete?"idle":"discovering"}),this.loadCache().then(h,h),this._register(this.kernelProvider.onDidStartKernel(t=>{Dt(t.kernelConnectionMetadata)&&this.updateCache().then(h,h)},this)),this._register(this.kernelProvider.onDidDisposeKernel(t=>{if(t&&Dt(t.kernelConnectionMetadata)){this.kernelDisposeDelayTimer?.dispose();let r=setTimeout(()=>{this.updateCache().then(h,h)},Vde);return this.kernelDisposeDelayTimer=new is.Disposable(()=>clearTimeout(r)),r}},this))}async refresh(){await this.loadCache(!0,!0)}getListOfKernelsWithCachedConnection(t,r=!1){return(!this.cachedConnection||r)&&(this.cachedConnection=this.getRemoteConnectionInfo(t)),this.cachedConnection.then(i=>i?(this.cachedConnection=Promise.resolve(i),this.listKernelsFromConnection(i)):Promise.resolve([])).catch(i=>this.isDisposed?Promise.reject(i):r?(this.cachedConnection=void 0,Promise.reject(i)):this.getListOfKernelsWithCachedConnection(t,!0))}async loadCache(t=!1,r=!1){p.ci(`Remote Kernel Finder load cache Server: ${this.id}`);let i=(async()=>{let o=t?[]:await this.getFromCache(),s=[];if(!t&&Array.isArray(o)&&o.length>0)s=o,this.updateCache().then(h,h),this.loadCache(!0).then(h,h);else try{s=await this.getListOfKernelsWithCachedConnection(r),this._lastError=void 0}catch(a){a instanceof is.CancellationError||(p.error("UniversalRemoteKernelFinder: Failed to get kernels without cache",a),this._lastError=a,this._onDidChange.fire())}await this.writeToCache(s)})();this.promiseMonitor.push(i),await i}async updateCache(){let t=(async()=>{let r=[];this._cacheUpdateCancelTokenSource?.dispose();let i=new is.CancellationTokenSource;this._cacheUpdateCancelTokenSource=i;try{r=await this.getListOfKernelsWithCachedConnection(!1)}catch(o){p.warn(`Could not fetch kernels from the ${this.kind} server, falling back to cache: ${o}`),r=await this.getFromCache(i.token),r=r.filter(s=>s.kind==="connectToLiveRemoteKernel")}i.token.isCancellationRequested||await this.writeToCache(r)})();this.promiseMonitor.push(t),await t}async getRemoteConnectionInfo(t=!0){let r=[];return t&&r.push(ut.createProgressReporter(void 0,y.connectingToJupyter)),this.jupyterConnection.createConnectionInfo(this.serverProviderHandle).finally(()=>G(r))}async getFromCache(t){try{if(t?.isCancellationRequested)throw new is.CancellationError;let r=this.cache;(!r||r.length===0)&&(r=await this.getCacheContents());let i=[],o=Promise.all(r.map(async s=>{await this.isValidCachedKernel(s)&&i.push(s)}));return await Rt(t,o),i}catch(r){p.error("UniversalRemoteKernelFinder: Failed to get from cache",r)}return[]}async getCacheContents(){try{let t=await this.fs.readFile(this.cacheFile),r=JSON.parse(t);if(r.extensionVersion!==this.env.extensionVersion)return[];let i=r.data[this.cacheKey]||[];return Array.isArray(i)?i.map(o=>As.fromJSON(o)):[]}catch{return[]}}async listKernelsFromConnection(t){let r=[];try{let i=Fd.create(t.settings);r.push({dispose:()=>Ts(i)});let[o,s,a,l]=await Promise.all([i.getRunningKernels(),i.getKernelSpecs(),i.getRunningSessions(),z$(t.serverProviderHandle)]),c=s.map(f=>(G_(f,"remote"),zC.create({kernelSpec:f,id:Oi(f,void 0,l),baseUrl:t.baseUrl,serverProviderHandle:t.serverProviderHandle})));return[...a.map(f=>{let g=f.kernel,b=g.last_activity?new Date(Date.parse(g.last_activity.toString())):new Date,I=g.connections?parseInt(g.connections.toString(),10):0,w=o.find(R=>R.id===f.kernel?.id)||{},_=s.find(R=>R.name===f.kernel?.name)||{};return GC.create({kernelModel:{...f.kernel,..._,...w,name:f.kernel?.name||"",lastActivityTime:b,numberOfConnections:I,model:f},baseUrl:t.baseUrl,id:f.kernel?.id||"",serverProviderHandle:t.serverProviderHandle})}).filter(f=>!this.kernelIdsToHide.has(f.kernelModel.id||"")),...c]}catch(i){throw p.error(`Error fetching kernels from ${t.baseUrl} (${t.displayName}):`,i),i}finally{await Promise.all(r.map(i=>i.dispose().catch(h)))}}async writeToCache(t){try{p.trace(`UniversalRemoteKernelFinder: Writing ${t.length} remote kernel connection metadata to cache`);let r=this.cache,i=new Map(r.map(f=>[f.id,f])),o=new Map(t.map(f=>[f.id,f])),s=t.filter(f=>!i.has(f.id)),a=t.filter(f=>i.has(f.id)&&!ua(f,i.get(f.id))),l=r.filter(f=>!o.has(f.id)),c=this.cacheKey;this.cache=r.filter(f=>o.has(f.id)).concat(s),this.cache.forEach(f=>{let g=o.get(f.id);f!==g&&g.kind==="connectToLiveRemoteKernel"&&f.kind==="connectToLiveRemoteKernel"&&f.updateModel(g.kernelModel)});let u=t.map(f=>f.toJSON()),d={extensionVersion:this.env.extensionVersion,data:{}};try{let f=await this.fs.readFile(this.cacheFile),g=JSON.parse(f);g.extensionVersion===this.env.extensionVersion&&(d=g)}catch{}d.data[c]=u,await this.fs.createDirectory(this.context.globalStorageUri).then(()=>this.fs.writeFile(this.cacheFile,JSON.stringify(d))).catch(f=>{p.error("Failed to cache the remote kernels.",f)}),(s.length||a.length||l.length)&&this._onDidChangeKernels.fire({removed:l})}catch(r){p.error("UniversalRemoteKernelFinder: Failed to write to cache",r)}}async isValidCachedKernel(t){switch(t.kind){case"startUsingRemoteKernelSpec":return!1;case"connectToLiveRemoteKernel":return this.cachedRemoteKernelValidator.isValid(t)}}};var Q_=require("vscode");var hu=class{constructor(e,t,r,i,o,s,a,l,c,u){this.serverUriStorage=e;this.env=t;this.cachedRemoteKernelValidator=r;this.kernelFinder=i;this.kernelProvider=o;this.jupyterConnection=s;this.disposables=a;this.fs=l;this.context=c;this.jupyterServerProviderRegistry=u;this.serverFinderMapping=new Map;this.handledProviders=new WeakSet;this.mappedProviders=new WeakSet;this.mappedServers=new Set}activate(){this.serverUriStorage.onDidAdd(e=>this.validateAndCreateFinder(e),this,this.disposables),this.serverUriStorage.onDidChange(this.buildListOfFinders,this,this.disposables),this.serverUriStorage.onDidLoad(this.handleProviderChanges,this,this.disposables),this.serverUriStorage.onDidLoad(this.buildListOfFinders,this,this.disposables),this.jupyterServerProviderRegistry.onDidChangeCollections(this.handleProviderHandleChanges,this,this.disposables),this.serverUriStorage.onDidRemove(this.urisRemoved,this,this.disposables),this.jupyterServerProviderRegistry.onDidChangeCollections(this.handleProviderChanges,this,this.disposables),this.buildListOfFinders(),this.handleProviderChanges().catch(h)}buildListOfFinders(){this.serverUriStorage.all.map(e=>this.validateAndCreateFinder(e).catch(h))}handleProviderHandleChanges(){this.jupyterServerProviderRegistry.jupyterCollections.forEach(e=>{this.handledProviders.has(e)||(this.handledProviders.add(e),e.serverProvider.onDidChangeServers&&e.serverProvider.onDidChangeServers(this.buildListOfFinders,this,this.disposables))}),this.buildListOfFinders()}async handleProviderChanges(){if(!this.serverUriStorage.all.length)return;let e=new Q_.CancellationTokenSource;this.disposables.push(e),await Promise.all(this.jupyterServerProviderRegistry.jupyterCollections.map(t=>{let r=t.serverProvider;if(!(!r||this.mappedProviders.has(r)))return this.mappedProviders.add(r),r?.onDidChangeServers&&r?.onDidChangeServers(()=>this.lookForServersInCollectionAndRemoveOldServers(t),this,this.disposables),this.serverUriStorage.onDidLoad(()=>this.lookForServersInCollectionAndRemoveOldServers(t),this,this.disposables),this.lookForServersInCollectionAndRemoveOldServers(t).catch(h)})),e.dispose()}async lookForServersInCollectionAndRemoveOldServers(e){if(!this.serverUriStorage.all.length)return;let t=new Set(this.serverUriStorage.all.map(o=>Lt(o.provider))),r=e.serverProvider;if(!r)return;let i=new Q_.CancellationTokenSource;try{let o=await Promise.resolve(r.provideJupyterServers(i.token)),s=new Set;(o||[]).forEach(a=>{let l={extensionId:e.extensionId,handle:a.id,id:e.id},c=Lt(l);s.add(c),C_(l,a.label),!(this.mappedServers.has(c)||!t.has(c))&&(this.mappedServers.add(c),this.createRemoteKernelFinder(l,a.label))}),this.serverFinderMapping.forEach((a,l)=>{a.serverProviderHandle.extensionId===e.extensionId&&a.serverProviderHandle.id===e.id&&!s.has(Lt(a.serverProviderHandle))&&(a.dispose(),this.serverFinderMapping.delete(l))})}catch(o){p.error(`Failed to get servers for Collection ${e.id} in ${e.extensionId}`,o)}finally{i.dispose()}}async validateAndCreateFinder(e){let t=Lt(e.provider);if(this.serverFinderMapping.has(t))return;let r=new Q_.CancellationTokenSource,i=async()=>{let s=this.jupyterServerProviderRegistry.jupyterCollections.find(c=>c.extensionId===e.provider.extensionId&&c.id===e.provider.id);if(!s||!s.serverProvider)return;let l=(await Promise.resolve(s.serverProvider.provideJupyterServers(r.token)))?.find(c=>c.id===e.provider.handle)?.label;l&&this.createRemoteKernelFinder(e.provider,l)},o=async()=>{let s=await this.jupyterServerProviderRegistry.jupyterCollections.find(a=>a.extensionId===e.provider.extensionId&&a.extensionId===il&&a.id===e.provider.id)?.label;s&&this.createRemoteKernelFinder(e.provider,s)};await Promise.all([i().catch(h),o().catch(h)]),r.dispose()}getOrCreateRemoteKernelFinder(e,t){let r=Lt(e);if(!this.serverFinderMapping.has(r)){let i=new z_(`remote-${r}`,t,this.env,this.cachedRemoteKernelValidator,this.kernelFinder,this.kernelProvider,e,this.jupyterConnection,this.fs,this.context);this.disposables.push(i),this.serverFinderMapping.set(r,i),i.activate().then(h,h)}return this.serverFinderMapping.get(r)}createRemoteKernelFinder(e,t){this.getOrCreateRemoteKernelFinder(e,t)}urisRemoved(e){e.forEach(t=>{let r=Lt(t),i=this.serverFinderMapping.get(r);i&&i.dispose(),this.serverFinderMapping.delete(r)})}dispose(){this.serverFinderMapping.forEach(e=>e.dispose())}};v([Yr("Handle Jupyter Provider Changes")],hu.prototype,"handleProviderChanges",1),v([Yr("Check Servers in Jupyter Server Provider")],hu.prototype,"lookForServersInCollectionAndRemoveOldServers",1),v([Yr("Failed to create a Remote Kernel Finder")],hu.prototype,"validateAndCreateFinder",1),hu=v([(0,os.injectable)(),m(0,(0,os.inject)(Xt)),m(1,(0,os.inject)(Vl)),m(2,(0,os.inject)(Rx)),m(3,(0,os.inject)(Ar)),m(4,(0,os.inject)(ye)),m(5,(0,os.inject)(un)),m(6,(0,os.inject)(K)),m(7,(0,os.inject)(nt)),m(8,(0,os.inject)(tt)),m(9,(0,os.inject)(Jt))],hu);var vp=k(N());var iT=require("vscode");var oc=k(N());var Y_=class extends $e{constructor(t){super("localjupyterserverconnection",y.jupyterNotebookFailure(t.message||t.toString()));this.originalError=t}};function jy(n){if(Rr()){let e=n;if(e&&e._futures){let t=e._futures;t.forEach&&t.forEach(r=>{r._status!==void 0&&(r._status|=4)})}e&&e._reconnectLimit&&(e._reconnectLimit=0)}}var Vy=class extends mt{constructor(e){super(e.message,e)}};var ZE=require("vscode");var bf=class extends xn{constructor(e){super("invalidkernel",y.kernelInvalid(lt(e)),e)}};async function By(n,e,t,r,i){if(!t.kernel)throw new bf(n);let o=ut.reportProgress(e,y.waitingForJupyterSessionToBeIdle),s=[];o&&s.push(o);try{p.trace(`Waiting for idle on (kernel): ${t.kernel.id} -> ${t.kernel.status}`);let a=ne();i.onCancellationRequested(()=>a.reject(new ZE.CancellationError),void 0,s);let l=(f,g)=>{p.trace(`Got status ${g} in waitForIdleOnSession`),g=="idle"&&a.resolve(g)};t.kernel.statusChanged?.connect(l),s.push(new ZE.Disposable(()=>ci(()=>t.kernel?.statusChanged?.disconnect(l)))),t.kernel.status=="idle"&&a.resolve(t.kernel.status);let c=ne(),u=()=>c.resolve("");t.disposed.connect(u,c),s.push(new ZE.Disposable(()=>ci(()=>t.disposed.disconnect(u,c)))),c.promise.catch(h),a.promise.catch(h);let d=await Bt(r,"",a.promise,c.promise);if(t.isDisposed)throw p.error("Session disposed while waiting for session to be idle."),new bf(n);if(p.trace(`Finished waiting for idle on (kernel): ${t.kernel.id} -> ${t.kernel.status}`),d=="idle")return;throw p.error(`Shutting down after failing to wait for idle on (kernel): ${t.kernel.id} -> ${t.kernel.status}`),new xy(n)}catch(a){throw p.ci("Error waiting for idle",a),a}finally{G(s)}}var nT=require("vscode");var Ma=k(tT()),oF=require("vscode");var $y=class extends Yn{constructor(t,r){super();this.kind=t;this.session=r;this.propertyChanged=new Ma.Signal(this);this.kernelChanged=new Ma.Signal(this);this.statusChanged=new Ma.Signal(this);this.connectionStatusChanged=new Ma.Signal(this);this.iopubMessage=new Ma.Signal(this);this.unhandledMessage=new Ma.Signal(this);this.anyMessage=new Ma.Signal(this);this.pendingInput=new Ma.Signal(this);this.disposed=new Ma.Signal(this);this.didShutdown=this._register(new oF.EventEmitter);this._onDidKernelSocketChange=this._register(new oF.EventEmitter);r.propertyChanged.connect(this.onPropertyChanged,this),r.kernelChanged.connect(this.onKernelChanged,this),r.statusChanged.connect(this.onStatusChanged,this),r.connectionStatusChanged.connect(this.onConnectionStatusChanged,this),r.iopubMessage.connect(this.onIOPubMessage,this),r.unhandledMessage.connect(this.onUnhandledMessage,this),r.pendingInput.connect(this.onPendingInput,this),r.anyMessage.connect(this.onAnyMessage,this),this._register({dispose:()=>{this.session.propertyChanged.disconnect(this.onPropertyChanged,this),this.session.kernelChanged.disconnect(this.onKernelChanged,this),this.session.statusChanged.disconnect(this.onStatusChanged,this),this.session.connectionStatusChanged.disconnect(this.onConnectionStatusChanged,this),this.session.iopubMessage.disconnect(this.onIOPubMessage,this),this.session.unhandledMessage.disconnect(this.onUnhandledMessage,this),this.session.pendingInput.disconnect(this.onPendingInput,this),this.session.anyMessage.disconnect(this.onAnyMessage,this)}})}get id(){return this.session.id}get path(){return this.session.path}get name(){return this.session.name}get type(){return this.session.type}get serverSettings(){return this.session.serverSettings}get model(){return this.session.model}get kernel(){return this.isDisposed||!this.session.kernel?null:this.session.kernel}get onDidShutdown(){return this.didShutdown.event}get kernelId(){return this.session?.kernel?.id||""}get onDidKernelSocketChange(){return this._onDidKernelSocketChange.event}dispose(){this.isDisposed||(super.dispose(),this.statusChanged.emit("dead"),this.disposed.emit(),Ma.Signal.disconnectAll(this))}async restart(){await this.session.kernel?.restart(),this.initializeKernelSocket(),p.info(`Restarted ${this.session?.kernel?.id}`)}initializeKernelSocket(){if(!this.session.kernel)throw new Error("Kernel not initialized in Session");let t={kernel:this.session.kernel,options:{clientId:this.session.kernel.clientId,id:this.session.kernel.id,model:{...this.session.kernel.model},userName:this.session.kernel.username},socket:bi.get(this.session.kernel.id)};JSON.stringify(this.previousKernelSocketInformation?.kernel.model)===JSON.stringify(t.kernel.model)&&this.previousKernelSocketInformation?.kernel===t.kernel&&this.previousKernelSocketInformation?.kernel.id===t.kernel.id&&this.previousKernelSocketInformation?.socket===t.socket||(this.previousKernelSocketInformation=t,this.session.kernel?.connectionStatusChanged.disconnect(this.onKernelConnectionStatusHandler,this),this.session.kernel?.connectionStatusChanged.connect(this.onKernelConnectionStatusHandler,this),this._onDidKernelSocketChange.fire())}onPropertyChanged(t,r){this.propertyChanged.emit(r)}onKernelChanged(t,r){this.kernelChanged.emit(r)}onStatusChanged(t,r){this.statusChanged.emit(r);let i=this.status;p.ci(`Server Status = ${i}`)}onConnectionStatusChanged(t,r){this.connectionStatusChanged.emit(r)}onIOPubMessage(t,r){this.iopubMessage.emit(r)}onUnhandledMessage(t,r){p.warn(`Unhandled message found: ${r.header.msg_type}`),this.unhandledMessage.emit(r)}onAnyMessage(t,r){this.anyMessage.emit(r)}onPendingInput(t,r){this.pendingInput.emit(r)}setPath(t){return this.session.setPath(t)}setName(t){return this.session.setName(t)}setType(t){return this.session.setType(t)}changeKernel(t){return this.session.changeKernel(t)}onKernelConnectionStatusHandler(t,r){p.ci(`Server Kernel Status = ${r}`)}};var rT=class extends $y{constructor(t,r,i,o,s){super(at(i)?"localJupyter":"remoteJupyter",t);this.resource=r;this.kernelConnectionMetadata=i;this.kernelService=o;this.creator=s;this.isShuttingDown=!1;this.initializeKernelSocket()}get status(){return this.isDisposed?"dead":this.session?.kernel?this.session.kernel.status:(p.ci(`Kernel status not started because real session is ${this.session?"defined":"undefined"} & real kernel is ${this.session?.kernel?"defined":"undefined"}`),"unknown")}dispose(){this.restartToken?.cancel(),this.restartToken?.dispose(),this.shutdownImplementation(!1).finally(()=>super.dispose())}async waitForIdle(t,r){try{await By(this.kernelConnectionMetadata,this.resource,this.session,t,r)}catch(i){throw p.ci("Error waiting for idle",i),await this.shutdown().catch(h),i}}async restart(){let t=[],r=new nT.CancellationTokenSource;this.restartToken=r;let i=new Mt(!1);t.push(i),t.push(r);try{await this.validateLocalKernelDependencies(r.token,i),await super.restart()}finally{G(t)}}async validateLocalKernelDependencies(t,r){if(!(!this.kernelConnectionMetadata?.interpreter||!at(this.kernelConnectionMetadata)||!this.kernelService)){if(t.isCancellationRequested)throw new nT.CancellationError;await this.kernelService.ensureKernelIsUsable(this.resource,this.kernelConnectionMetadata,r,t,this.creator==="3rdPartyExtension")}}async shutdown(){return this.restartToken?.cancel(),this.restartToken?.dispose(),this.shutdownImplementation(!0)}async shutdownImplementation(t){if(this.isDisposed||this.isShuttingDown)return;this.isShuttingDown=!0;let r=(new Error().stack||"").split(`
`).filter(o=>o.includes(_e));p.trace(`Shutdown session - current session, called from 
 ${r.map(o=>`    ${o}`).join(`
`)}`);let i=`${this.session.kernel?.id}, ${this.kernelConnectionMetadata.id}`;p.debug(`shutdownSession ${i} - start`);try{if(t||this.canShutdownSession())try{p.debug(`Session can be shutdown ${this.kernelConnectionMetadata.id}`),jy(this.session.kernel),this.session.isDisposed||await Bt(1e3,this.session.shutdown().catch(h))}catch{try{this.session.isDisposed||this.session.dispose()}catch(o){p.warn("Failures in disposing the session",o)}}finally{this.didShutdown.fire()}else p.debug(`Session cannot be shutdown ${this.kernelConnectionMetadata.id}`);try{this.session.isDisposed||this.session.dispose()}catch(o){p.warn("Failures in disposing the session",o)}super.dispose(),p.trace("Shutdown session -- complete")}catch(o){p.warn("Failures in disposing the session",o)}p.debug(`shutdownSession ${i} - shutdown complete`)}canShutdownSession(){return at(this.kernelConnectionMetadata)?!0:this.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel"?!1:this.resource&&to(this.resource)==="interactive"?!0:!(this.resource&&to(this.resource)==="notebook"&&Dt(this.kernelConnectionMetadata))}};var gu=class{constructor(e,t,r,i,o){this.jupyterNotebookProvider=e;this.jupyterConnection=t;this.asyncDisposables=r;this.kernelService=i;this.configService=o}async create(e){let t=[],r,i=()=>{e.ui.disableUI||r||(r=ut.createProgressReporter(e.resource,Dt(e.kernelConnection)?y.connectingToJupyter:y.startingJupyter),t.push(r))};e.ui.disableUI&&e.ui.onDidChangeDisableUI(i,this,t),i();let o,s=[],a=this.configService.getSettings(e.resource).jupyterLaunchTimeout;try{o=Dt(e.kernelConnection)?await Nt(e.token,this.jupyterConnection.createConnectionInfo(e.kernelConnection.serverProviderHandle)):await this.jupyterNotebookProvider.getOrStartServer({resource:e.resource,token:e.token,ui:e.ui}),await Nt(e.token,this.validateLocalKernelDependencies(e));let l=Fd.create(o.settings);this.asyncDisposables.push({dispose:()=>Ts(l)}),s.push(l),await Nt(e.token,this.validateRemoteServer(e,l));let c=await this.connectToOrCreateSession({...e,contentsManager:l.contentsManager,sessionManager:l.sessionManager,kernelManager:l.kernelManager,kernelSpecManager:l.kernelSpecManager,idleTimeout:a,connection:o});e.token.isCancellationRequested&&(await c.shutdown().catch(h),ci(()=>c.dispose())),bn.throwIfCanceled(e.token),p.info(`Started session for kernel ${e.kernelConnection.kind}:${e.kernelConnection.id}`);let u=new rT(c,e.resource,e.kernelConnection,this.kernelService,e.creator),d=c.disposed,f=()=>{l.dispose(),d.disconnect(f)};this.asyncDisposables.push({dispose:()=>u.shutdown().finally(()=>u.dispose())}),c.disposed.connect(f);let g=u.onDidDispose(f);return this.asyncDisposables.push(g),u}catch(l){throw G(s),Dt(e.kernelConnection)?o?pi.isSelfCertsError(l)?new pi(`${o.baseUrl}, ${l.message}`):Nl.isSelfCertsExpiredError(l)?new Nl(o.baseUrl):new Fi(o.baseUrl,e.kernelConnection.serverProviderHandle,l):l:l instanceof $e?l:new Y_(l)}finally{G(t)}}async validateRemoteServer(e,t){if(t.isDisposed)throw new hn;if(!at(e.kernelConnection))try{await Promise.all([t.getRunningKernels(),t.getKernelSpecs()])}catch(r){throw p.error("Failed to fetch running kernels from remote server, connection may be outdated or remote server may be unreachable",r),new Fi(e.kernelConnection.baseUrl,e.kernelConnection.serverProviderHandle,r)}}async validateLocalKernelDependencies(e){if(e.token.isCancellationRequested)throw new iT.CancellationError;e.kernelConnection?.interpreter&&at(e.kernelConnection)&&this.kernelService&&await this.kernelService.ensureKernelIsUsable(e.resource,e.kernelConnection,e.ui,e.token,e.creator==="3rdPartyExtension")}async connectToOrCreateSession(e){if(e.token.isCancellationRequested)throw new iT.CancellationError;let t;try{if(e.kernelConnection&&e.kernelConnection.kind==="connectToLiveRemoteKernel"&&e.kernelConnection.kernelModel.id&&e.kernelConnection.kernelModel.model){if(!e.kernelConnection.kernelModel.model)throw new Error("Kernel model not defined when connecting to an existing session");t=e.sessionManager.connectTo({...e.kernelConnection.kernelModel,model:e.kernelConnection.kernelModel.model}),await Nt(e.token,kP(async()=>t.kernel?.connectionStatus==="connected"||e.token.isCancellationRequested,e.idleTimeout,100))}else p.trace(`createNewKernelSession ${e.kernelConnection?.id}`),t=await this.createNewSession(e),await By(e.kernelConnection,e.resource,t,e.idleTimeout,e.token).catch(h);if(e.token.isCancellationRequested)throw new iT.CancellationError;return t}catch(r){let i=e.ui.disableUI?p.debug:p.error;throw r instanceof $e?(i("Failed to change kernel, re-throwing",r),r):(i("Failed to change kernel",r),new bf(e.kernelConnection))}}async createNewSession(e){let t=(e.connection,e.resource,void 0),r=t?.path,i=_d(e.kernelConnection)??e.kernelSpecManager?.specs?.default??"",o;if(t?.name)o=t.name;else{let a=e.resource?fd(e.resource):"";o=`${e.resource?pr(e.resource,a):""}-${lr()}${a}`}let s={path:r||$de(e.resource),kernel:{name:i},name:o,type:(e.resource?.path||"").toLowerCase().endsWith(".ipynb")?"notebook":"console"};try{let a=await Nt(e.token,e.sessionManager.startNew(s,{kernelConnectionOptions:{handleComms:!0}}));if(!a.kernel)throw new Vy(new Error("No kernel created"));return p.info(y.createdNewKernel(e.connection.baseUrl,a?.kernel?.id||"")),a}catch(a){throw a instanceof Vy?a:new Vy(a)}}};gu=v([(0,oc.injectable)(),m(0,(0,oc.inject)(Lg)),m(1,(0,oc.inject)(un)),m(2,(0,oc.inject)(ya)),m(3,(0,oc.inject)(_x)),m(3,(0,oc.optional)()),m(4,(0,oc.inject)(oe))],gu);function Bde(){return`${kg}${lr()}`}function $de(n){let e=`${Bde()}${lr()}.ipynb`;return n?`${pr(n,".ipynb")}${e}`:`${y.defaultNotebookName}${e}`}var Jy=class{constructor(e,t,r){this.rawKernelSupported=e;this.newRawKernelSessionFactory=t;this.newJupyterSessionFactory=r}async create(e){let t=e.kernelConnection;return this.rawKernelSupported.isSupported&&at(t)&&this.newRawKernelSessionFactory?this.newRawKernelSessionFactory.create({...e,kernelConnection:t}):this.newJupyterSessionFactory.create(e)}};Jy=v([(0,vp.injectable)(),m(0,(0,vp.inject)(_n)),m(1,(0,vp.inject)(v_)),m(1,(0,vp.optional)()),m(2,(0,vp.inject)(gu))],Jy);var ew=Symbol("RemoteKernelFinderController");function A4(n,e){n.add(cy,Sy),n.addSingleton(me,Cy),n.addSingleton(me,uy),n.addSingleton(Kg,Dy),n.addSingleton(Ws,Ws),n.addSingleton(Fg,wy),n.addSingleton(Dx,uf),n.addSingleton(au,au),n.addSingleton(vi,vi),n.addSingleton(_a,_a),n.addSingleton(Ea,Ea),n.addSingleton(_x,df),n.addSingleton(Lg,Ty),n.addSingleton(Md,cf),n.addSingleton(lp,cf),n.addSingleton(Xt,My),n.addSingleton(Tx,Ny),n.addSingleton(ax,_y),n.addSingleton(QC,Jy),n.addSingleton(gu,gu),n.addSingleton(qc,Ly),n.addSingleton(Kd,Uy),n.addSingleton(un,un),n.addSingleton(Um,Ky),n.addBinding(Um,me),n.addSingleton(Rx,ky),n.addSingleton(Gr,Iy),n.addSingleton(ew,hu),n.addBinding(ew,me),n.addSingleton(Jt,Vg)}var If=k(N()),vu=require("vscode");var qy=class{constructor(e,t,r,i){this.disposableRegistry=e;this.kernelProvider=t;this.serverUriStorage=r;this.jupyterUriProviderRegistration=i;this.kernelsStartedSuccessfully=new WeakSet;this.kernelDisposables=new WeakMap;this.kernelConnectionToKernelMapping=new WeakMap;this.kernelsRestarting=new WeakSet;this.kernelReconnectProgress=new WeakMap;this.lastExecutedCellPerKernel=new WeakMap}activate(){this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposableRegistry),this.disposableRegistry.push(this.kernelProvider.onDidDisposeKernel(e=>{this.kernelDisposables.get(e)?.dispose(),this.kernelDisposables.delete(e),this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e)},this)),this.disposableRegistry.push(this.kernelProvider.onDidRestartKernel(e=>{this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e)},this)),this.disposableRegistry.push(ar.onDidChangeNotebookCellExecutionState(e=>{if(!St(e.cell.notebook)||e.state!==1)return;let t=this.kernelProvider.get(e.cell.notebook);!t||this.lastExecutedCellPerKernel.get(t)!==e.cell||this.lastExecutedCellPerKernel.delete(t)}))}getKernelSpecificDisposables(e){let t=this.kernelDisposables.get(e)||new or;return this.disposableRegistry.push(t),this.kernelDisposables.set(e,t),t}onDidStartKernel(e){if(this.kernelsStartedSuccessfully.has(e)||!e.session?.kernel)return;let t=this.getKernelSpecificDisposables(e);t.add(ar.onDidChangeNotebookCellExecutionState(r=>{r.cell.notebook===e.notebook&&this.kernelProvider.get(r.cell.notebook)===e&&r.state===3&&this.lastExecutedCellPerKernel.set(e,r.cell)},this)),this.kernelsStartedSuccessfully.add(e),this.kernelConnectionToKernelMapping.set(e.session.kernel,e),e.session?.kernel?.connectionStatusChanged.connect(this.onKernelStatusChanged,this),t.add(e.addHook("willRestart",async()=>{this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e),this.kernelsRestarting.add(e)},this)),t.add(e.onRestarted(()=>this.kernelsRestarting.delete(e),this))}onKernelStatusChanged(e,t){let r=this.kernelConnectionToKernelMapping.get(e);if(r&&!this.kernelsRestarting.has(r))switch(t){case"connected":{this.kernelReconnectProgress.get(r)?.dispose(),this.kernelReconnectProgress.delete(r);return}case"disconnected":{this.kernelReconnectProgress.has(r)&&(this.kernelReconnectProgress.get(r)?.dispose(),this.kernelReconnectProgress.delete(r),this.onKernelDisconnected(r)?.catch(h));return}case"connecting":this.kernelReconnectProgress.has(r)||this.onKernelConnecting(r)?.catch(h);return;default:return}}async onKernelConnecting(e){let t=this.getKernelSpecificDisposables(e),r=ne(),i=new vu.Disposable(()=>r.resolve());if(this.kernelReconnectProgress.set(e,i),Dt(e.kernelConnectionMetadata)&&await this.handleRemoteServerShutdown(e,e.kernelConnectionMetadata))return;let o=y.automaticallyReconnectingToAKernelProgressMessage(lt(e.kernelConnectionMetadata));vu.window.withProgress({location:vu.ProgressLocation.Notification,title:o},async()=>r.promise).then(h,h),t.add(i)}async onKernelDisconnected(e){if(e.disposed||e.disposing||(Ct(e.resourceUri,"DATASCIENCE.KERNEL_CRASH"),Dt(e.kernelConnectionMetadata)&&await this.handleRemoteServerShutdown(e,e.kernelConnectionMetadata)))return;let t=at(e.kernelConnectionMetadata)?y.kernelDisconnected(lt(e.kernelConnectionMetadata)):y.remoteJupyterConnectionFailedWithServer(e.kernelConnectionMetadata.baseUrl);vu.window.showErrorMessage(t).then(h,h);try{let r=this.lastExecutedCellPerKernel.get(e);if(!r||r.document.isClosed||r.notebook.isClosed||r.executionSummary?.success===!1)return;await Jc(r,e.controller,t,!1)}finally{await e.dispose()}}async handleRemoteServerShutdown(e,t){let r=this.jupyterUriProviderRegistration.jupyterCollections.find(o=>o.extensionId===t.serverProviderHandle.extensionId&&o.id===t.serverProviderHandle.id);if(!r)return!1;let i=new vu.CancellationTokenSource;try{return(await Promise.resolve(r.serverProvider.provideJupyterServers(i.token))||[]).map(a=>a.id).includes(t.serverProviderHandle.handle)?!1:(await this.serverUriStorage.remove(t.serverProviderHandle),this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e),!0)}catch{return!1}finally{i.dispose()}}};qy=v([(0,If.injectable)(),m(0,(0,If.inject)(K)),m(1,(0,If.inject)(ye)),m(2,(0,If.inject)(Xt)),m(3,(0,If.inject)(Jt))],qy);var tw=k(N());var Hy=class{constructor(e,t){this.disposableRegistry=e;this.kernelProvider=t;this.kernelsStartedSuccessfully=new WeakSet;this.kernelRestartProgress=new WeakMap}activate(){this.kernelProvider.onKernelStatusChanged(this.onKernelStatusChanged,this,this.disposableRegistry),this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposableRegistry),this.disposableRegistry.push(this.kernelProvider.onDidDisposeKernel(e=>{this.kernelRestartProgress.get(e)?.dispose(),this.kernelRestartProgress.delete(e)},this)),this.disposableRegistry.push(this.kernelProvider.onDidRestartKernel(e=>{this.kernelRestartProgress.get(e)?.dispose(),this.kernelRestartProgress.delete(e)},this))}onDidStartKernel(e){this.kernelsStartedSuccessfully.add(e)}onKernelStatusChanged({kernel:e}){if(!(!this.kernelsStartedSuccessfully.has(e)||!e.session||e.session.kind==="localRaw"))if(e.status==="autorestarting"){let t=ut.createProgressReporter(e.resourceUri,y.restartingKernelStatus(lt(e.kernelConnectionMetadata)));this.kernelRestartProgress.set(e,t)}else e.status!=="starting"&&e.status!=="busy"&&e.status!=="unknown"&&this.kernelRestartProgress.has(e)&&(this.kernelRestartProgress.get(e)?.dispose(),this.kernelRestartProgress.delete(e))}};Hy=v([(0,tw.injectable)(),m(0,(0,tw.inject)(K)),m(1,(0,tw.inject)(ye))],Hy);var rw=k(N()),sF=require("vscode");var Sf=class{constructor(e,t){this.disposableRegistry=e;this.kernelProvider=t;this.lastExecutedCellPerKernel=new WeakMap;this.kernelsStartedSuccessfully=new WeakSet}activate(){this.kernelProvider.onKernelStatusChanged(this.onKernelStatusChanged,this,this.disposableRegistry),this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposableRegistry)}onDidStartKernel(e){this.kernelsStartedSuccessfully.add(e),ar.onDidChangeNotebookCellExecutionState(t=>{t.cell.notebook===e.notebook&&this.kernelProvider.get(t.cell.notebook)===e&&this.lastExecutedCellPerKernel.set(e,t.cell)})}async onKernelStatusChanged({kernel:e}){this.kernelsStartedSuccessfully.has(e)&&(e.disposed||e.disposing||!e.session||(e.session.kind==="localRaw"&&e.status==="dead"&&(sF.window.showErrorMessage(y.kernelDiedWithoutError(lt(e.kernelConnectionMetadata))).then(h,h),await this.endCellAndDisplayErrorsInCell(e)),e.session.kind!=="localRaw"&&e.status==="autorestarting"&&(sF.window.showErrorMessage(y.kernelDiedWithoutErrorAndAutoRestarting(lt(e.kernelConnectionMetadata))).then(h,h),await this.endCellAndDisplayErrorsInCell(e))))}async endCellAndDisplayErrorsInCell(e){let t=this.lastExecutedCellPerKernel.get(e);if(Ct(e.resourceUri,"DATASCIENCE.KERNEL_CRASH"),!!t)return Jc(t,e.controller,y.kernelCrashedDueToCodeInCurrentOrPreviousCell,!1)}};v([Yr()],Sf.prototype,"onKernelStatusChanged",1),Sf=v([(0,rw.injectable)(),m(0,(0,rw.inject)(K)),m(1,(0,rw.inject)(ye))],Sf);var yu=k(N()),bp=require("vscode");var yp=class{constructor(e,t,r,i){this.installer=e;this.memento=t;this.rawSupport=r;this.serviceContainer=i;this.installPromises=new Map}async installMissingDependencies({resource:e,kernelConnection:t,ui:r,token:i,ignoreCache:o,cannotChangeKernels:s,installWithoutPrompting:a}){if(!at(t)||!Xe(t)||!t.interpreter)return 0;p.info(`Check & install missing Kernel dependencies for ${M(t.interpreter?.uri)}, ui.disabled=${r.disableUI} for resource '${M(e)}'`);let l=async()=>{if(r.disableUI?await this.areDependenciesInstalled(t,i,o):await ut.wrapAndReportProgress(e,y.validatingKernelDependencies,()=>this.areDependenciesInstalled(t,i,o)))return 0;if(i?.isCancellationRequested)return 1};if(!a){let g=await l();if(g===0||g===1)return g}let c=fn(t.interpreter.uri),u=this.installPromises.get(c),d;if(!u){let g=new bp.CancellationTokenSource,b=i.onCancellationRequested(()=>{g.cancel(),b.dispose()}),I=async()=>{if(a){let w=await l();if(w===0||w===1)return w}return this.runInstaller(e,t.interpreter,r,g,s,a)};u=r.disableUI?I():ut.wrapAndReportProgress(e,y.installingMissingDependencies,I),u.finally(()=>{b.dispose(),g.dispose()}).catch(h),this.installPromises.set(c,u)}let f=2;try{f=await u,(d?.token?.isCancellationRequested||i.isCancellationRequested)&&(f=1)}catch(g){p.ci("Failed to install kernel dependency",g),f=2}finally{this.installPromises.delete(c)}return f}async areDependenciesInstalled(e,t,r){if(e.kind==="connectToLiveRemoteKernel"||e.kind==="startUsingRemoteKernelSpec"||e.interpreter===void 0)return!0;if(!r&&this.rawSupport.isSupported&&await j8(this.memento,19,e.interpreter))return p.info(`IPyKernel found previously in this environment ${M(e.interpreter.uri)}`),!0;let i=this.installer.isInstalled(19,e.interpreter).then(o=>o===!0);return i.then(o=>{o&&e.interpreter&&JD(this.memento,19,e.interpreter).catch(h)},h),Rt(t,!1,i)}async runInstaller(e,t,r,i,o,s){if(p.ci(`Run Installer for ${M(e)} ui.disableUI=${r.disableUI}, cancelTokenSource.token.isCancellationRequested=${i.token.isCancellationRequested}`),r.disableUI&&!s)return 4;let a=Ue(t),[l,c]=await Promise.all([q8(this.memento,19,t),a==="Conda"?void 0:await this.installer.isInstalled(27,t)]);if(i.token.isCancellationRequested)return 1;let u=l?y.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreterAndRequiresUpdate:y.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreter,d=c===!1?[19,27]:[19],f=u(Hr(t)||t.uri.fsPath,d.map(V=>hr.get(V)).join(` ${ce.and} `)),g=d.map(V=>hr.get(V)).join(", "),b=e?to(e):void 0,I=e?await ot(e.toString()):void 0;Ct(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"displayed",moduleName:g,resourceType:b,resourceHash:I,pythonEnvType:a});let w=ce.install,_=y.selectKernel,A=ce.moreInfo,R=[w];e&&!o&&R.push(_),R.push(A);try{(!dm()||!s)&&Ct(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"prompted",moduleName:g,resourceType:b,resourceHash:I,pythonEnvType:a});let V;do V=dm()||s?w:await Rt(i.token,bp.window.showInformationMessage(f,{modal:!0},...R)),V===A&&(Ct(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"moreInfo",moduleName:g,resourceType:b,resourceHash:I,pythonEnvType:a}),bp.env.openExternal(bp.Uri.parse("https://aka.ms/AAhi594")));while(V===A);if(i.token.isCancellationRequested)return Ct(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"dismissed",moduleName:g,resourceType:b,resourceHash:I,pythonEnvType:a}),1;if(V===_)return Ct(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"differentKernel",moduleName:g,resourceType:b,resourceHash:I,pythonEnvType:a}),3;if(V===w){Ct(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"install",moduleName:g,resourceType:b,resourceHash:I,pythonEnvType:a});let ie=await Rt(i.token,3,this.installer.install(19,t,i,l===!0,c===!1,r.disableUI===!0));if(ie===0)return Ct(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"installed",moduleName:g,resourceType:b,resourceHash:I,pythonEnvType:a}),0;if(ie===2)return Ct(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"failed",moduleName:g,resourceType:b,resourceHash:I,pythonEnvType:a}),2}return Ct(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"dismissed",moduleName:g,resourceType:b,resourceHash:I,pythonEnvType:a}),1}catch(V){throw p.error(`Failed to install ${g}`,V),Ct(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"error",moduleName:g,resourceType:b,resourceHash:I,pythonEnvType:a}),V}}};v([ui("Install Missing Dependencies")],yp.prototype,"installMissingDependencies",1),v([ui("Are Dependencies Installed"),m(0,Wc("id"))],yp.prototype,"areDependenciesInstalled",1),yp=v([(0,yu.injectable)(),m(0,(0,yu.inject)(ji)),m(1,(0,yu.inject)(We)),m(1,(0,yu.named)(dt)),m(2,(0,yu.inject)(_n)),m(3,(0,yu.inject)(Ze))],yp);var oT=k(N()),zy=require("vscode");var Gy=class extends Qt{constructor(t){super();this._onDidChangeRegistrations=this._register(new zy.EventEmitter);this.onDidChangeRegistrations=this._onDidChangeRegistrations.event;this._finders=[];this.connectionFinderMapping=new Map;this._onDidChangeKernels=this._register(new zy.EventEmitter);this.onDidChangeKernels=this._onDidChangeKernels.event;this._status="idle";this._onDidChangeStatus=this._register(new zy.EventEmitter);t.push(this),this._register(this._onDidChangeStatus),this._register(this._onDidChangeRegistrations)}get status(){return this._status}set status(t){this._status!=t&&(this._status=t,this._onDidChangeStatus.fire())}get onDidChangeStatus(){return this._onDidChangeStatus.event}registerKernelFinder(t){this._finders.push(t);let r=()=>{this.status=this._finders.every(s=>s.status==="idle")?"idle":"discovering"};r();let i=this._register(new or),o=()=>{let s=this._finders.findIndex(a=>a===t);s>=0&&this._finders.splice(s,1),i.dispose(),r(),this._onDidChangeKernels.fire(),this._onDidChangeRegistrations.fire({added:[],removed:[t]})};return i.add(t.onDidChangeStatus(r,this)),i.add(t.onDidChangeKernels(()=>this._onDidChangeKernels.fire())),i.add(t.onDidDispose(()=>o())),this._onDidChangeKernels.fire(),this._onDidChangeRegistrations.fire({added:[t],removed:[]}),new zy.Disposable(()=>o())}get kernels(){let t=[];this.connectionFinderMapping.clear();let r=new Set;this._finders.filter(o=>o.kind==="localPythonEnvironment").forEach(o=>{o.kernels.forEach(s=>{(s.kind==="startUsingLocalKernelSpec"||s.kind==="startUsingPythonInterpreter")&&s.kernelSpec.specFile&&r.add(s.kernelSpec.specFile),t.push(s),this.connectionFinderMapping.set(s.id,o)})}),this._finders.filter(o=>o.kind==="localKernelSpec").forEach(o=>{o.kernels.forEach(s=>{(s.kind==="startUsingLocalKernelSpec"||s.kind==="startUsingPythonInterpreter")&&s.kernelSpec.specFile&&r.has(s.kernelSpec.specFile)||(t.push(s),this.connectionFinderMapping.set(s.id,o))})});let i=this._finders.filter(o=>o.kind==="remote");for(let o of i){let s=o.kernels;s.forEach(a=>{this.connectionFinderMapping.set(a.id,o)}),t.push(...s)}return t}getFinderForConnection(t){return this.connectionFinderMapping.get(t.id)}get registered(){return this._finders}};Gy=v([(0,oT.injectable)(),m(0,(0,oT.inject)(K))],Gy);var _r=k(N());var Ii=require("vscode");var sT=class{constructor(e,t){this.asyncDisposables=e;this.disposables=t;this.executions=new WeakMap;this.kernelsByNotebook=new WeakMap;this.kernelsById=new Map;this.pendingDisposables=new Set;this._onDidRestartKernel=new Ii.EventEmitter;this._onDidStartKernel=new Ii.EventEmitter;this._onDidCreateKernel=new Ii.EventEmitter;this._onDidDisposeKernel=new Ii.EventEmitter;this._onKernelStatusChanged=new Ii.EventEmitter;this._onDidPostInitializeKernel=new Dm;this.onKernelStatusChanged=this._onKernelStatusChanged.event;this.asyncDisposables.push(this),Ii.workspace.onDidCloseNotebookDocument(r=>this.disposeOldKernel(r,"notebookClosed"),this,t),t.push(this._onDidDisposeKernel),t.push(this._onDidRestartKernel),t.push(this._onKernelStatusChanged),t.push(this._onDidStartKernel),t.push(this._onDidCreateKernel),t.push(this._onDidPostInitializeKernel)}get kernels(){let e=new Set;return Ii.workspace.notebookDocuments.forEach(t=>{let r=this.get(t);r&&e.add(r)}),Array.from(e)}get onDidDisposeKernel(){return this._onDidDisposeKernel.event}get onDidRestartKernel(){return this._onDidRestartKernel.event}get onDidStartKernel(){return this._onDidStartKernel.event}get onDidCreateKernel(){return this._onDidCreateKernel.event}get onDidPostInitializeKernel(){return this._onDidPostInitializeKernel.event}get(e){if(Gn(e)){let t=Ii.workspace.notebookDocuments.find(r=>r.uri.toString()===e.toString());return t?this.get(t):void 0}else return typeof e=="string"?this.kernelsById.get(e)?.kernel:this.kernelsByNotebook.get(e)?.kernel}getKernelExecution(e){return this.executions.get(e)}getInternal(e){return this.kernelsByNotebook.get(e)}async dispose(){p.ci("Disposing all kernels from kernel provider");let e=Array.from(this.pendingDisposables.values());this.pendingDisposables.clear(),await Promise.all(e),await Promise.all(this.kernels.map(t=>t.dispose()))}storeKernel(e,t,r){this.kernelsByNotebook.set(e,{options:t,kernel:r}),this.kernelsById.set(r.id,{options:t,kernel:r}),this._onDidCreateKernel.fire(r)}deleteMappingIfKernelIsDisposed(e){e.onDisposed(()=>{this.get(e.notebook)===e&&(this.kernelsByNotebook.delete(e.notebook),this.kernelsById.delete(e.id),p.debug(`Kernel got disposed, hence there is no longer a kernel associated with ${M(e.uri)}`)),this.pendingDisposables.delete(e)},this,this.disposables)}disposeOldKernel(e,t){let r=this.kernelsByNotebook.get(e);r&&(p.debug(`Disposing kernel associated with ${M(e.uri)}, isClosed=${e.isClosed}, reason = ${t}`),this.kernelsById.delete(r.kernel.id),this.pendingDisposables.add(r.kernel),r.kernel.dispose().catch(i=>p.warn("Failed to dispose old kernel",i)).finally(()=>this.pendingDisposables.delete(r.kernel)).catch(h)),this.kernelsByNotebook.delete(e)}handleServerRemoval(e){Ii.workspace.notebookDocuments.forEach(t=>{let r=this.kernelsByNotebook.get(t);if(r){let i=r.options.metadata;(i.kind==="connectToLiveRemoteKernel"||i.kind==="startUsingRemoteKernelSpec")&&e.find(s=>s.id===i.serverProviderHandle.id&&s.handle===i.serverProviderHandle.handle)&&(this.kernelsByNotebook.delete(t),this.kernelsById.delete(r.kernel.id))}})}},aT=class{constructor(e,t){this.asyncDisposables=e;this.disposables=t;this.kernelsByUri=new Map;this.kernelsById=new Map;this.pendingDisposables=new Set;this._onDidRestartKernel=new Ii.EventEmitter;this._onDidStartKernel=new Ii.EventEmitter;this._onDidCreateKernel=new Ii.EventEmitter;this._onDidDisposeKernel=new Ii.EventEmitter;this._onDidPostInitializeKernel=new Dm;this._onKernelStatusChanged=new Ii.EventEmitter;this.onKernelStatusChanged=this._onKernelStatusChanged.event;this.asyncDisposables.push(this),Ii.workspace.onDidCloseNotebookDocument(r=>{p.debug(`Notebook document ${M(r.uri)} got closed`),this.disposeOldKernel(r.uri)},this,t),t.push(this._onDidDisposeKernel),t.push(this._onDidRestartKernel),t.push(this._onKernelStatusChanged),t.push(this._onDidStartKernel),t.push(this._onDidCreateKernel),t.push(this._onDidPostInitializeKernel)}get kernels(){return Array.from(this.kernelsByUri.values()).map(e=>e.kernel)}get onDidDisposeKernel(){return this._onDidDisposeKernel.event}get onDidRestartKernel(){return this._onDidRestartKernel.event}get onDidStartKernel(){return this._onDidStartKernel.event}get onDidCreateKernel(){return this._onDidCreateKernel.event}get onDidPostInitializeKernel(){return this._onDidPostInitializeKernel.event}get(e){return this.kernelsByUri.get(e.toString())?.kernel||this.kernelsById.get(e.toString())?.kernel}getInternal(e){return this.kernelsByUri.get(e.toString())}async dispose(){p.ci("Disposing all kernels from kernel provider");let e=Array.from(this.pendingDisposables.values());this.pendingDisposables.clear(),await Promise.all(e),await Promise.all(this.kernels.map(t=>t.dispose()))}storeKernel(e,t,r){this.kernelsByUri.set(e.toString(),{options:t,kernel:r}),this.kernelsById.set(r.id,{options:t,kernel:r}),this._onDidCreateKernel.fire(r)}deleteMappingIfKernelIsDisposed(e,t){t.onDisposed(()=>{this.get(e)===t&&(this.kernelsByUri.delete(e.toString()),this.kernelsById.delete(t.id),p.debug(`Kernel got disposed, hence there is no longer a kernel associated with ${M(e)}`)),this.pendingDisposables.delete(t)},this,this.disposables)}disposeOldKernel(e){let t=this.kernelsByUri.get(e.toString());t&&(p.ci(`Disposing kernel associated with ${M(e)}`),this.kernelsById.delete(t.kernel.id),this.pendingDisposables.add(t.kernel),t.kernel.dispose().catch(r=>p.warn("Failed to dispose old kernel",r)).finally(()=>this.pendingDisposables.delete(t.kernel)).catch(h)),this.kernelsByUri.delete(e.toString())}};var Mr=require("vscode");var K4=k(TD());var aF="KERNEL_INFO",Jde=1e3*60*60*24*2;async function M4(n,e,t){let r=[],i={banner:"",help_links:[],implementation:"",implementation_version:"",language_info:{name:"",version:""},protocol_version:"",status:"ok"};if(!n.kernel)return;n.kernel?.info&&(r.push(n.kernel.info),n.kernel.info.then(a=>N4(t,e,a)).catch(h));let o=n.kernel.requestKernelInfo().then(a=>a?.content);if(r.push(o),o.then(a=>N4(t,e,a)).catch(h),e.kind==="connectToLiveRemoteKernel"){let a=qde(t,e);a?r.push(Promise.resolve(a)):r.push(Hn(5e3).then(()=>i))}let s=await Promise.race(r);return s===i?p.warn("Failed to Kernel info in a timely manner, defaulting to empty info!"):p.trace("Got Kernel info"),s}async function N4(n,e,t){if(!t||!Dt(e))return;let r=n.get(aF,[]).filter(i=>Date.now()-i.age<Jde).filter(i=>i.id!==e.id);r.push({id:e.id,age:Date.now(),info:t}),await n.update(aF,r)}function qde(n,e){if(Dt(e))return n.get(aF,[]).find(t=>t.id===e.id)?.info}var lT=class extends xn{constructor(e){super("kernelpromisetimeout",y.interruptingKernelFailed,e)}};function Qy(n){return`r"${n}"`}var cT="e976ee50-99ed-4aba-9b6b-9dcd5634d07d:IPyWidgets:";function nw(n){let e=typeof n=="string"?n:"";return typeof n!="string"&&"content"in n&&"code"in n.content&&typeof n.content.code=="string"&&(e=n.content.code),!e.includes(cT)}function mT(n){return n.status==="dead"||n.status==="terminating"&&!n.disposed&&!n.disposing||!n.disposed&&!n.disposing&&(n.session?.status=="unknown"||n.session?.kernel?.status=="unknown")&&(n.session.kernel?.isDisposed||n.session.isDisposed)}function O4(n){return n.status==="dead"||n.status==="terminating"&&!n.isDisposed||!n.isDisposed&&(n.status=="unknown"||n.kernel?.status=="unknown")&&(n.kernel?.isDisposed||n.isDisposed)}var uT=class{constructor(e,t,r,i,o,s,a,l,c,u,d){this.id=e;this.uri=t;this.resourceUri=r;this.kernelConnectionMetadata=i;this.sessionCreator=o;this.kernelSettings=s;this.startupCodeProviders=a;this._creator=l;this.workspaceMemento=c;this.kernelWorkingDirectory=u;this.rawKernelSupported=d;this.disposables=[];this._onIPyWidgetVersionResolved=new Mr.EventEmitter;this._onDidKernelSocketChange=new Mr.EventEmitter;this._onStatusChanged=new Mr.EventEmitter;this._onRestarted=new Mr.EventEmitter;this._onStarted=new Mr.EventEmitter;this._onPostInitialized=new Dm;this._onDisposed=new Mr.EventEmitter;this.hookedSessionForEvents=new WeakSet;this.hooks=new Map;this.startCancellation=new Mr.CancellationTokenSource;this.startupUI=new Mt(!0);this.disposables.push(this._onStatusChanged),this.disposables.push(this._onRestarted),this.disposables.push(this._onStarted),this.disposables.push(this._onDisposed),this.disposables.push(this._onIPyWidgetVersionResolved),this.disposables.push(this._onDidKernelSocketChange),ro(this.resourceUri,{kernelConnection:this.kernelConnectionMetadata,actionSource:this.creator,disableUI:this.startupUI.disableUI}).catch(h),this.startupUI.onDidChangeDisableUI(()=>{this.startupUI.disableUI||ro(this.resourceUri,{disableUI:!1}).catch(h)},this.disposables)}get ipywidgetsVersion(){return this._ipywidgetsVersion}get onIPyWidgetVersionResolved(){return this._onIPyWidgetVersionResolved.event}get onStatusChanged(){return this._onStatusChanged.event}get onRestarted(){return this._onRestarted.event}get onStarted(){return this._onStarted.event}get onPostInitialized(){return this._onPostInitialized.event}get onDisposed(){return this._onDisposed.event}get creator(){return this._creator}get startedAtLeastOnce(){return this._startedAtLeastOnce}get userStartedKernel(){return!this.startupUI.disableUI}get info(){return this._info}get status(){return this._jupyterSessionPromise&&!this._session?"starting":this._session?.status??(this.isKernelDead?"dead":"unknown")}get disposed(){return this._disposed===!0||this._session?.isDisposed===!0}get disposing(){return this._disposing===!0}get onDidKernelSocketChange(){return this._onDidKernelSocketChange.event}get session(){return this._session}get isPostInitializedInProgress(){return this._isPostInitializedInProgress===!0}get restarting(){return this._restartPromise||Promise.resolve()}addHook(e,t,r,i){let o=this.hooks.get(e)||new Set;this.hooks.set(e,o),t=r?t.bind(r):t,o.add(t);let s={dispose:()=>{o.delete(t)}};return i&&i.push(s),s}async start(e){this.startCancellation.token.isCancellationRequested&&(this.startCancellation.dispose(),this.startCancellation=new Mr.CancellationTokenSource);let t=await this.startJupyterSession(e);return e?.ignoreTriggeringOnPostInitialized||await this.triggerOnDidStartKernel(e?.disableUI===!0,!1),t}async interrupt(){let e=Promise.all(Array.from(this.hooks.get("willInterrupt")||new Set).map(r=>r()));p.info(`Interrupt requested ${M(this.resourceUri||this.uri)}`);let t;try{let r=this._jupyterSessionPromise?await this._jupyterSessionPromise.catch(()=>{}):void 0;p.info("Interrupt kernel execution"),r?(t=this._interruptPromise?await this._interruptPromise:await(this._interruptPromise=this.interruptExecution(r,e)),this._interruptPromise=void 0):(p.info("No kernel session to interrupt"),this._interruptPromise=void 0,t="success")}finally{await Promise.all(Array.from(this.hooks.get("interruptCompleted")||new Set).map(r=>r())).catch(h)}if(p.info(`Interrupt requested & sent for ${M(this.uri)} in notebookEditor.`),t==="timeout"){let r=y.restartKernelAfterInterruptMessage(lt(this.kernelConnectionMetadata)),i=y.restartKernelMessageYes;await Mr.window.showInformationMessage(r,{modal:!0},i)===i&&await this.restart()}}async dispose(){if(p.info(`Dispose Kernel '${M(this.uri)}' associated with '${M(this.resourceUri)}'`),this._disposing=!0,this.disposingPromise)return this.disposingPromise;this._ignoreJupyterSessionDisposedErrors=!0,this.startCancellation.cancel();let e=async()=>{let t=[];t.push(Promise.all(Array.from(this.hooks.get("willCancel")||new Set).map(r=>r())).then(h).catch(h)),this._session=this._session?this._session:this._jupyterSessionPromise?await this._jupyterSessionPromise.catch(()=>{}):void 0,this._jupyterSessionPromise=void 0,this._postInitializedOnStartPromise=void 0,this._session&&(t.push(Ts(this._session,this.disposables)),this._session=void 0),this._disposed=!0,this._onDisposed.fire(),this._onStatusChanged.fire("dead");try{await Promise.all(t)}finally{this.startCancellation.dispose(),G(this.disposables)}};this.disposingPromise=e(),await this.disposingPromise}async restart(){try{let e=to(this.resourceUri);p.info(`Restart requested ${M(this.uri)}`),await Promise.all(Array.from(this.hooks.get("willRestart")||new Set).map(r=>r(this._jupyterSessionPromise))),this.startCancellation.cancel(),this.startCancellation.dispose();let t=new Me;try{let r=this._jupyterSessionPromise?await this._jupyterSessionPromise.catch(()=>{}):void 0;r?(this._restartPromise||(this._restartPromise=r.restart(),this._restartPromise.finally(()=>this._restartPromise=void 0).catch(h)),await this._restartPromise,this.startCancellation=new Mr.CancellationTokenSource):await this.start(new Mt(!1)),Ct(this.resourceUri,"DATASCIENCE.NOTEBOOK_RESTART",{duration:t.elapsedTime},{resourceType:e})}catch(r){p.error(`Restart failed ${M(this.uri)}`,r),this._ignoreJupyterSessionDisposedErrors=!0;let i=this._session;throw this._session=void 0,this._jupyterSessionPromise=void 0,this._postInitializedOnStartPromise=void 0,Ct(this.resourceUri,"DATASCIENCE.NOTEBOOK_RESTART",{duration:t.elapsedTime},void 0,r),i&&await Ts(i,this.disposables),this._ignoreJupyterSessionDisposedErrors=!1,r}await this.initializeAfterStart(this._session),this._onRestarted.fire(),await this.triggerOnDidStartKernel(!1,!0)}catch(e){throw p.error(`Failed to restart kernel ${M(this.uri)}`,e),e}finally{Promise.all(Array.from(this.hooks.get("restartCompleted")||new Set).map(e=>e())).catch(h)}}async shutdown(){try{p.info(`Shutdown requested ${M(this.uri)}`),this.startCancellation.cancel(),this.startCancellation.dispose();let e=this._jupyterSessionPromise?await this._jupyterSessionPromise.catch(()=>{}):void 0;if(e){p.info("Shutting down kernel session");try{await e.shutdown()}catch(t){p.warn(`Failed to shutdown kernel session ${M(this.uri)}`,t)}}this._session=void 0,this._jupyterSessionPromise=void 0,this._postInitializedOnStartPromise=void 0,p.info(`Shutdown completed ${M(this.uri)}`)}catch(e){throw p.error(`Failed to shutdown kernel ${M(this.uri)}`,e),e}}async startJupyterSession(e=new Mt(!1)){if(this._startedAtLeastOnce=!0,e.disableUI||(this.startupUI.disableUI=!1),e.onDidChangeDisableUI(()=>{!e.disableUI&&this.startupUI.disableUI&&(this.startupUI.disableUI=!1)},this.disposables),this.startupUI.disableUI&&this.startupUI.onDidChangeDisableUI(()=>{this.disposing||this.disposed||this.startupUI.disableUI||Ca(this.resourceUri,this.kernelConnectionMetadata).catch(h)},this,this.disposables),this.disposing)throw new Mr.CancellationError;if(bn.throwIfCanceled(this.startCancellation.token),!this._jupyterSessionPromise){let t=new Me;this._jupyterSessionPromise=this.createJupyterSession();try{let r=await this._jupyterSessionPromise;return Ct(this.resourceUri,"DS_INTERNAL.PERCEIVED_JUPYTER_STARTUP_NOTEBOOK",{duration:t.elapsedTime}),r}catch(r){throw p.ci(`Failed to create Jupyter Session in Kernel.startNotebook for ${M(this.uri)}`),this.startCancellation.cancel(),this._jupyterSessionPromise=void 0,r}}return this._jupyterSessionPromise}async triggerOnDidStartKernel(e,t=!1){e||((!this._postInitializedOnStartPromise||t)&&(this._isPostInitializedInProgress=!0,this._postInitializedOnStartPromise=this._onPostInitialized.fireAsync({},this.startCancellation.token),this._postInitializedOnStartPromise.finally(()=>this._isPostInitializedInProgress=!1)),await this._postInitializedOnStartPromise)}async interruptExecution(e,t){let r=ne(),i=new Me,o=[],s=c=>{(c==="restarting"||c==="autorestarting")&&(p.warn("Kernel restarting during interrupt"),r.resolve(!0))},a=(c,u)=>s(u);return e.statusChanged.connect(a),o.push(new Mr.Disposable(()=>ci(()=>e.statusChanged.disconnect(a)))),e&&e.kernel&&(p.info(`Interrupting kernel: ${e.kernel.name}`),await Nh(this.kernelSettings.interruptTimeout,new lT(this.kernelConnectionMetadata),e.kernel.interrupt()).catch(c=>{p.warn(`Error during interrupt: ${c}`),r.resolve(!0)})),(async()=>{let c=ne();this.status==="busy"&&(this.onDisposed(()=>c.resolve("dead"),this,o),this.onStatusChanged(()=>this.status==="dead"?c.resolve("dead"):void 0,this,o));try{return await Bt(this.kernelSettings.interruptTimeout,"timeout",t.then(()=>"success"),r.promise.then(()=>"restart"),c.promise)}catch(u){if(r.completed)return"restart";throw Ct(this.resourceUri,"DATASCIENCE.NOTEBOOK_INTERRUPT",{duration:i.elapsedTime},void 0,u),u}finally{G(o)}})().then(c=>(Ct(this.resourceUri,"DATASCIENCE.NOTEBOOK_INTERRUPT",{duration:i.elapsedTime},{result:c}),c))}async createJupyterSession(){let e=Mr.workspace.notebookDocuments.find(i=>i.uri.toString()===this.uri.toString()),t=e?kn(e)?.jupyterSessionTelemetry():void 0;if(await ro(this.resourceUri,{kernelConnection:this.kernelConnectionMetadata,actionSource:this.creator,userExecutedCell:!this.startupUI.disableUI}),t?.stop(),this.disposing)throw new Mr.CancellationError;bn.throwIfCanceled(this.startCancellation.token);let r=[];try{p.info(`Starting Kernel ${Gde(this,this.startupUI)}`),this.createProgressIndicator(r),this.isKernelDead=!1,this._onStatusChanged.fire("starting");let i=await this.sessionCreator.create({resource:this.resourceUri,ui:this.startupUI,kernelConnection:this.kernelConnectionMetadata,token:this.startCancellation.token,creator:this.creator});if(this.disposing)throw new Mr.CancellationError;if(bn.throwIfCanceled(this.startCancellation.token),await this.initializeAfterStart(i),this.disposing)throw new Mr.CancellationError;return this.sendKernelStartedTelemetry(),this._session=i,this._onStarted.fire(),p.info("Kernel successfully started"),i}catch(i){if(this.startupUI.disableUI?p.trace(`failed to create IJupyterKernelConnectionSession in kernel, UI Disabled = ${this.startupUI.disableUI}`,i):!this.startCancellation.token&&!Zt(i)&&p.error(`failed to create IJupyterKernelConnectionSession in kernel, UI Disabled = ${this.startupUI.disableUI}`,i),bn.throwIfCanceled(this.startCancellation.token),i instanceof ks)throw i;let o=y.sessionStartFailedWithKernel(lt(this.kernelConnectionMetadata));throw mt.from(o+" "+("message"in i?i.message:i.toString()),i)}finally{G(r)}}sendKernelStartedTelemetry(){this.uiWasDisabledWhenKernelStartupTelemetryWasLastSent&&this.uiWasDisabledWhenKernelStartupTelemetryWasLastSent===this.startupUI.disableUI||this.startTelemetrySent&&!this.startupUI.disableUI||(this.uiWasDisabledWhenKernelStartupTelemetryWasLastSent=this.startupUI.disableUI===!0,this.startTelemetrySent=!0,Ct(this.resourceUri,"DATASCIENCE.NOTEBOOK_START",void 0,{disableUI:this.startupUI.disableUI}))}createProgressIndicator(e){let t=ut.createProgressReporter(this.resourceUri,y.connectingToKernel(lt(this.kernelConnectionMetadata)),this.startupUI.disableUI);e.push(t),this.startupUI.disableUI&&this.startupUI.onDidChangeDisableUI(()=>{this.disposing||this.disposed||this.startupUI.disableUI||t.show&&t.show()},this,e)}async initializeAfterStart(e){let t=Mr.workspace.notebookDocuments.find(o=>o.uri.toString()===this.uri.toString()),r=kn(t),i=t?r?.postKernelStartup():void 0;try{if(await Promise.all(Array.from(this.hooks.get("didStart")||new Set).map(a=>a(e,this.startCancellation.token).catch(h))),p.trace(`Started running kernel initialization for ${M(this.uri)}`),!e){p.trace("Not running kernel initialization");return}if(!this.hookedSessionForEvents.has(e)){this.hookedSessionForEvents.add(e),e.onDidKernelSocketChange(l=>this._onDidKernelSocketChange.fire(l)),e.onDidDispose(()=>{if(p.ci(`Kernel got disposed as a result of session.onDisposed (1) ${M(this.resourceUri||this.uri)}`),!this._ignoreJupyterSessionDisposedErrors){p.info(`Kernel got disposed as a result of session.onDisposed ${M(this.resourceUri||this.uri)} & _ignoreJupyterSessionDisposedErrors = false.`);let l=this._session===e;this._jupyterSessionPromise=void 0,this._postInitializedOnStartPromise=void 0,this._session=void 0,l&&(this.isKernelDead=!0,this._onStatusChanged.fire("dead"))}});let a=(l,c)=>this._onStatusChanged.fire(c);e.statusChanged.connect(a),this.disposables.push(new Mr.Disposable(()=>ci(()=>e.statusChanged.disconnect(a))))}if(e.kernel?.registerCommTarget(Le.DefaultCommTarget,h),this.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel")this.determineVersionOfIPyWidgets(e).catch(a=>p.error("Failed to determine IPyWidget version",a)),this.gatherInternalStartupCode().then(a=>this.executeSilently(e,a,{traceErrors:!0,traceErrorsMessage:"Error executing jupyter extension internal startup code"})).catch(a=>p.error("Failed to execute internal startup code",a));else{await this.determineVersionOfIPyWidgets(e);let a=await this.gatherInternalStartupCode();await this.executeSilently(e,a,{traceErrors:!0,traceErrorsMessage:"Error executing jupyter extension internal startup code"}),await this.executeSilently(e,this.getUserStartupCommands(),{traceErrors:!1})}i?.stop();let o=r?.kernelInfo();try{p.debug("Requesting Kernel info"),this._info=await M4(e,this.kernelConnectionMetadata,this.workspaceMemento)}catch(a){p.warn("Failed to request KernelInfo",a)}o?.stop();let s=r?.kernelIdle();this.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"&&(p.trace("End running kernel initialization, now waiting for idle"),await e.waitForIdle(this.kernelSettings.launchTimeout,this.startCancellation.token),p.trace("End running kernel initialization, session is idle")),s?.stop()}finally{i?.stop()}}async determineVersionOfIPyWidgets(e){if(!Xe(this.kernelConnectionMetadata)){this._ipywidgetsVersion=pC,this._onIPyWidgetVersionResolved.fire(pC);return}let t=async()=>{let r=K4.default`
        try:
            import ipywidgets as _VSCODE_ipywidgets
            print("${cT}" + _VSCODE_ipywidgets.__version__)
            del _VSCODE_ipywidgets
        except:
            pass
        `,i=await this.executeSilently(e,[r]).catch(o=>p.error("Failed to determine version of IPyWidgets",o));if(Array.isArray(i)){let o=i.some(l=>(l.text||"")?.toString().includes(`${cT}8.`)),s=i.some(l=>(l.text||"")?.toString().includes(`${cT}7.`)),a=this._ipywidgetsVersion=s?7:o?8:void 0;p.trace(`Determined IPyWidgets Version as ${a}`),this._ipywidgetsVersion=a,this._onIPyWidgetVersionResolved.fire(a)}else p.warn("Failed to determine IPyWidgets Version",JSON.stringify(i))};if(await t(),!this._ipywidgetsVersion&&this.session?.kernel){let r=(i,o)=>{if(o.direction==="send")return;let s=o.msg;s.content&&"data"in s.content&&s.content.data&&(s.content.data[zi]||"target_name"in s.content&&s.content.target_name===Le.DefaultCommTarget)&&(this._ipywidgetsVersion||(t().catch(h),this.session?.kernel&&this.session.kernel.anyMessage.disconnect(r,this)))};this.session.kernel.anyMessage.connect(r,this)}}async gatherInternalStartupCode(){let e=[],t=await Promise.all(this.startupCodeProviders.sort((r,i)=>i.priority-r.priority).map(r=>r.getCode(this)));for(let r of t)e.push(...r);if(Xe(this.kernelConnectionMetadata)&&this.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"){let r=Ae(this.resourceUri);if(r&&e.push(`__vsc_ipynb_file__ = "${r.replace(/\\/g,"\\\\")}"`),this.kernelSettings.enableExtendedPythonKernelCompletions||e.push(_h.DisableJedi),e.push(...Hde(this.getMatplotLibInitializeCode(),"Failed to initialize matplotlib startup code. Matplotlib might be missing.")),at(this.kernelConnectionMetadata)&&this.rawKernelSupported?.isSupported===!1&&this.kernelWorkingDirectory){let i=await this.kernelWorkingDirectory.computeWorkingDirectory(this.kernelConnectionMetadata,this.resourceUri,this.startCancellation.token),s=`
import os as _VSCODE_os
try:
    _VSCODE_os.chdir(${Qy(i.fsPath)})
except:
    pass

del _VSCODE_os
`;e.push(s)}}return e}getMatplotLibInitializeCode(){let e=[];if(this.kernelSettings.themeMatplotlibPlots){p.ci(`Initialize config for plots for ${M(this.resourceUri||this.uri)}`);let t=_h.MatplotLibInit;p.trace(`Initialize matplotlib for ${M(this.resourceUri||this.uri)}`),e.push(...Be(t,{trim:!1}));let r=Mr.window.activeColorTheme.kind===Mr.ColorThemeKind.Dark;e.push(r?"matplotlib.style.use('dark_background')":`matplotlib.rcParams.update(${Le.MatplotLibDefaultParams})`)}return e}getUserStartupCommands(){let e=this.kernelSettings.runStartupCommands;if(Array.isArray(e)&&(e=e.join(`
`)),e){let t=e.replace(/\\n/g,`
`);return Be(t,{trim:!1})}return[]}async executeSilently(e,t,r){if(t.join("").trim().length!==0){if(!e.kernel){p.trace(`Not executing startup as there is no session, code: ${t}`);return}return gn(e.kernel,t.join(`
`),r)}}},dT=class extends uT{get creator(){return"3rdPartyExtension"}constructor(e,t,r,i,o,s,a,l,c){super(`3rdPartyKernel_${lr()}`,e,t,r,i,o,s,"3rdPartyExtension",a,l,c)}},pT=class extends uT{constructor(t,r,i,o,s,a,l,c,u,d){super(lr(),r.uri,t,i,o,s,l,"jupyterExtension",c,u,d);this.notebook=r;this.controller=a}get creator(){return"jupyterExtension"}};function Hde(n,e){return!n||n.length===0||(n=n.map(t=>`    ${t}`),n.unshift("try:"),n.push("except:",`    print('${e}')`)),n}function fT(n){if(n.length>0){let e=n[0].data;if(e&&e.hasOwnProperty("text/plain"))return _s(e["text/plain"]);if(n[0].output_type==="stream"){let t=n[0];return _s(t.text)}}}function Gde(n,e){let t=n.kernelConnectionMetadata.interpreter,r=[];if(t){r.push(`Python Path: ${M(t.uri)}`),r.push(t?Ue(t):"");let i=Ri(t);i&&r.push(`${i.major}.${i.minor}.${i.micro}`)}else(n.kernelConnectionMetadata.kind==="startUsingLocalKernelSpec"||n.kernelConnectionMetadata.kind==="startUsingRemoteKernelSpec")&&r.push(n.kernelConnectionMetadata.kernelSpec.display_name);return`(${r.filter(i=>i).join(", ")}) for '${M(n.uri)}' (disableUI=${e.disableUI})`}function lF(n,e){return{get enableExtendedPythonKernelCompletions(){return n.getSettings(e).enableExtendedPythonKernelCompletions},get interruptTimeout(){return n.getSettings(e).jupyterInterruptTimeout},get launchTimeout(){return n.getSettings(e).jupyterLaunchTimeout},get runStartupCommands(){return n.getSettings(e).runStartupCommands},get themeMatplotlibPlots(){return n.getSettings(e).themeMatplotlibPlots}}}var Cf=require("vscode");var uF=require("vscode");var cF=k(iM()),br=require("vscode");var hT=k(km());var Yy=new WeakMap;function bu(n){if(n.parent_header&&"msg_id"in n.parent_header)return n.parent_header.msg_id}var Ip=class Ip{constructor(e,t,r,i,o,s,a,l){this.cell=e;this.controller=t;this.context=r;this.formatters=i;this.kernel=o;this.request=s;this._onErrorHandlingIOPubMessage=new br.EventEmitter;this.onErrorHandlingExecuteRequestIOPubMessage=this._onErrorHandlingIOPubMessage.event;this.outputsAreSpecificToAWidget=[];this.commIdsMappedToParentWidgetModel=new Map;this.disposables=[];this.prompts=new Set;this.ownedCommIds=new Set;this.commIdsMappedToWidgetOutputModels=new Set;this.ownedRequestMsgIds=new Set;this._completed=ne();this.gotIdleIOPubStatus=!1;this.gotShellReply=!1;this.streamsReAttachedToExecutingCell=!1;this._completed.promise.catch(h),this.executeRequestMessageId=l,this.ownedRequestMsgIds.add(l),br.workspace.onDidChangeNotebookDocument(c=>{if(!St(c.notebook))return;let u=c.cellChanges.find(({cell:d})=>d===this.cell);u&&u.outputs?.length===0&&(this.clearLastUsedStreamOutput(),this.cellHasErrorsInOutput=!1)},this,this.disposables),this.execution=a,this.kernel.anyMessage.connect(this.onKernelAnyMessage,this),this.kernel.iopubMessage.connect(this.onKernelIOPubMessage,this),s&&(s.onIOPub=()=>{this.cell.document.isClosed&&!this.completedExecution&&s.dispose()},s.onReply=c=>{if(this.cell.document.isClosed){s.dispose();return}this.handleReply(c)},s.onStdin=this.handleInputRequest.bind(this),s.done.finally(()=>{this.completedExecution=!0,this.endCellExecution()}).catch(h))}static{this.modelIdsOwnedByCells=new WeakMap}get hasErrorOutput(){return this.cellHasErrorsInOutput===!0}static{this.outputsOwnedByWidgetModel=new Map}get completed(){return this._completed.promise}dispose(){this.disposed||(this.disposed=!0,ct(this.cell,"Execution Message Handler disposed"),G(this.disposables),this.prompts.forEach(e=>e.dispose()),this.prompts.clear(),this.request&&this.clearLastUsedStreamOutput(),this.execution=void 0,this.kernel.anyMessage.disconnect(this.onKernelAnyMessage,this),this.kernel.iopubMessage.disconnect(this.onKernelIOPubMessage,this),this._onErrorHandlingIOPubMessage.dispose())}endCellExecution(){this.prompts.forEach(e=>e.dispose()),this.prompts.clear(),this.request&&this.clearLastUsedStreamOutput(),this.execution=void 0,this._completed.resolve()}onKernelAnyMessage(e,{direction:t,msg:r}){if(this.cell.document.isClosed)return this.endCellExecution();let i=require("@jupyterlab/services");if(!this.request&&t==="recv"){let o=bu(r);i.KernelMessage.isStatusMsg(r)&&r.content.execution_state==="idle"&&o===this.executeRequestMessageId&&(this.gotIdleIOPubStatus=!0),r.channel==="shell"&&o===this.executeRequestMessageId&&(this.gotShellReply=!0);let s=i.KernelMessage.isStatusMsg(r)&&r.content.execution_state!=="idle"&&o!==this.executeRequestMessageId;typeof r.parent_header=="object"&&r.parent_header&&"msg_type"in r.parent_header&&r.parent_header.msg_type;let a=o?o!==this.executeRequestMessageId&&!s:!1,l=typeof r.parent_header=="object"&&r.parent_header&&"msg_type"in r.parent_header&&r.parent_header.msg_type==="interrupt_request",c=this.gotIdleIOPubStatus&&this.gotShellReply,u=["kernel_info_reply","execute_input","execute_reply"],d="msg_type"in r&&typeof r.msg_type=="string"&&u.includes(r.msg_type);if(!this.completedExecution&&c)return this.completedExecution=!0,this.endAbnormallyTimeout&&clearTimeout(this.endAbnormallyTimeout),this.endCellExecution();if(!this.completedExecution&&(d||a)){this.endAbnormallyTimeout&&clearTimeout(this.endAbnormallyTimeout),this.endAbnormallyTimeout=setTimeout(()=>(this.completedExecution=!0,this.endAbnormallyTimeout=void 0,this.endCellExecution()),l?1e3:100),this.disposables.push(new br.Disposable(()=>{clearTimeout(this.endAbnormallyTimeout),this.endAbnormallyTimeout=void 0}));return}}t!=="send"||!this.completedExecution||i.KernelMessage.isCommMsgMsg(r)&&this.ownedCommIds.has(r.content.comm_id)&&this.ownedRequestMsgIds.add(r.header.msg_id)}onKernelIOPubMessage(e,t){if(this.cell.document.isClosed)return this.endCellExecution();if(!(!t.parent_header||!("msg_id"in t.parent_header)||!this.ownedRequestMsgIds.has(t.parent_header.msg_id)||t.channel!=="iopub"))try{this.handleIOPub(t)}catch(r){p.error("Failed to handle iopub message as a result of some comm message",t,r),!this.completedExecution&&!this.cell.document.isClosed&&this._onErrorHandlingIOPubMessage.fire(r)}}clearLastUsedStreamOutput(){this.lastUsedStreamOutput=void 0}createTemporaryTask(e){if(this.cell.document.isClosed)return;let t=Yy.get(this.cell.notebook);return t&&(!e||e&&t.cell.index===this.cell.index)?t:(this.previousResultsToRestore={...this.cell.executionSummary||{}},this.temporaryExecution=Ki.getOrCreate(this.cell,this.controller),this.temporaryExecution?.start(),this.previousResultsToRestore?.executionOrder&&this.temporaryExecution&&(this.temporaryExecution.executionOrder=this.previousResultsToRestore.executionOrder),this.temporaryExecution)}endTemporaryTask(){this.previousResultsToRestore?.executionOrder&&this.execution&&(this.execution.executionOrder=this.previousResultsToRestore.executionOrder),this.previousResultsToRestore&&this.temporaryExecution?(this.previousResultsToRestore.executionOrder&&(this.temporaryExecution.executionOrder=this.previousResultsToRestore.executionOrder),this.temporaryExecution.end(this.previousResultsToRestore.success,this.previousResultsToRestore.timing?.endTime)):this.temporaryExecution?.end(void 0),this.previousResultsToRestore=void 0,this.temporaryExecution=void 0}handleIOPub(e){this.startTime||(this.startTime=new Date().getTime(),this.execution?.start(this.startTime),p.debug(`Kernel acknowledged execution of cell ${this.cell.index} @ ${this.startTime}`));let t=require("@jupyterlab/services");if(t.KernelMessage.isCommOpenMsg(e))this.handleCommOpen(e);else if(t.KernelMessage.isExecuteResultMsg(e))this.handleExecuteResult(e);else if(t.KernelMessage.isExecuteInputMsg(e))this.handleExecuteInput(e);else if(t.KernelMessage.isStatusMsg(e)){let r=e;this.handleStatusMessage(r)}else t.KernelMessage.isStreamMsg(e)?this.handleStreamMessage(e):t.KernelMessage.isDisplayDataMsg(e)?this.handleDisplayData(e):t.KernelMessage.isUpdateDisplayDataMsg(e)?this.handleUpdateDisplayDataMessage(e):t.KernelMessage.isClearOutputMsg(e)?this.handleClearOutput(e):t.KernelMessage.isErrorMsg(e)?this.handleError(e):t.KernelMessage.isCommOpenMsg(e)||(t.KernelMessage.isCommMsgMsg(e)?this.handleCommMsg(e):t.KernelMessage.isCommCloseMsg(e)||p.warn(`Unknown message ${e.header.msg_type} : hasData=${"data"in e.content}`));"execution_count"in e.content&&typeof e.content.execution_count=="number"&&this.execution&&(this.execution.executionOrder=e.content.execution_count)}handleCommOpen(e){this.ownedCommIds.add(e.content.comm_id);let t=e.content.data?.state||void 0;e.content.target_name===Le.DefaultCommTarget&&t&&t._model_module==="@jupyter-widgets/output"&&this.commIdsMappedToWidgetOutputModels.add(e.content.comm_id)}handleCommMsg(e){let t=e.content.data;if(!(!t||t.method!=="update"||typeof t.state!="object")){if("msg_id"in t.state&&typeof t.state.msg_id=="string"){let r="msg_id"in e.parent_header?e.parent_header:void 0;(this.ownedRequestMsgIds.has(e.content.comm_id)||r&&this.ownedRequestMsgIds.has(r.msg_id))&&(t.state.msg_id?this.outputsAreSpecificToAWidget.push({handlingCommId:e.content.comm_id,msgIdsToSwallow:t.state.msg_id}):this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].handlingCommId===e.content.comm_id&&this.outputsAreSpecificToAWidget.pop())}else if("children"in t.state&&Array.isArray(t.state.children)&&this.ownedCommIds.has(e.content.comm_id)){let r="IPY_MODEL_";t.state.children.forEach(i=>{if(typeof i!="string")return p.warn("Came across a comm update message a child that isn't a string",i);if(!i.startsWith(r))return p.warn(`Came across a comm update message a child that start start with ${r}`,i);let o=i.substring(r.length);this.ownedCommIds.add(o),this.commIdsMappedToParentWidgetModel.set(o,e.content.comm_id)})}}}clearOutputIfNecessary(e){return this.clearOutputOnNextUpdateToOutput?(ct(this.cell,"Clear cell output"),this.clearLastUsedStreamOutput(),e?.clearOutput().then(h,h),this.clearOutputOnNextUpdateToOutput=!1,{previousValueOfClearOutputOnNextUpdateToOutput:!0}):{previousValueOfClearOutputOnNextUpdateToOutput:!1}}addToCellData(e,t){if(e.data&&typeof e.data=="object"&&zi in e.data){let l=e.data[zi];if(l&&this.context.extensionMode===br.ExtensionMode.Test&&(l._vsc_test_cellIndex=this.cell.index),l&&"model_id"in l){let c=Ip.modelIdsOwnedByCells.get(this.cell)||new Set;c.add(l.model_id),Ip.modelIdsOwnedByCells.set(this.cell,c)}}let r=vo(e),i="transient"in e&&typeof e.transient=="object"&&e.transient&&"display_id"in e.transient&&typeof e.transient?.display_id=="string"?e.transient?.display_id:void 0;if(this.cell.document.isClosed)return;ct(this.cell,()=>`Update output with mimes ${r.items.map(l=>l.mime).toString()}`);let o=this.getOrCreateExecutionTask(!0);this.clearOutputIfNecessary(o),i&&Zr.trackOutputByDisplayId(this.cell,i,r,r.items),this.clearLastUsedStreamOutput(),ct(this.cell,"Append output in addToCellData");let s=!0,a=bu(t);(this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].msgIdsToSwallow===a&&r.items.every(l=>this.canMimeTypeBeRenderedByWidgetManager(l))||this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].msgIdsToSwallow===a&&this.updateJupyterOutputWidgetWithOutput({commId:this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].handlingCommId,outputToAppend:r},o)?.outputAdded)&&(s=!1),s&&o?.appendOutput([r]).then(h,h),this.endTemporaryTask()}canMimeTypeBeRenderedByWidgetManager(e){let t=e.mime;if(t=="application/vnd.code.notebook.stderr"||t=="application/vnd.code.notebook.stdout"||t=="application/vnd.code.notebook.error")return!0;if(t===zi){let r=JSON.parse(new TextDecoder().decode(e.data));return typeof r.model_id=="string"&&this.commIdsMappedToWidgetOutputModels.has(r.model_id)?F4():!0}return t.startsWith("application/vnd")?F4():!0}updateJupyterOutputWidgetWithOutput(e,t){let r=this.outputsAreSpecificToAWidget.length?this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].handlingCommId:void 0,i="commId"in e?e.commId:r;if(!i)return;let o="outputToAppend"in e?e.outputToAppend:void 0,s=this.commIdsMappedToParentWidgetModel.get(i)||i,a=this.cell.notebook.getCells().find(w=>Ip.modelIdsOwnedByCells.get(w)?.has(s));if(!a){p.warn(`Unable to find a cell that owns the model ${s}`);return}let l=a.outputs.find(w=>w.items.find(_=>{if(_.mime!==zi)return!1;try{return JSON.parse(new TextDecoder().decode(_.data)).model_id===s}catch(A){p.warn("Failed to deserialize the widget data",A)}return!1}));if(!l)return;let c=Ip.outputsOwnedByWidgetModel.get(s)||new Set,d=("clearOutput"in e?e.clearOutput:!1)||(this.outputsAreSpecificToAWidget.length?this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].clearOutputOnNextUpdateToOutput===!0:!1);this.outputsAreSpecificToAWidget.length&&(this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].clearOutputOnNextUpdateToOutput=!1);let f=a.outputs.slice().filter(w=>d?!c.has(w.id):!0),g=f.slice(0,f.indexOf(l)+1),b=f.slice(f.indexOf(l)+1);Ip.outputsOwnedByWidgetModel.set(s,c),o&&c.add(o.id);let I=o?g.concat(o).concat(b):g.concat(b);return b.length===0&&o?t?.appendOutput(o,a).then(h,h):d&&!o&&b.length===0||t?.replaceOutput(I,a).then(h,h),{outputAdded:!0}}async handleInputRequest(e){if(e.content&&"prompt"in e.content){let t=new br.CancellationTokenSource;this.prompts.add(t);let r=e.content.password!==null&&e.content.password;await br.window.showInputBox({prompt:e.content.prompt?e.content.prompt.toString():"",ignoreFocusOut:!0,password:r},t.token).then(i=>{this.kernel.sendInputReply({value:i||"",status:"ok"},e.header)},h),this.prompts.delete(t)}}handleExecuteResult(e){this.addToCellData({output_type:"execute_result",data:e.content.data,metadata:e.content.metadata,transient:e.content.transient,execution_count:e.content.execution_count},e)}handleExecuteReply(e){let t=e.content;t.payload&&t.payload.forEach(r=>{r.source&&r.source==="set_next_input"&&"text"in r&&"replace"in r&&this.handleSetNextInput(r),r.data&&r.data.hasOwnProperty("text/plain")&&this.addToCellData({output_type:"stream",text:r.data["text/plain"].toString(),name:"stdout",metadata:{},execution_count:t.execution_count},e)})}handleSetNextInput(e){let t=new br.WorkspaceEdit;if(e.replace)t.replace(this.cell.document.uri,new br.Range(this.cell.document.lineAt(0).range.start,this.cell.document.lineAt(this.cell.document.lineCount-1).range.end),e.text);else{ct(this.cell,"Create new cell after current");let r=new br.NotebookCellData(br.NotebookCellKind.Code,e.text,this.cell.document.languageId);r.outputs=[],r.metadata={};let i=br.NotebookEdit.insertCells(this.cell.index+1,[r]);t.set(this.cell.notebook.uri,[i])}br.workspace.applyEdit(t).then(h,h)}handleExecuteInput(e){e.content.execution_count&&this.execution&&(this.execution.executionOrder=e.content.execution_count)}handleStatusMessage(e){ct(this.cell,`Kernel switching to ${e.content.execution_state}`)}getOrCreateExecutionTask(e){return!e&&this.execution?this.execution:this.execution?.cell===this.cell?this.execution:this.createTemporaryTask(e)}handleStreamMessage(e){if(bu(e)&&this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].msgIdsToSwallow==bu(e)||e.parent_header.msg_type==="comm_msg"&&e.header.msg_type==="stream")return;ct(this.cell,`Update streamed output, new output '${e.content.text.substring(0,100)}'`);let t=this.getOrCreateExecutionTask(!0),r=e.content.name==="stdout"?br.NotebookCellOutputItem.stdout("").mime:br.NotebookCellOutputItem.stderr("").mime;!this.request&&!this.streamsReAttachedToExecutingCell&&!this.lastUsedStreamOutput&&this.cell.outputs.length&&this.cell.outputs[this.cell.outputs.length-1].items.length>=1&&this.cell.outputs[this.cell.outputs.length-1].items.every(o=>o.mime===r)&&(this.lastUsedStreamOutput={output:this.cell.outputs[0],stream:e.content.name}),this.streamsReAttachedToExecutingCell=!0;let{previousValueOfClearOutputOnNextUpdateToOutput:i}=this.clearOutputIfNecessary(t);if(this.lastUsedStreamOutput?.stream===e.content.name){let o=vo({output_type:"stream",name:e.content.name,text:e.content.text});ct(this.cell,`Append output items '${e.content.text.substring(0,100)}`),t?.appendOutputItems(o.items,this.lastUsedStreamOutput.output).then(h,h)}else if(i){let o=_s(e.content.text),s=vo({output_type:"stream",name:e.content.name,text:o});this.lastUsedStreamOutput={output:s,stream:e.content.name},ct(this.cell,`Replace output with '${o.substring(0,100)}'`),t?.replaceOutput([s]).then(h,h)}else{let o=N$(_s(e.content.text)),s=vo({output_type:"stream",name:e.content.name,text:o});this.lastUsedStreamOutput={output:s,stream:e.content.name},ct(this.cell,`Append new output '${o.substring(0,100)}'`),t?.appendOutput([s]).then(h,h)}this.endTemporaryTask()}handleDisplayData(e){let t={output_type:"display_data",data:XC(e.content.data),metadata:e.content.metadata,transient:e.content.transient};this.addToCellData(t,e)}handleClearOutput(e){if(this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].msgIdsToSwallow===bu(e)){if(e.content.wait)this.outputsAreSpecificToAWidget.length&&(this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].clearOutputOnNextUpdateToOutput=!0);else{let t=this.getOrCreateExecutionTask(!0);this.updateJupyterOutputWidgetWithOutput({clearOutput:!0},t),this.endTemporaryTask()}return}if(e.content.wait)this.clearOutputOnNextUpdateToOutput=!0;else{let t=this.getOrCreateExecutionTask(!0);this.clearLastUsedStreamOutput(),t?.clearOutput().then(h,h),this.endTemporaryTask()}}handleError(e){let t=e.content.traceback;p.ci(`Traceback for error ${t}`),this.formatters.forEach(i=>{t=i.format(this.cell,t)}),p.ci(`Traceback for error after formatting ${t}`);let r={output_type:"error",ename:e.content.ename,evalue:e.content.evalue,traceback:t};if(this.cell.notebook.notebookType!=="interactive"){let i=Ki.get(this.cell);i&&e.content.ename!=="KeyboardInterrupt"&&(i.errorInfo={name:e.content.ename,message:e.content.evalue,location:DJ(e.content.traceback,this.cell),uri:this.cell.document.uri,stack:e.content.traceback.join(`
`)})}this.addToCellData(r,e),this.cellHasErrorsInOutput=!0}handleReply(e){require("@jupyterlab/services").KernelMessage.isExecuteReplyMsg(e)&&(this.handleExecuteReply(e),"execution_count"in e.content&&typeof e.content.execution_count=="number"&&this.execution&&(this.execution.executionOrder=e.content.execution_count))}handleUpdateDisplayDataMessage(e){let t=e.content.transient.display_id;if(!t){p.warn("Update display data message received, but no display id",e.content);return}let r=Zr.getMappedOutput(this.cell.notebook,t);if(!r){p.trace("Update display data message received, but no output found to update",e.content);return}if(r.cell.document.isClosed){p.warn("Update display data message received, but output cell is closed",e.content);return}let i=fM(new br.NotebookCellOutput(r.outputItems,r.outputContainer.metadata)),o=vo({...i,data:e.content.data,metadata:e.content.metadata});if(r.outputItems.length===0&&o.items.length===0){p.trace("Update display data message received, but no output to update",e.content);return}let s=!1;if(r.outputItems.length===o.items.length){let a=!0;if((0,cF.default)(r.outputContainer.metadata||{},o.metadata||{})||(s=!0,a=!1),a){for(let l=0;l<r.outputItems.length;l++)if(!(0,cF.default)(r.outputItems[l],o.items[l])){a=!1;break}}if(a){p.trace("Update display data message received, but no output to update (data is the same)",e.content);return}}if(ct(this.cell,`Replace output items in display data ${o.items.length}`),s){let a=r.cell.outputs.map(c=>{let u=fM(c);return u.output_type==="display_data"&&"transient"in u&&u.transient&&typeof u.transient=="object"&&"display_id"in u.transient&&typeof u.transient.display_id=="string"&&u.transient.display_id===t?o:c});this.getOrCreateExecutionTask(!1)?.replaceOutput(a,r.cell).then(h,h),Zr.trackOutputByDisplayId(r.cell,t,o,o.items)}else this.getOrCreateExecutionTask(!1)?.replaceOutputItems(o.items,r.outputContainer).then(h,h),Zr.trackOutputByDisplayId(r.cell,t,r.outputContainer,o.items);this.endTemporaryTask()}};v([Yr()],Ip.prototype,"handleReply",1);var iw=Ip;function F4(){let n=br.extensions.getExtension(id);if(!n)return!1;let e=(0,hT.coerce)(n.packageJSON.version);return e?e.compare(new hT.SemVer("1.1.0"))>=0:!1}var Iu=class extends Error{constructor(e){super(e.evalue||e.ename),this.ename=e.ename,this.evalue=e.evalue,this.traceback=e.traceback}};var gT=class{constructor(e,t){this.controller=e;this.requestListener=t}create(e,t,r,i){return dF.fromCell(e,t,r,this.controller,this.requestListener,i)}},dF=class n{constructor(e,t,r,i,o,s){this.cell=e;this.codeOverride=t;this.kernelConnection=r;this.controller=i;this.requestListener=o;this.resumeExecution=s;this.type="cell";this._result=ne();this.cancelHandled=!1;this.disposables=[];if(uF.workspace.onDidCloseTextDocument(a=>{if(a===this.cell.document){p.info(`Disposing request as the cell (${this.cell.index}) was deleted ${M(this.cell.notebook.uri)}`);try{this.request?.dispose()}catch(l){p.error(`Error during cell execution dispose: ${l}`)}this.started&&!this._completed&&this.completedDueToCancellation()}},this,this.disposables),this.canExecuteCell())this.execution=Ki.getOrCreate(e,this.controller,!s?.msg_id),Td.setCellState(e,2);else{let a=Ki.get(e);a&&(a.start(),a.end(void 0))}}get result(){return this._result.promise}get executionOrder(){return this._executionOrder}static fromCell(e,t,r,i,o,s){return new n(e,t,r,i,o,s)}async start(e){if(this.session=e,this.resumeExecution?.msg_id)return this.resume(e,this.resumeExecution);if(this.cancelHandled){ct(this.cell,"Not starting as it was cancelled");return}if(ct(this.cell,"Start execution"),p.ci(`Cell Exec contents ${this.cell.document.getText().substring(0,50)}...`),!this.canExecuteCell()){this.execution?.end(void 0),this.execution=void 0,this._result.resolve();return}return e.kind==="remoteJupyter"&&e.status==="unknown"&&(!e.kernel||e.kernel.isDisposed||e.isDisposed)?(this.execution?.start(),this.execution?.clearOutput().then(h,h),this.completedWithErrors(new hn),this.result):this.started?(ct(this.cell,"Cell has already been started yet CellExecution.Start invoked again"),p.error(`Cell has already been started yet CellExecution.Start invoked again ${this.cell.index}`),this.result):(this.started=!0,Yy.set(this.cell.notebook,this.execution),Td.setCellState(this.cell,3),this.execute(this.codeOverride||this.cell.document.getText().replace(/\r\n/g,`
`),e).catch(t=>this.completedWithErrors(t)).catch(h),this.result)}async resume(e,t){if(this.cancelHandled){ct(this.cell,"Not resuming as it was cancelled");return}if(!e.kernel)throw new Error("Kernel not available to resume execution");if(ct(this.cell,"Start resuming execution"),p.ci(`Cell Exec (resuming) contents ${this.cell.document.getText().substring(0,50)}...`),!this.canExecuteCell()){this.execution?.end(void 0),this.execution=void 0,this._result.resolve();return}return this.started?(p.error(`Cell has already been started yet CellExecution.resume invoked again ${this.cell.index}`),this.result):(this.started=!0,Yy.set(this.cell.notebook,this.execution),this.execution?.start(t.startTime),t.executionCount&&this.execution&&(this.execution.executionOrder=t.executionCount),Td.setCellState(this.cell,3),this.cellExecutionHandler=this.requestListener.registerListenerForResumingExecution(this.cell,{kernel:e.kernel,cellExecution:this.execution,msg_id:t.msg_id}),this.cellExecutionHandler.onErrorHandlingExecuteRequestIOPubMessage(r=>{p.error(`Cell (index = ${this.cell.index}) execution completed with errors (2).`,r),this.completedWithErrors(r.error)},this,this.disposables),this.cellExecutionHandler.completed.finally(()=>this.completedSuccessfully()).catch(h),this.result)}async cancel(e=!1){if(!this.cancelHandled){if(this.cancelRequested=!0,this.started&&!e&&this.execution?.started){ct(this.cell,"Cell is already running, waiting for it to finish or kernel to start"),await this.result.catch(h);return}this.cancelHandled||this._completed||(ct(this.cell,"Execution cancelled"),this.cancelHandled=!0,this.completedDueToCancellation(),this.dispose())}}dispose(){this.disposed||(this.disposed=!0,ct(this.cell,"Execution disposed"),G(this.disposables))}completedWithErrors(e,t,r=!0){if(!this.cancelHandled){if(!this.disposed&&!this.cancelRequested?p.warn("Cell completed with errors",e):p.warn(`Cell completed with errors (${this.disposed?"disposed":"cancelled"})`),ct(this.cell,"Completed with errors"),r){let i,o;e&&!(e instanceof $e)&&e.message?.includes("Canceled future for execute_request message before replies were done")&&this.session&&O4(this.session)&&(e=new hn),e&&(e instanceof $e?i=Sm(uF.workspace.workspaceFolders||[],e,lt(this.kernelConnection),Qh(this.kernelConnection.interpreter))?.message:i=e.message||e.name||e.stack),o=sg(i||""),o&&this.execution?.appendOutput(o).then(h,h)}this.endCellTask("failed",t),ct(this.cell,"Completed with errors, & resolving"),this._result.reject(e)}}get isEmptyCodeCell(){return this.cell.document.getText().trim().length===0}completedSuccessfully(e){ct(this.cell,"Completed successfully");let t="success";this.endCellTask("success",e),ct(this.cell,`Completed successfully & resolving with status = ${t}`),this._result.resolve()}endCellTask(e,t=new Date().getTime()){if(!this._completed){if(this._completed=!0,this.isEmptyCodeCell)this.execution&&(this.execution.executionOrder=void 0),this.execution?.end(void 0);else if(e==="success"||e==="failed")this.endTime=t,this.execution?.end(e==="success",this.endTime);else{try{this.request?.dispose()}catch{}this.execution?.end(void 0)}Yy.get(this.cell.notebook)===this.execution&&Yy.set(this.cell.notebook,void 0),this._executionOrder=this.execution?.executionOrder,Td.setCellState(this.cell,1),this.execution=void 0}}completedDueToCancellation(){ct(this.cell,"Completed due to cancellation"),this.endCellTask("cancelled"),ct(this.cell,"Cell cancelled & resolving"),this._result.resolve()}canExecuteCell(){return this.cell.document.languageId==="raw"?!1:!this.cell.document.isClosed}async execute(e,t){if(!t.kernel)throw new Error("No kernel available to execute code");if(ct(this.cell,"Send code for execution"),e.trim().length===0||this.cell.document.isClosed)return e.trim().length===0&&(this.execution?.start(this.resumeExecution?.startTime),this.execution?.clearOutput()?.then(h,h)),ct(this.cell,"Empty cell execution"),this.completedSuccessfully();let r={cellId:this.cell.document.uri.toString(),...Ed(this.cell).metadata},i=t.kernel;try{ar.changeCellState(this.cell,3),p.trace(`Cell Index:${this.cell.index} sent to kernel`),this.request=i.requestExecute({code:e,silent:!1,stop_on_error:!1,allow_stdin:!0,store_history:!0},!1,r),this.request.done.then(h,h)}catch(o){return p.error(`Cell execution failed without request, for cell Index ${this.cell.index}`,o),this.completedWithErrors(o)}this.cellExecutionHandler=this.requestListener.registerListenerForExecution(this.cell,{kernel:i,cellExecution:this.execution,request:this.request}),this.cellExecutionHandler.onErrorHandlingExecuteRequestIOPubMessage(o=>{p.error(`Cell (index = ${this.cell.index}) execution completed with errors (2).`,o),this.completedWithErrors(o.error)},this,this.disposables);try{ct(this.cell,"Wait for jupyter execution");let o=await this.request.done,s=new Date().getTime();ct(this.cell,"Jupyter execution completed"),o.content.status==="error"?this.completedWithErrors(new Iu(o.content),s,!1):this.completedSuccessfully(s),ct(this.cell,"Executed successfully in executeCell")}catch(o){if(this.cancelHandled)return;!this.disposed&&!this.cancelRequested&&p.error("Error in waiting for cell to complete",o),ct(this.cell,"Some other execution error"),o&&o instanceof Error&&Zt(o,!0)?this.completedWithErrors({message:o.message}):this.completedWithErrors(o)}}};var L4=require("vscode");var vT=class{constructor(e,t,r,i){this.controller=e;this.context=t;this.formatters=r;this.notebook=i;this.disposables=[];this.messageHandlers=new WeakMap;L4.workspace.onDidChangeNotebookDocument(o=>{o.notebook===this.notebook&&o.contentChanges.forEach(s=>s.removedCells.forEach(a=>this.messageHandlers.get(a)?.dispose()))},this,this.disposables)}dispose(){G(this.disposables),this.notebook&&this.notebook.getCells().forEach(e=>this.messageHandlers.get(e)?.dispose())}registerListenerForExecution(e,t){this.messageHandlers.get(e)?.dispose();let r=new iw(e,this.controller,this.context,this.formatters,t.kernel,t.request,t.cellExecution,t.request.msg.header.msg_id);return this.messageHandlers.set(e,r),r}registerListenerForResumingExecution(e,t){this.messageHandlers.get(e)?.dispose();let r=new iw(e,this.controller,this.context,this.formatters,t.kernel,void 0,t.cellExecution,t.msg_id);return this.messageHandlers.set(e,r),r}};var yT=require("vscode");function sc(n,e,t){n!==_e&&p.trace(`Execution Id:${e}. ${t}.`)}var U4=new Map,Xy=class n{constructor(e,t){this.code=e;this.extensionId=t;this.type="code";this._onDidEmitOutput=new yT.EventEmitter;this.onDidEmitOutput=this._onDidEmitOutput.event;this._onRequestSent=new yT.EventEmitter;this.onRequestSent=this._onRequestSent.event;this._onRequestAcknowledge=new yT.EventEmitter;this.onRequestAcknowledged=this._onRequestAcknowledge.event;this._done=ne();this.cancelHandled=!1;this.disposables=[];let r=U4.get(t)||0;r+=1,U4.set(t,r),this.executionId=`${t}-${r}`,this.disposables.push(this._onDidEmitOutput)}get done(){return this._done.promise}get result(){return this._done.promise}static fromCode(e,t){return new n(e,t)}async start(e){if(this.session=e,this.cancelHandled){sc(this.extensionId,this.executionId,"Not starting as it was cancelled");return}if(sc(this.extensionId,this.executionId,"Start Code execution"),p.ci(`Code Exec contents ${this.code.substring(0,50)}...`),!e.kernel||e.kernel.isDisposed||e.isDisposed){this._done.reject(new hn);return}if(this.started)return sc(this.extensionId,this.executionId,"Code has already been started yet CodeExecution.Start invoked again"),p.error(`Code has already been started yet CodeExecution.Start invoked again ${this.executionId}`),this.done;await this.execute(this.code.replace(/\r\n/g,`
`),e).catch(h)}async cancel(){if(!(this.cancelHandled||this._completed)){if(this.cancelRequested=!0,this.started){sc(this.extensionId,this.executionId,"Code is already running, interrupting and waiting for it to finish or kernel to start");let e=this.session?.kernel;e&&this.extensionId!==_e&&await e.interrupt().catch(h),this.request?.dispose(),await this.request?.done.catch(h)}this.cancelHandled||this._completed||(sc(this.extensionId,this.executionId,"Execution cancelled"),this.cancelHandled=!0,this._done.resolve(),this.dispose())}}dispose(){this.disposed||(this.disposed=!0,this._completed||sc(this.extensionId,this.executionId,"Execution disposed"),G(this.disposables))}async execute(e,t){if(!t.kernel){let i=new Error("No kernel available to execute code");throw this._done.resolve(),i}sc(this.extensionId,this.executionId,"Send code for execution");let r=t.kernel;try{this.started=!0,this._onRequestSent.fire(),sc(this.extensionId,this.executionId,"Execution Request Sent to Kernel"),this.request=IJ(r,e,()=>this._onRequestAcknowledge.fire(),i=>this._onDidEmitOutput.fire(i)),this.request.done.then(h,h)}catch(i){p.error(`Code execution failed without request, for exec ${this.executionId}`,i),this._completed=!0,this._done.reject(i);return}try{let i=await this.request.done;this._completed=!0,i.content.status==="error"?(sc(this.extensionId,this.executionId,"Executed with errors"),this._done.reject(new Iu(i.content))):(sc(this.extensionId,this.executionId,"Executed successfully"),this._done.resolve())}catch(i){if(this._completed=!0,this.cancelHandled)return;!this.disposed&&!this.cancelRequested&&p.error(`Error in waiting for code ${this.executionId} to complete`,i),this._done.reject(i)}}};var bT=class{constructor(e,t,r,i){this.session=e;this.executionFactory=t;this.metadata=r;this.resourceUri=i;this.queueOfItemsToExecute=[];this.cancelledOrCompletedWithErrors=!1;this.startedRunningCells=!1;this.disposables=[]}get queueOfCellsToExecute(){return this.queueOfItemsToExecute.filter(e=>e.type==="cell").map(e=>e)}get isEmpty(){return this.queueOfItemsToExecute.length===0}get failed(){return this.cancelledOrCompletedWithErrors}get queue(){return this.queueOfCellsToExecute.map(e=>e.cell)}dispose(){this.disposables.forEach(e=>e.dispose()),this.lastCellExecution?.dispose()}queueCell(e,t){this.enqueue({cell:e,codeOverride:t})}queueCode(e,t,r){return this.enqueue({code:e,extensionId:t,token:r})}enqueue(e){let t;if("cell"in e){let{cell:r,codeOverride:i}=e,o=this.queueOfCellsToExecute.find(a=>a.cell===r);if(o)return ct(r,"Use existing cell execution"),o;let s=this.executionFactory.create(r,i,this.metadata);t=s,this.disposables.push(s),this.queueOfItemsToExecute.push(s),ct(r,"User queued cell for execution")}else{let{code:r,extensionId:i,token:o}=e,s=Xy.fromCode(r,i);t=s,this.disposables.push(s),this.queueOfItemsToExecute.push(s),this.disposables.push(ba(o.onCancellationRequested)(()=>s.cancel()))}return this.startExecutingCells(),t}resumeCell(e,t){if(this.queueOfCellsToExecute.find(o=>o.cell===e)){ct(e,"Use existing cell execution");return}let i=this.executionFactory.create(e,"",this.metadata,t);this.disposables.push(i),this.queueOfItemsToExecute.push(i),ct(e,"User queued cell for execution"),this.startExecutingCells()}async cancel(e){this.cancelledOrCompletedWithErrors=!0,p.debug("Cancel pending cells"),await Promise.all(this.queueOfItemsToExecute.map(t=>t.cancel(e))),this.lastCellExecution?.dispose(),this.queueOfItemsToExecute.splice(0,this.queueOfItemsToExecute.length)}async cancelQueuedCells(){this.cancelledOrCompletedWithErrors=!0,p.debug("Cancel pending cells"),await Promise.all(this.queueOfCellsToExecute.map(e=>e.cancel())),this.lastCellExecution?.type==="cell"&&this.lastCellExecution?.dispose(),this.queueOfItemsToExecute.push(...this.queueOfItemsToExecute.filter(e=>e.type==="code"))}async waitForCompletion(e){let t=e?this.queueOfCellsToExecute.filter(r=>e===r.cell):this.queueOfItemsToExecute;await Promise.all(t.map(r=>r.result))}startExecutingCells(){this.startedRunningCells||this.start().catch(h),this.startedRunningCells=!0}async start(){try{await this.executeQueuedCells()}catch(e){p.error("Failed to execute cells in CellExecutionQueue",e),this.cancelledOrCompletedWithErrors=!0,await this.cancelQueuedCells()}}async executeQueuedCells(){let e,t=await this.session;for(this.queueOfItemsToExecute.forEach(r=>r.type==="cell"&&ct(r.cell,"Ready to execute"));this.queueOfItemsToExecute.length;){this.lastCellExecution?.dispose();let r=this.queueOfItemsToExecute[0];this.lastCellExecution=r,r.type==="cell"&&ct(r.cell,"Before Execute individual cell");let i=!0;try{r.type==="cell"&&r.cell.notebook.isClosed?e=!0:r.type==="cell"&&this.cancelledOrCompletedWithErrors||(i=await r.start(t).then(()=>!0).catch(()=>!1))}finally{r.type==="cell"&&ct(r.cell,`After Execute individual cell ${i}`);let s=this.queueOfItemsToExecute.indexOf(r);s>=0&&this.queueOfItemsToExecute.splice(s,1),r.type==="cell"&&ar.changeCellState(r.cell,1,r.executionOrder)}let o=!1;if(r.type==="cell"&&Ed(r.cell).metadata?.tags?.includes("raises-exception")&&(o=!0),e||this.cancelledOrCompletedWithErrors||!i&&!o){this.cancelledOrCompletedWithErrors=!0;let s=[];if(this.cancelledOrCompletedWithErrors&&s.push("cancellation or failure in execution"),e&&s.push("Notebook being closed"),typeof i=="number"&&!i&&s.push("failure in cell execution"),s.length===0&&s.push("an unknown reason"),this.queueOfCellsToExecute.length>0&&this.queueOfCellsToExecute.length===this.queueOfItemsToExecute.length){p.warn(`Cancel all remaining cells due to ${s.join(" or ")}`),await this.cancel();break}else if(this.queueOfCellsToExecute.length>0&&this.queueOfCellsToExecute.length!==this.queueOfItemsToExecute.length)p.warn(`Cancel all remaining cells due to ${s.join(" or ")}`),await this.cancelQueuedCells();else if(e){p.warn(`Cancel all remaining cells due to ${s.join(" or ")}`),await this.cancel();break}}if(t.status==="dead"||t.status==="terminating"){this.cancelledOrCompletedWithErrors=!0,p.warn("Cancel all remaining cells due to dead kernel"),await this.cancel();break}}}};var IT=class{constructor(e,t,r,i){this.kernel=e;this.notebook=i;this.disposables=[];this._visibleExecutionCount=0;this.documentExecutions=new WeakMap;this._onDidReceiveDisplayUpdate=new Cf.EventEmitter;this.onDidReceiveDisplayUpdate=this._onDidReceiveDisplayUpdate.event;this.hookedSesions=new WeakSet;let o=new vT(e.controller,t,r,i);this.disposables.push(o),this.executionFactory=new gT(e.controller,o),ar.onDidChangeNotebookCellExecutionState(s=>{s.cell.notebook===e.notebook&&s.state===1&&s.cell.executionSummary?.executionOrder&&(this._visibleExecutionCount=Math.max(this._visibleExecutionCount,s.cell.executionSummary.executionOrder))}),e.onRestarted(()=>this._visibleExecutionCount=0,this,this.disposables),e.onStarted(()=>this._visibleExecutionCount=0,this,this.disposables),e.addHook("willInterrupt",this.onWillInterrupt,this,this.disposables),e.addHook("willCancel",this.onWillCancel,this,this.disposables),e.addHook("willRestart",s=>this.onWillRestart(s),this,this.disposables),e.onStatusChanged(this.hookupIOPubHandler,this,this.disposables),e.onRestarted(this.hookupIOPubHandler,this,this.disposables),this.hookupIOPubHandler()}get executionCount(){return this._visibleExecutionCount}hookupIOPubHandler(){let e=this.kernel.session;if(!e||this.hookedSesions.has(e))return;this.hookedSesions.add(e);let t=(r,i)=>{if(i.header.msg_type!=="update_display_data"&&i.header.msg_type!=="display_data")return;let o=i,s=o.content.transient?.display_id;if(!s||!_J(e,s))return;let a=vo({output_type:"display_data",data:o.content.data,metadata:o.content.metadata,transient:o.content.transient});this._onDidReceiveDisplayUpdate.fire(a)};e.iopubMessage.connect(t),this.disposables.push({dispose:()=>{e?.iopubMessage.disconnect(t)}})}get pendingCells(){return this.documentExecutions.get(this.notebook)?.queue||[]}async resumeCellExecution(e,t){if(ct(e,`NotebookKernelExecution.resumeCellExecution (start), ${M(e.notebook.uri)}`),e.kind==Cf.NotebookCellKind.Markup)return;Ct(this.kernel.resourceUri,"DATASCIENCE.RESUME_EXECUTE_CELL");let r=this.kernel.start(new Mt(!1)),i=this.getOrCreateCellExecutionQueue(e.notebook,r);i.resumeCell(e,t);let o=await i.waitForCompletion(e).then(()=>!0).catch(()=>!1);ct(e,`NotebookKernelExecution.resumeCellExecution (completed), ${M(e.notebook.uri)}`),p.trace(`Cell ${e.index} executed ${o?"successfully":"with an error"}`)}async executeCell(e,t){ct(e,`NotebookKernelExecution.executeCell (1), ${M(e.notebook.uri)}`);let r=new Me;if(e.kind==Cf.NotebookCellKind.Markup)return;ct(e,`NotebookKernelExecution.executeCell (2), ${M(e.notebook.uri)}`);let i=this.kernel.restarting.then(()=>this.kernel.start(new Mt(!1)));ct(e,`NotebookKernelExecution.executeCell (3), ${M(e.notebook.uri)}`),await i;let o=this.getOrCreateCellExecutionQueue(e.notebook,i);o.queueCell(e,t);let s=!0;try{ct(e,`NotebookKernelExecution.executeCell (4), ${M(e.notebook.uri)}`),await o.waitForCompletion(e)}catch(a){throw s=!1,a}finally{ct(e,`NotebookKernelExecution.executeCell completed (5), ${M(e.notebook.uri)}`),p.trace(`Cell ${e.index} executed ${s?"successfully":"with an error"}`),Ct(this.kernel.resourceUri,"DATASCIENCE.EXECUTE_CELL",{duration:r.elapsedTime})}}async*executeCode(e,t,r,i){let o=new Me,s;if(t===_e||t===lC){let f=this.kernel.restarting.then(()=>this.kernel.start(new Mt(!0)));s=Xy.fromCode(e,t),f.then(g=>s.start(g))}else{let f=this.kernel.restarting.then(()=>this.kernel.start(new I_(!1,this.kernel.isPostInitializedInProgress)));s=this.getOrCreateCellExecutionQueue(this.notebook,f).queueCode(e,t,i)}t!==_e&&p.trace(`Queue code ${s.executionId} from ${t} after ${o.elapsedTime}ms:
${e}`);let a=!1,l=[];s.result.finally(()=>{a=!0,!i.isCancellationRequested&&p.debug(`Execution of code ${s.executionId} completed in ${o.elapsedTime}ms`),t!==_e&&Ct(this.kernel.resourceUri,"DATASCIENCE.EXECUTE_CODE",{duration:o.elapsedTime},{extensionId:t}),G(l)}).catch(h);let c=so(s.result),u=[],d=ne();for(l.push(s.onRequestSent(()=>r.started.fire())),l.push(s.onRequestAcknowledged(()=>r.executionAcknowledged.fire())),s.onDidEmitOutput(f=>{u.push(f),d.resolve(),d=ne()},this,l),i.onCancellationRequested(()=>{a||p.debug(`Code execution cancelled by extension ${t}`)},this,l);;){await Promise.race([d.promise,c.promise]),a&&(d=ne());let f=this.kernel.session;for(;u.length;){let g=u.shift();f&&gx(t,f,g),yield g}if(c.completed)break}}executeHidden(e){return this.kernel.start().then(r=>r.kernel?gn(r.kernel,e):Promise.reject(new hn))}async onWillInterrupt(){let e=this.documentExecutions.get(this.notebook);!e&&this.kernel.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"||(p.info("Interrupt kernel execution"),e&&(await e.cancel(),await e.waitForCompletion().catch(h)))}async onWillCancel(){let e=this.documentExecutions.get(this.notebook);e&&await e.cancel(!0)}async onWillRestart(e){let t=this.documentExecutions.get(this.notebook),r=e?await e.catch(()=>{}):void 0,i=t?t.cancel(!0).then(()=>t.waitForCompletion().catch(h)):Promise.resolve();r||(p.info("No kernel session to interrupt"),await i)}getOrCreateCellExecutionQueue(e,t){let r=this.documentExecutions.get(e);if(r&&!r.isEmpty&&!r.failed)return r;let i=new bT(t,this.executionFactory,this.kernel.kernelConnectionMetadata,this.kernel.resourceUri);return this.disposables.push(i),Cf.workspace.onDidCloseNotebookDocument(async o=>{o===e&&(p.debug(`Cancel executions after closing notebook ${M(o.uri)}`),(!i.failed||!i.isEmpty)&&await i.cancel(!0))},this,this.disposables),this.documentExecutions.set(e,i),i}};var _o=Symbol("IReplNotebookTrackerService");var Zy=class extends sT{constructor(t,r,i,o,s,a,l,c,u,d,f,g){super(t,r);this.sessionCreator=i;this.configService=o;this.context=s;this.formatters=l;this.startupCodeProviders=c;this.workspaceStorage=u;this.replTracker=d;this.kernelWorkingDirectory=f;this.rawKernelSupported=g;r.push(a.onDidRemove(this.handleServerRemoval.bind(this)))}getOrCreate(t,r){let i=this.getInternal(t);if(i&&i.options.metadata.id===r.metadata.id)return i.kernel;i&&p.trace(`Kernel for ${M(t.uri)} with id ${i.options.metadata.id} is being replaced with ${r.metadata.id}`),this.disposeOldKernel(t,"createNewKernel");let o=this.replTracker.isForReplEditor(t),s=o?r.resourceUri:t.uri,a=lF(this.configService,s),l=this.startupCodeProviders.getProviders(o?nr:It),c=new pT(s,t,r.metadata,this.sessionCreator,a,r.controller,l,this.workspaceStorage,this.kernelWorkingDirectory,this.rawKernelSupported);return c.onRestarted(()=>this._onDidRestartKernel.fire(c),this,this.disposables),c.onDisposed(()=>{this._onDidDisposeKernel.fire(c)},this,this.disposables),c.onStarted(()=>this._onDidStartKernel.fire(c),this,this.disposables),c.onStatusChanged(u=>this._onKernelStatusChanged.fire({kernel:c,status:u}),this,this.disposables),c.onPostInitialized(u=>u.waitUntil(this._onDidPostInitializeKernel.fireAsync({kernel:c},u.token)),this,this.disposables),this.executions.set(c,new IT(c,this.context,this.formatters,t)),this.asyncDisposables.push(c),this.storeKernel(t,r,c),this.deleteMappingIfKernelIsDisposed(c),c}};Zy=v([(0,_r.injectable)(),m(0,(0,_r.inject)(ya)),m(1,(0,_r.inject)(K)),m(2,(0,_r.inject)(QC)),m(3,(0,_r.inject)(oe)),m(4,(0,_r.inject)(tt)),m(5,(0,_r.inject)(Xt)),m(6,(0,_r.multiInject)(Pg)),m(7,(0,_r.inject)(Bc)),m(8,(0,_r.inject)(We)),m(8,(0,_r.named)(di)),m(9,(0,_r.inject)(_o)),m(10,(0,_r.inject)(Mm)),m(11,(0,_r.inject)(_n))],Zy);var eb=class extends aT{constructor(t,r,i,o,s,a,l,c){super(t,r);this.sessionCreator=i;this.configService=o;this.startupCodeProviders=s;this.workspaceStorage=a;this.kernelWorkingDirectory=l;this.rawKernelSupported=c}getOrCreate(t,r){let i=this.getInternal(t);if(i&&i.options.metadata.id===r.metadata.id)return i.kernel;this.disposeOldKernel(t);let o=t,s=lF(this.configService,o),a=o.path.endsWith(".interactive")?nr:It,l=new dT(t,o,r.metadata,this.sessionCreator,s,this.startupCodeProviders.getProviders(a),this.workspaceStorage,this.kernelWorkingDirectory,this.rawKernelSupported);return l.onRestarted(()=>this._onDidRestartKernel.fire(l),this,this.disposables),l.onDisposed(()=>{this._onDidDisposeKernel.fire(l)},this,this.disposables),l.onStarted(()=>this._onDidStartKernel.fire(l),this,this.disposables),l.onStatusChanged(c=>this._onKernelStatusChanged.fire({kernel:l,status:c}),this,this.disposables),l.onPostInitialized(c=>c.waitUntil(this._onDidPostInitializeKernel.fireAsync({kernel:l},c.token)),this,this.disposables),this.asyncDisposables.push(l),this.storeKernel(t,r,l),this.deleteMappingIfKernelIsDisposed(t,l),l}};eb=v([(0,_r.injectable)(),m(0,(0,_r.inject)(ya)),m(1,(0,_r.inject)(K)),m(2,(0,_r.inject)(QC)),m(3,(0,_r.inject)(oe)),m(4,(0,_r.inject)(Bc)),m(5,(0,_r.inject)(We)),m(5,(0,_r.named)(di)),m(6,(0,_r.inject)(Mm)),m(7,(0,_r.inject)(_n))],eb);var Ef=k(N()),Su=require("vscode");var tb=class{constructor(e,t,r,i){this.extensionChecker=t;this.interpreterService=r;this.kernelFinder=i;this.refreshedOnceBefore=!1;this.disposables=[];e.push(this)}dispose(){G(this.disposables)}activate(){this.extensionChecker.isPythonExtensionInstalled?this.startRefreshWithPython():(this.startRefreshWithoutPython(),this.extensionChecker.onPythonExtensionInstallationStatusChanged(()=>{this.extensionChecker.isPythonExtensionInstalled&&this.startRefreshWithPython()},this,this.disposables))}startRefreshWithoutPython(){if(this.refreshedOnceBefore)return;this.refreshedOnceBefore=!0;let e=()=>{let t=Date.now().toString();p.debug(`Start refreshing Kernel Picker (${t})`);let r=Su.notebooks.createNotebookControllerDetectionTask(It),i=Su.notebooks.createNotebookControllerDetectionTask(nr);this.disposables.push(r),this.disposables.push(i),this.kernelFinder.onDidChangeStatus(()=>{this.kernelFinder.status==="idle"&&(p.debug(`End refreshing Kernel Picker (${t})`),r.dispose(),i.dispose())},this,this.disposables)};if(this.kernelFinder.status==="discovering")return e();this.kernelFinder.onDidChangeStatus(()=>{this.kernelFinder.status==="discovering"&&e()},this,this.disposables)}startRefreshWithPython(){if(this.refreshedOnceBefore)return;this.refreshedOnceBefore=!0;let e=!1;Su.window.onDidChangeActiveNotebookEditor(o=>{!e&&o&&St(o.notebook)&&(e=!0,p.debug("Start refreshing Interpreter Kernel Picker"),this.interpreterService.refreshInterpreters().catch(h))},this,this.disposables),Su.workspace.onDidOpenNotebookDocument(o=>{!e&&St(o)&&(e=!0,p.debug("Start refreshing Interpreter Kernel Picker"),this.interpreterService.refreshInterpreters().catch(h))},this,this.disposables);let t,r="",i=()=>(t&&!t.isDisposed||(r=Date.now().toString(),p.debug(`Start refreshing Kernel Picker (${r})`),t=new or(Su.notebooks.createNotebookControllerDetectionTask(It),Su.notebooks.createNotebookControllerDetectionTask(nr)),this.disposables.push(t)),t);this.kernelFinder.status==="idle"?(p.debug(`End refreshing Kernel Picker (${r})`),t?.dispose()):i(),this.kernelFinder.onDidChangeStatus(()=>{this.kernelFinder.status==="idle"?(p.debug(`End refreshing Kernel Picker (${r})`),t?.dispose()):i()},this,this.disposables)}};tb=v([(0,Ef.injectable)(),m(0,(0,Ef.inject)(K)),m(1,(0,Ef.inject)(qe)),m(2,(0,Ef.inject)(rt)),m(3,(0,Ef.inject)(Ar))],tb);var W4=k(N());var rb=class{constructor(){this.providers=new Map}getProviders(e){return(this.providers.get(e)||[]).slice()}register(e,t){this.providers.set(t,this.providers.get(t)||[]),this.providers.get(t).push(e)}};rb=v([(0,W4.injectable)()],rb);var ow=k(N());var nb=class{constructor(e,t){this.kernelProvider=e;this.disposables=t}activate(){this.kernelProvider.onDidCreateKernel(e=>this.addOnStartHooks(e),this,this.disposables)}addOnStartHooks(e){e.addHook("didStart",async t=>{t&&await lH(t,e.resourceUri,e.kernelConnectionMetadata)},this,this.disposables)}};nb=v([(0,ow.injectable)(),m(0,(0,ow.inject)(ye)),m(1,(0,ow.inject)(K))],nb);var sw=k(N());var pF=require("vscode");var aw=Symbol("IKernelStatusProvider"),ib=class{constructor(e,t){this.kernelProvider=e;this.disposables=[];this.restartProgressToHide=new WeakMap;this.restartProgress=new WeakMap;this.interruptProgress=new WeakMap;t.push(this)}dispose(){G(this.disposables)}activate(){this.kernelProvider.onDidCreateKernel(this.onDidCreateKernel,this,this.disposables),this.kernelProvider.onDidDisposeKernel(e=>{this.restartProgress.get(e)?.dispose(),this.interruptProgress.get(e)?.dispose()},this,this.disposables)}hideRestartProgress(e){if(!this.restartProgressToHide.has(e)){let t=new pF.Disposable(()=>{this.restartProgressToHide.delete(e)});this.restartProgressToHide.set(e,t)}return this.restartProgressToHide.get(e)}onDidCreateKernel(e){e.addHook("willRestart",async()=>{if(this.restartProgressToHide.has(e))return;this.restartProgress.get(e)?.dispose();let t=ut.createProgressReporter(e.resourceUri,y.restartingKernelStatus(`: ${lt(e.kernelConnectionMetadata)}`));this.restartProgress.set(e,t)},this,this.disposables),e.addHook("restartCompleted",async()=>{if(this.restartProgressToHide.has(e)){this.restartProgressToHide.get(e)?.dispose(),this.restartProgressToHide.delete(e);return}this.restartProgress.get(e)?.dispose(),this.interruptProgress.get(e)?.dispose()},this,this.disposables),e.addHook("willInterrupt",async()=>{let t=new or,r=setTimeout(()=>{t.isDisposed||t.add(ut.createProgressReporter(e.resourceUri,y.interruptKernelStatus(lt(e.kernelConnectionMetadata))))},1e3);t.add(new pF.Disposable(()=>clearTimeout(r))),this.interruptProgress.set(e,t)},this,this.disposables),e.addHook("interruptCompleted",async()=>this.interruptProgress.get(e)?.dispose(),this,this.disposables)}};ib=v([(0,sw.injectable)(),m(0,(0,sw.inject)(ye)),m(1,(0,sw.inject)(K))],ib);var Eu=k(N()),cw=require("vscode");var Oa=k(N()),lw=require("vscode");var ss=require("vscode");var zde=/python\s\d*.?\d*$/,mF="__old_vscode_kernelspecs",fF=class{constructor(e,t,r){this.fs=e;this.globalState=t;this.jupyterPaths=r;this.findKernelSpecsInPathCache=new Map;this.pathToKernelSpec=new Map;this.disposables=[];this.oldKernelSpecsFolder&&p.trace(`Old kernelSpecs (created by Jupyter Extension) stored in directory ${this.oldKernelSpecsFolder}`)}get oldKernelSpecsFolder(){return this._oldKernelSpecsFolder||this.globalState.get("OLD_KERNEL_SPECS_FOLDER__","")}set oldKernelSpecsFolder(e){this._oldKernelSpecsFolder=e,this.globalState.update("OLD_KERNEL_SPECS_FOLDER__",e).then(h,h)}clearCache(){this.pathToKernelSpec.clear(),this.findKernelSpecsInPathCache.clear()}dispose(){G(this.disposables)}async loadKernelSpec(e,t,r){if(e.fsPath.includes(mF))return;let i=fn(e);if(!this.pathToKernelSpec.has(i)){let o=this.loadKernelSpecImpl(e,t,r).then(async s=>{let a=await this.jupyterPaths.getKernelSpecRootPath(),l=s&&a&&Kn(s)&&s.specFile&&Fh(ss.Uri.file(s.specFile),a);if(s&&!l)return s;s?.specFile&&l&&this.deleteOldKernelSpec(s.specFile).catch(h),this.pathToKernelSpec.get(i)===o&&this.pathToKernelSpec.delete(i),this.cache=this.cache?.filter(c=>an(c.kernelSpecFile,e))});this.pathToKernelSpec.set(i,o),o.finally(()=>{t.isCancellationRequested&&this.pathToKernelSpec.get(i)===o&&this.pathToKernelSpec.delete(i)}).catch(h)}return this.pathToKernelSpec.get(i)}async deleteOldKernelSpec(e){let t=Ce(it(e)),r=Ve(it(it(e)),mF);this.oldKernelSpecsFolder=r;let i=Ve(r,t,Ce(e));await this.fs.createDirectory(ss.Uri.file(it(i))),await this.fs.copy(ss.Uri.file(e),ss.Uri.file(i)).catch(h),await this.fs.delete(ss.Uri.file(e)),p.trace(`Old KernelSpec '${e}' deleted and backup stored in ${r}`)}async loadKernelSpecImpl(e,t,r){return Qde(e,this.fs,t,r)}async findKernelSpecsInPaths(e,t){let r=fn(e),i=this.findKernelSpecsInPathCache.get(r);if(i)return i;let o=(async()=>await this.fs.exists(e)?t.isCancellationRequested?[]:(await this.fs.searchLocal("**/kernel.json",e.fsPath,!0)).map(l=>zt(e,l)):[])();this.findKernelSpecsInPathCache.set(r,o);let s=t.onCancellationRequested(()=>{this.findKernelSpecsInPathCache.get(r)===o&&this.findKernelSpecsInPathCache.delete(r)});return o.finally(()=>{t.isCancellationRequested&&this.findKernelSpecsInPathCache.get(r)===o&&this.findKernelSpecsInPathCache.delete(r),s.dispose()}).catch(h),o.catch(a=>{this.findKernelSpecsInPathCache.get(r)===o&&this.findKernelSpecsInPathCache.delete(r),p.warn(`Failed to search for kernels in ${M(e)} with an error`,a)}),o}},ob=class{constructor(e,t,r,i,o,s){this.fs=e;this.extensionChecker=t;this.memento=r;this.env=o;this.jupyterPaths=s;this.disposables=[];this._status="idle";this.promiseMonitor=new ho;this._onDidChangeStatus=new ss.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this._onDidChangeKernels=new ss.EventEmitter;this.onDidChangeKernels=this._onDidChangeKernels.event;this.timeouts=new Map;i.push(this),this.disposables.push(this.promiseMonitor),this.promiseMonitor.onStateChange(()=>{this.status=this.promiseMonitor.isComplete?"idle":"discovering"}),this.kernelSpecFinder=new fF(e,r,s),this.disposables.push(this.kernelSpecFinder),this.disposables.push(new ss.Disposable(()=>G(Array.from(this.timeouts.values()))))}get status(){return this._status}set status(e){this._status!==e&&(this._status=e,this._onDidChangeStatus.fire())}clearCache(){this.kernelSpecFinder.clearCache()}async listKernelsFirstTimeFromMemento(e){let t=(async()=>{let r=this.memento.get(e,JSON.stringify({kernels:[],extensionVersion:""})),i=JSON.parse(r),o=[];i&&Array.isArray(i.kernels)&&i.extensionVersion===this.env.extensionVersion&&(o=i.kernels.map(a=>As.fromJSON(a)));let s=[];return await Promise.all(o.map(async a=>{await this.isValidCachedKernel(a)&&s.push(a)})),s})();return this.promiseMonitor.push(t),t}writeToMementoCache(e,t){this.timeouts.get(t)?.dispose();let r=setTimeout(()=>{this.memento.update(t,JSON.stringify({kernels:e.map(i=>i.toJSON()),extensionVersion:this.env.extensionVersion}))},500);this.timeouts.set(t,{dispose:()=>Ut(clearTimeout)(r)})}async isValidCachedKernel(e){switch(e.kind){case"startUsingPythonInterpreter":return this.fs.exists(e.interpreter.uri);case"startUsingLocalKernelSpec":return(e.kernelSpec.specFile?this.fs.exists(ss.Uri.file(e.kernelSpec.specFile)):Promise.resolve(!0)).then(r=>r&&e.interpreter?this.fs.exists(e.interpreter.uri):Promise.resolve(!0))}}};async function Qde(n,e,t,r){if(n.fsPath.includes(mF))return;let i;try{i=JSON.parse(await e.readFile(n))}catch(d){p.error(`Failed to parse kernelspec ${n}`,d);return}let o=it(n.fsPath);if(i.argv=i.argv.map(d=>d.replaceAll("{resource_dir}",o)),t.isCancellationRequested||(i.name=r?await pM(r):i.name,t.isCancellationRequested))return;if(!i.display_name.toLowerCase().match(zde)&&i.language===ge&&i.argv.length>2){let d=i.argv.slice(1).map(f=>f.toLowerCase()).filter(f=>!["-m","ipykernel","ipykernel_launcher","-f","{connection_file}"].includes(f));d.length&&(i.name=`${i.name}.${d.join("#")}`)}let a=i.metadata||{};a.vscode=a.vscode||{},a.vscode.originalSpecFile||(a.vscode.originalSpecFile=n.fsPath),a.vscode.originalDisplayName||(a.vscode.originalDisplayName=i.display_name),a.originalSpecFile&&(a.vscode.originalSpecFile=a.originalSpecFile,delete a.originalSpecFile),i.metadata=a,i.name=i?.name||Ce(it(n.fsPath));let l=new Dd(i,n.fsPath,r?.uri.fsPath||i?.metadata?.interpreter?.path,Kn(i)),c=r?.uri.fsPath||i?.metadata?.interpreter?.path,u=qr(r);if(!(c&&!u&&!await e.exists(ss.Uri.file(c))))return i.isRegisteredByVSC=Kn(i),l}function V4(){return`LOCAL_KERNEL_SPECS_CACHE_KEY_V_2023_2:${lw.env.appHost}:${lw.env.remoteName||""}`}var as=class extends ob{constructor(t,r,i,o,s,a){super(t,i,o,s,a,r);this._kernels=new Map}activate(){this.listKernelsFirstTimeFromMemento(V4()).then(t=>{this._kernels.size===0&&t.length&&(t.forEach(r=>this._kernels.set(r.id,r)),this._onDidChangeKernels.fire())}).catch(h),this.refresh().then(h,h)}get kernels(){return Array.from(this._kernels.values())}dispose(){this._onDidChangeKernels.dispose()}async refresh(){this.clearCache(),await this.refreshData()}async refreshData(){let t=new lw.CancellationTokenSource;try{await this.listKernelSpecs(t.token)}finally{t.dispose()}}writeKernelsToMemento(){this.writeToMementoCache(Array.from(this._kernels.values()),V4())}async listKernelSpecs(t){let i=(async()=>{let o=await this.findKernelSpecs(t);if(t.isCancellationRequested)return[];let s=Array.from(this._kernels.values()).sort((u,d)=>u.id.localeCompare(d.id)),a=o.sort((u,d)=>u.id.localeCompare(d.id)),l=new Set(o.map(u=>u.id)),c=s.filter(u=>!l.has(u.id));return o.forEach(u=>this._kernels.set(u.id,u)),c.length&&(p.debug(`Local kernel spec connection deleted ${c.map(u=>`${u.kind}:'${u.id}'`)}`),c.forEach(u=>this._kernels.delete(u.id))),(s.length!==a.length||c.length||JSON.stringify(s)!==JSON.stringify(a))&&(this._onDidChangeKernels.fire(),this.writeKernelsToMemento()),o})();return this.promiseMonitor.push(i),i}async findKernelSpecs(t){let r=await this.jupyterPaths.getKernelSpecRootPaths(t);if(t.isCancellationRequested)return[];let i=await Promise.all(r.map(l=>this.kernelSpecFinder.findKernelSpecsInPaths(l,t)));if(t.isCancellationRequested)return[];let o=new Set,s=[],a=new Map;return await Promise.all(i.flat().map(async l=>{try{let c=await this.kernelSpecFinder.loadKernelSpec(l,t);if(!c||t.isCancellationRequested)return;if(G_(c,"local"),c.metadata?.originalSpecFile){if(o.has(c.metadata.originalSpecFile))return;o.add(c.metadata.originalSpecFile)}if(c.specFile){if(o.has(c.specFile))return;o.add(c.specFile)}let u=a.get(c.display_name),d=xd.create({kernelSpec:c,interpreter:void 0,id:Oi(c)});u&&u.executable!==c.executable?(s.push(d),ua(d,this._kernels.get(d.id))||(this._kernels.set(d.id,d),this._onDidChangeKernels.fire(),this.writeKernelsToMemento())):u?p.warn(`Duplicate kernel found ${c.display_name} ${c.executable} in ${c.specFile}`):(s.push(d),a.set(c.display_name,c),ua(d,this._kernels.get(d.id))||(this._kernels.set(d.id,d),this._onDidChangeKernels.fire(),this.writeKernelsToMemento()))}catch(c){p.error(`Failed to load kernelSpec for ${l}`,c);return}})),s}};v([zv(100)],as.prototype,"writeKernelsToMemento",1),as=v([(0,Oa.injectable)(),m(0,(0,Oa.inject)(gr)),m(1,(0,Oa.inject)(zr)),m(2,(0,Oa.inject)(qe)),m(3,(0,Oa.inject)(We)),m(3,(0,Oa.named)(dt)),m(4,(0,Oa.inject)(K)),m(5,(0,Oa.inject)(Vl))],as);var To=k(N()),j4=require("vscode");var Sp=Symbol("ITrustedKernelPaths");var ni=require("vscode");function hF(){return`LOCAL_KERNEL_PYTHON_AND_RELATED_SPECS_CACHE_KEY_V_2023_3:${ni.env.appHost}:${ni.env.remoteName||""}`}async function Yde(n,e,t,r,i){let o=await Ps(n);if(!o){p.warn(`Failed to get sysPrefix for interpreter ${qt(n.id)}`);return}let s=ni.Uri.file(Ve(o,iH)),a=await t.getKernelSpecRootPaths(e);if(e.isCancellationRequested||a.some(d=>an(d,s)))return;let l=await r.findKernelSpecsInPaths(s,e);if(e.isCancellationRequested)return;let c=new Set,u=new Map;await Promise.all(l.map(async d=>{try{let f=await r.loadKernelSpec(d,e,n);if(e.isCancellationRequested||!f)return;if(f.metadata?.originalSpecFile){if(c.has(f.metadata.originalSpecFile))return;c.add(f.metadata.originalSpecFile)}if(f.specFile){if(c.has(f.specFile))return;c.add(f.specFile)}let g=u.get(f.display_name);g&&g.executable!==f.executable?i.fire(f):g||(u.set(f.display_name,f),i.fire(f))}catch(f){p.error(`Failed to load kernel spec ${d}`,f)}}))}var ST=class extends Qt{constructor(t,r,i,o,s){super();this.interpreter=t;this.interpreterService=r;this.jupyterPaths=i;this.extensionChecker=o;this.kernelSpecFinder=s;this.cancelToken=new ni.CancellationTokenSource;this._kernels=new Map;this._onDidChangeKernels=this._register(new ni.EventEmitter);this.onDidChangeKernels=this._onDidChangeKernels.event;this.lastKnownInterpreterVersion=Ri(t),this.lastKnownInterpreterSysPrefix=Qh(t),this.lastKnownEnvFolder=mr(t)?.environment?.folderUri,this._register({dispose:()=>this.cancelToken.cancel()}),this._register(this.cancelToken),this._register(this.interpreterService.onDidChangeInterpreter(this.clearCacheWhenInterpretersChange,this)),this._register(this.interpreterService.onDidChangeInterpreters(this.clearCacheWhenInterpretersChange,this))}async listKernelSpecs(t){return this.extensionChecker.isPythonExtensionInstalled?!t&&this.kernelSpecPromise?this.kernelSpecPromise:(this.cancelToken.cancel(),this.cancelToken.dispose(),this.cancelToken=this._register(new ni.CancellationTokenSource),this.kernelSpecPromise=this.listKernelSpecsImpl(),this.kernelSpecPromise.then(()=>{switch(this._kernels.size){case 0:p.trace(`No Kernels found in interpreter ${this.interpreter.id}`);break;case 1:break;default:p.trace(`Kernels for interpreter ${this.interpreter.id} are ${Array.from(this._kernels.keys()).join(", ")}`)}}),this.kernelSpecPromise):[]}clearCacheWhenInterpretersChange(){let t=mr({id:this.interpreter.id});if(!t)return;let r=Ri(t),i=Qh(t);(this.lastKnownEnvFolder?.fsPath!==t.environment?.folderUri?.fsPath||this.lastKnownInterpreterVersion?.sysVersion!==r?.sysVersion||Ue(this.interpreter)!==Ue(t)||this.lastKnownInterpreterSysPrefix!==i)&&(this.lastKnownInterpreterVersion=r,this.lastKnownInterpreterSysPrefix=i,this.listKernelSpecs(!0).catch(h))}async listKernelSpecsImpl(){let t=this.cancelToken.token;if(!Qh(this.interpreter))return;p.trace(`Search for KernelSpecs in Interpreter ${qt(this.interpreter.uri)}`);let i=new Map,o=new ni.EventEmitter,s=o.event(f=>{if(t.isCancellationRequested)return;if(f.language===ge&&(!f.env||Object.keys(f.env).length===0)&&eE(f)){p.trace(`Hiding default KernelSpec ${qt(f.argv[0])} for interpreter ${qt(f.interpreterPath)} (KernelSpec file ${qt(f.specFile)})`);return}let g=cu(f)?$o.create({kernelSpec:f,interpreter:this.interpreter,id:Oi(f,this.interpreter)}):xd.create({kernelSpec:f,interpreter:this.interpreter,id:Oi(f,this.interpreter)});g&&!this._kernels.has(g.id)&&(this._kernels.set(g.id,g),this._onDidChangeKernels.fire({added:[g],removed:[]})),g&&!i.has(g.id)&&i.set(g.id,g)}),[a]=await Promise.all([this.jupyterPaths.getKernelSpecTempRegistrationFolder(),Yde(this.interpreter,t,this.jupyterPaths,this.kernelSpecFinder,o)]);if(o.dispose(),s.dispose(),t.isCancellationRequested)return;let c=await Ns(this.interpreter,a);if(t.isCancellationRequested)return;let u=$o.create({kernelSpec:c,interpreter:this.interpreter,id:Oi(c,this.interpreter)});this._kernels.has(u.id)||(this._kernels.set(u.id,u),this._onDidChangeKernels.fire({added:[u],removed:[]})),i.has(u.id)||i.set(u.id,u);let d=Array.from(this._kernels.keys()).filter(f=>!i.has(f)).map(f=>this._kernels.get(f));d.forEach(f=>this._kernels.delete(f.id)),this._onDidChangeKernels.fire({added:[],removed:d})}},CT=class n{constructor(e,t,r,i){this.interpreterService=e;this.kernelSpecsFromKnownLocations=t;this.extensionChecker=r;this.trustedKernels=i;this.kernelsPerInterpreter=new Map;this.disposables=[];this.cancelToken=new ni.CancellationTokenSource;this.lastKnownGlobalPythonKernelSpecs=[];t.onDidChangeKernels(()=>{let o=this.lastKnownGlobalPythonKernelSpecs,s=this.listGlobalPythonKernelSpecs();if(o.length!==s.length||!ua(o,s)){this.kernelSpecPromise=void 0;return}})}static{this.globalPythonKernelSpecsForWhichWeCouldNotFindInterpreterInfo=new Set}dispose(){G(this.disposables),this.cancelToken.dispose()}async listKernelSpecs(e){return this.extensionChecker.isPythonExtensionInstalled?!e&&this.kernelSpecPromise?this.kernelSpecPromise:(this.clear(),this.cancelToken=new ni.CancellationTokenSource,this.kernelSpecPromise=this.listKernelSpecsImpl(),this.kernelSpecPromise):[]}clear(){this.kernelsPerInterpreter.clear(),this.cancelToken.cancel(),this.cancelToken.dispose(),this.kernelSpecPromise=void 0}async findMatchingInterpreter(e,t,r){let i=this.extensionChecker.isPythonExtensionInstalled?mo():[],o=e&&Array.isArray(e.argv)&&e.argv.length>0?e.argv[0]:void 0,s=e.language||"",a=e.specFile?await ot(e.specFile):"",l=!!Kn(e);if(e.language&&e.language!==ge){!l&&o&&e.specFile&&T_(o)&&T("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:Ce(o)!==o,argv0:Ce(o),language:s,isCreatedByUs:l});return}let c=i.find(u=>e.metadata?.interpreter?.path&&Bo(ni.Uri.file(e.metadata.interpreter.path),u.executable.uri)?(p.trace(`Kernel ${e.name} matches ${qt(u.id)} based on metadata.interpreter.`),!0):!1);if(c)return Ai(c);if(o&&Ce(o)===o&&e.specFile&&!l&&T("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!1,argv0:Ce(o),language:s,isCreatedByUs:l}),o&&Ce(o)!==o){let u=ni.Uri.file(o),d=i.find(f=>Bo(u,f.executable.uri)?(p.trace(`Kernel ${e.name} matches ${qt(f.id)} based on argv.`),!0):!1);if(d)return e.specFile&&!l&&T("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:Ce(o),pythonEnvFound:"found",language:s,isCreatedByUs:l}),Ai(d);if(!e.specFile||this.trustedKernels.isTrusted(ni.Uri.file(e.specFile))){let f=await this.interpreterService.getInterpreterDetails(u,r);if(r?.isCancellationRequested)return;if(f)return e.specFile&&!l&&T("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:Ce(o),pythonEnvFound:"foundViaGetEnvDetails",language:s,isCreatedByUs:l}),f;e.specFile&&!l&&T("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:Ce(o),pythonEnvFound:"notFound",language:s,isCreatedByUs:l})}else e.specFile&&!l&&T("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:Ce(o),pythonEnvFound:"notTrusted",language:s,isCreatedByUs:l})}if(e.interpreterPath){let u=ni.Uri.file(e.interpreterPath),d=i.find(f=>e.interpreterPath&&Bo(u,f.executable.uri)?(p.trace(`Kernel ${e.name} matches ${qt(f.id)} based on interpreterPath.`),!0):!1);if(d)return Ai(d);if(!e.specFile||this.trustedKernels.isTrusted(ni.Uri.file(e.specFile))){let f=await this.interpreterService.getInterpreterDetails(u,r);if(f)return f}}if(!r?.isCancellationRequested)return Ai(i.find(u=>e.display_name===mr(u)?.environment?.name?(p.trace(`Kernel ${e.name} matches ${qt(u.id)} based on display name`),T("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:o?Ce(o):"",pythonEnvFound:"matchDisplayName",language:s,isCreatedByUs:l}),!0):!1))}listGlobalPythonKernelSpecs(){return this.lastKnownGlobalPythonKernelSpecs=this.kernelSpecsFromKnownLocations.kernels.filter(e=>e.kernelSpec.language===ge)}warnAboutPythonKernelSpecWithInvalidPythonExec(e){let t=e.specFile||JSON.stringify(e);n.globalPythonKernelSpecsForWhichWeCouldNotFindInterpreterInfo.has(t)||(n.globalPythonKernelSpecsForWhichWeCouldNotFindInterpreterInfo.add(t),p.warn(`Kernel Spec for '${e.display_name}' (${qt(e.specFile)}) hidden, as we cannot find a matching interpreter argv = '${e.argv[0]}'. To resolve this, please change '${e.argv[0]}' to point to the fully qualified Python executable.`))}async listKernelSpecsImpl(){let e=this.cancelToken.token,t=this.listGlobalPythonKernelSpecs().filter(s=>!Kn(s.kernelSpec)),r=s=>{if(s.kernelSpec.language!==ge)return!1;let a=s.kernelSpec.argv.map(u=>u.toLowerCase()),l=a.indexOf("-m");if(l===-1)return!1;let c=a.length-1>=l?a[l+1]:void 0;return c?c!=="ipykernel_launcher":!1},i=new Map,o=new Set;return await Promise.all(t.filter(s=>{let a=Kn(s.kernelSpec);return!a&&(r(s)||Object.keys(s.kernelSpec.env||{}).length>0)||!a&&s.kernelSpec.language===ge&&!eE(s.kernelSpec)?!0:(p.trace(`Kernel Spec for '${s.kernelSpec.display_name}' (${qt(s.kernelSpec.specFile)}) is hidden. (isDefaultKernelSpec = ${eE(s.kernelSpec)}, language = ${s.kernelSpec.language}, registrationInfo = ${a})`),!1)}).map(async s=>{let a=await this.findMatchingInterpreter(s.kernelSpec,"startUsingLocalKernelSpec",e);if(e.isCancellationRequested)return;if(!a){let c=s.kernelSpec.argv.length?s.kernelSpec.argv[0].toLowerCase():"";if(T_(c)){this.warnAboutPythonKernelSpecWithInvalidPythonExec(s.kernelSpec);return}}let l=xd.create({kernelSpec:s.kernelSpec,interpreter:a,id:Oi(s.kernelSpec,a)});i.set(l.id,l),l.kernelSpec.specFile&&o.add(l.kernelSpec.specFile)})),e.isCancellationRequested?[]:e.isCancellationRequested?[]:Array.from(i.values())}};var Cu=class extends ob{constructor(t,r,i,o,s,a,l,c,u){super(r,o,a,l,c,i);this.interpreterService=t;this.kernelSpecsFromKnownLocations=s;this._kernels=new Map;this._kernelsExcludingCachedItems=new Map;this._kernelsFromCache=[];this.cachedInformationForPythonInterpreter=new Map;this.updateCachePromise=Promise.resolve();this.discoveredKernelSpecFiles=new Set;this.lastKnownGlobalPythonKernelSpecs=[];this.interpreterKernelSpecs=new Map;this.globalPythonKernelSpecFinder=new CT(this.interpreterService,this.kernelSpecsFromKnownLocations,this.extensionChecker,u),this.disposables.push(this._onDidChangeKernels),t.onDidChangeInterpreters(()=>{this.refreshCancellation?.cancel(),this.refreshData().catch(h)},this,this.disposables),t.onDidRemoveInterpreter(async d=>{if(await Hn(1e3),mr(d))return;p.debug(`Interpreter removed ${d.id}`);let f=[];this._kernels.forEach(g=>{g.interpreter?.id===d.id&&(p.debug(`Interpreter ${d.id} deleted, hence deleting corresponding kernel ${g.kind}:'${g.id}`),f.push(g),this._kernels.delete(g.id))}),f.length&&(p.debug(`Local Python connection deleted ${f.map(g=>`${g.kind}:'${g.id}: (interpreter id=${qt(g.interpreter?.id)})'`)}`),this.updateCache().catch(h))},this,this.disposables)}activate(){this.listKernelsFirstTimeFromMemento(hF()).then(t=>{t.length&&(t.filter(r=>!this._kernels.has(r.id)).forEach(r=>{this._kernelsFromCache.push(r),this._kernels.set(r.id,r)}),this._onDidChangeKernels.fire())}).finally(async()=>{this.refreshCancellation?.cancel(),this.refreshData().catch(h),this.kernelSpecsFromKnownLocations.onDidChangeKernels(()=>{let t=this.lastKnownGlobalPythonKernelSpecs,r=this.listGlobalPythonKernelSpecsIncludingThoseRegisteredByUs();(t.length!==r.length||!ua(t,r))&&(this.refreshCancellation?.cancel(),this.refreshData().catch(h))},this,this.disposables)}).catch(h)}get kernels(){return Array.from(this._kernels.values())}dispose(){G(this.disposables)}async refresh(){this.globalPythonKernelSpecFinder.clear(),this.clearCache(),this.cachedInformationForPythonInterpreter.clear(),this.discoveredKernelSpecFiles.clear(),this.interpreterService.refreshInterpreters(!0).catch(h),await this.refreshData(!0)}refreshData(t=!1){if(!t&&this.refreshCancellation&&!this.refreshCancellation.token.isCancellationRequested&&this.previousRefresh)return this.previousRefresh;this.refreshCancellation?.cancel(),this.refreshCancellation?.dispose();let r=this.refreshCancellation=new j4.CancellationTokenSource,i=(async()=>{if(await this.listKernelsImplementation(r.token,t).catch(o=>p.error("Failure in listKernelsImplementation",o)),!r.token.isCancellationRequested){if(this.interpreterService.status==="idle"){let o=this._kernelsFromCache.filter(c=>!this._kernelsExcludingCachedItems.has(c.id)),s=[];o.length&&(p.warn(`Kernels ${o.map(c=>`${c.kind}:'${c.id}'`).join(", ")} found in cache but not discovered in current session ${Array.from(this._kernelsExcludingCachedItems.values()).map(c=>`${c.kind}:'${c.id}'`).join(", ")}`),o.forEach(c=>{this._kernels.delete(c.id),s.push(c)}));let a=new Set(mo().map(c=>c.id)),l=Array.from(this._kernels.values()).filter(c=>!!(c.interpreter&&!a.has(c.interpreter.id)));l.length&&(p.warn(`The following kernels use interpreters that are no longer valid or not recognized by Python extension, Kernels ${l.map(c=>`${c.kind}:'id=${c.id}'(interpreterId='${qt(c.interpreter?.id)}')`).join(",")} and valid interpreter ids include ${Array.from(a).join(", ")}`),l.forEach(c=>{this._kernels.delete(c.id),s.push(c)})),s.length&&(p.debug(`Local Python connection deleted ${s.map(c=>`${c.kind}:'${c.id}: (interpreter id=${qt(c.interpreter?.id)})'`)}`),await this.updateCache())}t&&(this._kernelsFromCache=[])}})().catch(o=>p.error("Failed to discover kernels in interpreters",o)).finally(()=>{r===this.refreshCancellation&&(this.refreshCancellation?.cancel(),this.refreshCancellation?.dispose(),this.refreshCancellation=void 0)});return this.previousRefresh=i,this.promiseMonitor.push(i),i}async updateCache(){this._onDidChangeKernels.fire();let t=Array.from(this._kernels.values());return this.updateCachePromise=this.updateCachePromise.finally(()=>this.writeToMementoCache(t,hF())),this.updateCachePromise}async listKernelsImplementation(t,r){let i=this.extensionChecker.isPythonExtensionInstalled?mo():[],o=Promise.all(i.map(async a=>{let l=this.interpreterKernelSpecs.get(a.id);l||(l=new ST(Ai(a),this.interpreterService,this.jupyterPaths,this.extensionChecker,this.kernelSpecFinder),this.disposables.push(l),this.interpreterKernelSpecs.set(a.id,l),l.onDidChangeKernels(c=>{c.removed.forEach(u=>this._kernels.delete(u.id)),this.appendNewKernels(c.added),!c.added.length&&c.removed.length&&this.updateCache()},this,this.disposables)),await Rt(t,[],l.listKernelSpecs(r))})),s=Rt(t,[],this.globalPythonKernelSpecFinder.listKernelSpecs(r)).then(a=>this.appendNewKernels(a));await Promise.all([o,s])}async appendNewKernels(t){if(t.length)return t.forEach(r=>{at(r)&&r.kernelSpec.specFile?(this._kernelsExcludingCachedItems.set(r.id,r),this._kernels.has(r.id)?this._kernels.set(r.id,r):this._kernels.set(r.id,r)):p.warn(`Found a kernel ${r.kind}:'${r.id}', but excluded as specFile is undefined`)}),this.updateCache()}listGlobalPythonKernelSpecs(t){return this.kernelSpecsFromKnownLocations.kernels.filter(i=>i.kernelSpec.language===ge).filter(i=>t?!0:!Kn(i.kernelSpec))}listGlobalPythonKernelSpecsIncludingThoseRegisteredByUs(){return this.lastKnownGlobalPythonKernelSpecs=this.listGlobalPythonKernelSpecs(!0)}};Cu=v([(0,To.injectable)(),m(0,(0,To.inject)(rt)),m(1,(0,To.inject)(gr)),m(2,(0,To.inject)(zr)),m(3,(0,To.inject)(qe)),m(4,(0,To.inject)(as)),m(5,(0,To.inject)(We)),m(5,(0,To.named)(di)),m(6,(0,To.inject)(K)),m(7,(0,To.inject)(Vl)),m(8,(0,To.inject)(Sp))],Cu);var wf=class extends Yn{constructor(t,r,i,o,s,a){super();this.nonPythonKernelFinder=t;this.pythonKernelFinder=r;this.disposables=o;this.extensionChecker=s;this.interpreters=a;this._status="idle";this._onDidChangeStatus=new cw.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this.promiseMonitor=new ho;this.kind="localKernelSpec";this.id="localKernelSpec";this.displayName=y.localKernelSpecs;this._onDidChangeKernels=new cw.EventEmitter;this.onDidChangeKernels=this._onDidChangeKernels.event;this.wasPythonInstalledWhenFetchingControllers=!1;this.cache=[];this.disposables.push(this),i.registerKernelFinder(this),this.disposables.push(this._onDidChangeStatus),this.disposables.push(this._onDidChangeKernels),this.disposables.push(this.promiseMonitor)}get status(){return this._status}set status(t){this._status!==t&&(this._status=t,this._onDidChangeStatus.fire())}activate(){this.promiseMonitor.onStateChange(()=>{this.status=this.promiseMonitor.isComplete&&this.interpreters.status==="idle"&&this.nonPythonKernelFinder.status==="idle"&&this.pythonKernelFinder.status==="idle"?"idle":"discovering"}),this.updateCache();let t,r=()=>{[this.nonPythonKernelFinder.status,this.pythonKernelFinder.status,this.interpreters.status==="refreshing"?"discovering":"idle"].includes("discovering")?t||(t=ne(),this.promiseMonitor.push(t.promise)):(t?.resolve(),t=void 0)};r(),this.nonPythonKernelFinder.onDidChangeStatus(r,this,this.disposables),this.pythonKernelFinder.onDidChangeStatus(r,this,this.disposables),this.interpreters.onDidChangeStatus(r,this,this.disposables),this.updateCache(),this.interpreters.onDidChangeInterpreters(this.updateCache,this,this.disposables),cw.extensions.onDidChange(()=>{!this.wasPythonInstalledWhenFetchingControllers&&this.extensionChecker.isPythonExtensionInstalled&&this.updateCache()},this,this.disposables),this.nonPythonKernelFinder.onDidChangeKernels(this.updateCache,this,this.disposables),this.pythonKernelFinder.onDidChangeKernels(this.updateCache,this,this.disposables),this.wasPythonInstalledWhenFetchingControllers=this.extensionChecker.isPythonExtensionInstalled}async refresh(){let t=(async()=>{await this.nonPythonKernelFinder.refresh(),await this.pythonKernelFinder.refresh(),this.updateCache()})();this.promiseMonitor.push(t),await t}updateCache(){try{let t=[],r=this.nonPythonKernelFinder.kernels.filter(o=>this.extensionChecker.isPythonExtensionInstalled?o.kernelSpec.language!==ge:!0),i=this.pythonKernelFinder.kernels.filter(o=>_g(o));t=t.concat(r).concat(i),this.writeToCache(t)}catch(t){p.error("Exception Saving loaded kernels",t)}}get kernels(){let t=new Set,r=[];return this.pythonKernelFinder.kernels.forEach(i=>{let o=Kn(i.kernelSpec);i.kernelSpec.specFile&&o==="registeredByNewVersionOfExtForCustomKernelSpec"&&(t.add(i.kernelSpec.specFile),r.push(i))}),this.cache.forEach(i=>{i.kernelSpec.specFile&&t.has(i.kernelSpec.specFile)||r.push(i)}),r}writeToCache(t){let r=new Set;t=t.filter(u=>r.has(u.id)?!1:(r.add(u.id),!0));let i=this.cache,o=new Map(i.map(u=>[u.id,u])),s=new Map(t.map(u=>[u.id,u])),a=t.filter(u=>!o.has(u.id)),l=t.filter(u=>o.has(u.id)&&!ua(u,o.get(u.id))),c=i.filter(u=>!s.has(u.id));this.cache=t,(a.length||l.length||c.length)&&this._onDidChangeKernels.fire({removed:c})}};v([Zh("List kernels failed")],wf.prototype,"updateCache",1),wf=v([(0,Eu.injectable)(),m(0,(0,Eu.inject)(as)),m(1,(0,Eu.inject)(Cu)),m(2,(0,Eu.inject)(Ar)),m(3,(0,Eu.inject)(K)),m(4,(0,Eu.inject)(qe)),m(5,(0,Eu.inject)(rt))],wf);var sb=k(N());var uw=require("vscode"),$4=require("os");function B4(n){let e=Ue(n);return!!(J4(n)&&(e==="Unknown"||e==="Pyenv"||e==="Conda"))}function J4(n){let e=Ri(n)?.major??3,t=Ri(n)?.minor??6;return e>=3&&t>=6}var wu=class{constructor(e,t,r){this.pythonExecutionFactory=e;this.disposableRegistry=t;this.context=r;this.messages=new Map;this.requestCounter=0}async createInterrupter(e,t){try{return await this.createInterrupterImpl(e,t)}catch(r){return p.error("Failed to create interrupter, trying again",r),this.createInterrupterImpl(e,t)}}async createInterrupterImpl(e,t){let r=await this.sendCommand({command:"INITIALIZE_INTERRUPT"},e,t);if(!r)throw p.error("Unable to initialize interrupt handle"),new Error("Unable to initialize interrupt handle");return{handle:r,interrupt:async()=>{await this.sendCommand({command:"INTERRUPT",handle:r},e,t)},dispose:()=>{this.sendCommand({command:"DISPOSE_INTERRUPT_HANDLE",handle:r},e,t).catch(i=>p.error(`Failed to dispose interrupt handle for ${e.id}`,i))}}}async getInterpreter(e){if(e&&B4(e))return e;let t=mo();return t.length===0?e:Ai(t.find(B4))||Ai(t.find(J4))||e}async initializeInterrupter(e,t){if(this.startupPromise)return this.startupPromise;let r=(async()=>{let i=await this.getInterpreter(e),o=await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:i,resource:t}),s=uw.Uri.joinPath(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers"),a=uw.Uri.joinPath(s,"kernel_interrupt_daemon.py"),l=o.execObservable([a.fsPath,"--ppid",process.pid.toString()],{cwd:s.fsPath});return await new Promise((c,u)=>{let d=!1,f=l.out.onDidChange(g=>{if(p.ci(`Output from interrupt daemon started = ${d}, output (${g.source}) = ${g.out} ('END)`),g.source==="stdout"&&g.out.trim().includes("DAEMON_STARTED:")&&!d)d=!0,c();else if(g.source==="stderr"&&g.out.includes("INTERRUPT:")&&g.out.includes("ERROR: handling command :INITIALIZE_INTERRUPT:")&&d)Be(g.out,{trim:!0,removeEmptyEntries:!0}).filter(b=>b.includes("INTERRUPT:")).forEach(b=>{try{let I=b.split(":"),w=parseInt(I[I.indexOf("INITIALIZE_INTERRUPT")+1],10),_=this.messages.get(w);_&&(p.error(`Failed to initialize interrupt daemon for ${w}, ${g.out}`),_.deferred.reject(new Error(`Failed to start interrupt daemon ${g.out}`)),this.messages.delete(w))}catch(I){p.error(`Failed to parse interrupt daemon response, ${g.out}`,I)}});else if(g.source==="stdout"&&g.out.includes("INTERRUPT:")&&d)Be(g.out,{trim:!0,removeEmptyEntries:!0}).filter(b=>b.includes("INTERRUPT:")).forEach(b=>{try{let[I,w,_]=b.split(":"),A=this.messages.get(parseInt(w,10));A?(p.trace(`Got a response of ${_} for ${I}:${w}`),A.deferred.resolve(_),this.messages.delete(parseInt(w,10))):p.error(`Got a response of ${_} for ${I}:${w} but no command entry found in ${g.out}`)}catch(I){p.error(`Failed to parse interrupt daemon response, ${g.out}`,I)}});else if(g.out.includes("ERROR: handling command")){if(p.warn(`Error output in interrupt daemon response ${g.out} ('END')`),!d)return u(new Error(`Interrupt daemon failed to start, ${g.out}`));try{let b=g.out.split(":")[2],I=this.messages.get(parseInt(b,10));if(I){I.deferred.reject(new Error(g.out)),this.messages.delete(parseInt(b,10));return}}catch(b){p.error(`Failed to parse interrupt daemon response, ${g.out}`,b)}}});this.disposableRegistry.push(f)}),this.disposableRegistry.push(new uw.Disposable(()=>ci(()=>l.proc?.kill()))),l.proc?.on("close",()=>{p.ci("Interrupt daemon closed"),this.startupPromise=void 0}),l.proc?.on("exit",()=>{p.ci("Interrupt daemon exited"),this.startupPromise=void 0}),l})();return r.catch(i=>p.error(`Failed to start interrupt daemon for (${e.id})`,i)),this.startupPromise=r,r}async sendCommand(e,t,r){let i=ne(),o=this.requestCounter++;this.messages.set(o,{command:e,deferred:i});let s=e.command==="INITIALIZE_INTERRUPT"?`${e.command}:${o}`:`${e.command}:${o}:${e.handle}`,{proc:a}=await this.initializeInterrupter(t,r);if(!a||!a.stdin)throw p.error("No process or stdin"),new Error("No process or stdin");a.stdin.write(`${s}${$4.EOL}`),p.ci(`Sending Interrupt Request id=${o}, Command ${e.command} for ${t.id}`);let l=await i.promise;if(p.ci(`Got Interrupt Response id=${o}, Command ${e.command} for ${t.id}`),e.command==="INITIALIZE_INTERRUPT")return parseInt(l,10)}};wu=v([(0,sb.injectable)(),m(0,(0,sb.inject)(Vr)),m(1,(0,sb.inject)(K)),m(2,(0,sb.inject)(tt))],wu);var ET=k(N());var dw=require("vscode");var ac=class{constructor(e){this.platform=e;this.programData=process.env.PROGRAMDATA?dw.Uri.file(mn(process.env.PROGRAMDATA)):void 0}get trustedKernelSpecs(){return dw.workspace.getConfiguration("jupyter",void 0).get("kernels.trusted",[])}isTrusted(e){let t=this.isTrustedImpl(e);return!t&&!ac.IsKernelSpecHidden.completed&&ac.IsKernelSpecHidden.resolve(!0),t}isTrustedImpl(e){return e.scheme!=="file"||this.trustedKernelSpecs.map(t=>this.platform.isWindows?t.toLowerCase():t).map(t=>dw.Uri.file(t).path).includes(this.platform.isWindows?e.path.toLowerCase():e.path)?!0:this.platform.isWindows&&this.programData?!e.path.toLowerCase().startsWith(this.programData.path.toLowerCase()):!0}};ac.IsKernelSpecHidden=ne(),ac=v([(0,ET.injectable)(),m(0,(0,ET.inject)(xr))],ac);var rz=k(Qo()),cs=k(N()),nz=k(require("os"));var iz=require("util"),UT=require("vscode");var PF=require("process"),VG=k(Qo()),jG=k(require("crypto")),mb=k(require("os"));var fb=require("vscode");var kF=k(oG());var LG="To connect another client to this kernel, use:",UG=["NOTE: When using the `ipython kernel` entry point, Ctrl-C will not work.","To exit, you will have to explicitly quit this process, by either sending",'"quit" from a client, or using Ctrl-\\ in UNIX-like environments.',"To read more about this, see https://github.com/ipython/ipython/issues/2049","It seems that frozen modules are being used, which may","make the debugger miss breakpoints. Please pass -Xfrozen_modules=off","to python to disable frozen modules","Debugging will proceed. Set PYDEVD_DISABLE_FILE_VALIDATION"],RT=class{static async waitUntilFree(e,t,r){await(await Promise.resolve().then(()=>k(wF()))).default.waitUntilFree(e,t,r)}static async waitUntilUsed(e,t,r){await(await Promise.resolve().then(()=>k(wF()))).default.waitUntilUsed(e,t,r)}},pb=class extends Yn{constructor(t,r,i,o,s,a,l,c,u,d,f,g,b){super();this.processExecutionFactory=t;this._connection=r;this.fileSystem=o;this.resource=s;this.extensionChecker=a;this.kernelEnvVarsService=l;this.pythonExecFactory=c;this.outputChannel=u;this.jupyterSettings=d;this.jupyterPaths=f;this.pythonKernelInterruptDaemon=g;this.platform=b;this.exitEvent=new fb.EventEmitter;this.exitEventFired=!1;this._kernelConnectionMetadata=i}get pid(){return this._pid}get exited(){return this.exitEvent.event}get kernelConnectionMetadata(){return this._kernelConnectionMetadata}get connection(){return this._connection}get isPythonKernel(){return Xe(this.kernelConnectionMetadata)&&cu(this.kernelConnectionMetadata)}get canInterrupt(){return this._kernelConnectionMetadata.kernelSpec.interrupt_mode!=="message"}async interrupt(){if(this.canInterrupt)if(this._kernelConnectionMetadata.kernelSpec.interrupt_mode!=="message"&&this._process&&!this.interrupter)p.info("Interrupting kernel via SIGINT"),this._process.pid&&(await this.interruptChildProcesses(this._process.pid),(0,PF.kill)(this._process.pid,"SIGINT"));else{if(this._kernelConnectionMetadata.kernelSpec.interrupt_mode!=="message"&&this._process&&this.interrupter&&Xe(this._kernelConnectionMetadata))return p.info("Interrupting kernel via custom event (Win32)"),this.interrupter.interrupt();p.error("No process to interrupt in KernleProcess.ts")}else throw new Error("Kernel interrupt not supported in KernelProcess.ts")}async launch(t,r,i){if(this.launchedOnce)throw new Error("Kernel has already been launched.");this.launchedOnce=!0;let o=kn(this.resource),s=o?.updateConnection();await this.updateConnectionArgs(),s?.stop(),bn.throwIfCanceled(i);let a=o?.spawn(),l=await this.launchAsObservable(t,i);a?.stop();let c=l.proc;if(i.isCancellationRequested)throw new fb.CancellationError;p.debug(`Kernel process ${c?.pid}.`);let u="",d=null,f=ne();if(f.promise.catch(h),c){let b=c.pid;c.on("exit",w=>{if(w=w||d,this.isDisposed){p.debug(`KernelProcess Exited ${b}, Exit Code - ${w}`);return}p.debug(`KernelProcess Exited ${b}, Exit Code - ${w}`,u),this.exitEventFired||(this.exitEvent.fire({exitCode:w||void 0,reason:og(u)||u,stderr:u}),this.exitEventFired=!0),i.isCancellationRequested||(p.ci("KernelProcessExitedError raised",u),f.reject(new ec(w||-1,u,this.kernelConnectionMetadata)))});let I=!1;c.stdout?.on("data",w=>{let _=(w||"").toString();Xe(this.kernelConnectionMetadata)&&!I&&(_=WG(_),_.includes(LG)&&(_=_.trimStart())),_.includes(LG)&&(I=!0),p.debug(`Kernel output ${b}: ${_}`),this.sendToOutput(_)}),c.stderr?.on("data",w=>{let _=WG((w||"").toString());u+=_,_.trim().length&&!_.includes("It seems that frozen modules are being used, which may")&&!_.includes("make the debugger miss breakpoints. Please pass -Xfrozen_modules=off")&&!_.includes("to python to disable frozen modules")&&!_.includes("Debugging will proceed. Set PYDEVD_DISABLE_FILE_VALIDATION")&&(p.debug(`KernelProcess error ${b}: ${_}`),this.sendToOutput(_))})}l.out.done.catch(b=>{if(this.isDisposed){p.warn("Kernel died",b,u);return}p.error("Kernel died",b,u),f.reject(b)});let g=kn(this.resource)?.portUsage();try{f.rejected&&await f.promise;let b=Se.instance.get(Sd).inExperiment("DoNotWaitForZmqPortsToBeUsed"),I=new Me,w=b?Promise.resolve():Promise.all([RT.waitUntilUsed(this.connection.shell_port,200,r),RT.waitUntilUsed(this.connection.iopub_port,200,r)]).catch(_=>{if(!(i.isCancellationRequested||f.rejected)&&(p.warn(`Waited ${I.elapsedTime}ms for kernel to start`,_),!b))return Promise.reject(new gy(this.kernelConnectionMetadata))});await Nt(i,w,f.promise)}catch(b){let I=(u||"").trim();if(!i?.isCancellationRequested&&!Zt(b)&&(p.error("Disposing kernel process due to an error",b),b&&b instanceof Error&&I.length&&b.message.includes(I)||p.error(I)),await this.dispose(),!i?.isCancellationRequested&&b instanceof $e)throw b;{i?.isCancellationRequested&&p.debug("User cancelled the kernel launch");let w=Tk(I)||I.substring(0,100);throw p.ci("KernelDiedError raised",w,u+`
`+u+`
`),new dp(y.kernelDied(w),u+`
`+u+`
`,b,this.kernelConnectionMetadata)}}finally{g?.stop()}}dispose(){if(this._disposingPromise||this.isDisposed)return;let t=this._process?.pid;p.debug(`Dispose Kernel process ${t}.`),this._disposingPromise=(async()=>{await Bt(1e3,this.killChildProcesses(this._process?.pid).catch(h));try{this.interrupter?.dispose(),this._process?.kill(),this.exitEventFired||this.exitEvent.fire({stderr:""})}catch(r){p.error(`Error disposing kernel process ${t}`,r)}this.connectionFile&&await this.fileSystem.delete(this.connectionFile).catch(r=>p.warn(`Failed to delete connection file ${this.connectionFile} for pid ${t}`,r)),p.debug(`Disposed Kernel process ${t}.`)})(),this._disposingPromise.finally(()=>super.dispose()).catch(h)}async killChildProcesses(t){if(!(!t||!ka.isAlive(t)))try{if(this.platform.isWindows){let r=process.env.WINDIR||"C:\\Windows",i=Ve(r,"System32","taskkill.exe");await new ka().exec(i,["/F","/T","/PID",t.toString()])}else await new Promise(r=>{(0,kF.default)(t,(i,o)=>{i?p.warn(`Failed to kill children for ${t}`,i):o.forEach(s=>ka.kill(s)),r()})})}catch(r){p.warn(`Failed to kill children for ${t}`,r)}}async interruptChildProcesses(t){if(ka.isAlive(t))try{if(this.platform.isWindows)return;await new Promise(r=>{(0,kF.default)(t,(i,o)=>{i?p.warn(`Failed to interrupt children for ${t}`,i):o.forEach(s=>(0,PF.kill)(s,"SIGINT")),r()})})}catch(r){p.warn(`Failed to interrupt children for ${t}`,r)}}sendToOutput(t){this.outputChannel&&this.outputChannel.append(t)}get launchKernelSpec(){if(this._launchKernelSpec)return this._launchKernelSpec;let t=this._kernelConnectionMetadata.kernelSpec;if(!t)throw new Error("KernelSpec cannot be empty in KernelProcess.ts");return Array.isArray(t.argv)?this._launchKernelSpec={...t,argv:[...t.argv]}:(p.error("KernelSpec.argv in KernelProcess is undefined"),this._launchKernelSpec=void 0),this._launchKernelSpec}async updateConnectionArgs(){let t=hJ(this.launchKernelSpec);if(t===-1)throw new Error(`Connection file not found in kernelspec json args, ${this.launchKernelSpec.argv.join(" ")}`);if(this.isPythonKernel&&t===0&&this.launchKernelSpec.argv[t-1]!=="-f")throw new Error(`Connection file not found in kernelspec json args, ${this.launchKernelSpec.argv.join(" ")}`);let r=await this.jupyterPaths.getRuntimeDir(),i=`kernel-v3${jG.randomBytes(20).toString("hex")}.json`;if(this.connectionFile=fb.Uri.joinPath(r,i),this.isPythonKernel)this.launchKernelSpec.argv.splice(t-1,2),this.launchKernelSpec.argv.push(...this.addPythonConnectionArgs(this.connectionFile)),await this.fileSystem.writeFile(this.connectionFile,JSON.stringify(this._connection));else{await this.fileSystem.writeFile(this.connectionFile,JSON.stringify(this._connection));let o=this.connectionFile.fsPath.includes(" ")?`"${this.connectionFile.fsPath}"`:this.connectionFile.fsPath;this.launchKernelSpec.argv[t].includes("--connection-file")?this.launchKernelSpec.argv[t]=this.launchKernelSpec.argv[t].replace(Km,o):this.launchKernelSpec.argv[t].includes(`=${Km}`)&&!this.launchKernelSpec.argv[t].trim().startsWith("=")?this.launchKernelSpec.argv[t]=this.launchKernelSpec.argv[t].replace(Km,o):this.launchKernelSpec.argv[t]=this.launchKernelSpec.argv[t].replace(Km,this.connectionFile.fsPath)}}addPythonConnectionArgs(t){let r=[],i=t.fsPath.includes(" ")?`"${t.fsPath}"`:t.fsPath;return r.push(`--f=${i}`),r}async launchAsObservable(t,r){let i;if(p.debug(`Launching kernel ${this.kernelConnectionMetadata.id} for ${M(this.resource)} in ${M(t)} with ports ${this.connection.control_port}, ${this.connection.hb_port}, ${this.connection.iopub_port}, ${this.connection.shell_port}, ${this.connection.stdin_port}`),this.isPythonKernel&&this.extensionChecker.isPythonExtensionInstalled&&this._kernelConnectionMetadata.interpreter){let o=kn(this.resource),[s,a,l]=[o?.pythonEnvVars(),o?.envVars(),mb.platform()==="win32"?o?.interruptHandle():void 0],c=this.pythonExecFactory.createActivatedEnvironment({resource:this.resource,interpreter:this._kernelConnectionMetadata.interpreter}),u=mb.platform()==="win32"?this.getWin32InterruptHandle().finally(()=>l?.stop()):l?.stop(),[d,f,g]=await Promise.all([c.finally(()=>s?.stop()),VG.pathExists(t),this.kernelEnvVarsService.getEnvironmentVariables(this.resource,this._kernelConnectionMetadata.interpreter,this._kernelConnectionMetadata.kernelSpec,r).finally(()=>a?.stop())]);if(bn.throwIfCanceled(r),mb.platform()==="win32"&&u){g=g||process.env;try{let I=await u;g.JPY_INTERRUPT_EVENT=`${I}`,p.ci(`Got interrupt handle kernel id ${I} for interpreter ${this._kernelConnectionMetadata.interpreter.id}`)}catch(I){p.error(`Failed to get interrupt handle kernel id ${this._kernelConnectionMetadata.id} for interpreter ${this._kernelConnectionMetadata.interpreter.id}`,I)}}bn.throwIfCanceled(r);let b=this.launchKernelSpec.argv.slice(1);this.jupyterSettings.enablePythonKernelLogging&&b.push("--debug"),i=d.execObservable(b,{cwd:f?t:process.cwd(),env:g}),bn.throwIfCanceled(r)}else{let o=this.launchKernelSpec.argv[0];p.info(`Launching Raw Kernel ${this.launchKernelSpec.display_name} # ${o}`);let[s,a]=await Promise.all([this.processExecutionFactory.create(this.resource,r),this.kernelEnvVarsService.getEnvironmentVariables(this.resource,this._kernelConnectionMetadata.interpreter,this.launchKernelSpec,r)]);bn.throwIfCanceled(r);let l=this.launchKernelSpec.argv.slice(1);i=s.execObservable(o,l,{env:a,cwd:t})}if(!i.proc)throw new mt("KernelProcess failed to launch",void 0,"kernelProcessFailedToLaunch");return this._process=i.proc,this._pid=i.proc.pid,i}async getWin32InterruptHandle(){return this.interrupter||(this.interrupter=await this.pythonKernelInterruptDaemon.createInterrupter(this._kernelConnectionMetadata.interpreter,this.resource)),this.interrupter.handle}};v([fr("DS_INTERNAL.RAWKERNEL_PROCESS_LAUNCH")],pb.prototype,"launch",1),v([m(1,eg())],pb.prototype,"launchAsObservable",1);function WG(n){let e=Be(n,{trim:!0,removeEmptyEntries:!0});return e.some(t=>t.includes("FutureWarning: Supporting extra quotes around strings is deprecated in traitlets 5.0."))&&e.some(t=>t.trim()==="warn(")&&e.some(t=>t.includes("FutureWarning: Supporting extra quotes around Bytes is deprecated in traitlets 5.0."))||e.some(t=>UG.some(r=>t.includes(r)))?e.filter(t=>!t.endsWith(`FutureWarning: Supporting extra quotes around strings is deprecated in traitlets 5.0. You can use 'hmac-sha256' instead of '"hmac-sha256"' if you require traitlets >=5.`)&&t.trim()!=="warn("&&!t.includes("FutureWarning: Supporting extra quotes around Bytes is deprecated in traitlets 5.0. Use")&&UG.every(r=>!t.includes(r))).join(mb.EOL).trimStart():n}var kme="kernelLauncherPortStart_{0}.tmp",Gs=class{constructor(e,t,r,i,o,s,a,l,c,u){this.processExecutionFactory=e;this.fs=t;this.extensionChecker=r;this.kernelEnvVarsService=i;this.disposables=o;this.pythonExecFactory=s;this.configService=a;this.jupyterPaths=l;this.pythonKernelInterruptDaemon=c;this.platformService=u}static async computeStartPort(){if(Rr()){let e=9e3,t=0;for(;t===0&&e<65e3;)try{let r=Ve(nz.tmpdir(),vC(kme,e.toString()));await rz.open(r,"wx"),t=e}catch{e+=1e3}return p.trace(`Computed port start for KernelLauncher is : ${t}`),t}else return 9e3}async launch(e,t,r,i,o){xme(r,e,this.pythonExecFactory,o).catch(h);let s=new Me,a=kn(r)?.getConnection(),l=await Nt(o,this.getKernelConnection(e));a?.stop();let c=r?Ce(r.fsPath):"",u=this.configService.getSettings(r),d=u.logKernelOutputSeparately||u.development?UT.window.createOutputChannel(y.kernelConsoleOutputChannel(c),"log"):void 0;d?.clear();let f=O_(l.control_port,l.hb_port,l.iopub_port,l.shell_port,l.stdin_port),g=new pb(this.processExecutionFactory,l,e,this.fs,r,this.extensionChecker,this.kernelEnvVarsService,this.pythonExecFactory,d,u,this.jupyterPaths,this.pythonKernelInterruptDaemon,this.platformService);ba(g.onDidDispose)(()=>f.dispose(),this,this.disposables),ba(g.exited)(()=>d?.dispose(),this,this.disposables);try{await Nt(o,g.launch(i,t,o))}catch(I){throw await g.dispose(),bn.throwIfCanceled(o),I}let b=ba(g.exited)(({exitCode:I,reason:w})=>{Ct(r,"DS_INTERNAL.RAWKERNEL_SESSION_KERNEL_PROCESS_EXITED",I?{exitCode:I}:void 0,{exitReason:og(w)}),qs.delete(l.control_port),qs.delete(l.hb_port),qs.delete(l.iopub_port),qs.delete(l.shell_port),qs.delete(l.stdin_port),b.dispose()},this,this.disposables);if(o?.isCancellationRequested)throw await g.dispose(),new UT.CancellationError;return T("DS_INTERNAL.KERNEL_LAUNCHER_PERF",{duration:s.elapsedTime},{resourceType:to(r)}),g}async chainGetConnectionPorts(){return this.portChain&&await this.portChain,this.portChain=this.getConnectionPorts(),this.portChain}static async findNextFreePort(e){let r=await(0,iz.promisify)((await Promise.resolve().then(()=>k(tz()))).getPorts)(5,{host:"127.0.0.1",port:e});if(r.some(i=>qs.has(i))){let i=Math.max(...qs,...r);return Gs.findNextFreePort(i)}return r.forEach(i=>qs.add(i)),r}async getConnectionPorts(){let e=await Gs.startPortPromise;return Gs.findNextFreePort(e)}async getKernelConnection(e){let t=await this.chainGetConnectionPorts();return{key:lr(),signature_scheme:"hmac-sha256",transport:"tcp",ip:"127.0.0.1",hb_port:t[0],control_port:t[1],shell_port:t[2],stdin_port:t[3],iopub_port:t[4],kernel_name:e.kernelSpec?.name||"python"}}};Gs.startPortPromise=Gs.computeStartPort(),Gs=v([(0,cs.injectable)(),m(0,(0,cs.inject)(Li)),m(1,(0,cs.inject)(gr)),m(2,(0,cs.inject)(qe)),m(3,(0,cs.inject)(Na)),m(4,(0,cs.inject)(K)),m(5,(0,cs.inject)(Vr)),m(6,(0,cs.inject)(oe)),m(7,(0,cs.inject)(zr)),m(8,(0,cs.inject)(wu)),m(9,(0,cs.inject)(xr))],Gs);async function xme(n,e,t,r){let i=e.interpreter;if(!at(e)||!Xe(e)||!i)return;let s=await(await t.createActivatedEnvironment({interpreter:i,resource:n})).exec(["-c",'import ipykernel; print(ipykernel.__version__); print("5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d"); print(ipykernel.__file__)'],{token:r});if(r.isCancellationRequested)return;let a=M(i.uri);if(s.stdout){let l=s.stdout.trim().split("5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d").map(c=>c.trim()).filter(c=>c.length>0);l.length===2?p.trace(`ipykernel version & path ${l[0]}, ${t8(l[1])} for ${a}`):p.trace(`ipykernel version & path ${s.stdout.trim()} for ${a}`)}if(s.stderr){let l=Be(s.stderr.trim(),{removeEmptyEntries:!0,trim:!0}).map((c,u)=>u===0?c:`    ${c}`).join(`
`);p.warn(`Stderr output when getting ipykernel version & path ${l} for ${a}`)}}var yb=k(N());var oz=require("vscode"),WT=class extends $y{constructor(t,r,i){super("localRaw",t);this.resource=r;this.kernelConnectionMetadata=i;this.shutdownInProgress=!1;this._register(new oz.Disposable(()=>this.session.dispose())),this.initializeKernelSocket()}get status(){return this.terminatingStatus&&!this.isDisposed?this.terminatingStatus:this.isDisposed?"dead":this.session.kernel?this.session.kernel.status:(p.ci(`Real kernel is ${this.session.kernel?"defined":"undefined"}`),"unknown")}dispose(){this.shutdown().finally(()=>super.dispose())}async waitForIdle(t,r){try{await By(this.kernelConnectionMetadata,this.resource,this.session,t,r)}catch(i){throw p.ci("Error waiting for idle",i),await this.shutdown().catch(h),i}}async shutdown(){if(this.isDisposed||this.shutdownInProgress)return;this.shutdownInProgress=!0,this.terminatingStatus="terminating",this.statusChanged.emit("terminating");let t=`${this.session.kernel?.id}, ${this.kernelConnectionMetadata?.id}`;p.debug(`Shutdown session ${t} - start called from ${new Error("").stack}`),jy(this.session.kernel),await Bt(1e3,this.session.shutdown().catch(h)),this.didShutdown.fire(),this.dispose(),p.debug(`Shutdown session ${t} - shutdown complete`)}};var zs=k(tT());var JT=k(cz());var Pu=k(Qo());var jT=k(require("os"));var uz=k(Qo()),NF=k(require("os"));var Rme=["AlmaLinux","Alt","Amazon","Arch","ArchLinux","Asahi","Asahi Linux","Asianux","Alpine","Berry","BlackArch","BlackArch Linux","Cent","CentOS","Clear","Clear Linux","Clear","ClearOS","Debian","Elementary","Endeavour","EndeavourOS","Easy","EasyOS","Fedora","Fermi","Fuduntu","FreeBSD","Gecko","Gentoo","Kali","KDE","Knoppix","Kubuntu","Linux","LinuxMint","Mageia","Manjaro","Mint","Miracle","MX","MX Linux","Navy","Navy Linux","Nitrux","NixOS","openSUSE","Oracle","Pop!_OS","RasPiOS","Raspbian","Red Hat Enterprise Linux","Red Hat Linux","Red Hat","Rocks","Rocky","Rocky Linux","Rosa","Scientific","Scientific Linux","Slackware","SmartOS","SUSE","SUSE Linux","SUSE Liberty Linux","Ubuntu","VZLinux","Xubuntu","Zorin"],Ame=new RegExp(/^[0-9 .]*$/);async function dz(){let n={id:"",version_id:""};if(NF.platform()==="darwin"||NF.platform()==="win32")return n;try{let e=await uz.readFile("/etc/os-release","utf-8");Be(e).forEach(t=>{let r=t.toUpperCase().trim().startsWith("ID="),i=t.toUpperCase().trim().startsWith("VERSION_ID=");if(r||i){let o=t.substring(t.indexOf("=")+1).replace(/"/g,"").toUpperCase();if(r)n.id=Rme.filter(s=>o.includes(s.toUpperCase())).join(", ");else{let s=parseFloat(o)||"";n.version_id=Ame.test(o)?o:s.toString()}}})}catch(e){p.error("Failed to read distro info",e)}return n}var Nme="zeromq";function BT(){try{let n=require(Nme);return n.context.blocky=!1,MF(!1).catch(h),n}catch(n){try{let e=require(Ve(Yo,"dist","node_modules","zeromqold"));return p.info("ZMQ loaded via fallback mechanism."),MF(!1,!0,n.message||n.toString()).catch(h),e}catch(e){throw MF(!0,!0,n.message||n.toString(),e.message||e.toString()).catch(h),p.warn("Exception while attempting zmq :",n.message||n),p.warn("Exception while attempting zmq (fallback) :",e.message||e),e}}}async function Mme(){try{let n=Ve(Yo,"dist","node_modules","zeromq","prebuilds");if(!await Pu.pathExists(Ve(Yo,"dist","node_modules")))return;let e=await Pu.readdir(n).then(r=>r.map(async i=>{let o=Ve(n,i);return(await Pu.stat(o)).isDirectory()?Pu.readdir(o).then(a=>a.map(l=>Ve(o,l))):[]}));return(await Promise.all(e.flat())).flat().map(r=>r.substring(r.lastIndexOf("prebuilds")+9+1).replace(/\\/g,"<sep>").replace(/\//g,"<sep>"))}catch(n){return p.warn("Failed to determine local zmq binaries.",n),["Failed to determine local zmq binaries."]}}var pz=!1;async function MF(n,e=!1,t="",r=""){if(pz)return;pz=!0;let[i,o]=await Promise.all([dz().catch(()=>({id:"",version_id:""})),Mme()]),s=Kme();T("DS_INTERNAL.JUPYTER_ZMQ_SUPPORT",void 0,{distro_id:i.id,distro_version_id:i.version_id,failed:n,fallbackTried:e,alpine:s.alpine,libc:s.libc,armv:s.armv,zmqarch:s.zmqarch}),T("DS_INTERNAL.JUPYTER_ZMQ_SUPPORT_FAILURE",void 0,{distro_id:i.id,distro_version_id:i.version_id,failed:n,fallbackTried:e,alpine:s.alpine,libc:s.libc,armv:s.armv,zmqarch:s.zmqarch,errorMessage:t,zmqBinaries:o,fallbackErrorMessage:r})}function mz(n){return n==="linux"&&Pu.existsSync("/etc/alpine-release")}function Kme(){try{let n=process.config&&process.config.variables||{},t=(process.env.npm_config_arch||"").trim()||jT.arch(),r=process.env.npm_config_platform||jT.platform(),i=mz(r),o=process.env.LIBC||(mz(r)?"musl":"glibc"),s=process.env.ARM_VERSION||(t==="arm64"?"8":n.arm_version)||"";return{alpine:i,libc:String(o),armv:String(s),zmqarch:t}}catch(n){return p.warn("Failed to determine platform information used to load zeromq binary.",n),{}}}function Ome(n,e){let t=n.transport==="tcp"?":":"-",r=n[`${e}_port`];if(!r)throw new Error(`Port not found for channel "${e}"`);return`${n.transport}://${n.ip}${t}${r}`}var $T=class{constructor(e,t){this.connection=e;this.serialize=t;this.onopen=h;this.onerror=h;this.onclose=h;this.onmessage=h;this.receiveHooks=[];this.sendHooks=[];this.msgChain=Promise.resolve();this.sendChain=Promise.resolve();this.closed=!1;this.protocol="";this.channels=this.generateChannels(e)}dispose(){this.closed||this.close()}close(){this.closed=!0;let e=t=>{try{t.close()}catch(r){p.error("Error during socket shutdown",r)}};e(this.channels.control),e(this.channels.iopub),e(this.channels.shell),e(this.channels.stdin)}emit(e,...t){switch(e){case"message":this.onmessage({data:t[0],type:"message",target:this});break;case"close":this.onclose({wasClean:!0,code:0,reason:"",target:this});break;case"error":this.onerror({error:"",message:"to do",type:"error",target:this});break;case"open":this.onopen({target:this});break;default:break}return!0}send(e,t){this.sendMessage(e,!1)}addReceiveHook(e){this.receiveHooks.push(e)}removeReceiveHook(e){this.receiveHooks=this.receiveHooks.filter(t=>t!==e)}addSendHook(e){this.sendHooks.push(e)}removeSendHook(e){this.sendHooks=this.sendHooks.filter(t=>t!==e)}generateChannel(e,t,r){let i=r();return i.connect(Ome(e,t)),this.processSocketMessages(t,i).catch(o=>p.error(`Failed to read messages from channel ${t}`,o)),i}async processSocketMessages(e,t){for await(let r of t){if(this.closed)break;this.onIncomingMessage(e,r)}}generateChannels(e){let t=BT(),r=lr(),i={iopub:this.generateChannel(e,"iopub",()=>new t.Subscriber({maxMessageSize:-1,receiveHighWaterMark:0})),shell:this.generateChannel(e,"shell",()=>new t.Dealer({routingId:r,sendHighWaterMark:0,receiveHighWaterMark:0,maxMessageSize:-1})),control:this.generateChannel(e,"control",()=>new t.Dealer({routingId:r,sendHighWaterMark:0,receiveHighWaterMark:0,maxMessageSize:-1})),stdin:this.generateChannel(e,"stdin",()=>new t.Dealer({routingId:r,sendHighWaterMark:0,receiveHighWaterMark:0,maxMessageSize:-1}))};return i.iopub.subscribe(),i}onIncomingMessage(e,t){let r=this.closed?{}:JT.decode(t,this.connection.key,this.connection.signature_scheme);r.channel=e,this.receiveHooks.length?this.msgChain=this.msgChain.then(()=>{let i=this.serialize(r);return Promise.all(this.receiveHooks.map(o=>o(i)))}).then(()=>this.fireOnMessage(r,e)):this.msgChain=this.msgChain.then(()=>this.fireOnMessage(r,e))}fireOnMessage(e,t){if(!this.closed)try{Lme(e,t),this.onmessage({data:e,type:"message",target:this})}catch(r){p.error(`Failed to handle message in Jupyter Kernel package ${JSON.stringify(e)}`,r)}}sendMessage(e,t){let r=JT.encode(e,this.connection.key,this.connection.signature_scheme);if(!t&&this.sendHooks.length){let i=this.serialize(e);this.sendChain=this.sendChain.then(()=>Promise.all(this.sendHooks.map(o=>o(i,h)))).then(async()=>{try{await this.postToSocket(e.channel,r)}catch(o){p.error(`Failed to write data to the kernel channel ${e.channel}`,r,o)}})}else this.sendChain=this.sendChain.then(()=>{this.postToSocket(e.channel,r)});this.sendChain.catch(h)}postToSocket(e,t){let r=this.channels[e];r?r.send(t).catch(i=>{p.error("Error communicating with the kernel",i)}):p.error(`Attempting to send message on invalid channel: ${e}`)}},Fme=["username","version","session","msg_id","msg_type"],fz={stream:{name:"string",text:"string"},display_data:{data:"object",metadata:"object"},execute_input:{code:"string",execution_count:"number"},execute_result:{execution_count:"number",data:"object",metadata:"object"},error:{ename:"string",evalue:"string",traceback:"object"},status:{execution_state:["string",["starting","idle","busy","restarting","dead"]]},clear_output:{wait:"boolean"},comm_open:{comm_id:"string",target_name:"string",data:"object"},comm_msg:{comm_id:"string",data:"object"},comm_close:{comm_id:"string"},shutdown_reply:{restart:"boolean"}};function Lme(n,e){let t=n.header;Fme.forEach(r=>{typeof t[r]!="string"&&(t[r]="")}),typeof n.channel!="string"&&(n.channel=e),n.content||(n.content={}),n.metadata||(n.metadata={}),n.channel==="iopub"&&Ume(n)}function Ume(n){if(n.channel!=="iopub")return;let e=n.header.msg_type;if(e in fz){let t=fz[e];if(t===void 0)return;let r=Object.keys(t),i=n.content;for(let o=0;o<r.length;o++){let s=t[r[o]];Array.isArray(s)||(s=[s]);let a=r[o];if(!(a in i)||typeof i[a]!==s[0])switch(s[0]){case"string":i[a]="";break;case"boolean":i[a]=!1;break;case"object":i[a]={};break;case"number":i[a]=0;break}}}}var ku=k(tT()),Ep=require("vscode");var KF,qT=class{constructor(e,t,r,i,o){this.resource=e;this.kernelLauncher=t;this.workingDirectory=r;this.launchTimeout=i;this.kernelConnectionMetadata=o;this.statusChanged=new ku.Signal(this);this.connectionStatusChanged=new ku.Signal(this);this.iopubMessage=new ku.Signal(this);this.unhandledMessage=new ku.Signal(this);this.anyMessage=new ku.Signal(this);this.disposed=new ku.Signal(this);this.pendingInput=new ku.Signal(this);this.id=lr();this.clientId=lr();this.username=lr();this.infoDeferred=ne();this.name=_d(o)||"python3",this.model={name:this.name,id:this.id}}get connectionStatus(){return this.realKernel?this.realKernel.connectionStatus:"connecting"}get serverSettings(){return this.realKernel.serverSettings}get status(){return this.isDisposed||this.hasShutdown?"dead":this.isRestarting?"restarting":this.isShuttingDown?"terminating":this.realKernel?this.realKernel.status:"starting"}get info(){return this.realKernel?this.realKernel.info:this.infoDeferred.promise}get handleComms(){return this.realKernel.handleComms}get hasPendingInput(){return this.realKernel.hasPendingInput}get isDisposed(){return this._isDisposed||this.realKernel?.isDisposed===!0}async restart(){this.stopHandlingKernelMessages(),this._isDisposed=!1,this.isShuttingDown=!1,this.hasShutdown=!1,this.isRestarting=!0,this.restartToken=new Ep.CancellationTokenSource;try{this.statusChanged.emit("restarting"),await this.start(this.restartToken.token)}finally{this.restartToken.dispose()}}async start(e){let t=[],r=Wg(e);t.push(r);let i;try{let o=this.kernelProcess;this.kernelProcess=void 0,o?.dispose(),ci(()=>this.socket?.dispose()),ci(()=>this.realKernel?.dispose());let s=this.kernelProcess=await ut.wrapAndReportProgress(this.resource,y.connectingToKernel(lt(this.kernelConnectionMetadata)),()=>this.kernelLauncher.launch(this.kernelConnectionMetadata,this.launchTimeout,this.resource,this.workingDirectory.fsPath,e));if(e.isCancellationRequested)throw new Ep.CancellationError;this.hookupKernelProcessExitHandler(s);let a=Vme(this.kernelProcess,this.clientId,this.username,this.model);this.kernelProcess=a.kernelProcess,this.realKernel=a.realKernel,this.socket=a.socket,a.realKernel.info.then(c=>this.infoDeferred.resolve(c),c=>this.infoDeferred.reject(c)),Ut(this.kernelProcess.exited)(c=>{i=new ec(c.exitCode||-1,c.stderr,this.kernelConnectionMetadata),r.cancel()},this,t);let l=setTimeout(()=>r.cancel(),this.launchTimeout);if(t.push({dispose:()=>clearTimeout(l)}),await ut.wrapAndReportProgress(this.resource,y.waitingForJupyterSessionToBeIdle,()=>{let c=kn(this.resource)?.kernelReady();return Wme(r.token,this.launchTimeout,this.resource,this.kernelConnectionMetadata,a.realKernel).finally(()=>c?.stop())}),i)throw i;if(e.isCancellationRequested)throw new Ep.CancellationError;this.startHandleKernelMessages(),this.isRestarting=!1,this.statusChanged.emit(this.status)}catch(o){throw await Promise.all([this.kernelProcess?Ts(this.kernelProcess):Promise.resolve(),this.realKernel?.shutdown().catch(s=>p.warn(`Failed to shutdown kernel, ${this.kernelConnectionMetadata.id}`,s))]),i||(Zt(o)&&r.token.isCancellationRequested&&!e.isCancellationRequested?new af(this.kernelConnectionMetadata):(Zt(o)||e.isCancellationRequested?p.debug("Starting of raw session cancelled by user"):p.error(`Failed to connect raw kernel session: ${o}`),o))}finally{G(t)}}hookupKernelProcessExitHandler(e){let t=this.exitHandler;this.exitHandler=void 0,t?.dispose(),this.exitHandler=e.exited(r=>{e!==this.kernelProcess||this.isDisposing||!this.kernelProcess||this.status==="dead"||this.status==="terminating"||(p.error(`Disposing session as kernel process died ExitCode: ${r.exitCode}, Reason: ${r.reason}`),Ct(this.resource,"DS_INTERNAL.RAWKERNEL_SESSION_KERNEL_PROCESS_EXITED",r.exitCode?{exitCode:r.exitCode}:void 0,{exitReason:og(r.reason)}),this.shutdown().catch(h))},this)}dispose(){this.isDisposed||this.isDisposing||(this.isDisposing=!0,this.shutdown().finally(()=>{this._isDisposed=!0,this.disposed.emit(),ku.Signal.disconnectAll(this)}).catch(h))}async shutdown(){this.isShuttingDown||this.hasShutdown||(this.isShuttingDown=!0,this.restartToken?.cancel(),this.restartToken?.dispose(),jy(this.realKernel),await(this.kernelProcess?Ts(this.kernelProcess).catch(h):Promise.resolve()),this.socket.dispose(),this.stopHandlingKernelMessages(),this.isShuttingDown=!1,this.hasShutdown=!0,this.isDisposing&&(this._isDisposed=!0),this.statusChanged.emit(this.status),this.connectionStatusChanged.emit("disconnected"))}createComm(e,t){return this.realKernel.createComm(e,t)}hasComm(e){return this.realKernel.hasComm(e)}removeInputGuard(){this.realKernel.removeInputGuard()}clone(e){return this}get spec(){if(_g(this.kernelConnectionMetadata)){let e=JSON.parse(JSON.stringify(this.kernelConnectionMetadata.kernelSpec)),t="resources"in e?e.resources:{};return{...e,resources:t}}return p.error("Fetching kernel spec from raw kernel using JLab API"),this.realKernel.spec}sendShellMessage(e,t,r){return this.realKernel.sendShellMessage(e,t,r)}sendControlMessage(e,t,r){return this.realKernel.sendControlMessage(e,t,r)}reconnect(){throw new Error("Reconnect is not supported for Local Kernels as connections cannot be lost.")}async interrupt(){if(this.kernelProcess?.canInterrupt)return this.kernelProcess?.interrupt();if(this.kernelConnectionMetadata.kernelSpec.interrupt_mode==="message"){p.info("Interrupting kernel with a shell message");let t=require("@jupyterlab/services").KernelMessage.createMessage({msgType:"interrupt_request",channel:"shell",username:this.realKernel.username,session:this.realKernel.clientId,content:{}});await this.realKernel.sendShellMessage(t,!0,!0).done.catch(r=>p.error("Failed to interrupt via a message",r))}else p.error("Kernel interrupt not supported")}requestKernelInfo(){return this.realKernel.requestKernelInfo()}requestComplete(e){return this.realKernel.requestComplete(e)}requestInspect(e){return this.realKernel.requestInspect(e)}requestHistory(e){return this.realKernel.requestHistory(e)}requestExecute(e,t,r){return this.realKernel.requestExecute(e,t,r)}requestDebug(e,t){return this.realKernel.requestDebug(e,t)}requestIsComplete(e){return this.realKernel.requestIsComplete(e)}requestCommInfo(e){return this.realKernel.requestCommInfo(e)}sendInputReply(e,t){return this.realKernel.sendInputReply(e,t)}registerCommTarget(e,t){return this.realKernel.registerCommTarget(e,t)}removeCommTarget(e,t){return this.realKernel.removeCommTarget(e,t)}registerMessageHook(e,t){this.realKernel.registerMessageHook(e,t)}removeMessageHook(e,t){this.realKernel.removeMessageHook(e,t)}startHandleKernelMessages(){this.realKernel.anyMessage.connect(this.onAnyMessage,this),this.realKernel.iopubMessage.connect(this.onIOPubMessage,this),this.realKernel.unhandledMessage.connect(this.onUnhandledMessage,this),this.realKernel.statusChanged.connect(this.onStatusChanged,this),this.realKernel.pendingInput.connect(this.onPendingInput,this),this.realKernel.disposed.connect(this.onDisposed,this)}stopHandlingKernelMessages(){this.realKernel.anyMessage.disconnect(this.onAnyMessage,this),this.realKernel.iopubMessage.disconnect(this.onIOPubMessage,this),this.realKernel.unhandledMessage.disconnect(this.onUnhandledMessage,this),this.realKernel.pendingInput.disconnect(this.onPendingInput,this),this.realKernel.statusChanged.disconnect(this.onStatusChanged,this),this.realKernel.disposed.disconnect(this.onDisposed,this)}onAnyMessage(e,t){this.anyMessage.emit(t)}onIOPubMessage(e,t){this.iopubMessage.emit(t)}onPendingInput(e,t){this.pendingInput.emit(t)}onUnhandledMessage(e,t){this.unhandledMessage.emit(t)}onStatusChanged(e,t){this.statusChanged.emit(t)}onDisposed(e){this.disposed.emit()}};async function Wme(n,e,t,r,i){try{p.debug("Waiting for Raw Session to be ready in postStartRawSession"),await Nt(n,jme(i,r,e)),p.debug("Successfully waited for Raw Session to be ready in postStartRawSession")}catch(u){throw p.error("Failed waiting for Raw Session to be ready",u),Zt(u)||n.isCancellationRequested?new Ep.CancellationError:u}p.debug(`Kernel status is '${i?.status}' before requesting kernel info and after ready`);let o=ne(),s=ne(),a=()=>o.resolve(!0);o.promise.catch(h),s.promise.catch(h),i.iopubMessage.connect(a);let l=()=>{let d=require("@jupyterlab/services").KernelMessage.createMessage({msgType:"kernel_info_request",channel:"control",username:i.username,session:i.clientId,content:{}});i.sendControlMessage(d,!0,!0).done.then(()=>s.resolve(!0)).catch(h)},c=()=>{i.requestKernelInfo().then(()=>s.resolve(!0)).catch(h)};try{let u=new Me,d=0;for(;u.elapsedTime<e*1e3;){d+=1;try{p.debug("Sending request for kernelInfo"),l(),c(),await Nt(n,Promise.all([o.promise,s.promise]),Hn(Math.min(e,500)).then(h))}catch(f){throw p.error("Failed to request kernel info",f),f}if(o.completed&&s.completed){p.trace("Got response for requestKernelInfo");break}else{p.trace("Did not get a response for requestKernelInfo");continue}}o.completed&&s.completed?p.debug(`Successfully completed postStartRawSession after ${d} attempt(s) in ${u.elapsedTime}ms`):p.warn(`Didn't get response for requestKernelInfo after ${d} attempt(s) in ${u.elapsedTime}ms.`),Ct(t,"DS_INTERNAL.RAWKERNEL_INFO_RESPONSE",{duration:u.elapsedTime,attempts:d},{timedout:!o.completed||!s.completed})}finally{i.iopubMessage.disconnect(a)}}function Vme(n,e,t,r){let i=require("@jupyterlab/services"),o=require("@jupyterlab/services/lib/kernel/serialize"),s;class a extends $T{constructor(){super(n.connection,o.serialize),s=this}}let l=i.ServerConnection.makeSettings({WebSocket:a,wsUrl:"RAW",serializer:{deserialize:u=>u,serialize:u=>u}});KF||(KF=require("@jupyterlab/services/lib/kernel/default"));let c=new KF.KernelConnection({serverSettings:l,clientId:e,handleComms:!0,username:t,model:r});return Ep.workspace.getConfiguration("jupyter").get("enablePythonKernelLogging",!1)&&c.anyMessage.connect((u,d)=>{p.trace(`[AnyMessage Event] [${d.direction}] [${n.pid}] ${JSON.stringify(d.msg)}`)}),bi.set(c.id,s),s.emit("open"),{realKernel:c,socket:s,kernelProcess:n}}async function jme(n,e,t){p.debug(`Waiting for Raw session to be ready, status: ${n.connectionStatus}`);let r=ne(),i=(s,a)=>{a=="connected"?(p.trace("Raw session connected"),r.resolve(a)):p.trace(`Raw session not connected, status: ${a}`)};n.connectionStatusChanged.connect(i),n.connectionStatus==="connected"&&(p.trace("Raw session connected"),r.resolve(n.connectionStatus));let o=await Bt(t,r.promise);if(n.connectionStatusChanged.disconnect(i),p.debug(`Waited for Raw session to be ready & got status: ${o}`),o!=="connected")throw new af(e)}var HT=class{constructor(e,t,r,i,o,s){this.resource=e;this.kernelConnectionMetadata=i;this.type=s;this.isDisposed=!1;this.statusChanged=new zs.Signal(this);this.kernelChanged=new zs.Signal(this);this.terminated=new zs.Signal(this);this.iopubMessage=new zs.Signal(this);this.unhandledMessage=new zs.Signal(this);this.anyMessage=new zs.Signal(this);this.disposed=new zs.Signal(this);this.connectionStatusChanged=new zs.Signal(this);this.pendingInput=new zs.Signal(this);this.propertyChanged=new zs.Signal(this);this._didShutDownOnce=!1;this.id=lr(),this.name=_d(this.kernelConnectionMetadata)||"python3",this.path=this.resource?.fsPath||this.kernelConnectionMetadata.interpreter?.uri.fsPath||"kernel_path",this._kernel=new qT(e,t,r,o,i),this._kernel.statusChanged.connect(this.onKernelStatus,this),this._kernel.iopubMessage.connect(this.onIOPubMessage,this),this._kernel.connectionStatusChanged.connect(this.onKernelConnectionStatus,this),this._kernel.unhandledMessage.connect(this.onUnhandledMessage,this),this._kernel.anyMessage.connect(this.onAnyMessage,this),this._kernel.disposed.connect(this.onDisposed,this),this._kernel.disposed.connect(this.onDisposed,this)}get connectionStatus(){return this._kernel?.connectionStatus||"disconnected"}get serverSettings(){return require("@jupyterlab/services").ServerConnection.makeSettings({wsUrl:"RAW"})}get model(){return{id:this.id,name:this.name,path:this.path,type:"notebook",kernel:{id:this._kernel?.id,name:this.name}}}get status(){return this.isDisposed?"dead":this.isTerminating?"terminating":this.kernel?.status??"unknown"}get kernel(){return this._kernel}async startKernel(e){await ro(this.resource,{kernelConnection:this.kernelConnectionMetadata}),await this._kernel.start(e.token)}dispose(){this._isDisposing=!0;let e=new Error().stack;Ct(this.resource,"DS_INTERNAL.RAWKERNEL_SESSION_DISPOSED",void 0,{stacktrace:e});try{this._kernel.statusChanged.disconnect(this.onKernelStatus,this),this._kernel.iopubMessage.disconnect(this.onIOPubMessage,this),this._kernel.connectionStatusChanged.disconnect(this.onKernelConnectionStatus,this),this._kernel.unhandledMessage.disconnect(this.onUnhandledMessage,this),this._kernel.anyMessage.disconnect(this.onAnyMessage,this),this._kernel.disposed.disconnect(this.onDisposed,this)}catch{}this.shutdown().catch(h).finally(()=>{this._kernel.dispose(),this.isDisposed=!0,this.disposed.emit(),zs.Signal.disconnectAll(this)})}async shutdown(){this._didShutDownOnce||(this._didShutDownOnce=!0,this.isTerminating=!0,this.statusChanged.emit("terminating"),await this._kernel.shutdown().catch(e=>p.warn(`Failed to shutdown kernel, ${this.kernelConnectionMetadata.id}`,e)),this.isTerminating=!1,this._isDisposing&&(this.isDisposed=!0),this.terminated.emit(),this.statusChanged.emit(this.status))}onKernelStatus(e,t){p.ci(`RawSession status changed to ${t}`),this.statusChanged.emit(t)}setPath(e){throw new Error("Not yet implemented")}setName(e){throw new Error("Not yet implemented")}setType(e){throw new Error("Not yet implemented")}changeKernel(e){throw new Error("Not yet implemented")}onIOPubMessage(e,t){this.iopubMessage.emit(t)}onAnyMessage(e,t){this.anyMessage.emit(t)}onUnhandledMessage(e,t){this.unhandledMessage.emit(t)}onKernelConnectionStatus(e,t){this.connectionStatusChanged.emit(t)}onDisposed(e){this.disposed.emit()}};var vb=class{constructor(e,t,r){this.configService=e;this.kernelLauncher=t;this.workingDirectoryComputer=r}async create(e){p.trace(`Creating raw notebook for resource '${M(e.resource)}'`);let t,r=kn(e.resource)?.computeCwd(),[i]=await Promise.all([this.workingDirectoryComputer.computeWorkingDirectory(e.kernelConnection,e.resource,e.token),Nt(e.token,ro(e.resource,{kernelConnection:e.kernelConnection}))]);r?.stop();let o=this.configService.getSettings(e.resource).jupyterLaunchTimeout;t=new HT(e.resource,this.kernelLauncher,i,e.kernelConnection,o,(e.resource?.path||"").toLowerCase().endsWith(".ipynb")?"notebook":"console");try{await Nt(e.token,t.startKernel(e))}catch(s){throw Zt(s)||e.token.isCancellationRequested?p.debug("Starting of raw session cancelled by user"):p.error(`Failed to connect raw kernel session: ${s}`),t?.shutdown().catch(a=>p.error(`Failed to dispose of raw session on launch error: ${a} `)).finally(()=>t?.dispose()).catch(h),s}return new WT(t,e.resource,e.kernelConnection)}};vb=v([(0,yb.injectable)(),m(0,(0,yb.inject)(oe)),m(1,(0,yb.inject)(g_)),m(2,(0,yb.inject)(Mm))],vb);var GT=k(N());var bb=class{constructor(e){this.configuration=e}get isSupported(){return this.isSupportedForLocalLaunch()}isSupportedForLocalLaunch(){return!this.isZQMDisabled()&&this.zmqSupported()}isZQMDisabled(){return this.configuration.getSettings().disableZMQSupport}zmqSupported(){if(typeof this._isSupported=="boolean")return this._isSupported;if((process.env.VSC_JUPYTER_NON_RAW_NATIVE_TEST||"").toLowerCase()==="true")return!1;try{BT(),this._isSupported=!0}catch{this._isSupported=!1}return this._isSupported}};bb=v([(0,GT.injectable)(),m(0,(0,GT.inject)(oe))],bb);var xu=k(N()),hz=require("vscode");var In=Symbol("IJupyterVariables"),zT=Symbol("IKernelVariableRequester"),QT=Symbol("IJupyterVariablesProvider");var xf=class{constructor(e,t,r){this.kernelVariables=t;this.debuggerVariables=r;this.refreshEventEmitter=new hz.EventEmitter;e.push(r.refreshRequired(this.fireRefresh.bind(this))),e.push(t.refreshRequired(this.fireRefresh.bind(this)))}get refreshRequired(){return this.refreshEventEmitter.event}getAllVariableDiscriptions(e,t,r,i){return this.variableHandler.getAllVariableDiscriptions(e,t,r,i)}async getVariables(e,t){return this.variableHandler.getVariables(e,t)}async getFullVariable(e,t){return this.variableHandler.getFullVariable(e,t)}async getMatchingVariable(e,t,r){return this.variableHandler.getMatchingVariable(e,t,r)}async getDataFrameInfo(e,t,r,i){return this.variableHandler.getDataFrameInfo(e,t,r,i)}async getVariableValueSummary(e,t,r){return this.variableHandler.getVariableValueSummary(e,t,r)}async getDataFrameRows(e,t,r,i,o){return this.variableHandler.getDataFrameRows(e,t,r,i,o)}get variableHandler(){return this.debuggerVariables.active?this.debuggerVariables:this.kernelVariables}fireRefresh(){this.refreshEventEmitter.fire()}};v([fr("DS_INTERNAL.VARIABLE_EXPLORER_FETCH_TIME")],xf.prototype,"getVariables",1),xf=v([(0,xu.injectable)(),m(0,(0,xu.inject)(K)),m(1,(0,xu.inject)(In)),m(1,(0,xu.named)(Le.KERNEL_VARIABLES)),m(2,(0,xu.inject)(In)),m(2,(0,xu.named)(Le.DEBUGGER_VARIABLES))],xf);var Df=k(N());var vz=require("vscode");var gz=1e3*60*60*24*2,Wa=class extends Qt{constructor(t,r,i,o){super();this.serverStorage=r;this.context=i;this.fs=o;this.executedCells=new WeakMap;this.chainedPromises=Promise.resolve();i.globalStorageUri,t.push(this),this.storageFile=vz.Uri.joinPath(this.context.globalStorageUri,"lastExecutedRemoteCell.json")}activate(){this._register(this.serverStorage.onDidRemove(this.onDidRemoveServers,this))}async getLastTrackedCellExecution(t,r){if(t.isUntitled||!Dt(r.kernelConnectionMetadata)||!r.session?.id)return;if(this.staleState&&this.staleState[t.uri.toString()])return this.staleState[t.uri.toString()];let i=await this.getStorageFile(),o={};try{let s=await this.fs.readFile(i);o=JSON.parse(s.toString()),this.staleState=o}catch{return}return o[t.uri.toString()]}trackCellExecution(t,r){if(!Dt(r.kernelConnectionMetadata)||t.document.isUntitled)return;this.executedCells.delete(t);let i=[],o=(a,l)=>{if(l.direction==="send"){let c=l.msg;if(c.header.msg_type==="execute_request"&&c.metadata&&typeof c.metadata=="object"&&c.metadata&&"cellId"in c.metadata&&typeof c.metadata.cellId=="string"&&c.metadata.cellId===t.document.uri.toString()){let u=c.header.msg_id;this.executedCells.set(t,{msg_id:u,kernelId:r.session?.kernel?.id||"",cellIndex:t.index})}}else if(l.direction==="recv"){let c=l.msg,u=this.executedCells.get(t);if(u?.msg_id&&bu(c)===u.msg_id){if(!u.startTime){u.startTime=new Date().getTime();try{u.startTime=new Date(c.header.date).getTime()}catch{}this.executedCells.set(t,u)}"execution_count"in c.content&&typeof c.content.execution_count=="number"&&!u.executionCount&&u.executionCount!==c.content.execution_count&&(u.executionCount=c.content.execution_count,this.executedCells.set(t,u),this.trackLastExecution(t,r,u),G(i))}}},s=()=>{let a=r.session;a&&(a.anyMessage.connect(o),i.push({dispose:()=>ci(()=>a.anyMessage?.disconnect(o))}))};r.onStarted(()=>s(),i),r.session&&s()}deleteTrackedCellExecution(t,r){t.notebook.isUntitled||!Dt(r.kernelConnectionMetadata)||!r.session?.id||(this.chainedPromises=this.chainedPromises.finally(async()=>{let i={};try{let s=await this.getStorageFile().then(()=>this.fs.readFile(this.storageFile));i=JSON.parse(s.toString())}catch{return}let o=t.notebook.uri.toString();i[o].cellIndex===t.index&&(delete i[o],this.staleState=i,await this.fs.writeFile(this.storageFile,JSON.stringify(i)))}))}getStorageFile(){return this.ensureStorageExistsPromise=this.ensureStorageExistsPromise||(async()=>(await this.fs.createDirectory(this.context.globalStorageUri),this.storageFile))(),this.ensureStorageExistsPromise}trackLastExecution(t,r,i){if(!i.executionCount||!i.msg_id||!i.startTime||!Dt(r.kernelConnectionMetadata)||!r.session?.id)return;let o={cellIndex:t.index,executionCount:i.executionCount,kernelId:r.session?.kernel?.id||"",msg_id:i.msg_id,serverId:Lt(r.kernelConnectionMetadata.serverProviderHandle),sessionId:r.session?.id,startTime:i.startTime};this.chainedPromises=this.chainedPromises.finally(async()=>{let s={};try{let l=await this.getStorageFile().then(()=>this.fs.readFile(this.storageFile));s=JSON.parse(l.toString())}catch{}let a=t.notebook.uri.toString();s[a]=o,this.removeOldItems(s),this.staleState=s,await this.fs.writeFile(this.storageFile,JSON.stringify(s))})}onDidRemoveServers(t){t.length!==0&&(this.chainedPromises=this.chainedPromises.finally(async()=>{await this.getStorageFile();let r={};try{let s=await this.fs.readFile(this.storageFile);r=JSON.parse(s.toString())}catch{}let i=!1,o=new Set(t.map(s=>Lt(s)));Object.keys(r).forEach(s=>{let a=r[s];(o.has(a.serverId)||Date.now()-a.startTime>gz)&&(delete r[s],i=!0)}),i&&(this.removeOldItems(r),this.staleState=r,await this.fs.writeFile(this.storageFile,JSON.stringify(r)))}))}removeOldItems(t){Object.keys(t).forEach(r=>{let i=t[r];i&&Date.now()-i.startTime>gz&&delete t[r]})}};Wa=v([(0,Df.injectable)(),m(0,(0,Df.inject)(K)),m(1,(0,Df.inject)(Xt)),m(2,(0,Df.inject)(tt)),m(3,(0,Df.inject)(nt))],Wa);var Sb=k(N());var fw=require("vscode");var Ib=class{constructor(e,t,r){this.serverUriStorage=e;this.registrations=t;this.disposables=r}activate(){this.disposables.push(fw.commands.registerCommand(J.ClearSavedJupyterUris,async()=>{await this.serverUriStorage.clear().catch(h),await Promise.all(this.registrations.jupyterCollections.filter(e=>e.id.startsWith("_builtin")||e.extensionId===_e).map(async e=>{if(!e.serverProvider||!e.serverProvider.removeJupyterServer)return;let t=new fw.CancellationTokenSource,r=await Promise.resolve(e.serverProvider.provideJupyterServers(t.token));await Promise.all((r||[]).map(i=>e.serverProvider.removeJupyterServer(i).catch(h)))})).catch(h),await fw.commands.executeCommand("dataScience.ClearUserProviderJupyterServerCache").then(h,h)},this))}};Ib=v([(0,Sb.injectable)(),m(0,(0,Sb.inject)(Xt)),m(1,(0,Sb.inject)(Jt)),m(2,(0,Sb.inject)(K))],Ib);var YT=k(N());var Cb=class{constructor(e){this.registry=e;this.priority=0}activate(){this.registry.register(this,It),this.registry.register(this,nr)}async getCode(e){return Xe(e.kernelConnectionMetadata)?[Y$]:[]}};Cb=v([(0,YT.injectable)(),m(0,(0,YT.inject)(Bc))],Cb);var Va=require("vscode");var hw=k(N());var Eb=class{constructor(e,t){this.configService=e;this.fs=t}async computeWorkingDirectory(e,t,r){if(!at(e))throw new Error("Only local connections are supported");let[i,o]=await Promise.all([Nt(r,LE(t).then(s=>Va.Uri.file(s))),Nt(r,$me(t,this.configService,this.fs).then(s=>s?Va.Uri.file(s):void 0))]);return o||i}};Eb=v([(0,hw.injectable)(),m(0,(0,hw.inject)(oe)),m(1,(0,hw.inject)(nt))],Eb);async function $me(n,e,t){let r=await Jme(n,e,t);if(r&&await t.exists(Va.Uri.file(r)))return r;if(n&&n.scheme!=="untitled"&&await t.exists(n)){let i=r&&r.includes("${")?r:r?Ae(Va.Uri.file(r)):void 0,o=nx(i,n,e.getSettings(n));if(await t.exists(Va.Uri.file(o)))return o}}async function Jme(n,e,t){let r,i=e.getSettings(n),o=q7(i.notebookFileRoot);if(o&&Va.workspace.workspaceFolders?.length){let s=Va.Uri.file(o),a=Va.workspace.workspaceFolders[0].uri;if(FP(o))await t.exists(s)?r=s.fsPath:r=a.fsPath;else if(o.includes("${"))r=o;else{let l=Va.Uri.joinPath(a,o);await t.exists(l)?r=l.fsPath:r=a.fsPath}}return r}function yz(n,e){n.addSingleton(me,py),n.addSingleton(me,hy),n.addSingleton(_n,bb),n.addSingleton(rs,rs),n.addSingleton(v_,vb),n.addSingleton(g_,Gs),n.addSingleton(Na,Na),n.addSingleton(Ar,Gy),n.addSingleton(me,wf),n.addSingleton(me,my),n.addSingleton(zr,zr),n.addSingleton(Sp,ac),n.addSingleton(as,as),n.addBinding(as,me),n.addSingleton(Cu,Cu),n.addSingleton(aw,ib),n.addBinding(aw,me),n.addSingleton(In,xf,Le.ALL_VARIABLES),n.addSingleton(go,yp),n.addSingleton(me,Sf),n.addSingleton(me,tb),n.addSingleton(me,qy),n.addSingleton(me,Hy),n.addSingleton(me,nb),n.addSingleton(ye,Zy),n.addSingleton(Nm,eb),n.addSingleton(me,Ib),n.addSingleton(Wa,Wa),n.addBinding(Wa,me),A4(n,e),ag("isInsiderExtension",kh()?"true":"false");let t=n.get(qe);ag("isPythonExtensionInstalled",t.isPythonExtensionInstalled?"true":"false");let r=n.get(_n);ag("rawKernelSupported",r.isSupported?"true":"false"),n.addSingleton(me,Zr),n.addSingleton(Bc,rb),n.addSingleton(wu,wu),n.addSingleton(Mm,Eb),n.addSingleton(me,Cb)}var wp=k(N()),_f=require("vscode");var wb=class{constructor(e,t,r,i,o){this.disposables=e;this.extensionChecker=t;this.progressReporter=r;this.pythonApi=i;this.errorHandler=o}activate(){this.disposables.push(_f.commands.registerCommand(J.InstallPythonExtensionViaKernelPicker,this.installPythonExtensionViaKernelPicker,this)),this.disposables.push(_f.commands.registerCommand(J.InstallPythonViaKernelPicker,this.installPythonViaKernelPicker,this))}async installPythonViaKernelPicker(){T("DS_INTERNAL.PYTHON_NOT_INSTALLED",void 0,{action:"displayed"});let e=this.installedOnceBefore?[ce.downloadAndInstall,ce.reload]:[ce.downloadAndInstall],t=await _f.window.showErrorMessage(y.pythonNotInstalled,{modal:!0},...e);t===ce.downloadAndInstall?(this.installedOnceBefore=!0,T("DS_INTERNAL.PYTHON_NOT_INSTALLED",void 0,{action:"download"}),await _f.commands.executeCommand("python.installPython")):t===ce.reload?(T("DS_INTERNAL.PYTHON_NOT_INSTALLED",void 0,{action:"reload"}),await _f.commands.executeCommand("jupyter.reloadVSCode",y.reloadRequired)):T("DS_INTERNAL.PYTHON_NOT_INSTALLED",void 0,{action:"dismissed"})}async installPythonExtensionViaKernelPicker(){if(!this.extensionChecker.isPythonExtensionInstalled){T("DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",void 0,{action:"displayed"});let e=this.progressReporter.createProgressIndicator(y.installingPythonExtension);try{await this.extensionChecker.directlyInstallPythonExtension();let t="hooked",r=await Bt(6e4,"timeout",this.pythonApi.pythonExtensionHooked.then(()=>t));if(this.extensionChecker.isPythonExtensionInstalled&&r===t)return p.debug("Python Extension installed via Kernel Picker command"),T("DS_INTERNAL.PYTHON_EXTENSION_INSTALLED_VIA_KERNEL_PICKER",void 0,{action:"success"}),!0;p.error("Failed to install Python Extension via Kernel Picker command"),T("DS_INTERNAL.PYTHON_EXTENSION_INSTALLED_VIA_KERNEL_PICKER",void 0,{action:"failed"}),this.errorHandler.handleError(new Error(y.failedToInstallPythonExtension)).then(h,h)}finally{e.dispose()}}}};wb=v([(0,wp.injectable)(),m(0,(0,wp.inject)(K)),m(1,(0,wp.inject)(qe)),m(2,(0,wp.inject)(es)),m(3,(0,wp.inject)(tr)),m(4,(0,wp.inject)(Gr))],wb);var Pb=k(N()),Rf=require("vscode");var Tf=class{constructor(e,t,r){this.disposables=e;this.controllerRegistration=t;this.preferredRemoteKernelIdProvider=r}activate(){Rf.workspace.onDidOpenNotebookDocument(this.onDidOpenNotebook,this,this.disposables),Rf.workspace.notebookDocuments.forEach(e=>this.onDidOpenNotebook(e))}async onDidOpenNotebook(e){if(!St(e))return;let t=await this.preferredRemoteKernelIdProvider.getPreferredRemoteKernelId(e);if(!t)return;let r=()=>{let o=this.controllerRegistration.getSelected(e),s=this.controllerRegistration.registered.find(a=>a.id===t);return s&&o?.id!==s.id?(this.switchKernel(e,s.connection).catch(h),!0):!1};if(r())return;let i=this.controllerRegistration.onDidChange(o=>{o.added.length&&r()&&i.dispose()},this,this.disposables);this.controllerRegistration.onControllerSelected(o=>{o.notebook===e&&i.dispose()},this,this.disposables)}async switchKernel(e,t){p.debug(`Using notebook.selectKernel to force remote kernel for ${M(e.uri)} to ${t.id}`),await Rf.commands.executeCommand("notebook.selectKernel",{id:t.id,extension:_e}),await kP(async()=>{if(Rf.window.activeNotebookEditor?.notebook===e){let i=this.controllerRegistration.getSelected(e);if(i?.connection.id===t.id)return i.restoreConnection(e).catch(h),!0}return!1},2e3,100)?p.debug(`Successfully switched remote kernel for ${M(e.uri)} to ${t.id}`):p.warn(`Failed to switch remote kernel for ${M(e.uri)} to ${t.id}`)}};v([Yr()],Tf.prototype,"onDidOpenNotebook",1),Tf=v([(0,Pb.injectable)(),m(0,(0,Pb.inject)(K)),m(1,(0,Pb.inject)(He)),m(2,(0,Pb.inject)(rs))],Tf);var xb=k(N()),kp=require("vscode");var Ao=require("vscode");function cc(n){if(typeof n!="string")throw new TypeError(`Expected a \`string\`, got \`${typeof n}\``);var e=Iz();let t=e;return t.default&&(t=t.default),n.replace(t(),"")}var vw=k(N()),FF=require("vscode");var OF=require("vscode");function Sz(n){if(!n||!Array.isArray(n)||n.length===0)return;let e=[];for(let t=0;t<n.length;t+=1){let r=n[t];if("buffer"in r&&"byteOffset"in r){let i=Array.apply(null,new Uint8Array(r.buffer));e.push({...r,byteLength:r.byteLength,byteOffset:r.byteOffset,buffer:i})}else e.push([...new Uint8Array(r)])}return e}function Cz(n){if(!Array.isArray(n)||n.length===0)return n;let e=[];for(let t=0;t<n.length;t+=1){let r=n[t];if("buffer"in r&&"byteOffset"in r){let i=new Uint8Array(r.buffer).buffer,o=new DataView(i,r.byteOffset,r.byteLength);e.push(o)}else{let i=new Uint8Array(r).buffer;e.push(i)}}return e}var gw=new WeakMap;function Ez(n,e){let t=gw.get(n);t&&(t.targets.add(e),t.registerCommTarget(e))}function wz(n,e){gw.get(n)?.targets?.delete?.(e)}var XT=class{constructor(e,t){this.kernelProvider=e;this.document=t;this.commTargetsRegistered=new Set;this.pendingTargetNames=new Set;this._postMessageEmitter=new OF.EventEmitter;this._onDisplayMessage=new OF.EventEmitter;this.onDisplayMessage=this._onDisplayMessage.event;this.messageHooks=new Map;this.pendingHookRemovals=new Map;this.messageHookRequests=new Map;this.disposables=[];this.disposed=!1;this.pendingMessages=[];this.subscribedToKernelSocket=!1;this.waitingMessageIds=new Map;this.outputWidgetIds=new Set;this.isUsingIPyWidgets=!1;this.kernelSocketHandlers=new WeakMap;this.pendingTargetNames.add("jupyter.widget"),e.onDidStartKernel(i=>{i.notebook===t&&this.initialize()},this,this.disposables),this.mirrorSend=this.mirrorSend.bind(this),this.onKernelSocketMessage=this.onKernelSocketMessage.bind(this);let r=require("@jupyterlab/services/lib/kernel/serialize");this.deserialize=r.deserialize}get postMessage(){return this._postMessageEmitter.event}dispose(){for(this.disposed=!0;this.disposables.length;)this.disposables.shift()?.dispose()}receiveMessage(e){switch(e.message){case"IPyWidgets_logMessage":{let t=e.payload;t.category==="error"?p.error(`Widget Error: ${t.message}`):p.trace(`Widget Message: ${t.message}`);break}case"IPyWidgets_Ready":this.sendKernelOptions(),this.initialize();break;case"IPyWidgets_msg":this.sendRawPayloadToKernelSocket(e.payload);break;case"IPyWidgets_binary_msg":this.sendRawPayloadToKernelSocket(Cz(e.payload)[0]);break;case"IPyWidgets_msg_received":this.onKernelSocketResponse(e.payload);break;case"IPyWidgets_registerCommTarget":this.registerCommTarget(e.payload);break;case"IPyWidgets_RegisterMessageHook":this.registerMessageHook(e.payload);break;case"IPyWidgets_RemoveMessageHook":this.possiblyRemoveMessageHook(e.payload);break;case"IPyWidgets_MessageHookResult":this.handleMessageHookResponse(e.payload);break;case"IPyWidgets_iopub_msg_handled":this.iopubMessageHandled(e.payload);break;default:break}}sendRawPayloadToKernelSocket(e){this.pendingMessages.push(e),this.sendPendingMessages()}registerCommTarget(e){this.pendingTargetNames.add(e),this.initialize()}initialize(){this.jupyterLab||(this.jupyterLab=require("@jupyterlab/services"));let e=this.getKernel();e&&(this.subscribeToKernelSocket(e),this.registerCommTargets(e))}raisePostMessage(e,t){this._postMessageEmitter.fire({message:e,payload:t})}subscribeToKernelSocket(e){if(this.subscribedToKernelSocket||!e.session)return;this.subscribedToKernelSocket=!0,this.subscribeToKernelSocketImpl(e);let t=e.session.kernel?.id;e.session.onDidKernelSocketChange(()=>{this.subscribeToKernelSocketImpl(e,t),t=e.session?.kernel?.id||""})}subscribeToKernelSocketImpl(e,t){let r=t?bi.get(t):void 0,i=r?this.kernelSocketHandlers.get(r):void 0;if(i?.receiveHook&&r?.removeReceiveHook(i.receiveHook),i?.sendHook&&r?.removeSendHook(i.sendHook),this.kernelWasConnectedAtLeastOnce){for(;this.pendingMessages.length;)this.pendingMessages.shift();this.waitingMessageIds.forEach(l=>l.resultPromise.resolve()),this.waitingMessageIds.clear(),this.messageHookRequests.forEach(l=>l.resolve(!1)),this.messageHookRequests.clear(),this.messageHooks.clear(),this.sendRestartKernel()}if(!e.session?.kernel?.id||!bi.get(e.session?.kernel?.id))return;gw.has(e.session.kernel)||gw.set(e.session.kernel,{targets:new Set,registerCommTarget:l=>{this.raisePostMessage("IPyWidgets_registerCommTarget",l)}}),this.kernelWasConnectedAtLeastOnce=!0;let o=e.session.kernel?.id,s=o?bi.get(o):void 0,a=s?.protocol||"";if(s){let l=this.onKernelSocketMessage.bind(this,a),c=this.mirrorSend.bind(this,a);s.addReceiveHook(l),s.addSendHook(c),this.kernelSocketHandlers.set(s,{receiveHook:l,sendHook:c})}this.sendKernelOptions(a),this.registerCommTargets(e),this.sendPendingMessages(a)}sendKernelOptions(e=""){let t=this.kernel?.session?.kernel;t&&(e||(e=bi.get(t.id)?.protocol||""),this.raisePostMessage("IPyWidgets_kernelOptions",{id:t.id,clientId:t.clientId||"",userName:t.username||"",model:t.model||{id:"",name:""},protocol:e}))}async mirrorSend(e,t,r){if(typeof t=="string"&&t.includes("shell")&&t.includes("execute_request")){let i=typeof t=="string"?JSON.parse(t):this.deserialize(t);if(i.channel==="shell"&&i.header.msg_type==="execute_request"){if(!nw(i))return;let o=this.mirrorExecuteRequest(i);this.isUsingIPyWidgets&&await o}}else if(typeof t!="string")try{let i=this.deserialize(t,e);if(i.channel==="shell"&&i.header.msg_type==="execute_request"){if(!nw(i))return;let o=this.mirrorExecuteRequest(i);this.isUsingIPyWidgets&&await o}}catch(i){p.error("Failed to mirror message to kernel",i)}}sendRestartKernel(){this.raisePostMessage("IPyWidgets_onRestartKernel",void 0)}mirrorExecuteRequest(e){let t=ne();return this.waitingMessageIds.set(e.header.msg_id,{startTime:Date.now(),resultPromise:t}),this.raisePostMessage("IPyWidgets_mirror_execute",{id:e.header.msg_id,msg:e}),t.promise}messageNeedsFullHandle(e){return e.channel==="iopub"&&e.header?.msg_type==="comm_msg"&&e.content?.data?.method==="update"&&this.outputWidgetIds.has(e.content?.comm_id)}iopubMessageHandled(e){let t=e.id;this.fullHandleMessage&&this.fullHandleMessage.id===t&&(this.fullHandleMessage.promise.resolve(),this.fullHandleMessage=void 0)}async onKernelSocketMessage(e,t){let r=lr(),i=ne();this.waitingMessageIds.set(r,{startTime:Date.now(),resultPromise:i});let o;if(typeof t=="string"?nw(t)&&(this.raisePostMessage("IPyWidgets_msg",{id:r,data:t}),t.includes("display_data")&&(o=this.deserialize(t,e),require("@jupyterlab/services").KernelMessage.isDisplayDataMsg(o)&&this._onDisplayMessage.fire(o))):this.raisePostMessage("IPyWidgets_binary_msg",{id:r,data:Sz([t])}),typeof t!="string"||t.includes(zi)||t.includes(Le.DefaultCommTarget)||t.includes("comm_open")||t.includes("comm_close")||t.includes("comm_msg")){let a=o||this.deserialize(t,e);if(!nw(a))return;a&&a.content&&a.content.data&&(a.content.data[zi]||a.content.target_name===Le.DefaultCommTarget)&&(this.isUsingIPyWidgets=!0);let l=a.header?.msg_type==="comm_open"&&a.content?.data?.state?._model_module==="@jupyter-widgets/output"&&a.content?.data?.state?._model_name==="OutputModel",c=a.header?.msg_type==="comm_close"&&this.outputWidgetIds.has(a.content?.comm_id);l?this.outputWidgetIds.add(a.content.comm_id):c?this.outputWidgetIds.delete(a.content.comm_id):this.messageNeedsFullHandle(a)&&(this.fullHandleMessage={id:a.header.msg_id,promise:ne()},await i.promise,await this.fullHandleMessage.promise.promise,this.fullHandleMessage=void 0)}}onKernelSocketResponse(e){let t=this.waitingMessageIds.get(e.id);t&&(this.waitingMessageIds.delete(e.id),t.resultPromise.resolve())}sendPendingMessages(e=""){if(this.kernel?.session?.kernel)for(e||(e=bi.get(this.kernel.session.kernel.id)?.protocol||"");this.pendingMessages.length;)try{let t=this.pendingMessages[0],r=typeof t=="string"?JSON.parse(t):this.deserialize(t,e);r.buffers?.length&&(r.buffers=r.buffers.map(i=>i instanceof DataView?i.buffer:i)),r.channel==="control"?this.kernel.session.kernel.sendControlMessage(r):this.kernel.session.kernel.sendShellMessage(r),this.pendingMessages.shift()}catch(t){p.error("Failed to send message to Kernel",t);return}}registerCommTargets(e){for(;this.pendingTargetNames.size>0;){let r=Array.from([...this.pendingTargetNames.values()]).shift();if(r){if(this.commTargetsRegistered.has(r))return;p.trace(`Registering commtarget ${r}`),this.commTargetsRegistered.add(r),this.pendingTargetNames.delete(r),e.session?.kernel&&r!==Le.DefaultCommTarget&&!gw.get(e.session.kernel)?.targets?.has(r)&&e.session.kernel.registerCommTarget(r,h)}}}getKernel(){return this.document&&!this.kernel?.session&&(this.kernel=this.kernelProvider.get(this.document),this.kernel?.onDisposed(()=>this.kernel=void 0)),this.kernel&&!this.kernelRestartHandlerAttached&&(this.kernelRestartHandlerAttached=!0,this.disposables.push(this.kernel.onRestarted(this.handleKernelRestarts,this))),this.kernel}async handleKernelRestarts(){this.disposed||this.commTargetsRegistered.size===0||!this.kernel?.session||(Array.from(this.commTargetsRegistered.keys()).forEach(e=>{this.commTargetsRegistered.delete(e),this.pendingTargetNames.add(e)}),this.subscribeToKernelSocket(this.kernel),this.registerCommTargets(this.kernel))}registerMessageHook(e){try{if(this.kernel?.session?.kernel&&!this.messageHooks.has(e)){let t=this.messageHookCallback.bind(this);this.messageHooks.set(e,t),this.kernel.session.kernel.registerMessageHook(e,t)}}finally{this.raisePostMessage("IPyWidgets_ExtensionOperationHandled",{id:e,type:"IPyWidgets_RegisterMessageHook"})}}possiblyRemoveMessageHook(e){try{e.lastHookedMsgId?this.pendingHookRemovals.set(e.lastHookedMsgId,e.hookMsgId):this.removeMessageHook(e.hookMsgId)}finally{this.raisePostMessage("IPyWidgets_ExtensionOperationHandled",{id:e.hookMsgId,type:"IPyWidgets_RemoveMessageHook"})}}removeMessageHook(e){if(this.kernel?.session?.kernel&&this.messageHooks.has(e)){let t=this.messageHooks.get(e);this.messageHooks.delete(e),this.kernel.session.kernel.removeMessageHook(e,t)}}async messageHookCallback(e){let t=ne(),r=lr(),i=e.parent_header.msg_id;if(this.messageHooks.has(i)?(this.messageHookRequests.set(r,t),this.raisePostMessage("IPyWidgets_MessageHookCall",{requestId:r,parentId:i,msg:e})):t.resolve(!0),this.pendingHookRemovals.has(e.header.msg_id)){let o=this.pendingHookRemovals.get(e.header.msg_id);this.pendingHookRemovals.delete(e.header.msg_id),this.removeMessageHook(o)}return t.promise}handleMessageHookResponse(e){let t=this.messageHookRequests.get(e.requestId);t&&(this.messageHookRequests.delete(e.requestId),t.resolve(e.msgType.includes("comm")?!0:e.result))}};var LF=class{constructor(e,t){this.baseMulticaster=e;this.oldMessages=t;this._postMessageEmitter=new FF.EventEmitter;this._onDisplayMessage=new FF.EventEmitter;this.onDisplayMessage=this._onDisplayMessage.event;this.disposables=[];e.postMessage(this.raisePostMessage,this,this.disposables),e.onDisplayMessage(r=>{this._onDisplayMessage.fire(r)},this,this.disposables)}get postMessage(){return this._postMessageEmitter.event}dispose(){for(;this.disposables.length;)this.disposables.shift()?.dispose()}initialize(){return this.baseMulticaster.initialize()}receiveMessage(e){this.baseMulticaster.receiveMessage(e)}raisePostMessage(e){this.oldMessages.forEach(t=>{this._postMessageEmitter.fire(t)}),this.oldMessages=[],this._postMessageEmitter.fire(e)}},ja=class{constructor(e,t){this.kernelProvider=t;this.messageDispatchers=new WeakMap;this.messagesPerNotebook=new WeakMap;this.disposed=!1;this.disposables=[];e.push(this),t.onDidDisposeKernel(this.trackDisposingOfKernels,this,e)}dispose(){for(this.disposed=!0;this.disposables.length;)this.disposables.shift()?.dispose()}create(e){let t=this.messageDispatchers.get(e);t||(t=new XT(this.kernelProvider,e),this.messageDispatchers.set(e,t),this.disposables.push(t.postMessage(o=>this.onMessage(o,e),this)));let r=[];e&&this.messagesPerNotebook.get(e)&&(r=this.messagesPerNotebook.get(e)||[]);let i=new LF(t,r);return this.disposables.push(i),i}trackDisposingOfKernels(e){if(this.disposed)return;let t=e.notebook,r=this.messageDispatchers.get(t);this.messageDispatchers.delete(t),r?.dispose()}onMessage(e,t){t&&(this.messagesPerNotebook.set(t,this.messagesPerNotebook.get(t)||[]),(e.message==="IPyWidgets_kernelOptions"||e.message==="IPyWidgets_registerCommTarget")&&this.messagesPerNotebook.get(t).push(e))}};ja=v([(0,vw.injectable)(),m(0,(0,vw.inject)(K)),m(1,(0,vw.inject)(ye))],ja);var kz=require("vscode");var Pz=require("vscode");var kb=class kb extends Qt{constructor(t,r,i,o,s,a){super();this.kernel=t;this.localResourceUriConverter=r;this.configurationSettings=i;this.sourceProviderFactory=o;this.isWebViewOnline=s;this.cdnScriptProvider=a;this.id="all";this.scriptProviders=this.sourceProviderFactory.getProviders(this.kernel,this.localResourceUriConverter),this.scriptProviders.forEach(l=>this._register(l)),this.monitorKernel()}get configuredScriptSources(){return this.configurationSettings.getSettings(void 0).widgetScriptSources}static{this.trackedWidgetModuleNames=new Set}async getBaseUrl(){let t=this.scriptProviders.find(r=>r.getBaseUrl);if(t)return t.getBaseUrl()}async getWidgetScriptSources(){let t=[];return await Promise.all(this.scriptProviders.map(async r=>{r.getWidgetScriptSources&&t.push(...await r.getWidgetScriptSources())})),t}async getWidgetScriptSource(t,r){let i=await this.isWebViewOnline,o=this.scriptProviders.slice(),s={moduleName:t};for(;o.length;){let a=o.shift();if(!a)continue;let l=await a.getWidgetScriptSource(t,r,i);if(l.scriptUri){s=l;break}else p.warn(`Widget Script Source not found for ${t}@${r} from ${a.id}`)}return this.sendTelemetryForWidgetModule(t,r,"",s.source).catch(h),s.scriptUri?p.trace(`Script source for Widget ${t}@${r} was found from source ${s.source} and ${s.scriptUri}`):p.error(`Script source for Widget ${t}@${r} not found in ${this.scriptProviders.map(a=>a.id).join(", ")}`),s}async sendTelemetryForWidgetModule(t,r,i,o){let s=`${t}.${t}@${r}`;if(kb.trackedWidgetModuleNames.has(s))return;kb.trackedWidgetModuleNames.add(s);let a=t.toLowerCase().startsWith("@jupyter-widgets"),l=o==="cdn"||a||await this.cdnScriptProvider.isOnCDN(t),c=l?t.replace(/\//g,"_").replace(/\\/g,"_").replace(/@/g,"_at_"):void 0,u=l?i.replace(/\//g,"_").replace(/\\/g,"_").replace(/@/g,"_at_"):void 0;T("DS_INTERNAL.IPYWIDGET_USED_BY_USER",void 0,{hashedName:await ot(t),moduleName:c,modelName:u,source:o,moduleVersion:l?r:void 0,cdnSearched:this.configuredScriptSources.length>0})}monitorKernel(){this.hookKernelEvents(),this._register(this.kernel.onStarted(this.hookKernelEvents,this)),this._register(this.kernel.onRestarted(this.hookKernelEvents,this)),this._register(this.kernel.onDidKernelSocketChange(()=>this.hookKernelEvents(),this))}hookKernelEvents(){let t=this.kernel.session?.kernel;t&&(t.anyMessage.connect(this.onAnyMessage,this),this._register(new Pz.Disposable(()=>t.anyMessage.disconnect(this.onAnyMessage,this))))}onAnyMessage(t,r){if(r.direction==="recv"&&r.msg.header.msg_type==="comm_open"){let o=r.msg.content.data;o.state?._model_module&&o.state._model_name&&this.sendTelemetryForWidgetModule(o.state?._model_module,o.state?._model_module_version||"",o.state?._model_name).catch(h)}}};v([Yr()],kb.prototype,"sendTelemetryForWidgetModule",1),v([Yr()],kb.prototype,"onAnyMessage",1);var e0=kb;var t0=class{constructor(e,t){this.isWebExtension=e;this.converter=t}async asWebviewUri(e){return this.isWebExtension?e:this.converter(e)}};var r0=class{constructor(e,t,r,i,o,s){this.document=e;this.kernelProvider=t;this.configurationSettings=i;this.sourceProviderFactory=o;this.cdnScriptProvider=s;this.postEmitter=new kz.EventEmitter;this.disposables=[];this.isWebViewOnline=ne();this.widgetSources=new Map;this.pendingModuleRequests=new Map;this.uriTranslationRequests=new Io;this.uriConverter=new t0(Lr(),a=>(this.uriTranslationRequests.has(a)||this.uriTranslationRequests.set(a,ne()),this.postEmitter.fire({message:"ConvertUriForUseInWebViewRequest",payload:a}),this.uriTranslationRequests.get(a).promise)),this.isWebViewOnline.promise.catch(h),r.push(this),this.kernelProvider.onDidStartKernel(a=>{a.notebook===this.document&&this.initialize()},this,this.disposables)}get postMessage(){return this.postEmitter.event}dispose(){for(;this.disposables.length;)this.disposables.shift()?.dispose()}onMessage(e,t){if(e==="ConvertUriForUseInWebViewResponse"){let r=t;r&&this.uriTranslationRequests.has(r.request)&&this.uriTranslationRequests.get(r.request).resolve(r.response)}else if(e==="IPyWidgets_Ready")this.sendBaseUrl(),this.sendWidgetScriptSources().catch(h);else if(e==="IPyWidgets_IsOnline"){let r=t.isOnline;this.isWebViewOnline.resolve(r)}else e==="IPyWidgets_WidgetScriptSourceRequest"&&t&&this.onRequestWidgetScript(t).catch(h)}initialize(){this.jupyterLab||(this.jupyterLab=require("@jupyterlab/services")),this.kernel||(this.kernel=this.kernelProvider.get(this.document)),this.kernel?.session&&(this.scriptProvider&&!this.scriptProvider.isDisposed||(this.scriptProvider=new e0(this.kernel,this.uriConverter,this.configurationSettings,this.sourceProviderFactory,this.isWebViewOnline.promise,this.cdnScriptProvider),this.kernel.onDisposed(()=>this.dispose()),this.handlePendingRequests(),this.sendBaseUrl(),p.trace("IPyWidgetScriptSource.initialize")))}sendBaseUrl(){this.scriptProvider&&this.scriptProvider.getBaseUrl().then(e=>{e&&this.postEmitter.fire({message:"IPyWidgets_BaseUrl_Response",payload:e.toString()})}).catch(e=>p.error("Failed to get baseUrl",e))}async sendWidgetScriptSources(){if(this.scriptProvider&&!this.allWidgetScriptsSent)try{(await this.scriptProvider.getWidgetScriptSources()).forEach(t=>{this.widgetSources.get(t.moduleName)?.source!=="cdn"&&this.widgetSources.set(t.moduleName,t),this.postEmitter.fire({message:"IPyWidgets_WidgetScriptSource_Response",payload:t})})}catch(e){p.warn("Failed to fetch script sources",e)}finally{this.allWidgetScriptsSent=!0}}async onRequestWidgetScript(e){let{moduleName:t,moduleVersion:r,requestId:i}=e;if(p.trace(`\x1B[32mFetch Script for ${JSON.stringify(e)}`),await this.sendWidgetSource(t,r,i).catch(o=>p.error("Failed to send widget sources upon ready",o)),this.scriptProvider&&!this.allWidgetScriptsSent)try{await this.sendWidgetScriptSources()}finally{this.sendWidgetSource(t,r,i).catch(o=>p.error("Failed to send widget sources upon ready",o))}}async sendWidgetSource(e,t="*",r){if(!e||e.startsWith("@jupyter"))return;if(!this.kernel||!this.scriptProvider){this.pendingModuleRequests.set(e,{moduleVersion:t,requestId:r});return}let i={moduleName:e,requestId:r};try{p.trace(`\x1B[32mFetch Script for ${e}`),i=await this.scriptProvider.getWidgetScriptSource(e,t),this.widgetSources.get(i.moduleName)?.source!=="cdn"&&this.widgetSources.set(i.moduleName,i)}catch(o){p.error("Failed to get widget source due to an error",o),T("DS_INTERNAL.IPYWIDGET_DISCOVERY_ERRORED")}finally{p.trace(`\x1B[32mScript for ${e}, is ${i.scriptUri} from ${i.source}`),this.postEmitter.fire({message:"IPyWidgets_WidgetScriptSource_Response",payload:i})}}handlePendingRequests(){let e=Array.from(this.pendingModuleRequests.keys());for(;e.length;){let t=e.shift();if(t){let{moduleVersion:r,requestId:i}=this.pendingModuleRequests.get(t);this.pendingModuleRequests.delete(t),this.sendWidgetSource(t,r,i).catch(o=>p.error(`Failed to send WidgetScript for ${t}`,o))}}}};var i0=Symbol("IWidgetScriptSourceProviderFactory"),o0=Symbol("INbExtensionsPathProvider"),s0=Symbol("IIPyWidgetScriptManagerFactory"),_it=Symbol("IIPyWidgetScriptManager");var Af=k(N()),Ro=require("vscode");var _z="https://unpkg.com/",Tz="https://cdn.jsdelivr.net/npm/",a0="IPYWidgetCDNConfigured",xz="IPYWidgetNotFoundOnCDN",Dz="IPYWidgetNoNetWorkAccess",qme=/\$\{(.*?)\}/g;function Hme(n,e,t){let r=Gme(n);if(!r)return;let i=e,o="index",s=e.indexOf("/");s!==-1&&e[0]==="@"&&(s=e.indexOf("/",s+1)),s!==-1&&(o=e.substr(s+1),i=e.substr(0,s));let a=o.endsWith(".js")?o:o.concat(".js"),l=t.startsWith("^")?t.slice(1):t;return r.replace(qme,(c,u)=>{let d;switch(u){case"packageName":d=i;break;case"fileName":d=o;break;case"fileNameWithExt":d=a;break;case"moduleVersion":d=l;break;case"moduleVersionSpec":d=t;break;default:d=c;break}return d})}function Gme(n){switch(n){case"unpkg.com":return`${_z}\${packageName}@\${moduleVersionSpec}/dist/\${fileName}`;case"jsdelivr.com":return`${Tz}\${packageName}@\${moduleVersion}/dist/\${fileNameWithExt}`;default:return n}}var Ba=class{constructor(e,t){this.globalMemento=e;this.configurationSettings=t;this.id="cdn";this.cache=new Map;this.isOnCDNCache=new Map;this.notifiedUserAboutWidgetScriptNotFound=new Set}get cdnProviders(){return this.configurationSettings.getSettings(void 0).widgetScriptSources}dispose(){this.cache.clear()}async isOnCDN(e){let t=`MODULE_VERSION_ON_CDN_${e}`;if(this.isOnCDNCache.has(t))return this.isOnCDNCache.get(t);if(this.globalMemento.get(t,!1))return!0;let r=(async()=>{let i=new Zl,o=so(i.exists(`${_z}${e}`)),s=so(i.exists(`${Tz}${e}`));return await Promise.race([o.promise,s.promise]),o.value||s.value?!0:(await Promise.all([o.promise,s.promise]),!!(o.value||s.value))})();return r.then(i=>{if(i)return this.globalMemento.update(t,!0)}).then(h,h),this.isOnCDNCache.set(t,r),r}async getWidgetScriptSource(e,t,r){if(r===!1)return p.ci(`Webview is offline, cannot use CDN for ${e}`),this.warnIfNoAccessToInternetFromWebView(e).catch(h),{moduleName:e};if(this.cdnProviders.length===0&&this.globalMemento.get(a0,!1))return p.ci("No CDN providers and user configured CDN"),{moduleName:e};let i=this.getModuleKey(e,t);return this.cache.get(i)||this.cache.set(i,this.getWidgetScriptSourceImplementation(e,t)),this.cache.get(i)}async generateDownloadUri(e,t,r){return Hme(r,e,t)}getModuleKey(e,t){return`${e}${t}`}async getWidgetScriptSourceImplementation(e,t){if(p.trace(`\x1B[32mSearching for Widget Script ${e}#${t} using cdns ${this.cdnProviders.join(" ")}`),await this.configureWidgets(),this.cdnProviders.length===0)return{moduleName:e};let i=(await Promise.all(this.cdnProviders.map(o=>this.getValidUri(e,t,o)))).find(o=>o);return i?(p.trace(`\x1B[32mWidget Script ${e}#${t} found at URI: ${i}`),{moduleName:e,scriptUri:i,source:"cdn"}):(p.error(`Widget Script ${e}#${t} was not found on on any cdn`),this.handleWidgetSourceNotFound(e,t).catch(h),{moduleName:e})}async getValidUri(e,t,r){try{let i=await this.generateDownloadUri(e,t,r),o=new Zl;if(i&&await o.exists(i))return i}catch{p.trace(`Failed downloading ${e}:${t} from ${r}`);return}}async warnIfNoAccessToInternetFromWebView(e){if(this.globalMemento.get(Dz,!1)||this.notifiedUserAboutWidgetScriptNotFound.has(e)||this.cdnProviders.length===0)return;switch(this.notifiedUserAboutWidgetScriptNotFound.add(e),await Ro.window.showWarningMessage(y.cdnWidgetScriptNotAccessibleWarningMessage(e,JSON.stringify(this.cdnProviders)),ce.ok,ce.doNotShowAgain,ce.moreInfo)){case ce.doNotShowAgain:return this.globalMemento.update(Dz,!0);case ce.moreInfo:return Ro.env.openExternal(Ro.Uri.parse("https://aka.ms/PVSCIPyWidgets"));default:}}async configureWidgets(){if(this.cdnProviders.length!==0||this.globalMemento.get(a0,!1))return;if(this.configurationPromise)return this.configurationPromise.promise;this.configurationPromise=ne(),T("DS_INTERNAL.IPYWIDGET_PROMPT_TO_USE_CDN");let e=await Ro.window.showInformationMessage(y.useCDNForWidgetsNoInformation,{modal:!0},ce.ok,ce.doNotShowAgain,ce.moreInfo),t="dismissed";switch(e){case ce.ok:{t="ok",await Promise.all([this.updateScriptSources(["jsdelivr.com","unpkg.com"]),this.globalMemento.update(a0,!0)]);break}case ce.doNotShowAgain:{t="doNotShowAgain",await Promise.all([this.updateScriptSources([]),this.globalMemento.update(a0,!0)]);break}case ce.moreInfo:{Ro.env.openExternal(Ro.Uri.parse("https://aka.ms/PVSCIPyWidgets"));break}default:t=e===ce.cancel?"cancel":"dismissed";break}T("DS_INTERNAL.IPYWIDGET_PROMPT_TO_USE_CDN_SELECTION",void 0,{selection:t}),this.configurationPromise.resolve()}async updateScriptSources(e){await this.configurationSettings.updateSetting("widgetScriptSources",e,void 0,Ro.ConfigurationTarget.Global)}async handleWidgetSourceNotFound(e,t){if(this.globalMemento.get(xz,!1)||this.notifiedUserAboutWidgetScriptNotFound.has(e)||this.cdnProviders.length===0)return;switch(this.notifiedUserAboutWidgetScriptNotFound.add(e),await Ro.window.showWarningMessage(y.widgetScriptNotFoundOnCDNWidgetMightNotWork(e,t,JSON.stringify(this.cdnProviders)),ce.ok,ce.doNotShowAgain,ce.reportThisIssue)){case ce.doNotShowAgain:return this.globalMemento.update(xz,!0);case ce.reportThisIssue:return Ro.env.openExternal(Ro.Uri.parse("https://aka.ms/CreatePVSCDataScienceIssue"));default:}}};Ba=v([(0,Af.injectable)(),m(0,(0,Af.inject)(We)),m(0,(0,Af.named)(dt)),m(1,(0,Af.inject)(oe))],Ba);var yw=class{constructor(e,t){this.document=e;this.serviceContainer=t;this.cachedMessages=[];this.postEmitter=new Ao.EventEmitter;this.attachedWebviews=new WeakSet;this.modulesForWhichWeHaveDisplayedWidgetErrorMessage=new Set;this.queuedMessages=[];this.disposables=this.serviceContainer.get(K),this.jupyterOutput=this.serviceContainer.get(jo,nd),this.configService=this.serviceContainer.get(oe),this.initialize()}get postMessage(){return this.listeningToPostMessageEvent=!0,this.postEmitter.event}dispose(){this.cachedMessages=[],this.ipyWidgetMessageDispatcher?.dispose(),this.ipyWidgetScriptSource?.dispose()}attach(e){if(this.attachedWebviews.has(e))return;this.attachedWebviews.add(e),this.postMessage(i=>{if(p.ci(`\x1B[32mWidget Coordinator sent ${i.message}`),i.message==="ConvertUriForUseInWebViewRequest")this.onMessage(e,"ConvertUriForUseInWebViewResponse",{request:i.payload,response:e.asWebviewUri(i.payload)});else{if(!this.readyMessageReceived){this.queuedMessages.push({type:i.message,payload:i.payload});return}this.sendPendingWebViewMessages(e),e.postMessage({type:i.message,payload:i.payload}).then(h,h)}},this,this.disposables);let t=ne(),r=async()=>{let i=new Me;if(!t.completed){let s=[],a=this.serviceContainer.get(ye),l=ne();a.get(this.document)?l.resolve(a.get(this.document)):a.onDidCreateKernel(u=>{u.notebook===this.document&&l.resolve(u)},this,s);let c=await l.promise;c&&(Xe(c.kernelConnectionMetadata)?c.ipywidgetsVersion?t.completed||t.resolve(c.ipywidgetsVersion):c.onIPyWidgetVersionResolved(()=>{c.ipywidgetsVersion&&(t.completed||t.resolve(c.ipywidgetsVersion),G(s))},this,s):t.completed||t.resolve(pC)),s.length&&this.disposables.push(...s)}let o=await t.promise;p.trace(`Version of IPyWidgets ${o} determined after ${i.elapsedTime/1e3}s`),e.postMessage({type:"IPyWidgets_Reply_Widget_Version",payload:o}).then(h,h)};e.onDidReceiveMessage(async i=>{p.ci(`\x1B[32mWidget Coordinator received ${i.type}`),this.onMessage(e,i.type,i.payload),i.type==="IPyWidgets_Request_Widget_Version"&&await r(),i.type==="IPyWidgets_Window_Alert"&&Ao.window.showInformationMessage(i.message),i.type==="IPyWidgets_Window_Open"&&Ao.env.openExternal(Ao.Uri.parse(i.url)),i.type==="IPyWidgets_Ready"&&(p.trace("Web view is ready to receive widget messages"),this.readyMessageReceived=!0,this.sendPendingWebViewMessages(e))},this,this.disposables),e.postMessage({type:"IPyWidgets_IsReadyRequest",payload:void 0}).then(h,h),r().catch(h)}onMessage(e,t,r){t==="ipywidget_load_success"?this.sendLoadSucceededTelemetry(r).catch(h):t==="ipywidget_load_failure"?this.handleWidgetLoadFailure(e,r).catch(h):t==="ipywidget_widget_version_not_supported"?this.sendUnsupportedWidgetVersionFailureTelemetry(r).catch(h):t==="ipywidget_render_failure"?this.sendRenderFailureTelemetry(r):t==="ipywidget_unhandled_kernel_message"&&this.handleUnhandledMessage(r),this.getIPyWidgetMessageDispatcher().receiveMessage({message:t,payload:r}),this.getIPyWidgetScriptSource().onMessage(t,r)}sendPendingWebViewMessages(e){if(this.readyMessageReceived)for(;this.queuedMessages.length;)e.postMessage(this.queuedMessages.shift()).then(h,h)}initialize(){this.getIPyWidgetScriptSource().initialize(),this.getIPyWidgetMessageDispatcher().initialize()}async sendLoadSucceededTelemetry(e){try{T("DS_INTERNAL.IPYWIDGET_LOAD_SUCCESS",0,{moduleHash:await ot(e.moduleName),moduleVersion:e.moduleVersion})}catch{}}async handleWidgetLoadFailure(e,t){try{let r=t.error.toString(),i=this.configService.getSettings(void 0).widgetScriptSources,o=i.length>0,s=`${t.moduleName}:${t.moduleVersion}`;if(!t.isOnline)r=y.loadClassFailedWithNoInternet(t.moduleName,t.moduleVersion),Ao.window.showErrorMessage(r).then(h,h);else if(!o&&!this.modulesForWhichWeHaveDisplayedWidgetErrorMessage.has(s)){this.modulesForWhichWeHaveDisplayedWidgetErrorMessage.add(s);let a=ce.moreInfo,l=y.enableCDNForWidgetsButton;r=y.enableCDNForWidgetsSetting(t.moduleName,t.moduleVersion),Ao.window.showErrorMessage(r,{modal:!0},l,a).then(c=>{switch(c){case a:Ao.env.openExternal(Ao.Uri.parse("https://aka.ms/PVSCIPyWidgets"));break;case l:this.enableCDNForWidgets(e).catch(h);break;default:break}},h)}p.error(`Widget load failure ${r}`,i,t),T("DS_INTERNAL.IPYWIDGET_LOAD_FAILURE",0,{isOnline:t.isOnline,moduleHash:await ot(t.moduleName),moduleVersion:t.moduleVersion,timedout:t.timedout})}catch{}}async enableCDNForWidgets(e){await Ao.commands.executeCommand(J.EnableLoadingWidgetsFrom3rdPartySource),await e.postMessage({type:"IPyWidgets_AttemptToDownloadFailedWidgetsAgain"})}async sendUnsupportedWidgetVersionFailureTelemetry(e){try{T("DS_INTERNAL.IPYWIDGET_WIDGET_VERSION_NOT_SUPPORTED_LOAD_FAILURE",0,{moduleHash:await ot(e.moduleName),moduleVersion:e.moduleVersion})}catch{}}sendRenderFailureTelemetry(e){try{p.error("Error rendering a widget: ",e),T("DS_INTERNAL.IPYWIDGET_RENDER_FAILURE")}catch{}}handleUnhandledMessage(e){if(e.header.msg_type!=="status")try{if(e.header.msg_type==="error"){let t=e;t.content.traceback=t.content.traceback.map(cc)}p.trace(`Unhandled widget kernel message: ${e.header.msg_type} ${e.content}`),this.jupyterOutput.appendLine(y.unhandledMessage(e.header.msg_type,JSON.stringify(e.content))),T("DS_INTERNAL.IPYWIDGET_UNHANDLED_MESSAGE",void 0,{msg_type:e.header.msg_type})}catch{}}getIPyWidgetMessageDispatcher(){return this.ipyWidgetMessageDispatcher||(this.ipyWidgetMessageDispatcher=this.serviceContainer.get(ja).create(this.document),this.disposables.push(this.ipyWidgetMessageDispatcher.postMessage(this.cacheOrSend,this))),this.ipyWidgetMessageDispatcher}getIPyWidgetScriptSource(){return this.ipyWidgetScriptSource||(this.ipyWidgetScriptSource=new r0(this.document,this.serviceContainer.get(ye),this.serviceContainer.get(K),this.serviceContainer.get(oe),this.serviceContainer.get(i0),this.serviceContainer.get(Ba)),this.disposables.push(this.ipyWidgetScriptSource.postMessage(this.cacheOrSend,this))),this.ipyWidgetScriptSource}cacheOrSend(e){if(!this.listeningToPostMessageEvent){p.ci("\x1B[32mQueuing messages (no listeners)"),this.cachedMessages.push(e);return}this.cachedMessages.forEach(t=>this.postEmitter.fire(t)),this.cachedMessages=[],this.postEmitter.fire(e)}};v([Yr()],yw.prototype,"enableCDNForWidgets",1);var WF=class{constructor(e,t){this.editor=e;this.pendingMessages=[];this.disposables=[];this._onDidReceiveMessage=new kp.EventEmitter;this.changeController(t)}get controller(){if(!this._controller)throw new Error("No controller defined");return this._controller.controller}changeController(e){this._controller?.id!==e.id&&(this.controllerMessageHandler?.dispose(),this._controller=e,this.controllerMessageHandler=e.onDidReceiveMessage(t=>{t.editor===this.editor&&this.controller?.id===e.id&&(this.eventHandlerListening?(this.sendPendingMessages(),this._onDidReceiveMessage.fire(t.message)):this.pendingMessages.push(t.message))},this,this.disposables))}dispose(){G(this.disposables)}get onDidReceiveMessage(){return this.eventHandlerListening=!0,setTimeout(()=>this.sendPendingMessages(),0),this._onDidReceiveMessage.event}postMessage(e){return this.controller.postMessage(e,this.editor)}asWebviewUri(e){return this.controller.asWebviewUri(e)}sendPendingMessages(){if(this.pendingMessages.length){let e=this.pendingMessages.shift();for(;e;)this._onDidReceiveMessage.fire(e),e=this.pendingMessages.shift()}}},Pp=class{constructor(e,t,r){this.serviceContainer=e;this.disposableRegistry=t;this.controllerManager=r;this.messageCoordinators=new WeakMap;this.notebookDisposables=new WeakMap;this.notebookCommunications=new WeakMap;this.notebookEditors=new WeakMap}activate(){kp.window.onDidChangeVisibleNotebookEditors(this.onDidChangeVisibleNotebookEditors,this,this.disposableRegistry),kp.workspace.onDidCloseNotebookDocument(this.onDidCloseNotebookDocument,this,this.disposableRegistry),this.controllerManager.onControllerSelected(this.onDidSelectController,this,this.disposableRegistry)}onDidSelectController(e){let t=this.messageCoordinators.get(e.notebook);t&&(this.messageCoordinators.delete(e.notebook),kp.window.visibleNotebookEditors.filter(r=>r.notebook===e.notebook).forEach(r=>{let i=this.notebookCommunications.get(r);this.notebookCommunications.delete(r),i&&i.controller!==e.controller.controller&&(this.notebookCommunications.delete(r),i&&i.dispose())}),t?.dispose()),kp.window.visibleNotebookEditors.filter(r=>r.notebook===e.notebook).forEach(r=>this.initializeNotebookCommunication(r,e.controller))}initializeNotebookCommunication(e,t){if(e.notebook.isClosed||!St(e.notebook))return;let r=e.notebook;if(!t||this.notebookCommunications.has(e))return;let i=new WF(e,t);this.addNotebookDisposables(r,[i]),this.notebookCommunications.set(e,i);let o=this.messageCoordinators.get(r);o||(o=new yw(r,this.serviceContainer),this.messageCoordinators.set(r,o)),o.attach(i)}addNotebookDisposables(e,t){let r=this.notebookDisposables.get(e)||[];r.push(...t),this.notebookDisposables.set(e,r)}async onDidChangeVisibleNotebookEditors(e){e.forEach(t=>{let r=this.controllerManager.getSelected(t.notebook);this.initializeNotebookCommunication(t,r)})}onDidCloseNotebookDocument(e){let t=this.notebookEditors.get(e)||[];G(this.notebookDisposables.get(e)||[]),t.forEach(r=>this.notebookCommunications.get(r)?.dispose()),this.messageCoordinators.get(e)?.dispose(),this.messageCoordinators.delete(e)}};Pp=v([(0,xb.injectable)(),m(0,(0,xb.inject)(Ze)),m(1,(0,xb.inject)(K)),m(2,(0,xb.inject)(He))],Pp);var xp=k(N());var Db=class{constructor(e,t,r,i,o){this.disposables=e;this.kernelProvider=t;this.controllers=r;this.liveKernelTracker=i;this.preferredRemoteKernelIdProvider=o}activate(){this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposables),this.controllers.onControllerSelectionChanged(this.onNotebookControllerSelectionChanged,this,this.disposables)}onNotebookControllerSelectionChanged({selected:e,notebook:t,controller:r}){t.isClosed||(r.connection.kind==="connectToLiveRemoteKernel"&&r.connection.kernelModel.id&&(e?this.liveKernelTracker.trackKernelIdAsUsed(t.uri,r.connection.serverProviderHandle,r.connection.kernelModel.id):this.liveKernelTracker.trackKernelIdAsNotUsed(t.uri,r.connection.serverProviderHandle,r.connection.kernelModel.id)),at(r.connection)&&this.preferredRemoteKernelIdProvider.clearPreferredRemoteKernelId(t.uri).catch(h))}onDidStartKernel(e){if(!e.resourceUri)return;let t=e.resourceUri;if(e.kernelConnectionMetadata.kind!=="startUsingRemoteKernelSpec")return;let r=e.kernelConnectionMetadata.serverProviderHandle,i=()=>{let o=e.session?.kernel?.id;!e.disposed&&!e.disposing&&o&&(p.debug(`Updating preferred kernel for remote notebook ${o}`),this.preferredRemoteKernelIdProvider.storePreferredRemoteKernelId(t,o).catch(h),this.liveKernelTracker.trackKernelIdAsUsed(t,r,o))};i(),e.onDidKernelSocketChange(i,this,this.disposables)}};Db=v([(0,xp.injectable)(),m(0,(0,xp.inject)(K)),m(1,(0,xp.inject)(ye)),m(2,(0,xp.inject)(He)),m(3,(0,xp.inject)(Um)),m(4,(0,xp.inject)(rs))],Db);var Mf=k(N());var Rz=require("vscode");var Nf=class{constructor(e,t,r,i){this.disposables=e;this.uriStorage=t;this.controllers=r;this.serverProviderRegistry=i;this.handledServerProviderChanges=new WeakSet}activate(){this.serverProviderRegistry.jupyterCollections.forEach(e=>this.checkExpiredServersInJupyterCollection(e)),this.serverProviderRegistry.onDidChangeCollections(({added:e,removed:t})=>{e.forEach(r=>this.checkExpiredServersInJupyterCollection(r)),t.forEach(r=>this.removeControllersBelongingToDisposedProvider(r.extensionId,r.id))},this,this.disposables)}async checkExpiredServersInJupyterCollection(e){!this.handledServerProviderChanges.has(e.serverProvider)&&e.serverProvider.onDidChangeServers&&(this.handledServerProviderChanges.add(e.serverProvider),e.serverProvider.onDidChangeServers(()=>this.checkExpiredServersInJupyterCollection(e).catch(h),this,this.disposables));let t=new Rz.CancellationTokenSource;this.disposables.push(t);try{let r=await Promise.resolve(e.serverProvider.provideJupyterServers(t.token));await this.removeControllersAndUriStorageBelongingToInvalidServers(e.extensionId,e.id,(r||[]).map(i=>i.id))}finally{t.dispose()}}async removeControllersAndUriStorageBelongingToInvalidServers(e,t,r){let i=this.uriStorage.all;await Promise.all(i.filter(o=>o.provider.extensionId===e&&o.provider.id===t).map(async o=>{r.includes(o.provider.handle)||await this.uriStorage.remove(o.provider)})),this.controllers.registered.forEach(o=>{let s=o.connection;at(s)||s.serverProviderHandle.extensionId!==e||s.serverProviderHandle.id!==t||r.includes(s.serverProviderHandle.handle)||(p.warn(`Deleting controller ${o.id} as it is associated with a server Id that has been removed`),o.dispose())})}removeControllersBelongingToDisposedProvider(e,t){this.controllers.registered.forEach(r=>{let i=r.connection;at(i)||i.serverProviderHandle.extensionId!==e||i.serverProviderHandle.id!==t||(p.warn(`Deleting controller ${r.id} as it is associated with a Provider Id that has been removed`),r.dispose())})}};v([Yr("Failed to check what servers were shutdown in Controller Watcher")],Nf.prototype,"checkExpiredServersInJupyterCollection",1),Nf=v([(0,Mf.injectable)(),m(0,(0,Mf.inject)(K)),m(1,(0,Mf.inject)(Xt)),m(2,(0,Mf.inject)(He)),m(3,(0,Mf.inject)(Jt))],Nf);var Kf=k(N());var Az=require("vscode");var l0=class{constructor(e,t,r,i,o,s){this.label=e;this._description=t;this.detail=r;this.category=i;this.serverDisplayName=o;this.getDescription=s;this._onDidChange=new Az.EventEmitter;this.onDidChange=this._onDidChange.event}get description(){return this.getDescription?.()||this._description}set description(e){this._description=e}dispose(){this._onDidChange.dispose()}triggerChange(){this._onDidChange.fire(this)}};function Nz(n){switch(n.kind){case"connectToLiveRemoteKernel":return y.kernelCategoryForJupyterSession;case"startUsingRemoteKernelSpec":return y.kernelCategoryForRemoteJupyterKernel;default:return c0(n)}}function c0(n){switch(n.kind){case"startUsingLocalKernelSpec":return y.kernelCategoryForJupyterKernel;case"startUsingPythonInterpreter":{if(Kn(n.kernelSpec)==="registeredByNewVersionOfExtForCustomKernelSpec")return y.kernelCategoryForJupyterKernel;switch(Ue(n.interpreter)){case"Conda":return qr(n.interpreter)?y.kernelCategoryForCondaWithoutPython:y.kernelCategoryForConda;case"PipEnv":return y.kernelCategoryForPipEnv;case"Poetry":return y.kernelCategoryForPoetry;case"Pyenv":return y.kernelCategoryForPyEnv;case"Venv":case"VirtualEnv":case"VirtualEnvWrapper":return y.kernelCategoryForVirtual;default:return y.kernelCategoryForGlobal}}default:return""}}var _b=class{constructor(e,t,r,i){this.platform=e;this.jupyterUriProviderRegistration=t;this.disposables=r;this.interpreters=i;this.details=new Map}getDisplayData(e){if(!this.details.get(e.id)){let i=lt(e),o=dM(e,this.platform);e.kind==="connectToLiveRemoteKernel"&&(o=uM(e));let s=c0(e),a=e.kind==="connectToLiveRemoteKernel"?()=>uM(e):void 0,l=new l0(i,o,"",s,void 0,a);if(this.disposables.push(l),this.details.set(e.id,l),e.kind==="startUsingPythonInterpreter"&&qr(e.interpreter)){let c=u=>{let d=u.find(g=>g.id===e.interpreter?.id),f=Ai(mo().find(g=>g.id===d?.id));if(e.kind==="startUsingPythonInterpreter"&&f){e.updateInterpreter(f);let g=lt(e),b=dM(e,this.platform),I=c0(e),w=!1;g!==l.label&&(l.label=g,w=!0),b!==l.description&&(l.description=b,w=!0),I!==l.category&&(l.category=I,w=!0),w&&l.triggerChange()}};this.interpreters.onDidChangeInterpreter(u=>u?c([u]):void 0,this,this.disposables)}}let t=this.details.get(e.id);if(this.details.set(e.id,t),e.kind==="connectToLiveRemoteKernel"||e.kind==="startUsingRemoteKernelSpec"){let i=vy(e.serverProviderHandle,this.jupyterUriProviderRegistration,y.kernelDefaultRemoteDisplayName);t.serverDisplayName!==i&&(t.serverDisplayName=i,t.triggerChange())}let r=Nz(e);return t.category!==r&&(t.category=r,t.triggerChange()),t}};_b=v([(0,Kf.injectable)(),m(0,(0,Kf.inject)(xr)),m(1,(0,Kf.inject)(Jt)),m(2,(0,Kf.inject)(K)),m(3,(0,Kf.inject)(rt))],_b);var Du=k(N()),Rb=require("vscode");var Dp=k(N()),Oz=require("vscode");var Mz=require("vscode");function u0(n){try{return px(Mi(n))||n.getCells().find(t=>t.kind===Mz.NotebookCellKind.Code)?.document.languageId}catch(e){p.warn("Failed to determine language of first cell",e)}}var Kz="DATASCIENCE.LAST_SAVED_CELL_LANGUAGE",us=class{constructor(e,t,r){this.disposables=e;this.globalMemento=t;this.pythonExtensionChecker=r}getPreferredLanguage(e){let t=e?.language_info?.name||e?.kernelspec?.language||this.lastSavedNotebookCellLanguage,r=this.pythonExtensionChecker.isPythonExtensionInstalled?ge:"plaintext";return Tl(t||r)}activate(){Oz.workspace.onDidSaveNotebookDocument(this.onDidSaveNotebookDocument,this,this.disposables)}getSupportedLanguages(e){if(Xe(e))return wW;{let t=Tl(yo(e)||"");return t&&dC.includes(t.toLowerCase())?[t,"raw"]:[]}}get lastSavedNotebookCellLanguage(){return this.globalMemento.get(Kz)}async onDidSaveNotebookDocument(e){if(!St(e))return;let t=u0(e);t&&t!==this.lastSavedNotebookCellLanguage&&await this.globalMemento.update(Kz,t)}};v([Yr("Saving last saved cell language")],us.prototype,"onDidSaveNotebookDocument",1),us=v([(0,Dp.injectable)(),m(0,(0,Dp.inject)(K)),m(1,(0,Dp.inject)(We)),m(1,(0,Dp.named)(dt)),m(2,(0,Dp.inject)(qe))],us);function Fz(n){let e={kernelSpecCount:0,localKernelSpecCount:0,remoteKernelSpecCount:0,kernelInterpreterCount:0,kernelLiveCount:0};n.forEach(t=>{switch(t.kind){case"connectToLiveRemoteKernel":e.kernelLiveCount+=1;break;case"startUsingRemoteKernelSpec":e.localKernelSpecCount+=1,e.kernelSpecCount+=1;break;case"startUsingLocalKernelSpec":e.remoteKernelSpecCount+=1,e.kernelSpecCount+=1;break;case"startUsingPythonInterpreter":{e.kernelInterpreterCount+=1;break}default:break}}),T("DS_INTERNAL.KERNEL_COUNT",{...e})}var Ht=require("vscode");var uc=require("vscode");var Lz=require("vscode");async function Uz(n,e){let t=e?.findNotebookEditor(n);return t?Lz.commands.executeCommand("notebook.selectKernel",{notebookEditor:t}):(p.error("Unable to select kernel as the Notebook document could not be identified"),!1)}var Wz=require("vscode");var d0=class extends Ml{constructor(e){super(y.failedToStartAnUntrustedKernelSpec(lt(e),e.kernelSpec.specFile?M(Wz.Uri.file(e.kernelSpec.specFile)):""),void 0,e)}};var Qs=class n{static async switchController(e,t){let i=t.get(Fn).findNotebookEditor(e),o=t.get(He),s,a=ne(),l=o.onControllerSelected(u=>a.resolve(u.controller));return await Uz(e,t.get(Fn))&&i&&(s=await a.promise),l.dispose(),s?{controller:s.controller,metadata:s.connection}:void 0}static async notifyAndRestartDeadKernel(e){let t=await uc.window.showErrorMessage(y.cannotRunCellKernelIsDead(lt(e.kernelConnectionMetadata)),{modal:!0},y.showJupyterLogs,y.restartKernel),r=!1;switch(t){case y.restartKernel:{await e.restart(),r=!0;break}case y.showJupyterLogs:uc.commands.executeCommand(J.ViewJupyterOutput).then(h,h)}return r}static async handleKernelError(e,t,r,i,o,s,a,l){let c=e.get(We,dt),u=e.get(Gr);a.interpreter&&r==="start"&&V8(c,19,a.interpreter).catch(h);let d=await u.handleKernelError(t,r,a,i,l),f=at(a);switch(e.tryGet(_n)?.isSupported&&f&&r==="start"&&Ct(i,"DS_INTERNAL.RAWKERNEL_SESSION_NO_IPYKERNEL",{reason:d}),o.dispose().catch(h),d){case 1:case 2:throw t;case 3:{let I=await n.switchController(i,e);if(!I)throw t;s=I.controller,a=I.metadata;break}}return{controller:s,metadata:a}}static convertContextToFunction(e,t){switch(e){case"start":case"execution":return r=>r.start(t);case"interrupt":return r=>r.interrupt();case"restart":return r=>r.restart()}}static{this.connectionsByNotebook=new WeakMap}static{this.connectionsByUri=new Map}static async verifyKernelState(e,t,r,i,o,s,a,l){let c=await i,{kernel:u,deadKernelAction:d}=c;if(mT(u)){if(this.deleteKernelInfo(t,i),d==="deadKernelWasNoRestarted")throw new Ra(u.kernelConnectionMetadata);if(d==="deadKernelWasRestarted")throw new Ra(u.kernelConnectionMetadata);if(l?.kernelWasRestartedDueToDeadKernel.value===!0)throw new Ra(u.kernelConnectionMetadata);c.deadKernelAction="deadKernelWasRestarted";let f=ne();return f.resolve(!0),l=l||{kernelWasRestartedDueToDeadKernel:f},n.wrapKernelMethod(u.kernelConnectionMetadata,"start",o,e,t,r,a,s,l)}return u}static async wrapKernelMethod(e,t,r,i,o,s,a,l=()=>void 0,c){let u=this.getKernelInfo(o);if(!s.disableUI&&u?.options.disableUI&&(u.options.disableUI=!1),!s.disableUI&&u?.kernel.resolved&&(u?.kernel.value?.kernel?.disposed||u?.kernel.value?.kernel?.disposing)&&(this.deleteKernelInfo(o),u=void 0),u&&t!=="restart"&&t!=="interrupt")return n.verifyKernelState(i,o,s,u.kernel.promise,r,l,a);p.debug(`${t} the kernel, options.disableUI=${s.disableUI} for ${M("notebook"in o?o.notebook.uri:o.resource)}`),c=c||{kernelWasRestartedDueToDeadKernel:ne()};let d=n.wrapKernelMethodImpl(e,t,i,o,s,r,l,c);c?.kernelWasRestartedDueToDeadKernel.resolved&&c.kernelWasRestartedDueToDeadKernel.resolve(!0);let f=so(d);return f.promise.catch(h),d.then(g=>{g.kernel.onDisposed(()=>{this.deleteKernelInfo(o,f.promise)},void 0,a)}).catch(()=>{this.deleteKernelInfo(o,f.promise)}),this.setKernelInfo(o,f,s),n.verifyKernelState(i,o,s,f.promise,r,l,a,c)}static getKernelInfo(e){return"notebook"in e?n.connectionsByNotebook.get(e.notebook):n.connectionsByUri.get(e.resource.toString())}static setKernelInfo(e,t,r){"notebook"in e?n.connectionsByNotebook.set(e.notebook,{kernel:t,options:r}):n.connectionsByUri.set(e.resource.toString(),{kernel:t,options:r})}static deleteKernelInfo(e,t){if(!t){"notebook"in e?n.connectionsByNotebook.delete(e.notebook):n.connectionsByUri.delete(e.resource.toString());return}"notebook"in e&&n.connectionsByNotebook.get(e.notebook)?.kernel.promise===t?n.connectionsByNotebook.delete(e.notebook):e.resource&&n.connectionsByUri.get(e.resource.toString())?.kernel.promise===t&&n.connectionsByUri.delete(e.resource.toString())}static verifyWeCanStartKernel(e,t){if(!at(e)||!e.kernelSpec.specFile)return;if(!t.get(Sp).isTrusted(uc.Uri.file(e.kernelSpec.specFile)))throw new d0(e)}static async wrapKernelMethodImpl(e,t,r,i,o,s,a,l){let c=r.get(ye),u=r.get(Nm),d,f=n.convertContextToFunction(t,o),g=t,b="controller"in i?i.controller:void 0;for(t==="start"&&n.verifyWeCanStartKernel(e,r);d===void 0;){if("notebook"in i&&i.notebook.isClosed)throw new uc.CancellationError;d="notebook"in i?c.getOrCreate(i.notebook,{metadata:e,controller:b||i.controller,resourceUri:i.resource}):u.getOrCreate(i.resource,{metadata:e,resourceUri:i.resource});let I=!1;try{if(t!=="restart"&&mT(d)&&!o.disableUI){I=!0;let w=await n.notifyAndRestartDeadKernel(d);return w&&l&&l.kernelWasRestartedDueToDeadKernel.resolve(!0),{kernel:d,deadKernelAction:w?"deadKernelNeedsToBeRestarted":"deadKernelWasNoRestarted"}}else{if(a(g,d),await f(d),"notebook"in i&&i.notebook.isClosed)throw new uc.CancellationError;mT(d)&&!o.disableUI&&g!=="interrupt"&&await n.notifyAndRestartDeadKernel(d)}}catch(w){if(I&&l&&l.kernelWasRestartedDueToDeadKernel.resolve(!0),Zt(w)||p.warn(`Error occurred while trying to ${g} the kernel, options.disableUI=${o.disableUI}`,w),o.disableUI)throw w;if("notebook"in i&&i.notebook.isClosed)throw new uc.CancellationError;let _=await n.handleKernelError(r,w,g,i.resource,d,b,e,s);if(b=_.controller,e=_.metadata,f=A=>A.start(o),g="start",s==="3rdPartyExtension")throw w;d=void 0}}return{kernel:d}}static async connectToNotebookKernel(e,t,r,i,o,s="jupyterExtension",a=()=>void 0){return n.wrapKernelMethod(e,"start",s,t,r,i,o,a)}static async connectToKernel(e,t,r,i,o,s="jupyterExtension",a=()=>void 0){return n.wrapKernelMethod(e,"start",s,t,r,i,o,a)}};var Of=class{constructor(e){this.controller=e}get id(){return this.controller.id}createNotebookCellExecution(e){return this.controller.createNotebookCellExecution(e)}};var m0=require("vscode");var p0=class extends Qt{constructor(t,r,i){super();this.kernel=t;this.controller=r;this.notebook=i}initialize(){let t=this.kernel,r=this.controller,i=this.notebook;if(t.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"||t.status!=="busy"&&t.status!=="unknown"||!r.createNotebookExecution)return;this._register(m0.workspace.onDidCloseNotebookDocument(s=>{s===i&&this.dispose()},this)),this._register(r.onDidChangeSelectedNotebooks(s=>{s.notebook===i&&s.selected===!1&&this.dispose()},this)),this._register(t.onStatusChanged(s=>{s!=="busy"&&s!=="unknown"&&this.dispose()},this));let o=r.createNotebookExecution(i);o.start(),this._register(new m0.Disposable(()=>o.end()))}};var f0=class n{constructor(e,t,r,i,o,s,a,l,c,u,d){this.kernelConnection=e;this._viewType=r;this.kernelProvider=i;this.context=o;this.languageService=a;this.configuration=l;this.extensionChecker=c;this.serviceContainer=u;this.displayDataProvider=d;this._onNotebookControllerSelectionChanged=new Ht.EventEmitter;this._onConnecting=new Ht.EventEmitter;this.pendingCellAdditions=new WeakMap;this._onDidDispose=new Ht.EventEmitter;this.disposables=[];this.notebookKernels=new WeakMap;this.isDisposed=!1;this.runningCellExecutions=new WeakMap;this.associatedDocuments=new WeakMap;this.restoredConnections=new WeakSet;this.cellQueue=new WeakMap;B$(e.id,e.interpreter?.id),s.push(this),this.displayData=this.displayDataProvider.getDisplayData(this.connection),this.controller=Ht.notebooks.createNotebookController(t,r,this.displayData.label,this.handleExecution.bind(this),this.getRendererScripts()),this.displayData.onDidChange(this.updateDisplayData,this,this.disposables),this.updateDisplayData(),this.controller.interruptHandler=this.handleInterrupt.bind(this),this.controller.supportsExecutionOrder=!0,this.controller.supportedLanguages=this.languageService.getSupportedLanguages(e),this.controller.onDidChangeSelectedNotebooks(this.onDidChangeSelectedNotebooks,this,this.disposables),Ht.workspace.onDidCloseNotebookDocument(f=>{this.associatedDocuments.delete(f)},this,this.disposables)}get id(){return this.controller.id}get label(){return this.controller.label}get connection(){return this.kernelConnection}get viewType(){return this._viewType}get onNotebookControllerSelectionChanged(){return this._onNotebookControllerSelectionChanged.event}get onConnecting(){return this._onConnecting.event}get onDidReceiveMessage(){return this.controller.onDidReceiveMessage}get onDidDispose(){return this._onDidDispose.event}isAssociatedWithDocument(e){return this.associatedDocuments.has(e)}static create(e,t,r,i,o,s,a,l,c,u,d,f){let g=new n(e,t,r,i,o,s,a,l,c,u,d);try{g.controller.variableProvider=f}catch(b){p.warn("Failed to attach variable provider",b)}return g}async restoreConnection(e){if(this.restoredConnections.has(e))return;this.restoredConnections.add(e);let t=await this.connectToKernel(e,new Mt(!0));if(this.kernelConnection.kind==="connectToLiveRemoteKernel"){let u=new p0(t,this.controller,e);this.disposables.push(u),u.initialize()}let r=this.kernelProvider.getKernelExecution(t),o=await this.serviceContainer.get(Wa).getLastTrackedCellExecution(e,t);if(!t.session?.kernel||r.pendingCells.length||!o||e.cellCount<o.cellIndex||e.cellAt(o.cellIndex).kind!==Ht.NotebookCellKind.Code)return;Ca(t.resourceUri,t.kernelConnectionMetadata);let s=!1,a=[],l,c=(u,d)=>{if(!(d.direction==="send"||s)&&bu(d.msg)===o.msg_id){if("msg_type"in d.msg&&d.msg.msg_type==="status"&&"execution_state"in d.msg.content&&d.msg.content.execution_state==="idle")return;s=!0,r.resumeCellExecution(e.cellAt(o.cellIndex),{msg_id:o.msg_id,startTime:o.startTime,executionCount:o.executionCount}).catch(h),G(a)}};t.session.kernel.anyMessage.connect(c),l=new Ht.Disposable(()=>{ci(()=>t.session?.kernel?.anyMessage.disconnect(c))}),a.push(l),this.disposables.push(l)}updateConnection(e){e.kind!=="connectToLiveRemoteKernel"&&(this.controller.label=lt(e))}asWebviewUri(e){return this.controller.asWebviewUri(e)}postMessage(e,t){let r=e&&"message"in e?e.message:"";return p.ci(`\x1B[32mPosting message to Notebook UI ${r}`),this.controller.postMessage(e,t)}setPendingCellAddition(e,t){if(this.viewType!==nr)throw new Error("setPendingCellAddition only applies to the Interactive Window");this.pendingCellAdditions.set(e,t)}dispose(){if(this.isDisposed)return;let e=Ht.workspace.notebookDocuments.filter(t=>this.associatedDocuments.has(t)).map(t=>t.uri.toString());p.debug(`Disposing controller ${this.id} associated with connection ${this.connection.id} ${e.length?"and documents "+e.join(", "):""}`),p.ci(`Disposing controller ${this.id} associated with connection ${this.connection.id} ${e.length?"and documents "+e.join(", "):""} called from ${new Error("").stack}`),this.isDisposed=!0,this._onNotebookControllerSelectionChanged.dispose(),this._onConnecting.dispose(),this.controller.dispose(),this._onDidDispose.fire(),this._onDidDispose.dispose(),G(this.disposables)}updateDisplayData(){this.controller.label=this.displayData.label;let e=this.connection.kind==="connectToLiveRemoteKernel"?"":this.displayData.description;this.controller.description=e,this.displayData.serverDisplayName&&(this.controller.description=e?`${e} (${this.displayData.serverDisplayName})`:this.displayData.serverDisplayName)}async handleExecution(e,t){if(e.length<1)return;let r=kn(t);r?.cellExecutionCount(e.length);let i=r?.preExecuteCellTelemetry();if(this.pendingCellAdditions.has(t)&&await this.pendingCellAdditions.get(t),e=e.filter(s=>s.index<0?(p.warn(`Attempting to run a cell with index ${s.index}, kind ${s.kind}, text = ${s.document.getText()}`),!1):!0),!Ht.workspace.isTrusted)return;p.debug(`Handle Execution of Cells ${e.map(s=>s.index)} for ${M(t.uri)}`),await Ca(t.uri,this.connection),i?.stop();let o=this.cellQueue.get(t)||[];this.cellQueue.set(t,o.concat(e)),await this.executeQueuedCells(t)}async onDidChangeSelectedNotebooks(e){if(p.ci(`NotebookController selection event called for notebook ${e.notebook.uri.toString()} & controller ${this.connection.kind}:${this.id}. Selected ${e.selected} `),this.associatedDocuments.has(e.notebook)&&e.selected)return;if(!e.selected){let r=this.kernelProvider.get(e.notebook);r?.kernelConnectionMetadata.id===this.kernelConnection.id&&(p.info(`Disposing kernel ${this.kernelConnection.id} for notebook ${M(e.notebook.uri)} due to selection of another kernel or closing of the notebook`),r.dispose().catch(h)),this.associatedDocuments.delete(e.notebook),this._onNotebookControllerSelectionChanged.fire({controller:this,notebook:e.notebook,selected:e.selected});return}if(!St(e.notebook)&&e.notebook.notebookType!==nr||!Ht.workspace.isTrusted)return;kn(e.notebook)?.kernelSelected(this.kernelConnection.id,this.kernelConnection.interpreter?.id),zme(this.kernelConnection);let t=ne();p.ci(`Controller ${this.connection.kind}:${this.id} associated with nb ${M(e.notebook.uri)}`),this.associatedDocuments.set(e.notebook,t.promise),await this.onDidSelectController(e.notebook),await this.updateCellLanguages(e.notebook),this._onNotebookControllerSelectionChanged.fire({controller:this,notebook:e.notebook,selected:e.selected}),p.debug("Controller selection change completed"),t.resolve()}async updateCellLanguages(e){let t=this.controller.supportedLanguages;if(!t||t?.length===0)return;let i=Xe(this.kernelConnection)?ge:t[0];await Promise.all(e.getCells().filter(o=>o.kind===Ht.NotebookCellKind.Code).map(async o=>{t.includes(o.document.languageId)||await Ht.languages.setTextDocumentLanguage(o.document,i).then(h,h)}))}getRendererScripts(){return this.context.extensionMode===Ht.ExtensionMode.Development||this.context.extensionMode===Ht.ExtensionMode.Test?[new Ht.NotebookRendererScript(Ht.Uri.joinPath(this.context.extensionUri,"dist","webviews","webview-side","widgetTester","widgetTester.js"))]:[]}handleInterrupt(e){p.debug(`VS Code interrupted kernel for ${M(e.uri)}`),e.getCells().forEach(t=>ct(t,"Cell cancellation requested")),Ht.commands.executeCommand(J.InterruptKernel,{notebookEditor:{notebookUri:e.uri}}).then(h,t=>p.error("Failed to interrupt",t))}createCellExecutionIfNecessary(e,t){let r=this.runningCellExecutions.get(e.notebook);if(!r||r.cell===e){r?.end(void 0,void 0),r=Ki.getOrCreate(e,t,!0),this.runningCellExecutions.set(e.notebook,r);let i=r.end.bind(r);r.end=(o,s)=>{this.runningCellExecutions.delete(e.notebook),i(o,s)}}return r}async executeQueuedCells(e){if(!this.cellQueue.has(e))return;let t=(this.cellQueue.get(e)||[]).map(u=>{let d=this.createCellExecutionIfNecessary(u,new Of(this.controller));return{cell:u,exec:d}});this.cellQueue.delete(e);let r=t.length?t[0].cell:void 0;if(!r)return;p.trace(`Execute Notebook ${M(e.uri)}. Step 1`);let i="start",o=new Of(this.controller),s=this.serviceContainer.get(Wa),a;try{if(p.trace(`Connect to Kernel ${M(e.uri)}. Step 2`),a=await this.startKernel(e),p.trace(`Connected to Kernel ${M(e.uri)}. Step 3`),a.disposing)throw new Ht.CancellationError;a&&a.controller.id!==o.id&&(o=a.controller,t.forEach(u=>u.exec=this.createCellExecutionIfNecessary(u.cell,o))),i="execution",a.controller.id===this.id&&this.updateKernelInfoInNotebookWhenAvailable(a,e)}catch(u){if(u instanceof Iu)return;Zt(u)||p.error("Error in notebook cell execution",u),t.forEach(({cell:g,exec:b})=>{b.start(),b.clearOutput(g).then(h,h)});let d=this.serviceContainer.get(Gr);u=mt.unwrap(u);let f=Zt(u)||u instanceof Ra;await Jc(r,o,await d.getErrorMessageForDisplayInCellOutput(u,i,e.uri),f)}if(!a)return;let l=this.kernelProvider.getKernelExecution(a),c=new or;await Promise.all(t.map(async({cell:u})=>{try{let d=kn(e)?.executeCell();d&&c.add(new Ht.Disposable(()=>d.stop())),s.trackCellExecution(u,a),p.trace(`executeCell ${u.index}. Step 4`),await l.executeCell(u),iC.isExiting||s.deleteTrackedCellExecution(u,a)}catch(d){if(d instanceof Iu)return;Zt(d)||p.error("Error in cell execution",d);let f=this.serviceContainer.get(Gr);d=mt.unwrap(d);let g=Zt(d)||d instanceof Ra;await Jc(u,o,await f.getErrorMessageForDisplayInCellOutput(d,i,e.uri),g)}})).catch(h)}async startKernel(e){return this.connectToKernel(e,new Mt(!1))}async connectToKernel(e,t){let r=kn(e)?.startKernel();return this._onConnecting.fire(),Qs.connectToNotebookKernel(this.kernelConnection,this.serviceContainer,{resource:e.uri,notebook:e,controller:this.controller},t,this.disposables).finally(()=>r?.stop())}updateKernelInfoInNotebookWhenAvailable(e,t){if(this.notebookKernels.get(t)===e)return;this.notebookKernels.set(t,e);let r=[];Ht.workspace.onDidCloseNotebookDocument(s=>{s===t&&G(r)},this,r);let i=e.onDisposed(()=>G(r)),o=e.onStatusChanged(async()=>{e.disposed||!e.info||this.associatedDocuments.has(t)&&(await Vz(t,e.kernelConnectionMetadata,e.info),e.info.status==="ok"&&G(r))});r.push({dispose:()=>o.dispose()}),r.push({dispose:()=>i?.dispose()})}async onDidSelectController(e){let t=this.connection,r=this.kernelProvider.get(e);if(r&&bJ(r.kernelConnectionMetadata,t)){p.info("Switch kernel did not change kernel.");return}if(Ct(e.uri,"DS_INTERNAL.SWITCH_KERNEL"),r&&Ht.window.visibleNotebookEditors.filter(s=>s.notebook===e).forEach(s=>this.postMessage({message:"IPyWidgets_onKernelChanged",payload:void 0},s)),await Vz(e,t),e.notebookType===nr)return;let i=this.kernelProvider.getOrCreate(e,{metadata:t,controller:this.controller,resourceUri:e.uri});if(p.debug(`KernelProvider switched kernel to id = ${i.kernelConnectionMetadata.id}`),Xe(this.kernelConnection)&&!this.extensionChecker.isPythonExtensionInstalled)return;let o=this.serviceContainer.get(Sp);!this.configuration.getSettings(void 0).disableJupyterAutoStart&&at(this.kernelConnection)&&this.kernelConnection.kernelSpec.specFile&&o.isTrusted(Ht.Uri.file(this.kernelConnection.kernelSpec.specFile))&&this.connectToKernel(e,new Mt(!0))}};async function Vz(n,e,t){let r=Mi(n)||{},{changed:i}=await xJ(r,e,t);i&&await A$(n,r)}var VF=[3,9];async function zme(n){let e=await yd(n.interpreter,!0);if(!e)return;let t=e?.major||0,r=e?.minor||0;t<=0||r<=-1||(t<VF[0]||t===VF[0]&&r<=VF[1])&&Ht.window.showWarningMessage(y.warnWhenSelectingKernelWithUnSupportedPythonVersion,ce.learnMore).then(i=>{if(i===ce.learnMore)return qd("https://aka.ms/jupyterUnSupportedPythonKernelVersions")},h)}var Tb=class{constructor(e,t,r,i,o,s){this.disposables=e;this.pythonEnvFilter=t;this.extensionChecker=r;this.serviceContainer=i;this.serverUriStorage=o;this.kernelFinder=s;this.registeredControllers=new Map;this.changeEmitter=new Rb.EventEmitter;this.registeredMetadatas=new Map;this.selectedEmitter=new Rb.EventEmitter;this.selectionChangedEmitter=new Rb.EventEmitter;this.selectedControllers=new WeakMap;this._activeInterpreterControllerIds=new Set}get onDidChange(){return this.changeEmitter.event}get registered(){return[...this.registeredControllers.values()]}get all(){return this.metadatas}get metadatas(){return[...this.registeredMetadatas.values()]}get onControllerSelected(){return this.selectedEmitter.event}get onControllerSelectionChanged(){return this.selectionChangedEmitter.event}activate(){this.kernelFinder.onDidChangeKernels(()=>this.loadControllers(),this,this.disposables),this.kernelFinder.registered.forEach(e=>this.monitorDeletionOfConnections(e)),this.kernelFinder.onDidChangeRegistrations(e=>e.added.forEach(t=>this.monitorDeletionOfConnections(t)),this,this.disposables),this.pythonEnvFilter.onDidChange(this.onDidChangeFilter,this,this.disposables),this.serverUriStorage.onDidChange(this.onDidChangeFilter,this,this.disposables),this.serverUriStorage.onDidChange(this.onDidChangeUri,this,this.disposables),this.serverUriStorage.onDidRemove(this.onDidRemoveServers,this,this.disposables),this.loadControllers(),Fz(this.registered.map(e=>e.connection)),p.ci(`Providing notebook controllers with length ${this.registered.length}.`)}loadControllers(){let e=this.kernelFinder.kernels;this.createNotebookControllers(e),Array.from(this.registered).filter(r=>{let i=e.some(o=>o.id===r.connection.id)||qn&&this._activeInterpreterControllerIds.has(r.id);return!i&&r.connection.kind==="connectToLiveRemoteKernel"?!0:this.canControllerBeDisposed(r)?(i||p.debug(`Controller ${r.connection.kind}:'${r.id}' for view = '${r.viewType}' is no longer a valid`),!i):!1}).forEach(r=>{p.warn(`Disposing old controller ${r.connection.kind}:'${r.id}' for view = '${r.viewType}'`),r.dispose()})}createNotebookControllers(e){if(e.length!==0)try{this.batchAdd(e,[It,nr])}catch(t){if(!Zt(t,!0))throw t}}async monitorDeletionOfConnections(e){let t=e.onDidChangeKernels(({removed:r})=>{let i=new Set((r||[]).map(o=>o.id));this.registered.filter(o=>i.has(o.connection.id)).forEach(o=>{p.warn(`Deleting controller ${o.id} as it is associated with a connection that has been deleted ${o.connection.kind}:${o.id}`),o.dispose()})},this,this.disposables);this.kernelFinder.onDidChangeRegistrations(r=>{r.removed.includes(e)&&t.dispose()})}onDidChangeUri(){this.onDidChangeFilter()}async onDidRemoveServers(e){e.forEach(t=>{this.registered.forEach(r=>{Dt(r.connection)&&r.connection.serverProviderHandle.id===t.id&&r.connection.serverProviderHandle.handle===t.handle&&(p.warn(`Deleting controller ${r.id} as it is associated with a connection that has been removed`),r.dispose())})}),this.onDidChangeFilter()}onDidChangeFilter(){this.all.forEach(t=>this.addOrUpdate(t,[It,nr]))}batchAdd(e,t){let r=[];e.forEach(i=>{let{added:o}=this.addImpl(i,t,!1);r.push(...o)}),r.length&&this.changeEmitter.fire({added:r,removed:[]})}trackActiveInterpreterControllers(e){e.forEach(t=>this._activeInterpreterControllerIds.add(t.id))}canControllerBeDisposed(e){return!this._activeInterpreterControllerIds.has(e.id)&&!this.isControllerAttachedToADocument(e)}getSelected(e){return this.selectedControllers.get(e)}addOrUpdate(e,t){let{added:r,existing:i}=this.addImpl(e,t,!0);return r.concat(i)}addImpl(e,t,r){let i=[],o=[];p.ci(`Create Controller for ${e.kind} and id '${e.id}' for view ${t.join(", ")}`);try{t.map(s=>{let a=this.getControllerId(e,s);return this.registeredMetadatas.set(e.id,e),[a,s]}).filter(([s])=>{let a=this.registeredControllers.get(s);return a?(a.updateConnection(e),o.push(a),p.ci(`Found existing controller '${a.id}', not creating a new one just updating it`),!1):(p.ci(`Existing controller not found for '${s}', hence creating a new one`),!0)}).forEach(([s,a])=>{let l=f0.create(e,s,a,this.serviceContainer.get(ye),this.serviceContainer.get(tt),this.disposables,this.serviceContainer.get(us),this.serviceContainer.get(oe),this.extensionChecker,this.serviceContainer,this.serviceContainer.get(Ad),this.serviceContainer.get(QT)),c=[];l.onDidDispose(()=>{p.trace(`Deleting controller '${l.id}' associated with view ${a} from registration as it was disposed`),this.registeredControllers.delete(l.id),c.forEach(u=>u.dispose())},this,this.disposables),this.disposables.push(l),this.registeredControllers.set(l.id,l),i.push(l),l.onNotebookControllerSelectionChanged(u=>{u.selected&&(p.ci(`Controller ${u.controller?.id} selected for ${u.notebook.uri.toString()}`),this.selectedControllers.set(u.notebook,u.controller),this.selectedEmitter.fire(u))},this,c),l.onNotebookControllerSelectionChanged(u=>this.selectionChangedEmitter.fire({...u,controller:l}),this,c)}),r&&i.length&&this.changeEmitter.fire({added:i,removed:[]})}catch(s){if(Zt(s,!0))return p.warn(`Cancel creation of notebook controller for ${e.id}`,s),{added:i,existing:o};p.error(`Failed to create notebook controller for ${e.id}`,s)}return{added:i,existing:o}}get(e,t){let r=this.getControllerId(e,t);return this.registeredControllers.get(r)}getControllerId(e,t){return t===It?e.id:`${e.id}${FJ}`}isControllerAttachedToADocument(e){return Rb.workspace.notebookDocuments.some(t=>e.isAssociatedWithDocument(t))}};Tb=v([(0,Du.injectable)(),m(0,(0,Du.inject)(K)),m(1,(0,Du.inject)(fi)),m(2,(0,Du.inject)(qe)),m(3,(0,Du.inject)(Ze)),m(4,(0,Du.inject)(Xt)),m(5,(0,Du.inject)(Ar))],Tb);var _p=k(N());var h0=class{constructor(e,t,r){this.kernel=e;this.localResourceUriConverter=t;this.scriptManagerFactory=r;this.id="local"}async getWidgetScriptSource(e){return(await this.getWidgetScriptSources()).find(i=>i.moduleName.toLowerCase()===e.toLowerCase())||{moduleName:e}}dispose(){}async getWidgetScriptSources(){let t=await this.scriptManagerFactory.getOrCreate(this.kernel).getWidgetModuleMappings();return t&&Object.keys(t).length?await Promise.all(Object.keys(t).map(async i=>{let o=(await this.localResourceUriConverter.asWebviewUri(t[i])).toString();return{moduleName:i,scriptUri:o,source:"local"}})):[]}async getBaseUrl(){let e=this.scriptManagerFactory.getOrCreate(this.kernel);if(!e.getBaseUrl)return;let t=await e.getBaseUrl();if(t)return this.localResourceUriConverter.asWebviewUri(t)}};var jz=require("vscode"),g0=class{constructor(e,t){this.id="remote";if(e.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"&&e.kernelConnectionMetadata.kind!=="startUsingRemoteKernelSpec")throw new Error("Invalid usage of this class, can only be used with remtoe kernels");this.kernelConnection=e.kernelConnectionMetadata,this.scriptManager=t.getOrCreate(e)}static{this.validUrls=new Map}dispose(){}async getBaseUrl(){return jz.Uri.parse(this.kernelConnection.baseUrl)}async getWidgetScriptSource(e){let r=(await this.getWidgetScriptSources()).find(i=>i.moduleName.toLowerCase()===e.toLowerCase());if(!r&&e.includes("/")){let i=await this.getBaseUrl();return{moduleName:e,scriptUri:`${i.toString()}${e}`,source:"remote"}}return r||{moduleName:e}}async getWidgetScriptSources(){let e=await this.scriptManager.getWidgetModuleMappings();return e&&Object.keys(e).length?await Promise.all(Object.keys(e).map(async r=>({moduleName:r,scriptUri:e[r].toString(),source:"remote"}))):[]}};var Ab=class{constructor(e,t,r){this.configurationSettings=e;this.widgetScriptManagerFactory=t;this.globalMemento=r}getProviders(e,t){let r=[];switch(r.push(new Ba(this.globalMemento,this.configurationSettings)),e.kernelConnectionMetadata.kind){case"connectToLiveRemoteKernel":case"startUsingRemoteKernelSpec":r.push(new g0(e,this.widgetScriptManagerFactory));break;default:r.push(new h0(e,t,this.widgetScriptManagerFactory))}return r}};Ab=v([(0,_p.injectable)(),m(0,(0,_p.inject)(oe)),m(1,(0,_p.inject)(s0)),m(2,(0,_p.inject)(We)),m(2,(0,_p.named)(dt))],Ab);var Bz=k(N()),Nb=require("vscode");var Mb=class{async getNbExtensionsParentPath(e){switch(e.kernelConnectionMetadata.kind){case"connectToLiveRemoteKernel":case"startUsingRemoteKernelSpec":return Nb.Uri.parse(e.kernelConnectionMetadata.baseUrl);case"startUsingPythonInterpreter":{let t=await Ps(e.kernelConnectionMetadata.interpreter);return t?Nb.Uri.joinPath(Nb.Uri.file(t),"share","jupyter"):void 0}case"startUsingLocalKernelSpec":{if(e.kernelConnectionMetadata.interpreter){let t=await Ps(e.kernelConnectionMetadata.interpreter);return t?Nb.Uri.joinPath(Nb.Uri.file(t),"share","jupyter"):void 0}return}default:return}}};Mb=v([(0,Bz.injectable)()],Mb);var _u=k(N());var Ff=require("vscode");var $F=require("vscode");var rQ=k(eQ());var tQ=["require.config({","requirejs?.config({","window.requirejs?.config({","requirejs.config({",'["require"].config({',"['require'].config({",'["requirejs"].config({',"['requirejs'].config({",'["require"]["config"]({',"['require']['config']({",'["requirejs"]["config"]({',"['requirejs']['config']({"];async function Zme(n,e,t){let r=[...tQ],i=await ot(e),o=0,s;for(;o<=0&&r.length&&(s=r.pop(),!!s);)o=t.indexOf(s);if(o<0){let f=[...tQ].map(g=>g.substring(0,g.length-2));for(;o<=0&&f.length&&(s=f.pop(),!!s);)o=t.indexOf(s)}if(o<0){T("DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",void 0,{widgetFolderNameHash:i,failed:!0,patternUsedToRegisterRequireConfig:s,failure:"couldNotLocateRequireConfigStart"});return}let a=t.indexOf(")",o);if(a<=0||!s){T("DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",void 0,{widgetFolderNameHash:i,failed:!0,patternUsedToRegisterRequireConfig:s,failure:"couldNotLocateRequireConfigEnd"});return}let l=t.indexOf("{",o),c=t.substring(l,a);c=(0,rQ.default)(c,{language:"javascript"}),c=Be(c,{trim:!0,removeEmptyEntries:!0}).join("");let u=c.split("{")[c.split("{").length-1].split("}")[0].split(",").map(f=>f.trim()).filter(f=>f.length&&f.includes(":")),d={};if(u.forEach(f=>{let g=f.split(":"),b=hm(g[0].replace(/\\r/g,"").replace(/\\n/g,"").trim()).trim(),I=hm(f.substring(f.indexOf(":")+1).replace(/\\r/g,"").replace(/\\n/g,"").trim()).trim();d[b]=I.startsWith("http")?$F.Uri.parse(I):$F.Uri.joinPath(n,I)}),!d||!Object.keys(d).length){T("DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",void 0,{widgetFolderNameHash:i,failed:!0,patternUsedToRegisterRequireConfig:s,failure:"noRequireConfigEntries"});return}return T("DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",{requireEntryPointCount:Object.keys(d).length},{widgetFolderNameHash:i,patternUsedToRegisterRequireConfig:s}),d}var Kb=class{constructor(e){this.kernel=e;this.disposables=[];e.onRestarted(this.onKernelRestarted,this,this.disposables)}dispose(){G(this.disposables)}async getWidgetModuleMappings(){return this.widgetModuleMappings||(this.widgetModuleMappings=this.getWidgetModuleMappingsImpl()),this.widgetModuleMappings}onKernelRestarted(){this.widgetModuleMappings=void 0}async getConfigFromWidget(e,t,r){let i=await this.getWidgetScriptSource(t);try{let o=await Zme(e,r,i);if(!o){let s=`Failed to extract require.config from widget for ${r} from ${M(t)}`;qn&&(s+=`with contents ${i}`),p.warn(s)}return o}catch(o){p.error(`Failed to extract require.config entry for ${r} from ${M(t)}`,o)}}async getWidgetModuleMappingsImpl(){let e=new Me,[t,r]=await Promise.all([this.getWidgetEntryPoints(),this.getNbExtensionsParentPath()]);if(!r)return;let o=(await Promise.all(t.map(s=>this.getConfigFromWidget(r,s.uri,s.widgetFolderName)))).reduce((s,a)=>Object.assign(s||{},a),{});return o&&Object.keys(o).length&&(delete o["jupyter-js-widgets"],delete o["@jupyter-widgets/base"],delete o["@jupyter-widgets/controls"],delete o["@jupyter-widgets/output"]),T("DS_INTERNAL.IPYWIDGET_DISCOVER_WIDGETS_NB_EXTENSIONS",{duration:e.elapsedTime},{type:at(this.kernel.kernelConnectionMetadata)?"local":"remote"}),o&&Object.keys(o).length?o:void 0}};var I0=class extends Kb{constructor(t,r,i,o){super(t);this.context=r;this.fs=i;this.connection=o;if(t.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"&&t.kernelConnectionMetadata.kind!=="startUsingRemoteKernelSpec")throw new Error("Invalid usage, can only be used for remote kernels");this.kernelConnection=t.kernelConnectionMetadata,this.getWidgetEntryPoints().catch(h)}getBaseUrl(){return this.getNbExtensionsParentPath()}async getNbExtensionsParentPath(){return Ff.Uri.parse(this.kernelConnection.baseUrl)}onKernelRestarted(){this.widgetEntryPointsPromise=void 0,super.onKernelRestarted()}async getWidgetEntryPoints(){return this.widgetEntryPointsPromise||(this.widgetEntryPointsPromise=this.getWidgetEntryPointsImpl()),this.widgetEntryPointsPromise}getCodeToExecute(){return this.code||(this.code=this.fs.readFile(Ff.Uri.joinPath(this.context.extensionUri,"pythonFiles","printJupyWidgetEntryPoints.py"))),this.code}async getWidgetEntryPointsImpl(){if(!Xe(this.kernelConnection))return[];let t=await this.getCodeToExecute();if(!this.kernel.session?.kernel)return p.ci("No Kernel session to get list of widget entry points"),[];let r=[];r.push(gn(this.kernel.session.kernel,t,{traceErrors:!0,traceErrorsMessage:"Failed to get widget entry points from remote kernel"})),!qn&&this.context.extensionMode===Ff.ExtensionMode.Production&&r.push(Hn(1e4).then(()=>[])),r.forEach(s=>s.catch(h));let i=await Promise.race(r);if(i.length===0)return p.ci("Unable to get widget entry points, no outputs after running the code"),[];let o=i[0];if(o.output_type!=="stream"||o.name!=="stdout")return p.ci("Unable to get widget entry points, no stream/stdout outputs after running the code"),[];try{return p.trace(`Widget Outputs include, ${o.text}`),o.text.trim().substring(1).slice(0,-1).split(",").map(a=>hm(a.trim()).replace(/\\\\/g,"/").replace(/\\/g,"/")).map(a=>({uri:Ff.Uri.joinPath(Ff.Uri.parse(this.kernelConnection.baseUrl),"nbextensions",a),widgetFolderName:it(a)}))}catch(s){return p.error(`Failed to parse output to get list of IPyWidgets, output is ${o.text}`,s),[]}}async getWidgetScriptSource(t){let r=this.getWidgetScriptSourceUsingHttpClient(t),i=this.getWidgetScriptSourceUsingFetch(t),o=r.catch(()=>i);return i.catch(s=>p.warn(`Failed to download widget script source from (fetch) ${t.toString(!0)}`,s)),r.catch(s=>p.error(`Failed to download widget script source from (httpclient) ${t.toString(!0)}`,s)),o.catch(h),o}async getWidgetScriptSourceUsingHttpClient(t){let r=t.toString(!0),o=await new Zl().downloadFile(r);if(o.status===200)return o.text();throw new Error(`Error downloading from ${r}: ${o.statusText}`)}async getWidgetScriptSourceUsingFetch(t){let r=await this.connection.createConnectionInfo(this.kernelConnection.serverProviderHandle),i=t.toString(!0),s=await new Zl(r.settings.fetch).downloadFile(i);if(s.status===200)return s.text();throw new Error(`Error downloading from ${i} using custom fetch: ${s.statusText}`)}};var Ob=require("vscode");var S0=class n extends Kb{constructor(t,r,i,o,s){super(t);this.fs=r;this.nbExtensionsPathProvider=i;this.context=o;this.jupyterPaths=s;this.overwriteExistingFiles=!0;this.overwriteExistingFiles=!n.nbExtensionsCopiedKernelConnectionList.has(t.kernelConnectionMetadata.id)}static{this.nbExtensionsCopiedKernelConnectionList=new Set}getBaseUrl(){return this.getNbExtensionsParentPath()}onKernelRestarted(){this.nbExtensionsParentPath=void 0,this.overwriteExistingFiles=!0,super.onKernelRestarted()}async getNbExtensionsParentPath(){return this.nbExtensionsParentPath||(this.nbExtensionsParentPath=this.getNbExtensionsParentPathImpl()),this.nbExtensionsParentPath}async getNbExtensionsParentPathImpl(){let t=this.overwriteExistingFiles;try{let r=new Me;if(this.sourceNbExtensionsPath=await this.nbExtensionsPathProvider.getNbExtensionsParentPath(this.kernel),!this.sourceNbExtensionsPath){p.warn(`No nbextensions folder found for kernel ${this.kernel.kernelConnectionMetadata.id}`);return}let i=await ot(this.kernel.kernelConnectionMetadata.id),o=Ob.Uri.joinPath(this.context.extensionUri,"temp","scripts",i,"jupyter"),s=Ob.Uri.joinPath(o,"nbextensions"),[a]=await Promise.all([this.jupyterPaths.getDataDirs({resource:this.kernel.resourceUri,interpreter:this.kernel.kernelConnectionMetadata.interpreter}),this.fs.createDirectory(s)]),l=a.map(c=>Ob.Uri.joinPath(c,"nbextensions"));l.reverse();for(let c of l)await this.fs.exists(c)&&await this.fs.copy(c,s,{overwrite:t});return this.overwriteExistingFiles=!1,n.nbExtensionsCopiedKernelConnectionList.add(this.kernel.kernelConnectionMetadata.id),T("DS_INTERNAL.IPYWIDGET_TIME_TO_COPY_NBEXTENSIONS_DIR",{duration:r.elapsedTime}),o}catch(r){throw T("DS_INTERNAL.IPYWIDGET_TIME_TO_COPY_NBEXTENSIONS_DIR",void 0,void 0,r),r}}async getWidgetEntryPoints(){let t=await this.getNbExtensionsParentPath();if(!t)return[];let r=Ob.Uri.joinPath(t,"nbextensions");return(await this.fs.searchLocal("**/extension.js",r.fsPath,!0)).map(o=>({uri:Ob.Uri.joinPath(r,o),widgetFolderName:it(o)}))}getWidgetScriptSource(t){return this.fs.readFile(t)}};var Fb=class{constructor(e,t,r,i,o,s){this.nbExtensionsPathProvider=e;this.fs=t;this.context=r;this.jupyterPaths=i;this.disposables=o;this.connection=s;this.managers=new WeakMap}getOrCreate(e){if(!this.managers.has(e))if(e.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel"||e.kernelConnectionMetadata.kind==="startUsingRemoteKernelSpec"){let t=new I0(e,this.context,this.fs,this.connection);this.managers.set(e,t),e.onDisposed(()=>t.dispose(),this,this.disposables)}else{let t=new S0(e,this.fs,this.nbExtensionsPathProvider,this.context,this.jupyterPaths);this.managers.set(e,t),e.onDisposed(()=>t.dispose(),this,this.disposables)}return this.managers.get(e)}};Fb=v([(0,_u.injectable)(),m(0,(0,_u.inject)(o0)),m(1,(0,_u.inject)(gr)),m(2,(0,_u.inject)(tt)),m(3,(0,_u.inject)(zr)),m(4,(0,_u.inject)(K)),m(5,(0,_u.inject)(un))],Fb);var C0=k(N()),$a=require("vscode");var Ys=class{constructor(e){this.disposables=[];e.push(this)}dispose(){G(this.disposables)}activate(){let e=new bs(1e3);this.disposables.push(e),$a.workspace.onDidChangeNotebookDocument(t=>{e.trigger(()=>this.onDidChangeNotebookDocument(t))},this,this.disposables)}onDidChangeNotebookDocument(e){St(e.notebook)&&e.cellChanges.some(t=>t.outputs&&t.outputs.some(r=>r.items&&r.items.some(i=>i.mime===zi)))&&this.checkRendererExtensionVersion()}checkRendererExtensionVersion(){if(!$a.workspace.isTrusted)return;let e=$a.extensions.getExtension(id);if(!e){this.displayNotInstalledMessage();return}let t=e.packageJSON.version;if(!t){this.displayUpdateMessage();return}let r=t.split("."),i=parseInt(r[0],10),o=parseInt(r[1],10),s=parseInt(r[2],10);(i<1||i===1&&o===0&&s<15)&&this.displayUpdateMessage()}displayNotInstalledMessage(){Ys.messageDisplayed||(Ys.messageDisplayed=!0,$a.window.showInformationMessage(y.rendererExtensionRequired,{modal:!0},ce.bannerLabelYes).then(e=>{e===ce.bannerLabelYes&&$a.commands.executeCommand("extension.open",id).then(h,h)}).then(h,h))}displayUpdateMessage(){Ys.messageDisplayed||(Ys.messageDisplayed=!0,$a.window.showInformationMessage(y.rendererExtension1015Required,{modal:!0},ce.bannerLabelYes).then(e=>{e===ce.bannerLabelYes&&$a.commands.executeCommand("extension.open",id).then(h,h)}).then(h,h))}};Ys.messageDisplayed=!1,Ys=v([(0,C0.injectable)(),m(0,(0,C0.inject)(K))],Ys);function nQ(n,e){n.addSingleton(ja,ja),n.addSingleton(i0,Ab),n.addSingleton(s0,Fb),n.addSingleton(o0,Mb),n.addSingleton(Ba,Ba),n.addSingleton(me,Ys)}var Lf=require("vscode");var iQ=k(N());var Ub=require("vscode");var Lb=class{constructor(e,t){this.notebook=e;this.disposables=[];Se.instance.get(He).onControllerSelected(i=>{i.notebook===this.notebook&&(i.controller.connection.kind!=="startUsingPythonInterpreter"||!i.controller.connection.interpreter||i.controller.connection.interpreter.id!==this.createdEnvId)&&this.cancelTokeSource.cancel()},this,this.disposables),this.cancelTokeSource=Wg(t)}dispose(){this.cancelTokeSource.dispose(),G(this.disposables)}async createPythonEnvFromKernelPicker(){let e,t=await this.createPythonEnvironment();if(this.cancelTokeSource.token.isCancellationRequested||t.action)return T("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{failed:!0,reason:"cancelled"}),{action:t.action||"Cancel"};if(!t.interpreter)return T("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{failed:!0,reason:"cancelled"}),{action:"Cancel"};e=t.interpreter,p.debug(`Python Environment created ${e.id}`);let r=await this.waitForPythonKernel(t.interpreter);if(this.cancelTokeSource.token.isCancellationRequested)return T("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{failed:!0,reason:"cancelled"}),{action:"Cancel"};if(!r)return T("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{failed:!0,reason:"kernelConnectionNotCreated"}),p.debug(`Python Environment ${e.id} not found as a kernel`),{action:"Cancel"};p.debug(`Python Environment ${e.id} found as a kernel ${r.kind}:${r.id}`);let o=await Se.instance.get(go).installMissingDependencies({resource:this.notebook.uri,kernelConnection:r,ui:new Mt(!1),token:this.cancelTokeSource.token,ignoreCache:!0,cannotChangeKernels:!0,installWithoutPrompting:!0}),s=!0;return o!==0&&(s=!1,p.warn(`Dependencies not installed for new Python Env ${M(e.uri)} for notebook ${M(this.notebook.uri)}`)),T("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{dependenciesInstalled:s,envType:Ue(t.interpreter)}),{kernelConnection:r}}async waitForPythonKernel(e){let r=Se.instance.get(Ar).registered.find(i=>i.kind==="localPythonEnvironment");if(r)return this.waitForPythonKernelFromFinder(e,r)}async waitForPythonKernelFromFinder(e,t){let r=t.kernels.find(i=>i.interpreter.id===e.id);return r||new Promise(i=>{let o=[];o.push(t.onDidChangeKernels(()=>{if(this.cancelTokeSource.token.isCancellationRequested)return;let s=t.kernels.find(a=>a.interpreter.id===e.id);if(s)return G(o),i(s)},this,this.disposables)),o.push(this.cancelTokeSource.token.onCancellationRequested(()=>{G(o)}))}).then(i=>{if(!this.cancelTokeSource.token.isCancellationRequested)return i||p.warn(`New Python Environment ${M(e.uri)} not found as a kernel`),i})}async createPythonEnvironment(){let e=Se.instance.get(rt),t=new Ub.CancellationTokenSource;try{let r=await Ub.commands.executeCommand("python.createEnvironment",{showBackButton:!0,selectEnvironment:!0,additionalPackages:["ipykernel"]});if(r?.action==="Cancel")return{action:"Cancel"};if(r?.action==="Back")return{action:"Back"};let i=r?.path;if(this.cancelTokeSource.token.isCancellationRequested)return{action:"Cancel"};if(!i)return p.warn("Python Environment not created, either user cancelled the creation or there was an error in the Python Extension"),{action:"Cancel"};this.createdEnvId=i,p.debug(`Python Environment created ${i}`);let o=await e.getInterpreterDetails({path:i});return this.cancelTokeSource.token.isCancellationRequested?{action:"Cancel"}:(o||p.warn(`No interpreter details for New Python Environment ${M(Ub.Uri.file(i))}`),this.createdEnvId=o?.id,{interpreter:o})}finally{t.cancel(),t.dispose()}}};var Wb=class{activate(){Lf.commands.registerCommand("jupyter.createPythonEnvAndSelectController",async()=>{let e=Lf.window.activeNotebookEditor;if(!e)return;let t=new or,r=t.add(new Lf.CancellationTokenSource).token,o=await t.add(new Lb(e.notebook,r)).createPythonEnvFromKernelPicker();if(!(!o||"action"in o))return await Lf.commands.executeCommand("notebook.selectKernel",{editor:e,id:o.kernelConnection.id,extension:_e}),o.kernelConnection.interpreter.id})}};Wb=v([(0,iQ.injectable)()],Wb);var Rp=k(N()),jr=require("vscode");var Vb=class{constructor(e,t,r,i,o){this.controllerRegistration=e;this.kernelFinder=t;this.notebookEditorProvider=r;this.kernelDependency=i;this.localDisposables=[];this.providerMappings=new Map;this.kernelSpecsSourceRegistered=!1;o.push(this)}dispose(){G(this.localDisposables)}activate(){if(!Lr()){this.localDisposables.push(jr.notebooks.registerKernelSourceActionProvider(It,{provideNotebookKernelSourceActions:()=>[{label:y.localPythonEnvironments,documentation:jr.Uri.parse("https://aka.ms/vscodeJupyterExtKernelPickerPythonEnv"),command:"jupyter.kernel.selectLocalPythonEnvironment"}]})),this.localDisposables.push(jr.notebooks.registerKernelSourceActionProvider(nr,{provideNotebookKernelSourceActions:()=>[{label:y.localPythonEnvironments,documentation:jr.Uri.parse("https://aka.ms/vscodeJupyterExtKernelPickerPythonEnv"),command:"jupyter.kernel.selectLocalPythonEnvironment"}]}));let t=[],r=new jr.EventEmitter;this.localDisposables.push(jr.notebooks.registerKernelSourceActionProvider(It,{onDidChangeNotebookKernelSourceActions:r.event,provideNotebookKernelSourceActions:()=>t})),this.localDisposables.push(jr.notebooks.registerKernelSourceActionProvider(nr,{onDidChangeNotebookKernelSourceActions:r.event,provideNotebookKernelSourceActions:()=>t}));let i=()=>{this.kernelSpecsSourceRegistered||this.kernelFinder.kernels.some(o=>_g(o))&&(this.kernelSpecsSourceRegistered=!0,t=[{label:y.localKernelSpecs,documentation:jr.Uri.parse("https://aka.ms/vscodeJupyterExtKernelPickerJupyterKernels"),command:"jupyter.kernel.selectLocalKernelSpec"}],r.fire())};i(),this.kernelFinder.onDidChangeKernels(()=>i(),this,this.localDisposables),this.localDisposables.push(jr.commands.registerCommand("jupyter.kernel.selectLocalKernelSpec",this.onSelectLocalKernel.bind(this,"localKernelSpec"),this)),this.localDisposables.push(jr.commands.registerCommand("jupyter.kernel.selectLocalPythonEnvironment",this.onSelectLocalKernel.bind(this,"localPythonEnvironment"),this))}this.localDisposables.push(jr.commands.registerCommand("jupyter.kernel.selectJupyterServerKernel",this.onSelectRemoteKernel,this)),Se.instance.get(Jt).onDidChangeCollections(this.registerUriCommands,this,this.localDisposables),this.registerUriCommands()}registerUriCommands(){let e=Se.instance.get(Jt),t=new Set;e.jupyterCollections.map(r=>{let i=`${r.extensionId}:${r.id}`;if(r.id===SP||(t.add(i),this.providerMappings.has(i)))return;let o=jr.notebooks.registerKernelSourceActionProvider(It,{provideNotebookKernelSourceActions:()=>[{get label(){return r.label},get documentation(){return r.documentation},command:{command:"jupyter.kernel.selectJupyterServerKernel",arguments:[r.extensionId,r.id],title:r.label}}]}),s=jr.notebooks.registerKernelSourceActionProvider(nr,{provideNotebookKernelSourceActions:()=>[{get label(){return r.label},get documentation(){return r.documentation},command:{command:"jupyter.kernel.selectJupyterServerKernel",arguments:[r.extensionId,r.id],title:r.label}}]});this.localDisposables.push(o),this.localDisposables.push(s),this.providerMappings.set(i,{disposables:[o,s],provider:r})}),this.providerMappings.forEach(({disposables:r},i)=>{t.has(i)||(G(r),this.providerMappings.delete(i))})}async onSelectLocalKernel(e,t){if(t=t||jr.window.activeNotebookEditor?.notebook,!!t)if(e==="localPythonEnvironment"){let i=await Se.instance.get(Fm).selectLocalKernel(t);return this.getSelectedController(t,i)}else{let i=await Se.instance.get(Sx).selectLocalKernel(t);return this.getSelectedController(t,i)}}async onSelectRemoteKernel(e,t,r){if(r=r||jr.window.activeNotebookEditor?.notebook,!r&&jr.window.activeTextEditor&&(r=this.notebookEditorProvider.findNotebookEditor(jr.window.activeTextEditor.document.uri)?.notebook),!r)return;let i=`${e}:${t}`,o=this.providerMappings.get(i)?.provider;if(!o)return;let a=await Se.instance.get(Ix).selectRemoteKernel(r,o);return this.getSelectedController(r,a)}async getSelectedController(e,t){if(!t)return;let r=this.controllerRegistration.addOrUpdate(t,[e.notebookType]);if(!Array.isArray(r)||r.length===0){p.warn(`No controller created for selected kernel connection ${t.kind}:${t.id}`);return}Ca(e.uri,t).finally(()=>Ct(e.uri,"DS_INTERNAL.SWITCH_KERNEL",void 0,{newKernelPicker:!0})).catch(h),r.find(o=>o.viewType===e.notebookType)?.controller.updateNotebookAffinity(e,jr.NotebookControllerAffinity.Preferred);let i=r[0];return await this.onControllerSelected(e,i),i.controller.id}async onControllerSelected(e,t){if(W$(e),at(t.connection)&&Xe(t.connection)&&qr(t.connection.interpreter)&&!Lr()){let r=[];try{let i=new jr.CancellationTokenSource;r.push(i);let o=new Mt(!1);r.push(o),await this.kernelDependency.installMissingDependencies({resource:e.uri,kernelConnection:t.connection,token:i.token,ui:o,cannotChangeKernels:!0,ignoreCache:!0,installWithoutPrompting:!0})}catch(i){p.error(`Failed to install missing dependencies for Conda kernel ${t.connection.id}`,i)}finally{G(r)}}}};Vb=v([(0,Rp.injectable)(),m(0,(0,Rp.inject)(He)),m(1,(0,Rp.inject)(Ar)),m(2,(0,Rp.inject)(Fn)),m(3,(0,Rp.inject)(go)),m(4,(0,Rp.inject)(K))],Vb);var Uf=k(N()),P0=require("vscode");var dc=require("vscode");var Iw=require("vscode");var Ap=class{constructor(e){this.jupyterConnection=e;this.disposables=[]}dispose(){G(this.disposables)}async findPreferredRemoteKernelConnection(e,t,r){return this.findPreferredRemoteKernelConnectionImpl(e,t,r,!1)}async findPreferredRemoteKernelConnectionImpl(e,t,r,i){let o=await Se.instance.get(rs).getPreferredRemoteKernelId(e),s=async()=>{let l=t.kernels.find(u=>u.kind==="connectToLiveRemoteKernel"&&u.id===o);if(l)return l;if(t.status==="idle")return;let c=await new Promise(u=>t.onDidChangeKernels(()=>{let d=t.kernels.find(f=>f.kind==="connectToLiveRemoteKernel"&&f.id===o);d&&u(d),(t.status==="idle"||r.isCancellationRequested)&&u(void 0)},this,this.disposables));if(c)return c};if(o){let l=await s();if(l||i)return l}let a=t.kernels.find(l=>Dt(l))?.serverProviderHandle;if(a){let l=await this.jupyterConnection.createConnectionInfo(a),c=(e.uri,void 0),u=c&&t.kernels.find(d=>Dt(d)&&d.kind==="connectToLiveRemoteKernel"&&d.kernelModel.model&&d.kernelModel.model.path===c.path&&d.kernelModel.model.name===c.name);if(u)return u}return this.findPreferredKernelSpecConnection(e,t,r,i)}async findPreferredLocalKernelSpecConnection(e,t,r){return this.findPreferredKernelSpecConnection(e,t,r,!1)}async findPreferredKernelSpecConnection(e,t,r,i){let s=Mi(e)?.kernelspec?.name,a=()=>{let u=s?t.kernels.filter(f=>(f.kind==="startUsingLocalKernelSpec"||f.kind==="startUsingRemoteKernelSpec")&&f.kernelSpec.name===s):[];if(u.length||i)return u;let d=u0(e);if(d)return t.kernels.filter(f=>(f.kind==="startUsingLocalKernelSpec"||f.kind==="startUsingRemoteKernelSpec")&&f.kernelSpec.language&&(f.kernelSpec.language===d||Tl(f.kernelSpec.language)===Tl(d)))},l=a();if(Array.isArray(l)&&l.length)return i&&l.length>1?void 0:l[0];if(t.status==="idle")return;let c=[];return new Promise(u=>t.onDidChangeKernels(()=>{if(r.isCancellationRequested)return u(void 0);let d=a();if(Array.isArray(d)&&d.length)return i&&d.length>1?u(void 0):u(d[0]);t.status==="idle"&&u(void 0)},this,this.disposables)).finally(()=>G(c))}async findPreferredPythonKernelConnection(e,t,r){return this.findPreferredPythonKernelConnectionImpl(e,t,r)}async findPreferredPythonKernelConnectionImpl(e,t,r){t=t||Se.instance.get(Ar).registered.find(c=>c.kind==="localPythonEnvironment");let i=Se.instance.get(rt),o=JF(e,t);if(o)return o;let s=await i.getActiveInterpreter(e.uri);if(!s){let c=Iw.workspace.getConfiguration("python").get("defaultInterpreterPath");if(s=c?await i.getInterpreterDetails(c,r):void 0,!s)return}let a=()=>{if(!r.isCancellationRequested)return t.kernels.filter(c=>c.kind==="startUsingPythonInterpreter").map(c=>c).find(c=>c.interpreter.id===s.id)},l=a();if(l)return l;if(t.status==="discovering")return await new Promise(c=>{t.onDidChangeStatus(()=>t.status==="idle"&&c(),this,this.disposables),t.onDidChangeKernels(()=>(JF(e,t)||a())&&c(),this,this.disposables)}),JF(e,t)||a()}};function JF(n,e){let t=Iw.workspace.getWorkspaceFolder(n.uri)?.uri||(Iw.workspace.workspaceFolders?.length===1?Iw.workspace.workspaceFolders[0].uri:void 0),r=oQ(Nn(n.uri),e);if(r)return r;if(t)return oQ(t,e)}function oQ(n,e){let r=e.kernels.filter(a=>a.kind==="startUsingPythonInterpreter").map(a=>a).filter(a=>Ig(mr(a.interpreter)?.environment?.folderUri?.fsPath||a.interpreter.uri.fsPath,n.fsPath)),i=r.find(a=>Ue(a.interpreter)==="Venv"&&Vo(a.interpreter)?.toLowerCase()===".venv");if(i)return i;let o=r.find(a=>Ue(a.interpreter)==="Conda"&&Vo(a.interpreter)?.toLowerCase()===".venv");if(o)return o;let s=r.find(a=>Vo(a.interpreter)?.toLowerCase()===".venv");return s||(r.length?r[0]:void 0)}var E0=class{constructor(e,t,r,i,o){this.notebook=e;this.pythonEnvFilter=i;this.connection=o;this._onDidRefresh=new dc.EventEmitter;this.onDidRefresh=this._onDidRefresh.event;this._onDidChange=new dc.EventEmitter;this.onDidChange=this._onDidChange.event;this.kernels=[];this._onDidChangeStatus=new dc.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this._onDidChangeRecommended=new dc.EventEmitter;this.onDidChangeRecommended=this._onDidChangeRecommended.event;this._onDidFailToListKernels=new dc.EventEmitter;this.onDidFailToListKernels=this._onDidFailToListKernels.event;this.status="idle";this.disposables=[];this.refresh=async()=>{this.refreshInvoked=!0},this.title=y.kernelPickerSelectKernelTitle,this.kind=t,this.disposables.push(this._onDidRefresh),sd(r)?r.then(s=>this.setupFinder(s)).catch(s=>p.error(`Failed to setup finder for ${this.title}`,s)):this.setupFinder(r)}dispose(){G(this.disposables)}setupFinder(e){switch(this.refresh=async()=>e.refresh(),this.status!==e.status&&!this.refreshInvoked&&(this.status=e.status,this._onDidChangeStatus.fire()),this.refreshInvoked?e.refresh().catch(i=>p.error(`Failed to refresh finder for ${this.title}`,i)):e.kind==="remote"&&e.status==="idle"&&this.filteredKernels(e.kernels).length===0&&e.refresh().catch(i=>p.error(`Failed to refresh finder for ${this.title}`,i)),e.kind){case"localKernelSpec":this.title=y.kernelPickerSelectLocalKernelSpecTitle;break;case"localPythonEnvironment":this.title=y.quickPickSelectPythonEnvironmentTitle;break;default:this.title=y.kernelPickerSelectKernelFromRemoteTitle(e.displayName);break}e.onDidChangeKernels(()=>{this.kernels.length=0,this.kernels.push(...this.filteredKernels(e.kernels)),this._onDidChange.fire()},this,this.disposables),e.onDidChangeStatus(()=>{this.status=e.status,this._onDidChangeStatus.fire(),this.status==="idle"&&e.lastError&&this.filteredKernels(e.kernels).length===0&&(this.kernels.length=0,this._onDidFailToListKernels.fire(e.lastError))}),this.kernels.length=0,this.kernels.push(...this.filteredKernels(e.kernels)),this._onDidChange.fire(),this._onDidChangeStatus.fire();let t=new dc.CancellationTokenSource;this.disposables.push(new dc.Disposable(()=>t.cancel())),this.disposables.push(t);let r=new Ap(this.connection);this.disposables.push(r),e.kind==="remote"?this.computePreferredRemoteKernel(e,r,t.token):this.computePreferredLocalKernel(e,r,t.token)}filteredKernels(e){let t=this.pythonEnvFilter;return t?e.filter(r=>r.kind!=="startUsingPythonInterpreter"||!t.isPythonEnvironmentExcluded(r.interpreter)):e}computePreferredRemoteKernel(e,t,r){t.findPreferredRemoteKernelConnection(this.notebook,e,r).then(i=>{this.recommended=i,this._onDidChangeRecommended.fire()}).catch(i=>p.error(`Preferred connection failure ${M(this.notebook.uri)}`,i))}computePreferredLocalKernel(e,t,r){let i=()=>{this.recommended&&!this.kernels.find(s=>s.id===this.recommended?.id)&&(this.recommended=void 0),(e.kind==="localKernelSpec"?t.findPreferredLocalKernelSpecConnection.bind(t):t.findPreferredPythonKernelConnection.bind(t))(this.notebook,e,r).then(s=>{this.recommended?.id!==s?.id&&(this.recommended=s,this._onDidChangeRecommended.fire())}).catch(s=>p.error(`Preferred connection failure ${M(this.notebook?.uri)}`,s))};i(),e.onDidChangeKernels(i,this,this.disposables)}};var Np=require("vscode");function pc(n){return"connection"in n}function efe(n){return"command"in n}function tfe(n,e,t){let r=t?[t]:n.activeItems.length?[n.activeItems[0]]:[];if(r.length&&!e.includes(r[0])){let i=r[0],o=pc(i)&&e.find(s=>pc(s)&&s.connection.id===i.connection.id);o?r[0]=o:r.length=0}n.items=e,n.activeItems=r}var qF=class extends Error{},w0=class extends Qt{constructor(t,r){super();this.provider=t;this.token=r;this.recommendedItems=[];this.existingItems=new Set;this.quickPickItems=[];this.displayDataProvider=Se.instance.get(Ad)}async selectKernel(t){return this.selectKernelImpl(t,{quickPick:void 0})}async selectKernelImpl(t,r){if(this.token.isCancellationRequested)return;let i=this.provider.kernels.map(o=>this.connectionToQuickPick(o));return this.quickPickItems.push({kind:Np.QuickPickItemKind.Separator,label:y.kernelCategoryForJupyterKernel}),i.sort((o,s)=>o.label.localeCompare(s.label)),this.quickPickItems.push(...i),this.existingItems=new Set(i),this.selectKernelImplInternal(t,r)}async selectKernelImplInternal(t,r){let i={iconPath:new Np.ThemeIcon("refresh"),tooltip:ce.refresh},o={iconPath:new Np.ThemeIcon("loading~spin"),tooltip:ce.refreshing},{quickPick:s,selection:a}=t({title:this.provider.title,items:this.quickPickItems,buttons:[i],onDidTriggerButton:async u=>{if(u===i){let d=s.buttons;s.buttons=d.filter(f=>f!==i).concat(o),await this.provider.refresh().catch(h),s.buttons=d}}});r.quickPick=s,this.provider.status==="discovering"&&(s.busy=!0);let l;this._register(this.provider.onDidChangeStatus(()=>{switch(l&&clearTimeout(l),this.provider.status){case"discovering":s.busy=!0;break;case"idle":l=setTimeout(()=>s.busy=!1,500),this._register(new Np.Disposable(()=>l&&clearTimeout(l)));break}},this)),this.updateRecommended(s),this.updateQuickPickItems(s),this._register(this.provider.onDidChangeRecommended(()=>this.updateRecommended(s),this)),this._register(this.provider.onDidChange(()=>this.updateQuickPickItems(s),this));let c=await a;if(!this.token.isCancellationRequested){if(efe(c))try{let u=await c.command();return u?{selection:"controller",connection:u}:void 0}catch(u){if(u instanceof qF)return{selection:"userPerformedSomeOtherAction"};if(u===De.back)return this.selectKernelImplInternal(t,r);throw u}if(c&&"connection"in c)return{selection:"controller",connection:c.connection};if(c&&"error"in c)throw De.back}}updateQuickPickItems(t){t.title=this.provider.title;let r=new Set(t.items.filter(u=>pc(u)).map(u=>u).map(u=>u.connection.id)),i=this.provider.kernels.filter(u=>!r.has(u.id)).map(u=>this.connectionToQuickPick(u));this.updateQuickPickWithLatestConnection(t),this.removeMissingKernels(t),this.updateRecommended(t),i.sort((u,d)=>u.label.localeCompare(d.label));let o=0,s=this.existingItems,a=new Map(Array.from(s).map(u=>[u.connection.id,u])),l=s.size;i.forEach(u=>{let d=a.get(u.connection.id);d&&s.delete(d),s.add(u)});let c=Array.from(s);c.sort((u,d)=>u.label.localeCompare(d.label)),this.quickPickItems.splice(o+1,l,...c),this.rebuildQuickPickItems(t)}rebuildQuickPickItems(t){let r=this.recommendedItems.find(a=>pc(a)),i=new Set(this.recommendedItems.filter(pc).map(a=>a.connection.id)),o=this.quickPickItems.filter(a=>!pc(a)||!i.has(a.connection.id)),s=t.activeItems.length?t.activeItems[0]:void 0;r&&pc(r)&&s&&(pc(s)?s.connection.id!==r.connection.id&&(r=void 0):r=void 0),tfe(t,this.recommendedItems.concat(o),r)}removeMissingKernels(t){let r=t.items.filter(s=>pc(s)).map(s=>s).map(s=>s.connection.id),i=new Map(this.provider.kernels.map(s=>[s.id,s])),o=r.filter(s=>!i.has(s));if(o.length){let s=[];this.existingItems.forEach(a=>{o.includes(a.connection.id)&&(this.existingItems.delete(a),s.push(a))}),this.quickPickItems=this.quickPickItems.filter(a=>!s.includes(a)),this.rebuildQuickPickItems(t)}}updateRecommended(t){if(!this.provider.recommended){this.recommendedItems.length=0;return}this.recommendedItems.length||this.recommendedItems.push({label:y.recommendedItemCategoryInQuickPick,kind:Np.QuickPickItemKind.Separator});let r=this.connectionToQuickPick(this.provider.recommended,!0);this.recommendedItems.length===2?this.recommendedItems[1]=r:this.recommendedItems.push(r),this.rebuildQuickPickItems(t)}updateQuickPickWithLatestConnection(t){let r=new Map(this.provider.kernels.map(i=>[i.id,i]));this.recommendedItems.concat(this.quickPickItems).forEach(i=>{if(!pc(i)||!r.has(i.connection.id))return;let o=r.get(i.connection.id);o&&(i.label=this.connectionToQuickPick(o,i.isRecommended).label,i.tooltip=this.connectionToQuickPick(o,i.isRecommended).tooltip,i.detail=this.connectionToQuickPick(o,i.isRecommended).detail,i.description=this.connectionToQuickPick(o,i.isRecommended).description,i.isRecommended=this.connectionToQuickPick(o,i.isRecommended).isRecommended,i.connection=o)}),this.rebuildQuickPickItems(t)}connectionToQuickPick(t,r=!1){let i=r?"$(star-full) ":"",o=(l,c,u)=>{l.label=`${i}${c.label}`,l.detail=c.detail,l.description=c.description,this.quickPickItems.forEach(d=>{"connection"in d&&d.connection.id===u.id&&(d.label=c.label,d.detail=c.detail,d.description=c.description)})},s=this.displayDataProvider.getDisplayData(t),a={label:"",detail:"",description:"",isRecommended:r,connection:t};return o(a,s,t),this._register(s.onDidChange(l=>o(a,l,t),this)),a}};var jb=class{constructor(e,t,r,i){this.kernelFinder=e;this.multiStepFactory=t;this.pythonEnvFilter=r;this.jupyterConnection=i;this.localDisposables=[]}async selectLocalKernel(e){if(e.notebookType!==It&&e.notebookType!==nr)return;this.localDisposables.forEach(o=>o.dispose()),this.localDisposables=[],this.cancellationTokenSource?.cancel(),this.cancellationTokenSource?.dispose(),this.cancellationTokenSource=new P0.CancellationTokenSource;let t=this.multiStepFactory.create(),r={disposables:[],notebook:e},i=this.kernelFinder.registered.find(o=>o.id==="localKernelSpec");try{if(await t.run(this.selectKernelFromKernelFinder.bind(this,i,this.cancellationTokenSource.token,t,r),r)===De.cancel||r.selection?.type==="userPerformedSomeOtherAction")throw new P0.CancellationError;if(this.cancellationTokenSource.token.isCancellationRequested){G(r.disposables);return}if(r.selection?.type==="connection")return r.selection.connection}finally{G(r.disposables)}}selectKernelFromKernelFinder(e,t,r,i){let o=new E0(i.notebook,e.kind,e,this.pythonEnvFilter,this.jupyterConnection);return i.disposables.push(o),this.selectKernel(o,t,r,i)}async selectKernel(e,t,r,i){if(t.isCancellationRequested)return;let o=new w0(e,t);i.disposables.push(o);let s=l=>{let{quickPick:c,selection:u}=r.showLazyLoadQuickPick({...l,placeholder:"",matchOnDescription:!0,matchOnDetail:!0,supportBackInFirstStep:!0,activeItem:void 0,ignoreFocusOut:!1});return{quickPick:c,selection:u}},a=await o.selectKernel(s);a?.selection==="controller"?i.selection={type:"connection",connection:a.connection}:a?.selection==="userPerformedSomeOtherAction"&&(i.selection={type:"userPerformedSomeOtherAction"})}};jb=v([(0,Uf.injectable)(),m(0,(0,Uf.inject)(Ar)),m(1,(0,Uf.inject)(oD)),m(2,(0,Uf.inject)(fi)),m(3,(0,Uf.inject)(un))],jb);var Ru=k(N()),Au=require("vscode");var Tu=require("vscode");var k0=class extends Qt{constructor(t,r){super();this.notebook=t;this.token=r;let i=Se.instance.get(fi),o=Se.instance.get(qe),s=Se.instance.get(tr),a=Se.instance.get(jg);this.provider=Se.instance.get(Us).withFilter(b=>!i.isPythonEnvironmentExcluded(b)),this.pythonEnvPicker=this._register(new cp(Promise.resolve(this.provider),u_,d_,{supportsBack:!0},void 0,y.quickPickSelectPythonEnvironmentTitle));let l,c=()=>{if(l)return;let b=(Tu.workspace.workspaceFolders||[])?.length>0,I=!this.pythonEnvPicker.recommended&&b;l=this.pythonEnvPicker.addCommand({label:`$(add) ${y.createPythonEnvironmentInQuickPick}`},this.createNewEnvironment.bind(this),I)};this.provider.items.length&&c();let u={dispose:h},d=this._register(this.provider.onDidChange(()=>{this.provider.items.length&&(c(),u.dispose(),d.dispose())}));this.provider.refresh().finally(()=>{this.provider.items.length||(u=this.pythonEnvPicker.addCommand({label:y.installPythonQuickPickTitle,tooltip:y.installPythonQuickPickToolTip,description:y.pleaseReloadVSCodeOncePythonHasBeenInstalled},()=>{throw setTimeout(()=>Tu.commands.executeCommand(J.InstallPythonViaKernelPicker).then(h,h)),new Tu.CancellationError}))}).catch(h);let f=async()=>{!this.pythonApi||r.isCancellationRequested||(this.pythonEnvPicker.recommended=await q$(this.notebook,this.pythonApi,i,a),l?.dispose(),l=void 0,c())},g=b=>{b&&(this.pythonApi=b,f(),this._register(b.environments.onDidChangeActiveEnvironmentPath(f)),this._register(b.environments.onDidChangeEnvironments(f)))};o.isPythonExtensionInstalled?s.getNewApi().then(g).catch(h):this._register(o.onPythonExtensionInstallationStatusChanged(()=>s.getNewApi().then(g),this)),f()}async selectKernel(){let t=ne();Tu.extensions.getExtension(sn)||Tu.commands.executeCommand(J.InstallPythonExtensionViaKernelPicker).then(l=>{l===!0?this.provider.refresh().catch(h):t.resolve()},l=>{p.error("Failed to install the Python extension",l),t.resolve()});let r=await Promise.race([this.pythonEnvPicker.selectItem(this.token),t.promise]);if(!r||r instanceof De)return r||De.cancel;let i=Se.instance.get(rt),o=Se.instance.get(zr),s=await i.getInterpreterDetails(r.path);if(!s)return De.cancel;let a=await Ns(s,await o.getKernelSpecTempRegistrationFolder());return $o.create({kernelSpec:a,interpreter:s,id:Oi(a,s)})}async createNewEnvironment(){let t=Se.instance.get(tr);if(!Se.instance.get(qe).isPythonExtensionInstalled)return;let o=await this._register(new Lb(this.notebook,this.token)).createPythonEnvFromKernelPicker();return o?"action"in o?o.action==="Back"?De.back:De.cancel:(await t.getNewApi())?.environments.known.find(a=>a.id===o.kernelConnection.interpreter.id):De.cancel}};var Bb=class extends Yn{constructor(t,r,i,o,s,a){super();this.pythonApi=r;this.filter=i;this.jupyterPaths=o;this.checker=s;this.kind="localPythonEnvironment";this.id="localPythonEnvironment";this.displayName=y.localPythonEnvironments;this._onDidChangeKernels=this._register(new Au.EventEmitter);this.onDidChangeKernels=this._onDidChangeKernels.event;this._kernels=new Map;this._onDidChangeStatus=this._register(new Au.EventEmitter);this._status="idle";this.promiseMonitor=new ho;this.onDidChangeStatus=this._onDidChangeStatus.event;this.previousCancellationTokens=[];this.apiHooked=!1;t.push(this),a.registerKernelFinder(this)}get status(){return this._status}set status(t){this._status=t,this._onDidChangeStatus.fire()}get kernels(){return Array.from(this._kernels.values())}activate(){this._register(this.promiseMonitor.onStateChange(()=>this.status=this.promiseMonitor.isComplete?"idle":"discovering",this)),this.checker.isPythonExtensionInstalled?(this.getKernelSpecsDir().catch(h),this.hookupPythonApi().catch(h)):this._register(this.checker.onPythonExtensionInstallationStatusChanged(()=>{this.checker.isPythonExtensionInstalled&&(this.getKernelSpecsDir().catch(h),this.hookupPythonApi().catch(h))},this))}async selectLocalKernel(t){let r=new Au.CancellationTokenSource,i=[r];try{let o=new k0(t,r.token);i.push(o);let s=await o.selectKernel();if(s instanceof Error){if(s instanceof De&&s===De.back)return;throw new Au.CancellationError}return this.addUpdateKernel(s),s}finally{G(i)}}async getKernelConnection(t){let r=Se.instance.get(rt),i=Se.instance.get(zr),o=await r.getInterpreterDetails(t.path);if(!o){p.warn(`Python Env ${M(t.id)} not found}`);return}if(!o||this.filter.isPythonEnvironmentExcluded(o)){p.warn(`Python Env hidden via filter: ${M(o.id)}`);return}let s=await Ns(o,await i.getKernelSpecTempRegistrationFolder()),a=$o.create({kernelSpec:s,interpreter:o,id:Oi(s,o)}),l=this._kernels.get(a.id);return l||(this.addUpdateKernel(a),a)}addUpdateKernel(t){let r=this._kernels.get(t.id);r?(r.updateInterpreter(t.interpreter),this._kernels.set(t.id,Object.assign(r,t)),this._onDidChangeKernels.fire({})):(this._kernels.set(t.id,t),this._onDidChangeKernels.fire({}))}async refresh(){this.previousCancellationTokens.forEach(t=>t.cancel()),G(this.previousCancellationTokens),this.previousCancellationTokens=[],this._kernels.clear(),this.pythonApi.getNewApi().then(t=>{t&&(this.promiseMonitor.push(t.environments.refreshEnvironments({forceRefresh:!0}).catch(h)),t.environments.known.forEach(r=>this.buildDummyEnvironment(r).catch(h)))}).catch(h)}getKernelSpecsDir(){return this.tempDirForKernelSpecs||(this.tempDirForKernelSpecs=this.jupyterPaths.getKernelSpecTempRegistrationFolder()),this.tempDirForKernelSpecs}async hookupPythonApi(){if(this.apiHooked)return;this.apiHooked=!0;let t=await this.pythonApi.getNewApi();if(!t)return;t.environments.known.map(i=>this.buildDummyEnvironment(i).catch(h));let r=this._register(new Uh);this._register(t.environments.onDidChangeEnvironments(i=>{if(i.type==="remove"){let s=setTimeout(()=>{p.trace(`Python API env change detected & Kernel removed after 30000, ${i.type} => '${i.env.id}'`);let a=this._kernels.get(i.env.id);a&&(this._kernels.delete(i.env.id),this._onDidChangeKernels.fire({removed:[a]}))},3e4);r.set(i.env.id,new Au.Disposable(()=>clearTimeout(s)))}else r.deleteAndDispose(i.env.id),this.buildDummyEnvironment(i.env).catch(h)},this))}async buildDummyEnvironment(t){let r=G$(t);if(!r||this.filter.isPythonEnvironmentExcluded(r))return;let i=await Ns(r,await this.getKernelSpecsDir()),o=$o.create({kernelSpec:i,interpreter:r,id:Oi(i,r)});this._kernels.get(t.id)||(this._kernels.set(t.id,o),this._onDidChangeKernels.fire({}))}};Bb=v([(0,Ru.injectable)(),m(0,(0,Ru.inject)(K)),m(1,(0,Ru.inject)(tr)),m(2,(0,Ru.inject)(fi)),m(3,(0,Ru.inject)(zr)),m(4,(0,Ru.inject)(qe)),m(5,(0,Ru.inject)(Ar))],Bb);var mc=k(N()),Wn=require("vscode");function x0(n){return n===_e||n===Dh}var $b=class{constructor(e,t,r,i,o,s,a){this.kernelFinder=e;this.serverUriStorage=t;this.serverSelector=r;this.jupyterConnection=i;this.displayDataProvider=o;this.kernelFinderController=s;this.jupyterServerRegistry=a;this.localDisposables=[]}async selectRemoteKernel(e,t){if(e.notebookType!==It&&e.notebookType!==nr)return;this.localDisposables.forEach(o=>o.dispose()),this.localDisposables=[],this.cancellationTokenSource?.cancel(),this.cancellationTokenSource?.dispose(),this.cancellationTokenSource=new Wn.CancellationTokenSource;let r=new lE,i={disposables:[],notebook:e};try{if(await r.run(this.getRemoteServersFromProvider.bind(this,t,this.cancellationTokenSource.token),i)===De.cancel||i.selection?.type==="userPerformedSomeOtherAction")throw new Wn.CancellationError;if(this.cancellationTokenSource.token.isCancellationRequested){G(i.disposables);return}if(i.selection?.type==="connection")return i.selection.connection}finally{G(i.disposables)}}async getRemoteServersFromProvider(e,t,r,i){let o=this.kernelFinder.registered.filter(R=>R.kind==="remote"),s=[],a=[],l=[],c=this.jupyterServerRegistry.jupyterCollections.find(R=>R.extensionId===e.extensionId&&R.id===e.id)?.serverProvider,u=c?.provideJupyterServers?Promise.resolve(c.provideJupyterServers.bind(c)(t)).then(R=>R||[]):Promise.resolve([]),d=new Set,f=await u,g=new Set(f.map(R=>R.id));if(o.filter(R=>R.serverProviderHandle.id===e.id).filter(R=>g.has(R.serverProviderHandle.id)).map(R=>{let V=this.serverUriStorage.all.find(ie=>Lt(ie.provider)===Lt(R.serverProviderHandle));d.add(Lt(R.serverProviderHandle)),l.push({server:R,time:V?.time})}),l.sort((R,V)=>!R.time&&!V.time?R.server.displayName.localeCompare(V.server.displayName):!R.time&&V.time?1:R.time&&!V.time||(R.time||0)>(V.time||0)?-1:1),l.filter(({time:R})=>(R||0)>0).forEach(({server:R,time:V})=>{s.push({type:"finder",kernelFinderInfo:R,idAndHandle:R.serverProviderHandle,label:R.displayName,description:V?y.jupyterServerLastConnectionForQuickPickDescription(new Date(V)):void 0,buttons:c?.removeJupyterServer&&x0(e.extensionId)?[{iconPath:new Wn.ThemeIcon("close"),tooltip:y.removeRemoteJupyterServerEntryInQuickPick}]:[]})}),l.filter(({time:R})=>!R).forEach(({server:R})=>{s.push({type:"finder",kernelFinderInfo:R,idAndHandle:R.serverProviderHandle,label:R.displayName,buttons:c?.removeJupyterServer&&x0(e.extensionId)?[{iconPath:new Wn.ThemeIcon("close"),tooltip:y.removeRemoteJupyterServerEntryInQuickPick}]:[]})}),f.sort((R,V)=>R.label.localeCompare(V.label)).forEach(R=>{let V=Lt({extensionId:e.extensionId,id:e.id,handle:R.id});d.has(V)||s.push({type:"jupyterServer",label:R.label,idAndHandle:{extensionId:e.extensionId,id:e.id,handle:R.id},server:R,buttons:c?.removeJupyterServer&&x0(e.extensionId)?[{iconPath:new Wn.ThemeIcon("close"),tooltip:y.removeRemoteJupyterServerEntryInQuickPick}]:[]})}),e.commandProvider){let R=(await Promise.resolve(e.commandProvider.provideCommands(void 0,t))||[]).map(V=>({...V,provider:e,type:"uriProviderQuickPick",command:V}));s.length>0&&R.length&&a.push({label:"",kind:Wn.QuickPickItemKind.Separator}),a.push(...R)}let b=s.concat(a),I=new Wn.EventEmitter,w=b.length===1&&"command"in b[0]&&b[0].command.canBeAutoSelected?b[0]:void 0;if(c){let R=b.filter(V=>"type"in V);R.length===1&&R.every(V=>V.type!=="uriProviderQuickPick")?w=R[0]:R.every(V=>V.type==="uriProviderQuickPick")&&R.filter(V=>V.picked).length===1&&(w=b.filter(V=>V.picked)[0])}let _,A;if(w)A=w;else{let{quickPick:R,selection:V}=r.showLazyLoadQuickPick({items:b,placeholder:e.extensionId===_e||e.extensionId===Dh?y.enterOrSelectRemoteJupyterPlaceholder:y.selectRemoteJupyterPlaceholder,title:y.quickPickTitleForSelectionOfJupyterServer,supportBackInFirstStep:!0,onDidTriggerItemButton:async ie=>{if("type"in ie.item&&(ie.item.type==="finder"||ie.item.type==="jupyterServer")){let Q=ie.item.idAndHandle.handle,te=f.find(ae=>ae.id===Q);c?.removeJupyterServer&&te&&x0(e.extensionId)&&(R.busy=!0,this.serverUriStorage.remove({extensionId:e.extensionId,id:e.id,handle:Q}).catch(h),await c.removeJupyterServer(te),R.busy=!1,b.splice(b.indexOf(ie.item),1),I.fire(b.concat([])))}},onDidChangeItems:I.event});R.onDidChangeValue(async ie=>{if(!e.commandProvider?.provideCommands)return;let Q=[];s.length>0&&Q.push({label:"",kind:Wn.QuickPickItemKind.Separator});let ae=(await Promise.resolve(e.commandProvider.provideCommands(ie,t))||[]).map(Y=>({...Y,provider:e,type:"uriProviderQuickPick",command:Y}));R.items=s.concat(Q).concat(ae)},this),_=R,A=await V}if(!t.isCancellationRequested&&A&&"type"in A)switch(A.type){case"finder":{let R=await this.selectRemoteKernelFromPicker(i.notebook,Promise.resolve(A.kernelFinderInfo),t).catch(V=>p.error("Failed to select a kernel",V));if(R&&R===De.back){if(A===w)throw De.back;return this.getRemoteServersFromProvider(e,t,r,i)}if(!R||R instanceof De)throw new Wn.CancellationError;i.selection={type:"connection",connection:R};return}case"jupyterServer":{let R=(async()=>{let ie={id:e.id,handle:A.server.id,extensionId:e.extensionId};return e.extensionId.toLowerCase()===il.toLowerCase()&&await Nt(t,this.serverSelector.addJupyterServer(ie)),this.kernelFinderController.getOrCreateRemoteKernelFinder(ie,A.server.label)})(),V=await this.selectRemoteKernelFromPicker(i.notebook,R,t).catch(ie=>p.error("Failed to select a kernel",ie));if(V&&V===De.back){if(A===w)throw De.back;return this.getRemoteServersFromProvider(e,t,r,i)}if(!V||V instanceof De)throw new Wn.CancellationError;i.selection={type:"connection",connection:V};return}case"uriProviderQuickPick":{let R=Wn.notebooks.createNotebookControllerDetectionTask(It);try{_&&(_.busy=!0);let V=await this.selectRemoteServerFromRemoteKernelFinder(A,i,t);return _&&(_.busy=!1),V}catch(V){if(V===De.back&&!w)return this.getRemoteServersFromProvider(e,t,r,i);throw V}finally{R.dispose()}}default:break}}async selectRemoteServerFromRemoteKernelFinder(e,t,r){if(!e.provider.commandProvider?.handleCommand||r.isCancellationRequested)return;let i=await Promise.resolve(e.provider.commandProvider.handleCommand(e.command,r));if(!i)throw De.back;if(r.isCancellationRequested)throw new Wn.CancellationError;let o=(async()=>{let a={id:e.provider.id,handle:i.id,extensionId:e.provider.extensionId};return a.extensionId.toLowerCase()===il.toLowerCase()&&await Nt(r,this.serverSelector.addJupyterServer(a)),this.kernelFinderController.getOrCreateRemoteKernelFinder(a,i.label)})(),s=await this.selectRemoteKernelFromPicker(t.notebook,o,r).catch(a=>p.error("Failed to select a kernel",a));if(s&&s===De.back)throw De.back;if(!s||s instanceof De)throw new Wn.CancellationError;t.selection={type:"connection",connection:s}}async selectRemoteKernelFromPicker(e,t,r){let i,o=u=>{let d=this.displayDataProvider.getDisplayData(u);return{label:`${u===i?"$(star-full) ":""}${d.label}`,description:d.description,detail:d.detail}},s=u=>({label:this.displayDataProvider.getDisplayData(u).category||"Other"}),a=u=>({label:y.failedToFetchKernelSpecsRemoteErrorMessageForQuickPickLabel,detail:y.failedToFetchKernelSpecsRemoteErrorMessageForQuickPickDetail}),l=new cp(t,o,s,{supportsBack:!0},a),c=new Ap(this.jupyterConnection);return t.then(u=>c.findPreferredRemoteKernelConnection(e,u,r)).then(u=>{i=u,u?.kind==="startUsingRemoteKernelSpec"&&(l.recommended=u),l.selected=u}).catch(u=>p.error("Failed to determine preferred remote kernel",u)),l.selectItem(r)}};$b=v([(0,mc.injectable)(),m(0,(0,mc.inject)(Ar)),m(1,(0,mc.inject)(Xt)),m(2,(0,mc.inject)(Ea)),m(3,(0,mc.inject)(un)),m(4,(0,mc.inject)(Ad)),m(5,(0,mc.inject)(ew)),m(6,(0,mc.inject)(Jt))],$b);function sQ(n,e){n.addSingleton(He,Tb),n.addBinding(He,me),n.addSingleton(Ad,_b),n.addSingleton(Ix,$b),n.addSingleton(Sx,jb),n.addSingleton(Fm,Bb),n.addBinding(Fm,me),n.addSingleton(me,Vb),n.addSingleton(me,Wb),nQ(n,e)}var Sw=k(N()),Wf=require("vscode");var Ja=Symbol("IJupyterDebugService"),Mp=Symbol("INotebookDebuggingManager");var D0=Symbol("IDebugLocationTrackerFactory"),_0=Symbol("IDebugLocationTracker");var Jb=class{constructor(e,t){this.debuggingManager=e;this.disposables=t}activate(){this.disposables.push(Wf.commands.registerCommand(J.RunByLine,this.runByLine,this)),this.disposables.push(Wf.commands.registerCommand(J.RunByLineNext,this.runByLineNext,this)),this.disposables.push(Wf.commands.registerCommand(J.RunByLineStop,this.runByLineStop,this)),this.disposables.push(Wf.commands.registerCommand(J.RunAndDebugCell,this.runAndDebugCell,this))}async runByLine(e){T("DATASCIENCE.DEBUGGING.CLICKED_RUNBYLINE"),e??=this.getCellFromActiveEditor(),e&&await this.debuggingManager.tryToStartDebugging(0,e)}async runByLineNext(e){e??=this.getCellFromActiveEditor(),e&&this.debuggingManager.runByLineNext(e)}async runByLineStop(e){e??=this.getCellFromActiveEditor(),e&&this.debuggingManager.runByLineStop(e)}async runAndDebugCell(e){T("DATASCIENCE.DEBUGGING.CLICKED_RUN_AND_DEBUG_CELL"),e??=this.getCellFromActiveEditor(),e&&await this.debuggingManager.tryToStartDebugging(1,e)}getCellFromActiveEditor(){let e=Wf.window.activeNotebookEditor;if(e){let t=e.selections[0];if(t)return e.notebook.cellAt(t.start)}}dispose(){this.disposables.forEach(e=>e.dispose())}};Jb=v([(0,Sw.injectable)(),m(0,(0,Sw.inject)(Mp)),m(1,(0,Sw.inject)(K))],Jb);var Nu=k(N());var qb=class{constructor(e,t,r){this.debugService=e;this.disposables=t;this.debugVariables=r}activate(){this.disposables.push(this.debugService.registerDebugAdapterTrackerFactory(ge,this)),this.disposables.push(this.debugService.registerDebugAdapterTrackerFactory("debugpy",this)),this.disposables.push(this.debugService.registerDebugAdapterTrackerFactory(NC,this)),this.disposables.push(this.debugService.registerDebugAdapterTrackerFactory(MC,this))}createDebugAdapterTracker(e){return this.debugVariables}};qb=v([(0,Nu.injectable)(),m(0,(0,Nu.inject)(Ja)),m(0,(0,Nu.named)(Le.MULTIPLEXING_DEBUGSERVICE)),m(1,(0,Nu.inject)(K)),m(2,(0,Nu.inject)(In)),m(2,(0,Nu.named)(Le.DEBUGGER_VARIABLES))],qb);var qa=k(N());var Cw=require("vscode");var HF=new Set(["DataFrame","list","dict","ndarray","Series","Tensor","EagerTensor","DataArray"]);function R0(n){return{name:n.evaluateName??n.name,type:n.type,count:0,shape:"",size:0,supportsDataExplorer:HF.has(n.type||""),value:n.value,truncated:!0,frameId:n.variablesReference}}function A0(n){let e=n.index,t=n.columns;return{data:n.data.map((o,s)=>{let a={index:e[s]};return t.forEach((l,c)=>{a[l]=o[c]}),a})}}var GF=require("vscode"),Hb=class{constructor(e){this._sessionId=e;this.topMostFrameId=0;this.sequenceNumbersOfRequestsPendingResponses=new Set;this.waitingForStackTrace=!1;this.debugLocationUpdatedEvent=new GF.EventEmitter;this.sessionEndedEmitter=new GF.EventEmitter;this.DebugLocation=void 0}get sessionId(){return this._sessionId}get sessionEnded(){return this.sessionEndedEmitter.event}get debugLocationUpdated(){return this.debugLocationUpdatedEvent.event}get debugLocation(){return this._debugLocation}onDidSendMessage(e){if(this.isResponseForRequestToFetchAllFrames(e)){let t=e.body?.stackFrames[0];this.topMostFrameId=t?.id,this.sequenceNumbersOfRequestsPendingResponses.delete(e.request_seq),this.waitingForStackTrace&&(this.DebugLocation={lineNumber:t?.line,fileName:this.normalizeFilePath(t?.source?.path),column:t.column},this.waitingForStackTrace=!1)}this.isStopEvent(e)&&(this.waitingForStackTrace=!0),this.isContinueEvent(e)&&(this.DebugLocation=void 0,this.waitingForStackTrace=!1)}onWillStopSession(){this.sessionEndedEmitter.fire(this)}onWillReceiveMessage(e){this.isRequestToFetchAllFrames(e)&&this.sequenceNumbersOfRequestsPendingResponses.add(e.seq)}set DebugLocation(e){let t=this._debugLocation;this._debugLocation=e,this._debugLocation!==t&&this.debugLocationUpdatedEvent.fire()}normalizeFilePath(e){return process.platform!=="win32"?e.replace(/\\/g,"/"):e}isStopEvent(e){return e.type==="event"&&e.event==="stopped"}isContinueEvent(e){if(e.type==="event"){if(e.event==="continue")return!0}else if(e.type==="response"&&e.command==="continue")return!0;return!1}isResponseForRequestToFetchAllFrames(e){return e.type==="response"&&e.command==="stackTrace"&&e.body?.stackFrames[0]&&this.sequenceNumbersOfRequestsPendingResponses.has(e.request_seq)}isRequestToFetchAllFrames(e){return e.type==="request"&&e.command==="stackTrace"&&(e.arguments.startFrame===0||e.arguments.startFrame===void 0)}};var rfe=new Set(["In","Out","exit","quit"]),N0=100,Gb=class extends Hb{constructor(t,r,i,o,s,a){super(void 0);this.debugService=t;this.debuggingManager=r;this.configService=i;this.varScriptGenerator=o;this.dfScriptGenerator=s;this.kernelProvider=a;this.refreshEventEmitter=new Cw.EventEmitter;this.lastKnownVariables=[];this.importedGetVariableInfoScriptsIntoKernel=new Set;this.watchedNotebooks=new Map;this.debuggingStarted=!1;this.currentVariablesReference=0;this.currentSeqNumsForVariables=new Set;this.debuggingManager.onDoneDebugging(()=>this.refreshEventEmitter.fire(),this)}get refreshRequired(){return this.refreshEventEmitter.event}get active(){return(this.debugService.activeDebugSession!==void 0||this.activeNotebookIsDebugging())&&this.debuggingStarted}getAllVariableDiscriptions(){throw new Error("Method not implemented.")}async getVariables(t,r){r&&this.watchKernel(r);let i=r&&this.kernelProvider.getKernelExecution(r),o={executionCount:i?i.executionCount:t.executionCount,pageStartIndex:0,pageResponse:[],totalCount:0,refreshCount:t.refreshCount};if(this.active){let s=t.sortColumn,a=(u,d)=>{let f=u[s]?u[s]:"",g=d[s]?d[s]:"";return t.sortAscending?f.localeCompare(g,void 0,{sensitivity:"base"}):g.localeCompare(f,void 0,{sensitivity:"base"})};this.lastKnownVariables.sort(a);let l=t.startIndex?t.startIndex:0,c=t.pageSize?t.pageSize:N0;o.pageStartIndex=l;for(let u=l;u<l+c&&u<this.lastKnownVariables.length;u+=1){let d=this.lastKnownVariables[u].truncated?await this.getFullVariable(this.lastKnownVariables[u]):this.lastKnownVariables[u];this.lastKnownVariables[u]=d,o.pageResponse.push(d)}o.totalCount=this.lastKnownVariables.length}return o}async getMatchingVariable(t,r){if(this.active){let i=this.lastKnownVariables.find(o=>o.name===t);return i&&r?.resourceUri&&fd(r?.resourceUri).toLowerCase()===".ipynb"&&T("DATASCIENCE.RUN_BY_LINE_VARIABLE_HOVER"),i}}async getVariableValueSummary(t){}async getDataFrameInfo(t,r,i,o){if(!this.active)return t;o&&(t=await this.getFullVariable(t)),r&&this.watchKernel(r);let s=t.name;i&&(s=`${t.name}${i}`);let{cleanupCode:a,initializeCode:l,code:c}=await this.dfScriptGenerator.generateCodeToGetDataFrameInfo({isDebugging:!0,variableName:s}),u=await this.evaluate({code:c,cleanupCode:a,initializeCode:l,frameId:t.frameId}),d=r?.notebook,f=d?Ce(d.uri.path):"";return!f&&this.debugLocation?.fileName&&(f=Ce(this.debugLocation.fileName)),u?{...t,...JSON.parse(u.result),maximumRowChunkSize:N0,fileName:f}:t}async getDataFrameRows(t,r,i,o,s){if(i-r>N0)throw new Error(`Debugger cannot provide more than ${N0} rows at once`);if(!this.debugService.activeDebugSession||t.columns===void 0)return{data:[]};o&&this.watchKernel(o);let a=t.name;s&&(a=`${t.name}${s}`);let{cleanupCode:l,initializeCode:c,code:u}=await this.dfScriptGenerator.generateCodeToGetDataFrameRows({isDebugging:!0,variableName:a,startIndex:r,endIndex:i}),d=await this.evaluate({code:u,cleanupCode:l,initializeCode:c,frameId:t.frameId});return A0(JSON.parse(d.result))}onWillReceiveMessage(t){super.onWillReceiveMessage(t),t.type==="request"&&t.command==="variables"&&t.arguments&&this.currentVariablesReference===t.arguments.variablesReference&&this.currentSeqNumsForVariables.add(t.seq)}onDidSendMessage(t){if(super.onDidSendMessage(t),t.type==="response"&&t.command==="initialize")this.debuggingStarted=!0;else if(t.type==="event"&&t.event==="stopped"&&this.activeNotebookIsDebugging())this.handleNotebookVariables(t).catch(h);else if(t.type==="response"&&t.command==="scopes"&&t.body&&t.body.scopes){let i=t.body.scopes[0].variablesReference;i!==this.currentVariablesReference&&(this.currentVariablesReference=i,this.currentSeqNumsForVariables.clear())}else if(t.type==="response"&&t.command==="variables"&&t.body)this.currentSeqNumsForVariables.has(t.request_seq)&&this.updateVariables(void 0,t),this.monkeyPatchDataViewableVariables(t);else if(t.type==="event"&&t.event==="terminated"){this.lastKnownVariables=[],this.topMostFrameId=0,this.debuggingStarted=!1,this.refreshEventEmitter.fire();let r=this.debugService.activeDebugSession?.id;r&&this.importedGetVariableInfoScriptsIntoKernel.delete(r)}}watchKernel(t){let r=t.notebook?.uri.toString();if(r&&!this.watchedNotebooks.has(r)){let i=[];i.push(t.onRestarted(this.resetImport.bind(this,r))),i.push(t.onDisposed(()=>{this.resetImport(r),i.forEach(o=>o.dispose()),this.watchedNotebooks.delete(r)})),this.watchedNotebooks.set(r,i)}}resetImport(t){this.importedGetVariableInfoScriptsIntoKernel.delete(t)}async evaluate({code:t,cleanupCode:r,frameId:i,initializeCode:o}){if(this.debugService.activeDebugSession){i=this.topMostFrameId||i;let s={frameId:i,context:"repl",format:{rawString:!0}};p.debug(`Evaluating in debugger : ${this.debugService.activeDebugSession.id}: ${t}`);try{o&&await this.debugService.activeDebugSession.customRequest("evaluate",{...s,expression:o});let a=await this.debugService.activeDebugSession.customRequest("evaluate",{...s,expression:t});if(a&&a.result!=="None")return a;p.error(`Cannot evaluate ${t}`);return}finally{r&&await this.debugService.activeDebugSession.customRequest("evaluate",{...s,expression:r})}}throw Error("Debugger is not active, cannot evaluate.")}async getFullVariable(t){let{initializeCode:r,code:i,cleanupCode:o}=await this.varScriptGenerator.generateCodeToGetVariableInfo({isDebugging:!0,variableName:t.name}),s=await this.evaluate({code:i,initializeCode:r,cleanupCode:o,frameId:t.frameId});return s&&s.result?{...t,truncated:!1,...JSON.parse(s.result)}:t}monkeyPatchDataViewableVariables(t){t.body.variables.forEach(r=>{r.type&&HF.has(r.type)&&r.evaluateName&&(r.__vscodeVariableMenuContext="viewableInDataViewer")})}updateVariables(t,r){let i=this.configService.getSettings(t).variableExplorerExclude?this.configService.getSettings().variableExplorerExclude?.split(";"):[],o=r.body.variables.filter(s=>!(!s.name||!s.type||!s.value||i&&i.includes(s.type)||s.name.startsWith("_")||rfe.has(s.name)||s.type==="NoneType"));this.lastKnownVariables=o.map(s=>R0(s)),this.refreshEventEmitter.fire()}activeNotebookIsDebugging(){let t=Cw.window.activeNotebookEditor;return!!t&&this.debuggingManager.isDebugging(t.notebook)}async handleNotebookVariables(t){let r=Cw.window.activeNotebookEditor?.notebook,i=t.body.threadId;if(r){let o=this.debuggingManager.getDebugSession(r);if(o){let s=await o.customRequest("stackTrace",{threadId:i,startFrame:0,levels:1});if(s&&s.stackFrames[0]){let a=s.stackFrames[0],l=this.debuggingManager.getDebugMode(r),c;if(l===0){let u=this.debuggingManager.getDebugCell(r);a.source&&u&&a.source.path===u.document.uri.toString()&&(c=await o.customRequest("scopes",{frameId:a.id}))}else{let u=Ce(r.uri.toString());a.source&&a.source.path&&a.source.path.includes(u)&&(c=await o.customRequest("scopes",{frameId:a.id}))}c&&(c.scopes.forEach(u=>{o.customRequest("variables",{variablesReference:u.variablesReference}).then(h,h)}),this.refreshEventEmitter.fire())}}}}};Gb=v([(0,qa.injectable)(),m(0,(0,qa.inject)(Ja)),m(0,(0,qa.named)(Le.MULTIPLEXING_DEBUGSERVICE)),m(1,(0,qa.inject)(Mp)),m(2,(0,qa.inject)(oe)),m(3,(0,qa.inject)(rg)),m(4,(0,qa.inject)(ng)),m(5,(0,qa.inject)(ye))],Gb);var Mu=k(N()),Kp=require("vscode");var aQ=require("vscode"),cr=class{constructor(e){this.name=e}get value(){return this.lastValue}async set(e){this.lastValue!==e&&(this.lastValue=e,await aQ.commands.executeCommand("setContext",this.name,this.lastValue))}};var mQ=require("vscode");var Ew=(o=>(o[o.Unknown=0]="Unknown",o[o.Ok=1]="Ok",o[o.Outdated=2]="Outdated",o[o.NotInstalled=3]="NotInstalled",o[o.ControllerNotSelected=4]="ControllerNotSelected",o))(Ew||{});async function lQ(n){let e="5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d",t=`import builtins
import ipykernel
builtins.print("${e}" + ipykernel.__version__ + "${e}")`,r=await n.executeHidden(t),i=/^(\d+)\.\d+\.\d+$/;for(let o of r){if(o.output_type!=="stream")continue;let s=o.text?.toString().trim()??"";if(!s.includes(e))continue;let a=s.split(e)[1].trim().match(i);if(a){let l=a[1];return Number(l)>=6?1:2}}return 0}function ww(n){let e=n;if(typeof e.__notebookUri>"u"||typeof e.__mode>"u"||(e.__mode===1||e.__mode===2||e.__mode===0)&&typeof e.__cellIndex>"u")throw new Error("Invalid launch configuration")}function cQ(n){if(ww(n),n.__mode!==2)throw new Error("Invalid launch configuration")}function M0(n,e){switch(n.type){case"event":let t=n;switch(t.event){case"output":e(t.body);break;case"loadedSource":e(t.body);break;case"breakpoint":e(t.body.breakpoint);break;default:break}break;case"request":let r=n;switch(r.command){case"setBreakpoints":let o=r.arguments,s=o.breakpoints;if(s&&s.length){let a=s[0].line;s.forEach(c=>{e(c,{...o.source})});let l={source:o.source,line:a};e(l),o.source=l.source}break;case"breakpointLocations":e(r.arguments);break;case"source":e(r.arguments);break;case"gotoTargets":e(r.arguments);break;default:break}break;case"response":let i=n;if(i.success&&i.body)switch(i.command){case"stackTrace":i.body.stackFrames.forEach(o=>{e(o)});break;case"loadedSources":i.body.sources.forEach(o=>{let s={source:o};e(s),o.path=s.source.path});break;case"scopes":i.body.scopes.forEach(o=>{e(o)});break;case"setFunctionBreakpoints":i.body.breakpoints.forEach(o=>{e(o)});break;case"setBreakpoints":i.body.breakpoints.forEach(o=>{e(o)});break;default:break}break}}function uQ(n){return/~\d+\\/.test(n)}function dQ(n,e){return new RegExp(n.replace(/\\/g,"\\\\").replace(/~\d+\\\\/g,"[^\\\\]+\\\\"),"i").test(e)}async function Vf(n,e){await n.executeHidden(`import debugpy
debugpy.debug_this_thread()`),await e.dumpAllCells()}function pQ(n){return!!n.header&&n.header.msg_type==="debug_event"}function Pw(n){return n.includes("Frame skipped from debugging during step-in")}function zF(n){return n.event==="debugpyAttach"}var K0=class{constructor(e,t,r){this.debugAdapter=e;this.debugCell=t;this.execution=r;T("DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUN_AND_DEBUG_CELL")}trace(e,t){p.debug(`[Debug-Cell] ${e}: ${t}`)}async willSendEvent(e){return zF(e)?(this.trace("intercept","debugpyAttach request for subprocess, not supported"),!0):e.event==="output"&&Pw(e.body.output)?(this.trace("intercept","justMyCode notification"),!0):!1}async willSendRequest(e){e.command==="configurationDone"&&(await Vf(this.execution,this.debugAdapter),mQ.commands.executeCommand("notebook.cell.execute",{ranges:[{start:this.debugCell.index,end:this.debugCell.index+1}],document:this.debugCell.notebook.uri}).then(h,h))}};var kw=class{constructor(e,t,r,i){this.mode=e;this.debugAdapter=t;this.debugCell=r;this.serviceContainer=i;this.debuggingManager=this.serviceContainer.get(Mp)}trace(e,t){p.debug(`[Debug-Restart] ${e}: ${t}`)}error(e,t){p.error(`[Debug-Restart] ${e}: ${t}`)}async willSendResponse(e){e.command==="initialize"&&e.body&&(e.body.supportsRestartRequest=!0)}async willSendRequest(e){if(e.command==="restart")return this.trace("restart","Handling restart request"),setTimeout(()=>{this.debugAdapter.disconnect().then(()=>(this.trace("restart","doRestart"),this.debuggingManager.tryToStartDebugging(this.mode,this.debugCell,!0))).catch(t=>{this.error("restart",`Error restarting: ${t}`)})},0),{command:e.command,request_seq:e.seq,seq:e.seq,success:!0,type:"response"}}};var xw=require("vscode");var O0=class{constructor(e,t,r,i){this.debugAdapter=e;this.debugCell=t;this.execution=r;this.settings=i;T("DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUNBYLINE")}continue(){if(typeof this.lastPausedThreadId!="number"){p.debug("No paused thread, can't do RBL"),this.stop();return}this.debugAdapter.stepIn(this.lastPausedThreadId).then(h,h)}stop(){p.ci("RunbylineController::stop()"),this.execution.executeHidden("pass").then(h,h),this.debugAdapter.disconnect().then(h,h)}getMode(){return this.debugAdapter.getConfiguration().__mode}async willSendEvent(e){return e.event==="stopped"&&(this.lastPausedThreadId=e.body.threadId,await this.handleStoppedEvent(this.lastPausedThreadId))?(this.trace("intercepted","handled stop event"),!0):e.event==="output"&&Pw(e.body.output)?(this.trace("intercept","justMyCode notification"),!0):!1}async willSendRequest(e){p.ci(`willSendRequest: ${e.command}`),e.command==="configurationDone"&&await this.initializeExecute()}async handleStoppedEvent(e){return await this.shouldStepIn(e)?(this.debugAdapter.stepIn(e).then(h,h),!0):!1}async shouldStepIn(e){let t=await this.debugAdapter.stackTrace({threadId:e,startFrame:0,levels:1});if(t&&t.stackFrames[0]){let r=t.stackFrames[0],i=new xw.Position(r.line,r.column);return this.lastPausePosition?.isEqual(i)?(this.trace("intercept","working around duplicate stop event"),!0):(this.lastPausePosition=i,!!r.source&&r.source.path!==this.debugCell.document.uri.toString())}return!1}trace(e,t){p.debug(`[Debug-RBL] ${e}: ${t}`)}async initializeExecute(){await Vf(this.execution,this.debugAdapter);let e=Be(this.debugCell.document.getText(),{trim:!1,removeEmptyEntries:!1}),t=[];if(Tm(e,()=>void 0,(r,i)=>{r.trim().length!==0&&t.push(i)}),t.sort(),t.length!==0){let r={line:t[0]+1};await this.debugAdapter.setBreakpoints({source:{name:Ce(this.debugCell.notebook.uri.path),path:this.debugCell.document.uri.toString()},breakpoints:[r],sourceModified:!1}),this.settings.getSettings(this.debugCell.notebook.uri).showVariableViewWhenDebugging&&xw.commands.executeCommand(J.OpenVariableView).then(h,h)}xw.commands.executeCommand("notebook.cell.execute",{ranges:[{start:this.debugCell.index,end:this.debugCell.index+1}],document:this.debugCell.notebook.uri}).then(h,h)}};var zb=class{constructor(e,t,r){this.document=e;this.config=t;this.session=r}};var Vn=require("vscode");var Qb=class{constructor(e,t,r){this.kernelProvider=e;this.controllerRegistration=t;this.serviceContainer=r;this.notebookToDebugger=new Map;this.notebookToDebugAdapter=new Map;this.notebookInProgress=new Set;this.disposables=[];this._doneDebugging=new Vn.EventEmitter}activate(){this.disposables.push(Vn.debug.onDidTerminateDebugSession(this.endSession.bind(this)),Vn.workspace.onDidCloseNotebookDocument(async e=>{let t=this.notebookToDebugger.get(e);t&&(await Vn.debug.stopDebugging(t.session),this.onDidStopDebugging(e))}))}getDebugCell(e){return this.notebookToDebugAdapter.get(e)?.debugCell}get onDoneDebugging(){return this._doneDebugging.event}dispose(){this.disposables.forEach(e=>e.dispose())}isDebugging(e){return this.notebookToDebugger.has(e)}getDebugSession(e){let t=this.notebookToDebugger.get(e);if(t)return t.session}getDebugAdapter(e){return this.notebookToDebugAdapter.get(e)}onDidStopDebugging(e){}async startDebuggingConfig(e,t){p.ci(`Attempting to start debugging with config ${JSON.stringify(e)}`);try{await Vn.debug.startDebugging(void 0,e,t)}catch(r){p.error(`Can't start debugging (${r})`),Vn.window.showErrorMessage(y.cantStartDebugging).then(h,h)}}trackDebugAdapter(e,t){this.notebookToDebugAdapter.set(e,t),this.disposables.push(t.onDidEndSession(this.endSession.bind(this)))}async endSession(e){p.info(`Ending debug session ${e.id}`),this._doneDebugging.fire();for(let[t,r]of this.notebookToDebugger.entries())if(r&&e.id===r.session.id){this.notebookToDebugger.delete(t),this.notebookToDebugAdapter.delete(t),this.onDidStopDebugging(t);break}}getDebuggerByUri(e){for(let[t,r]of this.notebookToDebugger.entries())if(e===t)return r}async ensureKernelIsRunning(e){let t=this.controllerRegistration.getSelected(e),r=this.kernelProvider.get(e);return t&&(!r||r&&r.status==="unknown")&&(r=await Qs.connectToNotebookKernel(t.connection,this.serviceContainer,{notebook:e,controller:t.controller,resource:e.uri},new Mt(!1),this.disposables,"jupyterExtension")),r}findEditorForCell(e){let t=e.notebook.uri.toString();return Vn.window.visibleNotebookEditors.find(r=>r.notebook.uri.toString()===t)}async checkIpykernelAndPrompt(e,t=!0){let r=this.findEditorForCell(e);if(!r)return Vn.window.showErrorMessage(y.noNotebookToDebug).then(h,h),0;let i=await this.checkForIpykernel6(r.notebook);switch(i){case 3:break;case 2:case 0:{this.promptInstallIpykernel6().then(h,h);break}case 4:if(t)return await Vn.commands.executeCommand("notebook.selectKernel",{notebookEditor:r}),await this.checkIpykernelAndPrompt(e,!1)}return i}async checkForIpykernel6(e){try{let t=this.kernelProvider.get(e);if(!t){let s=this.controllerRegistration.getSelected(e);if(!s)return 4;t=this.kernelProvider.getOrCreate(e,{metadata:s.connection,controller:s?.controller,resourceUri:e.uri})}let r=t.kernelConnectionMetadata;if(Dt(r)){if(r.kind==="startUsingRemoteKernelSpec"&&r.kernelSpec.metadata?.debugger)return 1;if(r.kind==="connectToLiveRemoteKernel"&&r.kernelModel.metadata?.debugger)return 1}let i=this.kernelProvider.getKernelExecution(t),o=await lQ(i);return T("DATASCIENCE.DEBUGGING.IPYKERNEL6_STATUS",void 0,{status:o===1?"installed":"notInstalled"}),o}catch(t){p.error("Debugging: Could not check for ipykernel 6",t)}return 0}async promptInstallIpykernel6(){await Vn.window.showInformationMessage(y.needIpykernel6,{modal:!0},y.setup)===y.setup?(T("DATASCIENCE.DEBUGGING.CLICKED_ON_SETUP"),Vn.env.openExternal(Vn.Uri.parse("https://github.com/microsoft/vscode-jupyter/wiki/Setting-Up-Run-by-Line-and-Debugging-for-Notebooks"))):T("DATASCIENCE.DEBUGGING.CLOSED_MODAL")}};var Ha=require("vscode");var F0=class{constructor(e){this.debugAdapter=e}trace(e,t){p.debug(`[Debug-Reset] ${e}: ${t}`)}async willSendRequest(e){e.command==="attach"&&(this.trace("attach","Continuing paused kernel threads if needed"),(await this.debugAdapter.debugInfo()).stoppedThreads.forEach(r=>this.debugAdapter.continueDirect(r)))}};var Yb=class{constructor(e,t,r,i,o,s){this.session=e;this.notebookDocument=t;this.jupyterSession=r;this.kernel=i;this.platformService=o;this.debugService=s;this.fileToCell=new Map;this.sendMessage=new Ha.EventEmitter;this.endSession=new Ha.EventEmitter;this.disposables=[];this.delegates=[];this.onDidSendMessage=this.sendMessage.event;this.onDidEndSession=this.endSession.event;this.disconnected=!1;p.ci("Creating kernel debug adapter for debugging notebooks");let a=this.session.configuration;ww(a),this.configuration=a,this.debugCell=t.cellAt(a.__cellIndex),this.addDebuggingDelegates([new F0(this)]),this.jupyterSession.kernel?.iopubMessage.connect(this.onIOPubMessage,this),this.disposables.push(new Ha.Disposable(()=>this.jupyterSession.kernel?.iopubMessage.disconnect(this.onIOPubMessage,this))),this.kernel&&(this.kernel.addHook("willRestart",()=>this.disconnect(),this,this.disposables),this.kernel.addHook("interruptCompleted",()=>this.disconnect(),this,this.disposables),this.disposables.push(this.kernel.onDisposed(()=>{this.disconnected||(Ha.debug.stopDebugging(this.session).then(h,h),this.disconnect().catch(h),T("DATASCIENCE.DEBUGGING.ENDED_SESSION",void 0,{reason:"onKernelDisposed"}))}))),this.disposables.push(ar.onDidChangeNotebookCellExecutionState(l=>{this.configuration.__cellIndex===l.cell.index&&l.state===1&&!this.disconnected&&(T("DATASCIENCE.DEBUGGING.ENDED_SESSION",void 0,{reason:"normally"}),this.disconnect().catch(h))},this,this.disposables)),this.disposables.push(Ha.workspace.onDidChangeNotebookDocument(l=>{l.contentChanges.forEach(c=>{c.removedCells.forEach(u=>{u===this.debugCell&&this.disconnect().catch(h)})})},this,this.disposables)),this.disposables.push(this.debugService.onDidTerminateDebugSession(l=>{(l===this.session||l===this.session)&&this.disconnect().catch(h)}))}addDebuggingDelegates(e){this.delegates.push(...e)}trace(e,t){p.debug(`[Debug] ${e}: ${t}`)}async onIOPubMessage(e,t){if(p.ci(`Debug IO Pub message: ${JSON.stringify(t)}`),pQ(t)){this.trace("event",JSON.stringify(t));for(let r of this.delegates??[])if(await r?.willSendEvent?.(t.content))return;this.sendMessage.fire(t.content)}}handleMessage(e){this.handleClientMessageAsync(e).catch(h)}async handleClientMessageAsync(e){try{if(p.ci(`KernelDebugAdapter::handleMessage ${JSON.stringify(e,void 0," ")}`),e.type==="request"&&e.command==="setBreakpoints"){let t=e.arguments;if(t.source&&t.source.path&&t.source.path.indexOf("vscode-notebook-cell:")===0){let r=this.notebookDocument.getCells().find(i=>i.document.uri.toString()===t.source.path);r&&await this.dumpCell(r.index)}}if(e.type==="request")for(let t of this.delegates??[]){let r=await t?.willSendRequest?.(e);if(r){this.trace("response",JSON.stringify(r)),this.sendMessage.fire(r);return}}await this.sendMessageToJupyterSession(e)}catch(t){p.error(`KernelDebugAdapter::handleMessage failure: ${t}`)}}getConfiguration(){return this.configuration}stepIn(e){return this.session.customRequest("stepIn",{threadId:e})}async debugInfo(){return await this.session.customRequest("debugInfo")}continueDirect(e){if(!this.jupyterSession.kernel)throw new hn;this.jupyterSession.kernel.requestDebug({seq:0,type:"request",command:"continue",arguments:{threadId:e}})}async disconnect(){if(!this.disconnected){if(this.disconnected=!0,this.debugService.activeDebugSession===this.session||this.debugService.activeDebugSession?.id===this.session.id)try{await Promise.all([this.deleteDumpedFiles().catch(e=>p.warn("Error deleting temporary debug files.",e)),this.session.customRequest("disconnect",{restart:!1})])}catch(e){p.error("Failed to disconnect debug session",e)}this.endSession.fire(this.session)}}dispose(){this.disposables.forEach(e=>e.dispose())}stackTrace(e){return this.session.customRequest("stackTrace",e)}setBreakpoints(e){return this.session.customRequest("setBreakpoints",e)}async dumpAllCells(){await Promise.all(this.notebookDocument.getCells().map(async e=>{e.kind===Ha.NotebookCellKind.Code&&await this.dumpCell(e.index)}))}lookupCellByLongName(e){if(this.platformService.isWindows){e=mn(e);for(let[t,r]of this.fileToCell.entries())if(uQ(t)&&dQ(t,e))return r}}async sendMessageToJupyterSession(e){if(this.jupyterSession.isDisposed||this.jupyterSession.status==="dead"||!this.jupyterSession.kernel){p.info(`Skipping sending message ${e.type} because session is disposed`);return}if(this.trace("to kernel",JSON.stringify(e)),e.type==="request"){let t=await this.sendRequestToJupyterSession(e);t&&this.sendMessage.fire(t)}else if(e.type==="response"){M0(e,this.translateRealLocationToDebuggerLocation.bind(this));let t=e;return this.jupyterSession.kernel.requestDebug({seq:t.seq,type:"request",command:t.command},!0).done}else p.error(`Unknown message type to send ${e.type}`)}async sendRequestToJupyterSession(e){if(M0(e,this.translateRealLocationToDebuggerLocation.bind(this)),!this.jupyterSession.kernel)throw new hn;this.trace("to kernel, mapped",JSON.stringify(e));let t=e,o=(await this.jupyterSession.kernel.requestDebug({seq:t.seq,type:"request",command:t.command,arguments:t.arguments},!0).done).content;M0(o,this.translateDebuggerLocationToRealLocation.bind(this));for(let s of this.delegates??[])await s?.willSendResponse?.(o);return this.trace("response",JSON.stringify(o)),o}translateDebuggerLocationToRealLocation(e,t){if(t=e?.source??t,t&&t.path){let r=this.fileToCell.get(t.path)??this.lookupCellByLongName(t.path);r&&(t.name=Ce(r.path),t.path=r.toString())}}async deleteDumpedFiles(){let e=this.getDumpFilesForDeletion();if(this.jupyterSession.kernel&&e.length){let r=`import os as _VSCODE_os
_VSCODE_fileList = [${e.map(i=>'"'+i.replace(/\\/g,"\\\\")+'"').join(",")}]
for file in _VSCODE_fileList:
    try:
        _VSCODE_os.remove(file)
    except:
        pass
del _VSCODE_fileList
del _VSCODE_os`;await gn(this.jupyterSession.kernel,r,{traceErrors:!0,traceErrorsMessage:"Error deleting temporary debugging files"})}}};var L0=class extends Yb{constructor(){super(...arguments);this.cellToFile=new Map;this.lineOffsets=new WeakMap}async dumpCell(t){let r=this.notebookDocument.cellAt(t);try{let i=await this.session.customRequest("dumpCell",{code:r.document.getText().replace(/\r\n/g,`
`)}),o=mn(i.sourcePath);this.fileToCell.set(o,r.document.uri),this.cellToFile.set(r.document.uri.toString(),o),this.lineOffsets.set(r,nfe(r))}catch(i){p.error(i)}}translateDebuggerLocationToRealLocation(t,r){if(r=t?.source??r,!r?.path||!this.fileToCell.size)return;let i=this.fileToCell.get(r.path)??this.lookupCellByLongName(r.path);if(!i)return;let o=this.notebookDocument.getCells().find(a=>a.document.uri.toString()===i.toString()),s=o?this.lineOffsets.get(o)??0:0;r.name=Ce(i.path),r.path=i.toString(),s&&typeof t?.endLine=="number"&&(t.endLine=t.endLine+s),s&&typeof t?.line=="number"&&(t.line=t.line+s)}translateRealLocationToDebuggerLocation(t,r){if(r=t?.source??r,!r?.path||!this.cellToFile.size)return;let i=this.cellToFile.get(r.path);if(!i)return;let o=this.notebookDocument.getCells().find(a=>a.document.uri.toString()===r.path),s=o?this.lineOffsets.get(o)??0:0;r.path=i,s&&typeof t.line=="number"&&(t.line<s?t.line=s:t.line>s&&(t.line-=s)),s&&typeof t.endLine=="number"&&(t.endLine<s?t.endLine=s:t.endLine>s&&(t.endLine-=s))}getDumpFilesForDeletion(){return Array.from(this.cellToFile.values())}};function nfe(n){for(let e=0;e<n.document.lineCount;e+=1)if(n.document.lineAt(e).text.trim().length>0)return e;return 0}var Xb=class extends Qb{constructor(t,r,i,o,s,a){super(t,r,a);this.configurationService=i;this.platform=o;this.debugService=s;this.notebookToRunByLineController=new Map;this.runByLineCells=new cr(Cr.RunByLineCells),this.runByLineDocuments=new cr(Cr.RunByLineDocuments),this.debugDocuments=new cr(Cr.DebugDocuments)}activate(){super.activate(),this.disposables.push(Kp.debug.registerDebugAdapterDescriptorFactory(NC,{createDebugAdapterDescriptor:async t=>this.createDebugAdapterDescriptor(t)}))}getDebugMode(t){return this.notebookToRunByLineController.get(t)?.getMode()}onDidStopDebugging(t){super.onDidStopDebugging(t),this.notebookToRunByLineController.delete(t),this.updateRunByLineContextKeys(),this.updateDebugContextKey()}updateRunByLineContextKeys(){let t=[],r=[];this.notebookToRunByLineController.forEach(i=>{t.push(i.debugCell.document.uri),r.push(i.debugCell.notebook.uri)}),this.runByLineCells.set(t).catch(h),this.runByLineDocuments.set(r).catch(h)}updateDebugContextKey(){let t=new Ul;this.notebookToDebugAdapter.forEach((r,i)=>t.add(i.uri)),this.notebookInProgress.forEach(r=>t.add(r.uri)),this.debugDocuments.set(Array.from(t.values())).catch(h)}async tryToStartDebugging(t,r,i=!1){if(p.info(`Starting debugging with mode ${t}`),!i){let o=await this.checkIpykernelAndPrompt(r);if(o!==1){p.info(`Ipykernel check failed: ${Ew[o]}`);return}}(t===0||t===1)&&await this.startDebuggingCell(t,r)}runByLineNext(t){let r=this.notebookToRunByLineController.get(t.notebook);r&&r.debugCell.document.uri.toString()===t.document.uri.toString()&&r.continue()}runByLineStop(t){let r=this.notebookToRunByLineController.get(t.notebook);r&&(T("DATASCIENCE.DEBUGGING.ENDED_SESSION",void 0,{reason:"withKeybinding"}),r.stop())}async startDebuggingCell(t,r){let i=r.notebook,o=this.configurationService.getSettings(i.uri),s={type:NC,name:Ce(i.uri.toString()),request:"attach",justMyCode:t===1?o.debugJustMyCode:!0,__mode:t,__cellIndex:r.index,__notebookUri:i.uri.toString()},a=t===0?{suppressDebugStatusbar:!0,suppressDebugToolbar:!0,suppressDebugView:!0,suppressSaveBeforeStart:!0}:{suppressSaveBeforeStart:!0};return this.startDebuggingConfig(s,a)}async createDebugAdapterDescriptor(t){let r=t.configuration;ww(r);let i=r.__notebookUri,o=Kp.workspace.notebookDocuments.find(s=>s.uri.toString()===i);if(!o){p.info(`Cannot start debugging. Notebook ${i} not found.`);return}if(this.notebookInProgress.has(o)){p.info("Cannot start debugging. Already debugging this notebook");return}if(this.isDebugging(o)){p.info("Cannot start debugging. Already debugging this notebook document.");return}this.notebookToDebugger.set(o,new zb(o,r,t));try{return this.notebookInProgress.add(o),this.updateDebugContextKey(),await this.doCreateDebugAdapterDescriptor(r,t,o)}finally{this.notebookInProgress.delete(o),this.updateDebugContextKey()}}async doCreateDebugAdapterDescriptor(t,r,i){let o=await this.ensureKernelIsRunning(i);if(o?.session){let s=new L0(r,i,o.session,o,this.platform,this.debugService);if(t.__mode===0&&typeof t.__cellIndex=="number"){let a=i.cellAt(t.__cellIndex),l=new O0(s,a,this.kernelProvider.getKernelExecution(o),this.configurationService);s.addDebuggingDelegates([l,new kw(0,s,a,this.serviceContainer)]),this.notebookToRunByLineController.set(i,l),this.updateRunByLineContextKeys()}else if(t.__mode===1&&typeof t.__cellIndex=="number"){let a=i.cellAt(t.__cellIndex),l=new K0(s,a,this.kernelProvider.getKernelExecution(o));s.addDebuggingDelegates([l,new kw(1,s,a,this.serviceContainer)])}return this.trackDebugAdapter(i,s),this.updateDebugContextKey(),new Kp.DebugAdapterInlineImplementation(s)}else Kp.window.showInformationMessage(y.kernelWasNotStarted).then(h,h)}};Xb=v([(0,Mu.injectable)(),m(0,(0,Mu.inject)(ye)),m(1,(0,Mu.inject)(He)),m(2,(0,Mu.inject)(oe)),m(3,(0,Mu.inject)(xr)),m(4,(0,Mu.inject)(Ui)),m(5,(0,Mu.inject)(Ze))],Xb);var Dw=k(N()),fQ=require("vscode");var Zb=class{constructor(e,t){this.disposableRegistry=t;this.activeTrackers=new WeakMap;this.activeTrackersById=new Map;this.updatedEmitter=new fQ.EventEmitter;t.push(e.registerDebugAdapterTrackerFactory("python",this))}createDebugAdapterTracker(e){let t=new Hb(e.id);return this.activeTrackers.set(e,t),this.activeTrackersById.set(e.id,t),t.sessionEnded(()=>{this.activeTrackers.delete(e),this.activeTrackersById.delete(e.id)},this,this.disposableRegistry),t.debugLocationUpdated(this.onLocationUpdated,this,this.disposableRegistry),this.onLocationUpdated(),t}get updated(){return this.updatedEmitter.event}getLocation(e){let t=this.activeTrackers.get(e)||this.activeTrackersById.get(e.id);if(t)return t.debugLocation}onLocationUpdated(){this.updatedEmitter.fire()}};Zb=v([(0,Dw.injectable)(),m(0,(0,Dw.inject)(Ui)),m(1,(0,Dw.inject)(K))],Zb);var W0=k(N()),vQ=k(require("net"));var jf=require("vscode");var gQ=require("events"),hQ=`\r
\r
`,U0=class{constructor(){this.rawData=Buffer.concat([]);this.contentLength=-1;this.disposed=!1;this.dataCallbackHandler=e=>{this.handleData(e)};this.events=new gQ.EventEmitter}dispose(){this.stream&&(this.stream.removeListener("data",this.dataCallbackHandler),this.stream=void 0)}connect(e){this.stream=e,e.addListener("data",this.dataCallbackHandler)}on(e,t){return this.events.on(e,t),this}once(e,t){return this.events.once(e,t),this}dispatch(e){let t=JSON.parse(e);switch(t.type){case"event":{let r=t;typeof r.event=="string"&&this.events.emit(`${t.type}_${r.event}`,r);break}case"request":{let r=t;typeof r.command=="string"&&this.events.emit(`${t.type}_${r.command}`,r);break}case"response":{let r=t;typeof r.command=="string"&&this.events.emit(`${t.type}_${r.command}`,r);break}default:this.events.emit(`${t.type}`,t)}this.events.emit("data",t)}handleData(e){if(!this.disposed)for(this.rawData=Buffer.concat([this.rawData,e]);;){if(this.contentLength>=0){if(this.rawData.length>=this.contentLength){let t=this.rawData.toString("utf8",0,this.contentLength);this.rawData=this.rawData.slice(this.contentLength),this.contentLength=-1,t.length>0&&this.dispatch(t);continue}}else{let t=this.rawData.indexOf(hQ);if(t!==-1){let i=this.rawData.toString("utf8",0,t).split(`\r
`);for(let o of i){let s=o.split(/: +/);s[0]==="Content-Length"&&(this.contentLength=+s[1])}this.rawData=this.rawData.slice(t+hQ.length);continue}}break}}};var QF=class{constructor(e,t,r){this._id=e;this._configuration=t;this.customRequestHandler=r;this._name="JupyterDebugSession";}get id(){return this._id}get type(){return"python"}get name(){return this._name}get workspaceFolder(){}get configuration(){return this._configuration}customRequest(e,t){return this.customRequestHandler(e,t)}getDebugProtocolBreakpoint(e){return Promise.resolve(void 0)}},eI=class{constructor(e){this.sequence=1;this.breakpointEmitter=new jf.EventEmitter;this.debugAdapterTrackerFactories=[];this.debugAdapterTrackers=[];this.sessionChangedEvent=new jf.EventEmitter;this.sessionStartedEvent=new jf.EventEmitter;this.sessionTerminatedEvent=new jf.EventEmitter;this.sessionCustomEvent=new jf.EventEmitter;this.breakpointsChangedEvent=new jf.EventEmitter;this._breakpoints=[];e.push(this),this.protocolParser=new U0}dispose(){this.socket&&(this.socket.end(),this.socket=void 0)}get activeDebugSession(){return this.session}get activeDebugConsole(){return{append(e){},appendLine(e){}}}get breakpoints(){return this._breakpoints}get onDidChangeActiveDebugSession(){return this.sessionChangedEvent.event}get onDidStartDebugSession(){return this.sessionStartedEvent.event}get onDidReceiveDebugSessionCustomEvent(){return this.sessionCustomEvent.event}get onDidTerminateDebugSession(){return this.sessionTerminatedEvent.event}get onDidChangeBreakpoints(){return this.breakpointsChangedEvent.event}registerDebugConfigurationProvider(e,t){return{dispose:()=>{}}}registerDebugAdapterTrackerFactory(e,t){return this.debugAdapterTrackerFactories.push(t),{dispose:()=>{this.debugAdapterTrackerFactories=this.debugAdapterTrackerFactories.filter(r=>r!==t)}}}startRunByLine(e){return this.startDebugging(void 0,e)}startDebugging(e,t,r){let i=t;return i.port?(this.session=new QF(lr(),i,this.sendCustomRequest.bind(this)),this.sessionChangedEvent.fire(this.session),this.debugAdapterTrackers=this.debugAdapterTrackerFactories.map(o=>o.createDebugAdapterTracker(this.session)),this.socket=vQ.createConnection(i.port),this.protocolParser.connect(this.socket),this.protocolParser.on("event_stopped",this.onBreakpoint.bind(this)),this.protocolParser.on("event_output",this.onOutput.bind(this)),this.protocolParser.on("event_terminated",this.sendToTrackers.bind(this)),this.socket.on("error",this.onError.bind(this)),this.socket.on("close",this.onClose.bind(this)),this.sendStartSequence(i,this.session.id).then(()=>!0)):Promise.resolve(!0)}addBreakpoints(e){this._breakpoints=this._breakpoints.concat(e)}removeBreakpoints(e){}get onBreakpointHit(){return this.breakpointEmitter.event}async continue(){await this.sendMessage("continue",{threadId:0}),this.sendToTrackers({type:"event",event:"continue"})}async step(){await this.sendMessage("stepIn",{threadId:this._stoppedThreadId?this._stoppedThreadId:1}),this.sendToTrackers({type:"event",event:"stepIn"})}async getStack(){let e=ne();return this.protocolParser.once("response_stackTrace",t=>{this.sendToTrackers(t);let r=t,i=r.body.stackFrames?r.body.stackFrames:[];e.resolve(i),this._topFrameId=i[0]?.id}),await this.emitMessage("stackTrace",{threadId:this._stoppedThreadId?this._stoppedThreadId:1,startFrame:0,levels:1}),e.promise}async requestVariables(){await this.getStack();let e=ne(),t=0;return this.protocolParser.once("response_scopes",r=>{this.sendToTrackers(r);let i=r;i&&(t=i.body.scopes[0].variablesReference),this.emitMessage("variables",{threadId:this._stoppedThreadId?this._stoppedThreadId:1,variablesReference:t}).catch(h)}),this.protocolParser.once("response_variables",r=>{this.sendToTrackers(r),e.resolve()}),await this.emitMessage("scopes",{frameId:this._topFrameId?this._topFrameId:1}),e.promise}stop(){this.onClose()}sendToTrackers(e){switch(e.type){case"request":this.debugAdapterTrackers.forEach(t=>{t.onWillReceiveMessage&&t.onWillReceiveMessage(e)});break;default:this.debugAdapterTrackers.forEach(t=>t.onDidSendMessage(e));break}}sendCustomRequest(e,t){return this.sendMessage(e,t)}async sendStartSequence(e,t){p.info("Sending debugger initialize..."),await this.sendInitialize(),this._breakpoints.length>0&&(p.info("Sending breakpoints"),await this.sendBreakpoints()),p.info("Sending debugger attach...");let r=this.sendAttach(e,t);return p.info("Sending configuration done"),await this.sendConfigurationDone(),p.info("Session started."),r.then(()=>{this.sessionStartedEvent.fire(this.session)})}sendBreakpoints(){let e=this._breakpoints.map(r=>r),t=e[0].location.uri.fsPath;return this.sendMessage("setBreakpoints",{source:{name:Ce(t),path:t},lines:e.map(r=>r.location.range.start.line),breakpoints:e.map(r=>({line:r.location.range.start.line})),sourceModified:!0})}sendAttach(e,t){return this.sendMessage("attach",{debugOptions:["RedirectOutput","FixFilePathCase","WindowsClient","ShowReturnValue"],workspaceFolder:Yo,__sessionId:t,...e})}sendConfigurationDone(){return this.sendMessage("configurationDone")}sendInitialize(){return this.sendMessage("initialize",{clientID:"vscode",clientName:"Visual Studio Code",adapterID:"python",pathFormat:"path",linesStartAt1:!0,columnsStartAt1:!0,supportsVariableType:!0,supportsVariablePaging:!0,supportsRunInTerminalRequest:!0,locale:"en-us"})}sendDisconnect(){return this.sendMessage("disconnect",{})}sendMessage(e,t){let r=ne(),i=this.sessionTerminatedEvent.event(()=>{r.resolve({body:{}})}),o=this.sequence;return this.protocolParser.on(`response_${e}`,s=>{s.request_seq===o&&(this.sendToTrackers(s),p.info(`Received response from debugger: ${JSON.stringify(t)}`),i.dispose(),r.resolve(s.body))}),this.socket?.on("error",s=>r.reject(s)),this.emitMessage(e,t).catch(s=>{p.error(`Exception attempting to emit ${e} to debugger: `,s)}),r.promise}emitMessage(e,t){return new Promise((r,i)=>{try{if(this.socket){let o={command:e,arguments:t,type:"request",seq:this.sequence};this.sequence+=1;let s=JSON.stringify(o);p.info(`Sending request to debugger: ${s}`);let a=`Content-Length: ${s.length}\r
\r
${s}`;this.socket.write(a,l=>{this.sendToTrackers(o),r()})}}catch(o){i(o)}})}onBreakpoint(e){this._stoppedThreadId=e.body.threadId,this.sendToTrackers(e),this.breakpointEmitter.fire()}onOutput(e){this.sendToTrackers(e),p.info(JSON.stringify(e))}onError(e){this.sendToTrackers(e),p.info(JSON.stringify(e))}onClose(){this.socket&&(this.sessionTerminatedEvent.fire(this.activeDebugSession),this.session=void 0,this.sessionChangedEvent.fire(void 0),this.debugAdapterTrackers.forEach(e=>e.onExit?e.onExit(0,void 0):void 0),this.debugAdapterTrackers=[],this.sendDisconnect().catch(h),this.socket.destroy(),this.socket=void 0)}};eI=v([(0,W0.injectable)(),m(0,(0,W0.inject)(K))],eI);var fc=k(N()),Bf=require("vscode");var tI=class{constructor(e,t,r){this.vscodeDebugService=t;this.jupyterDebugService=r;this.sessionChangedEvent=new Bf.EventEmitter;this.sessionStartedEvent=new Bf.EventEmitter;this.sessionTerminatedEvent=new Bf.EventEmitter;this.sessionCustomEvent=new Bf.EventEmitter;e.push(t.onDidTerminateDebugSession(this.endedDebugSession.bind(this))),e.push(t.onDidStartDebugSession(this.startedDebugSession.bind(this))),e.push(t.onDidChangeActiveDebugSession(this.changedDebugSession.bind(this))),e.push(t.onDidReceiveDebugSessionCustomEvent(this.gotCustomEvent.bind(this))),r&&(e.push(r.onDidTerminateDebugSession(this.endedDebugSession.bind(this))),e.push(r.onDidStartDebugSession(this.startedDebugSession.bind(this))),e.push(r.onDidChangeActiveDebugSession(this.changedDebugSession.bind(this))),e.push(r.onDidReceiveDebugSessionCustomEvent(this.gotCustomEvent.bind(this))))}get activeDebugSession(){return this.activeService.activeDebugSession}get activeDebugConsole(){return this.activeService.activeDebugConsole}get breakpoints(){return this.activeService.breakpoints}get onDidChangeActiveDebugSession(){return this.sessionChangedEvent.event}get onDidStartDebugSession(){return this.sessionStartedEvent.event}get onDidReceiveDebugSessionCustomEvent(){return this.sessionCustomEvent.event}get onDidTerminateDebugSession(){return this.sessionTerminatedEvent.event}get onDidChangeBreakpoints(){return this.activeService.onDidChangeBreakpoints}get onBreakpointHit(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");return this.jupyterDebugService.onBreakpointHit}startRunByLine(e){if(this.lastStartedService=this.jupyterDebugService,!this.jupyterDebugService)throw new Error("No jupyter debugger service");return this.jupyterDebugService.startRunByLine(e)}registerDebugConfigurationProvider(e,t){let r=this.vscodeDebugService.registerDebugConfigurationProvider(e,t);if(this.jupyterDebugService){let i=this.jupyterDebugService.registerDebugConfigurationProvider(e,t);return this.combineDisposables(r,i)}return r}registerDebugAdapterTrackerFactory(e,t){let r=this.vscodeDebugService.registerDebugAdapterTrackerFactory(e,t);if(this.jupyterDebugService){let i=this.jupyterDebugService.registerDebugAdapterTrackerFactory(e,t);return this.combineDisposables(r,i)}return r}startDebugging(e,t,r){return this.lastStartedService=this.vscodeDebugService,this.vscodeDebugService.startDebugging(e,t,r)}addBreakpoints(e){return this.activeService.addBreakpoints(e)}removeBreakpoints(e){return this.activeService.removeBreakpoints(e)}getStack(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");if(this.lastStartedService===this.jupyterDebugService)return this.jupyterDebugService.getStack();throw new Error("Requesting jupyter specific stack when not debugging.")}step(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");if(this.lastStartedService===this.jupyterDebugService)return this.jupyterDebugService.step();throw new Error("Requesting jupyter specific step when not debugging.")}continue(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");if(this.lastStartedService===this.jupyterDebugService)return this.jupyterDebugService.continue();throw new Error("Requesting jupyter specific step when not debugging.")}requestVariables(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");if(this.lastStartedService===this.jupyterDebugService)return this.jupyterDebugService.requestVariables();throw new Error("Requesting jupyter specific variables when not debugging.")}stop(){this.jupyterDebugService&&this.lastStartedService===this.jupyterDebugService?this.jupyterDebugService.stop():Bf.commands.executeCommand("workbench.action.debug.stop").then(h,h)}get activeService(){return this.lastStartedService?this.lastStartedService:this.vscodeDebugService}combineDisposables(e,t){return{dispose:()=>{e.dispose(),t.dispose()}}}endedDebugSession(e){this.sessionTerminatedEvent.fire(e),this.lastStartedService=void 0}startedDebugSession(e){this.sessionStartedEvent.fire(e)}changedDebugSession(e){this.sessionChangedEvent.fire(e)}gotCustomEvent(e){this.sessionCustomEvent.fire(e)}};tI=v([(0,fc.injectable)(),m(0,(0,fc.inject)(K)),m(1,(0,fc.inject)(Ui)),m(2,(0,fc.optional)()),m(2,(0,fc.inject)(Ja)),m(2,(0,fc.named)(Le.RUN_BY_LINE_DEBUGSERVICE))],tI);var Ou=k(N());var $0=require("vscode");var rI=Symbol("IFileConverter"),Op=Symbol("IExportBase"),Avt=Symbol("IExport"),Fp=Symbol("IExportUtil");var B0=k(N()),yQ=k(require("os"));var nI=require("vscode");var _w=require("vscode");var ife={PDF:["pdf"]},ofe={HTML:["html","htm"]},sfe={Python:["py"]},hc=class{async showDialog(e,t,r){let i={},o;switch(e){case"python":i=sfe,o=".py";break;case"pdf":o=".pdf",i=ife;break;case"html":o=".html",i=ofe;break;case"ipynb":o=".ipynb";let l=y.exportDialogFilter;i[l]=["ipynb"];break;default:return}let s=r||!t?r||"":`${Ce(t.path,Qi(t.path))}${o}`,a={defaultUri:await this.getDefaultUri(t,s),saveLabel:y.exportButtonTitle,filters:i};return _w.window.showSaveDialog(a)}async getDefaultUri(e,t){if(e&&e.scheme==="untitled"&&Lr())return;if(!e||e.scheme==="file"||e.scheme==="untitled"||e.scheme==="vscode-interactive"){let i=Se.instance.get(Vx);return _w.Uri.file(Ve(await i.computeWorkingDirectory(e),t))}let r=Ve(it(e.path),t);return _w.Uri.parse(`${e.scheme}://${r}`).with({authority:e.authority})}};var V0=class{async getContent(e){let t=nI.extensions.getExtension("vscode.ipynb");if(!t)throw new Error("Unable to export notebook as the built-in vscode.ipynb extension is currently unavailable.");t.isActive||await t.activate();let i=e.getCells().map(s=>{let a=new nI.NotebookCellData(s.kind,s.document.getText(),s.document.languageId);return a.metadata=s.metadata,a.mime=s.mime,a.outputs=[...s.outputs],a}),o=new nI.NotebookData(i);return o.metadata=JSON.parse(JSON.stringify(e.metadata)),t.exports.exportNotebook(o)}async getTargetFile(e,t,r){return await new hc().showDialog(e,t,r)}};var j0=require("vscode");var iI=class extends V0{constructor(t){super();this.fs=t}async getTargetFile(t,r,i){let o;return t!=="python"?o=await new hc().showDialog(t,r,i):o=j0.Uri.file((await this.fs.createTemporaryLocalFile(".py")).filePath),o}};iI=v([(0,B0.injectable)(),m(0,(0,B0.inject)(gr))],iI);var Tw=class{async generateTempDir(){let e=j0.Uri.file(Ve(yQ.tmpdir(),lr())),t=Se.instance.get(gr);return await t.createDirectory(e),{path:Ae(e),dispose:async()=>{let r=0;for(;r<10;)try{await t.delete(e),r=10}catch{await Hn(3e3),r+=1}}}}async makeFileInDirectory(e,t,r){let i=Ve(r,t);return await Se.instance.get(gr).writeFile(j0.Uri.file(i),e),i}};async function bQ(n){let e=JSON.parse(n);for(let t of e.cells){let r="outputs"in t?t.outputs:void 0;r&&Array.isArray(r)&&afe(r)}return JSON.stringify(e,void 0,4)}function afe(n){let e="image/svg+xml",t="image/png";for(let r of n)if("data"in r){let i=r.data;if(!(e in i))continue;t in i&&delete i[e]}}var oI=k(N());var Ku=class{constructor(e,t,r){this.dependencyManager=e;this.nbConvertDependencyChecker=t;this.jupyterInterpreterService=r}async getExportInterpreter(e){if(e&&await this.checkNotebookInterpreter(e))return e;let t=await this.jupyterInterpreterService.getSelectedInterpreter();if(t||await this.jupyterInterpreterService.selectInterpreter(),t){if(await this.checkNotebookInterpreter(t))return t;if(await this.dependencyManager.installMissingDependencies(),await this.checkNotebookInterpreter(t))return t}throw new Error(y.jupyterNbConvertNotSupported)}async checkNotebookInterpreter(e){return this.nbConvertDependencyChecker.isNbConvertInstalled(e)}};Ku=v([(0,oI.injectable)(),m(0,(0,oI.inject)(Md)),m(1,(0,oI.inject)(Fg)),m(2,(0,oI.inject)(vi))],Ku);var $f=class{constructor(e,t,r,i,o,s){this.pythonExecutionFactory=e;this.jupyterService=t;this.fs=r;this.exportUtil=i;this.importer=o;this.exportInterpreterFinder=s}async export(e,t,r,i){}async executeCommand(e,t,r,i,o){if(o.isCancellationRequested)return;if(i=await this.exportInterpreterFinder.getExportInterpreter(i),r==="python"){let g=await this.importer.importFromFile(e.uri,i);await this.fs.writeFile(t,g);return}let s=await this.exportUtil.getContent(e);r==="pdf"&&(s=await bQ(s));let a=await new Tw().generateTempDir(),l=await this.makeSourceFile(t,s,a),c=await this.getExecutionService(l,i);if(!c||o.isCancellationRequested)return;let u=await this.fs.createTemporaryLocalFile(Qi(t.fsPath)),d=[l.fsPath,"--to",r,"--output",Ce(u.filePath),"--output-dir",it(u.filePath),"--debug"],f=await c.execModule("jupyter",["nbconvert"].concat(d),{throwOnStdErr:!1,encoding:"utf8",token:o});if(o.isCancellationRequested){u.dispose();return}try{if((await this.fs.stat($0.Uri.file(u.filePath))).size>1)await this.fs.copy($0.Uri.file(u.filePath),t);else throw new Error("File size is zero during conversion. Outputting error.")}catch{throw new Error(f.stderr)}finally{u.dispose()}}async makeSourceFile(e,t,r){let i=Ce(e.fsPath,Qi(e.fsPath)),o=await new Tw().makeFileInDirectory(t,`${i}.ipynb`,r.path);return $0.Uri.file(o)}async getExecutionService(e,t){return this.pythonExecutionFactory.createActivatedEnvironment({resource:e,interpreter:t})}};v([qv("PerformingExport")],$f.prototype,"executeCommand",1),$f=v([(0,Ou.injectable)(),m(0,(0,Ou.inject)(Vr)),m(1,(0,Ou.inject)(lp)),m(2,(0,Ou.inject)(gr)),m(3,(0,Ou.inject)(Fp)),m(4,(0,Ou.inject)(xx)),m(5,(0,Ou.inject)(Ku))],$f);var Jf=k(N());var Fu=require("vscode");var sI=class{constructor(){this.fs=Se.instance.get(nt)}async openFile(e,t,r=!1){if(e==="python")await this.openPythonFile(t,r),T("DATASCIENCE.EXPORT_NOTEBOOK_AS",void 0,{format:e,successful:!0,opened:!0});else{let i=await this.askOpenFile(t,r);T("DATASCIENCE.EXPORT_NOTEBOOK_AS",void 0,{format:e,successful:!0,opened:i})}}async openPythonFile(e,t){let r;if(t)r=await Fu.window.showTextDocument(e);else{let i=await this.fs.readFile(e);await this.fs.delete(e);let o=await Fu.workspace.openTextDocument({language:ge,content:i});r=await Fu.window.showTextDocument(o)}await r.edit(i=>{i.insert(new Fu.Position(r.document.lineCount,0),`
`)})}async askOpenFile(e,t){let r=y.openExportFileYes,i=y.openExportFileNo,o=[r,i];return await Fu.window.showInformationMessage(y.openExportedFileMessage,...o).then(a=>a)===r?(t?Fu.window.showTextDocument(e).then(h,h):qd(e.toString()),!0):!1}};var z0=k(N()),Q0=require("vscode");var J0=class{async export(e,t,r,i){await Se.instance.get(Op).executeCommand(e,t,"python",r,i)}};var q0=class{async export(e,t,r,i){await Se.instance.get(Op).executeCommand(e,t,"pdf",r,i)}};var H0=class{async export(e,t,r,i){await Se.instance.get(Op).executeCommand(e,t,"html",r,i)}};var YF=require("vscode");var G0=class{constructor(){this.fs=Se.instance.get(nt),this.configuration=Se.instance.get(oe),this.platform=Se.instance.get(xr)}async writeFile(e,t){await this.fs.writeFile(e,t)}getEOL(){return this.platform.isWindows?`\r
`:`
`}async export(e,t,r){if(r.isCancellationRequested)return;let i=this.exportDocument(e);await this.writeFile(t,i)}exportDocument(e){return e.getCells().filter(t=>!t.metadata?.isInteractiveWindowMessageCell).reduce((t,r)=>t+this.exportCell(r),"")}exportCell(e){if(e.document.lineCount){let t=this.cellMarker(e),r=this.getEOL();switch(e.kind){case YF.NotebookCellKind.Code:return`${t}${r}${this.exportCodeCell(e)}${r}${r}`;case YF.NotebookCellKind.Markup:return`${t} [markdown]${r}${this.exportMarkdownCell(e)}${r}${r}`}}return""}exportCodeCell(e){let t=Be(e.document.getText(),{trim:!1,removeEmptyEntries:!1}),r=this.configuration.getSettings(e.notebook.uri).pythonExportMethod==="commentMagics";return vg(t,this.getEOL(),r?lfe:void 0).join("")}exportMarkdownCell(e){let t=Be(e.document.getText(),{trim:!1,removeEmptyEntries:!1});return vg(t,this.getEOL(),cfe).join("")}cellMarker(e){let t=this.configuration.getSettings(e.notebook.uri);return e.metadata.interactiveWindowCellMarker??t.defaultCellMarker}};function lfe(n){return/^\s*!/.test(n)||/^\s*%/.test(n)?`# ${n}`:n}function cfe(n){return`# ${n}`}var aI=class{constructor(e,t,r){this.exportUtil=e;this.progressReporter=t;this.configuration=r}async importIpynb(e){let t=this.progressReporter.createProgressIndicator(y.importingIpynb,!0);try{let r=await Q0.workspace.openNotebookDocument(e);await this.exportImpl("python",r,void 0,t.token)}finally{t.dispose()}}async export(e,t,r,i){let o=this.progressReporter.createProgressIndicator(y.exportingToFormat(e.toString()),!0);try{await this.exportImpl(e,t,r,o.token,i)}finally{o.dispose()}if(o.token.isCancellationRequested){T("DATASCIENCE.EXPORT_NOTEBOOK_AS",void 0,{format:e,cancelled:!0});return}}async exportImpl(e,t,r,i,o){try{let s=await this.exportUtil.getTargetFile(e,t.uri,r);if(!s)return;await this.performExport(e,t,s,i,o)}catch(s){p.error("Export failed",s),T("DATASCIENCE.EXPORT_NOTEBOOK_AS_FAILED",void 0,{format:e}),e==="pdf"&&p.error(y.exportToPDFDependencyMessage),this.showExportFailed(y.exportFailedGeneralMessage)}}async performExport(e,t,r,i,o){e==="python"&&this.configuration.getSettings(t.uri).pythonExportMethod!=="nbconvert"?await this.performPlainExport(e,t,r,i):await this.performNbConvertExport(t,e,r,o,i),r&&this.openExportedFile(e,r).catch(h)}async openExportedFile(e,t){await new sI().openFile(e,t,!0).catch(h)}async performPlainExport(e,t,r,i){if(r)switch(e){case"python":await new G0().export(t,r,i);break}return r}async performNbConvertExport(e,t,r,i,o){try{return await this.exportToFormat(e,r,t,i,o)}finally{}}async exportToFormat(e,t,r,i,o){switch(r){case"python":return new J0().export(e,t,i,o);case"pdf":return new q0().export(e,t,i,o);case"html":return new H0().export(e,t,i,o);default:break}}showExportFailed(e){Q0.window.showErrorMessage(`${y.failedExportMessage} ${e}`)}};aI=v([m(0,(0,z0.inject)(Fp)),m(1,(0,z0.inject)(es)),m(2,(0,z0.inject)(oe))],aI);var lI=class extends aI{constructor(t,r,i,o){super(t,i,o);this.exportUtil=t;this.fs=r}async openExportedFile(t,r){await new sI().openFile(t,r).catch(h)}};lI=v([(0,Jf.injectable)(),m(0,(0,Jf.inject)(Fp)),m(1,(0,Jf.inject)(gr)),m(2,(0,Jf.inject)(es)),m(3,(0,Jf.inject)(oe))],lI);var Aw=k(N()),qf=require("vscode");var Rw=require("vscode");var XF=new WeakMap;async function vc(n,e){let t=n;if(n.isClosed)return!0;let r=XF.has(t)?XF.get(t):Promise.resolve(),i=ne(),o=r.finally(async()=>{let s=new Rw.WorkspaceEdit,a=e(s);sd(a)&&await a,await Rw.workspace.applyEdit(s).then(l=>i.resolve(l),l=>i.reject(l))}).catch(h);return XF.set(t,o),i.promise}var cI=class{constructor(e,t){this.disposables=e;this.controllerRegistration=t}activate(){this.controllerRegistration.onControllerSelected(this.onDidChangeNotebookController,this,this.disposables)}async onDidChangeNotebookController(e){let t=e.notebook,r=e.controller.connection;if(!St(t))return;let i=qf.window.visibleNotebookEditors.find(u=>u.notebook===t);if(!i)return;let o=t.getCells().filter(u=>u.kind===qf.NotebookCellKind.Code&&u.document.getText().trim().length===0),s=t.getCells().filter(u=>u.kind===qf.NotebookCellKind.Code).length;if(o.length===0||o.length!==s)return;let a,l=r.kind;switch(r.kind){case"connectToLiveRemoteKernel":{a=r.kernelModel.language;break}case"startUsingRemoteKernelSpec":case"startUsingLocalKernelSpec":{a=r.kernelSpec.language;break}case"startUsingPythonInterpreter":{a=ge;break}default:{p.error(`Unsupported kernel kind encountered ${l}`);return}}if(!a)return;let c=Tl(a);vc(i.notebook,async()=>{await o.map(async u=>{if(c.toLowerCase()!==u.document.languageId)return qf.languages.setTextDocumentLanguage(u.document,c).then(h,h)})}).then(h,h)}};cI=v([(0,Aw.injectable)(),m(0,(0,Aw.inject)(K)),m(1,(0,Aw.inject)(He))],cI);var Xs=k(N()),rr=require("vscode");var Nw=Symbol("INotebookCommandHandler"),uI=class{constructor(e,t,r,i,o,s,a,l,c){this.disposableRegistry=e;this.languageService=t;this.configurationService=r;this.kernelProvider=i;this.controllerRegistration=o;this.errorHandler=s;this.notebookEditorProvider=a;this.serviceContainer=l;this.kernelStatusProvider=c;this.kernelInterruptedDontAskToRestart=!1;this.pendingRestartInterrupt=new WeakMap}activate(){this.register()}register(){this.disposableRegistry.push(rr.commands.registerCommand(J.NotebookEditorRemoveAllCells,()=>this.removeAllCells())),this.disposableRegistry.push(rr.commands.registerCommand(J.NotebookEditorRunAllCells,()=>this.runAllCells())),this.disposableRegistry.push(rr.commands.registerCommand(J.NotebookEditorAddCellBelow,()=>this.addCellBelow())),this.disposableRegistry.push(rr.commands.registerCommand(J.RestartKernelAndRunUpToSelectedCell,()=>this.restartKernelAndRunUpToSelectedCell())),this.disposableRegistry.push(rr.commands.registerCommand(J.RestartKernel,e=>e&&"notebookEditor"in e?this.restartKernelImpl(e?.notebookEditor?.notebookUri).catch(h):this.restartKernelImpl(e).catch(h))),this.disposableRegistry.push(rr.commands.registerCommand(J.InterruptKernel,e=>this.interruptKernel(e?.notebookEditor?.notebookUri))),this.disposableRegistry.push(rr.commands.registerCommand(J.RestartKernelAndRunAllCells,e=>{e&&"notebookEditor"in e?this.restartKernelAndRunAllCells(e?.notebookEditor?.notebookUri).catch(h):this.restartKernelAndRunAllCells(e).catch(h)}))}runAllCells(){rr.window.activeNotebookEditor&&rr.commands.executeCommand("notebook.execute").then(h,h)}addCellBelow(){rr.window.activeNotebookEditor&&rr.commands.executeCommand("notebook.cell.insertCodeCellBelow").then(h,h)}removeAllCells(){let e=rr.window.activeNotebookEditor?.notebook;if(!e)return;let t=this.languageService.getPreferredLanguage(Mi(e));vc(e,r=>{let i=rr.NotebookEdit.replaceCells(new rr.NotebookRange(0,e.cellCount),[new rr.NotebookCellData(rr.NotebookCellKind.Code,"",t)]);r.set(e.uri,[i])}).then(h,h)}async interruptKernel(e){let t=e??this.notebookEditorProvider.activeNotebookEditor?.notebook.uri,r=rr.workspace.notebookDocuments.find(o=>o.uri.toString()===t?.toString());if(r===void 0)return;p.debug(`Command interrupted kernel for ${M(r.uri)}`);let i=this.kernelProvider.get(r);if(!i){p.info("Interrupt requested & no kernel.");return}await this.wrapKernelMethod("interrupt",i)}async restartKernelAndRunAllCells(e){await this.restartKernelImpl(e),this.runAllCells()}async restartKernelAndRunUpToSelectedCell(){let e=this.notebookEditorProvider.activeNotebookEditor;e&&(await this.restartKernelImpl(e.notebook.uri),rr.commands.executeCommand("notebook.cell.execute",{ranges:[{start:0,end:e.selection.end}],document:e.notebook.uri}).then(h,h))}async restartKernelImpl(e){let t=e??this.notebookEditorProvider.activeNotebookEditor?.notebook.uri,r=rr.workspace.notebookDocuments.find(o=>o.uri.toString()===t?.toString());if(r===void 0)return;let i=this.kernelProvider.get(r);if(i)if(p.debug(`Restart kernel command handler for ${M(r.uri)}`),await this.shouldAskForRestart(r.uri)){let o=y.restartKernelMessage,s=y.restartKernelMessageYes,a=y.restartKernelMessageDontAskAgain,l=await rr.window.showInformationMessage(o,{modal:!0},s,a);l===a?(await this.disableAskForRestart(r.uri),this.wrapKernelMethod("restart",i).catch(h)):l===s&&this.wrapKernelMethod("restart",i).catch(h)}else this.wrapKernelMethod("restart",i).catch(h)}async restartKernel(e,t=!1){let r=e??this.notebookEditorProvider.activeNotebookEditor?.notebook.uri,i=rr.workspace.notebookDocuments.find(s=>s.uri.toString()===r?.toString()),o=i?this.kernelProvider.get(i):void 0;if(o)return this.wrapKernelMethod("restart",o,t)}async wrapKernelMethod(e,t,r=!1){let i=t.notebook,o=this.pendingRestartInterrupt.get(t);if(o)return o;let s=(async()=>{let a=this.kernelProvider.getKernelExecution(t).pendingCells[0],l=this.controllerRegistration.getSelected(i),c=r&&e==="restart"?this.kernelStatusProvider.hideRestartProgress(t):new rr.Disposable(h);try{if(!l)throw new Error("No kernel associated with the notebook");await Qs.wrapKernelMethod(l.connection,e,t.creator,this.serviceContainer,{resource:t.resourceUri,notebook:i,controller:l.controller},new Mt(r),this.disposableRegistry)}catch(u){a?await Jc(a,t.controller,await this.errorHandler.getErrorMessageForDisplayInCellOutput(u,e,t.resourceUri),!1):rr.window.showErrorMessage(u.toString()).then(h,h)}finally{c.dispose()}})();return s.finally(()=>{this.pendingRestartInterrupt.get(t)===s&&this.pendingRestartInterrupt.delete(t)}).catch(h),this.pendingRestartInterrupt.set(t,s),s}async shouldAskForRestart(e){if(this.kernelInterruptedDontAskToRestart)return!1;let t=this.configurationService.getSettings(e);return t&&t.askForKernelRestart===!0}async disableAskForRestart(e){this.configurationService.getSettings(e)&&this.configurationService.updateSetting("askForKernelRestart",!1,void 0,rr.ConfigurationTarget.Global).catch(h)}};uI=v([(0,Xs.injectable)(),m(0,(0,Xs.inject)(K)),m(1,(0,Xs.inject)(us)),m(2,(0,Xs.inject)(oe)),m(3,(0,Xs.inject)(ye)),m(4,(0,Xs.inject)(He)),m(5,(0,Xs.inject)(Gr)),m(6,(0,Xs.inject)(Fn)),m(7,(0,Xs.inject)(Ze)),m(8,(0,Xs.inject)(aw))],uI);var IQ=k(N()),Lp=require("vscode");var dI=class{constructor(){this.providers=new Set}registerEmbedNotebookProvider(e){this.providers.add(e)}findNotebookEditor(e){let t=e?fn(e,!0):"false",r=to(e)==="notebook"?Lp.workspace.notebookDocuments.find(o=>fn(o.uri,!0)===t):void 0,i=r&&Lp.window.activeNotebookEditor?.notebook===r?Lp.window.activeNotebookEditor:void 0;if(i)return i;for(let o of this.providers){let s=o.findNotebookEditor(e);if(s)return s}}get activeNotebookEditor(){return this.findNotebookEditor(Lp.window.activeNotebookEditor?.notebook.uri)||this.findNotebookEditor(Lp.window.activeTextEditor?.document.uri)}findAssociatedNotebookDocument(e){let t=Ur()==="Windows",r=Lp.workspace.notebookDocuments.find(i=>t?i.uri.path.toLowerCase()===e.path.toLowerCase():i.uri.path===e.path);if(r)return r;for(let i of this.providers){let o=i.findAssociatedNotebookDocument(e);if(o)return o}}};dI=v([(0,IQ.injectable)()],dI);var mI=k(N()),SQ=require("vscode"),CQ=k(Qo());var pI=class extends Qt{constructor(t,r,i){super();this.controllerRegistration=t;this.kernelProvider=r;this.notebookEditorProvider=i;this._onDidChangeEnvironment=this._register(new SQ.EventEmitter);this.onDidChangeEnvironment=this._onDidChangeEnvironment.event;this.notebookWithRemoteKernelsToMonitor=new WeakSet;this.notebookPythonEnvironments=new WeakMap;this.monitorRemoteKernelStart(),this._register(this.controllerRegistration.onControllerSelected(o=>{if(!Xe(o.controller.connection)){this.notebookWithRemoteKernelsToMonitor.delete(o.notebook),this.notebookPythonEnvironments.has(o.notebook)&&(this.notebookPythonEnvironments.delete(o.notebook),this._onDidChangeEnvironment.fire(o.notebook.uri));return}Dt(o.controller.connection)?this.notebookWithRemoteKernelsToMonitor.add(o.notebook):(this.notebookWithRemoteKernelsToMonitor.delete(o.notebook),this.notifyLocalPythonEnvironment(o.notebook,o.controller))}))}getPythonEnvironment(t){let r=this.notebookEditorProvider.findAssociatedNotebookDocument(t);return r?this.notebookPythonEnvironments.get(r):void 0}monitorRemoteKernelStart(){let t=async r=>{if(!(!this.notebookWithRemoteKernelsToMonitor.has(r.notebook)||!Dt(r.kernelConnectionMetadata)||!Xe(r.kernelConnectionMetadata)))try{let i=await this.resolveRemotePythonEnvironment(r.notebook);if(this.controllerRegistration.getSelected(r.notebook)?.controller!==r.controller){p.trace(`Remote Python Env for ${qt(r.notebook.uri)} not determined as controller changed`);return}if(!i){p.trace(`Remote Python Env for ${qt(r.notebook.uri)} not determined as exe is empty`);return}this.notebookPythonEnvironments.set(r.notebook,i),this._onDidChangeEnvironment.fire(r.notebook.uri)}catch(i){p.error(`Failed to get Remote Python Env for ${qt(r.notebook.uri)}`,i)}};this._register(this.kernelProvider.onDidCreateKernel(t)),this._register(this.kernelProvider.onDidStartKernel(t))}notifyLocalPythonEnvironment(t,r){let i=this.kernelProvider.get(t)?.kernelConnectionMetadata||r.connection,o=i.interpreter;if(!Xe(i)||Dt(i)||!o)return;let s=mr(o);if(s){this.notebookPythonEnvironments.set(t,s),this._onDidChangeEnvironment.fire(t.uri);return}this.resolveAndNotifyLocalPythonEnvironment(t,r,o)}async resolveAndNotifyLocalPythonEnvironment(t,r,i){let o=await zh(i);if(!o){p.error(`Failed to get interpreter information for ${qt(t.uri)} && ${qt(i.uri)}`);return}if(this.controllerRegistration.getSelected(t)?.controller!==r.controller){p.trace(`Python Env for ${qt(t.uri)} not determined as controller changed`);return}this.notebookPythonEnvironments.set(t,o),this._onDidChangeEnvironment.fire(t.uri)}async resolveRemotePythonEnvironment(t){let r=this.kernelProvider.get(t);if(!r||!r.startedAtLeastOnce)return;let i=this.kernelProvider.getKernelExecution(r),o=`
import os as _VSCODE_os
import sys as _VSCODE_sys
import builtins as _VSCODE_builtins

if _VSCODE_os.path.exists(${Qy(__filename)}):
    _VSCODE_builtins.print(f"EXECUTABLE{_VSCODE_sys.executable}EXECUTABLE")

del _VSCODE_os, _VSCODE_sys, _VSCODE_builtins
`,a=(await i.executeHidden(o).catch(h)||[]).find(f=>f.output_type==="stream"&&f.name==="stdout");if(!a||!(a.text||"").toString().includes("EXECUTABLE"))return;let l=(a.text||"").toString();l=l.substring(l.indexOf("EXECUTABLE"));let c=l.split("EXECUTABLE").filter(f=>f.trim().length),u=c.length?c[0].trim():"";if(!u||!await CQ.pathExists(u))return;p.debug(`Remote Interpreter for Notebook URI "${qt(t.uri)}" is ${qt(u)}`);let d=mr(u)||await zh({id:u});if(d)return d;p.error(`Failed to get remote interpreter information for ${qt(t.uri)} && ${qt(u)}`)}};pI=v([(0,mI.injectable)(),m(0,(0,mI.inject)(He)),m(1,(0,mI.inject)(ye)),m(2,(0,mI.inject)(Fn))],pI);var Y0=k(N()),hI=require("vscode");var fI=class{constructor(e){this.sentMimeTypes=new Set;this.disposables=[];e.push(this)}activate(){this.isTelemetryDisabled=Mk(),hI.workspace.onDidOpenNotebookDocument(this.onDidOpenCloseDocument,this,this.disposables),hI.workspace.onDidCloseNotebookDocument(this.onDidOpenCloseDocument,this,this.disposables),hI.workspace.onDidSaveNotebookDocument(this.onDidOpenCloseDocument,this,this.disposables),ar.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,this.disposables),this.disposables.push(Kk(e=>this.isTelemetryDisabled=e))}dispose(){G(this.disposables)}async onDidChangeNotebookCellExecutionState(e){!St(e.cell.notebook)||this.isTelemetryDisabled||e.state!==1||this.checkCell(e.cell,"onExecution")}onDidOpenCloseDocument(e){!St(e)||this.isTelemetryDisabled||e.getCells().forEach(t=>this.checkCell(t,"onOpenCloseOrSave"))}checkCell(e,t){if(e.kind===hI.NotebookCellKind.Markup||e.document.languageId==="raw")return;let r=e.notebook.notebookType===It?"notebook":"interactive";e.outputs.map(i=>i.items.map(o=>o.mime)).flat().map(i=>this.sendTelemetry(i,t,r))}sendTelemetry(e,t,r){let i=`${e}-${t}`;this.sentMimeTypes.has(i)||(this.sentMimeTypes.add(i),e=e.replace(/\//g,"_").replace(/\\/g,"_"),T("DS_INTERNAL.CELL_OUTPUT_MIME_TYPE",void 0,{mimeType:e,when:t,resourceType:r}))}};fI=v([(0,Y0.injectable)(),m(0,(0,Y0.inject)(K))],fI);var X0=k(N());var ufe=/(;32m[ ->]*?)(\d+)(.*)/g,gI=class{constructor(e){this.configurationService=e}format(e,t){return e.notebook.notebookType!==It?t:t.map(r=>this.modifyTracebackFrameIPython(e,r))}modifyTracebackFrameIPython(e,t){return(this.configurationService.getSettings(e.document.uri)?.formatStackTraces??!1)&&/^[Cell|Input|File].*?\n.*/.test(t)?this.modifyTracebackFrameIPython8(e,t):t}modifyTracebackFrameIPython8(e,t){t=t.replace(/\u001b\[4\dm/g,""),t=t.replace(/\u001b\[38;.*?\d+m/g,"\x1B[39m"),t=t.replace(/(;32m[ ->]*?)(\d+)(.*)\n/g,(s,a,l,c)=>(c=c.replace(/\u001b\[3\d+m/g,"\x1B[39m"),`${a}${l}${c}
`)),p.ci(`Trace frame to match: ${t}`);let r=(s,a)=>{let l=s.replace(ufe,(u,d,f,g)=>{let b=parseInt(f,10);return`${d}<a href='${e.document.uri.toString()}?line=${b-1}'>${b}</a>${g}`}),c=y.cellAtFormat(Ae(e.document.uri),e.index+1);return l.replace(/.*?\n/,`\x1B[1;32m${c}\x1B[0m line \x1B[0;36m${a}
`)},i=/^Input.*?\[.*32mIn\s+\[(\d+).*?0;36m(.*?)\n.*/.exec(t);if(i&&i.length>1)return r(t,i[2]);let o=/Cell.*?\[.*32mIn\s*\[(\d+)\]\,\s+line\s+([(\d+)])(.*?)\n.*/gm.exec(t);return o&&o.length>1?r(t,o[2]):t}};gI=v([(0,X0.injectable)(),m(0,(0,X0.inject)(oe))],gI);var Ga=k(N());var vI=class{constructor(e,t,r,i,o,s){this.packages=e;this.installer=t;this.pythonExtensionChecker=r;this.disposables=i;this.interpreterService=o;this.notebookControllerManager=s}activate(){this.notebookControllerManager.onControllerSelected(this.onNotebookControllerSelected,this,this.disposables),this.installer?.onInstalled(this.onDidInstallPackage,this,this.disposables)}async onNotebookControllerSelected(e){e.controller.connection.interpreter&&(await ro(e.notebook.uri,{kernelConnection:e.controller.connection}),await this.packages.trackPackages(e.controller.connection.interpreter))}async onDidInstallPackage(e){if(this.pythonExtensionChecker.isPythonExtensionActive)if(ad(e.resource)){let t=await this.interpreterService.getActiveInterpreter(e.resource);await this.packages.trackPackages(t,!0)}else await this.packages.trackPackages(e.resource,!0)}};vI=v([(0,Ga.injectable)(),m(0,(0,Ga.inject)(Nd)),m(1,(0,Ga.inject)(ji)),m(1,(0,Ga.optional)()),m(2,(0,Ga.inject)(qe)),m(3,(0,Ga.inject)(K)),m(4,(0,Ga.inject)(rt)),m(5,(0,Ga.inject)(He))],vI);function EQ(n,e){sQ(n,e),n.addSingleton(me,Tf),n.addSingleton(Nw,uI),n.addBinding(Nw,me),n.addSingleton(Fn,dI),n.addSingleton(me,Nf),n.addSingleton(Pg,gI),n.addSingleton(Ja,eI,Le.RUN_BY_LINE_DEBUGSERVICE),n.addSingleton(Pp,Pp),n.addBinding(Pp,me),n.addSingleton(me,Db),n.addSingleton(me,vI),n.addSingleton(me,wb),n.addSingleton(us,us),n.addBinding(us,me),n.addSingleton(me,cI),n.addSingleton(Mp,Xb,void 0,[me]),n.addSingleton(me,qb),n.addSingleton(In,Gb,Le.DEBUGGER_VARIABLES),n.addSingleton(Ja,tI,Le.MULTIPLEXING_DEBUGSERVICE),n.addSingleton(_0,Zb,void 0,[D0]),n.addSingleton(me,Jb),n.addSingleton(me,fI),n.addSingleton(rI,lI),n.addSingleton(Ku,Ku),n.addSingleton(Op,$f),n.addSingleton(Fp,iI),n.addSingleton(jg,pI)}var jn=k(N()),st=require("vscode");var Up=Symbol("IDataScienceCodeLensProvider"),Z0=Symbol("ICodeWatcher"),e1=Symbol("ICodeLensFactory"),Wp=Symbol("ICellRangeCache"),jSt=Symbol("IGeneratedCodeStore"),Zs=Symbol("IGeneratedCodeStorageFactory"),yI=Symbol("ICodeGeneratorFactory");var t1=Symbol("IInteractiveWindowDebugger"),ii=Symbol("IInteractiveWindowProvider"),r1=Symbol("IInteractiveControllerHelper"),n1=Symbol("IInteractiveWindowDebuggingManager");var i1=require("vscode");async function o1(n){let e=await i1.workspace.openNotebookDocument(n);await i1.window.showNotebookDocument(e)}var ea=require("vscode");var No=class{constructor(e){this.codeMatchRegEx=this.createRegExp(e?e.codeRegularExpression:void 0,mm.PythonCellMarker),this.markdownMatchRegEx=this.createRegExp(e?e.markdownRegularExpression:void 0,mm.PythonMarkdownCellMarker),this.codeExecRegEx=new RegExp(`${this.codeMatchRegEx.source}(.*)`),this.markdownExecRegEx=new RegExp(`${this.markdownMatchRegEx.source}(.*)`),this.defaultCellMarker=e?.defaultCellMarker?e.defaultCellMarker:"# %%"}isCell(e){return this.isCode(e)||this.isMarkdown(e)}isMarkdown(e){return this.markdownMatchRegEx.test(e.trim())}isCode(e){return this.codeMatchRegEx.test(e.trim())||e.trim()===this.defaultCellMarker}getCellType(e){return this.isMarkdown(e)?"markdown":"code"}isEmptyCell(e){return this.stripFirstMarker(e).trim().length===0}stripFirstMarker(e){let t=Be(e,{trim:!1,removeEmptyEntries:!1});return t.length>0&&(this.isCode(t[0])||this.isMarkdown(t[0]))?t.slice(1).join(`
`):e}stripFirstMarkerNoConcat(e){return e.length>0&&(this.isCode(e[0])||this.isMarkdown(e[0]))?e.slice(1):e}getFirstMarker(e){let t=Be(e,{trim:!1,removeEmptyEntries:!1});if(t.length>0&&(this.isCode(t[0])||this.isMarkdown(t[0])))return t[0]}createRegExp(e,t){try{if(e)return new RegExp(e)}catch{}return t}};var ds=require("vscode");function wQ(n,e){let t=lt(n);return t?e==1?y.restartingKernelCustomHeader(t):y.startingNewKernelCustomHeader(t):e==1?y.restartingKernelHeader:y.startingNewKernelHeader}function PQ(n,e){let t=lt(n);return e==1?y.restartedKernelHeader(t||""):y.connectedKernelHeader(t||"")}function Mw(n){return n.kind===ds.NotebookCellKind.Markup&&n.metadata?.isInteractiveWindowMessageCell===!0}var s1=class{constructor(e,t,r){this.interactiveWindow=e;this.notebookDocument=t;this.isDeleted=!1;this.sysInfoCellPromise=this.getOrUpdate(r)}async resolveCell(){return await this.sysInfoCellPromise}async getOrUpdate(e){let t=await this.interactiveWindow.getAppendIndex()-1;if(t>=0){let r=this.notebookDocument.cellAt(t);if(Mw(r))return this.updateMessage(e)}return this.sysInfoCellPromise=this.createCell(e)}async createCell(e){let t;return await vc(this.notebookDocument,async r=>{let i=new ds.NotebookCellData(ds.NotebookCellKind.Markup,e,sC);i.metadata={isInteractiveWindowMessageCell:!0},t=await this.interactiveWindow.getAppendIndex();let o=ds.NotebookEdit.insertCells(t,[i]);r.set(this.notebookDocument.uri,[o])}),this.notebookDocument.cellAt(t)}async updateMessage(e){let t=await this.sysInfoCellPromise;return await vc(this.notebookDocument,r=>{if(t.index>=0&&!this.isDeleted&&Mw(t)){r.replace(t.document.uri,new ds.Range(0,0,t.document.lineCount,0),e),r.set(this.notebookDocument.uri,[ds.NotebookEdit.updateCellMetadata(t.index,{isInteractiveWindowMessageCell:!0})]);return}}),t}async deleteCell(){this.isDeleted=!0;let e=await this.sysInfoCellPromise;await vc(this.notebookDocument,t=>{if(e.index>=0&&Mw(e)){let r=ds.NotebookEdit.deleteCells(new ds.NotebookRange(e.index,e.index+1));t.set(this.notebookDocument.uri,[r]);return}})}};function a1(n){return/^#\s*!/.test(n)?/^#\s*!\s*%%?/.test(n)?n.replace(/^#\s*!\s*/,""):n.replace(/^#\s*/,""):n}function kQ(n,e){let t=e.isCell(n[0])&&n.length>1?n.slice(1):n;return new ea.NotebookCellData(ea.NotebookCellKind.Code,t.join(`
`),"python")}function xQ(n){return new ea.NotebookCellData(ea.NotebookCellKind.Markup,Qk(n).join(`
`),"markdown")}function pfe(n,e,t){let r=Be(e,{trim:!1}),i=r[0],o=new No(n);if(o.isMarkdown(i)){let s=-1;return Tm(r,(a,l)=>void 0,(a,l)=>{a&&a.length>0&&s===-1&&(s=t?l:-1)}),s>=0?[xQ(r.slice(0,s)),kQ(r.slice(s),o)]:[xQ(r)]}else return[kQ(r,o)]}function ZF(n,e){let t=new No(e),r=[];for(let i=0;i<n.lineCount;i+=1){let o=n.lineAt(i);if(t.isCell(o.text)){if(r.length>0){let s=r[r.length-1];s.range=new ea.Range(s.range.start,n.lineAt(i-1).range.end)}r.push({range:o.range,cell_type:t.getCellType(o.text)})}}if(r.length>=1){let i=n.lineAt(n.lineCount-1),o=r[r.length-1];o.range=new ea.Range(o.range.start,i.range.end)}return r}function DQ(n,e){let t=ZF(n,e);return Array.prototype.concat(...t.map(r=>{let i=n.getText(r.range);return pfe(e,i,!1)}))}function _Q(n){return n.getCells().filter(e=>!Mw(e)).map(e=>{let t=new ea.NotebookCellData(e.kind,e.document.getText(),e.kind===ea.NotebookCellKind.Code?e.document.languageId:"markdown");return e.kind===ea.NotebookCellKind.Code&&(t.outputs=[...e.outputs]),t.metadata=Ed(e),t})}var Kw=require("vscode");var eL=class{constructor(e,t,r){this.disposed=!1;this.dispose=()=>{this.disposed||(this.disposed=!0,this.timeout&&(clearTimeout(this.timeout),this.timeout=void 0),this.disposeCallback(),this.deferred.completed||this.deferred.resolve())};this.promise=()=>this.deferred.promise;this.reject=()=>{this.deferred.reject(),this.dispose()};this.deferred=ne(),this.disposeCallback=t,r&&(this.timeout=setTimeout(this.dispose,r))}},l1=class{constructor(){this.statusCount=0;this.incrementCount=()=>{this.statusCount+=1};this.decrementCount=()=>{let e=this.statusCount-1;this.statusCount=Math.max(e,0)}}set(e,t,r){this.incrementCount();let i=new eL(e,()=>this.decrementCount(),t),o={location:r?Kw.ProgressLocation.Notification:Kw.ProgressLocation.Window,title:e,cancellable:r!==void 0};return Kw.window.withProgress(o,(s,a)=>(a&&r&&a.onCancellationRequested(()=>{r(),i.reject()}),i.promise())).then(h,h),i}async waitWithStatus(e,t,r,i){let o=this.set(t,r,i),s;try{s=await e()}finally{o.dispose()}return s}};var ps=class{constructor(e,t,r,i,o,s,a,l,c,u,d,f){this.disposables=e;this.jupyterExporter=t;this.fileSystem=r;this.configuration=i;this.dataScienceCodeLensProvider=o;this.debugService=s;this.configService=a;this.interactiveWindowProvider=l;this.kernelProvider=c;this.dataScienceErrorHandler=u;this.ipynbProvider=d;this.fileConverter=f;this.statusProvider=new l1,st.workspace.isTrusted||st.workspace.onDidGrantWorkspaceTrust(this.registerCommandsIfTrusted,this,this.disposables)}activate(){this.registerCommandsIfTrusted(),this.registerCommand(J.InsertCellBelowPosition,this.insertCellBelowPosition),this.registerCommand(J.InsertCellBelow,this.insertCellBelow),this.registerCommand(J.InsertCellAbove,this.insertCellAbove),this.registerCommand(J.DeleteCells,this.deleteCells),this.registerCommand(J.SelectCell,this.selectCell),this.registerCommand(J.SelectCellContents,this.selectCellContents),this.registerCommand(J.ExtendSelectionByCellAbove,this.extendSelectionByCellAbove),this.registerCommand(J.ExtendSelectionByCellBelow,this.extendSelectionByCellBelow),this.registerCommand(J.MoveCellsUp,this.moveCellsUp),this.registerCommand(J.MoveCellsDown,this.moveCellsDown),this.registerCommand(J.ChangeCellToMarkdown,this.changeCellToMarkdown),this.registerCommand(J.ChangeCellToCode,this.changeCellToCode),this.registerCommand(J.GotoNextCellInFile,this.gotoNextCellInFile),this.registerCommand(J.GotoPrevCellInFile,this.gotoPrevCellInFile),this.registerCommand(J.AddCellBelow,this.addCellBelow),this.registerCommand(J.CreateNewNotebook,this.createNewNotebook),this.registerCommand(J.LatestExtension,this.openPythonExtensionPage),this.registerCommand(J.EnableLoadingWidgetsFrom3rdPartySource,this.enableLoadingWidgetScriptsFromThirdParty),this.registerCommand(J.CreateNewInteractive,e=>this.createNewInteractiveWindow(e)),this.registerCommand(J.ImportNotebookFile,(e,t="commandpalette")=>this.listenForErrors(()=>e?this.importNotebookOnFile(e):this.importNotebook())),st.commands.registerCommand(J.ExportFileAsNotebook,(e,t="commandpalette")=>this.listenForErrors(()=>{if(e)return this.exportFile(e);{let r=st.window.activeTextEditor;if(r&&r.document.languageId===ge)return this.exportFile(r.document.uri)}return Promise.resolve()})),this.registerCommand(J.ExpandAllCells,async e=>this.expandAllCells(e?.notebookEditor?.notebookUri)),this.registerCommand(J.CollapseAllCells,async e=>this.collapseAllCells(e?.notebookEditor?.notebookUri)),this.registerCommand(J.InteractiveExportAsNotebook,async e=>await this.export(e?.notebookEditor?.notebookUri)),this.registerCommand(J.InteractiveExportAs,e=>this.exportAs(e?.notebookEditor?.notebookUri)),this.registerCommand(J.ScrollToCell,(e,t)=>this.scrollToCell(e,t)),this.registerCommand(J.InteractiveClearAll,this.clearAllCellsInInteractiveWindow),this.registerCommand(J.InteractiveGoToCode,this.goToCodeInInteractiveWindow),this.registerCommand(J.InteractiveCopyCell,this.copyCellInInteractiveWindow)}dispose(){this.disposables.forEach(e=>e.dispose())}registerCommandsIfTrusted(){st.workspace.isTrusted&&(this.registerCommand(J.RunAllCells,this.runAllCells),this.registerCommand(J.RunCell,this.runCell),this.registerCommand(J.RunCurrentCell,this.runCurrentCell),this.registerCommand(J.RunCurrentCellAdvance,this.runCurrentCellAndAdvance),this.registerCommand(J.ExecSelectionInInteractiveWindow,e=>{this.runSelectionOrLine(e).catch(h)}),this.registerCommand(J.RunAllCellsAbove,this.runAllCellsAbove),this.registerCommand(J.RunCellAndAllBelow,this.runCellAndAllBelow),this.registerCommand(J.RunAllCellsAbovePalette,this.runAllCellsAboveFromCursor),this.registerCommand(J.RunCellAndAllBelowPalette,this.runCellAndAllBelowFromCursor),this.registerCommand(J.RunCurrentCellAndAddBelow,this.runCurrentCellAndAddBelow),this.registerCommand(J.DebugCell,this.debugCell),this.registerCommand(J.DebugStepOver,this.debugStepOver),this.registerCommand(J.DebugContinue,this.debugContinue),this.registerCommand(J.DebugStop,this.debugStop),this.registerCommand(J.DebugCurrentCellPalette,this.debugCurrentCellFromCursor),this.registerCommand(J.OpenVariableView,this.openVariableView),this.registerCommand(J.OpenOutlineView,this.openOutlineView),this.registerCommand(J.RunToLine,this.runToLine),this.registerCommand(J.RunFromLine,this.runFromLine),this.registerCommand(J.RunFileInInteractiveWindows,this.runFileInteractive),this.registerCommand(J.DebugFileInInteractiveWindows,this.debugFileInteractive))}registerCommand(e,t){let r=st.commands.registerCommand(e,t,this);this.disposables.push(r)}getCodeWatcher(e){if(e&&this.dataScienceCodeLensProvider){let t=st.workspace.textDocuments.filter(r=>an(r.uri,e));if(t&&t.length===1)return this.dataScienceCodeLensProvider.getCodeWatcher(t[0]);if(t&&t.length>1)throw new Error(y.documentMismatch(Ae(e)))}}async enableLoadingWidgetScriptsFromThirdParty(){this.configService.getSettings(void 0).widgetScriptSources.length>0||await this.configService.updateSetting("widgetScriptSources",["jsdelivr.com","unpkg.com"],void 0,st.ConfigurationTarget.Global).catch(h)}async runAllCells(e){let t=this.getCodeWatcher(e);if(t||(t=this.getCurrentCodeWatcher()),t)return t.runAllCells()}async runFileInteractive(e){let t=this.getCodeWatcher(e);if(t||(t=this.getCurrentCodeWatcher()),t)return t.runFileInteractive()}async debugFileInteractive(e){let t=this.getCodeWatcher(e);if(t||(t=this.getCurrentCodeWatcher()),t)return t.debugFileInteractive()}async runCell(e,t,r,i,o){let s=this.getCodeWatcher(e);if(s)return s.runCell(new st.Range(t,r,i,o))}async runAllCellsAbove(e,t,r){if(e){let i=this.getCodeWatcher(e);if(i)return i.runAllCellsAbove(t,r)}}async runCellAndAllBelow(e,t,r){if(e){let i=this.getCodeWatcher(e);if(i)return i.runCellAndAllBelow(t,r)}}async runToLine(){let e=this.getCurrentCodeWatcher(),t=st.window.activeTextEditor;if(e&&t&&t.selection)return e.runToLine(t.selection.start.line)}async runFromLine(){let e=this.getCurrentCodeWatcher(),t=st.window.activeTextEditor;if(e&&t&&t.selection)return e.runFromLine(t.selection.start.line)}async runCurrentCell(){let e=this.getCurrentCodeWatcher();if(e)return e.runCurrentCell()}async runCurrentCellAndAdvance(){let e=this.getCurrentCodeWatcher();if(e)return e.runCurrentCellAndAdvance()}async runSelectionOrLine(e){let t=this.getCurrentCodeWatcher();if(t)return t.runSelectionOrLine(st.window.activeTextEditor,Gn(e)?void 0:e)}async debugCell(e,t,r,i,o){if(e){let s=this.getCodeWatcher(e);if(s)return s.debugCell(new st.Range(t,r,i,o))}}async debugStepOver(){this.debugService?.activeDebugSession&&st.commands.executeCommand("workbench.action.debug.stepOver").then(h,h)}async debugStop(e){if(this.debugService?.activeDebugSession&&this.interactiveWindowProvider){let t=this.interactiveWindowProvider.get(e);if(t&&t.notebookDocument){let r=this.kernelProvider.get(t.notebookDocument);r&&(p.debug(`Interrupt kernel due to debug stop of IW ${e.toString()}`),await r.interrupt())}st.commands.executeCommand("workbench.action.debug.stop").then(h,h)}}async debugContinue(){this.debugService?.activeDebugSession&&st.commands.executeCommand("workbench.action.debug.continue").then(h,h)}async addCellBelow(){await this.getCurrentCodeWatcher()?.addEmptyCellToBottom()}async runCurrentCellAndAddBelow(){this.getCurrentCodeWatcher()?.runCurrentCellAndAddBelow()}async insertCellBelowPosition(){this.getCurrentCodeWatcher()?.insertCellBelowPosition()}async insertCellBelow(){this.getCurrentCodeWatcher()?.insertCellBelow()}async insertCellAbove(){this.getCurrentCodeWatcher()?.insertCellAbove()}async deleteCells(){this.getCurrentCodeWatcher()?.deleteCells()}async selectCell(){this.getCurrentCodeWatcher()?.selectCell()}async selectCellContents(){this.getCurrentCodeWatcher()?.selectCellContents()}async extendSelectionByCellAbove(){this.getCurrentCodeWatcher()?.extendSelectionByCellAbove()}async extendSelectionByCellBelow(){this.getCurrentCodeWatcher()?.extendSelectionByCellBelow()}async moveCellsUp(){this.getCurrentCodeWatcher()?.moveCellsUp()}async moveCellsDown(){this.getCurrentCodeWatcher()?.moveCellsDown()}async changeCellToMarkdown(){this.getCurrentCodeWatcher()?.changeCellToMarkdown()}async changeCellToCode(){this.getCurrentCodeWatcher()?.changeCellToCode()}async gotoNextCellInFile(){this.getCurrentCodeWatcher()?.gotoNextCell()}async gotoPrevCellInFile(){this.getCurrentCodeWatcher()?.gotoPreviousCell()}async runAllCellsAboveFromCursor(){let e=this.getCurrentCodeLens();if(e){let t=this.getCurrentCodeWatcher();if(t)return t.runAllCellsAbove(e.range.start.line,e.range.start.character)}else return}async runCellAndAllBelowFromCursor(){let e=this.getCurrentCodeLens();if(e){let t=this.getCurrentCodeWatcher();if(t)return t.runCellAndAllBelow(e.range.start.line,e.range.start.character)}else return}async debugCurrentCellFromCursor(){if(this.getCurrentCodeLens()){let t=this.getCurrentCodeWatcher();if(t)return t.debugCurrentCell()}else return}async createNewNotebook(){st.window.showInformationMessage('This command has been deprecated and will eventually be removed, please use ["Create: New Jupyter Notebook"](command:workbench.action.openGlobalKeybindings?%5B%22@command:ipynb.newUntitledIpynb%22%5D) instead.').then(h,h),await st.commands.executeCommand("ipynb.newUntitledIpynb")}getCurrentCodeLens(){let e=st.window.activeTextEditor,t=this.getCurrentCodeWatcher();if(e&&t)return t.getCodeLenses().find(r=>r.range.end.line>=e.selection.anchor.line&&r.range.start.line<=e.selection.anchor.line)}getCurrentCodeWatcher(){let e=st.window.activeTextEditor;if(!(!e||!e.document||!this.dataScienceCodeLensProvider))return this.dataScienceCodeLensProvider.getCodeWatcher(e.document)}openPythonExtensionPage(){st.env.openExternal(st.Uri.parse("https://marketplace.visualstudio.com/items?itemName=ms-toolsai.jupyter")).then(h,h)}async openVariableView(){return st.commands.executeCommand("jupyterViewVariables.focus")}async openOutlineView(){return st.commands.executeCommand("outline.focus")}async listenForErrors(e){let t;try{return t=await e(),t}catch(r){p.error("listenForErrors",r),this.dataScienceErrorHandler.handleError(r).then(h,h)}return t}async exportFile(e){let t=Ae(e);if(t&&t.length>0&&this.jupyterExporter){let r=st.window.activeTextEditor;if(r&&this.fileSystem.arePathsSame(r.document.uri,e)){let i=DQ(r.document,this.configuration.getSettings(r.document.uri));if(i){let o=await new hc().showDialog("ipynb",e);if(await this.waitForStatus(async()=>{if(o){let s=await this.jupyterExporter?.serialize(i);await this.fileSystem.writeFile(o,s||"")}},y.exportingFormat,M(e)),o&&t){let s=y.exportOpenQuestion1;await st.window.showInformationMessage(y.exportDialogComplete(M(e)),s)===s&&await o1(o)}}}}}async expandAllCells(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e);p.info(`Expanding all cells in interactive window with uri ${t?.notebookUri}`),t&&await t.expandAllCells()}async collapseAllCells(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e);p.info(`Collapsing all cells in interactive window with uri ${t?.notebookUri}`),t&&await t.collapseAllCells()}exportAs(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e);t&&t.exportAs()}export(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e);t&&t.export()}async createNewInteractiveWindow(e){await this.interactiveWindowProvider?.getOrCreate(void 0,e)}waitForStatus(e,t,r,i){let o=t(r||"");return this.statusProvider.waitWithStatus(e,o,void 0,i)}async importNotebook(){let e=y.importDialogFilter,t={};t[e]=["ipynb"];let r=await st.window.showOpenDialog({openLabel:y.importDialogTitle,filters:t});r&&r.length>0&&await this.waitForStatus(async()=>{await this.fileConverter.importIpynb(r[0])},y.importingFormat,M(r[0]))}async importNotebookOnFile(e){let t=Ae(e);t&&t.length>0&&await this.waitForStatus(async()=>{await this.fileConverter.importIpynb(e)},y.importingFormat,M(e))}async scrollToCell(e,t){if(t&&e){let r=this.interactiveWindowProvider.getInteractiveWindowsWithSubmitter(e);for(let i=0;i<r.length;i+=1)if(await r[i].hasCell(t)){r[i].scrollToCell(t);break}}}async clearAllCellsInInteractiveWindow(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e?.notebookEditor?.notebookUri)?.notebookUri;if(!t)return;let r=st.workspace.notebookDocuments.find(s=>s.uri.toString()===t.toString());if(!r)return;let i=new st.WorkspaceEdit,o=st.NotebookEdit.deleteCells(new st.NotebookRange(0,r.cellCount));i.set(r.uri,[o]),await st.workspace.applyEdit(i)}async goToCodeInInteractiveWindow(e){if(e&&e.metadata?.interactive){let t=st.Uri.parse(e.metadata.interactive.uristring),r=e.metadata.interactive.lineIndex,i=await st.window.showTextDocument(t,{viewColumn:st.ViewColumn.One});i&&(i.revealRange(new st.Range(r,0,r,0)),i.selection=new st.Selection(new st.Position(r,0),new st.Position(r,0)))}}async copyCellInInteractiveWindow(e){if(e){let t=this.configuration.getSettings(e.notebook.uri),r=[e.metadata.interactiveWindowCellMarker??t.defaultCellMarker,e.document.getText()].join(`
`);await st.env.clipboard.writeText(r)}}};v([ln("DATASCIENCE.DEBUG_STEP_OVER")],ps.prototype,"debugStepOver",1),v([ln("DATASCIENCE.DEBUG_STOP")],ps.prototype,"debugStop",1),v([ln("DATASCIENCE.DEBUG_CONTINUE")],ps.prototype,"debugContinue",1),v([fr("DATASCIENCE.ADD_CELL_BELOW")],ps.prototype,"addCellBelow",1),v([ln("DATASCIENCE.EXPORT_PYTHON_FILE")],ps.prototype,"exportFile",1),v([ln("DATASCIENCE.IMPORT_NOTEBOOK",{scope:"command"})],ps.prototype,"importNotebook",1),v([ln("DATASCIENCE.IMPORT_NOTEBOOK",{scope:"file"})],ps.prototype,"importNotebookOnFile",1),ps=v([(0,jn.injectable)(),m(0,(0,jn.inject)(K)),m(1,(0,jn.inject)(Og)),m(1,(0,jn.optional)()),m(2,(0,jn.inject)(nt)),m(3,(0,jn.inject)(oe)),m(4,(0,jn.inject)(Up)),m(4,(0,jn.optional)()),m(5,(0,jn.inject)(Ui)),m(5,(0,jn.optional)()),m(6,(0,jn.inject)(oe)),m(7,(0,jn.inject)(ii)),m(8,(0,jn.inject)(ye)),m(9,(0,jn.inject)(Gr)),m(10,(0,jn.inject)(Fn)),m(11,(0,jn.inject)(rI))],ps);var II=k(N());var yc=require("vscode");var c1=class{constructor(e,t,r,i){this.configService=e;this.storage=t;this.notebook=r;this.executionCount=0;this.cellIndexesCounted={};this.disposables=[];i.push(this),yc.workspace.onDidChangeTextDocument(this.onChangedDocument,this,this.disposables),ar.onDidChangeNotebookCellExecutionState(this.onDidCellStateChange,this,this.disposables)}dispose(){this.disposed||(this.disposed=!0,this.storage.clear(),this.disposables.forEach(e=>e.dispose()))}reset(){this.storage.clear(),this.executionCount=0}async generateCode(e,t,r,i){let{executableLines:o}=this.extractExecutableLines(e);if(this.executionCount+=1,this.cellIndexesCounted[t]=!0,o.length>0&&o.find(s=>s.trim().length>0))return this.generateCodeImpl(e,this.executionCount,r,i)}extractExecutableLines(e){let t=e.interactive.originalSource,r=this.configService.getSettings(this.notebook.uri),i=new No(r),o=gg(t);if(r.magicCommandsAsComments&&o.forEach((s,a)=>o[a]=a1(s)),e.interactiveWindowCellMarker&&o.length&&o[0].trim()===e.interactiveWindowCellMarker.trim()){let s=o.slice(1).filter(a=>a.trim().length>0);if(s.length>0&&s[0].trim().startsWith("%%")){let a=o.slice(o.indexOf(s[0]));return{lines:a,executableLines:a}}}return o.length>0&&(i.isCode(o[0])||i.isMarkdown(o[0]))?{lines:o,executableLines:o.slice(1)}:{lines:o,executableLines:o}}onDidCellStateChange(e){e.state===1&&(e.state!==1||e.cell.notebook!==this.notebook||!e.cell.executionSummary?.executionOrder||this.cellIndexesCounted[e.cell.index]||(this.executionCount+=1,this.cellIndexesCounted[e.cell.index]=!0))}async generateCodeImpl(e,t,r,i){let{lineIndex:o,uristring:s}=e.interactive,a=yc.workspace.textDocuments.find(Y=>Y.uri.toString()===s);if(!a)return;let{stripped:l,trueStartLine:c}=this.extractStrippedLines(e),u=a.lineAt(c),d=a.lineAt(Math.min(c+l.length-1,a.lineCount-1)),f=0;for(;f<l.length&&l[f].trim().length===0;)f+=1;let g=f+c,b=a.offsetAt(new yc.Position(o,0)),I=a.offsetAt(d.rangeIncludingLineBreak.end),w=(e.interactiveWindowCellMarker||"").length>0,{runtimeLine:_,debuggerStartLine:A}=this.addHiddenLines(r,l,c,g,w,i),R=l.join(""),V=a.getText(new yc.Range(new yc.Position(o,0),d.rangeIncludingLineBreak.end)),ie=(await ga(R,"SHA-1")).substring(0,12),Q=this.getRuntimeFile(ie,t),te=r?-1:0,ae={line:u?u.lineNumber+1:1,endLine:d?d.lineNumber+1:1,firstNonBlankLineIndex:g,debuggerStartLine:A,executionCount:t,startOffset:b,endOffset:I,deleted:!1,code:R,trimmedRightCode:l.map(Y=>Y.replace(/[ \t\r]+\n$/g,`
`)).join(""),realCode:V,runtimeLine:_,runtimeFile:Q,id:e.id,timestamp:Date.now(),lineOffsetRelativeToIndexOfFirstLineInCell:te,hasCellMarker:w};return p.info(`Generated code for ${t} = ${Q} with ${l.length} lines`),this.storage.store(yc.Uri.parse(e.interactive.uristring),ae),ae}getRuntimeFile(e,t){return`<ipython-input-${t}-${e}>`}onChangedDocument(e){let t=this.storage.getFileGeneratedCode(e.document.uri);if(t){let r=e.document.getText();e.contentChanges.forEach(i=>{this.handleContentChange(r,i,t)})}}extractStrippedLines(e){let t=gg(e.interactive.originalSource),{lines:r}=this.extractExecutableLines(e),i=e.interactive.lineIndex+1;if(!e.interactiveWindowCellMarker){i=e.interactive.lineIndex;for(let l=0;l<r.length;l+=1)if(r[l]!==t[l]){i+=l+1;break}}let o=0;for(;o<r.length&&r[o].trim().length===0;)o+=1;let s=r.length-1,a=r.length-2;for(;a>0;){let l=r[s],c=r[a];if((l.length===0||l===`
`)&&(c.length===0||c===`
`))r.splice(s,1),s-=1,a-=1;else break}!r[s].endsWith(`
`)&&r[s].length>0&&(r[s]=`${r[s]}
`);for(let l=0;l<r.length;l++)r[l]=r[l].replace(/\r\n/g,`
`);return{stripped:r,trueStartLine:i}}handleContentChange(e,t,r){let i=t.range.start.line-t.range.end.line+t.text.split(`
`).length-1,o=t.text.length-t.rangeLength,s=t.rangeLength<=0?t.rangeOffset:t.rangeOffset+t.rangeLength-1;r.forEach(a=>{a.endOffset<t.rangeOffset||(a.startOffset>s?(a.line+=i,a.endLine+=i,a.startOffset+=o,a.endOffset+=o):a.startOffset===s?a.deleted||t.rangeLength>0||i===0?a.deleted=e.substr(a.startOffset,a.endOffset-a.startOffset)!==a.realCode:(a.line+=i,a.endLine+=i,a.startOffset+=o,a.endOffset+=o):a.deleted=e.substr(a.startOffset,a.endOffset-a.startOffset)!==a.realCode)})}addHiddenLines(e,t,r,i,o,s){let a=s||this.configService.getSettings(void 0).forceIPyKernelDebugger===!0;return e&&this.configService.getSettings(this.notebook.uri).stopOnFirstLineWhileDebugging?a?(t.splice(0,0,`breakpoint()
`),{runtimeLine:1,debuggerStartLine:r+1}):(t.splice(0,0,`breakpoint()
`),{runtimeLine:2,debuggerStartLine:r}):{runtimeLine:1,debuggerStartLine:o?i:i+1}}};var TQ=require("vscode");var bI=class{constructor(e,t,r){this.configService=e;this.storageFactory=t;this.disposables=r;this.codeGenerators=new WeakMap}activate(){TQ.workspace.onDidCloseNotebookDocument(this.onDidCloseNotebook,this,this.disposables)}getOrCreate(e){let t=this.get(e);if(t)return t;let r=new c1(this.configService,this.storageFactory.getOrCreate(e),e,this.disposables);return this.codeGenerators.set(e,r),r}get(e){return this.codeGenerators.get(e)}onDidCloseNotebook(e){this.codeGenerators.get(e)?.dispose(),this.codeGenerators.delete(e)}};bI=v([(0,II.injectable)(),m(0,(0,II.inject)(oe)),m(1,(0,II.inject)(Zs)),m(2,(0,II.inject)(K))],bI);var Lu=k(N()),Vp=require("vscode");function ms(n){if(n.metadata.interactive!==void 0)return n.metadata}function RQ(n,e,t){let r=Be(n,{trim:!1,removeEmptyEntries:!1}),i=t.stripFirstMarkerNoConcat(r),o=M$(i),s=vg(o,`
`,e.magicCommandsAsComments?a1:void 0);return Oh(s.join(""))}var mfe=y.runCurrentCellAndAddBelow,ffe=y.addCellBelowCommandTitle,hfe=y.debugCellCommandTitle,gfe=y.debugCellCommandTitle,vfe=y.debugStepOverCommandTitle,yfe=y.debugContinueCommandTitle,bfe=y.debugStopCommandTitle,Ife=y.runCellLensCommandTitle,Sfe=y.runAllCellsLensCommandTitle,Cfe=y.runAllCellsAboveLensCommandTitle,AQ=y.runCellAndAllBelowLensCommandTitle,Efe=y.scrollToCellTitleFormatMessage,SI=class{constructor(e,t,r,i,o,s){this.configService=e;this.generatedCodeStorageFactory=r;this.replTracker=o;this.cellRangeCache=s;this.updateEvent=new Vp.EventEmitter;this.notebookData=new Map;this.codeLensCache=new Map;this.totalCodeLensUpdateTimeInMs=0;this.codeLensUpdateCount=0;this.maxCellCount=0;Vp.workspace.onDidCloseTextDocument(this.onClosedDocument,this,t),Vp.workspace.onDidGrantWorkspaceTrust(()=>this.codeLensCache.clear(),this,t),this.configService.getSettings(void 0).onDidChange(this.onChangedSettings,this,t),ar.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,t),i.onDidDisposeKernel(a=>{this.notebookData.delete(a.notebook.uri.toString())},this,t)}getPerfMeasures(){return{totalCodeLensUpdateTimeInMs:this.totalCodeLensUpdateTimeInMs,codeLensUpdateCount:this.codeLensUpdateCount,maxCellCount:this.maxCellCount}}get updateRequired(){return this.updateEvent.event}createCodeLenses(e){let t=this.getCodeLensCacheData(e);return[...t.documentLenses,...t.gotoCellLens]}getCellRanges(e){return this.getCodeLensCacheData(e).cellRanges}getCodeLensCacheData(e){let t=new Me,r=!1,i=e.uri.toString(),o=this.codeLensCache.get(i),s=!1;o||(o={cachedDocumentVersion:void 0,cachedExecutionCounts:new Set,documentLenses:[],cellRanges:[],gotoCellLens:[]},s=!0,this.codeLensCache.set(i,o)),o.cachedDocumentVersion!==e.version&&(o.cellRanges=this.cellRangeCache.getCellRanges(e),o.documentLenses=[],o.gotoCellLens=[],o.cachedDocumentVersion=e.version,s=!0);let a=this.getDocumentExecutionCounts(i);if((a.length!==o.cachedExecutionCounts.size||a.find(l=>!o?.cachedExecutionCounts.has(l)))&&(o.gotoCellLens=[],o.cachedExecutionCounts=new Set(a),s=!0),o.documentLenses.length===0&&s&&o.cellRanges.length){r=!0;let l=this.enumerateCommands(e.uri);p.debug(`CodeLensFactory: Generating new code lenses for version ${e.version} of document ${e.uri} for commands ${l.join(", ")}`);let c=!0;o.cellRanges.forEach(u=>{l.forEach(d=>{let f=this.createCodeLens(e,u,d,c);f&&o.documentLenses.push(f)}),c=!1})}else p.ci(`NOT Generating new code lenses for version ${e.version} of document ${e.uri} - needUpdate: ${s}, cellRanges.length: ${o.cellRanges.length}`);if(s&&o.gotoCellLens.length===0&&o.cellRanges.length&&this.configService.getSettings(e.uri).addGotoCodeLenses){let l=this.generatedCodeStorageFactory.get({fileUri:e.uri}),c=l?l.all.find(u=>u.uri.toString()===e.uri.toString())?.generatedCodes:void 0;c&&c.length&&o.cellRanges.forEach(u=>{let d=this.createExecutionLens(e,u.range,c);d&&o?.gotoCellLens.push(d)})}return r&&(this.totalCodeLensUpdateTimeInMs+=t.elapsedTime,this.codeLensUpdateCount+=1,this.maxCellCount=Math.max(this.maxCellCount,o.cellRanges.length)),o}getDocumentExecutionCounts(e){return[...this.notebookData.values()].map(t=>t.documentExecutionCounts.get(e)).filter(t=>t!==void 0)}onDidChangeNotebookCellExecutionState(e){if(this.replTracker.isForReplEditor(e.cell.notebook)||e.state!==1||!e.cell.executionSummary?.executionOrder)return;let t=ms(e.cell),r=this.notebookData.get(e.cell.notebook.uri.toString());r||(r={cellExecutionCounts:new Map,documentExecutionCounts:new Map},this.notebookData.set(e.cell.notebook.uri.toString(),r)),r!==void 0&&t!==void 0&&(r.cellExecutionCounts.set(t.id,e.cell.executionSummary.executionOrder),r.documentExecutionCounts.set(t.interactive.uristring,e.cell.executionSummary.executionOrder),this.updateEvent.fire())}onClosedDocument(e){this.codeLensCache.delete(e.uri.toString())}onChangedSettings(){this.codeLensCache.clear(),this.cellRangeCache.clear(),this.updateEvent.fire()}enumerateCommands(e){let t,r=this.configService.getSettings(e).codeLenses;r?t=r.split(",").map(s=>s.trim()):t=od.DefaultDesignLenses;let i=this.configService.getSettings(e).debugCodeLenses;i?t=t.concat(i.split(",").map(s=>s.trim())):t=t.concat(od.DefaultDebuggingLenses);let o=[];return Vp.workspace.isTrusted||(o=[...od.DebuggerCommands,...od.DebuggerCommands,J.RunAllCells,J.RunAllCellsAbove,J.RunAllCellsAbovePalette,J.RunCellAndAllBelowPalette,J.RunCurrentCell,J.RunCurrentCellAdvance,J.RunCurrentCellAndAddBelow,J.RunFileInInteractiveWindows,J.InterruptKernel,J.RunToLine,J.RunCell,J.DebugCell,J.DebugContinue,J.DebugStepOver,J.DebugStop,J.RunCellAndAllBelowPalette]),o&&(t=t.filter(s=>!o.includes(s))),t}createCodeLens(e,t,r,i){let{range:o,cell_type:s}=t;switch(r){case J.RunCurrentCellAndAddBelow:return this.generateCodeLens(o,J.RunCurrentCellAndAddBelow,mfe);case J.AddCellBelow:return this.generateCodeLens(o,J.AddCellBelow,ffe,[e.uri,o.start.line]);case J.DebugCurrentCellPalette:return this.generateCodeLens(o,J.DebugCurrentCellPalette,hfe);case J.DebugCell:if(s!=="code")break;return this.generateCodeLens(o,J.DebugCell,gfe,[e.uri,o.start.line,o.start.character,o.end.line,o.end.character]);case J.DebugStepOver:if(s!=="code")break;return this.generateCodeLens(o,J.DebugStepOver,vfe,[e.uri]);case J.DebugContinue:if(s!=="code")break;return this.generateCodeLens(o,J.DebugContinue,yfe,[e.uri]);case J.DebugStop:if(s!=="code")break;return this.generateCodeLens(o,J.DebugStop,bfe,[e.uri]);case J.RunCurrentCell:case J.RunCell:return this.generateCodeLens(o,J.RunCell,Ife,[e.uri,o.start.line,o.start.character,o.end.line,o.end.character]);case J.RunAllCells:return this.generateCodeLens(o,J.RunAllCells,Sfe,[e.uri,o.start.line,o.start.character]);case J.RunAllCellsAbovePalette:case J.RunAllCellsAbove:return i?this.generateCodeLens(o,J.RunCellAndAllBelow,AQ,[e.uri,o.start.line,o.start.character]):this.generateCodeLens(o,J.RunAllCellsAbove,Cfe,[e.uri,o.start.line,o.start.character]);case J.RunCellAndAllBelowPalette:case J.RunCellAndAllBelow:return this.generateCodeLens(o,J.RunCellAndAllBelow,AQ,[e.uri,o.start.line,o.start.character]);default:p.warn(`Invalid command for code lens ${r}`);break}}findMatchingCellExecutionCount(e){return[...this.notebookData.values()].find(r=>r.cellExecutionCounts.get(e))?.cellExecutionCounts.get(e)}createExecutionLens(e,t,r){if(r){let i=r.filter(o=>o.line-2===t.start.line).sort((o,s)=>o.timestamp-s.timestamp);if(i&&i.length){let o=i[i.length-1],s=this.findMatchingCellExecutionCount(o.id);if(s!==void 0)return this.generateCodeLens(t,J.ScrollToCell,Efe(s),[e.uri,o.id])}}}generateCodeLens(e,t,r,i){return new Vp.CodeLens(e,wfe(t,r,i))}};SI=v([(0,Lu.injectable)(),m(0,(0,Lu.inject)(oe)),m(1,(0,Lu.inject)(K)),m(2,(0,Lu.inject)(Zs)),m(3,(0,Lu.inject)(ye)),m(4,(0,Lu.inject)(_o)),m(5,(0,Lu.inject)(Wp))],SI);function wfe(n,e,t){return{arguments:t,title:e,command:n}}var bc=k(N()),za=k(require("vscode"));var CI=class{constructor(e,t,r,i,o){this.serviceContainer=e;this.debugLocationTracker=t;this.configuration=r;this.debugService=o;this.totalExecutionTimeInMs=0;this.totalGetCodeLensCalls=0;this.activeCodeWatchers=[];this.didChangeCodeLenses=new za.EventEmitter;i.push(this),i.push(za.workspace.onDidGrantWorkspaceTrust(()=>{this.activeCodeWatchers=G(this.activeCodeWatchers),this.didChangeCodeLenses.fire()})),i.push(this.debugService.onDidChangeActiveDebugSession(this.onChangeDebugSession.bind(this))),i.push(za.workspace.onDidCloseTextDocument(this.onDidCloseTextDocument.bind(this))),this.debugLocationTracker&&i.push(this.debugLocationTracker.updated(this.onDebugLocationUpdated.bind(this)))}dispose(){this.totalGetCodeLensCalls>0&&T("DS_INTERNAL.CODE_LENS_ACQ_TIME",{duration:this.totalExecutionTimeInMs/this.totalGetCodeLensCalls}),G(this.activeCodeWatchers)}get onDidChangeCodeLenses(){return this.didChangeCodeLenses.event}provideCodeLenses(e,t){return[ca,xh].includes(e.uri.scheme)?[]:this.getCodeLensTimed(e)}getCodeWatcher(e){return this.matchWatcher(e.uri)}onDebugLocationUpdated(){this.didChangeCodeLenses.fire()}onChangeDebugSession(e){this.didChangeCodeLenses.fire()}onDidCloseTextDocument(e){let t=this.activeCodeWatchers.findIndex(r=>r.uri&&r.uri.toString()===e.uri.toString());t>=0&&this.activeCodeWatchers.splice(t,1)[0].dispose()}getCodeLensTimed(e){let t=new Me,r=this.getCodeLens(e);return this.totalExecutionTimeInMs+=t.elapsedTime,this.totalGetCodeLensCalls+=1,this.configuration.getSettings(e.uri).enableCellCodeLens?this.adjustDebuggingLenses(e,r):[]}adjustDebuggingLenses(e,t){let r=od.DebuggerCommands;if(this.debugLocationTracker&&this.debugService.activeDebugSession){let i=this.debugLocationTracker.getLocation(this.debugService.activeDebugSession),o;try{o=i?za.Uri.parse(i.fileName):void 0}catch{}if(i&&(an(za.Uri.file(i.fileName),e.uri,!0)||o&&an(o,e.uri,!0)))return t.filter(a=>{let l=new za.Position(i.lineNumber-1,i.column-1);return a.range.contains(l)}).filter(a=>a.command?r.includes(a.command.command):!1);p.ci(`Detected debugging context because activeDebugSession is name:"${this.debugService.activeDebugSession.name}", type: "${this.debugService.activeDebugSession.type}", but fell through with debugLocation: ${JSON.stringify(i)}, and document.uri: ${e.uri.toString()}`)}else return t.filter(i=>i.command?!r.includes(i.command.command):!1);return[]}getCodeLens(e){let t=this.matchWatcher(e.uri);return t?t.getCodeLenses():(p.debug(`Creating a new watcher for document ${e.uri}`),this.createNewCodeWatcher(e).getCodeLenses())}matchWatcher(e){let t=this.activeCodeWatchers.findIndex(i=>i.uri&&i.uri.toString()==e.toString());if(t>=0)return this.activeCodeWatchers[t];let r=za.workspace.textDocuments.filter(i=>i.uri.toString()===e.toString());if(r&&r.length>0)return p.debug(`creating new code watcher with matching document ${e}`),this.createNewCodeWatcher(r[0])}createNewCodeWatcher(e){let t=this.serviceContainer.get(Z0);return t.setDocument(e),t.codeLensUpdated(this.onWatcherUpdated.bind(this)),this.activeCodeWatchers.push(t),t}onWatcherUpdated(){this.didChangeCodeLenses.fire()}};CI=v([(0,bc.injectable)(),m(0,(0,bc.inject)(Ze)),m(1,(0,bc.inject)(_0)),m(1,(0,bc.optional)()),m(2,(0,bc.inject)(oe)),m(3,(0,bc.inject)(K)),m(4,(0,bc.inject)(Ui))],CI);var Uu=k(N()),he=require("vscode");var Hf=class extends Error{constructor(t){super("Cell failed to execute");this.cell=t}};function Pfe(n,e){if(e<=0)throw new RangeError(`Length must be > 0 not ${e}`);return n<0&&(n+=e),n<0?0:n>=e?e-1:n}var er=class{constructor(e,t,r,i,o,s){this.interactiveWindowProvider=e;this.configService=t;this.executionHelper=r;this.dataScienceErrorHandler=i;this.codeLensFactory=o;this.replTracker=s;this.version=-1;this.codeLenses=[];this.cells=[];this.codeLensUpdatedEvent=new he.EventEmitter;this.disposables=[this.codeLensUpdatedEvent]}setDocument(e){this.document=e,this.version=e.version,this.codeLenses=this.codeLensFactory.createCodeLenses(e),this.cells=this.codeLensFactory.getCellRanges(e),this.disposables.push(this.codeLensFactory.updateRequired(this.onCodeLensFactoryUpdated.bind(this))),this.disposables.push(he.workspace.onDidCloseTextDocument(this.onDocumentClosed.bind(this))),this.disposables.push(he.workspace.onDidCloseNotebookDocument(this.ondidCloseNotebook.bind(this)))}get codeLensUpdated(){return this.codeLensUpdatedEvent.event}get uri(){return this.document?.uri}getVersion(){return this.version}getCodeLenses(){let e=this.document;return e&&e.version!=this.version&&(this.codeLenses=this.codeLensFactory.createCodeLenses(e),this.cells=this.codeLensFactory.getCellRanges(e),this.version=e.version),this.codeLenses}async debugCurrentCell(){if(!(!he.window.activeTextEditor||!he.window.activeTextEditor.document))return this.runMatchingCell(he.window.activeTextEditor.selection,!1,!0)}dispose(){let e=this.codeLensFactory.getPerfMeasures();e&&e.codeLensUpdateCount>0&&T("DS_INTERNAL.DOCUMENT_WITH_CODE_CELLS",{codeLensUpdateTime:e.totalCodeLensUpdateTimeInMs/e.codeLensUpdateCount,maxCellCount:e.maxCellCount}),G(this.disposables)}async runAllCells(e){let t=await this.getActiveInteractiveWindow(),r=this.codeLenses.filter(s=>s.command&&s.command.command===J.RunCell&&s.command.arguments&&s.command.arguments.length>=5),i=r.length,o=Promise.resolve(!0);for(let s of r){let a=new he.Range(s.command.arguments[1],s.command.arguments[2],s.command.arguments[3],s.command.arguments[4]);if(this.document){i===r.length&&(a=new he.Range(new he.Position(0,0),a.end));let l=this.document.getText(a);i-=1,o=this.addCode(t,l,this.document.uri,a.start.line,e)}}if(await o,r.length===0)return this.runFileAsOneCell(e??!1)}async runFileInteractive(){if(this.document&&this.configService.getSettings(this.document?.uri).splitRunFileIntoCells)return this.runAllCells();if(this.document)return this.runFileAsOneCell(!1)}async debugFileInteractive(){if(this.document&&this.configService.getSettings(this.document?.uri).splitRunFileIntoCells)return this.runAllCells(!0);if(this.document)return this.runFileAsOneCell(!0)}async runAllCellsAbove(e,t){let r=await this.getActiveInteractiveWindow(),i=this.codeLenses.filter(l=>l.command&&l.command.command===J.RunCell),o=i.findIndex(l=>l.range.start.line>=e&&l.range.start.character>=t);o<0&&(o=i.length);let s=o,a=Promise.resolve(!0);for(let l of i)if(o>0&&this.document){let c=new he.Range(l.range.start,l.range.end);o===s&&(c=new he.Range(new he.Position(0,0),c.end)),o-=1;let u=this.document.getText(c);a=this.addCode(r,u,this.document.uri,l.range.start.line)}else break;await a}async runCellAndAllBelow(e,t){let r=await this.getActiveInteractiveWindow(),i=this.codeLenses.filter(l=>l.command&&l.command.command===J.RunCell),o=i.findIndex(l=>l.range.start.line>=e&&l.range.start.character>=t),s=o>0?i.length-o:i.length,a=Promise.resolve(!0);for(let l=o;l>=0&&l<i.length;l+=1)if(s>0&&this.document){let c=i[l];s-=1;let u=this.document.getText(c.range);a=this.addCode(r,u,this.document.uri,c.range.start.line)}await a}async runSelectionOrLine(e,t){if(this.document&&e&&an(e.document.uri,this.document.uri)){let r=await this.getActiveInteractiveWindow(),i;if(t===void 0||Gn(t)?i=this.executionHelper.getSelectedTextToExecute(e):i=t,!i)return;await this.addCode(r,i,this.document.uri,e.selection.start.line)}}async runToLine(e){if(this.document&&e>0){let t=await this.getActiveInteractiveWindow(),r=this.document.lineAt(e-1),i=this.document.getText(new he.Range(0,0,r.range.end.line,r.range.end.character));i&&i.trim().length&&await this.addCode(t,i,this.document.uri,0)}}async runFromLine(e){if(this.document&&e<this.document.lineCount){let t=await this.getActiveInteractiveWindow(),r=this.document.lineAt(this.document.lineCount-1),i=this.document.getText(new he.Range(e,0,r.range.end.line,r.range.end.character));i&&i.trim().length&&await this.addCode(t,i,this.document.uri,e)}}async runCell(e){if(!he.window.activeTextEditor||!he.window.activeTextEditor.document)return;let t=e.contains(he.window.activeTextEditor.selection.start)&&this.configService.getSettings(he.window.activeTextEditor.document.uri).enableAutoMoveToNextCell;return this.runMatchingCell(e,t)}async debugCell(e){if(!(!he.window.activeTextEditor||!he.window.activeTextEditor.document))return this.runMatchingCell(e,!1,!0)}async runCurrentCell(){if(!(!he.window.activeTextEditor||!he.window.activeTextEditor.document))return this.runMatchingCell(he.window.activeTextEditor.selection,!1)}async runCurrentCellAndAdvance(){if(!(!he.window.activeTextEditor||!he.window.activeTextEditor.document))return this.runMatchingCell(he.window.activeTextEditor.selection,!0)}async addEmptyCellToBottom(){let e=he.window.activeTextEditor;e&&this.insertCell(e,e.document.lineCount+1)}async runCurrentCellAndAddBelow(){if(!he.window.activeTextEditor||!he.window.activeTextEditor.document)return;let e=he.window.activeTextEditor,t=new No(this.configService.getSettings(e.document.uri)),r=0,i=this.getDefaultCellMarker(e.document.uri);e&&e.edit(s=>{let a=!0;for(let l=e.selection.end.line+1;l<e.document.lineCount;l+=1)if(t.isCell(e.document.lineAt(l).text)){a=!1,r=l,s.insert(new he.Position(l,0),`${i}

`);break}a&&(r=e.document.lineCount,s.insert(new he.Position(e.document.lineCount,0),`
${i}
`))}).then(h,h);let o=new he.Position(r+1,0);return this.runMatchingCell(e.selection,!1).then(()=>this.advanceToRange(new he.Range(o,o)))}insertCellBelowPosition(){let e=he.window.activeTextEditor;e&&e.selection&&this.insertCell(e,e.selection.end.line+1)}insertCellBelow(){let e=he.window.activeTextEditor;if(e&&e.selection){let t=this.getCellFromPosition(e.selection.end);t?this.insertCell(e,t.range.end.line+1):this.insertCell(e,e.selection.end.line+1)}}insertCellAbove(){let e=he.window.activeTextEditor;if(e&&e.selection){let t=this.getCellFromPosition(e.selection.start);t?this.insertCell(e,t.range.start.line):this.insertCell(e,e.selection.start.line)}}deleteCells(){let e=he.window.activeTextEditor;if(!e||!e.selection)return;let t=this.getStartEndCells(e.selection);if(!t)return;let r=t[0],i=t[1],o=0,s=0,a=i.range.end.line+1,l=0;r.range.start.line>0&&(o=r.range.start.line-1,s=e.document.lineAt(o).range.end.character,a=i.range.end.line,l=i.range.end.character);let c=new he.Range(new he.Position(o,s),new he.Position(a,l));e.edit(u=>{u.replace(c,""),this.codeLensUpdatedEvent.fire()}).then(h,h)}selectCell(){let e=he.window.activeTextEditor;if(e&&e.selection){let t=this.getStartEndCells(e.selection);if(t){let r=t[0],i=t[1];e.selection.anchor.isBeforeOrEqual(e.selection.active)?e.selection=new he.Selection(r.range.start,i.range.end):e.selection=new he.Selection(i.range.end,r.range.start)}}}selectCellContents(){let e=he.window.activeTextEditor;if(!e||!e.selection)return;let t=this.getStartEndCellIndex(e.selection);if(!t)return;let r=t[0],i=t[1],o=e.selection.anchor.isBeforeOrEqual(e.selection.active),s=this.cells,a=[];for(let l=r;l<=i;l+=1){let c=s[l],u=c.range.start.line+1,d=0,f=c.range.end.line,g=c.range.end.character;c.range.start.line===c.range.end.line&&(u=c.range.start.line,d=e.document.lineAt(u).range.end.character,f=u,g=d),o?a.push(new he.Selection(u,d,f,g)):a.push(new he.Selection(f,g,u,d))}e.selections=a}extendSelectionByCellAbove(){let e=he.window.activeTextEditor;if(!e||!e.selection)return;let t=e.selection,r=this.getStartEndCellIndex(e.selection);if(!r)return;let i=e.selection.anchor.isBefore(e.selection.active),o=this.cells,s=r[0],a=r[1],l=o[s],c=o[a];if(!l.range.start.isEqual(t.start)||!c.range.end.isEqual(t.end)){let u;i?s<a?u=new he.Selection(l.range.start,o[a-1].range.end):u=new he.Selection(l.range.end,l.range.start):u=new he.Selection(c.range.end,l.range.start),e.selection=u}else{let u;i&&s<a?(u=o[a-1],e.selection=new he.Selection(l.range.start,u.range.end)):s>0&&(u=o[s-1],e.selection=new he.Selection(c.range.end,u.range.start)),u&&e.revealRange(u.range,he.TextEditorRevealType.Default)}}extendSelectionByCellBelow(){let e=he.window.activeTextEditor;if(!e||!e.selection)return;let t=e.selection,r=this.getStartEndCellIndex(e.selection);if(!r)return;let i=e.selection.anchor.isBeforeOrEqual(e.selection.active),o=this.cells,s=r[0],a=r[1],l=o[s],c=o[a];if(!l.range.start.isEqual(t.start)||!c.range.end.isEqual(t.end)){let u;i?u=new he.Selection(l.range.start,c.range.end):s<a?u=new he.Selection(o[s+1].range.start,c.range.end):u=new he.Selection(c.range.start,c.range.end),e.selection=u}else{let u;i||s===a?a<o.length-1&&(u=o[a+1],e.selection=new he.Selection(l.range.start,u.range.end)):s<a&&(u=o[s+1],e.selection=new he.Selection(c.range.end,u.range.start)),u&&e.revealRange(u.range,he.TextEditorRevealType.Default)}}async moveCellsUp(){await this.moveCellsDirection(!0)}async moveCellsDown(){await this.moveCellsDirection(!1)}changeCellToMarkdown(){this.applyToCells((e,t,r)=>this.changeCellTo(e,t,"markdown"))}changeCellToCode(){this.applyToCells((e,t,r)=>this.changeCellTo(e,t,"code"))}gotoNextCell(){let e=he.window.activeTextEditor;if(!e||!e.selection)return;let t=e.selection,r=this.getCurrentCellLens(t.start),i=this.getNextCellLens(t.start);r&&i&&this.advanceToRange(i.range)}gotoPreviousCell(){let e=he.window.activeTextEditor;if(!e||!e.selection)return;let t=e.selection,r=this.getCurrentCellLens(t.start),i=this.getPreviousCellLens(t.start);r&&i&&this.advanceToRange(i.range)}applyToCells(e){let t=he.window.activeTextEditor,r=this.getStartEndCellIndex(t?.selection);if(!t||!r)return;let i=this.cells,o=r[0],s=r[1];for(let a=o;a<=s;a+=1)e(t,i[a],a)}changeCellTo(e,t,r){if(r==="raw")throw Error("Cell Type raw not implemented");if(t.cell_type===r)return;let i=new No(this.configService.getSettings(e.document.uri)),o=e.document.lineAt(t.range.start.line),s=e.document.getText(o.range),a=this.getDefaultCellMarker(e.document.uri),l=r==="markdown"?i.codeExecRegEx.exec(s):i.markdownExecRegEx.exec(s);if(!l)return;let c=l[l.length-1],u=r==="markdown"?`${a} [markdown]${c}`:`${a}${c}`;e.edit(async d=>{d.replace(o.range,u),t.cell_type=r,t.range.start.line<t.range.end.line&&(e.selection=new he.Selection(t.range.start.line+1,0,t.range.end.line,t.range.end.character),he.commands.executeCommand("editor.action.removeCommentLine").then(h,h),r==="markdown"&&he.commands.executeCommand("editor.action.addCommentLine").then(h,h))}).then(h,h)}async moveCellsDirection(e){let t=he.window.activeTextEditor;if(!t||!t.selection)return!1;let r=this.getStartEndCellIndex(t.selection);if(!r)return!1;let i=r[0],o=r[1],s=this.cells,a=s[i],l=s[o];if(!a||!l)return!1;let c=new he.Range(a.range.start,l.range.end),u=new he.Range(t.selection.start.line-c.start.line,t.selection.start.character,t.selection.end.line-c.start.line,t.selection.end.character),d=t.selection.active.isBefore(t.selection.anchor),f;if(e){if(i===0)return!1;{let g=s[i-1];f=this.exchangeTextLines(t,g.range,c).then(I=>(I&&(t.selection=new he.Selection(g.range.start.line+u.start.line,u.start.character,g.range.start.line+u.end.line,u.end.character)),I))}}else{if(o===s.length-1)return!1;{let g=s[o+1],b=this.exchangeTextLines(t,c,g.range),I=g.range.end.line-g.range.start.line,w=c.end.line-c.start.line,_=I-w;f=b.then(A=>(A&&(t.selection=new he.Selection(g.range.start.line+_+u.start.line,u.start.character,g.range.start.line+_+u.end.line,u.end.character)),A))}}return f.then(g=>(g&&d&&(t.selection=new he.Selection(t.selection.active,t.selection.anchor)),!0))}exchangeTextLines(e,t,r){let i=t.start.line,o=t.end.line,s=r.start.line,a=r.end.line;if(o>=s)throw RangeError(`Above lines must be fully above not ${o} <= ${s}`);let l=new he.Range(i,0,o,e.document.lineAt(o).range.end.character),c=e.document.getText(l),u=new he.Range(s,0,a,e.document.lineAt(a).range.end.character),d=e.document.getText(u),f="";if(o+1<s){let I=o+1,w=s-1,_=new he.Range(I,0,w,e.document.lineAt(w).range.end.character);f=`${e.document.getText(_)}
`}let g=`${d}
${f}${c}`,b=new he.Range(l.start,u.end);return e.edit(I=>{I.replace(b,g),this.codeLensUpdatedEvent.fire()})}getStartEndCells(e){let t=this.getStartEndCellIndex(e);if(t){let r=this.getCellFromIndex(t[0]),i=this.getCellFromIndex(t[1]);return[r,i]}}getStartEndCellIndex(e){if(!e)return;let t=this.getCellIndex(e.start),r=t;if(e.start.line!==e.end.line&&(r=this.getCellIndex(e.end)),t===-1){if(r===-1)return;{t=0;let i=this.getCellFromIndex(0);if(e.start.line>i.range.start.line)throw RangeError(`Should not be able to pick a range with an end in a cell and start after a cell. ${e.start.line} > ${i.range.end.line}`)}}if(t>=0&&r>=0)return[t,r]}insertCell(e,t){let r=this.getDefaultCellMarker(e.document.uri),i=t>=e.document.lineCount?`
${r}
`:`${r}

`,o=new he.Position(t,0),s=new he.Position(t+1,0);e.edit(a=>{a.insert(o,i),this.codeLensUpdatedEvent.fire()}).then(h,h),e.selection=new he.Selection(s,s)}getDefaultCellMarker(e){return this.configService.getSettings(e).defaultCellMarker||Le.DefaultCodeCellMarker}onCodeLensFactoryUpdated(){this.document&&(this.codeLenses=this.codeLensFactory.createCodeLenses(this.document),this.cells=this.codeLensFactory.getCellRanges(this.document)),this.codeLensUpdatedEvent.fire()}onDocumentClosed(e){this.document&&an(e.uri,this.document.uri)&&G(this.disposables)}ondidCloseNotebook(e){this.replTracker.isForReplEditor(e)&&this.configService.getSettings(this.document?.uri).addGotoCodeLenses&&this.onCodeLensFactoryUpdated()}getActiveInteractiveWindow(){return this.interactiveWindowProvider.getOrCreate(this.document?.uri)}async addCode(e,t,r,i,o){let s=!1;try{o?s=await e.debugCode(t,r,i):s=await e.addCode(t,r,i)}catch(a){a instanceof Hf||await this.dataScienceErrorHandler.handleError(a)}return s}async runMatchingCell(e,t,r){let i=this.getCurrentCellLens(e.start),o=this.getNextCellLens(e.start);if(i&&this.document){let s=Oh(this.document.getText(i.range));if(t){let l=he.window.activeTextEditor,{newCellOnRunLast:c}=this.configService.getSettings(this.document.uri),u=new No(this.configService.getSettings(this.document.uri));o?this.advanceToRange(o.range):c&&l&&!u.isEmptyCell(s)&&this.insertCell(l,i.range.end.line+1)}let a=await this.getActiveInteractiveWindow();await this.addCode(a,s,this.document.uri,i.range.start.line,r)}}getCellIndex(e){return this.cells.findIndex(t=>e&&t.range.contains(e))}getCellFromIndex(e){let t=this.cells,r=Pfe(e,t.length);return t[r]}getCellFromPosition(e){if(!e){let t=he.window.activeTextEditor;t&&t.selection&&(e=t.selection.active)}if(e){let t=this.getCellIndex(e);if(t>=0)return this.cells[t]}}getCurrentCellLens(e){return this.codeLenses.find(t=>t.range.contains(e)&&t.command!==void 0&&t.command.command===J.RunCell)}getNextCellLens(e){let t=this.codeLenses.findIndex(r=>r.range.contains(e)&&r.command!==void 0&&r.command.command===J.RunCell);if(t>=0)return this.codeLenses.find((r,i)=>r.command!==void 0&&r.command.command===J.RunCell&&i>t)}getPreviousCellLens(e){let t=this.codeLenses.findIndex(r=>r.range.contains(e)&&r.command!==void 0&&r.command.command===J.RunCell);if(t>=1)return this.codeLenses.find((r,i)=>r.command!==void 0&&i<t&&i+1===t)}async runFileAsOneCell(e){if(this.document){let t=await this.getActiveInteractiveWindow(),r=this.document.getText();await this.addCode(t,r,this.document.uri,0,e)}}advanceToRange(e){let t=he.window.activeTextEditor,r=new he.Selection(e.start,e.start);t&&(t.selection=r,t.revealRange(e,he.TextEditorRevealType.Default))}};v([ln("DATASCIENCE.DEBUG_CURRENT_CELL")],er.prototype,"debugCurrentCell",1),v([ln("DATASCIENCE.RUN_ALL_CELLS")],er.prototype,"runAllCells",1),v([ln("DATASCIENCE.RUN_FILE_INTERACTIVE")],er.prototype,"runFileInteractive",1),v([ln("DATASCIENCE.DEBUG_FILE_INTERACTIVE")],er.prototype,"debugFileInteractive",1),v([ln("DATASCIENCE.RUN_ALL_CELLS_ABOVE")],er.prototype,"runAllCellsAbove",1),v([ln("DATASCIENCE.RUN_CELL_AND_ALL_BELOW")],er.prototype,"runCellAndAllBelow",1),v([ln("DATASCIENCE.RUN_SELECTION_OR_LINE")],er.prototype,"runSelectionOrLine",1),v([ln("DATASCIENCE.RUN_TO_LINE")],er.prototype,"runToLine",1),v([ln("DATASCIENCE.RUN_FROM_LINE")],er.prototype,"runFromLine",1),v([ui("CodeWatcher::runCell",4)],er.prototype,"runCell",1),v([ln("DATASCIENCE.DEBUG_CURRENT_CELL")],er.prototype,"debugCell",1),v([ln("DATASCIENCE.RUN_CURRENT_CELL")],er.prototype,"runCurrentCell",1),v([ln("DATASCIENCE.RUN_CURRENT_CELL_AND_ADVANCE")],er.prototype,"runCurrentCellAndAdvance",1),v([fr("DATASCIENCE.RUN_CURRENT_CELL_AND_ADD_BELOW")],er.prototype,"runCurrentCellAndAddBelow",1),v([fr("DATASCIENCE.RUN_INSERT_CELL_BELOW_POSITION")],er.prototype,"insertCellBelowPosition",1),v([fr("DATASCIENCE.RUN_INSERT_CELL_BELOW")],er.prototype,"insertCellBelow",1),v([fr("DATASCIENCE.RUN_INSERT_CELL_ABOVE")],er.prototype,"insertCellAbove",1),v([fr("DATASCIENCE.RUN_DELETE_CELLS")],er.prototype,"deleteCells",1),v([fr("DATASCIENCE.RUN_SELECT_CELL")],er.prototype,"selectCell",1),v([fr("DATASCIENCE.RUN_SELECT_CELL_CONTENTS")],er.prototype,"selectCellContents",1),v([fr("DATASCIENCE.RUN_EXTEND_SELECTION_BY_CELL_ABOVE")],er.prototype,"extendSelectionByCellAbove",1),v([fr("DATASCIENCE.RUN_EXTEND_SELECTION_BY_CELL_BELOW")],er.prototype,"extendSelectionByCellBelow",1),v([fr("DATASCIENCE.RUN_MOVE_CELLS_UP")],er.prototype,"moveCellsUp",1),v([fr("DATASCIENCE.RUN_MOVE_CELLS_DOWN")],er.prototype,"moveCellsDown",1),v([fr("DATASCIENCE.RUN_CHANGE_CELL_TO_MARKDOWN")],er.prototype,"changeCellToMarkdown",1),v([fr("DATASCIENCE.RUN_CHANGE_CELL_TO_CODE")],er.prototype,"changeCellToCode",1),v([fr("DATASCIENCE.GOTO_NEXT_CELL_IN_FILE")],er.prototype,"gotoNextCell",1),v([fr("DATASCIENCE.GOTO_PREV_CELL_IN_FILE")],er.prototype,"gotoPreviousCell",1),er=v([(0,Uu.injectable)(),m(0,(0,Uu.inject)(ii)),m(1,(0,Uu.inject)(oe)),m(2,(0,Uu.inject)(_D)),m(3,(0,Uu.inject)(Gr)),m(4,(0,Uu.inject)(e1)),m(5,(0,Uu.inject)(_o))],er);var Gf=k(N()),oi=k(require("vscode"));var jp=require("vscode");var EI=class{constructor(e,t,r,i){this.configuration=t;this.extensionChecker=r;this.cellRangeCache=i;this.computeDecorations(),e.push(this),e.push(this.configuration.getSettings(void 0).onDidChange(this.settingsChanged,this)),e.push(oi.window.onDidChangeActiveTextEditor(this.changedEditor,this)),e.push(oi.window.onDidChangeTextEditorSelection(this.changedSelection,this)),e.push(oi.workspace.onDidChangeTextDocument(this.changedDocument,this)),this.settingsChanged()}activate(){}dispose(){this.timer&&clearTimeout(this.timer)}settingsChanged(){oi.window.activeTextEditor&&this.triggerUpdate(oi.window.activeTextEditor)}changedEditor(){this.triggerUpdate(void 0)}changedDocument(e){oi.window.activeTextEditor&&e.document===oi.window.activeTextEditor.document&&this.triggerUpdate(jp.window.activeTextEditor)}changedSelection(e){e.textEditor&&e.textEditor.selection.anchor&&this.triggerUpdate(e.textEditor)}triggerUpdate(e){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>this.update(e),100)}computeDecorations(){this.currentCellTopUnfocused=jp.window.createTextEditorDecorationType({borderColor:new oi.ThemeColor("interactive.inactiveCodeBorder"),borderWidth:"2px 0px 0px 0px",borderStyle:"solid",isWholeLine:!0}),this.currentCellBottomUnfocused=jp.window.createTextEditorDecorationType({borderColor:new oi.ThemeColor("interactive.inactiveCodeBorder"),borderWidth:"0px 0px 1px 0px",borderStyle:"solid",isWholeLine:!0}),this.currentCellTop=jp.window.createTextEditorDecorationType({borderColor:new oi.ThemeColor("interactive.activeCodeBorder"),borderWidth:"2px 0px 0px 0px",borderStyle:"solid",isWholeLine:!0}),this.currentCellBottom=jp.window.createTextEditorDecorationType({borderColor:new oi.ThemeColor("interactive.activeCodeBorder"),borderWidth:"0px 0px 1px 0px",borderStyle:"solid",isWholeLine:!0})}cellDecorationEnabled(e){return e.decorateCells===!1?!1:e.decorateCells==="currentCell"||e.decorateCells==="allCells"}update(e){let t=e===void 0?jp.window.visibleTextEditors:[e];for(let r of t)if(r&&r.document&&r.document.languageId===ge&&!hg(r.document)&&this.currentCellTop&&this.currentCellBottom&&this.currentCellTopUnfocused&&this.currentCellBottomUnfocused&&this.extensionChecker.isPythonExtensionInstalled){let i=this.configuration.getSettings(r.document.uri);if(this.cellDecorationEnabled(i)){let o=this.cellRangeCache.getCellRanges(r.document),s=o.map(u=>u.range).filter(u=>u.contains(r.selection.anchor)),a=s.length>0?[new oi.Range(s[0].start,s[0].start)]:[],l=i.decorateCells!=="allCells"&&s.length>0?[new oi.Range(s[0].end,s[0].end)]:[],c=[];i.decorateCells==="allCells"&&o.forEach(u=>{let d=u.range.start;d!==s[0].start&&c.push(new oi.Range(d,d))}),jp.window.activeTextEditor===r?(r.setDecorations(this.currentCellTop,a),r.setDecorations(this.currentCellBottom,l),r.setDecorations(this.currentCellTopUnfocused,c),r.setDecorations(this.currentCellBottomUnfocused,[])):(r.setDecorations(this.currentCellTop,[]),r.setDecorations(this.currentCellBottom,[]),r.setDecorations(this.currentCellTopUnfocused,[...c,...a]),r.setDecorations(this.currentCellBottomUnfocused,l))}else r.setDecorations(this.currentCellTop,[]),r.setDecorations(this.currentCellBottom,[]),r.setDecorations(this.currentCellTopUnfocused,[]),r.setDecorations(this.currentCellBottomUnfocused,[])}}};EI=v([(0,Gf.injectable)(),m(0,(0,Gf.inject)(K)),m(1,(0,Gf.inject)(oe)),m(2,(0,Gf.inject)(qe)),m(3,(0,Gf.inject)(Wp))],EI);var NQ=k(N()),MQ=require("vscode");var u1=class{constructor(){this.codeGeneratorsByFile=new Io}clear(){this.codeGeneratorsByFile.clear()}get all(){return[...this.codeGeneratorsByFile.entries()].map(e=>({uri:e[0],generatedCodes:e[1].filter(t=>!t.deleted)})).filter(e=>e.generatedCodes.length>0)}getFileGeneratedCode(e){return this.codeGeneratorsByFile.get(e)||[]}store(e,t){let r=this.codeGeneratorsByFile.get(e)||[],i=!1;for(let o=0;o<r.length&&!i;o+=1){let s=r[o];t.line>=s.line&&t.line<=s.endLine?(r.splice(o,1,t),i=!0):s.line>t.line&&(r.splice(o,0,t),i=!0)}i||r.push(t),this.codeGeneratorsByFile.set(e,r)}};var wI=class{constructor(){this.storages=new WeakMap}getOrCreate(e){return this.storages.has(e)||this.storages.set(e,new u1),this.storages.get(e)}get(e){if("notebook"in e)return this.storages.get(e.notebook);{let t=MQ.workspace.notebookDocuments.find(r=>this.storages.get(r)?.all.find(o=>o.uri.toString()===e.fileUri.toString()));return t?this.storages.get(t):void 0}}};wI=v([(0,NQ.injectable)()],wI);var Ic=k(N()),kI=k(require("vscode"));var PI=class{constructor(e,t,r,i,o){this.variableProvider=e;this.interactiveProvider=t;this.disposables=r;this.kernelProvider=i;this.replTracker=o;this.runFiles=new Set;this.stopWatch=new Me;this.delayer=new bs(300)}activate(){this.onDidChangeNotebookCellExecutionStateHandler=ar.onDidChangeNotebookCellExecutionState(e=>this.delayer.trigger(()=>this.onDidChangeNotebookCellExecutionState(e)).catch(h),this),this.kernelProvider.onDidRestartKernel(()=>this.runFiles.clear(),this,this.disposables)}dispose(){this.delayer.dispose(),this.onDidChangeNotebookCellExecutionStateHandler.dispose(),this.hoverProviderRegistration&&this.hoverProviderRegistration.dispose()}async onDidChangeNotebookCellExecutionState(e){try{if(this.replTracker.isForReplEditor(e.cell.notebook))return;let t=this.runFiles.size,r=ms(e.cell);r!==void 0&&this.runFiles.add(r.interactive.uristring),t!==this.runFiles.size&&(this.initializeHoverProvider(),this.onDidChangeNotebookCellExecutionStateHandler.dispose())}catch(t){p.error(t)}}async provideHover(e,t,r){this.stopWatch.reset();let i=await Bt(300,this.getVariableHover(e,t,r));return T("DS_INTERNAL.INTERACTIVE_FILE_TOOLTIPS_PERF",{duration:this.stopWatch.elapsedTime},{isResultNull:!!i}),i}initializeHoverProvider(){this.hoverProviderRegistration||(this.hoverProviderRegistration=kI.languages.registerHoverProvider(SW,this))}async getVariableHover(e,t,r){let i=e.getWordRangeAtPosition(t);if(i){let o=e.getText(i);if(o){let s=this.getMatchingKernels(e);if(s.length){let a=await Rt(r,{},...s.map(c=>this.variableProvider.getVariableProperties(o,c,r))),l=Object.entries(a||{});if(l.length>0){let c=l.reduce((d,f)=>d+`${f[0]}: ${f[1]}
`,"```\n")+"```";return{contents:[new kI.MarkdownString(c)]}}}}}}getMatchingKernels(e){let t=this.interactiveProvider.get(e.uri)?.notebookUri;if(!t)return[];let r=new Set;return kI.workspace.notebookDocuments.filter(i=>t?.toString()===i.uri.toString()).forEach(i=>{let o=this.kernelProvider.get(i);o&&r.add(o)}),Array.from(r)}};PI=v([(0,Ic.injectable)(),m(0,(0,Ic.inject)(In)),m(0,(0,Ic.named)(Le.KERNEL_VARIABLES)),m(1,(0,Ic.inject)(ii)),m(2,(0,Ic.inject)(K)),m(3,(0,Ic.inject)(ye)),m(4,(0,Ic.inject)(_o))],PI);var Ji=k(N()),Gt=require("vscode");var wt=require("vscode");var Wu=class{constructor(e,t,r,i,o){this.serviceContainer=e;this._owner=t;this.controllerFactory=r;this.inputUri=o;this._onDidChangeViewState=new wt.EventEmitter;this.closedEvent=new wt.EventEmitter;this._submitters=[];this.internalDisposables=[];this.fs=this.serviceContainer.get(nt),this.configuration=this.serviceContainer.get(oe),this.jupyterExporter=this.serviceContainer.get(Og),this.interactiveWindowDebugger=this.serviceContainer.tryGet(t1),this.errorHandler=this.serviceContainer.get(Gr),this.codeGeneratorFactory=this.serviceContainer.get(yI),this.storageFactory=this.serviceContainer.get(Zs),this.kernelProvider=this.serviceContainer.get(ye),this.debuggingManager=this.serviceContainer.get(n1),this.notebookUri=i instanceof wt.TabInputInteractiveWindow||i instanceof wt.TabInputNotebook?i.uri:i.notebook.uri,this._owner&&this._submitters.push(this._owner),wt.window.onDidChangeActiveNotebookEditor(s=>{s?.notebook.uri.toString()===this.notebookUri.toString()&&this._onDidChangeViewState.fire()},this.internalDisposables),wt.workspace.onDidCloseNotebookDocument(s=>{s.uri.toString()===this.notebookUri.toString()&&this.closedEvent.fire()},this.internalDisposables),wt.window.activeNotebookEditor?.notebook.uri.toString()===this.notebookUri.toString()&&this._onDidChangeViewState.fire(),this.cellMatcher=new No(this.configuration.getSettings(this.owningResource)),this.notebookDocument&&this.codeGeneratorFactory.getOrCreate(this.notebookDocument)}get onDidChangeViewState(){return this._onDidChangeViewState.event}get closed(){return this.closedEvent.event}get owner(){return this._owner}get submitters(){return this._submitters}get notebookDocument(){return this._notebookDocument||(this._notebookDocument=wt.workspace.notebookDocuments.find(e=>e.uri.toString()===this.notebookUri.toString())),this._notebookDocument}get kernelConnectionMetadata(){return this.controller?.metadata}async notifyConnectionReset(){if(this.notebookDocument)this.controller||(this.controller=this.initController()),this.controller.setInfoMessageCell(y.noKernelConnected);else{let e=wt.workspace.onDidOpenNotebookDocument(async t=>{t.uri.toString()===this.notebookUri.toString()&&(this._notebookDocument=t,this.controller=this.initController(),this.internalDisposables.push(this.controller.listenForControllerSelection()),this.controller.setInfoMessageCell(y.noKernelConnected),e.dispose())})}}initController(){let e=this.controllerFactory.create(this,this.errorHandler,this.kernelProvider,this._owner);return this.internalDisposables.push(e.listenForControllerSelection()),e}async ensureInitialized(){if(!this.notebookDocument&&(p.debug("Showing Interactive editor to initialize codeGenerator from notebook document"),await this.showInteractiveEditor(),!this.notebookDocument))throw new Error("Could not open notebook document for Interactive Window");this.codeGeneratorFactory.get(this.notebookDocument)||this.codeGeneratorFactory.getOrCreate(this.notebookDocument),this.controller||(this.controller=this.initController()),this.controller.controller?(this.controller.startKernel().catch(h),await this.controller.resolveSysInfoCell()):(p.info("No controller selected for Interactive Window initialization"),this.controller.setInfoMessageCell(y.selectKernelForEditor))}async showInteractiveEditor(){let e;wt.window.tabGroups.all.find(i=>{i.tabs.find(o=>{(o.input instanceof wt.TabInputNotebook||o.input instanceof wt.TabInputInteractiveWindow)&&o.input.uri.toString()==this.notebookUri.toString()&&(e=o.group.viewColumn)})});let t=this.notebookDocument||await this.openNotebookDocument();return await wt.window.showNotebookDocument(t,{preserveFocus:!0,viewColumn:e,asRepl:!0})}async openNotebookDocument(){return p.debug(`Opening notebook document ${this.notebookUri}`),await wt.workspace.openNotebookDocument(this.notebookUri)}dispose(){this.internalDisposables.forEach(e=>e.dispose()),this.controller?.disconnect()}async showErrorForCell(e,t){let r=this.controller?.controller,i=sg(e);if(r&&i&&t){let o=Ki.getOrCreate(t,new Of(r));try{await o.appendOutput(i)}catch(s){p.warn(`Could not append error message "${i}" to cell: ${s}`)}finally{o.end(!1,t.executionSummary?.timing?.endTime)}}else p.info(`Could not append error message to cell "${i}"`)}changeMode(e){this.controller?.updateMode(e)}async addCode(e,t,r){return this.submitCode(e,t,r,!1)}useNewDebugMode(){return!!(this.configuration.getSettings(this.owner).forceIPyKernelDebugger||this.controller?.metadata&&!at(this.controller.metadata))}async debugCode(e,t,r){let i=!0,o=wt.workspace.textDocuments.find(a=>this.fs.arePathsSame(a.uri,t));if(!this.useNewDebugMode()&&o&&o.isUntitled){let a=[...wt.workspace.textDocuments];if(i=await o.save(),i){let l=wt.workspace.textDocuments.filter(c=>a.indexOf(c)===-1);l&&l.length>0&&(t=(l.find(u=>u.languageId==="python")||l.find(u=>!u.fileName.endsWith(".interactive"))||l[0]).uri,await wt.workspace.openTextDocument(t))}}let s=!0;return i?this.submitCode(e,t,r,!0):s}async submitCode(e,t,r,i){if(this.cellMatcher.isEmptyCell(e)||!this.controller?.controller)return!0;this.updateOwners(t);let o=Be(e,{trim:!1}),s=new No(this.configuration.getSettings(t)),a=-1;s.isMarkdown(o[0])&&Tm(o,(u,d)=>void 0,(u,d)=>{u&&u.length>0&&a===-1&&(a=d)});let c=(a>0?[o.slice(0,a).join(`
`),o.slice(a).join(`
`)]:[e]).map(u=>{let d=ne();this.controller.setPendingCellAdd(d.promise);let f=this.addNotebookCell(u,t,r),g=this.createExecutionPromise(f,i);return g.catch(b=>{b instanceof Hf?f.then(I=>{b.cell!==I&&this.showErrorForCell(y.cellStopOnErrorMessage,I).then(h,h)}).catch(h):f.then(I=>this.errorHandler.getErrorMessageForDisplayInCellOutput(b,"execution",this.owningResource).then(w=>this.showErrorForCell(w,I))).catch(h)}).finally(()=>{d?.resolve()}),g});return c[c.length-1]}async createExecutionPromise(e,t){if(!this.controller||!this.notebookDocument)return!1;p.ci("InteractiveWindow.ts.createExecutionPromise.start");let r=this.controller.startKernel(),i=await e,o=!0,s=async()=>void 0;try{let a=await r;await this.generateCodeAndAddMetadata(i,t,a),t&&this.useNewDebugMode()?await this.debuggingManager.start(this.notebookDocument,i):t&&at(a.kernelConnectionMetadata)&&this.interactiveWindowDebugger&&(s=async()=>this.interactiveWindowDebugger?.detach(a),await this.interactiveWindowDebugger.attach(a),await this.interactiveWindowDebugger.updateSourceMaps(this.storageFactory.get({notebook:i.notebook})?.all||[]),this.interactiveWindowDebugger.enable(a)),p.ci("InteractiveWindow.ts.createExecutionPromise.kernel.executeCell");let l=ms(i);o=await this.kernelProvider.getKernelExecution(a).executeCell(i,l?.generatedCode?.code).then(()=>!0,()=>!1),p.ci("InteractiveWindow.ts.createExecutionPromise.kernel.executeCell.finished")}finally{await s(),p.ci("InteractiveWindow.ts.createExecutionPromise.end")}if(!o)throw new Hf(i);return o}async expandAllCells(){this.notebookDocument&&await Promise.all(this.notebookDocument.getCells().map(async(e,t)=>{await wt.commands.executeCommand("notebook.cell.expandCellInput",{ranges:[{start:t,end:t+1}],document:this.notebookUri})}))}async collapseAllCells(){this.notebookDocument&&await Promise.all(this.notebookDocument.getCells().map(async(e,t)=>{e.kind===wt.NotebookCellKind.Code&&await wt.commands.executeCommand("notebook.cell.collapseCellInput",{ranges:[{start:t,end:t+1}],document:this.notebookUri})}))}async scrollToCell(e){let t=await this.showInteractiveEditor(),r=t.notebook.getCells().find(i=>ms(i)?.id===e);if(r){let i=new wt.NotebookRange(r.index,r.index+1);t.revealRange(i,wt.NotebookEditorRevealType.Default),t.selection=i}}async hasCell(e){let t=this.notebookDocument;return!!t&&t.getCells().some(r=>ms(r)?.id===e)}get owningResource(){if(this.owner)return this.owner;let e=_l();if(e)return e}updateOwners(e){this._owner||(this._owner=e,this.controller?.updateOwners(e)),this._submitters.find(t=>t.toString()==e.toString())||this._submitters.push(e)}async addNotebookCell(e,t,r){let i=this.notebookDocument;if(!i)throw new Error("No notebook document");let o=this.configuration.getSettings(this.owningResource),s=this.cellMatcher.getCellType(e)===sC,a=s?Qk(Be(e)).join(""):RQ(e,o,this.cellMatcher),l=this.cellMatcher.getFirstMarker(e),c=wt.workspace.textDocuments.find(b=>b.uri.toString()===this.owner?.toString())?.languageId??ge,u=new wt.NotebookCellData(s?wt.NotebookCellKind.Markup:wt.NotebookCellKind.Code,a,s?sC:c),d={uristring:t.toString(),lineIndex:r,originalSource:e},f={interactiveWindowCellMarker:l,interactive:d,id:lr()};u.metadata=f;let g;return await vc(i,async b=>{g=await this.getAppendIndex();let I=wt.NotebookEdit.insertCells(g,[u]);b.set(i.uri,[I])}),i.cellAt(g)}async getAppendIndex(){if(!this.notebookDocument)throw new Error("No notebook document");return this.notebookDocument.cellCount}async generateCodeAndAddMetadata(e,t,r){let i=ms(e);if(!i)return;let o=!at(r.kernelConnectionMetadata)||this.configuration.getSettings(void 0).forceIPyKernelDebugger,s=await this.codeGeneratorFactory.getOrCreate(this.notebookDocument).generateCode(i,e.index,t,o),a={...i,generatedCode:s},l=new wt.WorkspaceEdit,c=wt.NotebookEdit.updateCellMetadata(e.index,a);l.set(e.notebook.uri,[c]),await wt.workspace.applyEdit(l)}async export(){if(!this.notebookDocument)throw new Error("no notebook to export.");let e=_Q(this.notebookDocument),t=await new hc().showDialog("ipynb",this.owningResource);t&&await this.jupyterExporter?.exportToFile(e,Ae(t))}async exportAs(){if(await this.ensureInitialized(),!this.controller)throw new Error("An active kernel is required to export the notebook.");let e=this.controller.kernel?.value,t;if(this.submitters&&this.submitters.length){let r=this.submitters[this.submitters.length-1];t=Ce(r.path,Qi(r.path))}Lr()?wt.commands.executeCommand(J.ExportAsPythonScript,this.notebookDocument,e?.kernelConnectionMetadata.interpreter).then(h,h):wt.commands.executeCommand(J.Export,this.notebookDocument,t,e?.kernelConnectionMetadata.interpreter).then(h,h)}};v([TA()],Wu.prototype,"showErrorForCell",1),v([TA()],Wu.prototype,"createExecutionPromise",1);function KQ(n){return y.interactiveWindowTitleFormat(Ce(n.path))}var tL=class{constructor(e,t,r,i,o,s,a){this.controllerService=e;this.mode=t;this.interactiveWindow=r;this.errorHandler=i;this.kernelProvider=o;this.owner=s;this.disposables=[];this.controller=a?.controller,this.metadata=a?.connection}updateMode(e){this.mode=e}updateOwners(e){this.owner=e}async startKernel(){if(this.connectingListener?.dispose(),this.kernel)return this.kernel.promise;if(!this.controller||!this.metadata)throw new Error("Interactive Window kernel not selected");this.setInfoMessage(this.metadata,0);try{let e=await this.createKernel(),t=async()=>{this.interactiveWindow.notebookDocument&&this.metadata&&(this.systemInfoCell=void 0,this.setInfoMessage(this.metadata,1))};return this.disposables.push(e.addHook("willRestart",t)),e.onRestarted(async()=>{p.debug("Restart event handled in IW"),this.fileInKernel=void 0;try{await this.setFileInKernel(e)}catch{p.error("Failed to run initialization after restarting")}finally{this.finishSysInfoMessage(e,1)}},this,this.disposables),this.fileInKernel=void 0,await this.setFileInKernel(e),this.finishSysInfoMessage(e,0),e}catch(e){throw this.owner?this.deleteSysInfoCell():await this.finishSysInfoWithFailureMessage(e),e}}async createKernel(){if(this.kernel)return this.kernel.promise;if(!this.controller||!this.metadata)throw new Error("Controller not selected");let e=ne();e.promise.catch(h),this.kernel=e;try{let{kernel:t,actualController:r}=await this.controllerService.createKernel(this.metadata,this.controller,this.owner,this.interactiveWindow.notebookDocument,this.disposables);return this.metadata=t.kernelConnectionMetadata,this.controller=r,this.disposables.push(t),e.resolve(t),t}catch(t){throw e.reject(t),this.disconnect(),t}}async setFileInKernel(e){let t=this.owner;if(!t){p.ci("Unable to run initialization for IW");return}let r=Ae(t),i=this.kernelProvider.getKernelExecution(e);this.mode==="perFile"&&!this.fileInKernel?(p.debug(`Initializing __file__ in setFileInKernel with ${t} for mode ${this.mode}`),this.fileInKernel=t,await i.executeHidden(`__file__ = '${r.replace(/\\/g,"\\\\")}'`)):(!this.fileInKernel||this.fileInKernel.toString()!==t.toString())&&this.mode!=="perFile"?(p.debug(`Initializing __file__ in setFileInKernel with ${t} for mode ${this.mode}`),this.fileInKernel=t,await i.executeHidden(`__file__ = '${r.replace(/\\/g,"\\\\")}'`)):p.debug(`Not Initializing __file__ in setFileInKernel with ${r} for mode ${this.mode} currently ${this.fileInKernel}`)}setPendingCellAdd(e){this.metadata&&this.interactiveWindow.notebookDocument&&this.controllerService.getRegisteredController(this.metadata)?.setPendingCellAddition(this.interactiveWindow.notebookDocument,e)}listenForControllerSelection(){return this.controllerService.onControllerSelected(e=>{if(!(!this.interactiveWindow.notebookDocument||e.notebook.uri.toString()!==this.interactiveWindow.notebookDocument?.uri?.toString())&&e.controller.id!==this.controller?.id){let t=!!this.kernel;this.disconnect(),this.controller=e.controller.controller,this.metadata=e.controller.connection,t?this.startKernel().catch(h):(this.connectingListener?.dispose(),this.connectingListener=e.controller.onConnecting(()=>{this.startKernel().catch(h)}),this.disposables.push(this.connectingListener))}},this)}setInfoMessageCell(e){if(!this.interactiveWindow.notebookDocument){p.warn("Could not set info cell: no notebook document");return}this.systemInfoCell?this.systemInfoCell.updateMessage(e).catch(t=>p.warn(`could not update info cell with message: "${e}", error: ${t}`)):this.systemInfoCell=new s1(this.interactiveWindow,this.interactiveWindow.notebookDocument,e)}async resolveSysInfoCell(){await this.systemInfoCell?.resolveCell()}setInfoMessage(e,t){let r=wQ(e,t);this.setInfoMessageCell(r)}finishSysInfoMessage(e,t){let r=PQ(e.kernelConnectionMetadata,t);this.systemInfoCell?.updateMessage(r).catch(i=>p.warn(`System info message was not updated: "${r}" because of error: ${i}`)),this.systemInfoCell=void 0}async finishSysInfoWithFailureMessage(e){let t=await this.errorHandler.getErrorMessageForDisplayInCell(e,"start",this.owner);t=t.split(`
`).join(`  
`),this.systemInfoCell?.updateMessage(t).catch(r=>p.warn(`System info message was not updated: "${t}" because of error: ${r}`)),this.systemInfoCell=void 0}deleteSysInfoCell(){this.systemInfoCell?.deleteCell().then(h,h),this.systemInfoCell=void 0}disconnect(){this.disposables.forEach(e=>e.dispose()),this.disposables=[],this.kernel=void 0}},zf=class{constructor(e,t,r){this.controllerService=e;this.mode=t;this.initialController=r}create(e,t,r,i){if(!e.notebookDocument)throw Error("could not create controller: no notebook document");let o=this.initialController,s=this.controllerService.getSelectedController(e.notebookDocument);return s&&(o=s),new tL(this.controllerService,this.mode,e,t,r,i,o)}};var Ow=class extends Wu{async getAppendIndex(){if(this.editor?.replOptions||(this.editor=await this.showInteractiveEditor()),!this.editor?.replOptions)throw new Error("Interactive editor not found");return this.editor.replOptions.appendIndex}};var OQ="ds_asked_per_file_interactive",FQ="ds_interactive_window_cache",xI=class{constructor(e){this.serviceContainer=e}isForReplEditor(e){return this.interactiveWindowProvider||(this.interactiveWindowProvider=this.serviceContainer.get(ii)),this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e.uri)!==void 0}};xI=v([(0,Ji.injectable)(),m(0,(0,Ji.inject)(Ze))],xI);var DI=class{constructor(e,t,r,i,o,s,a,l){this.serviceContainer=e;this.disposables=t;this.fs=r;this.configService=i;this.globalMemento=o;this.workspaceMemento=s;this.notebookEditorProvider=a;this.controllerHelper=l;this._onDidChangeActiveInteractiveWindow=new Gt.EventEmitter;this._windows=[];this.notebookEditorProvider.registerEmbedNotebookProvider(this),this.restoreWindows()}get onDidChangeActiveInteractiveWindow(){return this._onDidChangeActiveInteractiveWindow.event}get activeWindow(){let e=Gt.window.activeNotebookEditor?.notebook.uri.toString();return e?this._windows.find(t=>t.notebookUri?.toString()===e):void 0}restoreWindows(){let e=new Map;Gt.window.tabGroups.all.forEach(t=>{t.tabs.forEach(r=>{let i=r.input;(i instanceof Gt.TabInputInteractiveWindow||i instanceof Gt.TabInputNotebook)&&e.set(i.uri.toString(),i)})}),this.workspaceMemento.get(FQ,[]).forEach(t=>{if(!t.uriString||!e.get(t.uriString))return;let r=e.get(t.uriString);if(!r)return;let i=this.configService.getSettings(r.uri).interactiveWindowMode,o=r instanceof Gt.TabInputInteractiveWindow?new Wu(this.serviceContainer,Gt.Uri.parse(t.owner),new zf(this.controllerHelper,i),r,Gt.Uri.parse(t.inputBoxUriString)):new Ow(this.serviceContainer,Gt.Uri.parse(t.owner),new zf(this.controllerHelper,i),r,Gt.Uri.parse(t.inputBoxUriString));o.notifyConnectionReset().catch(h),this._windows.push(o),T("DS_INTERNAL.CREATED_INTERACTIVE_WINDOW",{windowCount:this._windows.length},{hasKernel:!1,hasOwner:!!t.owner,mode:i,restored:!0});let s=o.closed(this.onInteractiveWindowClosed.bind(this,o));this.disposables.push(o),this.disposables.push(s),this.disposables.push(o.onDidChangeViewState(this.raiseOnDidChangeActiveInteractiveWindow.bind(this)))}),this._updateWindowCache()}async getOrCreate(e,t){if(!Gt.workspace.isTrusted)throw new Error("Workspace not trusted");let r=await this.getInteractiveMode(e);this.pendingCreations&&await this.pendingCreations.catch(h);let i=this.getExisting(e,r,t);return i||(i=await this.create(e,r,t)),await i.ensureInitialized(),i}get(e){let t=this.configService.getSettings(e).interactiveWindowMode;return this.getExisting(e,t)}async create(e,t,r){let i=ne();this.pendingCreations=i.promise;try{let o=this.configService.getSettings(e).interactiveReplNotebook,s=o?It:nr,a=await this.controllerHelper.getInitialController(e,s,r);p.info(`Starting interactive window for resource '${M(e)}' with controller '${a?.id}'`);let[l,c]=await this.createEditor(a,e,t,o);a&&a.controller.updateNotebookAffinity(c.notebook,Gt.NotebookControllerAffinity.Preferred),p.debug(`Interactive Window Editor Created: ${c.notebook.uri.toString()} with input box: ${l.toString()}`);let u=o?new Ow(this.serviceContainer,e,new zf(this.controllerHelper,t,a),c,l):new Wu(this.serviceContainer,e,new zf(this.controllerHelper,t,a),c,l);this._windows.push(u),T("DS_INTERNAL.CREATED_INTERACTIVE_WINDOW",{windowCount:this._windows.length},{hasKernel:!!a,hasOwner:!!e,mode:t,restored:!1}),this._updateWindowCache(),this.lastActiveInteractiveWindow=u;let d=u.closed(this.onInteractiveWindowClosed.bind(this,u));return this.disposables.push(u),this.disposables.push(d),this.disposables.push(u.onDidChangeViewState(this.raiseOnDidChangeActiveInteractiveWindow.bind(this))),u}finally{i.resolve()}}async createEditor(e,t,r,i){let o=t&&r==="perFile"?KQ(t):void 0,s=t!==void 0,a=this.getInteractiveViewColumn(t);if(i)return this.createNotebookBackedEditor(a,s,e?.controller,o);let{inputUri:l,notebookEditor:c}=await Gt.commands.executeCommand("interactive.open",{viewColumn:a,preserveFocus:s},void 0,e?`${_e}/${e.id}`:void 0,o);if(!c)throw new Error("Failed to request creation of interactive window from VS Code.");return[l,c]}async createNotebookBackedEditor(e,t,r,i){i=i||"Interactive-1";let o=await Gt.workspace.openNotebookDocument(It),s=await Gt.window.showNotebookDocument(o,{preserveFocus:r?!1:t,viewColumn:e,asRepl:i});if(!s.replOptions)throw new Error("Wrong type of editor created");return r&&await Gt.commands.executeCommand("notebook.selectKernel",{editor:s,id:r.id,extension:_e}),[o.cellAt(s.replOptions.appendIndex).document.uri,s]}getInteractiveViewColumn(e){if(e)return Gt.ViewColumn.Beside;let t=this.configService.getSettings(e).interactiveWindowViewColumn;return t==="secondGroup"?Gt.ViewColumn.One:t==="active"?Gt.ViewColumn.Active:Gt.ViewColumn.Beside}async getInteractiveMode(e){let t=this.configService.getSettings(e).interactiveWindowMode;if(t==="multiple"&&e&&!this.globalMemento.get(OQ)&&this._windows.length===1&&(!this._windows[0].owner||!this.fs.arePathsSame(this._windows[0].owner,e))){this.globalMemento.update(OQ,!0).then(h,h);let r=[y.interactiveWindowModeBannerSwitchYes,y.interactiveWindowModeBannerSwitchNo];await Gt.window.showInformationMessage(y.interactiveWindowModeBannerTitle,...r)===r[0]&&(t="perFile",this._windows[0].changeMode(t),await this.configService.updateSetting("interactiveWindow.creationMode",t,e,Gt.ConfigurationTarget.Global))}return t}_updateWindowCache(){let e=this._windows.map(t=>({owner:t.owner?.toString(),uriString:t.notebookUri.toString(),inputBoxUriString:t.inputUri.toString()}));this.workspaceMemento.update(FQ,e).then(h,h)}getExisting(e,t,r){return t==="single"?this._windows.length>0?this._windows[0]:void 0:t==="multiple"?e?this.activeWindow||this.lastActiveInteractiveWindow||this._windows[0]:void 0:this._windows.find(i=>!e&&!i.owner&&!r?!0:e&&i.owner&&this.fs.arePathsSame(e,i.owner)?!r||i.kernelConnectionMetadata?.id===r.id:!1)}raiseOnDidChangeActiveInteractiveWindow(){this.lastActiveInteractiveWindow=this.activeWindow?this.activeWindow:this.lastActiveInteractiveWindow,this._onDidChangeActiveInteractiveWindow.fire(this.activeWindow)}onInteractiveWindowClosed(e){p.debug(`Closing interactive window: ${e.notebookUri?.toString()}`),e.dispose(),this._windows=this._windows.filter(t=>t!==e),this._updateWindowCache(),this.lastActiveInteractiveWindow===e&&(this.lastActiveInteractiveWindow=this._windows[0]),this.raiseOnDidChangeActiveInteractiveWindow()}getActiveOrAssociatedInteractiveWindow(){if(this.activeWindow)return this.activeWindow;if(Gt.window.activeTextEditor===void 0)return;let e=Gt.window.activeTextEditor.document.uri;if(e.scheme!==ca)return this.get(e)}findNotebookEditor(e){let t;if(e&&e.path.endsWith(".interactive"))t=this.get(e)?.notebookDocument;else{let r=this.configService.getSettings(e).interactiveWindowMode;t=this.getExisting(e,r)?.notebookDocument}return t?Gt.window.visibleNotebookEditors.find(r=>r.notebook===t):void 0}findAssociatedNotebookDocument(e){return this._windows.find(i=>i.inputUri?.toString()===e.toString())?.notebookDocument}getInteractiveWindowWithNotebook(e){let t;return e!==void 0?t=this._windows.find(r=>r.notebookUri?.toString()===e.toString()):t=this.getActiveOrAssociatedInteractiveWindow(),t}getInteractiveWindowsWithSubmitter(e){return this._windows.filter(t=>t.submitters.find(r=>this.fs.arePathsSame(e,r)))}};DI=v([(0,Ji.injectable)(),m(0,(0,Ji.inject)(Ze)),m(1,(0,Ji.inject)(K)),m(2,(0,Ji.inject)(nt)),m(3,(0,Ji.inject)(oe)),m(4,(0,Ji.inject)(We)),m(4,(0,Ji.named)(dt)),m(5,(0,Ji.inject)(We)),m(5,(0,Ji.named)(di)),m(6,(0,Ji.inject)(Fn)),m(7,(0,Ji.inject)(r1))],DI);var Vu=k(N());var _I=class{constructor(e,t,r,i,o,s){this.kernelProvider=e;this.codeGeneratorFactory=r;this.storageFactory=i;this.controllers=o;this.replTracker=s;this.disposables=[];t.push(this)}dispose(){G(this.disposables)}activate(){this.kernelProvider.onDidCreateKernel(this.onDidCreateKernel,this,this.disposables),this.controllers.onControllerSelected(this.onNotebookControllerSelected,this,this.disposables)}onNotebookControllerSelected({notebook:e}){this.storageFactory.get({notebook:e})?.clear(),this.codeGeneratorFactory.get(e)?.reset()}onDidCreateKernel(e){let t=e.notebook;e.creator!=="jupyterExtension"||this.replTracker.isForReplEditor(t)||(this.storageFactory.get({notebook:t})?.clear(),e.onRestarted(()=>{this.storageFactory.get({notebook:t})?.clear(),this.codeGeneratorFactory.getOrCreate(t).reset()},this,this.disposables))}};_I=v([(0,Vu.injectable)(),m(0,(0,Vu.inject)(ye)),m(1,(0,Vu.inject)(K)),m(2,(0,Vu.inject)(yI)),m(3,(0,Vu.inject)(Zs)),m(4,(0,Vu.inject)(He)),m(5,(0,Vu.inject)(_o))],_I);var Qf=k(N()),bY=require("vscode");var yY=vY(),p1=/(;32m[ ->]*?)(\d+)(.*)/g,TI=class{constructor(e,t,r,i){this.storageFactory=e;this.platformService=t;this.configurationService=r;this.replTracker=i}format(e,t){if(!this.replTracker.isForReplEditor(e.notebook))return t;let r=this.storageFactory.get({notebook:e.notebook}),i=t.some(a=>/^[Input|Cell|File].*?\n.*/.test(a));if(!i&&!r)return t;let s=this.configurationService.getSettings(e.document.uri)?.formatStackTraces??!1;return t.map(a=>i?this.modifyTracebackFrameIPython8(a,r?.all,s):s?this.modifyTracebackFrameIPython7(a,r.all):a)}modifyTracebackFrameIPython8(e,t,r){e=e.replace(/\u001b\[4\dm/g,""),e=e.replace(/\u001b\[38;.*?\d+m/g,"\x1B[39m"),e=e.replace(/(;32m[ ->]*?)(\d+)(.*)\n/g,(u,d,f,g)=>(g=g.replace(/\u001b\[3\d+m/g,"\x1B[39m"),`${d}${f}${g}
`)),p.ci(`Trace frame to match: ${e}`);let i,o,s=/Cell\s+(?:\u001b\[.+?m)?In\s*\[(?<executionCount>\d+)\],\s*line (?<lineNumber>\d+).*/,l=/Input\s+?(?:\u001b\[.+?m)?In\s*\[(?<executionCount>\d+)\].*line: (?<lineNumber>\d).*/.exec(e),c=s.exec(e);if(l&&l.groups?.executionCount&&l.groups?.lineNumber?(i=parseInt(l.groups.executionCount),o=l.groups?.lineNumber):c&&c.groups?.executionCount&&c.groups?.lineNumber&&(i=parseInt(c.groups.executionCount),o=c.groups.lineNumber),t&&i){let u,d;for(let f of t)if(d=f.generatedCodes.find(g=>g.executionCount===i),d){u=f.uri;break}if(d&&u){let f=e;return r&&(f=f.replace(p1,(g,b,I,w)=>{let _=parseInt(I,10),V=(d.hasCellMarker?d.line-1:d.line)-1+d.lineOffsetRelativeToIndexOfFirstLineInCell+_;return`${b}<a href='${u?.toString()}?line=${V-1}'>${V}</a>${w}`})),f.replace(/.*?\n/,`File \x1B[1;32m${Ae(u)}:${o}\x1B[0m
`)}}if(r){let u=/^File.*?\[\d;32m(.*):\d+.*\u001b.*\n/.exec(e);if(u&&u.length>1){let d=Lh(u[1],Ae(this.platformService.homeDir)),f=bY.Uri.file(d);return e.replace(p1,(g,b,I,w)=>{let _=parseInt(I,10);return`${b}<a href='${f?.toString()}?line=${_-1}'>${_}</a>${w}`})}}return e}modifyTracebackFrameIPython7(e,t){return t.map(i=>i.uri).forEach(i=>{let o=Ae(i),s=M(i),a=this.storageFactory.get({fileUri:i});if(a){if(e.includes(o)&&new RegExp(`\\[.*?;32m${yY(o)}`).test(e)||e.includes(s)&&new RegExp(`\\[.*?;32m${yY(s)}`).test(e)){let l="",c=/(;32m[ ->]*?)(\d+)(.*)/g;for(let d=c.exec(e);d&&d.length>3;d=c.exec(e)){let f=cc(d[3]).substr(1);l=`${l}${f}
`}let u=this.findCellOffset(a.getFileGeneratedCode(i),l);u!==void 0&&(e=e.replace(p1,(d,f,g,b)=>{let I=parseInt(g,10),w=u+I-1;return`${f}<a href='${i.toString()}?line=${w}'>${w+1}</a>${b}`}))}if(e.includes(o)){let l=this.findCellOffset(a.getFileGeneratedCode(i),e);if(l)return e.replace(p1,(c,u,d,f)=>{let g=parseInt(d,10),b=l+g-1;return`${u}<a href='${i.toString()}?line=${b}'>${b+1}</a>${f}`})}}}),e}findCellOffset(e,t){if(e){for(let r of e)if(r.trimmedRightCode.indexOf(t)>=0)return r.firstNonBlankLineIndex}}};TI=v([(0,Qf.injectable)(),m(0,(0,Qf.inject)(Zs)),m(1,(0,Qf.inject)(xr)),m(2,(0,Qf.inject)(oe)),m(3,(0,Qf.inject)(_o))],TI);var ju=k(N());var Lw=class extends xn{constructor(e,t,r){let i=t||y.jupyterDebuggerNotInstalledError(e);super("notinstalled",i,r)}};function m1(n){let e={source:{path:Ae(n.uri)},pydevdSourceMaps:[]};return e.pydevdSourceMaps=n.generatedCodes.map(t=>({line:t.debuggerStartLine,endLine:t.endLine,runtimeSource:{path:t.runtimeFile},runtimeLine:t.runtimeLine})),e}var RI=class{constructor(e,t,r,i){this.apiProvider=e;this.configService=t;this.debugService=r;this.platform=i;this.configs=new WeakMap;this.debuggingActive=!1;this.debuggerPackage="debugpy",this.enableDebuggerCode="import debugpy;debugpy.listen(('localhost', 0))",this.waitForDebugClientCode="import debugpy;debugpy.wait_for_client()",this.tracingEnableCode="from debugpy import trace_this_thread;trace_this_thread(True)",this.tracingDisableCode="from debugpy import trace_this_thread;trace_this_thread(False)"}async attach(e){if(!e.session)throw new Error("Notebook not initialized");let t=this.configService.getSettings(e.resourceUri),r=e.kernelConnectionMetadata.interpreter?.uri;return this.startDebugSession(i=>this.debugService.startDebugging(void 0,i),e,{justMyCode:t.debugJustMyCode,python:r})}async detach(e){if(!e.session)return;let t=e.notebook;this.configs.get(t)&&(p.info("stop debugging"),this.debuggingActive=!1,this.debugService.stop(),e.status!=="dead"&&e.status!=="unknown"&&this.disable(e))}async updateSourceMaps(e){this.debugService.activeDebugSession&&this.debuggingActive&&(p.ci("Sending debug request for source map"),await Promise.all(e.map(async t=>{if(this.debuggingActive)return this.debugService.activeDebugSession.customRequest("setPydevdSourceMap",m1(t))})))}enable(e){e.session?.kernel&&gn(e.session.kernel,this.tracingEnableCode,{traceErrors:!0,traceErrorsMessage:"Execute_request failure enabling tracing code for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"}).catch(h)}disable(e){e.session?.kernel&&gn(e.session.kernel,this.tracingDisableCode,{traceErrors:!0,traceErrorsMessage:"Execute_request failure disabling tracing code for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"}).catch(h)}async startDebugSession(e,t,r){if(p.info("start debugging"),!t.session?.kernel)return;let i=await this.connect(t,r);if(i&&(p.info("connected to notebook during debugging"),this.debuggingActive=await e(i),this.debuggingActive)){this.debugService.removeBreakpoints([]);let o=await gn(t.session.kernel,this.waitForDebugClientCode,{traceErrors:!0,traceErrorsMessage:"Execute_request failure starting debug session for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"});o.some(s=>s.output_type==="error")?p.warn(`${this.debuggerPackage} not found in path.`):p.info(`import startup: ${fT(o)}`),await this.disable(t)}}async connect(e,t){let r=e.notebook,i=r,o=this.configs.get(i);if(o)return{...o,...t};p.info("enable debugger attach"),await this.appendDebuggerPaths(e),o={type:"python",name:"IPython",request:"attach",...t};let{host:s,port:a}=await this.connectToLocal(e);if(o.host=s,o.port=a,o.port){this.configs.set(r,o);let l=[],c=()=>{this.configs.delete(i),l.forEach(u=>u.dispose())};l.push(e.onDisposed(c)),l.push(e.onRestarted(c))}return o}async calculateDebuggerPathList(e){let t=[],r=this.configService.getSettings(e.resourceUri).debugpyDistPath;if(r&&(this.platform.isWindows&&(r=r.replace(/\\/g,"\\\\")),t.push(r)),at(e.kernelConnectionMetadata)){let i=await this.getDebuggerPath();this.platform.isWindows&&(i=i.replace(/\\/g,"\\\\")),t.push(i)}if(t&&t.length>0)return t.reduce((i,o)=>(i.length===0?i=`'${o}'`:i=`${i}, '${o}'`,i),"")}getDebuggerPath(){return this.apiProvider.getApi().then(e=>e.getDebuggerPath())}async appendDebuggerPaths(e){let t=await this.calculateDebuggerPathList(e);if(t&&t.length>0){let r=e.session?.kernel?await gn(e.session.kernel,`import sys as _VSCODE_sys\r
_VSCODE_sys.path.extend([${t}])\r
_VSCODE_sys.path\r
del _VSCODE_sys`,{traceErrors:!0,traceErrorsMessage:"Execute_request failure appending debugger paths for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"}):[];p.info(`Appending paths: ${fT(r)}`)}}async connectToLocal(e){let t=e.session?.kernel?await gn(e.session.kernel,this.enableDebuggerCode,{traceErrors:!0,traceErrorsMessage:"Execute_request failure enabling debugging for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"}):[];if(t.length>0)for(let r of t){let i=fT([r]);if(i){i=hm(i);let s=/\('(.*?)', ([0-9]*)\)/.exec(i);if(s)return{port:parseInt(s[2],10),host:s[1]}}}if(t.length>0&&t[0].output_type==="error"){let r=t[0];throw new Lw(this.debuggerPackage,r.ename,e.kernelConnectionMetadata)}throw new Lw(y.jupyterDebuggerOutputParseError(this.debuggerPackage),void 0,e.kernelConnectionMetadata)}};RI=v([(0,ju.injectable)(),m(0,(0,ju.inject)(tr)),m(1,(0,ju.inject)(oe)),m(2,(0,ju.inject)(Ja)),m(2,(0,ju.named)(Le.MULTIPLEXING_DEBUGSERVICE)),m(3,(0,ju.inject)(xr))],RI);var Sc=k(N()),Bp=require("vscode");var f1=class{constructor(e,t,r){this.debugAdapter=e;this.debugCell=t;this.execution=r;this._ready=ne();this.ready=this._ready.promise;T("DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUN_AND_DEBUG_CELL")}trace(e,t){p.debug(`[Debug-IW] ${e}: ${t}`)}async willSendEvent(e){return zF(e)?(this.trace("intercept","debugpyAttach request for subprocess, not supported"),!0):e.event==="output"&&Pw(e.body.output)?(this.trace("intercept","justMyCode notification"),!0):!1}async willSendRequest(e){let t=ms(this.debugCell);e.command==="setBreakpoints"&&t&&t.generatedCode&&!this.cellDumpInvoked&&(this.debugCellDumped||(this.debugCellDumped=Vf(this.execution,this.debugAdapter)),await this.debugCellDumped),e.command==="configurationDone"&&t&&t.generatedCode&&(this.debugCellDumped||(this.debugCellDumped=Vf(this.execution,this.debugAdapter)),await this.debugCellDumped,this._ready.resolve())}};var h1=class extends zb{constructor(){super(...arguments);this._ready=ne();this.ready=this._ready.promise}resolve(){this._ready.resolve()}};var rL=require("vscode");var g1=class extends Yb{constructor(t,r,i,o,s,a,l){super(t,r,i,o,s,a);this.cellToDebugFileSortedInReverseOrderByLineNumber=[];l&&(this.debugLocationTracker=l.createDebugAdapterTracker(t),this.debugLocationTracker.onWillStartSession&&this.debugLocationTracker.onWillStartSession(),this.onDidSendMessage(c=>{this.debugLocationTracker?.onDidSendMessage&&this.debugLocationTracker.onDidSendMessage(c)},this,this.disposables),this.onDidEndSession(()=>{this.debugLocationTracker?.onWillStopSession&&this.debugLocationTracker.onWillStopSession()},this,this.disposables))}handleClientMessageAsync(t){return p.ci(`KernelDebugAdapter::handleMessage ${JSON.stringify(t,void 0," ")}`),t.type==="request"&&this.debugLocationTracker?.onWillReceiveMessage&&this.debugLocationTracker.onWillReceiveMessage(t),t.type==="response"&&this.debugLocationTracker?.onDidSendMessage&&this.debugLocationTracker.onDidSendMessage(t),super.handleClientMessageAsync(t)}async dumpCell(t){let r=this.notebookDocument.cellAt(t),i=ms(r);if(!i)throw new Error("Not an interactive window cell");try{let o=(i.generatedCode?.code||r.document.getText()).replace(/\r\n/g,`
`),s=await this.session.customRequest("dumpCell",{code:o}),a=mn(s.sourcePath);this.fileToCell.set(a,rL.Uri.parse(i.interactive.uristring));let l=0;i.generatedCode&&!i.generatedCode.hasCellMarker&&(l=i.generatedCode.firstNonBlankLineIndex),this.cellToDebugFileSortedInReverseOrderByLineNumber.push({debugFilePath:a,interactiveWindow:rL.Uri.parse(i.interactive.uristring),metadata:i,lineOffset:l+i.interactive.lineIndex+(i.generatedCode?.lineOffsetRelativeToIndexOfFirstLineInCell||0)}),this.cellToDebugFileSortedInReverseOrderByLineNumber.sort((c,u)=>u.metadata.interactive.lineIndex-c.metadata.interactive.lineIndex)}catch(o){p.error(`Failed to dump cell for ${r.index} with code ${i.interactive.originalSource}`,o)}}translateDebuggerLocationToRealLocation(t,r){if(r=t?.source??r,!r||!r.path)return;let i=this.cellToDebugFileSortedInReverseOrderByLineNumber.find(o=>o.debugFilePath===r.path);i&&(r.name=Ce(i.interactiveWindow.path),r.path=i.interactiveWindow.toString(),typeof t?.endLine=="number"&&(t.endLine=t.endLine+(i.lineOffset||0)),typeof t?.line=="number"&&(t.line=t.line+(i.lineOffset||0)))}translateRealLocationToDebuggerLocation(t,r){let i=t.line;if(r=t?.source??r,!r||!r.path||typeof i!="number")return;let o=this.cellToDebugFileSortedInReverseOrderByLineNumber.find(s=>i>=s.metadata.interactive.lineIndex+1);!o||o.interactiveWindow.path!==r.path||(r.path=o.debugFilePath,typeof t?.endLine=="number"&&(t.endLine=t.endLine-(o.lineOffset||0)),typeof t?.line=="number"&&(t.line=t.line-(o.lineOffset||0)))}async sendRequestToJupyterSession(t){if(t.command==="setBreakpoints"){let r=t.arguments;if(delete r.lines,r.source.path!==this.cellToDebugFileSortedInReverseOrderByLineNumber[0]?.interactiveWindow.path)return super.sendRequestToJupyterSession(t);let i,o=[],s=[],a=()=>{if(o.length){let u=JSON.parse(JSON.stringify(t));u.arguments.breakpoints=o,s.push(super.sendRequestToJupyterSession(u))}};for(let u of t.arguments.breakpoints??[]){let d=this.cellToDebugFileSortedInReverseOrderByLineNumber.find(f=>u.line>=f.metadata.generatedCode.line&&u.line<=f.metadata.generatedCode.endLine);if(d&&d.metadata.interactive.lineIndex!==i)a(),i=d.metadata.interactive.lineIndex,o=[u];else if(d)o.push(u);else{let f={...u,verified:!0};s.push(Promise.resolve({body:{breakpoints:[f]}}))}}a();let l=await Promise.all(s),c=JSON.parse(JSON.stringify(l[0]));return l.slice(1).forEach(u=>{c.body.breakpoints=c.body.breakpoints.concat(u.body.breakpoints??[])}),c.command="setBreakpoints",c.type="response",c.success=!0,c.request_seq=t.seq,c}return super.sendRequestToJupyterSession(t)}getDumpFilesForDeletion(){return this.cellToDebugFileSortedInReverseOrderByLineNumber.map(t=>t.debugFilePath)}};var IY=require("vscode");var v1=class{constructor(e){this.debugCell=e}trace(e,t){p.debug(`[Debug-IWRestart] ${e}: ${t}`)}async willSendResponse(e){e.command==="initialize"&&e.body&&(e.body.supportsRestartRequest=!0)}async willSendRequest(e){if(e.command==="restart")return this.trace("restart","Showing warning for unsupported restart request"),IY.window.showWarningMessage(y.restartNotSupported,{modal:!0}).then(h,h),{command:e.command,request_seq:e.seq,seq:e.seq,success:!0,type:"response"}}};var AI=class extends Qb{constructor(t,r,i,o,s,a,l){super(t,r,l);this.platform=i;this.debugLocationTrackerFactory=o;this.configService=s;this.debugService=a}activate(){super.activate(),this.disposables.push(Bp.debug.registerDebugAdapterDescriptorFactory(MC,{createDebugAdapterDescriptor:async t=>this.createDebugAdapterDescriptor(t)}))}getDebugMode(t){return 2}async start(t,r){p.ci("Starting debugging IW"),await this.checkIpykernelAndPrompt(r)===1&&await this.startDebuggingCell(t,r)}async startDebuggingCell(t,r){let i=this.configService.getSettings(t.uri),o={type:MC,name:Ce(t.uri.toString()),request:"attach",justMyCode:i.debugJustMyCode,__notebookUri:t.uri.toString(),__mode:2,__cellIndex:r.index},s={suppressSaveBeforeStart:!0};await this.startDebuggingConfig(o,s);let a=this.notebookToDebugger.get(t);if(!a){p.error("Debugger not found, could not start debugging.");return}await a.ready}async createDebugAdapterDescriptor(t){let r=t.configuration;cQ(r);let i=Bp.workspace.notebookDocuments.find(s=>s.uri.toString()===r.__notebookUri);if(!i||typeof r.__cellIndex!="number"){p.error("Invalid debug session for debugging of IW using Jupyter Protocol");return}if(this.notebookInProgress.has(i)){p.info("Cannot start debugging. Already debugging this notebook");return}if(this.isDebugging(i)){p.info("Cannot start debugging. Already debugging this notebook document. Toolbar should update");return}let o=new h1(i,r,t);this.notebookToDebugger.set(i,o);try{return this.notebookInProgress.add(i),await this.doCreateDebugAdapterDescriptor(r,t,i,o)}finally{this.notebookInProgress.delete(i)}}async doCreateDebugAdapterDescriptor(t,r,i,o){let s=await this.ensureKernelIsRunning(i);if(!s?.session){Bp.window.showInformationMessage(y.kernelWasNotStarted).then(h,h);return}let a=new g1(r,i,s.session,s,this.platform,this.debugService,this.debugLocationTrackerFactory);this.disposables.push(a.onDidEndSession(this.endSession.bind(this)));let l=i.cellAt(t.__cellIndex),c=new f1(a,l,this.kernelProvider.getKernelExecution(s));return a.addDebuggingDelegates([c,new v1(l)]),c.ready.then(()=>o.resolve()).catch(u=>console.error("Failed waiting for controller to be ready",u)),this.trackDebugAdapter(i,a),new Bp.DebugAdapterInlineImplementation(a)}async updateSourceMaps(t,r){let i=this.getDebugSession(t.notebook);i&&(p.ci("Sending debug request for source map"),await Promise.all(r.map(async o=>{if(i)return i.customRequest("setPydevdSourceMap",m1(o))})))}};AI=v([(0,Sc.injectable)(),m(0,(0,Sc.inject)(ye)),m(1,(0,Sc.inject)(He)),m(2,(0,Sc.inject)(xr)),m(3,(0,Sc.inject)(D0)),m(4,(0,Sc.inject)(oe)),m(5,(0,Sc.inject)(Ui)),m(6,(0,Sc.inject)(Ze))],AI);var Uw=k(N()),Ww=require("vscode");var SY="InteractiveShiftEnterBanner";var $p=class{constructor(e,t){this.persistentState=e;this.configuration=t;this.disabledInCurrentSession=!1;this.bannerMessage=xN.bannerMessage;this.bannerLabels=[ce.bannerLabelYes,ce.bannerLabelNo];this.initialize()}initialize(){this.initialized||(this.initialized=!0,this.isEnabled())}isEnabled(){return this.persistentState.createGlobalPersistentState("InteractiveShiftEnterBanner",!0).value}async showBanner(){if(!this.isEnabled()||!await this.shouldShowBanner())return;switch(T("DS_INTERNAL.SHIFTENTER_BANNER_SHOWN"),await Ww.window.showInformationMessage(this.bannerMessage,...this.bannerLabels)){case this.bannerLabels[0]:{await this.enableInteractiveShiftEnter();break}case this.bannerLabels[1]:{await this.disableInteractiveShiftEnter();break}default:this.disabledInCurrentSession=!0}}async shouldShowBanner(){let e=this.configuration.getSettings();return Promise.resolve(this.isEnabled()&&!this.disabledInCurrentSession&&!e.sendSelectionToInteractiveWindow)}async disableInteractiveShiftEnter(){await this.configuration.updateSetting("interactiveWindow.textEditor.executeSelection",!1,void 0,Ww.ConfigurationTarget.Global),await this.disableBanner()}async enableInteractiveShiftEnter(){await this.configuration.updateSetting("interactiveWindow.textEditor.executeSelection",!0,void 0,Ww.ConfigurationTarget.Global),await this.disableBanner()}async disableBanner(){await this.persistentState.createGlobalPersistentState("InteractiveShiftEnterBanner",!1).updateValue(!1)}};v([ln("DATASCIENCE.DISABLE_INTERACTIVE_SHIFT_ENTER")],$p.prototype,"disableInteractiveShiftEnter",1),v([ln("DATASCIENCE.ENABLE_INTERACTIVE_SHIFT_ENTER")],$p.prototype,"enableInteractiveShiftEnter",1),$p=v([(0,Uw.injectable)(),m(0,(0,Uw.inject)(Pl)),m(1,(0,Uw.inject)(oe))],$p);var Yf=k(N()),CY=require("vscode");var NI=class{constructor(e,t,r,i){this.configService=e;this.fs=t;this.context=r;this.registry=i;this.priority=5}activate(){this.registry.register(this,nr)}async getCode(e){if(!Xe(e.kernelConnectionMetadata))return[];if(!Lr()){if(this.configService.getSettings(void 0).forceIPyKernelDebugger===!0)return[];if(!at(e.kernelConnectionMetadata))return[]}if(!at(e.kernelConnectionMetadata))return[];this.addRunCellHookContents||(this.addRunCellHookContents=this.fs.readFile(CY.Uri.joinPath(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers","kernel","addRunCellHook.py")));let t=await this.addRunCellHookContents;return Be(t,{trim:!1})}};NI=v([(0,Yf.injectable)(),m(0,(0,Yf.inject)(oe)),m(1,(0,Yf.inject)(nt)),m(2,(0,Yf.inject)(tt)),m(3,(0,Yf.inject)(Bc))],NI);var KI=k(N()),OI=require("vscode");var MI=class{constructor(e,t,r){this.dataScienceCodeLensProvider=e;this.extensionContext=t;this.configurationService=r}activate(){this.configurationService.getSettings().pythonCellFolding&&this.extensionContext.subscriptions.push(OI.languages.registerFoldingRangeProvider([CP],this))}provideFoldingRanges(e,t,r){if([ca,xh].includes(e.uri.scheme))return;let i=this.dataScienceCodeLensProvider.getCodeWatcher(e);if(i){let o=i.getCodeLenses();return r.isCancellationRequested||o.length==0?void 0:o.map(s=>new OI.FoldingRange(s.range.start.line,s.range.end.line,OI.FoldingRangeKind.Region))}}};MI=v([(0,KI.injectable)(),m(0,(0,KI.inject)(Up)),m(1,(0,KI.inject)(tt)),m(2,(0,KI.inject)(oe))],MI);var LI=k(N());var EY=require("vscode");var FI=class{constructor(e,t,r){this.dataScienceCodeLensProvider=e;this.extensionContext=t}activate(){this.extensionContext.subscriptions.push(EY.languages.registerCodeLensProvider([CP],this.dataScienceCodeLensProvider))}};FI=v([(0,LI.injectable)(),m(0,(0,LI.inject)(Up)),m(1,(0,LI.inject)(tt)),m(2,(0,LI.inject)(Wp))],FI);var ta=k(N());var nL="LastInteractiveKernelSelected",UI=class{constructor(e,t,r,i,o){this.controllerRegistration=e;this.interpreterService=t;this.disposables=r;this.workspaceMemento=i;this.serviceContainer=o;this.onControllerSelected=this.controllerRegistration.onControllerSelected}async getInitialController(e,t,r){if(r){let i=this.controllerRegistration.get(r,t);if(i)return i}if(this.workspaceMemento.get(nL)){let i=this.workspaceMemento.get(nL),o=i?this.controllerRegistration.get(i,t):void 0;if(o)return o}if(this.interpreterService)return await ohe(t,e,this.interpreterService,this.controllerRegistration)}getSelectedController(e){return this.controllerRegistration.getSelected(e)}getRegisteredController(e){return this.controllerRegistration.get(e,"interactive")}async createKernel(e,t,r,i,o){await Ca(r,e);let s=(u,d)=>{u!=="start"&&u!=="restart"||p.ci(`(onStart) Looking for controller ${d.controller.id} in ${this.controllerRegistration.all.map(f=>`${f.kind}:${f.id}`).join(", ")}`)},a=await Qs.connectToNotebookKernel(e,this.serviceContainer,{resource:r||i.uri,notebook:i,controller:t},new Mt(!1),o,"jupyterExtension",s),l=this.controllerRegistration.registered.find(u=>u.id===a.controller.id);if(!l)throw Error(`Controller ${a.controller.id} not found or not yet created`);let c=l.controller;return this.interpreterService&&she(a.kernelConnectionMetadata,r,this.interpreterService).then(async u=>{await this.workspaceMemento.update(nL,u?void 0:a.kernelConnectionMetadata)}).catch(u=>{p.warn("Failed to store kernel connection metadata",u)}),{kernel:a,actualController:c}}};UI=v([(0,ta.injectable)(),m(0,(0,ta.inject)(He)),m(1,(0,ta.inject)(rt)),m(1,(0,ta.optional)()),m(2,(0,ta.inject)(K)),m(3,(0,ta.inject)(We)),m(3,(0,ta.named)(di)),m(4,(0,ta.inject)(Ze))],UI);async function ohe(n,e,t,r){let i=await t.getActiveInterpreter(e);if(i){let o=await Ns(i),s=$o.create({kernelSpec:o,interpreter:i,id:Oi(o,i)}),a=r.addOrUpdate(s,[n]),l=a[0];return r.trackActiveInterpreterControllers(a),p.ci(`Active Interpreter Controller ${l.connection.kind}:${l.id} created for View ${n} with resource ${M(e)}`),l}}async function she(n,e,t){return(await t.getActiveInterpreter(e))?.id===n.interpreter?.id}var Xf=k(require("vscode")),y1=k(N());var WI=class{constructor(e){this.configService=e;this.cache=new Map;this.disposables=[];this.cachedOwnsSetting=this.configService.getSettings(void 0).sendSelectionToInteractiveWindow,Xf.workspace.onDidChangeConfiguration(this.onSettingChanged,this,this.disposables),Xf.window.onDidChangeActiveTextEditor(this.onChangedActiveTextEditor,this,this.disposables),this.onChangedActiveTextEditor(),Xf.workspace.onDidCloseTextDocument(this.onClosedDocument,this,this.disposables)}getCellRanges(e){let t=this.cache.get(e.uri);if(t&&t.version===e.version)return t.ranges;let r=this.configService.getSettings(e.uri),i=ZF(e,r);return this.cache.set(e.uri,{version:e.version,ranges:i}),this.updateContextKeys(e),i}clear(){this.cache.clear()}onChangedActiveTextEditor(){let e=Xf.window.activeTextEditor;!e||e.document.languageId!=ge||[ca,xh].includes(e.document.uri.scheme)?(new cr(Cr.HasCodeCells).set(!1).catch(r=>p.warn("Failed to set jupyter.HasCodeCells context",r)),this.updateContextKeys(!1)):this.updateContextKeys(e.document)}onSettingChanged(e){if(this.cache.clear(),e.affectsConfiguration("jupyter.interactiveWindow.textEditor.executeSelection")){let t=this.configService.getSettings(void 0);this.cachedOwnsSetting=t.sendSelectionToInteractiveWindow,this.updateContextKeys()}}updateContextKeys(e){let t=!1;if(typeof e=="boolean")t=e;else{let r=e??Xf.window.activeTextEditor?.document;t=r?this.getCellRanges(r).length>0:!1}new cr(Cr.OwnsSelection).set(this.cachedOwnsSetting||t).catch(h),new cr(Cr.HasCodeCells).set(t).catch(h)}onClosedDocument(e){this.cache.delete(e.uri)}dispose(){this.disposables.forEach(e=>e.dispose())}};WI=v([(0,y1.injectable)(),m(0,(0,y1.inject)(oe))],WI);function wY(n){n.addSingleton(ii,DI),n.addSingleton(_o,xI),n.addSingleton(r1,UI),n.addSingleton(me,ps),n.addSingleton(me,PI),n.addSingleton(Wp,WI),n.add(Z0,er),n.addSingleton(e1,SI),n.addSingleton(Up,CI),n.addSingleton(me,FI),n.addSingleton(me,MI),n.addSingleton(me,EI),n.addSingleton(me,_I),n.addSingleton(me,NI),n.addSingleton(yI,bI,void 0,[me]),n.addSingleton(Zs,wI),n.addSingleton(Pg,TI),n.addSingleton(t1,RI),n.addSingleton(n1,AI,void 0,[me]),n.addSingleton(G2,$p,SY)}var Jp=k(N()),Cc=require("vscode");var VI=class{constructor(e,t,r){this.jupyterServerHelper=e;this.fileSystem=t;this.errorHandler=r;this.extractPythonMainVersion=async()=>{if(!this.jupyterServerHelper)return 3;let e=await this.jupyterServerHelper.getUsableJupyterPython(),t=await yd(e);return e&&t&&t.major||3}}async exportToFile(e,t,r=!0){let i=await this.serialize(e);try{if(await this.fileSystem.writeFile(Cc.Uri.file(t),i||""),!r)return;let o=y.exportOpenQuestion1;Cc.window.showInformationMessage(y.exportDialogComplete(t),o).then(async s=>{try{s===o&&await o1(Cc.Uri.file(t))}catch(a){await this.errorHandler.handleError(a)}},h)}catch(o){p.error("Error in exporting notebook file"),Cc.window.showInformationMessage(y.exportDialogFailed(o)).then(h,h)}}async serialize(e,t){let r=await this.extractPythonMainVersion(),i={language_info:{codemirror_mode:{name:"ipython",version:r},file_extension:".py",mimetype:"text/x-python",name:"python",nbconvert_exporter:"python",pygments_lexer:`ipython${r}`,version:r},kernelspec:t},o=Cc.extensions.getExtension("vscode.ipynb")?.exports;if(!o)throw new Error("vscode.ipynb extension not found");let s=new Cc.NotebookData(e);return s.metadata={metadata:i,nbformat:xA.major,nbformat_minor:xA.minor},o.exportNotebook(s)}};VI=v([(0,Jp.injectable)(),m(0,(0,Jp.inject)(Kg)),m(0,(0,Jp.optional)()),m(1,(0,Jp.inject)(nt)),m(2,(0,Jp.inject)(Gr))],VI);var qp=k(N()),PY=require("vscode");var jI=class{constructor(e,t,r,i,o){this.fs=e;this.disposableRegistry=t;this.configuration=r;this.nbConvertDependencyChecker=i;this.exportToPythonService=o;this.isDisposed=!1;this.nbconvertBaseTemplateFormat=`{%- extends '{0}' -%}
{% block codecell %}
{1}
{{ super() }}
{% endblock codecell %}
{% block in_prompt %}{% endblock in_prompt %}
{% block input %}{{ cell.source | ipython2python }}{% endblock input %}
{% block markdowncell scoped %}{1} [markdown]
{{ cell.source | comment_lines }}
{% endblock markdowncell %}`;this.nbconvert5Null="null.tpl";this.nbconvert6Null="base/null.j2";this.dispose=()=>{this.isDisposed=!0};this.addInstructionComments=e=>y.instructionComments(this.defaultCellMarker).concat(e);this.addIPythonImport=e=>vC(_h.ImportIPython,this.defaultCellMarker,e)}async importFromFile(e,t){let r=await this.nbConvertDependencyChecker.getNbConvertVersion(t);if(r){let i;r.major>=6?(this.template6Promise||(this.template6Promise=this.createTemplateFile(!0)),i=await this.template6Promise):(this.template5Promise||(this.template5Promise=this.createTemplateFile(!1)),i=await this.template5Promise);let o=await this.exportToPythonService.exportNotebookToPython(e,t,i);return o.includes("get_ipython()")&&(o=this.addIPythonImport(o)),this.addInstructionComments(o)}throw new Error(y.jupyterNbConvertNotSupported)}get defaultCellMarker(){return this.configuration.getSettings().defaultCellMarker||Le.DefaultCodeCellMarker}async createTemplateFile(e){let t=await this.fs.createTemporaryLocalFile(".tpl");if(t)try{return this.disposableRegistry.push(t),await this.fs.writeFile(PY.Uri.file(t.filePath),vC(this.nbconvertBaseTemplateFormat,e?this.nbconvert6Null:this.nbconvert5Null,this.defaultCellMarker)),t.filePath}catch{}}};jI=v([(0,qp.injectable)(),m(0,(0,qp.inject)(gr)),m(1,(0,qp.inject)(K)),m(2,(0,qp.inject)(oe)),m(3,(0,qp.inject)(Fg)),m(4,(0,qp.inject)(Dx))],jI);var ra=k(N());var fs=require("vscode");var b1=class{constructor(e,t,r,i,o,s){this.fileConverter=e;this.fs=t;this.interactiveProvider=r;this.controllerRegistration=i;this.preferredKernel=o;this.kernelFinder=s;this.disposables=[]}register(){this.registerCommand(J.ExportAsPythonScript,(e,t)=>this.export(e,"python",void 0,t)),this.registerCommand(J.ExportToHTML,(e,t,r)=>this.export(e,"html",t,r)),this.registerCommand(J.ExportToPDF,(e,t,r)=>this.export(e,"pdf",t,r)),this.registerCommand(J.Export,(e,t,r)=>this.export(e,void 0,t,r)),this.registerCommand(J.NativeNotebookExport,e=>this.nativeNotebookExport(e))}dispose(){this.disposables.forEach(e=>e.dispose())}registerCommand(e,t){let r=fs.commands.registerCommand(e,t,this);this.disposables.push(r)}async nativeNotebookExport(e){let t=Gn(e)?e:e?.notebookEditor?.notebookUri,r=t?fs.workspace.notebookDocuments.find(i=>this.fs.arePathsSame(i.uri,t)):fs.window.activeNotebookEditor?.notebook;if(r){let i,o=this.kernelFinder.registered.find(l=>l.kind==="localPythonEnvironment"),s=new fs.CancellationTokenSource;try{i=o?await this.preferredKernel.findPreferredLocalKernelSpecConnection(r,o,s.token).then(l=>l?.interpreter):void 0}finally{s.dispose()}let a=this.controllerRegistration.getSelected(r)?.connection.interpreter||i;return this.export(r,void 0,void 0,a)}else return this.export(void 0,void 0,void 0,void 0)}async export(e,t,r,i){if(!e){if(e=fs.window.activeNotebookEditor?.notebook||this.interactiveProvider?.getActiveOrAssociatedInteractiveWindow()?.notebookDocument,!e){p.info("Export called without a valid exportable document active");return}i=i||this.controllerRegistration.getSelected(e)?.connection.interpreter,t&&T("DATASCIENCE.EXPORT_NOTEBOOK_AS_COMMAND",void 0,{format:t})}if(t)await this.fileConverter.export(t,e,r,i);else{let o=await this.showExportQuickPickMenu(e,r,i).then(s=>s);o!==void 0?o.handler():T("DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK")}}getExportQuickPickItems(e,t,r){let i=[];return(r||e.metadata&&xg(Mi(e)))&&i.push({label:y.exportPythonQuickPickLabel,picked:!0,handler:()=>{T("DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK",void 0,{format:"python"}),fs.commands.executeCommand(J.ExportAsPythonScript,e,r).then(h,h)}}),i.push({label:y.exportHTMLQuickPickLabel,picked:!1,handler:()=>{T("DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK",void 0,{format:"html"}),fs.commands.executeCommand(J.ExportToHTML,e,t,r).then(h,h)}},{label:y.exportPDFQuickPickLabel,picked:!1,handler:()=>{T("DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK",void 0,{format:"pdf"}),fs.commands.executeCommand(J.ExportToPDF,e,t,r).then(h,h)}}),i}async showExportQuickPickMenu(e,t,r){let i=this.getExportQuickPickItems(e,t,r),o={ignoreFocusOut:!1,matchOnDescription:!0,matchOnDetail:!0,placeHolder:y.exportAsQuickPickPlaceholder};return fs.window.showQuickPick(i,o)}};var I1=require("vscode");var BI=class{constructor(e,t,r,i,o,s,a){this.disposables=e;this.fileConverter=t;this.fs=r;this.interactiveProvider=i;this.controllerSelection=o;this.kernelFinder=s;this.jupyterConnection=a;this.exportCommand=new b1(this.fileConverter,this.fs,this.interactiveProvider,o,new Ap(a),s),I1.workspace.isTrusted||I1.workspace.onDidGrantWorkspaceTrust(this.registerCommandsIfTrusted,this,this.disposables)}activate(){this.registerCommandsIfTrusted()}registerCommandsIfTrusted(){I1.workspace.isTrusted&&this.exportCommand?.register()}};BI=v([(0,ra.injectable)(),m(0,(0,ra.inject)(K)),m(1,(0,ra.inject)(rI)),m(2,(0,ra.inject)(nt)),m(3,(0,ra.inject)(ii)),m(3,(0,ra.optional)()),m(4,(0,ra.inject)(He)),m(5,(0,ra.inject)(Ar)),m(6,(0,ra.inject)(un))],BI);var Hp=k(N()),JI=require("vscode");var kY=require("vscode");var iL="JVSC_NEVER_PROMPT_EXTENSIONS_LIST",ahe=new Map([["ms-dotnettools.dotnet-interactive-vscode",{displayName:".NET Interactive Notebooks Preview",extensionLink:"https://marketplace.visualstudio.com/items?itemName=ms-dotnettools.dotnet-interactive-vscode"}]]),lhe=new Map([["c#","ms-dotnettools.dotnet-interactive-vscode"],["csharp","ms-dotnettools.dotnet-interactive-vscode"],["f#","ms-dotnettools.dotnet-interactive-vscode"],["fsharp","ms-dotnettools.dotnet-interactive-vscode"],["powershell","ms-dotnettools.dotnet-interactive-vscode"]]),$I=class{constructor(e,t,r){this.controllerManager=e;this.globalMemento=r;this.disposables=[];this.recommendedInSession=new Set;t.push(this)}dispose(){G(this.disposables)}activate(){JI.workspace.onDidOpenNotebookDocument(this.onDidOpenNotebookDocument,this,this.disposables),this.controllerManager.onControllerSelected(this.onNotebookControllerSelected,this,this.disposables)}onDidOpenNotebookDocument(e){if(!St(e))return;let t=px(Mi(e));t&&this.recommendExtensionForLanguage(t).catch(h)}onNotebookControllerSelected({controller:e}){if(e.connection.kind!=="startUsingLocalKernelSpec"&&e.connection.kind!=="startUsingRemoteKernelSpec"||Xe(e.connection))return;let t=yo(e.connection);t&&this.recommendExtensionForLanguage(t).catch(h)}async recommendExtensionForLanguage(e){let t=lhe.get(e.toLowerCase());if(!t||kY.extensions.getExtension(t))return;let r=ahe.get(t);if(!r||this.globalMemento.get(iL,[]).includes(t)||this.recommendedInSession.has(t))return;this.recommendedInSession.add(t);let i=y.recommendExtensionForNotebookLanguage(`[${r.displayName}](${r.extensionLink})`,e);switch(T("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"displayed"}),await JI.window.showInformationMessage(i,ce.bannerLabelYes,ce.bannerLabelNo,ce.doNotShowAgain)){case ce.bannerLabelYes:{T("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"ok"}),JI.commands.executeCommand("extension.open",t).then(h,h);break}case ce.bannerLabelNo:{T("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"cancel"});break}case ce.doNotShowAgain:{T("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"doNotShowAgain"});let s=this.globalMemento.get(iL,[]);s.includes(t)||(s.push(t),await this.globalMemento.update(iL,s));break}default:T("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"dismissed"})}}};$I=v([(0,Hp.injectable)(),m(0,(0,Hp.inject)(He)),m(1,(0,Hp.inject)(K)),m(2,(0,Hp.inject)(We)),m(2,(0,Hp.named)(dt))],$I);var Ec=k(N()),hs=require("vscode");var qI=class{constructor(e,t,r,i,o){this.interactiveProvider=e;this.kernelProvider=r;this.controllers=i;this.jupyterUriProviderRegistration=o;this.disposables=[];this.isPythonFileActive=!1;this.ownedOpenNotebooks=new Set;t.push(this),this.nativeContext=new cr(Cr.IsNativeActive),this.canRestartNotebookKernelContext=new cr(Cr.CanRestartNotebookKernel),this.canInterruptNotebookKernelContext=new cr(Cr.CanInterruptNotebookKernel),this.canRestartInteractiveWindowKernelContext=new cr(Cr.CanRestartInteractiveWindowKernel),this.canInterruptInteractiveWindowKernelContext=new cr(Cr.CanInterruptInteractiveWindowKernel),this.interactiveContext=new cr(Cr.IsInteractiveActive),this.interactiveOrNativeContext=new cr(Cr.IsInteractiveOrNativeActive),this.pythonOrNativeContext=new cr(Cr.IsPythonOrNativeActive),this.pythonOrInteractiveContext=new cr(Cr.IsPythonOrInteractiveActive),this.pythonOrInteractiveOrNativeContext=new cr(Cr.IsPythonOrInteractiveOrNativeActive),this.hasNativeNotebookCells=new cr(Cr.HaveNativeCells),this.isPythonNotebook=new cr(Cr.IsPythonNotebook),this.isJupyterKernelSelected=new cr(Cr.IsJupyterKernelSelected),this.hasNativeNotebookOrInteractiveWindowOpen=new cr(Cr.HasNativeNotebookOrInteractiveWindowOpen),this.kernelSourceContext=new cr(Cr.KernelSource)}dispose(){this.disposables.forEach(e=>e.dispose())}activate(){hs.window.onDidChangeActiveTextEditor(this.onDidChangeActiveTextEditor,this,this.disposables),this.kernelProvider.onKernelStatusChanged(this.onDidKernelStatusChange,this,this.disposables),this.interactiveProvider&&(this.interactiveProvider.onDidChangeActiveInteractiveWindow(this.onDidChangeActiveInteractiveWindow,this,this.disposables),this.interactiveProvider.activeWindow&&this.onDidChangeActiveInteractiveWindow()),hs.window.activeNotebookEditor&&this.onDidChangeActiveNotebookEditor(hs.window.activeNotebookEditor),hs.window.onDidChangeActiveNotebookEditor(this.onDidChangeActiveNotebookEditor,this,this.disposables),hs.window.activeTextEditor?.document.languageId===ge&&this.onDidChangeActiveTextEditor(hs.window.activeTextEditor),hs.workspace.onDidCloseNotebookDocument(this.updateNativeNotebookInteractiveWindowOpenContext,this,this.disposables),this.controllers.onControllerSelectionChanged(()=>this.updateSelectedKernelContext(),this,this.disposables),this.updateSelectedKernelContext()}updateNativeNotebookCellContext(){let e=(hs.window.activeNotebookEditor?.notebook.cellCount||0)>0;this.hasNativeNotebookCells.set(e).catch(h)}onDidChangeActiveInteractiveWindow(e){this.interactiveContext.set(!!e).catch(h),this.updateMergedContexts(),this.updateContextOfActiveInteractiveWindowKernel()}onDidChangeActiveNotebookEditor(e){let t=e?e.notebook.notebookType===It:!1;this.nativeContext.set(t).catch(h),this.isPythonNotebook.set(e&&t?xg(Mi(e.notebook)):!1).catch(h),this.updateContextOfActiveNotebookKernel(e),this.updateContextOfActiveInteractiveWindowKernel(),this.updateNativeNotebookCellContext(),this.updateMergedContexts()}updateNativeNotebookInteractiveWindowOpenContext(e,t){t?this.ownedOpenNotebooks.add(e):this.ownedOpenNotebooks.delete(e),this.hasNativeNotebookOrInteractiveWindowOpen.set(this.ownedOpenNotebooks.size>0).catch(h)}updateContextOfActiveNotebookKernel(e){let t=e&&e.notebook.notebookType===It?this.kernelProvider.get(e.notebook):void 0;if(t){let r=this.kernelProvider.getKernelExecution(t),i=t.status!=="unknown"||r.executionCount>0||t.startedAtLeastOnce;this.canRestartNotebookKernelContext.set(!!i).catch(h);let o=t.status==="busy";this.canInterruptNotebookKernelContext.set(!!o).catch(h)}else this.canRestartNotebookKernelContext.set(!1).catch(h),this.canInterruptNotebookKernelContext.set(!1).catch(h);this.updateKernelSourceContext(t).catch(h),this.updateSelectedKernelContext()}async updateKernelSourceContext(e){if(!e||!Dt(e.kernelConnectionMetadata)){this.kernelSourceContext.set("").catch(h);return}let t=e.kernelConnectionMetadata,r=await this.jupyterUriProviderRegistration.jupyterCollections.find(i=>i.extensionId===t.serverProviderHandle.extensionId&&i.id===t.serverProviderHandle.id);if(!r){this.kernelSourceContext.set("").catch(h);return}this.kernelSourceContext.set(r.id).catch(h)}updateSelectedKernelContext(){let e=hs.window.activeNotebookEditor?.notebook||this.interactiveProvider?.getActiveOrAssociatedInteractiveWindow()?.notebookDocument;e&&St(e)&&this.controllers.getSelected(e)?(this.isJupyterKernelSelected.set(!0).catch(h),this.updateNativeNotebookInteractiveWindowOpenContext(e,!0)):this.isJupyterKernelSelected.set(!1).catch(h)}updateContextOfActiveInteractiveWindowKernel(){let e=this.interactiveProvider?.getActiveOrAssociatedInteractiveWindow()?.notebookDocument,t=e?this.kernelProvider.get(e):void 0;if(t){let r=t.status!=="unknown";this.canRestartInteractiveWindowKernelContext.set(!!r).catch(h);let i=t.status==="busy";this.canInterruptInteractiveWindowKernelContext.set(!!i).catch(h)}else this.canRestartInteractiveWindowKernelContext.set(!1).catch(h),this.canInterruptInteractiveWindowKernelContext.set(!1).catch(h);this.updateSelectedKernelContext()}onDidKernelStatusChange({kernel:e}){let t=e.notebook;t.notebookType===nr?this.updateContextOfActiveInteractiveWindowKernel():t.notebookType===It&&t===hs.window.activeNotebookEditor?.notebook&&this.updateContextOfActiveNotebookKernel(hs.window.activeNotebookEditor)}onDidChangeActiveTextEditor(e){this.isPythonFileActive=e?.document.languageId===ge&&!RW(e.document.uri),this.updateNativeNotebookCellContext(),this.updateMergedContexts(),this.updateContextOfActiveInteractiveWindowKernel()}updateMergedContexts(){this.interactiveOrNativeContext.set(this.nativeContext.value===!0||this.interactiveContext.value===!0).catch(h),this.pythonOrNativeContext.set(this.nativeContext.value===!0||this.isPythonFileActive===!0).catch(h),this.pythonOrInteractiveContext.set(this.interactiveContext.value===!0||this.isPythonFileActive===!0).catch(h),this.pythonOrInteractiveOrNativeContext.set(this.nativeContext.value===!0||this.interactiveContext.value===!0&&this.isPythonFileActive===!0).catch(h)}};qI=v([(0,Ec.injectable)(),m(0,(0,Ec.inject)(ii)),m(0,(0,Ec.optional)()),m(1,(0,Ec.inject)(K)),m(2,(0,Ec.inject)(ye)),m(3,(0,Ec.inject)(He)),m(4,(0,Ec.inject)(Jt))],qI);var S1=k(N()),wc=require("vscode");var che=/^\s*(from (?<fromImport>\w+)(?:\.\w+)* import \w+(?:, \w+)*(?: as \w+)?|import (?<importImport>\w+(?:, \w+)*)(?: as \w+)?)$/,uhe=1e3,dhe=Rr(),HI=class{constructor(e,t=1e3){this.pendingChecks=new Io;this.disposables=new or;this.sentMatches=new Set;this.processedNotebookCells=new WeakMap;e.push(this.disposables),this.disposables.add(new wc.Disposable(()=>G(this.pendingChecks.values()))),this.isTelemetryDisabled=Mk(),this.disposables.add(wc.workspace.onDidOpenNotebookDocument(i=>this.onOpenedOrClosedNotebookDocument(i,"onOpenCloseOrSave"))),this.disposables.add(wc.workspace.onDidCloseNotebookDocument(i=>this.onOpenedOrClosedNotebookDocument(i,"onOpenCloseOrSave"))),this.disposables.add(wc.workspace.onDidSaveNotebookDocument(i=>this.onOpenedOrClosedNotebookDocument(i,"onOpenCloseOrSave")));let r=this.disposables.add(new bs(t));this.disposables.add(ar.onDidChangeNotebookCellExecutionState(i=>{r.trigger(()=>{i.state==2&&!this.isTelemetryDisabled&&this.checkNotebookCell(i.cell,"onExecution").catch(h)})},this)),this.disposables.add(Kk(i=>this.isTelemetryDisabled=i))}activate(){wc.workspace.notebookDocuments.forEach(e=>this.checkNotebookDocument(e,"onOpenCloseOrSave"))}getDocumentLines(e){let t=[];for(let r=0;r<Math.min(uhe,e.lineCount);r++){let i=e.lineAt(r);i.isEmptyOrWhitespace||t.push(i.text.trim())}return t}onOpenedOrClosedNotebookDocument(e,t){!St(e)||this.isTelemetryDisabled||this.scheduleCheck(e.uri,this.checkNotebookDocument.bind(this,e,t))}scheduleCheck(e,t){let r=this.pendingChecks.get(e);if(r&&(r.dispose(),this.pendingChecks.delete(e)),dhe)t();else{let i=setTimeout(t,5e3);this.pendingChecks.set(e,new wc.Disposable(()=>clearTimeout(i)))}}async checkNotebookDocument(e,t){!St(e)||this.isTelemetryDisabled||await Promise.all(e.getCells().map(async r=>this.checkNotebookCell(r,t)))}async checkNotebookCell(e,t){if(!(!St(e.notebook)||e.kind!==wc.NotebookCellKind.Code||e.document.languageId!==ge||this.processedNotebookCells.get(e)===e.document.version))try{this.processedNotebookCells.set(e,e.document.version);let r=e.notebook.notebookType===It?"notebook":"interactive";await this.sendTelemetryForImports(this.getDocumentLines(e.document),r,t)}catch(r){if(!qn)throw r}}lookForImports(e){let t=[];try{for(let r of e){if(!r.includes("import")&&!r.includes("from"))continue;let i=r?che.exec(r):null;i!==null&&i.groups!==void 0&&(i.groups.fromImport!==void 0?t.push(i.groups.fromImport):i.groups.importImport!==void 0&&t.push(...i.groups.importImport.split(",").map(o=>o.trim())))}}catch{}return t}async sendTelemetryForImports(e,t,r){await Promise.all(this.lookForImports(e).map(async i=>{let o=`${i}_${t||""}_${r}`;if(this.sentMatches.has(o))return;this.sentMatches.add(o);let s=await ot(i);T("HASHED_PACKAGE_NAME",void 0,{hashedNamev2:s,resourceType:t,when:r})}))}};HI=v([(0,S1.injectable)(),m(0,(0,S1.inject)(K))],HI);var Bu=k(N());var GI=class{constructor(e,t,r){this.disposableRegistry=e;this.rawSupported=t;this.commandListeners=r;this.isDisposed=!1;this.startTime=Date.now()}get activationStartTime(){return this.startTime}activate(){this.disposableRegistry.push(this),this.computeZmqAvailable(),this.commandListeners&&this.commandListeners.forEach(e=>e.register())}async dispose(){this.changeHandler&&(this.changeHandler.dispose(),this.changeHandler=void 0)}computeZmqAvailable(){new cr(Cr.ZmqAvailable).set(this.rawSupported?this.rawSupported.isSupported:!1).then(h,h)}};GI=v([(0,Bu.injectable)(),m(0,(0,Bu.inject)(K)),m(1,(0,Bu.inject)(_n)),m(1,(0,Bu.optional)()),m(2,(0,Bu.multiInject)(Dk))],GI);var Ci=k(N()),C1=require("vscode");var eh=k(N()),Zf=require("vscode");var DY=require("vscode");var oL="JUPYTER_API_ACCESS_INFORMATION",xY=new Set([_e.split(".")[0],"rchiodo","donjayamanne","SynapseVSCode"]),sL=new Set(["rchiodo","nuant"]),$u=class{constructor(e,t){this.globalState=e;this.context=t;this.extensionAccess=new Map;this.promiseChain=new Ah}async getAccessInformation(e){let t=!e.extensionId||e.extensionId===Rh?"":e.extensionId.split(".")[0]||"";if(this.context.extensionMode===Zf.ExtensionMode.Test||!t||Ks()==="insiders"){if(!xY.has(t)&&!sL.has(t)){p.warn(`Publisher ${t} is allowed to access the Kernel API with a message.`);let s=DY.extensions.getExtension(e.extensionId)?.packageJSON?.displayName||"",a=s&&e.extensionId?`${s} (${e.extensionId})`:e.extensionId||t;Zf.window.showErrorMessage(y.thanksForUsingJupyterKernelApiPleaseRegisterWithUs(a)).then(h,h)}if(!sL.has(t)||!t||this.context.extensionMode===Zf.ExtensionMode.Test)return{extensionId:e.extensionId,accessAllowed:!0}}if(xY.has(t))return{extensionId:e.extensionId,accessAllowed:!0};if(!sL.has(t))return Zf.window.showErrorMessage(`Please contact the Jupyter Extension to get access to the Kernel API. Publisher ${t}`).then(h,h),p.error(`Publisher ${t} is not allowed to access the Kernel API.`),{extensionId:e.extensionId,accessAllowed:!1};let i=this.globalState.get(oL)?.find(s=>s.extensionId===e.extensionId);if(i)return T("DATASCIENCE.JUPYTER_KERNEL_API_ACCESS",void 0,{extensionId:e.extensionId,allowed:i.allowed}),{extensionId:e.extensionId,accessAllowed:i.allowed==="yes"};if(this.extensionAccess.get(e.extensionId))return this.extensionAccess.get(e.extensionId);let o=(async()=>{let s=y.allowExtensionToUseJupyterKernelApi(`${e.displayName} (${e.extensionId})`,ce.bannerLabelYes),l=await Zf.window.showInformationMessage(s,{modal:!0},ce.bannerLabelYes,ce.bannerLabelNo)===ce.bannerLabelYes;return this.promiseChain.chainFinally(async()=>{let c=[...this.globalState.get(oL,[])];return c=c.filter(u=>u.extensionId!==e.extensionId),c.push({allowed:l?"yes":"no",extensionId:e.extensionId}),this.globalState.update(oL,c)}).then(h,h),T("DATASCIENCE.JUPYTER_KERNEL_API_ACCESS",void 0,{extensionId:e.extensionId,allowed:l?"yes":"no"}),{extensionId:e.extensionId,accessAllowed:l}})();return this.extensionAccess.set(e.extensionId,o),o}};$u=v([(0,eh.injectable)(),m(0,(0,eh.inject)(We)),m(0,(0,eh.named)(dt)),m(1,(0,eh.inject)(tt))],$u);var _Y=new WeakMap;function aL(n){let e=_Y.get(n);return e||(e=phe(n),_Y.set(n,e)),e}function phe(n){return new Proxy(n,{get(e,t){return t==="kernel"?e.kernel?mhe(e.kernel):void 0:Reflect.get(e,t)}})}var TY=new WeakMap;function mhe(n){let e=TY.get(n);return e||(e=fhe(n),TY.set(n,e)),e}function fhe(n){return new Proxy(n,{get(e,t){return t==="registerCommTarget"?(r,i)=>(Ez(n,r),Reflect.get(e,t).apply(e,[r,i])):t==="removeCommTarget"?(r,i)=>(wz(n,r),Reflect.get(e,t).apply(e,[r,i])):Reflect.get(e,t)}})}var zI=class{constructor(e,t,r,i,o,s,a,l){this.kernelProvider=e;this.kernelFinder=t;this.thirdPartyKernelProvider=r;this.disposables=i;this.controllerRegistration=o;this.apiAccess=s;this.extensions=a;this.serviceContainer=l;this.chainedApiAccess=new Ah;this.extensionApi=new Map}async getService(){let e=this.extensions.determineExtensionFromCallStack(),t=await this.chainedApiAccess.chainFinally(()=>this.apiAccess.getAccessInformation(e));if(!t.accessAllowed)return;if(this.extensionApi.get(t.extensionId))return this.extensionApi.get(t.extensionId);let r=new Vw(t.extensionId,this.kernelProvider,this.kernelFinder,this.thirdPartyKernelProvider,this.disposables,this.controllerRegistration,this.serviceContainer);return this.extensionApi.set(t.extensionId,r),r}};zI=v([(0,Ci.injectable)(),m(0,(0,Ci.inject)(ye)),m(1,(0,Ci.inject)(Ar)),m(2,(0,Ci.inject)(Nm)),m(3,(0,Ci.inject)(K)),m(4,(0,Ci.inject)(He)),m(5,(0,Ci.inject)($u)),m(6,(0,Ci.inject)(va)),m(7,(0,Ci.inject)(Ze))],zI);var Vw=class{constructor(e,t,r,i,o,s,a){this.callingExtensionId=e;this.kernelProvider=t;this.kernelFinder=r;this.thirdPartyKernelProvider=i;this.disposables=o;this.controllerRegistration=s;this.serviceContainer=a;this._onDidChangeKernelSpecifications=new C1.EventEmitter;this._onDidChangeKernels=new C1.EventEmitter;this.translatedConnections=new WeakMap;this._onDidChangeStatus=new C1.EventEmitter;this._status=this.kernelFinder.status,this.kernelFinder.onDidChangeStatus(()=>{this._status=this.kernelFinder.status,this._onDidChangeStatus.fire()},this,o),this.kernelProvider.onDidDisposeKernel(l=>{p.ci(`Kernel ${l.kernelConnectionMetadata.id}, ${l.kernelConnectionMetadata.interpreter?.uri.toString()} disposed`),this._onDidChangeKernels.fire()},this,o),this.kernelProvider.onDidStartKernel(l=>{p.ci(`Kernel ${l.kernelConnectionMetadata.id}, ${l.kernelConnectionMetadata.interpreter?.uri.toString()} started`),this._onDidChangeKernels.fire()},this,o),this.thirdPartyKernelProvider.onDidDisposeKernel(l=>{p.ci(`Third party Kernel ${l.kernelConnectionMetadata.id}, ${l.kernelConnectionMetadata.interpreter?.uri.toString()} disposed`),this._onDidChangeKernels.fire()},this,o),this.thirdPartyKernelProvider.onDidStartKernel(l=>{p.ci(`Third party Kernel ${l.kernelConnectionMetadata.id}, ${l.kernelConnectionMetadata.interpreter?.uri.toString()} started`),this._onDidChangeKernels.fire()},this,o),this.controllerRegistration.onDidChange(()=>this._onDidChangeKernelSpecifications.fire(),this,o)}get onDidChangeKernelSpecifications(){return T("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"onDidChangeKernelSpecifications"}),p.debug(`API called from ${this.callingExtensionId}`),this._onDidChangeKernelSpecifications.event}get onDidChangeKernels(){return T("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"onDidChangeKernels"}),this._onDidChangeKernels.event}get status(){return this._status}get onDidChangeStatus(){return this._onDidChangeStatus.event}async getKernelSpecifications(){return T("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"getKernelSpecifications"}),this.kernelFinder.kernels.map(e=>this.translateKernelConnectionMetadataToExportedType(e))}getActiveKernels(){T("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"getActiveKernels"});let e=[],t=new Set;return this.kernelProvider.kernels.filter(r=>r.startedAtLeastOnce||r.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel").forEach(r=>{let i=this.kernelProvider.get(r.notebook);i&&i.session?.kernel?.id&&t.add(i.session.kernel.id),e.push({metadata:this.translateKernelConnectionMetadataToExportedType(r.kernelConnectionMetadata),uri:r.uri,id:r.id})}),this.thirdPartyKernelProvider.kernels.filter(r=>r.startedAtLeastOnce||r.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel").forEach(r=>{let i=this.thirdPartyKernelProvider.get(r.uri);i&&i.session?.kernel?.id&&t.add(i.session.kernel.id),e.push({metadata:this.translateKernelConnectionMetadataToExportedType(r.kernelConnectionMetadata),uri:r.uri,id:r.id})}),this.controllerRegistration.registered.forEach(r=>{r.controller.notebookType===It&&r.connection.kind==="connectToLiveRemoteKernel"&&(!r.connection.kernelModel.id||t.has(r.connection.kernelModel.id)||e.push({metadata:r.connection,uri:void 0,id:r.id}))}),e}getKernel(e){T("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"getKernel"});let t=this.thirdPartyKernelProvider.get(e)??this.kernelProvider.get(e);if(t?.session)return{metadata:this.translateKernelConnectionMetadataToExportedType(t.kernelConnectionMetadata),connection:aL(t.session)}}async startKernel(e,t){return T("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"startKernel"}),this.startOrConnect(e,t)}async connect(e,t){return T("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"connect"}),this.startOrConnect(e,t)}async startOrConnect(e,t){let r=this.kernelFinder.kernels.find(o=>o.id===e.id);if(!r)throw new Error("Not found");let i=await Qs.connectToKernel(r,this.serviceContainer,{resource:t},new Mt(!1),this.disposables,"3rdPartyExtension");if(!i?.session)throw new Error("Not found");return aL(i.session)}translateKernelConnectionMetadataToExportedType(e){if(!this.translatedConnections.has(e)){let t=Object.freeze(As.fromJSON(e.toJSON()));this.translatedConnections.set(e,t)}return this.translatedConnections.get(e)}};Vw=v([m(1,(0,Ci.inject)(ye)),m(2,(0,Ci.inject)(Ar)),m(3,(0,Ci.inject)(Nm)),m(4,(0,Ci.inject)(K)),m(5,(0,Ci.inject)(He)),m(6,(0,Ci.inject)(Ze))],Vw);var E1=k(N()),Pc=require("vscode");var RY=require("vscode");var th=class{constructor(e){this.fileSystem=e;this.activatedWorkspaces=new Set;this.disposables=[]}activate(){this.addHandlers(),this.addRemoveDocOpenedHandlers(),this.activateWorkspace(this.getActiveResource()).catch(h)}getActiveResource(){let e=RY.window.activeTextEditor;return e&&!e.document.isUntitled?e.document.uri:Array.isArray(Pc.workspace.workspaceFolders)&&Pc.workspace.workspaceFolders.length>0?Pc.workspace.workspaceFolders[0].uri:void 0}async activateWorkspace(e){let t=this.getWorkspaceKey(e);this.activatedWorkspaces.has(t)||(this.activatedWorkspaces.add(t),await l8(this.fileSystem,e))}onDocOpened(e){if(e.languageId!==ge)return;let t=this.getWorkspaceKey(e.uri);if(t===""||(Pc.workspace.workspaceFolders||[]).length===0||this.activatedWorkspaces.has(t))return;let r=Pc.workspace.getWorkspaceFolder(e.uri);this.activateWorkspace(r?r.uri:void 0).catch(h)}addHandlers(){this.disposables.push(Pc.workspace.onDidChangeWorkspaceFolders(this.onWorkspaceFoldersChanged,this))}addRemoveDocOpenedHandlers(){if(this.hasMultipleWorkspaces()){this.docOpenedHandler||(this.docOpenedHandler=Pc.workspace.onDidOpenTextDocument(this.onDocOpened,this));return}this.docOpenedHandler&&(this.docOpenedHandler.dispose(),this.docOpenedHandler=void 0)}onWorkspaceFoldersChanged(){let e=(Pc.workspace.workspaceFolders||[]).map(i=>this.getWorkspaceKey(i.uri)),r=Array.from(this.activatedWorkspaces.keys()).filter(i=>e.indexOf(i)<0);if(r.length>0)for(let i of r)this.activatedWorkspaces.delete(i);this.addRemoveDocOpenedHandlers()}hasMultipleWorkspaces(){return(Pc.workspace.workspaceFolders||[]).length>1}getWorkspaceKey(e){return Ds(e,"")}};v([Zh("Failed to activate a workspace")],th.prototype,"activateWorkspace",1),th=v([(0,E1.injectable)(),m(0,(0,E1.inject)(nt))],th);var YI=k(N());var QI=class{constructor(e){this.syncActivationServices=e}activate(){this.syncActivationServices.map(e=>{try{e.activate()}catch(t){p.error(`Error in activating extension, failed in ${e.constructor.name}`,t)}})}};QI=v([(0,YI.injectable)(),m(0,(0,YI.optional)()),m(0,(0,YI.multiInject)(me))],QI);var jw=k(N()),Gp=require("vscode");var lL=Symbol("ISurveyBanner");var kc=class{constructor(e,t){this.persistentState=e;this.disposables=t;this.disabledInCurrentSession=!1;this.bannerLabels=[Ck.bannerLabelYes,Ck.bannerLabelNo];this.showBannerState=new Map;this.NotebookExecutionThreshold=250;this.setPersistentState(0,"ShowInsidersNotebookSurveyBanner"),this.setPersistentState(1,"ShowExperimentNotebookSurveyBanner");let r=setTimeout(()=>{kc.surveyDelay=!0},10*60*1e3);this.disposables.push(new Gp.Disposable(()=>clearTimeout(r)))}isEnabled(e){switch(e){case 0:if(Ks()==="insiders")return this.isEnabledInternal(e);break;case 1:if(Ks()==="stable")return this.isEnabledInternal(e);break;default:return p.error("Invalid Banner Type"),!1}return!1}isEnabledInternal(e){return Gp.env.uiKind!==Gp.UIKind.Desktop?!1:this.showBannerState.get(e).value.expiry?this.showBannerState.get(e).value.expiry<Date.now():!0}activate(){this.onDidChangeNotebookCellExecutionStateHandler=ar.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,this.disposables)}async showBanner(e){let t=this.shouldShowBanner(e);if(this.onDidChangeNotebookCellExecutionStateHandler?.dispose(),!t)return;switch(this.disabledInCurrentSession=!0,await Gp.window.showInformationMessage(this.getBannerMessage(e),...this.bannerLabels)){case this.bannerLabels[0]:{await this.launchSurvey(e),await this.disable(0,e);break}default:{await this.disable(1,e);break}}}shouldShowBanner(e){return dm()||!this.isEnabled(e)||this.disabledInCurrentSession||!kc.surveyDelay?!1:this.getExecutionCount(e)>=this.NotebookExecutionThreshold}setPersistentState(e,t){this.showBannerState.set(e,this.persistentState.createGlobalPersistentState(t,{data:!0}))}async launchSurvey(e){qd(this.getSurveyLink(e))}async disable(e,t){let r=e===0?6:4;r&&await this.showBannerState.get(t).updateValue({expiry:r*31*864e5+Date.now(),data:!0})}getExecutionCount(e){switch(e){case 0:return this.getPersistentState("DS_InsidersNotebookExecutionCount");case 1:return this.getPersistentState("DS_ExperimentNotebookExecutionCount");default:return p.error("Invalid Banner type"),-1}}getPersistentState(e){return this.persistentState.createGlobalPersistentState(e,0).value}async onDidChangeNotebookCellExecutionState(e){St(e.cell.notebook)&&e.state===3&&(this.updateStateAndShowBanner("DS_InsidersNotebookExecutionCount",0).catch(h),this.updateStateAndShowBanner("DS_ExperimentNotebookExecutionCount",1).catch(h))}async updateStateAndShowBanner(e,t){if(!this.shouldShowBanner(t)){this.onDidChangeNotebookCellExecutionStateHandler?.dispose();return}let r=this.persistentState.createGlobalPersistentState(e,0);await r.updateValue(r.value+1),this.showBanner(t).catch(h)}getBannerMessage(e){switch(e){case 0:case 1:return DN.bannerMessage;default:return p.error("Invalid Banner type"),""}}getSurveyLink(e){switch(e){case 0:return"https://aka.ms/vscjupyternb";case 1:return"https://aka.ms/vscnbexp";default:return p.error("Invalid Banner type"),""}}};kc.surveyDelay=!1,kc=v([(0,jw.injectable)(),m(0,(0,jw.inject)(Pl)),m(1,(0,jw.inject)(K))],kc);var Qa=require("vscode");function AY(n,e){e&&Qa.commands.registerCommand("dataScience.ClearCache",async()=>{let t=[];for(let r of n.globalState.keys())t.push(n.globalState.update(r,void 0).then(h,h));for(let r of n.workspaceState.keys())t.push(n.workspaceState.update(r,void 0).then(h,h));t.push(Qa.commands.executeCommand(J.ClearSavedJupyterUris).then(h,h)),await Promise.all(t).catch(h),await Promise.all([Qa.workspace.fs.delete(Qa.Uri.joinPath(n.globalStorageUri,"lastExecutedRemoteCell.json")).then(h,h),Qa.workspace.fs.delete(Qa.Uri.joinPath(n.globalStorageUri,"remoteServersMRUList.json")).then(h,h),Qa.workspace.fs.delete(Qa.Uri.joinPath(n.globalStorageUri,Wy)).then(h,h),eH(n).then(h,h)]),p.info("Cache cleared")})}function NY(n,e){AY(n,e)}var k1=k(N()),Vt=require("vscode");var w1=y.percentPipCondaInstallInsteadOfBang("pip"),cL=y.percentPipCondaInstallInsteadOfBang("conda"),MY=y.matplotlibWidgetInsteadOfOther,P1="Jupyter",XI=class{constructor(e){this.disposables=[];this.notebooksProcessed=new WeakMap;this.cellsToProcess=new Set;this.problems=Vt.languages.createDiagnosticCollection(P1),this.disposables.push(this.problems),e.push(this)}dispose(){G(this.disposables),this.problems.dispose()}activate(){this.disposables.push(Vt.languages.registerCodeActionsProvider(ge,this)),this.disposables.push(Vt.languages.registerHoverProvider(ge,this)),Vt.workspace.onDidChangeTextDocument(t=>{let r=hg(t.document);if(!r)return;let i=r.getCells().find(o=>o.document===t.document);i&&this.analyzeNotebookCell(i)},this,this.disposables),Vt.workspace.onDidCloseNotebookDocument(t=>{this.problems.delete(t.uri);let r=this.notebooksProcessed.get(t);this.notebooksProcessed.delete(t),r&&r.forEach((i,o)=>this.problems.delete(Vt.Uri.parse(o)))},this,this.disposables),Vt.workspace.onDidOpenNotebookDocument(t=>this.analyzeNotebook(t),this,this.disposables);let e=new bs(300);this.disposables.push(e),Vt.workspace.onDidChangeNotebookDocument(t=>{e.trigger(()=>{let r=this.notebooksProcessed.get(t.notebook);t.contentChanges.forEach(i=>{i.removedCells.forEach(o=>{r?.delete(o.document.uri.toString())}),i.addedCells.forEach(o=>this.queueCellForProcessing(o))}),t.cellChanges.forEach(i=>this.queueCellForProcessing(i.cell))})},this,this.disposables),Vt.workspace.notebookDocuments.map(t=>this.analyzeNotebook(t))}provideHover(e,t,r){if(hg(e)?.notebookType!==It)return;let o=this.problems.get(e.uri);if(!o)return;let s=o.find(l=>l.message===w1||l.message===cL);if(!s||!s.range.contains(t))return;let a=s.message===w1?"pip":"conda";return new Vt.Hover(y.pipCondaInstallHoverWarning(a,"https://aka.ms/jupyterCellMagicBangInstall"),s.range)}provideCodeActions(e,t,r,i){if(!hg(e))return[];let o=[];return r.diagnostics.forEach(s=>{switch(s.message){case w1:o.push(this.createReplaceCodeAction(e,"pip",s));break;case cL:o.push(this.createReplaceCodeAction(e,"conda",s));break;case MY:o.push(this.createGotoWikiAction(e,Vt.Uri.parse("https://aka.ms/vscodejupytermatplotlibwidget"),s));break;default:break}}),o}createReplaceCodeAction(e,t,r){let i=new Vt.CodeAction(y.replacePipCondaInstallCodeAction(t),Vt.CodeActionKind.QuickFix);i.isPreferred=!0,i.diagnostics=[r];let o=new Vt.WorkspaceEdit;return o.replace(e.uri,new Vt.Range(r.range.start,new Vt.Position(r.range.start.line,r.range.start.character+1)),"%"),i.edit=o,i}createGotoWikiAction(e,t,r){let i=new Vt.CodeAction(y.matplotlibWidgetCodeActionTitle,Vt.CodeActionKind.QuickFix);return i.isPreferred=!0,i.diagnostics=[r],i.command={title:y.matplotlibWidgetCodeActionTitle,command:"vscode.open",arguments:[t]},i}analyzeNotebook(e){e.notebookType===It&&e.getCells().forEach((t,r)=>r<100?this.queueCellForProcessing(t):void 0)}queueCellForProcessing(e){this.cellsToProcess.add(e),this.analyzeNotebookCells()}analyzeNotebookCells(){if(this.cellsToProcess.size===0)return;let e=this.cellsToProcess.values().next().value;e&&(this.cellsToProcess.delete(e),this.analyzeNotebookCell(e)),setTimeout(()=>this.analyzeNotebookCells(),0)}analyzeNotebookCell(e){if(e.kind!==Vt.NotebookCellKind.Code||e.document.languageId!==ge||e.notebook.isClosed||e.document.isClosed||this.notebooksProcessed.get(e.notebook)?.get(e.document.uri.toString())===e.document.version)return;this.problems.delete(e.document.uri);let t=this.notebooksProcessed.get(e.notebook)||new Map;t.set(e.document.uri.toString(),e.document.version),this.notebooksProcessed.set(e.notebook,t);for(let r=0;r<Math.min(e.document.lineCount,50);r++){let i=e.document.lineAt(r),o=i.text;if(o.trim().startsWith("!pip install")){let s=o.indexOf("!"),a=o.indexOf("l"),l=new Vt.Range(i.lineNumber,s,i.lineNumber,a+2);this.problems.set(e.document.uri,[{message:w1,range:l,severity:Vt.DiagnosticSeverity.Warning,source:P1}])}else if(o.trim().startsWith("!conda install")){let s=o.indexOf("!"),a=o.indexOf("l"),l=new Vt.Range(i.lineNumber,s,i.lineNumber,a+2);this.problems.set(e.document.uri,[{message:cL,range:l,severity:Vt.DiagnosticSeverity.Warning,source:P1}])}else if(o.trim().startsWith("%matplotlib")&&!o.trim().endsWith("widget")&&!o.trim().endsWith("inline")){let s=o.indexOf("%"),a=o.length,l=new Vt.Range(i.lineNumber,s,i.lineNumber,a);this.problems.set(e.document.uri,[{message:MY,range:l,severity:Vt.DiagnosticSeverity.Warning,source:P1}])}}}};XI=v([(0,k1.injectable)(),m(0,(0,k1.inject)(K))],XI);var R1=k(N()),Sr=require("vscode");var KY=new Map([["method",0],["function",1],["constructor",2],["field",3],["variable",4],["class",5],["struct",6],["interface",7],["module",8],["property",9],["event",10],["operator",11],["unit",12],["value",13],["constant",14],["enum",15],["enumMember",16],["keyword",17],["text",18],["color",19],["file",20],["reference",21],["customcolor",22],["folder",23],["typeParameter",24],["snippet",25],["<unknown>",3]]);function x1(n){if(n>=300)return"ZZZZZZZ";if(n<=25)return`A${String.fromCharCode(65+n)}`;let e=String.fromCharCode(65+Math.ceil(n/25)),t=String.fromCharCode(65+n%25);return`${e}${t}`}var jY=require("vscode");var rh=require("vscode");var ghe=new Map([["julia",Ihe],["python",yhe],["r",She]]);function OY(n,e){let t=ghe.get(e.toLowerCase());return t?t(n):n}var vhe=["Docstring:","Options:","Parameters","Returns","See Also","Notes","Examples","Usage:","Subclasses:"];function yhe(n){let e=Be(n,{trim:!1,removeEmptyEntries:!1}),t=-1,r=!1,i=!1,o=[],s=new Set,a=!1,l="",c=!1,u=!1;if(e.map((f,g)=>{if(g===0){let I=["Signature:","Init signature:"].find(w=>f.toLowerCase().startsWith(w.toLowerCase()));if(I){r=!0,f=f.substring(I.length).trim(),o.push("```python"),f.trim().length&&(o.push(f),c=!0);return}}if(f.startsWith("File:")&&g===e.length-1||f.startsWith("Type:")&&g===0)return;if(!a&&f.toLowerCase().startsWith("String form:".toLowerCase())){i=!0;return}let b=vhe.find(I=>f.trim().toLowerCase().startsWith(I.toLowerCase()));if(b&&!s.has(b)){l=b.toLowerCase(),s.add(b),a=!0,t=g,i=!1,r&&o.push("```","----------"),r=!1,u=!1,l!=="docstring:"&&o.push(`## ${b}`);let I=f.includes(":")?f.split(":")[1].replace("<no docstring>","").trim():"";I.length&&(o.push(I),c=!0);return}if(!i){if(t+1===g&&f.replace(/-/g,"").replace(/:/g,"").replace("<no docstring>","").trim().length===0){t=g,i=!1,r=!1,u=!1;return}if(l==="parameters"||l==="see also"){f.trim().length&&f.includes(":")&&f.substring(0,1)===f.trim().substring(0,1)?o.push(`* ${f}`):o.push(f),c=c||f.trim().length>0;return}if(l==="options:"){f.startsWith("-")&&f.trim().length&&f.includes(":")&&f.substring(0,1)===f.trim().substring(0,1)?o.push(`* ${f}`):o.push(f),c=c||f.trim().length>0;return}if(l==="returns"){f.trim().length&&f.substring(0,1)===f.trim().substring(0,1)?o.push(`* ${f}`):o.push(f),c=c||f.trim().length>0;return}if(l==="examples"&&!r&&(t+1===g||t+2===g))return i=!1,r=!0,c=c||f.trim().length>0,o.push("```python",f);if(!r&&f.startsWith("class ")&&f.trim().endsWith("):")){r=!0,u=!0,o.push("```python",f),c=c||f.trim().length>0;return}if(r&&u&&f.trim().length>0&&f.substring(0,1)!==" "&&f.substring(0,1)!=="	")return r=!1,u=!1,o.push(f,"```");c=c||f.trim().length>0,o.push(f)}}),!c)return"";let d=o.join(`  
`);return r?new rh.MarkdownString(d+"  \n```"):new rh.MarkdownString(d)}var bhe=[{section:"Examples:",header:"Examples",nextLine:/≡/g},{section:"Usage note",header:"Usage note",nextLine:/≡/g},{section:"Note:",header:"\u2502 Note",nextLine:"\u2502"},{section:"Note:",header:"\u2502 Note",nextLine:"\u2502"}];function Ihe(n){let e=Be(n,{trim:!1,removeEmptyEntries:!1}),t=!1,r=[],i=new Set,o="",s=!1,a=!1;e.every(c=>c.trim().length===0||c.startsWith("  "))&&e.forEach((c,u)=>e[u]=c.trim().length?c.substring(2):c),e.map((c,u)=>{if(c.trim()==="\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500")return a=!1,r.push(c);if(!a)return o="signature",t=!0,a=!0,c.trim().length?(s=!0,r.push("```julia",c)):r.push("```julia");o==="signature"&&c.trim()===""&&(o="",t=!1,s=!1,r.push("```"));let d=bhe.find(f=>c.trim().toLowerCase().startsWith(f.header.toLowerCase()));if(d&&(typeof d.nextLine=="string"?e[u+1].trim()===d.nextLine.trim():e[u+1].trim().replace(d.nextLine,"").length===0)){e[u+1]="",o=d.section.toLowerCase(),i.add(d.header),t&&r.push("```"),t=!1,r.push(`## ${d.section}`),o==="note:"&&!e.slice(u+1).every(f=>f.trim().length===0||f.trim().startsWith("|")||f.trim().startsWith("\u2502"))&&(o="");return}if(o==="examples:"&&!t)return t=!0,c.trim().length?(s=!0,r.push("```julia",c)):r.push("```julia");if(o==="note:"){r.push(c.trim()?c.trim().substring(1):"");return}t&&!s&&c.trim().length===0||r.push(c)});let l=r.join(`  
`);return t?new rh.MarkdownString(l+"  \n```"):new rh.MarkdownString(l)}function She(n){let e=Be(n,{trim:!1,removeEmptyEntries:!1}),t=[];e.forEach((a,l)=>e[l]=a.indexOf("     ")===0?a.substring(5):a);let r="",i=!1,o=!1;e.map(a=>{let l=a.replace(/_/g,"").trim();if(a.startsWith("_")&&a.includes("\b")&&a.split("_").length===a.split("\b").length&&l){i&&t.push("```"),i=!1,r=l.trim().toLowerCase(),t.push(`## ${l}`);return}if((r==="examples"||r==="examples:"||r==="usage"||r==="usage:")&&!i)return i=!0,a.trim().length?(o=!0,t.push("```r",a)):t.push("```r");if(r==="note:"){t.push(a.trim()?a.trim().substring(1):"");return}i&&!o&&a.trim().length===0||t.push(a)});let s=t.join(`  
`);return i?new rh.MarkdownString(s+"  \n```"):new rh.MarkdownString(s)}var FY=new WeakMap;async function Ju(n,e,t){let r=FY.get(n)||0;FY.set(n,r+1);let{api:i}=Ex(_e,n),o=`application/vnd.vscode.bg.execution.${r}`,s=`application/vnd.vscode.bg.execution.${r}.result`,a=`application/vnd.vscode.bg.execution.${r}.error`,l="",c=`
def __jupyter_exec_background__():
    from IPython.display import display
    from threading import Thread
    from traceback import format_exc

    # First send a dummy response to get the display id.
    # Later we'll send the real response with the actual data.
    # And that can happen much later even after the execution completes,
    # as that response will be sent from a bg thread.
    output = display({"${o}": ""}, raw=True, display_id=True)

    def do_implementation():
        ${e.map((f,g)=>g===0?f:`        ${f}`).join(`
`)}

    def bg_main():
        try:
            output.update({"${s}": do_implementation()}, raw=True)
        except Exception as e:
            output.update({"${a}": format_exc()}, raw=True)


    Thread(target=bg_main, daemon=True).start()


__jupyter_exec_background__()
del __jupyter_exec_background__
`.trim(),u=new or;u.add(t.onCancellationRequested(()=>u.dispose()));let d=Rt(t,new Promise((f,g)=>{u.add(i.onDidReceiveDisplayUpdate(async b=>{if(t.isCancellationRequested)return f(void 0);let I=Om(b);if(!l||I?.transient?.display_id!==l)return;let w=b.items.find(_=>_.mime===s);if(w)try{return f(JSON.parse(new TextDecoder().decode(w.data)))}catch(_){return g(new Error("Failed to parse the result",_))}}))})).finally(()=>{n.session&&RJ(n.session,l),u.dispose()});for await(let f of i.executeCode(c,t)){if(t.isCancellationRequested)return;let g=Om(f);if(!g?.transient?.display_id)continue;if(f.items.find(I=>I.mime===o)){l=g.transient.display_id;continue}if(l===g.transient.display_id){let I=f.items.find(w=>w.mime===s||w.mime===a);if(I?.mime===s)return JSON.parse(new TextDecoder().decode(I.data));if(I?.mime===a){p.warn(`Error in background execution:
`,new TextDecoder().decode(I.data));return}}}if(!t.isCancellationRequested){if(!l){p.warn("Failed to get display id for completions");return}return d}}var Che=1,zp=li.IntellisenseResolveTimeout,LY=5,uL=new WeakSet,D1=class extends Error{constructor(){super("Request timed out")}};async function BY(n,e,t,r,i,o,s,a){if(!n.range||!r.session?.kernel||uL.has(r)||!Xe(r.kernelConnectionMetadata)&&r.status!=="idle")return n;let l=Ahe(e||n,s,a),c=Rhe(l,r,t),u=Wg(t);try{let d=await Nh(zp,new D1,Rt(u.token,c));if(!t.isCancellationRequested&&d?.status==="ok"&&d?.found){let f=Ehe(d);n.documentation=OY(f,o)}}catch(d){if(d instanceof jY.CancellationError)return n;d instanceof D1&&(u.cancel(),whe(r,o,i))}finally{u.dispose()}return n}function Ehe(n){return!n||n.status!=="ok"||!n.found?";":!n.data||typeof n.data!="object"?"":"text/plain"in n.data?cc(n.data["text/plain"]):""}var UY=new WeakSet;function whe(n,e,t){Xe(n.kernelConnectionMetadata)||uL.has(n)||(uL.add(n),p.warn(`Failed to inspect code in kernel ${lt(n.kernelConnectionMetadata)}`),UY.has(n)||(UY.add(n),T("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION_CANNOT_RESOLVE",void 0,{kernelId:t,kernelConnectionType:n.kernelConnectionMetadata.kind,kernelLanguage:e})))}var dL=new WeakMap,pL=new WeakMap;async function Phe(n,e,t){let r=`return get_ipython().kernel.do_inspect("${YC(e.code)}", ${e.cursor_pos}, ${e.detail_level})`;return{content:await Ju(n,[r],t)}}var WY={data:{},found:!1,status:"ok",metadata:{}};function khe(n,e){if(!n.session?.kernel)return;let t=JSON.stringify(e);return dL.get(n.session.kernel)?.get(t)}function xhe(n,e,t){if(!n.session?.kernel||t.status!=="ok"||!t.found)return;let r=JSON.stringify(e),i=dL.get(n.session.kernel)||new Map;dL.set(n.session.kernel,i),i.size>100&&i.clear(),i.set(r,t)}function Dhe(n){if(!n.session?.kernel)return!1;let e=pL.get(n.session.kernel)||{maxTime:0,lastRequestTime:0,numberOfTimesMaxedOut:0};return!Xe(n.kernelConnectionMetadata)&&e.maxTime>zp?(p.warn(`Not sending inspect request as previous requests took over ${zp}s.`),!1):e.numberOfTimesMaxedOut>LY?(p.warn(`Not sending inspect request as there have been at least ${LY} requests that took over ${zp}s.`),!1):e.maxTime>zp&&Date.now()-e.lastRequestTime<3e4?(p.warn(`Not sending inspect request as previous requests took over ${zp}s.`),!1):!0}async function _he(n,e){if(!n.session?.kernel||!VY(n))return;p.info(`Too many pending requests ${$Y(n)} for kernel ${n.id}, waiting for it to be ready.`);let t=n.session.kernel,r=new or;await Rt(e,new Promise(i=>{let o=()=>{if(e.isCancellationRequested)return;if(!VY(n)){i(),G(r);return}let s=setTimeout(o,100);r.add({dispose:()=>clearTimeout(s)})};r.add(ba(e.onCancellationRequested)(()=>{i(),t.statusChanged.disconnect(o)})),t.statusChanged.connect(o),r.add({dispose:()=>{t.statusChanged.disconnect(o)}})})).finally(()=>G(r))}function The(n,e){if(!n.session?.kernel)return;let t=pL.get(n.session.kernel)||{maxTime:0,lastRequestTime:0,numberOfTimesMaxedOut:0};t.maxTime=Math.max(t.maxTime,e),t.lastRequestTime=Date.now(),e>zp&&(t.numberOfTimesMaxedOut+=1),pL.set(n.session.kernel,t)}async function Rhe(n,e,t){if(!e.session?.kernel)return;let r=khe(e,n);if(r)return r;if(!Dhe(e)||(await _he(e,t),t.isCancellationRequested))return WY;let i=Nhe(e),o=new Me,s=Be(n.code).reverse()[0].slice(-50);p.trace(`Inspecting code ${s}`);let a=Xe(e.kernelConnectionMetadata)?Phe(e,n,t):e.session.kernel.requestInspect(n);return a.finally(()=>i.dispose()),a.then(({content:l})=>{if(!e.session?.kernel)return;xhe(e,n,l),The(e,o.elapsedTime);let c=o.elapsedTime>zp?p.warn:p.debug;return t.isCancellationRequested?c(`Inspected code ${s} in ${o.elapsedTime}ms (but cancelled)`):c(`Inspected code ${s} in ${o.elapsedTime}ms`),l})}function Ahe(n,e,t){let r=e.getText(),i=(typeof n.insertText=="string"?n.insertText:n.insertText?.value)||(typeof n.label=="string"?n.label:n.label.label)||"",o=r.substring(0,t.character)+i,s=t.character+i.length;return{code:o,cursor_pos:s,detail_level:0}}var Bw=new WeakMap;function VY(n){return n.session?.kernel?$Y(n)>=Che:!1}function $Y(n){return n.session?.kernel?(Bw.has(n.session?.kernel)||Bw.set(n.session?.kernel,{count:0}),Bw.get(n.session?.kernel)?.count||0):0}function Nhe(n){if(!n.session?.kernel)return{dispose:h};let e=Bw.get(n.session?.kernel)||{count:0};return Bw.set(n.session?.kernel,e),e.count+=1,{dispose:()=>{e.count-=1}}}var T1=class extends Error{constructor(){super("Request timed out")}},mL=class{constructor(e,t,r){this.kernelId=e;this.kernel=t;this.monacoLanguage=r;this.pendingCompletionRequest=new WeakMap;this.previousCompletionItems=new WeakMap}async provideCompletionItems(e,t,r,i){if(!this.kernel.session?.kernel)return[];let o=e.version;if(this.pendingCompletionRequest.has(e))return[];this.pendingCompletionRequest.set(e,{position:t,version:o});let s=new Sr.Disposable(()=>{this.pendingCompletionRequest.get(e)?.position.isEqual(t)&&this.pendingCompletionRequest.get(e)?.version===o&&this.pendingCompletionRequest.delete(e)});try{let a=so(Rt(r,Promise.resolve(Sr.commands.executeCommand("vscode.executeCompletionItemProvider",e.uri,t)).then(f=>f?.items||[]))),l=new Me;if(await Hn(50),r.isCancellationRequested)return[];let c=await Nh(li.IntellisenseTimeout,new T1,this.provideCompletionItemsFromKernel(e,t,r,i));if(r.isCancellationRequested||!c||!c.length)return[];let u=await Bt(0,a.promise);Xe(this.kernel.kernelConnectionMetadata)&&!a.completed&&l.elapsedTime<li.IntellisenseTimeout+50&&(u=await Bt(li.IntellisenseTimeout-l.elapsedTime,a.promise));let d=new Set((u||[]).map(f=>{let g=typeof f.label=="string"?f.label:f.label.label,b=f.insertText,I=[g,`.${g}`];return typeof b=="string"&&I.push(b),I}).flat());return c.filter(f=>{let g=typeof f.label=="string"?f.label:f.label.label;return!d.has(g)&&!d.has(`* ${g}`)})}catch(a){if(a instanceof T1)return[];throw a instanceof Sr.CancellationError||p.debug("Completions failed",a),a}finally{s.dispose()}}async provideCompletionItemsFromKernel(e,t,r,i){if(r.isCancellationRequested||!this.kernel.session?.kernel)return[];let o=new Me,s={duration:0,timesExceededTimeout:0,requestDuration:0,completionItems:0},a={kernelId:this.kernelId,kernelConnectionType:this.kernel.kernelConnectionMetadata.kind,kernelLanguage:N1(this.kernel),monacoLanguage:this.monacoLanguage,cancelled:!1,kernelStatusBeforeRequest:this.kernel.status,completed:!1,requestSent:!1};if(!Xe(this.kernel.kernelConnectionMetadata)&&this.kernel.status!=="idle")return[];let l=e.getText(),c=e.offsetAt(t);a.requestSent=!0;let u=await Rt(r,this.getKernelCompletion(l,c,r));if(p.debug(`Jupyter completion time: ${o.elapsedTime}`),a.cancelled=r.isCancellationRequested,a.completed=!r.isCancellationRequested,a.kernelStatusAfterRequest=this.kernel.status,s.requestDuration=r.isCancellationRequested?0:o.elapsedTime,r.isCancellationRequested)return[];if(u?.content?.status!=="ok"||(u?.content?.matches?.length??0)===0)return qY(this.kernel,s,a),[];let d={matches:u.content.matches,cursor:{start:u.content.cursor_start,end:u.content.cursor_end},metadata:u.content.metadata},f=d.metadata?d.metadata._jupyter_types_experimental:[];s.completionItems=d.matches.length,qY(this.kernel,s,a);let g={code:l,cursor:d.cursor,documentRef:new WeakRef(e),position:e.positionAt(d.cursor.start)},b=new Sr.Range(e.positionAt(d.cursor.start),e.positionAt(d.cursor.end)),I=[];return Array.isArray(f)&&f.length>=d.matches.length&&f.every(w=>w&&typeof w.text=="string")?I=u.content.matches.map((w,_)=>{let A=f[_],R=A.type?KY.get(A.type):Sr.CompletionItemKind.Field,V=new Sr.CompletionItem(w,R);return typeof A.start=="number"&&typeof A.end=="number"?V.range=new Sr.Range(e.positionAt(A.start),e.positionAt(A.end)):V.range=b,V.insertText=A.text,V.sortText=x1(_),Xe(this.kernel.kernelConnectionMetadata)&&(w.startsWith("%")||w.startsWith("!"))&&(V.sortText=`ZZZ${V.sortText}`),this.previousCompletionItems.set(V,{...g,originalCompletionItem:JSON.parse(JSON.stringify(V))}),V}):I=d.matches.map((w,_)=>{let A=new Sr.CompletionItem(w);return A.range=b,A.sortText=x1(_),Xe(this.kernel.kernelConnectionMetadata)&&(w.startsWith("%")||w.startsWith("!"))&&(A.sortText=`ZZZ${A.sortText}`),this.previousCompletionItems.set(A,{...g,originalCompletionItem:A}),A}),Xe(this.kernel.kernelConnectionMetadata)?Fhe(i.triggerCharacter,this.allowStringFilterForPython,I,e,t):I}async resolveCompletionItem(e,t){if(!e.range||!this.kernel.session?.kernel)return e;let r=this.previousCompletionItems.get(e);if(!r)return e;let{documentRef:i,position:o,originalCompletionItem:s}=r,a=i.deref();return a?BY(e,s,t,this.kernel,this.kernelId,this.monacoLanguage,a,o):e}async getKernelCompletion(e,t,r){if(this.kernel.session?.kernel)return Xe(this.kernel.kernelConnectionMetadata)?this.getPythonKernelCompletion(e,t,r):Rt(r,this.kernel.session.kernel.requestComplete({code:e,cursor_pos:t}))}async getPythonKernelCompletion(e,t,r){let i=`return get_ipython().kernel.do_complete("${YC(e)}", ${t})`;return{content:await Ju(this.kernel,[i],r)}}},JY=new WeakMap,_1=new WeakMap;function qY(n,e,t){let r=JY.get(n),i=_1.get(n)?.count||0;e.duration>=li.IntellisenseTimeout&&_1.set(n,{count:i+1,measures:e,properties:t}),e.timesExceededTimeout=i,r?r.elapsedTime>6e4&&(T("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION",e,t),r.reset(),_1.delete(n)):(T("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION",e,t),r=new Me,JY.set(n,new Me),_1.delete(n))}var fL=class extends Qt{constructor(t,r){super();this.kernel=t;this.notebookEditorProvider=r;this.cellCompletionProviders=new WeakMap;this.completionItemsSent=new WeakMap;this.monacoLanguage=A1(this.kernel);this.registerCompletionProvider(),this._register(Sr.workspace.onDidChangeConfiguration(i=>{if(i.affectsConfiguration("jupyter.enableKernelCompletions"))if(HY(this.kernel.notebook.uri))this.completionProvider||this.registerCompletionProvider();else{this.completionProvider?.dispose(),this.completionProvider=void 0;return}!i.affectsConfiguration("jupyter.completionTriggerCharacters")&&!i.affectsConfiguration("jupyter.pythonCompletionTriggerCharacters")||this.registerCompletionProvider()}))}registerCompletionProvider(){if(!HY(this.kernel.notebook.uri))return;let t=Mhe(this.kernel);if(t.length===0){Khe(this.kernel);return}p.trace(`Registering Kernel Completion Provider from kernel ${lt(this.kernel.kernelConnectionMetadata)} for language ${this.monacoLanguage}`),this.allowStringFilterForPython=t.includes("'")||t.includes('"'),this.completionProvider?.dispose(),this.completionProvider=void 0,this.completionProvider=Sr.languages.registerCompletionItemProvider(this.monacoLanguage,this,...t)}dispose(){super.dispose(),this.completionProvider?.dispose()}async provideCompletionItems(t,r,i,o){if(this.notebookEditorProvider.findAssociatedNotebookDocument(t.uri)!==this.kernel.notebook)return[];let s=this.cellCompletionProviders.get(t);if(!s){let a=await ot(this.kernel.kernelConnectionMetadata.id);s=new mL(a,this.kernel,this.monacoLanguage),this.cellCompletionProviders.set(t,s)}return s.allowStringFilterForPython=this.allowStringFilterForPython,s.provideCompletionItems(t,r,i,o).then(a=>(a.forEach(l=>this.completionItemsSent.set(l,s)),a))}async resolveCompletionItem(t,r){let i=this.completionItemsSent.get(t);return i?i.resolveCompletionItem(t,r):t}},Qp=class extends Qt{constructor(t){super();this.kernelCompletionProviders=new WeakMap;t.push(this)}activate(){let t=Se.instance.get(ye);this._register(t.onDidStartKernel(async r=>{if(r.session?.kernel&&Xe(r.kernelConnectionMetadata)&&r.session.kernel.requestComplete({code:"__file__.",cursor_pos:9}),!A1(r)||this.kernelCompletionProviders.has(r))return;let o=Se.instance.get(Fn),s=this._register(new fL(r,o));this.kernelCompletionProviders.set(r,s)})),this._register(t.onDidDisposeKernel(r=>{this.kernelCompletionProviders.get(r)?.dispose()}))}};Qp=v([(0,R1.injectable)(),m(0,(0,R1.inject)(K))],Qp);function A1(n){return Tl(N1(n))}function N1(n){let e="";switch(n.kernelConnectionMetadata.kind){case"connectToLiveRemoteKernel":e=n.kernelConnectionMetadata.kernelModel.language;break;case"startUsingRemoteKernelSpec":e=n.kernelConnectionMetadata.kernelSpec.language;break;case"startUsingLocalKernelSpec":e=n.kernelConnectionMetadata.kernelSpec.language;break;default:e=n.kernelConnectionMetadata.kernelSpec.language;break}return(e||"").toLowerCase()}function HY(n){return Sr.workspace.getConfiguration("jupyter",n).get("enableKernelCompletions",!1)}function Mhe(n){let e=Sr.workspace.getConfiguration("jupyter",n.notebook.uri).get("completionTriggerCharacters");if(!e||typeof e!="object")return[];let t=N1(n),r=A1(n);return t in e?Array.isArray(e[t])?e[t]:[]:r in e?Array.isArray(e[r])?e[r]:[]:[]}function Khe(n){let e=N1(n),t=A1(n);e.toLowerCase()===t.toLowerCase()?p.warn(Sr.l10n.t(`Kernel completions not enabled for '{0}'. 
To enable Kernel completion for this language please add the following setting 
jupyter.completionTriggerCharacters = {1}: [<List of characters that will trigger completions>]}. 
For more information please see https://aka.ms/vscodeJupyterCompletion`,lt(n.kernelConnectionMetadata),`{${e}`)):p.warn(Sr.l10n.t(`Kernel completions not enabled for '{0}'. 
To enable Kernel completion for this language please add the following setting 
jupyter.completionTriggerCharacters = {1}: [<List of characters that will trigger completions>]}. 
 or the following: 
jupyter.completionTriggerCharacters = {2}: [<List of characters that will trigger completions>]}. 
For more information please see https://aka.ms/vscodeJupyterCompletion`,lt(n.kernelConnectionMetadata),`{${e}`,`{${t}`))}function Ohe(n,e){let t=n.indexOf('"'),r=n.indexOf("'"),i=n.lastIndexOf('"'),o=n.lastIndexOf("'"),s=t>=0?t:r,a=i>=0?i:o;return s>=0&&e.character>s&&e.character<=a}function Fhe(n,e,t,r,i){let o=i.character===0?void 0:new Sr.Range(i.line,i.character-1,i.line,i.character),a=(o?r.getText(o):void 0)===".",l=r.getWordRangeAtPosition(a||n==="."?new Sr.Position(i.line,i.character-1):i),c=l&&o?l.union(o):void 0,u=r.lineAt(i.line).text,d=c?r.getText(c):u,f=d.endsWith(".")||a,g=e&&(n=="'"||n=='"'||Ohe(u,i));p.ci(`Jupyter completions filtering applied: ${g} on ${u}`);let b=t.map((I,w)=>{let _=typeof I.label=="string"?I.label:I.label.label,A=typeof I.label=="string"?I.label:I.label.label;if(A.startsWith("%")||A.startsWith("!"))return{...I,sortText:`ZZZ${I.sortText}`};if(g)return I;let R=d?A.indexOf(d):-1,V,ie,Q;if(d&&f&&A.includes(d)){V=A.substring(A.indexOf(d)+(f?d.length:0)),ie=A.substring(A.indexOf(d)+d.length);let te=(typeof I.label=="string"?I.label.length:I.label.label.length)-ie.length;Q=I.range&&"start"in I.range?new Sr.Range(new Sr.Position(I.range.start.line,I.range.start.character+te),I.range.end):I.range}if(!ie&&R>0){V=A.substring(A.indexOf(d)+(f?d.length:0)),ie=A.substring(A.indexOf(d)+d.length);let te=(typeof I.label=="string"?I.label.length:I.label.label.length)-ie.length;Q=I.range&&"start"in I.range?new Sr.Range(new Sr.Position(I.range.start.line,I.range.start.character+te),I.range.end):I.range}return V&&ie&&Q&&(I.label=V,_=ie,I.insertText=ie,I.filterText=f?`.${ie}`:ie,I.range=Q,I.sortText=x1(w)),_.endsWith("/")?{...I,command:{command:"editor.action.triggerSuggest",title:""}}:(_.includes(" ")&&(_=_.replace(/\\ /g," "),typeof I.label=="string"?I.label=I.label.replace(/\\ /g," "):I.label.label=I.label.label.replace(/\\ /g," ")),g||!_.includes(".")&&!_.endsWith("/")||_.startsWith(".")&&!_.endsWith("/")?I:void 0)}).filter(I=>I!==void 0);return p.ci(`Jupyter completions for ${d} at pos ${i.line}:${i.character} with trigger: ${n}
   ${t.map(I=>I.label).join(",")}`),p.ci(`Jupyter results for ${d} at pos ${i.line}:${i.character} with trigger: ${n}
   ${b.map(I=>I.label).join(",")}`),b}var Yp=k(N()),hL=require("vscode");var zY=k(Qo());var GY=require("vscode");function M1(){let e=GY.workspace.getConfiguration("python")?.get("languageServer");return!(e!=="Pylance"&&e!=="Default")}var Xp=class{constructor(e,t,r,i,o){this.apiProvider=e;this.extensionChecker=t;this.notebookEditorProvider=r;this.controllerRegistration=i;this.kernelProvider=o;this._isPylanceExtensionInstalled()||(this.extensionChangeHandler=hL.extensions.onDidChange(this.extensionsChangeHandler.bind(this)))}activate(){!this.isUsingPylance()||!this.extensionChecker.isPythonExtensionInstalled||this.apiProvider.getApi().then(e=>{e.registerJupyterPythonPathFunction!==void 0&&e.registerJupyterPythonPathFunction(t=>this._jupyterPythonPathFunction(t))}).catch(h)}async reset(){this._isEnabled=void 0,await this.activate()}_isPylanceExtensionInstalled(){return hL.extensions.getExtension(pm)!==void 0}async extensionsChangeHandler(){this._isPylanceExtensionInstalled()&&this.extensionChangeHandler&&(this.extensionChangeHandler.dispose(),this.extensionChangeHandler=void 0,await this.reset())}isUsingPylance(){return this._isEnabled===void 0&&(this._isEnabled=M1()),this._isEnabled}async _jupyterPythonPathFunction(e){let t=this.notebookEditorProvider.findAssociatedNotebookDocument(e);if(!t)return;let r=this.controllerRegistration.getSelected(t);if(r&&Dt(r.connection)){let o=this.kernelProvider.get(t);if(!o)return;let s=[];if(!o.startedAtLeastOnce){let b=new Promise(I=>o.onStarted(I,void 0,s));await Bt(5e3,void 0,b)}if(!o.startedAtLeastOnce)return;let a=this.kernelProvider.getKernelExecution(o),l=`
import os as _VSCODE_os
import sys as _VSCODE_sys
import builtins as _VSCODE_builtins

if _VSCODE_os.path.exists(${Qy(__filename)}):
    _VSCODE_builtins.print(f"EXECUTABLE{_VSCODE_sys.executable}EXECUTABLE")

del _VSCODE_os, _VSCODE_sys, _VSCODE_builtins
`,u=(await a.executeHidden(l).catch(h)||[]).find(b=>b.output_type==="stream"&&b.name==="stdout");if(!u||!(u.text||"").toString().includes("EXECUTABLE"))return;let d=(u.text||"").toString();d=d.substring(d.indexOf("EXECUTABLE"));let f=d.split("EXECUTABLE").filter(b=>b.trim().length),g=f.length?f[0].trim():"";return!g||!await zY.pathExists(g)?void 0:(p.debug(`Remote Interpreter for Pylance for Notebook URI "${M(t.uri)}" is ${M(g)}`),g)}let i=r?.connection?.interpreter;return i?(p.debug(`Interpreter for Pylance for Notebook URI "${M(t.uri)}" is ${M(i.uri)}`),Ae(i.uri)):(p.debug(`No interpreter for Pylance for Notebook URI "${M(t.uri)}"`),"")}};Xp=v([(0,Yp.injectable)(),m(0,(0,Yp.inject)(tr)),m(1,(0,Yp.inject)(qe)),m(2,(0,Yp.inject)(Fn)),m(3,(0,Yp.inject)(He)),m(4,(0,Yp.inject)(ye))],Xp);function QY(n){n.addSingleton(me,XI),n.addSingleton(Qp,Qp),n.addBinding(Qp,me),n.addSingleton(Xp,Xp),n.addBinding(Xp,me)}var eS=k(N());var YY=require("vscode");var ZI=class{constructor(e,t,r){this.extensionChecker=e;this.disposables=t;this.kernelProvider=r}activate(){this.extensionChecker.onPythonExtensionInstallationStatusChanged(this.onPythonExtensionInstallationStatusChanged,this,this.disposables)}async onPythonExtensionInstallationStatusChanged(e){e==="installed"&&this.anyKernelsAreActive()&&YY.window.showInformationMessage(y.pythonExtensionInstalled,ce.ok).then(h,h)}anyKernelsAreActive(){return this.kernelProvider.kernels.length>0}};ZI=v([(0,eS.injectable)(),m(0,(0,eS.inject)(qe)),m(1,(0,eS.inject)(K)),m(2,(0,eS.inject)(ye))],ZI);var en=k(N()),Pt=require("vscode");var xc=require("vscode");var K1=class{constructor(e,t,r,i,o){this.configService=e;this.agentCreator=t;this.requestCreator=r;this.serverUriStorage=i;this.disposables=o;this.savedConnectInfo=new Map;this.serverUriStorage.onDidRemove(this.onDidRemoveServers,this,this.disposables)}getPasswordConnectionInfo(e){if(!e.url||e.url.length<1)throw new Error("Invalid URL");let t=tS(e.url),r=e.disposables||[],i=!Array.isArray(e.disposables),o=this.savedConnectInfo.get(e.handle);return o||(o=this.getJupyterConnectionInfo({url:t,isTokenEmpty:e.isTokenEmpty,disposables:r,validationErrorMessage:e.validationErrorMessage}).then(s=>((!s||s.requiresPassword&&Object.keys(s).length===1)&&(p.warn(`Password for ${t} was invalid.`),this.savedConnectInfo.delete(e.handle)),s)),o.catch(()=>this.savedConnectInfo.delete(e.handle)),o.finally(()=>{i&&G(r)}).catch(h),this.savedConnectInfo.set(e.handle,o)),o}async getJupyterConnectionInfo(e){let t,r,i,o,s=await this.needPassword(e.url);if(s||e.isTokenEmpty){if(s&&e.isTokenEmpty){let a=xc.window.createInputBox();e.disposables.push(a),a.title=y.jupyterSelectPasswordTitle,a.placeholder=y.jupyterSelectPasswordPrompt,a.ignoreFocusOut=!0,a.password=!0,a.validationMessage=e.validationErrorMessage||"",a.show(),a.buttons=[xc.QuickInputButtons.Back],o=await new Promise((l,c)=>{a.onDidTriggerButton(u=>{u===xc.QuickInputButtons.Back&&c(De.back)},this,e.disposables),a.onDidChangeValue(()=>a.validationMessage="",this,e.disposables),a.onDidAccept(()=>l(a.value),this,e.disposables),a.onDidHide(()=>c(De.cancel),this,e.disposables)})}if(typeof o===void 0&&!o&&e.isTokenEmpty)throw new xc.CancellationError;if(o||e.isTokenEmpty)if(t=await this.getXSRFToken(e.url,""),t){let a=await this.getSessionCookie(e.url,t,o||"");r=a.sessionCookieName,i=a.sessionCookieValue}else r="authservice_session",i=o,t=await this.getXSRFToken(e.url,`${r}=${i}`);else return{requiresPassword:s}}else return{requiresPassword:s};return t&&r&&(i||e.isTokenEmpty)?(T("DS_INTERNAL.GET_PASSWORD_SUCCESS"),{requestHeaders:{Cookie:`_xsrf=${t}; ${r}=${i||""}`,"X-XSRFToken":t},requiresPassword:s}):(T("DS_INTERNAL.GET_PASSWORD_FAILURE"),{requiresPassword:s})}addAllowUnauthorized(e,t,r){if(e.startsWith("https")&&t&&this.agentCreator){let i=this.agentCreator.createHttpRequestAgent();return{...r,agent:i}}return r}async getXSRFToken(e,t){let r,i,o=new URL("login?",tS(e)).toString();t!=""?(o=new URL("tree",tS(e)).toString(),i={Connection:"keep-alive",Cookie:t}):i={Connection:"keep-alive"};let s=await this.makeRequest(o,{method:"get",redirect:"manual",headers:i});if(s!==void 0&&s.ok){let a=this.getCookies(s);a.has("_xsrf")&&(r=a.get("_xsrf")?.split(";")[0])}return r}async needPassword(e){let t=await this.makeRequest(tS(e),{method:"get",redirect:"follow",headers:{Connection:"keep-alive"}});if(t.status===200&&t.redirected){if(t.url.toLowerCase().includes("/login?"))return!0;if(t.url.toLowerCase().includes("/lab?"))return!1}let r=new URL("tree?",tS(e)).toString();return t=await this.makeRequest(r,{method:"get",redirect:"manual",headers:{Connection:"keep-alive"}}),t.status===404?(p.error(`Jupyter Server not found at ${e}, got 404 for ${r}`),!1):t.status!==200}async makeRequest(e,t){let r=this.configService.getSettings(void 0).allowUnauthorizedRemoteConnection;try{return await this.requestCreator.getFetchMethod()(e,this.addAllowUnauthorized(e,!!r,t))}catch(i){if(pi.isSelfCertsError(i)){let o=y.jupyterSelfCertEnable,s=y.jupyterSelfCertClose,a=await xc.window.showErrorMessage(y.jupyterSelfCertFail(i.message),{modal:!0},o,s);if(a===o)return T("DATASCIENCE.SELFCERTSMESSAGEENABLED"),await this.configService.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,xc.ConfigurationTarget.Workspace),this.requestCreator.getFetchMethod()(e,this.addAllowUnauthorized(e,!0,t));a===s&&T("DATASCIENCE.SELFCERTSMESSAGECLOSE")}throw i}}async getSessionCookie(e,t,r){let i,o,s=new URLSearchParams;s.append("_xsrf",t),s.append("password",r);let a=await this.makeRequest(new URL("login?",tS(e)).toString(),{method:"post",headers:{Cookie:`_xsrf=${t}`,Connection:"keep-alive","content-type":"application/x-www-form-urlencoded;charset=UTF-8"},body:s.toString(),redirect:"manual"});if(a.status===302){let l=this.getCookies(a);if(l.size>0){let c=l.entries().next().value;c&&(i=c[0],o=c[1])}}return{sessionCookieName:i,sessionCookieValue:o}}getCookies(e){let t=new Map,i=(e.headers.raw?e.headers.raw():e.headers)["set-cookie"];return i&&i.forEach(o=>{let s=o.substring(0,o.indexOf("=")),a=o.substring(o.indexOf("=")+1);t.set(s,a)}),t}onDidRemoveServers(e){e.forEach(t=>{t.id.startsWith("_builtin")&&this.savedConnectInfo.delete(t.handle)})}};function tS(n){let e=n;return e[e.length-1]!=="/"&&(e=`${e}/`),e}var F1=require("vscode");var O1=class{constructor(e,t,r){this.configService=e;this.agentCreator=t;this.requestCreator=r}async isJupyterHub(e){try{if(e.toLowerCase().includes("/user/")&&e.includes("token="))return!1;if(e.toLowerCase().includes("/user/")&&!e.includes("token="))return!0;let t=await this.makeRequest(new URL("hub/api",Lhe(e)).toString(),{method:"get"});if(t.status!==200)return!1;try{let r=await t.json();return p.trace(`JupyterHub version is ${r&&r.version} for url ${e}`),r&&r.version}catch{}return!1}catch(t){return p.debug(`Error in detecting whether url is isJupyterHub: ${t}`),!1}}addAllowUnauthorized(e,t,r){if(e.startsWith("https")&&t&&this.agentCreator){let i=this.agentCreator.createHttpRequestAgent();return{...r,agent:i}}return r}async makeRequest(e,t){let r=this.configService.getSettings(void 0).allowUnauthorizedRemoteConnection;try{return await this.requestCreator.getFetchMethod()(e,this.addAllowUnauthorized(e,!!r,t))}catch(i){if(pi.isSelfCertsError(i)){let o=y.jupyterSelfCertEnable,s=y.jupyterSelfCertClose,a=await F1.window.showErrorMessage(y.jupyterSelfCertFail(i.message),{modal:!0},o,s);if(a===o)return T("DATASCIENCE.SELFCERTSMESSAGEENABLED"),await this.configService.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,F1.ConfigurationTarget.Workspace),this.requestCreator.getFetchMethod()(e,this.addAllowUnauthorized(e,!0,t));a===s&&T("DATASCIENCE.SELFCERTSMESSAGECLOSE")}throw i}}};function Lhe(n){let e=n;return e[e.length-1]!=="/"&&(e=`${e}/`),e}var L1="user-jupyter-server-uri-list-version2";var Uhe="DataScienceAllowInsecureConnections",rS=class extends Qt{constructor(t,r,i,o,s,a,l,c,u,d,f,g=oC){super();this.jupyterConnection=r;this.context=u;this.fs=d;this.jupyterServerProviderRegistry=f;this.id=g;this.extensionId=_e;this.documentation=Pt.Uri.parse("https://aka.ms/vscodeJuptyerExtKernelPickerExistingServer");this.displayName=y.UserJupyterServerUrlProviderDisplayName;this.detail=y.UserJupyterServerUrlProviderDetail;this._onDidChangeHandles=this._register(new Pt.EventEmitter);this.onDidChangeHandles=this._onDidChangeHandles.event;this._onDidChangeServers=this._register(new Pt.EventEmitter);this.onDidChangeServers=this._onDidChangeServers.event;a.push(this),this.newStorage=new qw(i),this.secureConnectionValidator=new Jw(s),this.jupyterServerUriInput=new $w(c),this.jupyterServerUriDisplayName=new gL,this.jupyterPasswordConnect=new K1(t,l,c,o,a),this.jupyterHubPasswordConnect=new O1(t,l,c)}activate(){let t=this._register(this.jupyterServerProviderRegistry.createJupyterServerCollection(_e,this.id,this.displayName,this));t.commandProvider=this,t.documentation=this.documentation,this._register(this.onDidChangeHandles(()=>this._onDidChangeServers.fire(),this)),this._register(Pt.commands.registerCommand("dataScience.ClearUserProviderJupyterServerCache",async()=>{await Promise.all([this.newStorage.clear().catch(h),this.fs.delete(Pt.Uri.joinPath(this.context.globalStorageUri,Wy)).catch(h)]),this._onDidChangeHandles.fire()})),this.initializeServers().catch(h)}async resolveJupyterServer(t,r){let i=await this.getServerUri(t.id);return{...t,connectionInformation:{id:t.id,label:t.label,baseUrl:Pt.Uri.parse(i.baseUrl),token:i.token,headers:i.authorizationHeader,mappedRemoteNotebookDir:i.mappedRemoteNotebookDir?Pt.Uri.file(i.mappedRemoteNotebookDir):void 0}}}async handleCommand(t,r){let i=new Pt.CancellationTokenSource;this._register(new Pt.Disposable(()=>{i.cancel(),i.dispose()}));try{let o="url"in t?t.url:void 0,s=await this.captureRemoteJupyterUrl(i.token,o);if(!s||s===De.cancel)throw new Pt.CancellationError;if(s&&s instanceof De)return;let l=(await this.provideJupyterServers(i.token)).find(c=>c.id===s);if(!l)throw new Error(`Server ${s} not found`);return l}catch(o){if(o instanceof Pt.CancellationError)throw o;p.error("Failed to select a Jupyter Server",o);return}finally{i.cancel(),i.dispose()}}async provideCommands(t,r){let i="";try{t=(t||"").trim(),["http:","https:"].includes(new URL(t.trim()).protocol.toLowerCase())&&(i=t)}catch{}return i?[{label:y.connectToToTheJupyterServer(i),url:i}]:[{label:y.jupyterSelectUriCommandLabel,canBeAutoSelected:!0}]}async provideJupyterServers(t){return await this.initializeServers(),(await this.newStorage.getServers(!1)).map(i=>({id:i.handle,label:i.serverInfo.displayName}))}async removeJupyterServer(t){await this.initializeServers(),await this.newStorage.remove(t.id),this._onDidChangeHandles.fire()}initializeServers(){if(this._cachedServerInfoInitialized)return this._cachedServerInfoInitialized;let t=ne();return this._cachedServerInfoInitialized=t.promise,(async()=>{this.newStorage.getServers(!1).catch(h),t.resolve()})().then(()=>t.resolve(),r=>t.reject(r)).catch(h),this._cachedServerInfoInitialized}recommendInstallingJupyterHubExtension(){throw Pt.extensions.getExtension(Dh)?Pt.window.showInformationMessage(y.useJupyterHubExtension,{modal:!0,detail:y.useJupyterHubExtensionDetail}).then(()=>{Pt.commands.executeCommand("notebook.selectKernel",{notebookEditor:Pt.window.activeNotebookEditor}).then(h,h)},h):Pt.window.showInformationMessage(y.installJupyterHub,{modal:!0,detail:y.installJupyterHubDetail},ce.install,ce.moreInfo).then(t=>{t===ce.install?Pt.commands.executeCommand("workbench.extensions.installExtension",Dh,{context:{skipWalkthrough:!0}}).then(h,h):t===ce.moreInfo&&Pt.env.openExternal(Pt.Uri.parse("https://marketplace.visualstudio.com/items?itemName=ms-toolsai.jupyter-hub")).then(h,h)},h),new Pt.CancellationError}async captureRemoteJupyterUrl(t,r=""){await this.initializeServers();let i=[],o={baseUrl:"",displayName:"",token:""},s="",a=!1,l=!1,c,u="Get Url",d="Get Url",f=r,g=!1;if(r){let b=await this.jupyterServerUriInput.parseUserUriAndGetValidationError(r);typeof b.validationError=="string"?(s=b.validationError,u="Get Url"):(g=!0,o=b.jupyterServerUri,u="Check Passwords")}try{let b=!1;for(;;)try{if(c=lr(),u==="Get Url"){g=!1,u="Check Passwords",d=void 0;let w=s;s="";let _=await this.jupyterServerUriInput.getUrlFromUser(f||r,w,i);o=_.jupyterServerUri,f=_.url}if(t.isCancellationRequested)return De.cancel;let I=[];if(u==="Check Passwords"){u="Check Insecure Connections",d=g&&r?void 0:"Get Url";try{let w=s;if(s="",!o.token&&await this.jupyterHubPasswordConnect.isJupyterHub(o.baseUrl))return this.recommendInstallingJupyterHubExtension(),De.cancel;let _=await this.jupyterPasswordConnect.getPasswordConnectionInfo({url:o.baseUrl,isTokenEmpty:o.token.length===0,handle:c,validationErrorMessage:w,disposables:I});a=_.requiresPassword,o.authorizationHeader=_.requestHeaders,b=!1}catch(w){if(b=!1,w instanceof Pt.CancellationError||w==De.back||w==De.cancel)throw w;if(!pi.isSelfCertsError(w)){if(!Nl.isSelfCertsExpiredError(w)){nh(c,o.baseUrl,!1,"ConnectionFailure");let _=/(https?:\/\/[^\s]+)/g,A=(w.message||w.toString()).replace(_,R=>`[${R}](${R})`);if(s=(Lr()?y.remoteJupyterConnectionFailedWithoutServerWithErrorWeb:y.remoteJupyterConnectionFailedWithoutServerWithError)(A),o.token.length>0&&(w.message||"").toLowerCase()==="Failed to fetch".toLowerCase())b=!0;else{u="Get Url";continue}}}}finally{I.forEach(w=>this._register(w))}}if(t.isCancellationRequested)return De.cancel;if(u==="Check Insecure Connections"&&(u="Verify Connection",d=a&&o.token.length===0?"Check Passwords":"Get Url",d==="Get Url"&&(d=g&&r?void 0:"Get Url"),!a&&o.token.length===0&&new URL(o.baseUrl).protocol.toLowerCase()==="http:"&&(l=!0,G(I),!await this.secureConnectionValidator.promptToUseInsecureConnections())))return nh(c,o.baseUrl,!1,"InsecureHTTP"),De.cancel;if(t.isCancellationRequested)return De.cancel;if(u==="Verify Connection")try{u="Get Display Name",await this.jupyterConnection.validateRemoteUri({id:this.id,handle:c,extensionId:_e},o,!0)}catch(w){if(p.warn("Uri verification error",w),b&&s){u="Get Url";continue}if(w instanceof Pt.CancellationError||w==De.back||w==De.cancel)throw w;if(pi.isSelfCertsError(w)){s=y.jupyterSelfCertFailErrorMessageOnly,u="Get Url",nh(c,o.baseUrl,!1,"SelfCert");continue}else if(Nl.isSelfCertsExpiredError(w)){s=y.jupyterSelfCertExpiredErrorMessageOnly,u="Get Url",nh(c,o.baseUrl,!1,"ExpiredCert");continue}else if(a&&o.token.length===0){s=y.passwordFailure,u="Check Passwords",nh(c,o.baseUrl,!1,"AuthFailure");continue}else{nh(c,o.baseUrl,!1,"ConnectionFailure");let _=/(https?:\/\/[^\s]+)/g,A=(w.message||w.toString()).replace(_,R=>`[${R}](${R})`);s=(Lr()?y.remoteJupyterConnectionFailedWithoutServerWithErrorWeb:y.remoteJupyterConnectionFailedWithoutServerWithError)(A),u="Get Url";continue}}finally{G(I)}if(t.isCancellationRequested)return De.cancel;if(u==="Get Display Name"){G(I),d=l?"Check Insecure Connections":a&&o.token.length===0?"Check Passwords":"Get Url",d==="Get Url"&&(d=g&&r?void 0:"Get Url"),o.displayName=await this.jupyterServerUriDisplayName.getDisplayName(c,o.displayName||new URL(o.baseUrl).hostname);break}}catch(I){if(I instanceof Pt.CancellationError||I===De.cancel)return De.cancel;if(I===De.back){if(!d)return De.back;u=d;continue}throw I}return t.isCancellationRequested?De.cancel:(await this.addNewServer({handle:c,uri:f,serverInfo:o}),C_({extensionId:this.extensionId,id:this.id,handle:c},o.displayName),nh(c,o.baseUrl,!1),c)}catch(b){if(b instanceof Pt.CancellationError)return De.cancel;throw b}finally{G(i)}}async addNewServer(t){await this.newStorage.add(t),this._onDidChangeHandles.fire()}async getServerUri(t){let i=(await this.newStorage.getServers(!1)).find(l=>l.handle===t);if(!i)throw new Error("Server not found");let o=i.serverInfo,s=this.jupyterServerUriDisplayName.displayNamesOfHandles.get(t);s&&(o.displayName=s);let a=Object.assign({},o);try{let l=await this.jupyterPasswordConnect.getPasswordConnectionInfo({url:o.baseUrl,isTokenEmpty:o.token.length===0,handle:t});a=Object.assign({},o,{authorizationHeader:l.requestHeaders||o.authorizationHeader})}catch(l){p.error("Failed to validate Password info",l)}return a}};rS=v([(0,en.injectable)(),m(0,(0,en.inject)(oe)),m(1,(0,en.inject)(un)),m(2,(0,en.inject)(sE)),m(3,(0,en.inject)(Xt)),m(4,(0,en.inject)(We)),m(4,(0,en.named)(dt)),m(5,(0,en.inject)(K)),m(6,(0,en.inject)(Kd)),m(6,(0,en.optional)()),m(7,(0,en.inject)(qc)),m(8,(0,en.inject)(tt)),m(9,(0,en.inject)(nt)),m(10,(0,en.inject)(Jt)),m(11,(0,en.optional)()),m(11,(0,en.inject)(Date.now().toString()))],rS);var $w=class{constructor(e){this.requestCreator=e}async getUrlFromUser(e,t="",r){if(!e&&!NP)try{let s=await Pt.env.clipboard.readText(),a=s.trim().startsWith("https://github.com/")?void 0:Pt.Uri.parse(s.trim(),!0);e=s&&a&&a.scheme.toLowerCase().startsWith("http")?s:""}catch{e=""}let i=Pt.window.createInputBox();r.push(i),i.title=y.jupyterSelectUriInputTitle,i.placeholder=y.jupyterSelectUriInputPlaceholder,i.value=e,i.validationMessage=t,i.buttons=[Pt.QuickInputButtons.Back],i.ignoreFocusOut=!0,i.show();let o=ne();return i.onDidChangeValue(()=>i.validationMessage="",this,r),i.onDidHide(()=>o.reject(De.cancel),this,r),i.onDidTriggerButton(s=>{s===Pt.QuickInputButtons.Back&&o.reject(De.back)},this,r),i.onDidAccept(async()=>{let s=await this.parseUserUriAndGetValidationError(i.value);if(typeof s.validationError=="string"){i.validationMessage=s.validationError;return}o.resolve(s)}),o.promise}async parseUserUriAndGetValidationError(e){let t=e.trim().replace(/\/(lab|tree)(\??)$/,""),r=vL(t,"");return r?(r.baseUrl=await Whe(t,this.requestCreator)||r.baseUrl,!t.toLowerCase().startsWith("http:")&&!t.toLowerCase().startsWith("https:")?{validationError:y.jupyterSelectURIMustBeHttpOrHttps}:{jupyterServerUri:r,url:t,validationError:void 0}):{validationError:y.jupyterSelectURIInvalidURI}}};$w=v([m(0,(0,en.inject)(qc))],$w);async function Whe(n,e){try{if(n=vL(n,"")?.baseUrl||n,new URL(n).pathname==="/")return n;let t=n.indexOf("token=")>0?n.substring(0,n.indexOf("token=")):n,o=(await e.getFetchMethod()(t,{method:"GET",redirect:"manual"})).headers.get("location");if(o&&o.includes("login?"))return o.substring(0,o.indexOf("login?"))}catch(t){p.debug("Unable to identify the baseUrl of the Jupyter Server",t)}}function nh(n,e,t,r){e=e.trim().toLowerCase();let i=Lt({handle:n,extensionId:_e,id:oC});Promise.all([ot(e.toLowerCase()),ot(i.toLowerCase())]).then(([o,s])=>{T("DATASCIENCE.ENTER_REMOTE_JUPYTER_URL",void 0,{serverIdHash:s,failed:!!r,baseUrlHash:o,isJupyterHub:t,isLocalHost:["localhost","127.0.0.1","::1"].includes(new URL(e).hostname),reason:r})}).catch(o=>p.error(`Failed to hash remote url ${e}`,o))}var gL=class{constructor(){this.displayNamesOfHandles=new Map}async getDisplayName(e,t){let r=[];try{let i=Pt.window.createInputBox();r.push(i),i.ignoreFocusOut=!0,i.title=y.jupyterRenameServer,i.value=t,i.placeholder=y.jupyterServerUriDisplayNameInputPlaceholder,i.buttons=[Pt.QuickInputButtons.Back],i.show();let o=ne();return r.push(i.onDidHide(()=>o.reject(De.cancel))),i.onDidTriggerButton(s=>{s===Pt.QuickInputButtons.Back&&o.reject(De.back)},this,r),i.onDidAccept(()=>{let s=i.value.trim()||t;this.displayNamesOfHandles.set(e,s),o.resolve(s)},this,r),await o.promise}finally{G(r)}}},Jw=class{constructor(e){this.globalMemento=e}async promptToUseInsecureConnections(){if(this.globalMemento.get(Uhe,!1))return!0;let e=[],t=ne();try{let r=Pt.window.createQuickPick();return e.push(r),r.canSelectMany=!1,r.ignoreFocusOut=!0,r.title=y.insecureSessionMessage,r.buttons=[Pt.QuickInputButtons.Back],r.items=[{label:ce.bannerLabelYes},{label:ce.bannerLabelNo}],r.show(),e.push(r.onDidHide(()=>t.reject(De.cancel))),r.onDidTriggerButton(i=>{i===Pt.QuickInputButtons.Back&&t.reject(De.back)},this,e),r.onDidAccept(()=>t.resolve(r.selectedItems.some(i=>i.label===ce.bannerLabelYes)),this,e),await t.promise}finally{G(e)}}};Jw=v([m(0,(0,en.inject)(We)),m(0,(0,en.named)(dt))],Jw);function vL(n,e){if(!n.startsWith(Le.REMOTE_URI))try{let t=new URL(n);return{baseUrl:`${t.protocol}//${t.host}${t.pathname==="/lab"||t.pathname==="/tree"?"":t.pathname}`,token:t.searchParams.get("token")||"",displayName:e||t.hostname}}catch(t){p.error(`Failed to parse URI ${n}`,t);return}}function XY(n){return n.map(e=>({handle:e.handle,uri:e.uri,displayName:e.serverInfo.displayName}))}function Vhe(n){let e=[];return n.forEach(t=>{let r=vL(t.uri,t.displayName);r&&e.push({handle:t.handle,uri:t.uri,serverInfo:r})}),e}var qw=class{constructor(e){this.encryptedStorage=e;this.updatePromise=Promise.resolve()}async getServers(e){if(this.servers&&!e)return this.servers;let t=await this.encryptedStorage.retrieve(li.JupyterServerRemoteLaunchService,L1);if(!t||t==="[]")return[];try{return this.servers=Vhe(JSON.parse(t))}catch{return[]}}async add(e){this.servers&&(this.servers=this.servers.filter(t=>t.handle!==e.handle).concat(e)),await(this.updatePromise=this.updatePromise.then(async()=>{let t=(await this.getServers(!0)).concat(e);this.servers=t,await this.encryptedStorage.store(li.JupyterServerRemoteLaunchService,L1,JSON.stringify(XY(t)))}).catch(h))}async remove(e){this.servers&&(this.servers=this.servers.filter(t=>t.handle!==e)),await(this.updatePromise=this.updatePromise.then(async()=>{let t=(await this.getServers(!0)).filter(r=>r.handle!==e);return this.servers=t,this.encryptedStorage.store(li.JupyterServerRemoteLaunchService,L1,JSON.stringify(XY(t)))}).catch(h))}async clear(){this.servers=[],await(this.updatePromise=this.updatePromise.then(async()=>{this.servers=[],await this.encryptedStorage.store(li.JupyterServerRemoteLaunchService,L1,void 0)}).catch(h))}};qw=v([m(0,(0,en.inject)(sE))],qw);var Hw=k(N()),iS=require("vscode");var nS=class extends Qt{constructor(t,r){super();this.uriProviderRegistration=t;this.serverUriStorage=r;this.handleMappings=new Map;this._onDidChangeHandles=this._register(new iS.EventEmitter);this.extensionId=_e;this.id=SP;this.displayName="Jupyter Server for Testing";this.onDidChangeServers=this._onDidChangeHandles.event}async provideJupyterServers(t){return Array.from(this.handleMappings.values()).map(r=>r.server)}async resolveJupyterServer(t,r){return t}activate(){this._register(this.uriProviderRegistration.createJupyterServerCollection(_e,this.id,this.displayName,this)),this._register(iS.commands.registerCommand("jupyter.selectjupyteruri",this.selectJupyterUri,this))}async selectJupyterUri(t){p.info(`Setting Jupyter Server URI to remote: ${t}`);let r=t.toString(!0),i=new URL(r),o=iS.Uri.parse(`${i.protocol}//${i.host}${i.pathname==="/lab"?"":i.pathname}`),s=i.searchParams.get("token")??"",a=await ga(t.toString(!0),"SHA-1"),l={label:this.displayName,id:a,connectionInformation:{baseUrl:o,token:s}};this.handleMappings.set(a,{uri:t,server:l}),await this.serverUriStorage.add({id:this.id,handle:a,extensionId:_e}),this._onDidChangeHandles.fire()}};nS=v([(0,Hw.injectable)(),m(0,(0,Hw.inject)(Jt)),m(1,(0,Hw.inject)(Xt))],nS);var U1=k(N());var Gw=require("vscode");var oS=class{constructor(e){this.disposables=e}activate(){this.registerCommandsIfTrusted()}dispose(){this.disposables.forEach(e=>e.dispose())}registerCommandsIfTrusted(){Gw.workspace.isTrusted&&this.registerCommand(J.ContinueEditSessionInCodespace,this.continueEditSessionInCodespace)}registerCommand(e,t){let r=Gw.commands.registerCommand(e,t,this);this.disposables.push(r)}async continueEditSessionInCodespace(){await Gw.commands.executeCommand("_workbench.editSessions.actions.continueEditSession.github.codespaces.continueEditSessionInCodespaceWithJupyterServer")}};oS=v([(0,U1.injectable)(),m(0,(0,U1.inject)(K))],oS);var ZY=k(N());var eX=require("vscode");var sS=class{activate(){this.eagerlyActivateOtherExtensions().catch(h)}async eagerlyActivateOtherExtensions(){await Promise.all(eX.extensions.all.filter(e=>e.packageJSON?.contributes?.pythonRemoteServerProvider).map(e=>e.isActive?Promise.resolve():e.activate().then(h,h)))}};sS=v([(0,ZY.injectable)()],sS);var W1=k(N()),tX=require("vscode");var aS=class{constructor(e){this.uriStorage=e}activate(){tX.commands.registerCommand("jupyter.getUsedAzMLServerHandles",()=>{let e=[];return this.uriStorage.all.forEach(r=>{r.provider.extensionId.toLowerCase()==="ms-toolsai.vscode-ai".toLowerCase()&&e.push(r.provider)}),e})}};aS=v([(0,W1.injectable)(),m(0,(0,W1.inject)(Xt))],aS);var qu=require("vscode");var rX=k(N());var lS=class{activate(){let e=Se.instance.get(K),t=new or;e.push(t),e.push(qu.commands.registerCommand("jupyter.manageAccessToKernels",()=>jhe(t)))}};lS=v([(0,rX.injectable)()],lS);async function jhe(n){let e=await KJ(),t=[];Array.from(e.entries()).forEach(([s])=>{let a=qu.extensions.getExtension(s)?.packageJSON?.displayName;a&&t.push({label:a,description:s,extensionId:s})});let r=[];n.add({dispose:()=>{r=G(r)}});let i=qu.window.createQuickPick();i.title=qu.l10n.t("Manage Access To Jupyter Kernels"),i.placeholder=qu.l10n.t("Choose which extensions can access Jupyter Kernels"),i.items=t,i.selectedItems=t.filter(s=>e.get(s.extensionId)===!0),i.canSelectMany=!0,i.ignoreFocusOut=!1;let o=!1;r.push(i),i.show(),await Promise.race([$C(i.onDidAccept,void 0,r).then(()=>o=!0),$C(i.onDidHide,void 0,r)]),o&&(await OJ(i.selectedItems.map(s=>s.extensionId)),r=G(r))}var oX=require("vscode");var V1=class{constructor(){this.cache=new Map;this.executionCount=0}getResults(e,t){return this.executionCount!==e&&(this.cache.clear(),this.executionCount=e),this.cache.get(t)}setResults(e,t,r){if(this.executionCount<e)this.cache.clear(),this.executionCount=e;else if(this.executionCount>e)return;this.cache.set(t,r)}},nX=V1,iX=V1;var ih=k(N());var cS=class{constructor(e,t){this.variables=e;this.kernelProvider=t;this.variableResultCache=new nX;this.variableSummaryCache=new iX;this.runningKernels=new Set;this._onDidChangeVariables=new oX.EventEmitter;this.onDidChangeVariables=this._onDidChangeVariables.event;this.kernelProvider.onKernelStatusChanged(this.onKernelStatusChanged,this)}onKernelStatusChanged({kernel:e}){if("variableProvider"in e.controller&&e.controller.variableProvider!==this)return;let t=e.notebook.uri.toString(),r=this.runningKernels.has(t);e.status==="idle"&&!r?this.runningKernels.add(t):e.status!=="busy"&&e.status!=="idle"&&r&&(this.runningKernels.delete(t),this._onDidChangeVariables.fire(e.notebook))}_getVariableResultCacheKey(e,t,r){let i="",o=t;return o&&(i=`${o.name}.${o.propertyChain.join(".")}[[${r}`),`${e}:${i}`}async*provideVariables(e,t,r,i,o){if(o.isCancellationRequested)return;let s=this.kernelProvider.get(e);if(!s||s.status==="dead"||s.status==="terminating")return;let a=this.kernelProvider.getKernelExecution(s).executionCount,l=this._getVariableResultCacheKey(e.uri.toString(),t,i),c=this.variableResultCache.getResults(a,l);if(t){let u=t;if(!c&&u.getChildren)c=(await u.getChildren(i,o)).map(f=>this.createVariableResult(f,s)),this.variableResultCache.setResults(a,l,c);else if(!c)return;for(let d of c)yield d;if(r===2&&u.count&&c.length>0&&u.count>i+c.length)for await(let d of this.provideVariables(e,t,r,i+c.length,o))yield d}else{c||(c=(await this.variables.getAllVariableDiscriptions(s,void 0,i,o)).map(d=>this.createVariableResult(d,s)),this.variableResultCache.setResults(a,l,c));for(let u of c)yield u}}_getVariableSummaryCacheKey(e,t){return`${e}:${t.name}`}async*provideVariablesWithSummarization(e,t,r,i,o){let s=this.kernelProvider.get(e),a=this.provideVariables(e,t,r,i,o);for await(let l of a)if(s&&s.status!=="dead"&&s.status!=="terminating"){let c=this._getVariableSummaryCacheKey(e.uri.toString(),l.variable),u=this.kernelProvider.getKernelExecution(s).executionCount,d=this.variableSummaryCache.getResults(u,c);d==null&&l.variable.type==="pandas.core.frame.DataFrame"&&(d=await this.variables.getVariableValueSummary({name:l.variable.name,value:l.variable.value,supportsDataExplorer:!1,type:l.variable.type??"",size:0,count:0,shape:"",truncated:!0},s,o),this.variableSummaryCache.setResults(u,c,d??null)),yield{hasNamedChildren:l.hasNamedChildren,indexedChildrenCount:l.indexedChildrenCount,variable:{name:l.variable.name,value:l.variable.value,expression:l.variable.expression,type:l.variable.type,language:l.variable.language,summary:d??""}}}}createVariableResult(e,t){let r=e.count??0,i=!!e.hasNamedChildren,o={getChildren:(s,a)=>this.getChildren(o,s,t,a),expression:Bhe(e.root,e.propertyChain),...e};return{variable:o,hasNamedChildren:i,indexedChildrenCount:r}}async getChildren(e,t,r,i){let o=e;return await this.variables.getAllVariableDiscriptions(r,o,t,i)}};cS=v([(0,ih.injectable)(),m(0,(0,ih.inject)(In)),m(0,(0,ih.named)(Le.KERNEL_VARIABLES)),m(1,(0,ih.inject)(ye))],cS);function Bhe(n,e){let t=n;for(let r of e)typeof r=="string"?t+=`.${r}`:t+=`[${r}]`;return t}var Hu=k(N()),j1=require("vscode");var $he=/Type:\s*(\w+)/,Jhe=/Value:\s*(.*)/,qhe=/String form:\s*([\s\S]+?)\n/,Hhe=/Docstring:\s*(.*)/,Ghe=/Length:\s+(.*)/,zhe=/^\s+\[(\d+) rows x (\d+) columns\]/m,Qhe=new Set(["DataFrame","list","dict","ndarray","Series","Tensor","EagerTensor","DataArray"]),uS=class{constructor(e,t,r,i){this.configService=e;this.disposables=r;this.kernelProvider=i;this.variableRequesters=new Map;this.cachedVariables=new Map;this.refreshEventEmitter=new j1.EventEmitter;this.variableRequesters.set(ge,t)}get refreshRequired(){return this.refreshEventEmitter.event}async getAllVariableDiscriptions(e,t,r,i){let o=yo(e.kernelConnectionMetadata)||ge,s=this.variableRequesters.get(o);return s?s.getAllVariableDiscriptions(e,t,r,i):[]}async getVariables(e,t){return this.getVariablesBasedOnKernel(t,e)}async getMatchingVariable(e,t,r){let i=this.cachedVariables.get(t.uri.toString());if(i){let o=i.variables.find(s=>s.name===e);return o&&!o.value&&(o=await this.getVariableValueFromKernel(o,t,r)),o}else{let o=await this.getVariableNamesAndTypesFromKernel(t,r);if(o){let s=o.find(a=>a.name===e);if(s)return this.getVariableValueFromKernel({name:e,value:void 0,supportsDataExplorer:!1,type:s.type,fullType:s.fullType,size:0,count:0,shape:"",truncated:!0},t,r)}}}async getVariableValueSummary(e,t,r){if(!t)return;let i=yo(t?.kernelConnectionMetadata)||ge,o=this.variableRequesters.get(i);if(o)return o.getVariableValueSummary(e,t,r)}async getDataFrameInfo(e,t,r,i){if(!t)return e;let o=yo(t?.kernelConnectionMetadata)||ge,s=this.variableRequesters.get(o);if(s){i&&(e=await this.getFullVariable(e,t));let a=e.name;return r&&(a=`${e.name}${r}`),s.getDataFrameInfo(e,t,a)}return e}async getDataFrameRows(e,t,r,i,o){let s=yo(i?.kernelConnectionMetadata)||ge,a=this.variableRequesters.get(s);if(a){let l=e.name;return o&&(l=`${e.name}${o}`),a.getDataFrameRows(t,r,i,l)}return{data:[]}}async getFullVariable(e,t,r){let i=yo(t?.kernelConnectionMetadata)||ge,o=this.variableRequesters.get(i);return o?o.getFullVariable(e,t,r):e}async getVariablesBasedOnKernel(e,t){let r=this.cachedVariables.get(e.uri.toString()),i=this.kernelProvider.getKernelExecution(e).pendingCells.length>0,o=this.kernelProvider.getKernelExecution(e);(!r||!i&&(r.currentExecutionCount!==t.executionCount||r.currentExecutionCount!==o.executionCount))&&(r={currentExecutionCount:o.executionCount,variables:(await this.getVariableNamesAndTypesFromKernel(e)).map(l=>({name:l.name,value:void 0,supportsDataExplorer:!1,type:l.type,fullType:l.fullType,size:0,shape:"",count:0,truncated:!0,fileName:e.notebook.uri}))});let s=this.configService.getSettings(e.resourceUri).variableExplorerExclude?this.configService.getSettings().variableExplorerExclude?.split(";"):[],a={executionCount:o.executionCount,pageStartIndex:-1,pageResponse:[],totalCount:0,refreshCount:t.refreshCount};if(r){let l=t.sortColumn,c=(f,g)=>{let b=f[l]?f[l]:"",I=g[l]?g[l]:"";return t.sortAscending?b.localeCompare(I,void 0,{sensitivity:"base"}):I.localeCompare(b,void 0,{sensitivity:"base"})};r.variables.sort(c);let u=t.startIndex?t.startIndex:0,d=t.pageSize?t.pageSize:100;a.pageStartIndex=u;for(let f=u;f<u+d&&f<r.variables.length;){if(s&&s.indexOf(r.variables[f].type)>=0){r.variables.splice(f,1);continue}let g=typeof r.variables[f].value=="string"?r.variables[f]:await this.getVariableValueFromKernel(r.variables[f],e);r.variables[f]=g,a.pageResponse.push(g),f+=1}this.cachedVariables.set(e.uri.toString(),r),a.totalCount=r.variables.length}return a}async getVariableProperties(e,t,r){let i=await this.getMatchingVariable(e,t,r),o=yo(t.kernelConnectionMetadata)||ge,s=this.variableRequesters.get(o);return s?s.getVariableProperties(e,r,i):{}}async getVariableNamesAndTypesFromKernel(e,t){let r=yo(e.kernelConnectionMetadata)||ge,i=this.variableRequesters.get(r);return i?i.getVariableNamesAndTypesFromKernel(e,t):[]}inspect(e,t,r=0,i){let o=ne();try{e.requestInspect({code:t,cursor_pos:r,detail_level:0}).then(s=>{s&&s.content.status==="ok"?o.resolve(s.content.data):o.resolve(void 0)}).catch(s=>{o.reject(s)})}catch(s){o.reject(s)}return i&&this.disposables.push(i.onCancellationRequested(()=>o.reject(new j1.CancellationError))),o.promise}async getVariableValueFromKernel(e,t,r){let i={...e};if(!t.disposed&&t.session?.kernel){let o=await this.inspect(t.session.kernel,e.name,0,r);if(o&&o.hasOwnProperty("text/plain")){let s=cc(o["text/plain"].toString()),a=$he.exec(s),l=Ghe.exec(s),c=zhe.exec(s);a&&(i.type=a[1]),i.value=[Jhe,qhe,Hhe].reduce((u,d)=>u||d.exec(s)?.[1]||"",""),l&&(i.count=parseInt(l[1],10)),c&&(i.shape=`(${c[1]}, ${c[2]})`)}o&&o.type&&(i.type=o.type.toString()),o&&o.value&&(i.value=o.value.toString()),Qhe.has(i.type)&&(i.supportsDataExplorer=!0)}return i.type&&i.count&&!i.shape&&Xe(t.kernelConnectionMetadata)&&i.supportsDataExplorer&&i.type!=="list"&&(i=await this.getFullVariable(i,t)),i}};uS=v([(0,Hu.injectable)(),m(0,(0,Hu.inject)(oe)),m(1,(0,Hu.inject)(zT)),m(1,(0,Hu.named)(Le.PYTHON_VARIABLES_REQUESTER)),m(2,(0,Hu.inject)(K)),m(3,(0,Hu.inject)(ye))],uS);var zw=k(N());var dS=class extends $e{constructor(){super("unknown",y.jupyterDataRateExceeded)}};async function B1(n,{code:e,initializeCode:t,cleanupCode:r},i){if(n.disposed||n.disposing||!n.session?.kernel||!n.session.kernel||n.session.isDisposed)return[];try{return t&&await gn(n.session.kernel,t,i),await gn(n.session.kernel,e,i)}catch(o){if(o instanceof hn)return[];throw o}finally{r&&await gn(n.session.kernel,r,i)}}var pS=class{constructor(e,t){this.varScriptGenerator=e;this.dfScriptGenerator=t}async getDataFrameInfo(e,t,r){let{code:i,cleanupCode:o,initializeCode:s}=await this.dfScriptGenerator.generateCodeToGetDataFrameInfo({isDebugging:!1,variableName:r}),a=await B1(t,{code:i,cleanupCode:o,initializeCode:s},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request for getDataFrameInfo",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"}),l=t.notebook?.uri||t.resourceUri||t.uri;return{...e,...this.deserializeJupyterResult(a),fileName:l}}async getDataFrameRows(e,t,r,i){let{code:o,cleanupCode:s,initializeCode:a}=await this.dfScriptGenerator.generateCodeToGetDataFrameRows({isDebugging:!1,variableName:i,startIndex:e,endIndex:t}),l=await B1(r,{code:o,cleanupCode:s,initializeCode:a},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request for getDataFrameRows",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"});return l.length===0?{data:[]}:A0(this.deserializeJupyterResult(l))}async getVariableProperties(e,t,r){let i={};return r&&r.value&&(i[`${e}`]=r.value),i}async getVariableValueSummary(e,t,r){let i=await this.varScriptGenerator.generateCodeToGetVariableValueSummary(e.name);try{return(await Ju(t,i.split(/\r?\n/),r))?.summary}catch(o){p.warn(`Exception when getting variable summary for variable "${e.name}": ${o.message}`);return}}async getAllVariableDiscriptions(e,t,r,i){if(!e.session)return[];let o=t?{root:t.root,propertyChain:t.propertyChain,startIndex:r}:void 0,s=await this.varScriptGenerator.generateCodeToGetAllVariableDescriptions(o),a=await Ju(e,s.split(/\r?\n/),i);if(e.disposed||e.disposing||i?.isCancellationRequested||!a)return[];try{return a}catch(l){return p.error(l),[]}}async getVariableNamesAndTypesFromKernel(e,t){if(e.session){let{code:r,cleanupCode:i,initializeCode:o}=await this.varScriptGenerator.generateCodeToGetVariableTypes({isDebugging:!1}),s=await B1(e,{code:r,cleanupCode:i,initializeCode:o},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request for getVariableNamesAndTypesFromKernel",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"});if(e.disposed||e.disposing)return[];let a=this.deserializeJupyterResult(s),l=[];for(let c of a){let u={...c,value:void 0,supportsDataExplorer:!1,size:0,shape:"",count:0,truncated:!0};l.push(u)}return l}return[]}async getFullVariable(e,t,r){let{code:i,cleanupCode:o,initializeCode:s}=await this.varScriptGenerator.generateCodeToGetVariableInfo({isDebugging:!1,variableName:e.name}),a=await B1(t,{code:i,cleanupCode:o,initializeCode:s},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request for getFullVariable",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"});return{...e,...this.deserializeJupyterResult(a)}}extractJupyterResultText(e){if(e.length>0){let t=e[0];if(t&&t.output_type==="stream"&&t.name==="stderr"&&t.hasOwnProperty("text")){let r=t.text;if(r.includes("iopub_data_rate_limit"))throw new dS;{let i=y.jupyterGetVariablesExecutionError(r);throw p.error(i),new Error(i)}}if(t&&t.output_type==="execute_result"){let r=t.data;if(r&&r.hasOwnProperty("text/plain"))return r["text/plain"]}if(t&&t.output_type==="stream"&&t.hasOwnProperty("text"))return t.text;if(t&&t.output_type==="error"&&t.hasOwnProperty("traceback")){let i=t.traceback.map(cc).join(`\r
`),o=y.jupyterGetVariablesExecutionError(i);throw p.error(o),new Error(o)}}throw new Error(y.jupyterGetVariablesBadResults)}deserializeJupyterResult(e){let t=this.extractJupyterResultText(e);return JSON.parse(t)}};pS=v([(0,zw.injectable)(),m(0,(0,zw.inject)(rg)),m(1,(0,zw.inject)(ng))],pS);var Dc=k(N());var mS=class{constructor(e,t,r,i,o,s,a){this.activationService=e;this.jupyterInterpreterService=t;this.disposables=r;this.extensionChecker=i;this.apiProvider=o;this.rawNotebookSupported=s;this.condaService=a}activate(){this.rawNotebookSupported.isSupported||(this.disposables.push(this.jupyterInterpreterService.onDidChangeInterpreter(()=>this.preWarmInterpreterVariables().catch(h))),this.preWarmInterpreterVariables().catch(h),this.apiProvider.onDidActivatePythonExtension(this.preWarmInterpreterVariables,this,this.disposables)),this.extensionChecker.isPythonExtensionInstalled&&(this.condaService.getCondaFile().catch(h),this.condaService.getCondaVersion().catch(h))}async preWarmInterpreterVariables(){if(!this.extensionChecker.isPythonExtensionActive)return;let e=await this.jupyterInterpreterService.getSelectedInterpreter();e&&this.activationService.getActivatedEnvironmentVariables(void 0,e).catch(h)}};mS=v([(0,Dc.injectable)(),m(0,(0,Dc.inject)(Ms)),m(1,(0,Dc.inject)(vi)),m(2,(0,Dc.inject)(K)),m(3,(0,Dc.inject)(qe)),m(4,(0,Dc.inject)(tr)),m(5,(0,Dc.inject)(_n)),m(6,(0,Dc.inject)(Fs))],mS);function sX(n,e,t){e.addSingleton(me,GI),e.addSingleton(me,th),e.addSingleton(me,$I),e.addSingleton(me,qI),e.addSingleton(me,HI),e.addSingleton(me,sS),e.addSingleton(me,nS),e.add(Og,VI),e.add(xx,jI),e.addSingleton(me,BI),e.addSingleton(me,oS),e.addSingleton(lL,kc),e.addBinding(lL,me),e.add(Mx,QI),e.addSingleton(Nx,zI),e.addSingleton($u,$u),e.addSingleton(me,ZI),QY(e),NY(n,t),e.addSingleton(me,rS),e.addSingleton(me,aS),e.addSingleton(me,lS),e.addSingleton(QT,cS),e.addSingleton(In,uS,Le.KERNEL_VARIABLES),e.addSingleton(zT,pS,Le.PYTHON_VARIABLES_REQUESTER),e.addSingleton(me,mS)}var _c=k(N()),Mo=require("vscode");var $1=class{constructor(e,t,r){this.disposedCallback=r,this.callback=e,this.viewChanged=t}dispose(){this.disposedCallback()}onMessage(e,t){this.callback(e,t)}onChangeViewState(e){this.viewChanged(e)}};var aX=1e3,Yhe;(t=>(t.Fetching="fetching",t.Skipped="skipped"))(Yhe||={});var gs;(f=>(f.Started="started",f.UpdateSettings="update_settings",f.InitializeData="init",f.GetAllRowsRequest="get_all_rows_request",f.GetAllRowsResponse="get_all_rows_response",f.GetRowsRequest="get_rows_request",f.GetRowsResponse="get_rows_response",f.CompletedData="complete",f.GetSliceRequest="get_slice_request",f.RefreshDataViewer="refresh_data_viewer",f.SliceEnablementStateChanged="slice_enablement_state_changed",f.DeprecationWarningClicked="deprecation_warning_clicked"))(gs||={});var fS=Symbol("IDataViewerFactory"),J1=Symbol("IDataViewer"),q1=Symbol("IJupyterVariableDataProvider"),H1=Symbol("IJupyterVariableDataProviderFactory"),hS=Symbol("IDataViewerDependencyService");var bL;function IL(n,e){return bL&&bL.hasOwnProperty(n)?bL[n]:e}function SL(n,...e){return n.replace(/{(\d+)}/g,(t,r)=>e[r]===void 0?t:e[r])}var Xhe=/^\s*((?<StartRange>-?\d+:)|(?<StopRange>-?:\d+)|(?:(?<Start>-?\d+)(?::(?<Stop>-?\d+))?(?::(?<Step>-?\d+))?))\s*$/;function CL(n){let e=n.length-2;return"["+n.map(()=>e>0?(e-=1,"0"):":").join(", ")+"]"}function Zhe(n,e){if(n.startsWith("[")&&n.endsWith("]")){let t,r=n.substring(1,n.length-1).split(",").map((i,o)=>{let s=Xhe.exec(i);if(s?.groups?.Start&&!s.groups.Stop){let a=parseInt(s.groups.Start),l=e[o];return(a>=0&&a>=l||a<0&&a<-l)&&(t={shapeIndex:o,value:a}),a}});if(t){let{shapeIndex:i,value:o}=t,s=IL("sliceIndexError","Index {0} out of range for axis {1} with {2} elements");return SL(s,o.toString(),i.toString(),e[i].toString())}else if(r&&r.length!==e.length){let i=IL("sliceMismatchedAxesError","Expected {0} axes, got {1} in slice expression");return SL(i,e.length.toString(),r.length.toString())}}return""}function lX(n,e){return Zhe(n,e)===""}var zu=require("vscode");var Gu=class{constructor(e,t,r){this.configService=e;this.rootPath=t;this.scripts=r;this.disposed=!1;this.themeIsDarkPromise=ne();this.webviewInit=ne();this._disposables=[];this.onMessageListeners=[];this._onDidDisposeWebviewPanel=new zu.EventEmitter;this.onDataScienceSettingsChanged=async()=>{let e=JSON.stringify(await this.generateDataScienceExtraSettings());this.postMessageInternal("update_settings",e).catch(h)};this.onWebViewLoadFailed=async()=>{this.dispose()};this.onPossibleSettingsChange=async e=>{if(e.affectsConfiguration("workbench.colorTheme")||e.affectsConfiguration("editor.fontSize")||e.affectsConfiguration("editor.fontFamily")||e.affectsConfiguration("editor.cursorStyle")||e.affectsConfiguration("editor.cursorBlinking")||e.affectsConfiguration("editor.autoClosingBrackets")||e.affectsConfiguration("editor.autoClosingQuotes")||e.affectsConfiguration("editor.autoSurround")||e.affectsConfiguration("editor.autoIndent")||e.affectsConfiguration("editor.scrollBeyondLastLine")||e.affectsConfiguration("editor.fontLigatures")||e.affectsConfiguration("editor.scrollbar.verticalScrollbarSize")||e.affectsConfiguration("editor.scrollbar.horizontalScrollbarSize")||e.affectsConfiguration("files.autoSave")||e.affectsConfiguration("files.autoSaveDelay")||e.affectsConfiguration("jupyter.widgetScriptSources")){let t=await this.generateDataScienceExtraSettings();if(t){let r=JSON.stringify(t);this.postMessageInternal("update_settings",r).catch(h)}}};this._disposables.push(zu.workspace.onDidChangeConfiguration(this.onPossibleSettingsChange,this)),this._disposables.push(this.configService.getSettings(void 0).onDidChange(this.onDataScienceSettingsChanged.bind(this)))}get onDidDispose(){return this._onDidDisposeWebviewPanel.event}dispose(){this.disposed||(this.disposed=!0,this._disposables.forEach(e=>e.dispose())),this.webviewInit=void 0,this._onDidDisposeWebviewPanel.fire()}getHTMLById(e){if(!this.activeHTMLRequest)this.activeHTMLRequest=ne(),this.postMessageInternal("get_html_by_id_request",e).catch(h);else throw new Error("getHTMLById request already in progress");return this.activeHTMLRequest.promise}addMessageListener(e){this.onMessageListeners.push(e)}removeMessageListener(e){let t=this.onMessageListeners.indexOf(e);t>=0&&this.onMessageListeners.splice(t,1)}asWebviewUri(e){if(!this.webview)throw new Error("asWebViewUri called too early");return this.webview?.asWebviewUri(e)}postMessage(e,t){return this.postMessageInternal(e.toString(),t)}onMessage(e,t){switch(e){case"started":this.webViewRendered();break;case"get_html_by_id_response":this.activeHTMLRequest&&(this.activeHTMLRequest.resolve(t),this.activeHTMLRequest=void 0);break;default:break}this.onMessageListeners.forEach(r=>{r(e,t)})}async loadWebview(e,t){if(this.disposed=!1,this.webviewInit=this.webviewInit||ne(),this.webview===void 0){let r=await this.generateDataScienceExtraSettings(),i=zu.workspace.getWorkspaceFolder(e)?.uri;this.webview=await this.provideWebview(e,r,i,t),this._disposables.push(this.webview.loadFailed(this.onWebViewLoadFailed,this))}this.onDataScienceSettingsChanged().catch(h),this.sendLocStrings().catch(h)}async generateDataScienceExtraSettings(){let e=this.owningResource,t=zu.workspace.getConfiguration("editor"),r=zu.workspace.getConfiguration("workbench"),i=r?r.get("colorTheme",kA):kA,o=zu.extensions.getExtension(sn);return{...JSON.parse(JSON.stringify(this.configService.getSettings(e))),extraSettings:{editor:{cursor:this.getValue(t,"cursorStyle","line"),cursorBlink:this.getValue(t,"cursorBlinking","blink"),autoClosingBrackets:this.getValue(t,"autoClosingBrackets","languageDefined"),autoClosingQuotes:this.getValue(t,"autoClosingQuotes","languageDefined"),autoSurround:this.getValue(t,"autoSurround","languageDefined"),autoIndent:this.getValue(t,"autoIndent",!1),fontLigatures:this.getValue(t,"fontLigatures",!1),scrollBeyondLastLine:this.getValue(t,"scrollBeyondLastLine",!0),verticalScrollbarSize:this.getValue(t,"scrollbar.verticalScrollbarSize",14),horizontalScrollbarSize:this.getValue(t,"scrollbar.horizontalScrollbarSize",10),fontSize:this.getValue(t,"fontSize",14),fontFamily:this.getValue(t,"fontFamily","Consolas, 'Courier New', monospace")},theme:i,hasPythonExtension:o!==void 0,isWeb:Ur()==="Unknown"}}}async sendLocStrings(){let e={collapseSingle:Ft.collapseSingle,expandSingle:Ft.expandSingle,openExportFileYes:y.openExportFileYes,openExportFileNo:y.openExportFileNo,noRowsInDataViewer:Ft.noRowsInDataViewer,sliceIndexError:Ft.sliceIndexError,sliceMismatchedAxesError:Ft.sliceMismatchedAxesError,filterRowsTooltip:Ft.sliceMismatchedAxesError,fetchingDataViewer:Ft.fetchingDataViewer,dataViewerHideFilters:Ft.dataViewerHideFilters,dataViewerShowFilters:Ft.dataViewerShowFilters,refreshDataViewer:Ft.refreshDataViewer,clearFilters:Ft.refreshDataViewer,sliceSummaryTitle:Ft.sliceSummaryTitle,sliceData:Ft.sliceData,sliceSubmitButton:Ft.sliceSubmitButton,sliceDropdownAxisLabel:Ft.sliceDropdownAxisLabel,sliceDropdownIndexLabel:Ft.sliceDropdownIndexLabel,variableExplorerNameColumn:Ft.variableExplorerNameColumn,variableExplorerTypeColumn:Ft.variableExplorerTypeColumn,variableExplorerCountColumn:Ft.variableExplorerCountColumn,variableExplorerValueColumn:Ft.variableExplorerValueColumn,collapseVariableExplorerLabel:Ft.collapseVariableExplorerLabel,variableLoadingValue:Ft.variableLoadingValue,showDataExplorerTooltip:Ft.showDataExplorerTooltip,noRowsInVariableExplorer:Ft.noRowsInVariableExplorer,loadingRowsInVariableExplorer:Ft.loadingRowsInVariableExplorer,previousPlot:Ft.previousPlot,nextPlot:Ft.nextPlot,panPlot:Ft.panPlot,zoomInPlot:Ft.zoomInPlot,zoomOutPlot:Ft.zoomOutPlot,exportPlot:Ft.exportPlot,deletePlot:Ft.deletePlot,selectedImageListLabel:Ft.selectedImageListLabel,selectedImageLabel:Ft.selectedImageLabel,dvDeprecationWarning:Ft.dvDeprecationWarning};this.postMessageInternal("loc_init",JSON.stringify(e)).catch(h)}async postMessageInternal(e,t){this.webviewInit&&(await this.webviewInit.promise,this.webview?.postMessage({type:e.toString(),payload:t}))}webViewRendered(){this.webviewInit&&!this.webviewInit.resolved&&this.webviewInit.resolve(),this.sendLocStrings().catch(h),this.onDataScienceSettingsChanged().catch(h)}getValue(e,t,r){return e?e.get(t,r):r}};v([Mh()],Gu.prototype,"getHTMLById",1),v([Mh()],Gu.prototype,"addMessageListener",1),v([Mh()],Gu.prototype,"removeMessageListener",1);var gS=class extends Gu{constructor(t,r,i,o,s,a,l){super(t,o,s);this.configService=t;this.provider=r;this._title=a;this.viewColumn=l;this.viewState={visible:!1,active:!1};this.webPanelViewStateChanged=t=>{let r=t.isVisible(),i=t.isActive(),o={visible:r,active:i},s={visible:this.viewState.visible,active:this.viewState.active};this.viewState.visible=r,this.viewState.active=i,this.onViewStateChanged({current:o,previous:s})};this.messageListener=i(this.onMessage.bind(this),this.webPanelViewStateChanged.bind(this),this.dispose.bind(this))}get isDisposed(){return this.disposed}get webPanel(){if(this.webview)return this.webview}async show(t){this.isDisposed||this.webPanel&&await this.webPanel.show(t)}dispose(){this.isDisposed||this.webPanel&&this.webPanel.close(),super.dispose()}get title(){return this._title}setTitle(t){this._title=t,!this.isDisposed&&this.webPanel&&this.webPanel.setTitle(t)}onViewStateChanged(t){}async provideWebview(t,r,i,o){return this.provider.create({viewColumn:this.viewColumn,listener:this.messageListener,title:this.title,rootPath:this.rootPath,scripts:this.scripts,settings:r,cwd:t,webviewHost:o,additionalPaths:i?[i]:[]})}};var cX="JupyterDataViewerPreferredViewColumn",oh=class extends gS{constructor(t,r,i,o,s){let a=zt(s.extensionUri,"dist","webviews","webview-side","viewers");super(r,t,(l,c,u)=>new $1(l,c,u),a,[zt(a,"dataExplorer.js")],y.dataExplorerTitle,i.get(cX)??Mo.ViewColumn.One);this.globalMemento=i;this.errorHandler=o;this.context=s;this.pendingRowsCount=0;this.sentDataViewerSliceDimensionalityTelemetry=!1;this._onDidDisposeDataViewer=new Mo.EventEmitter;this._onDidChangeDataViewerViewState=new Mo.EventEmitter;this.onDidDispose(this.dataViewerDisposed,this)}get active(){return!!this.webPanel?.isActive()}get refreshPending(){return this.pendingRowsCount>0}get onDidDisposeDataViewer(){return this._onDidDisposeDataViewer.event}get onDidChangeDataViewerViewState(){return this._onDidChangeDataViewerViewState.event}async showData(t,r){if(!this.isDisposed){this.dataProvider=t,await super.loadWebview(Mo.Uri.file(process.cwd())).catch(p.error),super.setTitle(r),await super.show(!0);let i=await this.prepDataFrameInfo();if(i.shape&&i.shape.length>2){this.maybeSendSliceDataDimensionalityTelemetry(i.shape.length);let o=CL(i.shape);i=await this.getDataFrameInfo(o)}this.postMessage(gs.InitializeData,i).catch(h)}}get kernel(){if(this.dataProvider&&"kernel"in this.dataProvider)return this.dataProvider.kernel}dataViewerDisposed(){this._onDidDisposeDataViewer.fire(this)}async refreshData(){let t=this.currentSliceExpression;this.dataFrameInfoPromise=void 0;let r=await this.getDataFrameInfo(void 0,!0);if(t!==void 0&&r.shape!==void 0)if(lX(t,r.shape))r=await this.getDataFrameInfo(t);else{let i=CL(r.shape);r=await this.getDataFrameInfo(i)}p.info(`Refreshing data viewer for variable ${r.name}`),this.postMessage(gs.InitializeData,r).catch(h)}dispose(){super.dispose(),this.dataProvider&&(this.dataProvider.dispose(),this.dataProvider=void 0)}async onViewStateChanged(t){t.current.active&&t.current.visible&&t.previous.active&&t.current.visible&&await this.globalMemento.update(cX,this.webPanel?.viewColumn),this._onDidChangeDataViewerViewState.fire()}get owningResource(){}onMessage(t,r){switch(t){case gs.GetAllRowsRequest:this.getAllRows(r).catch(h);break;case gs.GetRowsRequest:this.getRowChunk(r).catch(h);break;case gs.GetSliceRequest:this.getSlice(r).catch(h);break;case gs.RefreshDataViewer:this.refreshData().catch(h),T("DATASCIENCE.REFRESH_DATA_VIEWER");break;case gs.SliceEnablementStateChanged:T("DATASCIENCE.DATA_VIEWER_SLICE_ENABLEMENT_STATE_CHANGED",void 0,{newState:r.newState?"checked":"unchecked"});break;case gs.DeprecationWarningClicked:Mo.commands.executeCommand("workbench.extensions.search","@tag:jupyterVariableViewers").then(h,h);break;default:break}super.onMessage(t,r)}getDataFrameInfo(t,r){return(!this.dataFrameInfoPromise||t!==this.currentSliceExpression)&&(this.dataFrameInfoPromise=this.dataProvider?this.dataProvider.getDataFrameInfo(t,r):Promise.resolve({}),this.currentSliceExpression=t),this.dataFrameInfoPromise}async prepDataFrameInfo(){this.rowsTimer=new Me;let t=await this.getDataFrameInfo();try{T("DATASCIENCE.SHOW_DATA_EXPLORER",void 0,{rows:t.rowCount?t.rowCount:0,columns:t.columns?t.columns.length:0}),this.pendingRowsCount=t.rowCount?t.rowCount:0}catch{}return t}async getAllRows(t){return this.wrapRequest(async()=>{if(this.dataProvider){let r=await this.dataProvider.getAllRows(t);return this.pendingRowsCount=0,this.postMessage(gs.GetAllRowsResponse,r)}})}getSlice(t){return this.wrapRequest(async()=>{if(this.dataProvider){let r=await this.getDataFrameInfo(t.slice);return r.shape?.length&&this.maybeSendSliceDataDimensionalityTelemetry(r.shape.length),T("DATASCIENCE.DATA_VIEWER_SLICE_OPERATION",void 0,{source:t.source}),this.postMessage(gs.InitializeData,r)}})}getRowChunk(t){return this.wrapRequest(async()=>{if(this.dataProvider){let r=await this.getDataFrameInfo(t.sliceExpression),i=await this.dataProvider.getRows(t.start,Math.min(t.end,r.rowCount?r.rowCount:0),t.sliceExpression);return this.pendingRowsCount=Math.max(0,this.pendingRowsCount-i.length),this.postMessage(gs.GetRowsResponse,{rows:i,start:t.start,end:t.end})}})}async wrapRequest(t){try{return await t()}catch(r){if(r instanceof dS){p.error(r.message);let i=y.pythonInteractiveHelpLink;Mo.window.showErrorMessage(y.jupyterDataRateExceeded,i).then(o=>{o===i&&Mo.env.openExternal(Mo.Uri.parse(cC.JupyterDataRateHelpLink))},h),this.dispose()}p.error(r),this.errorHandler.handleError(r).then(h,h)}finally{this.sendElapsedTimeTelemetry()}}sendElapsedTimeTelemetry(){this.rowsTimer&&this.pendingRowsCount===0&&T("DATASCIENCE.SHOW_DATA_EXPLORER_ROWS_LOADED",void 0,{rowsTimer:this.rowsTimer.elapsedTime})}maybeSendSliceDataDimensionalityTelemetry(t){this.sentDataViewerSliceDimensionalityTelemetry||(T("DATASCIENCE.DATA_VIEWER_DATA_DIMENSIONALITY",{numberOfDimensions:t}),this.sentDataViewerSliceDimensionalityTelemetry=!0)}};v([fr("DATAVIEWER.WEBVIEW_LOADED")],oh.prototype,"showData",1),oh=v([(0,_c.injectable)(),m(0,(0,_c.inject)(Vd)),m(1,(0,_c.inject)(oe)),m(2,(0,_c.inject)(We)),m(2,(0,_c.named)(dt)),m(3,(0,_c.inject)(Gr)),m(4,(0,_c.inject)(tt))],oh);var Kr=k(N()),Ko=require("vscode");var z1=require("vscode");var G1=class{constructor(e){this.configuration=e}async isRequestedColumnSizeAllowed(e,t){if(e>aX&&await this.shouldAskForLargeData(t)){let r=y.tooManyColumnsMessage,i=y.tooManyColumnsYes,o=y.tooManyColumnsNo,s=y.tooManyColumnsDontAskAgain,a=await z1.window.showWarningMessage(r,i,o,s);return a===s&&await this.disableAskForLargeData(),a===i}return!0}async shouldAskForLargeData(e){let t=e?this.configuration.getSettings(e):this.configuration.getSettings();return t&&t.askForLargeDataFrames===!0}async disableAskForLargeData(e){let t=e?this.configuration.getSettings(e):this.configuration.getSettings();t&&(t.askForLargeDataFrames=!1,this.configuration.updateSetting("askForLargeDataFrames",!1,void 0,z1.ConfigurationTarget.Global).catch(h))}};var Ya=require("vscode");var uX=k(N());var Xa=class{async showContributedDataViewer(e,t){try{let r=this.getMatchingExternalVariableViewers(e);if(r.length===0)return Ya.window.showInformationMessage(y.dataViewerExtensionRequired,{modal:!0},ce.bannerLabelYes).then(i=>{i===ce.bannerLabelYes&&Ya.commands.executeCommand("workbench.extensions.search","@tag:jupyterVariableViewers").then(h,h)});if(r.length===1){let i=r[0].jupyterVariableViewers.command;return p.info(`Showing data viewer with command ${i} for variable ${JSON.stringify({...e,value:"..."})}`),Ya.commands.executeCommand(i,e)}else{let i=r.filter(s=>s.extension.id!==_e);if(i.length===1){let s=i[0].jupyterVariableViewers.command;return p.info(`Showing data viewer viewer with command ${s} for variable ${JSON.stringify({...e,value:"..."})}`),Ya.commands.executeCommand(s,e)}let o=Ya.window.createQuickPick();o.title=y.selectExternalDataViewer,o.items=r.map(s=>({label:s.jupyterVariableViewers.title,detail:s.extension.packageJSON?.displayName??s.extension.id,command:s.jupyterVariableViewers.command})),o.onDidAccept(async()=>{let s=o.selectedItems[0];if(s)return o.hide(),p.info(`Showing data viewer viewer with command ${s.command} for variable ${JSON.stringify({...e,value:"..."})}`),Ya.commands.executeCommand(s.command,e)}),o.show()}}catch(r){p.error(r),T("DATASCIENCE.FAILED_SHOW_DATA_EXPLORER",void 0,{reason:"exception",fromVariableView:t}),Ya.window.showErrorMessage(y.showDataViewerFail).then(h,h)}}getMatchingExternalVariableViewers(e){return this.getVariableViewers().filter(r=>!e.type||r.jupyterVariableViewers.dataTypes.includes(e.type)).filter(r=>r.extension.id!==_e)}getVariableViewers(){return Ya.extensions.all.filter(t=>t.packageJSON?.contributes?.jupyterVariableViewers&&t.packageJSON?.contributes?.jupyterVariableViewers.length).map(t=>{let r=t.packageJSON?.contributes;return r?.jupyterVariableViewers?r.jupyterVariableViewers.map(i=>({extension:t,jupyterVariableViewers:i})):[]}).flat()}};Xa=v([(0,uX.injectable)()],Xa);var dX="ds_prompt_about_deprecation",vS=class{constructor(e,t,r,i,o,s,a,l,c,u,d,f,g,b,I){this.disposables=e;this.debugService=t;this.jupyterVariableDataProviderFactory=i;this.dataViewerFactory=o;this.variableProvider=s;this.errorHandler=a;this.dataViewerDependencyService=l;this.interpreterService=c;this.platformService=u;this.kernelProvider=d;this.interactiveWindowProvider=f;this.experimentService=g;this.globalMemento=b;this.dataViewerDelegator=I;this.dataViewerChecker=new G1(r),Ko.workspace.isTrusted||Ko.workspace.onDidGrantWorkspaceTrust(this.registerCommandsIfTrusted,this,this.disposables)}activate(){this.registerCommandsIfTrusted()}registerCommandsIfTrusted(){Ko.workspace.isTrusted&&(this.registerCommand(J.ShowDataViewer,this.delegateDataViewer),this.registerCommand(J.ShowJupyterDataViewer,this.delegateDataViewer))}registerCommand(e,t){let r=Ko.commands.registerCommand(e,t,this);this.disposables.push(r)}async delegateDataViewer(e){let t="variable"in e?await this.getVariableFromRequest(e):e;if(!t){p.error("Variable info could not be retreived"),T("DATASCIENCE.FAILED_SHOW_DATA_EXPLORER",void 0,{reason:"no variable info",fromVariableView:!1});return}return this.dataViewerDelegator.showContributedDataViewer(t,!1)}async getVariableFromRequest(e){if(this.variableProvider){let t=R0(e.variable);try{return await this.variableProvider.getFullVariable(t)}catch(r){return p.warn("Full variable info could not be retreived, will attempt with partial info.",r),t}}}async showJupyterVariableView(e){T("OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_REQUEST_EX");let t=this.experimentService.inExperiment("DataViewerDeprecation");if(!this.globalMemento.get(dX)&&t&&(this.globalMemento.update(dX,!0).then(h,h),Ko.window.showInformationMessage(y.dataViewerDeprecationMessage,y.dataViewerDeprecationRecommendationActionMessage).then(r=>{r===y.dataViewerDeprecationRecommendationActionMessage&&Ko.commands.executeCommand("workbench.extensions.search","@tag:jupyterVariableViewers").then(h,h)},h)),this.debugService?.activeDebugSession&&this.variableProvider&&this.jupyterVariableDataProviderFactory&&this.dataViewerFactory)try{if(this.debugService.activeDebugSession.configuration&&this.dataViewerDependencyService&&this.interpreterService){let s=await this.getDebugAdapterPython(this.debugService.activeDebugSession.configuration);s&&await this.dataViewerDependencyService.checkAndInstallMissingDependencies(s)}let r=await this.jupyterVariableDataProviderFactory.create(e),o=(await r.getDataFrameInfo())?.columns?.length;if(o&&await this.dataViewerChecker.isRequestedColumnSizeAllowed(o)){let s=`${y.dataExplorerTitle} - ${e.name}`,a=await this.dataViewerFactory.create(r,s);return T("OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_SUCCESS_EX"),a}}catch(r){T("OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_ERROR_EX",void 0,void 0,r),p.error(r),this.errorHandler.handleError(r).then(h,h)}else try{let r=this.getActiveKernel();if(r&&this.jupyterVariableDataProviderFactory&&this.dataViewerFactory){let i=await this.jupyterVariableDataProviderFactory.create(e,r),o=`${y.dataExplorerTitle} - ${e.name}`;return await this.dataViewerFactory.create(i,o)}}catch(r){p.error(r),T("DATASCIENCE.FAILED_SHOW_DATA_EXPLORER"),Ko.window.showErrorMessage(y.showDataViewerFail).then(h,h)}}getActiveKernel(){let e=Ko.window.activeNotebookEditor?.notebook,t=e?.notebookType==It?this.kernelProvider.get(e):void 0;if(t)return t;let r=this.getActiveInteractiveWindowDocument(),i=r?this.kernelProvider.get(r):void 0;if(i)return i;let o=this.dataViewerFactory?.activeViewer;return o?this.kernelProvider.kernels.find(s=>s===o.kernel):void 0}getActiveInteractiveWindowDocument(){let e=this.interactiveWindowProvider.getActiveOrAssociatedInteractiveWindow();if(e)return Ko.workspace.notebookDocuments.find(t=>t===e?.notebookDocument)}async getDebugAdapterPython(e){if(!this.interpreterService){p.info("Interpreter Service missing when trying getDebugAdapterPython");return}let t="";if(e.debugAdapterPython!==void 0?(p.info("Found debugAdapterPython on Debug Configuration to use"),t=e.debugAdapterPython):e.pythonPath&&(p.info("Found pythonPath on Debug Configuration to use"),t=e.pythonPath),t){let r=t;return r.startsWith("~")&&this.platformService.homeDir&&(r=Lh(r,this.platformService.homeDir.path)),this.interpreterService.getInterpreterDetails(Ko.Uri.file(r))}else return this.interpreterService.getActiveInterpreter()}};vS=v([(0,Kr.injectable)(),m(0,(0,Kr.inject)(K)),m(1,(0,Kr.inject)(Ui)),m(1,(0,Kr.optional)()),m(2,(0,Kr.inject)(oe)),m(3,(0,Kr.inject)(H1)),m(3,(0,Kr.optional)()),m(4,(0,Kr.inject)(fS)),m(4,(0,Kr.optional)()),m(5,(0,Kr.inject)(In)),m(5,(0,Kr.named)(Le.DEBUGGER_VARIABLES)),m(6,(0,Kr.inject)(Gr)),m(7,(0,Kr.inject)(hS)),m(7,(0,Kr.optional)()),m(8,(0,Kr.inject)(rt)),m(8,(0,Kr.optional)()),m(9,(0,Kr.inject)(xr)),m(10,(0,Kr.inject)(ye)),m(11,(0,Kr.inject)(ii)),m(12,(0,Kr.inject)(Sd)),m(13,(0,Kr.inject)(We)),m(13,(0,Kr.named)(dt)),m(14,(0,Kr.inject)(Xa))],vS);var bS=k(N());var Q1="0.20.0";var Y1=require("vscode");var sh=class{async getVersion(e,t){try{let r=await this._getVersion(e,t);return typeof r=="string"?Yk(r):r}catch(r){p.warn(y.failedToGetVersionOfPandas,r.message);return}}async promptInstall(e,t,r){let i=r?y.pandasTooOldForViewingFormat(r,Q1):y.pandasRequiredForViewing(Q1);if((dm()?ce.install:await Y1.window.showErrorMessage(i,{modal:!0},ce.install))===ce.install)await this._doInstall(e,t);else throw T("DATASCIENCE.USER_DID_NOT_INSTALL_PANDAS"),new Error(i)}async checkOrInstall(e){let t=new Y1.CancellationTokenSource;try{let r=await this.getVersion(e,t.token);if(t.token.isCancellationRequested){T("DS_INTERNAL.SHOW_DATA_PANDAS_INSTALL_CANCELED");return}if(r){if(r.compare(Q1)>0){T("DS_INTERNAL.SHOW_DATA_PANDAS_OK");return}T("DS_INTERNAL.SHOW_DATA_PANDAS_TOO_OLD");let i=`${r.major}.${r.minor}.${r.build}`;await this.promptInstall(e,t,i)}T("DS_INTERNAL.SHOW_DATA_NO_PANDAS"),await this.promptInstall(e,t)}finally{t.dispose()}}};v([fr("DS_INTERNAL.PYTHON_MODULE_INSTALL",{action:"displayed",moduleName:hr.get(23)})],sh.prototype,"promptInstall",1);var EL="5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d",ege=`import pandas;print(pandas.__version__);print("${EL}")`,X1=class extends sh{constructor(t,r,i){super();this.installer=t;this.pythonFactory=r;this.interpreterService=i}async _getVersion(t,r){let s=(await(await this.pythonFactory.createActivatedEnvironment({resource:void 0,interpreter:t})).exec(["-c",ege],{token:r})).stdout;if(!s?.includes(EL))return p.warn(y.failedToGetVersionOfPandas,`Output is ${s}`),"";let a=Be(s.trim()),l=a.indexOf(EL);return l>=0?a[l-1]:""}async _doInstall(t,r){let i=t||await this.interpreterService.getActiveInterpreter();if(r.token.isCancellationRequested)return;await Rt(r.token,2,this.installer.install(23,i,r))===0&&T("DATASCIENCE.USER_INSTALLED_PANDAS")}async checkAndInstallMissingDependencies(t){T("DATAVIEWER.USING_INTERPRETER"),await this.checkOrInstall(t)}};var wL="5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d",tge=`import pandas as _VSCODE_pandas;print(_VSCODE_pandas.__version__);print("${wL}"); del _VSCODE_pandas`;function rge(n){return(n.kernelConnectionMetadata.interpreter&&Ue(n.kernelConnectionMetadata.interpreter))==="Conda"?"%conda":"%pip"}var Z1=class extends sh{async execute(e,t){if(!t.session?.kernel)throw new hn;let r=await gn(t.session.kernel,e),i=r.find(o=>o.output_type==="error");return i&&p.warn(y.failedToGetVersionOfPandas,i.message),r.map(o=>o.text?.toString())}async _getVersion(e){let r=(await this.execute(tge,e)).map(s=>s?s.toString():void 0).find(s=>s);if(!r?.includes(wL))return p.warn(y.failedToGetVersionOfPandas,`Output is ${r}`),"";let i=Be(r.trim()),o=i.indexOf(wL);return o>=0?i[o-1]:""}async _doInstall(e){let t=`${rge(e)} install pandas`;try{await this.execute(t,e),T("DATASCIENCE.USER_INSTALLED_PANDAS")}catch(r){throw T("DATASCIENCE.USER_INSTALLED_PANDAS",void 0,void 0,r),new Error(y.failedToInstallPandas)}}async checkAndInstallMissingDependencies(e){if(T("DATAVIEWER.USING_KERNEL"),!e.session?.kernel)throw T("DATASCIENCE.NO_ACTIVE_KERNEL_SESSION"),new Error("No no active kernel session.");await this.checkOrInstall(e)}};var yS=class{constructor(e,t,r){this.withKernel=new Z1,this.withInterpreter=new X1(e,t,r)}async checkAndInstallMissingDependencies(e){return"controller"in e?this.withKernel.checkAndInstallMissingDependencies(e):this.withInterpreter.checkAndInstallMissingDependencies(e)}};yS=v([(0,bS.injectable)(),m(0,(0,bS.inject)(ji)),m(1,(0,bS.inject)(Vr)),m(2,(0,bS.inject)(rt))],yS);var Qw=k(N());var pX=require("vscode");var Zp=class{constructor(e,t){this.serviceContainer=e;this.disposables=t;this.knownViewers=new Set;t.push(this),this.viewContext=new cr(Cr.IsDataViewerActive),this.disposables.push(pX.commands.registerCommand(J.RefreshDataViewer,this.refreshDataViewer,this))}dispose(){for(let e of this.knownViewers)e.dispose()}async create(e,t){let r,i=this.serviceContainer.get(J1);try{this.knownViewers.add(i),i.onDidDisposeDataViewer(this.updateOpenDataViewers,this,this.disposables),i.onDidChangeDataViewerViewState(this.updateViewStateContext,this,this.disposables),await i.showData(e,t),r=i}finally{r||i.dispose()}return r}get activeViewer(){return[...this.knownViewers.values()].find(e=>e.active)}updateOpenDataViewers(e){this.knownViewers.delete(e)}async updateViewStateContext(){let e=!1;this.knownViewers.forEach(t=>{t.active&&(e=!0)}),await this.viewContext.set(e)}refreshDataViewer(){for(let e of this.knownViewers)e.active&&e.refreshData().then(h,h)}};v([fr("DATASCIENCE.START_SHOW_DATA_EXPLORER")],Zp.prototype,"create",1),v([zv(1e3)],Zp.prototype,"refreshDataViewer",1),Zp=v([(0,Qw.injectable)(),m(0,(0,Qw.inject)(Ze)),m(1,(0,Qw.inject)(K))],Zp);var Yu=k(N());var Qu=class{constructor(e,t){this.variableManager=e;this.dependencyService=t;this.initialized=!1}get kernel(){return this._kernel}static getNormalizedColumns(e){return e.map(t=>{let r;switch(t.type){case"bool":r="bool";break;case"integer":case"int32":case"int64":case"float":case"float32":case"float64":case"number":r="number";break;default:r="string"}return{key:t.key,type:r}})}static parseShape(e){try{if(e.startsWith("(")&&e.endsWith(")"))return e.substring(1,e.length-1).split(",").map(t=>parseInt(t))}catch{p.error(`Could not parse IJupyterVariable with malformed shape: ${e}`)}}dispose(){}setDependencies(e,t){this._kernel=t,this.variable=e}async getDataFrameInfo(e,t){let r={};await this.ensureInitialized();let i=this.variable;return i&&((e||t)&&(i=await this.variableManager.getDataFrameInfo(i,this._kernel,e,t)),r={columns:i.columns?Qu.getNormalizedColumns(i.columns):i.columns,indexColumn:i.indexColumn,rowCount:i.rowCount,dataDimensionality:i.dataDimensionality,shape:Qu.parseShape(i.shape),sliceExpression:e,type:i.type,maximumRowChunkSize:i.maximumRowChunkSize,name:i.name,fileName:Ae(i.fileName)}),t&&(this.variable=i),r}async getAllRows(e){let t=[];return await this.ensureInitialized(),this.variable&&this.variable.rowCount&&(t=(await this.variableManager.getDataFrameRows(this.variable,0,this.variable.rowCount,this._kernel,e)).data),t}async getRows(e,t,r){let i=[];return await this.ensureInitialized(),this.variable&&this.variable.rowCount&&(i=(await this.variableManager.getDataFrameRows(this.variable,e,t,this._kernel,r)).data),i}async ensureInitialized(){!this.initialized&&this.variable&&(this.initialized=!0,this._kernel?.kernelConnectionMetadata&&this.dependencyService&&await this.dependencyService.checkAndInstallMissingDependencies(ol()?this._kernel:this._kernel?.kernelConnectionMetadata.interpreter||this._kernel),this.variable=await this.variableManager.getDataFrameInfo(this.variable,this._kernel))}};Qu=v([(0,Yu.injectable)(),m(0,(0,Yu.inject)(In)),m(0,(0,Yu.named)(Le.ALL_VARIABLES)),m(1,(0,Yu.inject)(hS)),m(1,(0,Yu.optional)())],Qu);var eR=k(N());var IS=class{constructor(e){this.serviceContainer=e}async create(e,t){let r=this.serviceContainer.get(q1);return r.setDependencies(e,t),r}};IS=v([(0,eR.injectable)(),m(0,(0,eR.inject)(Ze))],IS);var CS=k(N()),tR=require("vscode");var SS=class{constructor(e,t,r){this.kernelProvider=e;this.controllers=t;this.ipywidgetMessageDispatcher=r;this.disposables=[];this.widgetOutputsPerNotebook=new WeakMap}dispose(){G(this.disposables)}activate(){let e=tR.notebooks.createRendererMessaging("jupyter-ipywidget-renderer");e.onDidReceiveMessage(this.onDidReceiveMessage.bind(this,e),this,this.disposables),this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposables)}onDidStartKernel(e){this.hookupKernel(e),e.onStarted(()=>this.hookupKernel(e),this,this.disposables),e.onRestarted(()=>this.hookupKernel(e),this,this.disposables)}hookupKernel(e){this.widgetOutputsPerNotebook.delete(e.notebook);let t=e.session?.kernel,r=e.session?.kernel?.iopubMessage;if(!r)return;let i=this.ipywidgetMessageDispatcher.create(e.notebook);this.disposables.push(i.onDisplayMessage(a=>{this.trackModelId(e.notebook,a)}));let o=require("@jupyterlab/services"),s=(a,l)=>{a===t&&(o.KernelMessage.isDisplayDataMsg(l)||o.KernelMessage.isUpdateDisplayDataMsg(l)||o.KernelMessage.isExecuteReplyMsg(l)||o.KernelMessage.isExecuteResultMsg(l)?this.trackModelId(e.notebook,l):o.KernelMessage.isCommOpenMsg(l)&&l.content?.target_name===Le.DefaultCommTarget&&typeof l.content?.comm_id=="string"&&this.addModelId(e.notebook,l.content.comm_id))};r.connect(s),this.disposables.push(new tR.Disposable(()=>r.disconnect(s)))}addModelId(e,t){let r=this.widgetOutputsPerNotebook.get(e)||new Set;r.add(t),this.widgetOutputsPerNotebook.set(e,r)}trackModelId(e,t){let r=t.content;if(r.data&&typeof r.data=="object"&&zi in r.data){let i=r.data[zi];i&&"model_id"in i&&this.addModelId(e,i.model_id)}}onDidReceiveMessage(e,{editor:t,message:r}){r&&typeof r=="object"&&r.command==="query-widget-state"&&this.queryWidgetState(e,t,r),r&&typeof r=="object"&&r.command==="ipywidget-renderer-loaded"&&this.sendWidgetVersionAndState(e,t)}queryWidgetState(e,t,r){let i=this.widgetOutputsPerNotebook.get(t.notebook),o=!!this.controllers.getSelected(t.notebook),s=!!i?.has(r.model_id);e.postMessage({command:"query-widget-state",model_id:r.model_id,hasWidgetState:s,kernelSelected:o},t).then(h,h)}sendWidgetVersionAndState(e,t){let r=this.kernelProvider.get(t.notebook),i=r?.ipywidgetsVersion;r?.ipywidgetsVersion&&p.trace(`IPyWidget version in Kernel is ${r?.ipywidgetsVersion}.`);let o=!!this.controllers.getSelected(t.notebook);e.postMessage({command:"ipywidget-renderer-init",version:i,widgetState:void 0,kernelSelected:o},t).then(h,h)}};SS=v([(0,CS.injectable)(),m(0,(0,CS.inject)(ye)),m(1,(0,CS.inject)(He)),m(2,(0,CS.inject)(ja))],SS);var lh=k(N());var PL=require("vscode");var ah=k(N());var Tc=require("vscode");var rR=class{constructor(e,t,r){this.disposedCallback=r,this.callback=e,this.viewChanged=t}dispose(){this.disposedCallback()}onMessage(e,t){this.callback(e,t)}onChangeViewState(e){this.viewChanged&&this.viewChanged(e)}};var na;(s=>(s.Started="started",s.UpdateSettings="update_settings",s.SendPlot="send_plot",s.CopyPlot="copy_plot",s.ExportPlot="export_plot",s.RemovePlot="remove_plot"))(na||={});na.Started,na.UpdateSettings,na.SendPlot,na.CopyPlot,na.ExportPlot,na.RemovePlot;var mX=class{},nR=Symbol("IPlotViewerProvider"),iR=Symbol("IPlotViewer");var ES=class extends gS{constructor(t,r,i,o){let s=new Me,a=zt(o.extensionUri,"dist","webviews","webview-side","viewers");super(r,t,(l,c,u)=>new rR(l,c,u),a,[zt(a,"plotViewer.js")],y.plotViewerTitle,Tc.ViewColumn.One);this.fs=i;this.context=o;this.closedEvent=new Tc.EventEmitter;this.removedEvent=new Tc.EventEmitter;this.addPlot=async t=>{this.isDisposed||(await super.show(!1),this.postMessage(na.SendPlot,t).catch(h))};super.loadWebview(Tc.Uri.file(process.cwd())).catch(p.error).finally(()=>{T("PLOTVIEWER.WEBVIEW_LOADED",{duration:s.elapsedTime})})}get closed(){return this.closedEvent.event}get removed(){return this.removedEvent.event}async show(){if(!this.isDisposed)return super.show(!0)}dispose(){super.dispose(),this.removedEvent.dispose(),this.closedEvent&&this.closedEvent.fire(this)}get owningResource(){}onMessage(t,r){switch(t){case na.CopyPlot:this.copyPlot(r.toString()).catch(h);break;case na.ExportPlot:this.exportPlot(r).catch(h);break;case na.RemovePlot:this.removePlot(r);break;default:break}super.onMessage(t,r)}removePlot(t){this.removedEvent.fire(t)}copyPlot(t){return Promise.resolve()}async exportPlot(t){p.info("exporting plot...");let r={};r[y.pngFilter]=["png"],r[y.svgFilter]=["svg"];let i=await Tc.window.showSaveDialog({saveLabel:y.exportPlotTitle,filters:r});try{if(i)switch(Qi(i.path).toLowerCase()){case".png":let s=Tg(t.png.replace("data:image/png;base64",""));await this.fs.writeFile(i,s);break;default:case".svg":await this.fs.writeFile(i,t.svg);break}}catch(o){p.error(o),Tc.window.showErrorMessage(y.exportImageFailed(o.toString())).then(h,h)}}};ES=v([(0,ah.injectable)(),m(0,(0,ah.inject)(Vd)),m(1,(0,ah.inject)(oe)),m(2,(0,ah.inject)(nt)),m(3,(0,ah.inject)(tt))],ES);var wS=class extends ES{constructor(t,r,i,o){super(t,r,i,o);this.fsNode=i}async exportPlot(t){p.info("exporting plot...");let r={};r[y.pdfFilter]=["pdf"],r[y.pngFilter]=["png"],r[y.svgFilter]=["svg"];let i=await PL.window.showSaveDialog({saveLabel:y.exportPlotTitle,filters:r});try{if(i)switch(Qi(i.fsPath).toLowerCase()){case".pdf":await kL(t.svg,this.fsNode,i);break;case".png":let s=Tg(t.png.replace("data:image/png;base64",""));await this.fs.writeFile(i,s);break;default:case".svg":await this.fs.writeFile(i,t.svg);break}}catch(o){p.error(o),PL.window.showErrorMessage(y.exportImageFailed(o)).then(h,h)}}};wS=v([(0,lh.injectable)(),m(0,(0,lh.inject)(Vd)),m(1,(0,lh.inject)(oe)),m(2,(0,lh.inject)(gr)),m(3,(0,lh.inject)(tt))],wS);async function kL(n,e,t){p.info("Attempting pdf write...");let r=(await import("svg-to-pdfkit")).default,i=ne(),o=require("pdfkit/js/pdfkit.standalone"),s=new o,a=e.createLocalWriteStream(t.fsPath);p.info(`Writing pdf to ${t.fsPath}`),a.on("finish",()=>i.resolve),r(s,n,0,0,{preserveAspectRatio:"xMinYMin meet"}),s.pipe(a),s.end(),p.info(`Finishing pdf to ${t.fsPath}`),await i.promise,p.info(`Completed pdf to ${t.fsPath}`)}var Yw=k(N());var PS=class{constructor(e,t){this.serviceContainer=e;this.imageList=[];this.closedViewer=()=>{this.currentViewer&&(this.currentViewer=void 0),this.currentViewerClosed&&(this.currentViewerClosed.dispose(),this.currentViewerClosed=void 0)};this.removedPlot=e=>{this.imageList.splice(e,1)};t.push(this)}dispose(){this.currentViewer&&this.currentViewer.dispose()}async showPlot(e){this.imageList.push(e);let t=this.currentViewer?[e]:this.imageList,r=await this.getOrCreate();await Promise.all(t.map(r.addPlot))}async getOrCreate(){return this.currentViewer||(this.currentViewer=this.serviceContainer.get(iR),this.currentViewerClosed=this.currentViewer.closed(this.closedViewer),this.currentViewer.removed(this.removedPlot),T("DATASCIENCE.OPEN_PLOT_VIEWER"),await this.currentViewer.show()),this.currentViewer}};PS=v([(0,Yw.injectable)(),m(0,(0,Yw.inject)(Ze)),m(1,(0,Yw.inject)(K))],PS);var lR=k(N());var sR=k(N()),em=require("vscode");var aR="image/svg+xml",oR={"image/png":"png","image/jpeg":"jpeg","image/gif":"gif",[aR]:"svg"},kS=class{constructor(e){this.fs=e}async savePlot(e,t,r){if(e.isClosed)return;let i=nge(e,t,r);if(!i)return p.error(`No plot to save ${M(e.uri)}, id: ${t} for ${r}`);if(!(r.toLowerCase()in oR))return p.error(`Unsupported MimeType ${M(e.uri)}, id: ${t} for ${r}`);let o=await this.getSaveTarget(i,r);o&&(o.path.toLowerCase().endsWith("pdf")?await this.saveAsPdf(i,o):await this.saveAsImage(i,o))}getSaveTarget(e,t){let r=oR[t.toLowerCase()],i={};e.items.find(l=>l.mime.toLowerCase()===aR)&&(i[y.pdfFilter]=["pdf"],i[y.svgFilter]=["svg"]),r==="png"&&(i[y.pngFilter]=["png"]),Object.keys(i).length===0&&(i.Images=[r]);let o=(em.workspace.workspaceFolders?.length||0)>0?em.workspace.workspaceFolders[0].uri:void 0,s="output",a=o?em.Uri.joinPath(o,s):em.Uri.file(s);return em.window.showSaveDialog({defaultUri:a,saveLabel:y.exportPlotTitle,filters:i})}async saveAsImage(e,t){let r=Qi(t.path).substring(1),i=Object.keys(oR).find(s=>oR[s]===r),o=e.items.find(s=>s.mime===i);if(!o)throw new Error(`Unsupported MimeType ${t.toString()}, available mime Types: ${e.items.map(s=>s.mime).join(", ")}`);await this.fs.writeFile(t,o.data)}async saveAsPdf(e,t){return p.error("Save as PDF is not yet supported on the web.")}};kS=v([(0,sR.injectable)(),m(0,(0,sR.inject)(nt))],kS);function nge(n,e,t){for(let r of n.getCells())for(let i of r.outputs)if(i.id===e&&i.items.find(o=>o.mime===t))return i}var xS=class extends kS{constructor(t){super(t);this.fsNode=t}async saveAsPdf(t,r){let i=Buffer.from(t.items.find(o=>o.mime===aR).data).toString();await kL(i,this.fsNode,r)}};xS=v([(0,lR.injectable)(),m(0,(0,lR.inject)(gr))],xS);var cR=k(N());var ige="image/svg+xml",oge="image/png",Xu=class{constructor(e){this.plotViewProvider=e}async openPlot(e,t){if(e.isClosed)return;let r=fX(e,t,ige),i;if(r)i=new TextDecoder().decode(r.data);else{let o=fX(e,t,oge);if(!o)return p.error(`No SVG or PNG Plot to open ${M(e.uri)}, id: ${t}`);i=sge(o)}i&&await this.plotViewProvider.showPlot(i)}};Xu=v([(0,cR.injectable)(),m(0,(0,cR.inject)(nR))],Xu);function fX(n,e,t){for(let r of n.getCells())for(let i of r.outputs)if(i.id===e)return i.items.find(o=>o.mime===t)}function sge(n){let e=n.data,t=mx(e),r=age(e);return`<?xml version="1.0" encoding="utf-8" standalone="no"?>
<svg height="${r.height}" width="${r.width}" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <g>
        <image xmlns="http://www.w3.org/2000/svg" x="0" y="0" height="100%" width="100%" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="data:image/png;base64,${t}"/>
    </g>
</svg>`}function age(n){if(!lge(n))throw new Error("The buffer is not a valid png");let e=new DataView(new Uint8Array(n).buffer);return{width:e.getUint32(16,!1),height:e.getUint32(20,!1)}}function lge(n){return n[0]===137&&n[1]===80&&n[2]===78&&n[3]===71&&n[4]===13&&n[5]===10&&n[6]===26&&n[7]===10&&n.length>29}var Xw=k(N()),Zw=require("vscode");var uR=Symbol("IPlotSaveHandler");var DS=class{constructor(e,t){this.plotSaveHandler=e;this.plotViewHandler=t;this.disposables=[]}dispose(){G(this.disposables)}activate(){this.activateImpl().catch(h)}async activateImpl(){let e=Zw.extensions.getExtension(id);if(!e)return;e.isActive||await e.activate(),e.exports.onDidReceiveMessage(async({editor:r,message:i})=>{let o=r.notebook||Zw.window.activeNotebookEditor?.notebook;if(o)try{i.type==="saveImageAs"?await this.plotSaveHandler.savePlot(o,i.outputId,i.mimeType):i.type==="openImageInPlotViewer"&&await this.plotViewHandler.openPlot(o,i.outputId)}catch(s){p.error(s),Zw.window.showErrorMessage(y.exportImageFailed(s.message)).then(h,h)}},this,this.disposables)}};DS=v([(0,Xw.injectable)(),m(0,(0,Xw.inject)(uR)),m(1,(0,Xw.inject)(Xu))],DS);var ch=k(N()),Rc=require("vscode");var _S=class{constructor(e,t,r,i){this.interactiveWindowProvider=e;this.kernelProvider=t;this.dataViewerFactory=r;this.disposables=i;this._onDidFinisheExecutingActiveNotebook=new Rc.EventEmitter;this._onDidChangeActiveNotebook=new Rc.EventEmitter;this._onDidRestartActiveNotebook=new Rc.EventEmitter;this._executionCountTracker=new WeakMap;Rc.window.onDidChangeActiveNotebookEditor(this.activeEditorChanged,this,this.disposables),Rc.workspace.onDidCloseNotebookDocument(this.notebookEditorClosed,this,this.disposables),this.kernelProvider.onDidRestartKernel(o=>{this.handleRestart({state:1,notebook:o.notebook})},this,this.disposables),ar.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,this.disposables)}get onDidChangeActiveNotebook(){return this._onDidChangeActiveNotebook.event}get onDidFinishExecutingActiveNotebook(){return this._onDidFinisheExecutingActiveNotebook.event}get onDidRestartActiveNotebook(){return this._onDidRestartActiveNotebook.event}get activeKernel(){let e=Rc.window.activeNotebookEditor?.notebook,t=e?.notebookType==It?this.kernelProvider.get(e):void 0;if(t)return t;let r=this.getActiveInteractiveWindowDocument(),i=r?this.kernelProvider.get(r):void 0;if(i)return i;let o=this.dataViewerFactory.activeViewer;return o?this.kernelProvider.kernels.find(s=>s===o.kernel):void 0}get activeNotebookExecutionCount(){let e=this.activeKernel?.notebook;return e?this._executionCountTracker.get(e):void 0}getActiveInteractiveWindowDocument(){let e=this.interactiveWindowProvider.getActiveOrAssociatedInteractiveWindow();if(e)return Rc.workspace.notebookDocuments.find(t=>t===e?.notebookDocument)}onDidChangeNotebookCellExecutionState(e){St(e.cell.notebook)&&e.state===1&&this.handleExecute({notebook:e.cell.notebook,state:0,cell:e.cell})}handleExecute(e){this.isNonSilentExecution(e)&&(e.cell?.executionSummary?.executionOrder!==void 0&&this._executionCountTracker.set(e.notebook,e.cell.executionSummary?.executionOrder),this.isActiveNotebookEvent(e)&&e.cell?.executionSummary?.executionOrder!==void 0&&this.activeKernel&&this.kernelProvider.getKernelExecution(this.activeKernel).pendingCells.length===0&&this._onDidFinisheExecutingActiveNotebook.fire({executionCount:e.cell.executionSummary?.executionOrder}))}handleRestart(e){this._executionCountTracker.delete(e.notebook),this.isActiveNotebookEvent(e)&&this._onDidRestartActiveNotebook.fire()}notebookEditorClosed(e){this._executionCountTracker.delete(e)}activeEditorChanged(e){let t={};if(e&&St(e.notebook)){let r=this._executionCountTracker.get(e.notebook);r&&(t.executionCount=r)}this._onDidChangeActiveNotebook.fire(t)}isNonSilentExecution(e){return!!(e.state===0&&e.cell&&e.cell.executionSummary?.executionOrder)}isActiveNotebookEvent(e){return this.activeKernel?.notebook===e.notebook}};_S=v([(0,ch.injectable)(),m(0,(0,ch.inject)(ii)),m(1,(0,ch.inject)(ye)),m(2,(0,ch.inject)(fS)),m(3,(0,ch.inject)(K))],_S);"force_variable_refresh","settings_updated","activate","show_data_explorer","get_variables_request","get_variables_response","variable_explorer_toggle","set_variable_explorer_height","variable_explorer_height_response","open_link","variables_complete","update_settings","loc_init","update_variable_view_execution_count","get_html_by_id_request","get_html_by_id_response","restart_kernel";var hX=class{},dR=Symbol("INotebookWatcher"),pR=Symbol("IVariableViewProvider");var eP=k(N()),gX=require("vscode");var TS=class{constructor(e,t){this.extensionContext=e;this.variableViewProvider=t}activate(){this.extensionContext.subscriptions.push(gX.window.registerWebviewViewProvider(this.variableViewProvider.viewType,this.variableViewProvider,{webviewOptions:{retainContextWhenHidden:!1}}))}};TS=v([(0,eP.injectable)(),m(0,(0,eP.inject)(tt)),m(1,(0,eP.inject)(pR))],TS);var ia=k(N());var hR=require("vscode");var mR=class{constructor(e,t){this.disposedCallback=t,this.callback=e}dispose(){this.disposedCallback()}onMessage(e,t){this.callback(e,t)}};var fR=class extends Gu{constructor(t,r,i,o,s){super(t,o,s);this.configService=t;this.provider=i;this.messageListener=r(this.onMessage.bind(this),this.dispose.bind(this))}get isDisposed(){return this.disposed}get webviewView(){return this.webview&&this.webview}async provideWebview(t,r,i,o){if(!o)throw new Error("WebviewViews must be passed an initial VS Code Webview");return this.provider.create({additionalPaths:i?[i]:[],rootPath:this.rootPath,cwd:t,listener:this.messageListener,scripts:this.scripts,settings:r,webviewHost:o})}};var uh=class extends fR{constructor(t,r,i,o,s,a,l){let c=zt(i.extensionUri,"dist","webviews","webview-side","viewers");super(t,(u,d)=>new mR(u,d),r,c,[zt(c,"variableView.js")]);this.variables=o;this.disposables=s;this.notebookWatcher=a;this.dataViewerDelegator=l;this.notebookWatcher.onDidFinishExecutingActiveNotebook(this.activeNotebookExecuted,this,this.disposables),this.notebookWatcher.onDidChangeActiveNotebook(this.activeNotebookChanged,this,this.disposables),this.notebookWatcher.onDidRestartActiveNotebook(this.activeNotebookRestarted,this,this.disposables),this.variables.refreshRequired(this.sendRefreshMessage,this,this.disposables),hR.window.onDidChangeActiveTextEditor(this.activeTextEditorChanged,this,this.disposables)}get owningResource(){}async load(t){await super.loadWebview(hR.Uri.file(process.cwd()),t).catch(p.error),this.webviewView&&this.disposables.push(this.webviewView.onDidChangeVisibility(()=>{this.handleVisibilityChanged()})),this.handleVisibilityChanged()}get title(){return"variableView"}onMessage(t,r){switch(t){case"get_variables_request":this.handleMessage(t,r,this.requestVariables);break;case"show_data_explorer":this.handleMessage(t,r,this.showDataViewer);break;default:break}super.onMessage(t,r)}handleMessage(t,r,i){let o=r;i.bind(this)(o)}handleVisibilityChanged(){let t=new cr("jupyter.variableViewVisible"),r=!1;this.webviewView&&(r=this.webviewView.visible),t.set(r).catch(h),r&&(T("DS_INTERNAL.NATIVE_VARIABLE_VIEW_MADE_VISIBLE"),this.notebookWatcher.activeNotebookExecutionCount!==void 0?this.postMessage("update_variable_view_execution_count",{executionCount:this.notebookWatcher.activeNotebookExecutionCount}).catch(h):this.postMessage("force_variable_refresh").catch(h))}async showDataViewer(t){return t.variable.fileName=t.variable.fileName??this.notebookWatcher.activeKernel?.notebook.uri,this.dataViewerDelegator.showContributedDataViewer(t.variable,!0)}postProcessSupportsDataExplorer(t){let r=this.dataViewerDelegator.getVariableViewers();return t.pageResponse.forEach(i=>{i.supportsDataExplorer=r.some(o=>o.jupyterVariableViewers.dataTypes.includes(i.type))}),t}async requestVariables(t){let r=this.notebookWatcher.activeKernel;if(r){let i=await this.variables.getVariables(t,r);this.postMessage("get_variables_response",this.postProcessSupportsDataExplorer(i)).catch(h),T("DS_INTERNAL.VARIABLE_EXPLORER_VARIABLE_COUNT",{variableCount:i.totalCount})}else{let i={executionCount:t.executionCount,pageStartIndex:-1,pageResponse:[],totalCount:0,refreshCount:t.refreshCount};this.postMessage("get_variables_response",i).catch(h)}}async activeNotebookExecuted(t){this.postMessage("update_variable_view_execution_count",{executionCount:t.executionCount}).catch(h)}async activeNotebookChanged(t){t.executionCount?this.postMessage("update_variable_view_execution_count",{executionCount:t.executionCount}).catch(h):this.postMessage("update_variable_view_execution_count",{executionCount:0}).catch(h),this.postMessage("force_variable_refresh").catch(h)}activeTextEditorChanged(){this.postMessage("force_variable_refresh").catch(h)}async activeNotebookRestarted(){this.postMessage("restart_kernel").catch(h)}async sendRefreshMessage(){this.postMessage("force_variable_refresh").catch(h)}};v([fr("DS_INTERNAL.NATIVE_VARIABLE_VIEW_LOADED")],uh.prototype,"load",1),v([Yr()],uh.prototype,"showDataViewer",1),v([Yr()],uh.prototype,"requestVariables",1);var RS=class{constructor(e,t,r,i,o,s,a){this.configuration=e;this.webviewViewProvider=t;this.context=r;this.variables=i;this.disposables=o;this.notebookWatcher=s;this.dataViewerDelegator=a;this.viewType="jupyterViewVariables"}get activeVariableView(){if(!Rr())throw new Error("activeVariableView only for test code");return this.variableView?Promise.resolve(this.variableView):(this.activeVariableViewPromise=ne(),this.activeVariableViewPromise.promise)}async resolveWebviewView(e,t,r){e.webview.options={enableScripts:!0},this.variableView=new uh(this.configuration,this.webviewViewProvider,this.context,this.variables,this.disposables,this.notebookWatcher,this.dataViewerDelegator),this.activeVariableViewPromise&&this.activeVariableViewPromise.resolve(this.variableView),await this.variableView.load(e)}};RS=v([(0,ia.injectable)(),m(0,(0,ia.inject)(oe)),m(1,(0,ia.inject)(jx)),m(2,(0,ia.inject)(tt)),m(3,(0,ia.inject)(In)),m(3,(0,ia.named)(Le.ALL_VARIABLES)),m(4,(0,ia.inject)(K)),m(5,(0,ia.inject)(dR)),m(6,(0,ia.inject)(Xa))],RS);function vX(n){n.addSingleton(me,DS),n.add(J1,oh),n.addSingleton(fS,Zp),n.addSingleton(hS,yS),n.addSingleton(me,vS),n.addSingleton(Xa,Xa),n.add(iR,wS),n.addSingleton(nR,PS),n.addSingleton(uR,xS),n.addSingleton(Xu,Xu),n.addSingleton(dR,_S),n.addSingleton(me,TS),n.addSingleton(me,SS),n.addSingleton(pR,RS),n.add(q1,Qu),n.addSingleton(H1,IS)}var im=require("os");var Oo=k(require("vscode"));var IX=k(require("vscode"));var dh=k(require("vscode")),xL;(t=>{function n(r){return r.start.line===r.end.line&&r.start.character===r.end.character}t.isEmpty=n;function e(r,i){let o=r.start.line,s=r.start.character,a=r.end.line,l=r.end.character,c=i.start.line,u=i.start.character,d=i.end.line,f=i.end.character;return o<c?(o=c,s=u):o===c&&(s=Math.max(s,u)),a>d?(a=d,l=f):a===d&&(l=Math.min(l,f)),!(o>a||o===a&&s>l)}t.intersects=e})(xL||={});function DL(n){n.sort((t,r)=>t-r);let e=n.shift();return e===void 0?[]:n.reduce(function(t,r){return r<=t[0][1]?t[0][1]=r+1:t.unshift([r,r+1]),t},[[e,e+1]]).reverse().map(t=>new dh.NotebookRange(t[0],t[1]))}function yX(n){return n.reduce((t,r)=>{for(let i=r.start;i<r.end;i++)t.push(i);return t},[])}function cge(n){return dh.workspace.notebookDocuments.find(e=>e.uri.authority===n.uri.authority&&e.uri.path===n.uri.path)}function tP(n){let e=dh.workspace.textDocuments.find(o=>o.uri.toString()===n?.document.uri.toString())??dh.window.activeTextEditor?.document;if(!e)return;let t=cge(e);if(!t)return;let i=t.getCells().find(o=>o.document.uri.toString()===e.uri.toString());if(i)return{notebook:t,cell:i}}function _L(n,e){return n.start.line===e.start.line&&n.start.character===e.start.character&&n.end.line===e.end.line&&n.end.character===e.end.character}function Ei(){}var bX="ms-python.vscode-pylance";async function uge(n){return await n.activate()}var TL;async function SX(){let n=IX.extensions.getExtension(bX);if(n)return TL||new Promise((e,t)=>{uge(n).then(async r=>{if(!r){console.error("Could not start Pylance"),t();return}r.client&&await r.client.start(),TL=r.notebook,e(r.notebook)}).then(Ei,Ei)})}var Or=k(require("vscode"));var dge=Or.window.createTextEditorDecorationType({after:{contentText:"write",margin:"0 0 0 1em",backgroundColor:"red"}}),pge=Or.window.createTextEditorDecorationType({after:{contentText:"read",margin:"0 0 0 1em",backgroundColor:"green"}}),gR=class{constructor(e,t,r){this._notebookDocument=e;this._cellExecution=t;this._cellRefs=r}_getVirtualCellList(e){return this._cellExecution.findIndex(r=>r.cell.document.uri.toString()===e.document.uri.toString())===-1?this._notebookDocument.getCells():this._cellExecution.map(r=>r.cell)}getPredecessorCells(e,t=!1){let r=t?this._notebookDocument.getCells():this._getVirtualCellList(e);var i;for(i=r.length-1;i>=0&&r[i].document.uri.toString()!==e.document.uri.toString();i--);if(i===-1)return[];let o=i,s=r.slice(0,o+1),a=new Array(s.length).fill(!1);a[o]=!0;let l=new Map;for(let[d,f]of this._cellRefs.entries()){let g=f.filter(b=>b.kind==="write").map(b=>b.uri.fragment);f.forEach(b=>{let I=b.uri.fragment;l.has(I)?l.get(I)?.push(d):l.set(I,[d])}),f.forEach(b=>{let I=b.uri.fragment;l.has(I)?l.get(I)?.push(...g):l.set(I,g)})}let c=e.document.uri.fragment;this._resolveDependencies(l,a,c,s,t);let u=[];for(let d=0;d<a.length;d++)a[d]&&u.push(s[d]);return u}getSuccessorCells(e){let t=this._getVirtualCellList(e),r=t.findIndex(a=>a.document.uri.fragment===e.document.uri.fragment);if(r===-1)return[];let i=new Array(t.length).fill(!1);i[r]=!0;let o=new Map;this._cellRefs.forEach(a=>{a.forEach(l=>{if(l.kind==="write"){let c=l.uri.fragment,u=o.get(c)??[];u.push(...a.filter(d=>d!==l)),o.set(c,u)}})});for(let a=r;a<t.length;a++)if(i[a]){let l=this._cellRefs.get(t[a].document.uri.fragment)||[],c=o.get(t[a].document.uri.fragment)||[];[...l,...c].forEach(d=>{let f=t.findIndex(g=>g.document.uri.fragment===d.uri.fragment);f!==-1&&f>=a&&(i[f]=!0)})}let s=[];for(let a=0;a<i.length;a++)i[a]&&s.push(t[a]);return s}_resolveDependencies(e,t,r,i,o=!1){if(e.has(r))for(let s of e.get(r)){let a=i.findIndex(l=>l.document.uri.fragment===s);if(a===-1){if(o)continue;throw new Error(`Dependency ${s} is not in the execution list.`)}t[a]||(t[a]=!0,this._resolveDependencies(e,t,s,i,o))}}};var vR=class{constructor(e,t){this._notebookEditor=e;this._client=t;this._pendingRequests=new Map;this._cellRefs=new Map;this._staleCellRefs=new Map;this._cellExecution=[];this._disposables=[];this._notebookEditor.notebook.getCells().forEach(r=>{this._requestCellSymbols(r,!1).then(Ei,Ei)}),this._disposables.push(Or.workspace.onDidChangeNotebookDocument(r=>{r.notebook===this._notebookEditor.notebook&&(r.contentChanges.forEach(i=>{i.removedCells.forEach(o=>{this._pendingRequests.delete(o.document.uri.fragment),this._cellRefs.delete(o.document.uri.fragment)}),i.addedCells.forEach(o=>{this._requestCellSymbols(o,!1).then(Ei,Ei)})}),r.cellChanges.forEach(i=>{i.document&&(this._requestCellSymbols(i.cell,!1).then(Ei,Ei),this._updateCellStatus(i.cell,0))}))})),this._disposables.push(ar.onDidChangeNotebookCellExecutionState(r=>{r.state===3&&r.cell.document.languageId==="python"&&this._updateCellStatus(r.cell,1),r.state===1&&r.cell.document.languageId==="python"&&(this._cellExecution.push({cell:r.cell,executionCount:r.cell.executionSummary?.executionOrder??0}),this._updateCellStatus(r.cell,2))}))}_updateCellStatus(e,t){this._staleCellRefs.set(e.document.uri.fragment,t)}async _requestCellSymbolsSync(){let e=[...this._pendingRequests.keys()];this._pendingRequests.forEach(t=>t.cancel()),this._pendingRequests.clear();for(let t of e){let r=this._notebookEditor.notebook.getCells().find(i=>i.document.uri.fragment===t);r&&await this._requestCellSymbols(r,!0)}}async getCellSymbolRefs(e){let t=this._cellRefs.get(e.document.uri.fragment);if(t)return t}async selectPrecedentCells(e){let t=await this.getPrecedentCells(e);this._notebookEditor.selections=t}async selectSuccessorCells(e){let t=await this.getSuccessorCells(e);this._notebookEditor.selections=t}async runPrecedentCells(e){let t=await this.getPrecedentCells(e);await Or.commands.executeCommand("notebook.cell.execute",{ranges:t.map(r=>({start:r.start,end:r.end})),document:this._notebookEditor.notebook.uri}).then(Ei,Ei)}async runSuccessorCells(e){let t=await this.getSuccessorCells(e);await Or.commands.executeCommand("notebook.cell.execute",{ranges:t.map(r=>({start:r.start,end:r.end})),document:this._notebookEditor.notebook.uri}).then(Ei,Ei)}async getPrecedentCells(e){await this._requestCellSymbolsSync();let t=new gR(this._notebookEditor.notebook,this._cellExecution,this._cellRefs),r=[];try{r=t.getPredecessorCells(e)}catch{try{r=t.getPredecessorCells(e,!0)}catch{throw new Error("No precedent cells found")}}let i=r.findIndex(s=>(this._staleCellRefs.get(s.document.uri.fragment)??0)===0);return DL((i===-1?r:r.slice(i)).map(s=>s.index))}async getSuccessorCells(e){await this._requestCellSymbolsSync();let r=new gR(this._notebookEditor.notebook,this._cellExecution,this._cellRefs).getSuccessorCells(e);return DL(r.map(o=>o.index))}async debugSymbols(){let e=[];await this._requestCellSymbolsSync(),console.log(JSON.stringify(Array.from(this._cellRefs.entries())));for(let r of Or.window.visibleTextEditors){let i=r.document;if(i.uri.scheme==="vscode-notebook-cell"&&i.uri.path===this._notebookEditor.notebook.uri.path){let o=this._cellRefs.get(i.uri.fragment);o&&e.push(...o)}}let t=new Map;e.forEach(r=>{let i=r.uri.fragment;t.has(i)||t.set(i,[]),t.get(i)?.push(r)}),t.forEach((r,i)=>{let o=Or.window.visibleTextEditors.find(s=>s.document.uri.path===this._notebookEditor.notebook.uri.path&&s.document.uri.fragment===i);if(o){let s=[],a=[];r.reduce((c,u)=>c.find(f=>_L(f.range,u.range))?c:c.concat([u]),[]).forEach(c=>{let u=new Or.Position(c.range.end.line,c.range.end.character),d=new Or.Range(u,u);c.kind==="write"?s.push(d):c.kind==="read"&&a.push(d)}),o.setDecorations(dge,s),o.setDecorations(pge,a)}})}async _requestCellSymbols(e,t){let r=this._pendingRequests.get(e.document.uri.fragment);if(r&&r.cancel(),t){let o=new Or.CancellationTokenSource;await this._doRequestCellSymbols(e,o.token),o.dispose();return}let i=new Or.CancellationTokenSource;this._pendingRequests.set(e.document.uri.fragment,i),setTimeout(()=>{this._pendingRequests.get(e.document.uri.fragment)===i&&(this._pendingRequests.delete(e.document.uri.fragment),!i.token.isCancellationRequested&&this._doRequestCellSymbols(e,i.token).then(Ei,Ei))},500)}async _getDocumentSymbols(e){if(this._client.getDocumentSymbols){let t=new Or.CancellationTokenSource,r=await this._client.getDocumentSymbols(e.document,t.token);if(r&&r.length>0)return t.dispose(),r}if(e.document.lineCount>1||e.document.lineAt(0).text.length>0)return Or.commands.executeCommand("vscode.executeDocumentSymbolProvider",e.document.uri)}async _doRequestCellSymbols(e,t){let r=await this._getDocumentSymbols(e);if(!r)return;let i=[];for(let o of r){let s=await this._client.getReferences(e.document,o.selectionRange.start,{includeDeclaration:!0},t);s&&i.push(...s.filter(a=>a.uri.scheme==="vscode-notebook-cell").map(a=>({...a,associatedSymbol:o})))}i.length&&this._cellRefs.set(e.document.uri.fragment,i.map(o=>({range:o.range,uri:o.uri,kind:_L(o.range,o.associatedSymbol.selectionRange)?"write":o.kind,associatedSymbol:o.associatedSymbol})))}dispose(){this._pendingRequests.forEach(e=>e.cancel()),this._pendingRequests.clear(),this._disposables.forEach(e=>e.dispose()),this._disposables=[]}},yR=class{constructor(e){this._client=e;this._disposables=[];this._notebookDocumentSymbolTrackers=new Map;Or.window.visibleNotebookEditors.forEach(t=>{this._notebookDocumentSymbolTrackers.set(t.notebook.uri.toString(),new vR(t,this._client))}),this._disposables.push(Or.window.onDidChangeVisibleNotebookEditors(t=>{t.forEach(r=>{this._notebookDocumentSymbolTrackers.has(r.notebook.uri.toString())||this._notebookDocumentSymbolTrackers.set(r.notebook.uri.toString(),new vR(r,this._client))}),this._notebookDocumentSymbolTrackers.forEach((r,i)=>{Or.window.visibleNotebookEditors.find(o=>o.notebook.uri.toString()===i)||(r.dispose(),this._notebookDocumentSymbolTrackers.delete(i))})}))}getNotebookDocumentSymbolTracker(e){return this._notebookDocumentSymbolTrackers.get(e.toString())}async debugSymbols(e){let t=this._notebookDocumentSymbolTrackers.get(e.uri.toString());t&&await t.debugSymbols()}async runSuccessorCells(e,t){let r=this._notebookDocumentSymbolTrackers.get(e.uri.toString());r&&await r.runSuccessorCells(t)}async runPrecedentCells(e,t){let r=this._notebookDocumentSymbolTrackers.get(e.uri.toString());r&&await r.runPrecedentCells(t)}async selectSuccessorCells(e,t){let r=this._notebookDocumentSymbolTrackers.get(e.uri.toString());r&&await r.selectSuccessorCells(t)}async selectPrecedentCells(e,t){let r=this._notebookDocumentSymbolTrackers.get(e.uri.toString());r&&await r.selectPrecedentCells(t)}dispose(){this._disposables.forEach(e=>e.dispose()),this._disposables=[]}},bR=class{constructor(e){this.symbolsTracker=e}async provideCodeActions(e,t,r,i){let o=Or.workspace.notebookDocuments.filter(b=>b.uri.path===e.uri.path),s,a;for(let b of o)if(s=b.getCells().find(I=>I.document.uri.toString()===e.uri.toString()),s){a=b;break}if(!s||!a)return[];let l=this.symbolsTracker.getNotebookDocumentSymbolTracker(a.uri);if(!l)return[];let c=r.diagnostics.find(b=>b.source==="Cell Execution Error"&&b.message.startsWith("NameError")&&b.message.endsWith("is not defined"));if(!c)return[];let u=c.message.match(/NameError: name '(.+)' is not defined/);if(!u)return[];let d=u[1],f=await l.getPrecedentCells(s),g=await Promise.all(yX(f).map(async b=>{let I=a?.cellAt(b);if(!I)return!1;let w=await l.getCellSymbolRefs(I);if(!w||w.length<=0)return!1;let _=w.filter(A=>A.associatedSymbol?.name===d).find(A=>A.uri.toString()===s?.document.uri.toString());if(!_)return!1;if(xL.intersects(_.range,t))return!0}));if(i.isCancellationRequested)return[];if(g.some(b=>b)){let b=new Or.CodeAction("Run Precedent Cells",Or.CodeActionKind.QuickFix);return b.command={command:"jupyter.runPrecedentCells",title:"Run Precedent Cells",arguments:[s]},[b]}return[]}};async function CX(n){if(!Oo.workspace.getConfiguration("jupyter").get("executionAnalysis.enabled"))return;let t=await SX();if(!t)return;let r=new yR(t);n.subscriptions.push(r),n.subscriptions.push(Oo.commands.registerCommand("jupyter.selectDependentCells",async i=>{let o=tP(i);if(!o)return;let{notebook:s,cell:a}=o;await r.selectSuccessorCells(s,a)})),n.subscriptions.push(Oo.commands.registerCommand("jupyter.runPrecedentCells",async i=>{let o=tP(i);if(!o)return;let{notebook:s,cell:a}=o;await r.runPrecedentCells(s,a)})),n.subscriptions.push(Oo.commands.registerCommand("jupyter.runDependentCells",async i=>{let o=tP(i);if(!o)return;let{notebook:s,cell:a}=o;await r.runSuccessorCells(s,a)})),n.subscriptions.push(Oo.commands.registerCommand("jupyter.selectPrecedentCells",async i=>{let o=tP(i);if(!o)return;let{notebook:s,cell:a}=o;await r.selectPrecedentCells(s,a)})),n.subscriptions.push(Oo.commands.registerCommand("jupyter.debugCellSymbols",async()=>{let i=Oo.window.activeNotebookEditor;i&&await r.debugSymbols(i.notebook)})),n.subscriptions.push(Oo.languages.registerCodeActionsProvider({language:"python",notebookType:"jupyter-notebook"},new bR(r),{providedCodeActionKinds:[Oo.CodeActionKind.QuickFix]}))}function EX(){}var Rn=k(require("vscode"));var Lo=k(require("vscode"));var Za=k(require("vscode"));var wi=require("vscode");function rP(n,e){ot(n.fsPath).then(t=>{T("DATASCIENCE.JUPYTER_CONFIGURE_NOTEBOOK_TOOL_CALL",void 0,{resourceHash:t,createdEnv:e.createdEnv===!0,installedPythonExtension:e.installedPythonExtension===!0,isPython:e.isPython===!0})})}var Fo=class{constructor(e){this.toolName=e}async invoke(e,t){if(!wi.workspace.isTrusted)return new wi.LanguageModelToolResult([new wi.LanguageModelTextPart("Cannot use this tool in an untrusted workspace.")]);let r,i;try{let o=await wX(e.input.filePath);return await this.invokeImpl(e,o,t)}catch(o){throw r=o,o}finally{let o=t.isCancellationRequested||(r?Zt(r,!0):!1),s=r||o?"true":"false",a=o?"cancelled":r?r instanceof $e?r.category:"error":void 0;(i?ot(i.fsPath):Promise.resolve(void 0)).then(c=>{T("InvokeTool",void 0,{toolName:this.toolName,resourceHash:c,failed:s,failureCategory:a})})}}async prepareInvocation(e,t){let r=await wX(e.input.filePath);return this.prepareInvocationImpl(e,r,t)}};async function wX(n){let e=wi.Uri.file(n),t=e;try{t=wi.Uri.parse(n)}catch{}let r=wi.workspace.notebookDocuments.find(i=>i.uri.path===n||i.uri.fsPath===n)||wi.workspace.notebookDocuments.find(i=>an(i.uri,e))||wi.workspace.notebookDocuments.find(i=>i.uri.path===n||i.uri.fsPath===t.fsPath)||wi.workspace.notebookDocuments.find(i=>an(i.uri,t));if(r=r||await wi.workspace.openNotebookDocument(e),!r)throw new mt(`Unable to find notebook at ${n}.`,void 0,"notebookNotFound");if(!St(r))throw new mt(`The notebook at ${n} is not a Jupyter notebook This tool can only be used with Jupyter Notebooks.`,void 0,"nonJupyterNotebook");return wi.window.visibleNotebookEditors.find(i=>i.notebook===r)||await wi.window.showNotebookDocument(r),r}var nP=class n extends Fo{constructor(t,r){super(n.toolName);this.kernelProvider=t;this.controllerRegistration=r}static{this.toolName="notebook_list_packages"}async invokeImpl(t,r,i){let o=await tm(r,this.controllerRegistration,i);if(!o)throw new mt(`No active kernel for notebook ${r.uri}, A kernel needs to be selected.`,void 0,"noActiveKernel");if(!Xe(o.kernelConnectionMetadata))throw new mt("The selected Kernel is not a Python Kernel and this tool only supports Python Kernels.",void 0,"nonPythonKernelSelected");let s=await RL(o);if(!s)throw new mt(`Unable to list packages for notebook ${r.uri}.`,void 0,"failedToListPackages");return new Za.LanguageModelToolResult([s])}async prepareInvocationImpl(t,r,i){let o=this.controllerRegistration.getSelected(r),s=this.kernelProvider.get(r);return o&&s&&oa(s)?{invocationMessage:Za.l10n.t("Listing packages")}:{confirmationMessages:{title:Za.l10n.t("Start Kernel and List Packages?"),message:Za.l10n.t("The notebook kernel needs to be started before listing packages")},invocationMessage:Za.l10n.t("Starting kernel and listing packages")}}};async function RL(n){if(!Xe(n.kernelConnectionMetadata))throw new mt("The selected Kernel is not a Python Kernel and this tool only supports Python Kernels.",void 0,"nonPythonKernelSelected");let e=n.kernelConnectionMetadata.interpreter?.uri,t=[];if(e&&cu(n.kernelConnectionMetadata)&&(t=await PX(e)),!t){let r=new Za.CancellationTokenSource;try{t=await IR(n,r.token)}finally{r.dispose()}}if(t){let i=`Packages installed in notebook: ${t.map(o=>`${o.name}==${o.version}`).join(", ")}`;return new Za.LanguageModelTextPart(i)}}async function IR(n,e){let t=`import subprocess
proc = subprocess.Popen(["pip", "list", "--format", "json"], stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=True)
stdout, stderr = proc.communicate()
return stdout
`.split(`
`);try{return await Ju(n,t,e)}catch(r){throw r}}async function PX(n){let e=await Av();if(!e)return;let t=await e.resolveEnvironment(n);if(t)return await e.getPackages(t)}async function kX(n,e){let t=await Av();if(!t)return!1;let r=await t.resolveEnvironment(n);return r?(await t.managePackages(r,{install:e}),!0):!1}async function tm(n,e,t){if(!e.getSelected(n)){p.trace(`No kernel selected, displaying quick pick for notebook ${M(n.uri)}`);let i=new or;try{let o=new Promise(a=>i.add(e.onControllerSelected(l=>{p.trace(`Kernel selected for notebook ${M(n.uri)}`),l.notebook===n&&a()})));Lo.window.visibleNotebookEditors.some(a=>a.notebook===n)||await Lo.window.showNotebookDocument(n);let s=await Rt(t,Lo.commands.executeCommand("notebook.selectKernel",{notebookUri:n.uri,skipIfAlreadySelected:!0}));p.trace(`Kernel Selector invoked for notebook ${M(n.uri)} and returned ${s}`),await Bt(500,Rt(t,o))}finally{i.dispose()}}let r=e.getSelected(n);if(r)return p.trace(`Kernel selected for notebook ${M(n.uri)}`),Rt(t,r.startKernel(n));p.warn(`No kernel controller selected for notebook ${M(n.uri)}`)}async function iP(n,e,t,r,i=!0){if(!t.getSelected(n)){let s=new or;try{let a=new Promise(c=>s.add(t.onControllerSelected(u=>u.notebook===n?c():void 0))),l=Lo.window.visibleNotebookEditors.find(c=>c.notebook===n)||await Lo.window.showNotebookDocument(n);await Rt(r,Lo.commands.executeCommand("notebook.selectKernel",{editor:l,id:e.id,extension:_e})),await Bt(500,Rt(r,a))}finally{s.dispose()}}let o=t.getSelected(n);if(o&&i)return Rt(r,o.startKernel(n))}async function AS(n,e){let t=[`Notebook has been configured to use the kernel ${n.label||_d(n.connection)}, and the Kernel has been successfully started.`],r=e?await Bt(5e3,RL(e)):void 0;return new Lo.LanguageModelToolResult([new Lo.LanguageModelTextPart(t.join(" ")),...r?[r]:[]])}function SR(n){return n.getCells().some(e=>e.document.languageId===ge)?ge:xg(Mi(n))?ge:n.getCells().find(e=>e.kind===Lo.NotebookCellKind.Code)?.document.languageId||ge}function oa(n){return!(n.status==="dead"||n.status==="terminating"||n.status==="unknown")}var Bn=k(require("vscode"));var rm=k(require("vscode"));var ph=class n extends Fo{constructor(t,r,i){super(n.toolName);this.kernelProvider=t;this.controllerRegistration=r;this.notebookCommandHandler=i}static{this.toolName="restart_notebook_kernel"}async invokeImpl(t,r,i){await this.notebookCommandHandler.restartKernel(r.uri,!0);let o=`The kernel for the notebook at ${r.uri} has been restarted and any state from previous cell executions has been cleared.`;return new rm.LanguageModelToolResult([new rm.LanguageModelTextPart(o)])}async prepareInvocationImpl(t,r,i){let o=this.controllerRegistration.getSelected(r),s=this.kernelProvider.get(r);if(!o||!s||!oa(s))throw new mt(`No active kernel for notebook ${t.input.filePath}, the configure_notebook tool can be used to help the user select a kernel.`,void 0,"noActiveKernel");let a=pr(r.uri);return{confirmationMessages:{title:rm.l10n.t("Restart Kernel?"),message:t.input.reason??rm.l10n.t("The kernel for the notebook {0} will be restarted.",a)},invocationMessage:rm.l10n.t("Restarting kernel for {0}",a)}}};var oP=class n extends Fo{constructor(t,r,i){super(n.toolName);this.kernelProvider=t;this.controllerRegistration=r;this.installationManager=i}static{this.toolName="notebook_install_packages"}async invokeImpl(t,r,i){let{packageList:o}=t.input;if(!o||o.length===0)throw new mt("filePath and package list are required parameters.",void 0,"emptyPackageList");let s=await tm(r,this.controllerRegistration,i);if(!s)throw new mt(`No active kernel for notebook ${r.uri}, A kernel needs to be selected.`,void 0,"noActiveKernel");let a=!1,l=s.kernelConnectionMetadata.interpreter?.uri;if(l&&Xe(s.kernelConnectionMetadata)&&(s.kernelConnectionMetadata.kind==="startUsingLocalKernelSpec"||s.kernelConnectionMetadata.kind==="startUsingPythonInterpreter")&&(a=await kX(l,o)),!a&&s.kernelConnectionMetadata.interpreter){let d=new Bn.CancellationTokenSource;i.onCancellationRequested(()=>d.cancel());let f=await this.installationManager.getInstallationChannels(s.kernelConnectionMetadata.interpreter);if(f.length>0){let g=f[0];for(let b of o)await g.installModule(b,s.kernelConnectionMetadata.interpreter,d,void 0,!0);a=!0}}if(!a){let d=`Failed to install one or more packages: ${o.join(", ")}.`;return new Bn.LanguageModelToolResult([new Bn.LanguageModelTextPart(d)])}let c={...t.input,reason:"Packages installed"},u={...t,input:c};try{await Bn.lm.invokeTool(ph.toolName,u)}catch(d){return new Bn.LanguageModelToolResult([new Bn.LanguageModelTextPart(`Installation finished, but the kernel was not restarted because ${d.name==="Canceled"?"the user chose not to":`an error occurred: ${d.message}`}.`)])}return new Bn.LanguageModelToolResult([new Bn.LanguageModelTextPart("Installation finished successfully. The kernel has been restarted, so any previously executed cells will need to be re-run.")])}async prepareInvocationImpl(t,r,i){let o=this.controllerRegistration.getSelected(r),s=this.kernelProvider.get(r);return o&&s&&oa(s)?{confirmationMessages:{title:Bn.l10n.t("Install packages?"),message:Bn.l10n.t("Installing packages: {0}",t.input.packageList.join(", "))},invocationMessage:Bn.l10n.t("Installing packages: {0}",t.input.packageList.join(", "))}:{confirmationMessages:{title:Bn.l10n.t("Start Kernel and Install packages?"),message:Bn.l10n.t("The notebook kernel needs to be started before installing packages: {0}",t.input.packageList.join(", "))},invocationMessage:Bn.l10n.t("Starting kernel and installing packages: {0}",t.input.packageList.join(", "))}}};var Zu=require("vscode");var Uo=require("vscode");var nm=class n extends Fo{constructor(t,r){super(n.toolName);this.kernelProvider=t;this.controllerRegistration=r}static{this.toolName="configure_python_notebook"}async invokeImpl(t,r,i){if(!this.controllerRegistration.getSelected(r)&&t.input.action!=="select"){p.trace(`ConfigurePythonNotebookTool: No controller selected for notebook ${M(r.uri)}`);let a=await Nt(i,Sg(r.uri)),l=a&&this.controllerRegistration.all.find(c=>c.kind==="startUsingPythonInterpreter"&&c.interpreter.id===a.id);l&&(p.trace(`ConfigurePythonNotebookTool: Selecting recommended Python Env for notebook ${M(r.uri)}`),await iP(r,l,this.controllerRegistration,i))}p.trace(`ConfigurePythonNotebookTool: Start kernel for notebook ${M(r.uri)}`);let o=await tm(r,this.controllerRegistration,i);o?p.trace(`ConfigurePythonNotebookTool: Kernel selected for notebook ${M(r.uri)}, status = ${o.status}`):p.trace(`ConfigurePythonNotebookTool: No kernel selected for notebook ${M(r.uri)}`);let s=this.controllerRegistration.getSelected(r);return s?(p.trace(`ConfigurePythonNotebookTool: kernel started for notebook ${M(r.uri)}`),AS(s,o)):(p.trace(`ConfigurePythonNotebookTool: No kernel selected for notebook ${M(r.uri)}`),new Uo.LanguageModelToolResult([new Uo.LanguageModelTextPart("User did not select a Kernel for the notebook.")]))}async prepareInvocationImpl(t,r,i){let o=this.kernelProvider.get(r.uri),s=this.controllerRegistration.getSelected(r);if(s&&o&&oa(o))return{invocationMessage:void 0};if(s)return{confirmationMessages:{title:Uo.l10n.t("Start Kernel?"),message:Uo.l10n.t("The Python kernel {0} will be started",s.label)},invocationMessage:Uo.l10n.t("Starting Python Kernel for {0}",pr(r.uri))};let a=await Sg(r.uri);return a&&t.input.action!=="select"?{confirmationMessages:{title:Uo.l10n.t("Select and start a Python Kernel?"),message:Uo.l10n.t("The Python Environment '{0}' will be selected as the Kernel for the notebook.",Hr(a))},invocationMessage:Uo.l10n.t("Starting Python Kernel for {0}",pr(r.uri))}:{confirmationMessages:{title:Uo.l10n.t("Select and start a Python Kernel?"),message:Uo.l10n.t("The selected Python Kernel will be started and used for execution of code in the notebook.")},invocationMessage:Uo.l10n.t("Starting Python Kernel for {0}",pr(r.uri))}}};var sa=require("vscode");var mh=class n extends Fo{constructor(t,r){super(n.toolName);this.controllerRegistration=t;this.kernelProvider=r}static{this.toolName="configure_non_python_notebook"}async invokeImpl(t,r,i){await tm(r,this.controllerRegistration,i);let o=this.controllerRegistration.getSelected(r),s=this.kernelProvider.get(r);return o?AS(o,s):new sa.LanguageModelToolResult([new sa.LanguageModelTextPart("User did not select a Kernel for the notebook.")])}async prepareInvocationImpl(t,r,i){let o=SR(r),s=this.controllerRegistration.getSelected(r),a=this.kernelProvider.get(r.uri);return s&&a&&oa(a)?{invocationMessage:sa.l10n.t("Using {0} Kernel",o)}:s?{confirmationMessages:{title:sa.l10n.t("Start Kernel?"),message:sa.l10n.t("The {0} kernel {1} will be started",o,s.label)},invocationMessage:sa.l10n.t("Starting {0} Kernel",o)}:{confirmationMessages:{title:sa.l10n.t("Select and start a {0} Kernel?",o),message:sa.l10n.t("The selected {0} Kernel will be started and used for execution of code in the notebook.",o)},invocationMessage:sa.l10n.t("Selecting and starting a {0} Kernel",o)}}};var si=require("vscode");var AL=k(Ik());async function xX(n,e,t,r,i){if(!await NL(e,i))return!1;let s=await Nt(i,AL.PythonExtension.api()),a={resourcePath:e.uri.fsPath,packageList:["ipykernel"]};await si.lm.invokeTool("create_virtual_environment",{...n,input:a},i),p.trace(`Create Env tool for notebook ${M(e.uri)}`);let l=DX(e.uri,s.environments);if(!l)return p.error(`Create Env tool for notebook ${M(e.uri)} but no virtual environment found`),!1;let c=await s.environments.resolveEnvironment(l);if(p.trace(`Invoked Create Env tool for notebook ${M(e.uri)} and got env ${c?.id}`),!c)return p.error(`Invoked Create Env tool for notebook ${M(e.uri)} but no resolved env for ${M(l?.id)}`),!1;let u=t.all.find(g=>g.kind==="startUsingPythonInterpreter"&&g.interpreter.id===c.id),d=new Me;for(;d.elapsedTime<1e3&&!u;)u=t.all.find(g=>g.kind==="startUsingPythonInterpreter"&&g.interpreter.id===c.id),await Hn(100);if(!u)return p.error(`Invoked Create Env toolfor notebook ${M(e.uri)} and got env ${c?.id}, but no controller found for it`),!1;p.trace(`ConfigurePythonNotebookTool: Selecting recommended Python Env for notebook ${M(e.uri)}`),await iP(e,u,t,i,!1);let f=t.getSelected(e);return f&&!si.extensions.getExtension(wP)&&(await r.installMissingDependencies({resource:e.uri,kernelConnection:f.connection,ui:new Mt(!0),token:i,ignoreCache:!0,installWithoutPrompting:!0}),await iP(e,u,t,i,!0)),!0}async function NL(n,e){if(!si.extensions.getExtension(sn)||!(si.workspace.getWorkspaceFolder(n.uri)||(si.workspace.workspaceFolders?.length===1?si.workspace.workspaceFolders[0]:void 0))||!si.extensions.getExtension(sn))return!1;let r=await Nt(e,AL.PythonExtension.api());return!DX(n.uri,r.environments)}function DX(n,e){let t=n&&si.workspace.workspaceFolders?.length?si.workspace.getWorkspaceFolder(n):si.workspace.workspaceFolders?.length===1?si.workspace.workspaceFolders[0]:void 0;if(!t)return;let r=o=>o.environment?.folderUri&&o.executable.sysPrefix&&an(Nn(si.Uri.file(o.executable.sysPrefix)),t.uri)&&o.environment.name===".venv"&&o.environment.type==="VirtualEnvironment",i=o=>o.environment?.folderUri&&o.executable.sysPrefix&&an(Nn(si.Uri.file(o.executable.sysPrefix)),t.uri)&&an(o.environment.folderUri,si.Uri.joinPath(t.uri,".conda"))&&o.environment.type==="Conda";return e.known.find(o=>r(o)||i(o))}var sP=class n extends Fo{constructor(t,r,i,o){super(n.toolName);this.controllerRegistration=t;this.kernelDependencyService=r;this.kernelProvider=i;this.configurePythonNotebookTool=o}static{this.toolName="configure_notebook"}async invokeImpl(t,r,i){let o=this.controllerRegistration.getSelected(r),s=this.kernelProvider.get(r);return o&&s&&oa(s)?AS(o,s):SR(r)!==ge?(rP(r.uri,{isPython:!1}),Zu.lm.invokeTool(mh.name,t,i)):this.invokeToolForPython(t,r,i)}async invokeToolForPython(t,r,i){let o=!1;if(!Zu.extensions.getExtension(sn))try{let a={id:sn,name:"Python"};await Zu.lm.invokeTool("copilot_installExtension",{...t,input:a},i),o=!0}catch(a){p.error("Error while installing Python extension",a)}if(this.controllerRegistration.getSelected(r)||await Sg(r.uri))try{return rP(r.uri,{isPython:!0,installedPythonExtension:o}),await Zu.lm.invokeTool(nm.toolName,t,i)}catch(a){p.error("Error while selecting the recommended Python env",a)}else if(await NL(r,i))try{if(await xX(t,r,this.controllerRegistration,this.kernelDependencyService,i))return rP(r.uri,{isPython:!0,installedPythonExtension:o,createdEnv:!0}),this.configurePythonNotebookTool.invoke(t,i)}catch(a){p.error("Error while creating a venv and selecting that",a)}rP(r.uri,{isPython:!0,installedPythonExtension:o});let s={...t.input,action:"select"};return Zu.lm.invokeTool(nm.toolName,{...t,input:s},i)}async prepareInvocationImpl(t,r,i){let o=pr(r.uri);return{invocationMessage:Zu.l10n.t("Configuring notebook {0}",o)}}};async function _X(n,e){n.subscriptions.push(Rn.lm.registerTool(oP.toolName,new oP(e.get(ye),e.get(He),e.get(Sv)))),n.subscriptions.push(Rn.lm.registerTool(nP.toolName,new nP(e.get(ye),e.get(He)))),n.subscriptions.push(Rn.lm.registerTool(mh.toolName,new mh(e.get(He),e.get(ye))));let t=new nm(e.get(ye),e.get(He));n.subscriptions.push(Rn.lm.registerTool(nm.toolName,t)),n.subscriptions.push(Rn.lm.registerTool(sP.toolName,new sP(e.get(He),e.get(go),e.get(ye),t))),n.subscriptions.push(Rn.lm.registerTool(ph.toolName,new ph(e.get(ye),e.get(He),e.get(Nw)))),n.subscriptions.push(Rn.commands.registerCommand("jupyter.listPipPackages",async r=>{let i=r??Rn.window.activeNotebookEditor?.notebook.uri;if(i){let s=await e.get(ye).get(i);if(s){let a=new Rn.CancellationTokenSource().token;try{let l=await IR(s,a);if(l&&Array.isArray(l))return l}catch(l){p.warn("Failed to get pip packages",l)}}}return[]})),n.subscriptions.push(Rn.commands.registerCommand("jupyter.listVariables",async r=>{let i=r??Rn.window.activeNotebookEditor?.notebook.uri;if(!i)return[];let o=Rn.workspace.notebookDocuments.find(f=>f.uri.toString()===i.toString());if(!o)return[];let a=e.get(He).getSelected(o);if(!a)return[];let l=a.controller.variableProvider;if(!l)return[];let c=new Rn.CancellationTokenSource().token,u=l.provideVariablesWithSummarization(o,void 0,Rn.NotebookVariablesRequestKind.Named,0,c),d=[];for await(let f of u)d.push(f);return d}))}var MX=k(yN());var TX=k(N());var fh=class{constructor(e){this.container=e}getContainer(){return this.container}add(e,t,r,i){r?this.container.bind(e).to(t).whenTargetNamed(r):this.container.bind(e).to(t),i&&i.forEach(o=>{this.addBinding(e,o)})}addFactory(e,t){this.container.bind(e).toFactory(t)}addBinding(e,t){this.container.bind(t).toService(e)}addSingleton(e,t,r,i){r?this.container.bind(e).to(t).inSingletonScope().whenTargetNamed(r):this.container.bind(e).to(t).inSingletonScope(),i&&i.forEach(o=>{this.addBinding(e,o)})}addSingletonInstance(e,t,r){r?this.container.bind(e).toConstantValue(t).whenTargetNamed(r):this.container.bind(e).toConstantValue(t)}get(e,t){return t?this.container.getNamed(e,t):this.container.get(e)}tryGet(e,t){try{return t?this.container.getNamed(e,t):this.container.get(e)}catch{}}getAll(e,t){return t?this.container.getAllNamed(e,t):this.container.getAll(e)}rebind(e,t,r){r?this.container.rebind(e).to(t).whenTargetNamed(r):this.container.rebind(e).to(t)}rebindSingleton(e,t,r){r?this.container.rebind(e).to(t).inSingletonScope().whenTargetNamed(r):this.container.rebind(e).to(t).inSingletonScope()}rebindInstance(e,t,r){r?this.container.rebind(e).toConstantValue(t).whenTargetNamed(r):this.container.rebind(e).toConstantValue(t)}dispose(){this.container.unbindAll(),this.container.unload()}};v([Mh()],fh.prototype,"getContainer",1),fh=v([(0,TX.injectable)()],fh);var An=require("vscode");var AX=require("vscode");function NX(n){let e=AX.window.createOutputChannel(y.jupyterServerConsoleOutputChannel,"log");n.push(e);let t={get(r,i){let o=r[i];if(typeof o=="function"){if(i==="append")return(...s)=>{e.append(...s),RX(...s)};if(i==="appendLine")return(...s)=>{e.appendLine(...s),RX(...s)}}return o}};return new Proxy(e,t)}function RX(...n){n.length===1?p.debug(Be(n[0]).map((e,t)=>t===0?e:`    ${e}`).join(`
`)):p.debug(...n)}async function KX(n,e){let t=V2(e);t.appendLine(`${An.env.appName} (${An.version}, ${An.env.remoteName}, ${An.env.appHost})`),t.appendLine(`Jupyter Extension Version: ${n.extension.packageJSON.version}.`);let r=An.extensions.getExtension(sn);r?t.appendLine(`Python Extension Version: ${r.packageJSON.version}.`):t.appendLine("Python Extension not installed.");let i=An.extensions.getExtension(wP);i?t.appendLine(`Python Environment Extension Version: ${i.packageJSON.version}.`):t.appendLine("Python Environment Extension not installed.");let o=An.extensions.getExtension(pm);return o?t.appendLine(`Pylance Extension Version${M1()?"":" (Not Used) "}: ${o.packageJSON.version}.`):t.appendLine("Pylance Extension not installed."),e?.platform&&t.appendLine(`Platform: ${e.platform} (${e.arch}).`),t.appendLine(`Home = ${e?.homePath}`),t.appendLine(`Temp Storage folder ${M(await $E(n))}`),!An.workspace.workspaceFolders||An.workspace.workspaceFolders.length===0?t.appendLine("No workspace folder opened."):An.workspace.workspaceFolders.length===1?t.appendLine(`Workspace folder ${M(An.workspace.workspaceFolders[0].uri)}`):t.appendLine(`Multiple Workspace folders opened ${An.workspace.workspaceFolders.map(s=>M(s.uri)).join(", ")}`),t}function OX(n,e){let t=new MX.Container({skipBaseClassChecks:!0}),r=new fh(t),i=new Se(t);return r.addSingletonInstance(Ze,i),r.addSingletonInstance(W3,r),r.addSingletonInstance(K,n.subscriptions),r.addSingletonInstance(We,n.globalState,dt),r.addSingletonInstance(We,n.workspaceState,di),r.addSingletonInstance(tt,n),r.addSingletonInstance(jo,e,nd),r.addSingletonInstance(jo,NX(n.subscriptions),Th),[r,i]}function FX(n,e,t){mge(ce.handleExtensionActivationError),console.error("extension activation failed",n),p.error("extension activation failed",n),i3(n,e,t)}function mge(n){try{An.window.showErrorMessage(n).then(h,h)}catch(e){p.error("failed to notify user",e)}}async function LX(n,e){let t=e.get(Sd),r=new Me;await t.activate();let i=r.elapsedTime;T("DS_INTERNAL.EXPERIMENT_LOAD",{duration:i}),An.commands.executeCommand("setContext","jupyter.vscode.channel",Ks()).then(h,h),e.get(Mx).activate();let o=e.get(xk);o.initialize(),n.subscriptions.push(o)}var CR=k(Qo()),UX=require("vscode");async function WX(n){let e=await CR.readdir(n.globalStorageUri.fsPath).catch(()=>[]),t=k_(n);await Promise.all(e.filter(r=>r.startsWith(x_)&&r!==t).map(r=>{let i=UX.Uri.joinPath(n.globalStorageUri,r).fsPath;return p.info(`Deleting old temp dir ${i}`),CR.remove(i)})).catch(h)}var ML=class{constructor(){this.started=Date.now()}get elapsedTime(){return Date.now()-this.started}reset(){this.started=Date.now()}},hh=new ML,NS={totalActivateTime:0,codeLoadingTime:0,startActivateTime:0,endActivateTime:0,workspaceFolderCount:0};NS.codeLoadingTime=hh.elapsedTime;var KL;async function fge(n){NS.startActivateTime=hh.elapsedTime;let e=await KX(n,{addConsoleLogger:!!process.env.VSC_JUPYTER_FORCE_LOGGING,userNameRegEx:vge(),homePathRegEx:yge(),arch:(0,im.arch)(),platform:(0,im.platform)(),homePath:ID.fsPath});U$(hh),rV(n.subscriptions),yW(el.env.uiKind==el.UIKind.Web),IW(!1),n.subscriptions.push({dispose:()=>iC.isExiting=!0});try{let[t,r]=gge(n,e);return await r,NS.endActivateTime=hh.elapsedTime,n3(NS,hh),WX(n).catch(h),t}catch(t){return NS.endActivateTime=hh.elapsedTime,FX(t,NS,hh),p.error("Failed to active the Jupyter Extension",t),{ready:Promise.resolve(),registerPythonApi:h,registerRemoteServerProvider:()=>({dispose:h}),getKernelService:()=>Promise.resolve(void 0),addRemoteJupyterServer:()=>Promise.resolve(void 0),openNotebook:()=>Promise.reject(),createJupyterServerCollection:()=>{throw new Error("Not Implemented")},kernels:{getKernel:()=>Promise.resolve(void 0),onDidStart:()=>({dispose:h})},onDidChangePythonEnvironment:void 0,getPythonEnvironment:()=>{}}}}function hge(){if(iC.isExiting=!0,KL){let n=KL.get(ya);if(n)return n.dispose()}return EX(),Promise.resolve()}function gge(n,e){let[t,r]=OX(n,e);KL=r,K$(s=>r.get(Nd).getPackageVersions(s));let i=bge(n,t,r);return CX(n).then(h,h),_X(n,r).then(h,h),[e3(i,t,r,n),i,r]}function VX(n){return n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function vge(){try{let n=VX((0,im.userInfo)().username);return new RegExp(n,"ig")}catch(n){console.info(`jupyter extension failed to get username info with ${n}
 username will not be obfuscated in local logs`)}}function yge(){try{let n=VX(Qd().fsPath);return new RegExp(n,"ig")}catch(n){console.info(`jupyter extension failed to get home directory path with ${n}
 home Path will not be obfuscated in local logs`)}}async function bge(n,e,t){let r=!Rr()&&(n.extensionMode===el.ExtensionMode.Development||el.workspace.getConfiguration("jupyter").get("development",!1));e.addSingletonInstance(q2,r),r&&el.commands.executeCommand("setContext","jupyter.development",!0).then(h,h),el.commands.executeCommand("setContext","jupyter.webExtension",!1).then(h,h),j2((0,im.homedir)()),Wq(e),yz(e,r),EQ(e,r),wY(e),sX(n,e,r),vX(e),await LX(n,t)}0&&(module.exports={activate,deactivate});
/*! Bundled license information:

reflect-metadata/Reflect.js:
  (*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0
  
  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.
  
  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** *)

tmp/lib/tmp.js:
  (*!
   * Tmp
   *
   * Copyright (c) 2011-2017 KARASZI Istvan <github@spam.raszi.hu>
   *
   * MIT Licensed
   *)

strip-comments/index.js:
  (*!
   * strip-comments <https://github.com/jonschlinkert/strip-comments>
   * Copyright (c) 2014-present, Jon Schlinkert.
   * Released under the MIT License.
   *)
*/
